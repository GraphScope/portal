(self.webpackChunk=self.webpackChunk||[]).push([[2984],{9069:function(t,e,n){"use strict";n.d(e,{Z:function(){return l}});var r=n(2053),i=n(50959),s={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M888 792H200V168c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v688c0 4.4 3.6 8 8 8h752c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm-600-80h56c4.4 0 8-3.6 8-8V560c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v144c0 4.4 3.6 8 8 8zm152 0h56c4.4 0 8-3.6 8-8V384c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v320c0 4.4 3.6 8 8 8zm152 0h56c4.4 0 8-3.6 8-8V462c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v242c0 4.4 3.6 8 8 8zm152 0h56c4.4 0 8-3.6 8-8V304c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v400c0 4.4 3.6 8 8 8z"}}]},name:"bar-chart",theme:"outlined"},o=n(82350),a=function(t,e){return i.createElement(o.Z,(0,r.Z)({},t,{ref:e,icon:s}))};var l=i.forwardRef(a)},63806:function(t,e,n){"use strict";n.d(e,{Z:function(){return l}});var r=n(2053),i=n(50959),s={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M766.4 744.3c43.7 0 79.4-36.2 79.4-80.5 0-53.5-79.4-140.8-79.4-140.8S687 610.3 687 663.8c0 44.3 35.7 80.5 79.4 80.5zm-377.1-44.1c7.1 7.1 18.6 7.1 25.6 0l256.1-256c7.1-7.1 7.1-18.6 0-25.6l-256-256c-.6-.6-1.3-1.2-2-1.7l-78.2-78.2a9.11 9.11 0 00-12.8 0l-48 48a9.11 9.11 0 000 12.8l67.2 67.2-207.8 207.9c-7.1 7.1-7.1 18.6 0 25.6l255.9 256zm12.9-448.6l178.9 178.9H223.4l178.8-178.9zM904 816H120c-4.4 0-8 3.6-8 8v80c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-80c0-4.4-3.6-8-8-8z"}}]},name:"bg-colors",theme:"outlined"},o=n(82350),a=function(t,e){return i.createElement(o.Z,(0,r.Z)({},t,{ref:e,icon:s}))};var l=i.forwardRef(a)},15001:function(t,e,n){"use strict";n.d(e,{Z:function(){return l}});var r=n(2053),i=n(50959),s={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M832 64H192c-17.7 0-32 14.3-32 32v832c0 17.7 14.3 32 32 32h640c17.7 0 32-14.3 32-32V96c0-17.7-14.3-32-32-32zm-260 72h96v209.9L621.5 312 572 347.4V136zm220 752H232V136h280v296.9c0 3.3 1 6.6 3 9.3a15.9 15.9 0 0022.3 3.7l83.8-59.9 81.4 59.4c2.7 2 6 3.1 9.4 3.1 8.8 0 16-7.2 16-16V136h64v752z"}}]},name:"book",theme:"outlined"},o=n(82350),a=function(t,e){return i.createElement(o.Z,(0,r.Z)({},t,{ref:e,icon:s}))};var l=i.forwardRef(a)},9541:function(t,e,n){"use strict";n.d(e,{Z:function(){return l}});var r=n(2053),i=n(50959),s={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M740 161c-61.8 0-112 50.2-112 112 0 50.1 33.1 92.6 78.5 106.9v95.9L320 602.4V318.1c44.2-15 76-56.9 76-106.1 0-61.8-50.2-112-112-112s-112 50.2-112 112c0 49.2 31.8 91 76 106.1V706c-44.2 15-76 56.9-76 106.1 0 61.8 50.2 112 112 112s112-50.2 112-112c0-49.2-31.8-91-76-106.1v-27.8l423.5-138.7a50.52 50.52 0 0034.9-48.2V378.2c42.9-15.8 73.6-57 73.6-105.2 0-61.8-50.2-112-112-112zm-504 51a48.01 48.01 0 0196 0 48.01 48.01 0 01-96 0zm96 600a48.01 48.01 0 01-96 0 48.01 48.01 0 0196 0zm408-491a48.01 48.01 0 010-96 48.01 48.01 0 010 96z"}}]},name:"branches",theme:"outlined"},o=n(82350),a=function(t,e){return i.createElement(o.Z,(0,r.Z)({},t,{ref:e,icon:s}))};var l=i.forwardRef(a)},31097:function(t,e,n){"use strict";n.d(e,{Z:function(){return l}});var r=n(2053),i=n(50959),s={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M632 888H392c-4.4 0-8 3.6-8 8v32c0 17.7 14.3 32 32 32h192c17.7 0 32-14.3 32-32v-32c0-4.4-3.6-8-8-8zM512 64c-181.1 0-328 146.9-328 328 0 121.4 66 227.4 164 284.1V792c0 17.7 14.3 32 32 32h264c17.7 0 32-14.3 32-32V676.1c98-56.7 164-162.7 164-284.1 0-181.1-146.9-328-328-328zm127.9 549.8L604 634.6V752H420V634.6l-35.9-20.8C305.4 568.3 256 484.5 256 392c0-141.4 114.6-256 256-256s256 114.6 256 256c0 92.5-49.4 176.3-128.1 221.8z"}}]},name:"bulb",theme:"outlined"},o=n(82350),a=function(t,e){return i.createElement(o.Z,(0,r.Z)({},t,{ref:e,icon:s}))};var l=i.forwardRef(a)},25046:function(t,e,n){"use strict";n.d(e,{Z:function(){return l}});var r=n(2053),i=n(50959),s={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"defs",attrs:{},children:[{tag:"style",attrs:{}}]},{tag:"path",attrs:{d:"M899.1 869.6l-53-305.6H864c14.4 0 26-11.6 26-26V346c0-14.4-11.6-26-26-26H618V138c0-14.4-11.6-26-26-26H432c-14.4 0-26 11.6-26 26v182H160c-14.4 0-26 11.6-26 26v192c0 14.4 11.6 26 26 26h17.9l-53 305.6a25.95 25.95 0 0025.6 30.4h723c1.5 0 3-.1 4.4-.4a25.88 25.88 0 0021.2-30zM204 390h272V182h72v208h272v104H204V390zm468 440V674c0-4.4-3.6-8-8-8h-48c-4.4 0-8 3.6-8 8v156H416V674c0-4.4-3.6-8-8-8h-48c-4.4 0-8 3.6-8 8v156H202.8l45.1-260H776l45.1 260H672z"}}]},name:"clear",theme:"outlined"},o=n(82350),a=function(t,e){return i.createElement(o.Z,(0,r.Z)({},t,{ref:e,icon:s}))};var l=i.forwardRef(a)},59635:function(t,e,n){"use strict";n.d(e,{Z:function(){return l}});var r=n(2053),i=n(50959),s={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M518.3 459a8 8 0 00-12.6 0l-112 141.7a7.98 7.98 0 006.3 12.9h73.9V856c0 4.4 3.6 8 8 8h60c4.4 0 8-3.6 8-8V613.7H624c6.7 0 10.4-7.7 6.3-12.9L518.3 459z"}},{tag:"path",attrs:{d:"M811.4 366.7C765.6 245.9 648.9 160 512.2 160S258.8 245.8 213 366.6C127.3 389.1 64 467.2 64 560c0 110.5 89.5 200 199.9 200H304c4.4 0 8-3.6 8-8v-60c0-4.4-3.6-8-8-8h-40.1c-33.7 0-65.4-13.4-89-37.7-23.5-24.2-36-56.8-34.9-90.6.9-26.4 9.9-51.2 26.2-72.1 16.7-21.3 40.1-36.8 66.1-43.7l37.9-9.9 13.9-36.6c8.6-22.8 20.6-44.1 35.7-63.4a245.6 245.6 0 0152.4-49.9c41.1-28.9 89.5-44.2 140-44.2s98.9 15.3 140 44.2c19.9 14 37.5 30.8 52.4 49.9 15.1 19.3 27.1 40.7 35.7 63.4l13.8 36.5 37.8 10C846.1 454.5 884 503.8 884 560c0 33.1-12.9 64.3-36.3 87.7a123.07 123.07 0 01-87.6 36.3H720c-4.4 0-8 3.6-8 8v60c0 4.4 3.6 8 8 8h40.1C870.5 760 960 670.5 960 560c0-92.7-63.1-170.7-148.6-193.3z"}}]},name:"cloud-upload",theme:"outlined"},o=n(82350),a=function(t,e){return i.createElement(o.Z,(0,r.Z)({},t,{ref:e,icon:s}))};var l=i.forwardRef(a)},31931:function(t,e,n){"use strict";n.d(e,{Z:function(){return l}});var r=n(2053),i=n(50959),s={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M516 673c0 4.4 3.4 8 7.5 8h185c4.1 0 7.5-3.6 7.5-8v-48c0-4.4-3.4-8-7.5-8h-185c-4.1 0-7.5 3.6-7.5 8v48zm-194.9 6.1l192-161c3.8-3.2 3.8-9.1 0-12.3l-192-160.9A7.95 7.95 0 00308 351v62.7c0 2.4 1 4.6 2.9 6.1L420.7 512l-109.8 92.2a8.1 8.1 0 00-2.9 6.1V673c0 6.8 7.9 10.5 13.1 6.1zM880 112H144c-17.7 0-32 14.3-32 32v736c0 17.7 14.3 32 32 32h736c17.7 0 32-14.3 32-32V144c0-17.7-14.3-32-32-32zm-40 728H184V184h656v656z"}}]},name:"code",theme:"outlined"},o=n(82350),a=function(t,e){return i.createElement(o.Z,(0,r.Z)({},t,{ref:e,icon:s}))};var l=i.forwardRef(a)},56977:function(t,e,n){"use strict";n.d(e,{Z:function(){return l}});var r=n(2053),i=n(50959),s={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"defs",attrs:{},children:[{tag:"style",attrs:{}}]},{tag:"path",attrs:{d:"M651.1 641.9a7.84 7.84 0 00-5.1-1.9h-54.7c-2.4 0-4.6 1.1-6.1 2.9L512 730.7l-73.1-87.8a8.1 8.1 0 00-6.1-2.9H378c-1.9 0-3.7.7-5.1 1.9a7.97 7.97 0 00-1 11.3L474.2 776 371.8 898.9a8.06 8.06 0 006.1 13.2h54.7c2.4 0 4.6-1.1 6.1-2.9l73.1-87.8 73.1 87.8a8.1 8.1 0 006.1 2.9h55c1.9 0 3.7-.7 5.1-1.9 3.4-2.8 3.9-7.9 1-11.3L549.8 776l102.4-122.9c2.8-3.4 2.3-8.4-1.1-11.2zM472 544h80c4.4 0 8-3.6 8-8V120c0-4.4-3.6-8-8-8h-80c-4.4 0-8 3.6-8 8v416c0 4.4 3.6 8 8 8zM350 386H184V136c0-3.3-2.7-6-6-6h-60c-3.3 0-6 2.7-6 6v292c0 16.6 13.4 30 30 30h208c3.3 0 6-2.7 6-6v-60c0-3.3-2.7-6-6-6zm556-256h-60c-3.3 0-6 2.7-6 6v250H674c-3.3 0-6 2.7-6 6v60c0 3.3 2.7 6 6 6h208c16.6 0 30-13.4 30-30V136c0-3.3-2.7-6-6-6z"}}]},name:"delete-column",theme:"outlined"},o=n(82350),a=function(t,e){return i.createElement(o.Z,(0,r.Z)({},t,{ref:e,icon:s}))};var l=i.forwardRef(a)},13049:function(t,e,n){"use strict";n.d(e,{Z:function(){return l}});var r=n(2053),i=n(50959),s={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M888.3 693.2c-42.5-24.6-94.3-18-129.2 12.8l-53-30.7V523.6c0-15.7-8.4-30.3-22-38.1l-136-78.3v-67.1c44.2-15 76-56.8 76-106.1 0-61.9-50.1-112-112-112s-112 50.1-112 112c0 49.3 31.8 91.1 76 106.1v67.1l-136 78.3c-13.6 7.8-22 22.4-22 38.1v151.6l-53 30.7c-34.9-30.8-86.8-37.4-129.2-12.8-53.5 31-71.7 99.4-41 152.9 30.8 53.5 98.9 71.9 152.2 41 42.5-24.6 62.7-73 53.6-118.8l48.7-28.3 140.6 81c6.8 3.9 14.4 5.9 22 5.9s15.2-2 22-5.9L674.5 740l48.7 28.3c-9.1 45.7 11.2 94.2 53.6 118.8 53.3 30.9 121.5 12.6 152.2-41 30.8-53.6 12.6-122-40.7-152.9zm-673 138.4a47.6 47.6 0 01-65.2-17.6c-13.2-22.9-5.4-52.3 17.5-65.5a47.6 47.6 0 0165.2 17.6c13.2 22.9 5.4 52.3-17.5 65.5zM522 463.8zM464 234a48.01 48.01 0 0196 0 48.01 48.01 0 01-96 0zm170 446.2l-122 70.3-122-70.3V539.8l122-70.3 122 70.3v140.4zm239.9 133.9c-13.2 22.9-42.4 30.8-65.2 17.6-22.8-13.2-30.7-42.6-17.5-65.5s42.4-30.8 65.2-17.6c22.9 13.2 30.7 42.5 17.5 65.5z"}}]},name:"deployment-unit",theme:"outlined"},o=n(82350),a=function(t,e){return i.createElement(o.Z,(0,r.Z)({},t,{ref:e,icon:s}))};var l=i.forwardRef(a)},88766:function(t,e,n){"use strict";n.d(e,{Z:function(){return l}});var r=n(2053),i=n(50959),s={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M854.6 288.6L639.4 73.4c-6-6-14.1-9.4-22.6-9.4H192c-17.7 0-32 14.3-32 32v832c0 17.7 14.3 32 32 32h640c17.7 0 32-14.3 32-32V311.3c0-8.5-3.4-16.7-9.4-22.7zM790.2 326H602V137.8L790.2 326zm1.8 562H232V136h302v216a42 42 0 0042 42h216v494zM514.1 580.1l-61.8-102.4c-2.2-3.6-6.1-5.8-10.3-5.8h-38.4c-2.3 0-4.5.6-6.4 1.9-5.6 3.5-7.3 10.9-3.7 16.6l82.3 130.4-83.4 132.8a12.04 12.04 0 0010.2 18.4h34.5c4.2 0 8-2.2 10.2-5.7L510 664.8l62.3 101.4c2.2 3.6 6.1 5.7 10.2 5.7H620c2.3 0 4.5-.7 6.5-1.9 5.6-3.6 7.2-11 3.6-16.6l-84-130.4 85.3-132.5a12.04 12.04 0 00-10.1-18.5h-35.7c-4.2 0-8.1 2.2-10.3 5.8l-61.2 102.3z"}}]},name:"file-excel",theme:"outlined"},o=n(82350),a=function(t,e){return i.createElement(o.Z,(0,r.Z)({},t,{ref:e,icon:s}))};var l=i.forwardRef(a)},61448:function(t,e,n){"use strict";n.d(e,{Z:function(){return l}});var r=n(2053),i=n(50959),s={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M553.1 509.1l-77.8 99.2-41.1-52.4a8 8 0 00-12.6 0l-99.8 127.2a7.98 7.98 0 006.3 12.9H696c6.7 0 10.4-7.7 6.3-12.9l-136.5-174a8.1 8.1 0 00-12.7 0zM360 442a40 40 0 1080 0 40 40 0 10-80 0zm494.6-153.4L639.4 73.4c-6-6-14.1-9.4-22.6-9.4H192c-17.7 0-32 14.3-32 32v832c0 17.7 14.3 32 32 32h640c17.7 0 32-14.3 32-32V311.3c0-8.5-3.4-16.7-9.4-22.7zM790.2 326H602V137.8L790.2 326zm1.8 562H232V136h302v216a42 42 0 0042 42h216v494z"}}]},name:"file-image",theme:"outlined"},o=n(82350),a=function(t,e){return i.createElement(o.Z,(0,r.Z)({},t,{ref:e,icon:s}))};var l=i.forwardRef(a)},54666:function(t,e,n){"use strict";n.d(e,{Z:function(){return l}});var r=n(2053),i=n(50959),s={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M880 112H144c-17.7 0-32 14.3-32 32v736c0 17.7 14.3 32 32 32h736c17.7 0 32-14.3 32-32V144c0-17.7-14.3-32-32-32zm-696 72h136v656H184V184zm656 656H384V384h456v456zM384 320V184h456v136H384z"}}]},name:"layout",theme:"outlined"},o=n(82350),a=function(t,e){return i.createElement(o.Z,(0,r.Z)({},t,{ref:e,icon:s}))};var l=i.forwardRef(a)},33074:function(t,e,n){"use strict";n.d(e,{Z:function(){return l}});var r=n(2053),i=n(50959),s={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M574 665.4a8.03 8.03 0 00-11.3 0L446.5 781.6c-53.8 53.8-144.6 59.5-204 0-59.5-59.5-53.8-150.2 0-204l116.2-116.2c3.1-3.1 3.1-8.2 0-11.3l-39.8-39.8a8.03 8.03 0 00-11.3 0L191.4 526.5c-84.6 84.6-84.6 221.5 0 306s221.5 84.6 306 0l116.2-116.2c3.1-3.1 3.1-8.2 0-11.3L574 665.4zm258.6-474c-84.6-84.6-221.5-84.6-306 0L410.3 307.6a8.03 8.03 0 000 11.3l39.7 39.7c3.1 3.1 8.2 3.1 11.3 0l116.2-116.2c53.8-53.8 144.6-59.5 204 0 59.5 59.5 53.8 150.2 0 204L665.3 562.6a8.03 8.03 0 000 11.3l39.8 39.8c3.1 3.1 8.2 3.1 11.3 0l116.2-116.2c84.5-84.6 84.5-221.5 0-306.1zM610.1 372.3a8.03 8.03 0 00-11.3 0L372.3 598.7a8.03 8.03 0 000 11.3l39.6 39.6c3.1 3.1 8.2 3.1 11.3 0l226.4-226.4c3.1-3.1 3.1-8.2 0-11.3l-39.5-39.6z"}}]},name:"link",theme:"outlined"},o=n(82350),a=function(t,e){return i.createElement(o.Z,(0,r.Z)({},t,{ref:e,icon:s}))};var l=i.forwardRef(a)},29643:function(t,e,n){"use strict";n.d(e,{Z:function(){return l}});var r=n(2053),i=n(50959),s={icon:{tag:"svg",attrs:{viewBox:"0 0 1024 1024",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 1024c-69.1 0-136.2-13.5-199.3-40.2C251.7 958 197 921 150 874c-47-47-84-101.7-109.8-162.7C13.5 648.2 0 581.1 0 512c0-19.9 16.1-36 36-36s36 16.1 36 36c0 59.4 11.6 117 34.6 171.3 22.2 52.4 53.9 99.5 94.3 139.9 40.4 40.4 87.5 72.2 139.9 94.3C395 940.4 452.6 952 512 952c59.4 0 117-11.6 171.3-34.6 52.4-22.2 99.5-53.9 139.9-94.3 40.4-40.4 72.2-87.5 94.3-139.9C940.4 629 952 571.4 952 512c0-59.4-11.6-117-34.6-171.3a440.45 440.45 0 00-94.3-139.9 437.71 437.71 0 00-139.9-94.3C629 83.6 571.4 72 512 72c-19.9 0-36-16.1-36-36s16.1-36 36-36c69.1 0 136.2 13.5 199.3 40.2C772.3 66 827 103 874 150c47 47 83.9 101.8 109.7 162.7 26.7 63.1 40.2 130.2 40.2 199.3s-13.5 136.2-40.2 199.3C958 772.3 921 827 874 874c-47 47-101.8 83.9-162.7 109.7-63.1 26.8-130.2 40.3-199.3 40.3z"}}]},name:"loading-3-quarters",theme:"outlined"},o=n(82350),a=function(t,e){return i.createElement(o.Z,(0,r.Z)({},t,{ref:e,icon:s}))};var l=i.forwardRef(a)},73873:function(t,e,n){"use strict";n.d(e,{Z:function(){return l}});var r=n(2053),i=n(50959),s={icon:{tag:"svg",attrs:{"fill-rule":"evenodd",viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M248 752h72V264h-72z"}},{tag:"path",attrs:{d:"M740 863c61.86 0 112-50.14 112-112 0-48.33-30.6-89.5-73.5-105.2l-.01-113.04a50.73 50.73 0 00-34.95-48.2l-434.9-142.41-22.4 68.42 420.25 137.61.01 95.92C661 658.34 628 700.8 628 751c0 61.86 50.14 112 112 112m-456 61c61.86 0 112-50.14 112-112s-50.14-112-112-112-112 50.14-112 112 50.14 112 112 112m456-125a48 48 0 110-96 48 48 0 010 96m-456 61a48 48 0 110-96 48 48 0 010 96m0-536c61.86 0 112-50.14 112-112s-50.14-112-112-112-112 50.14-112 112 50.14 112 112 112m0-64a48 48 0 110-96 48 48 0 010 96"}}]},name:"merge",theme:"outlined"},o=n(82350),a=function(t,e){return i.createElement(o.Z,(0,r.Z)({},t,{ref:e,icon:s}))};var l=i.forwardRef(a)},28541:function(t,e,n){"use strict";n.d(e,{Z:function(){return l}});var r=n(2053),i=n(50959),s={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"}},{tag:"path",attrs:{d:"M719.4 499.1l-296.1-215A15.9 15.9 0 00398 297v430c0 13.1 14.8 20.5 25.3 12.9l296.1-215a15.9 15.9 0 000-25.8zm-257.6 134V390.9L628.5 512 461.8 633.1z"}}]},name:"play-circle",theme:"outlined"},o=n(82350),a=function(t,e){return i.createElement(o.Z,(0,r.Z)({},t,{ref:e,icon:s}))};var l=i.forwardRef(a)},84254:function(t,e,n){"use strict";n.d(e,{Z:function(){return l}});var r=n(2053),i=n(50959),s={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M878.3 392.1L631.9 145.7c-6.5-6.5-15-9.7-23.5-9.7s-17 3.2-23.5 9.7L423.8 306.9c-12.2-1.4-24.5-2-36.8-2-73.2 0-146.4 24.1-206.5 72.3a33.23 33.23 0 00-2.7 49.4l181.7 181.7-215.4 215.2a15.8 15.8 0 00-4.6 9.8l-3.4 37.2c-.9 9.4 6.6 17.4 15.9 17.4.5 0 1 0 1.5-.1l37.2-3.4c3.7-.3 7.2-2 9.8-4.6l215.4-215.4 181.7 181.7c6.5 6.5 15 9.7 23.5 9.7 9.7 0 19.3-4.2 25.9-12.4 56.3-70.3 79.7-158.3 70.2-243.4l161.1-161.1c12.9-12.8 12.9-33.8 0-46.8zM666.2 549.3l-24.5 24.5 3.8 34.4a259.92 259.92 0 01-30.4 153.9L262 408.8c12.9-7.1 26.3-13.1 40.3-17.9 27.2-9.4 55.7-14.1 84.7-14.1 9.6 0 19.3.5 28.9 1.6l34.4 3.8 24.5-24.5L608.5 224 800 415.5 666.2 549.3z"}}]},name:"pushpin",theme:"outlined"},o=n(82350),a=function(t,e){return i.createElement(o.Z,(0,r.Z)({},t,{ref:e,icon:s}))};var l=i.forwardRef(a)},67492:function(t,e,n){"use strict";n.d(e,{Z:function(){return l}});var r=n(2053),i=n(50959),s={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M893.3 293.3L730.7 130.7c-7.5-7.5-16.7-13-26.7-16V112H144c-17.7 0-32 14.3-32 32v736c0 17.7 14.3 32 32 32h736c17.7 0 32-14.3 32-32V338.5c0-17-6.7-33.2-18.7-45.2zM384 184h256v104H384V184zm456 656H184V184h136v136c0 17.7 14.3 32 32 32h320c17.7 0 32-14.3 32-32V205.8l136 136V840zM512 442c-79.5 0-144 64.5-144 144s64.5 144 144 144 144-64.5 144-144-64.5-144-144-144zm0 224c-44.2 0-80-35.8-80-80s35.8-80 80-80 80 35.8 80 80-35.8 80-80 80z"}}]},name:"save",theme:"outlined"},o=n(82350),a=function(t,e){return i.createElement(o.Z,(0,r.Z)({},t,{ref:e,icon:s}))};var l=i.forwardRef(a)},96118:function(t,e,n){"use strict";n.d(e,{Z:function(){return l}});var r=n(2053),i=n(50959),s={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M928 224H768v-56c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v56H548v-56c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v56H328v-56c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v56H96c-17.7 0-32 14.3-32 32v576c0 17.7 14.3 32 32 32h832c17.7 0 32-14.3 32-32V256c0-17.7-14.3-32-32-32zm-40 568H136V296h120v56c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8v-56h148v56c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8v-56h148v56c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8v-56h120v496zM416 496H232c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8h184c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8zm0 136H232c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8h184c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8zm308.2-177.4L620.6 598.3l-52.8-73.1c-3-4.2-7.8-6.6-12.9-6.6H500c-6.5 0-10.3 7.4-6.5 12.7l114.1 158.2a15.9 15.9 0 0025.8 0l165-228.7c3.8-5.3 0-12.7-6.5-12.7H737c-5-.1-9.8 2.4-12.8 6.5z"}}]},name:"schedule",theme:"outlined"},o=n(82350),a=function(t,e){return i.createElement(o.Z,(0,r.Z)({},t,{ref:e,icon:s}))};var l=i.forwardRef(a)},63432:function(t,e,n){"use strict";n.d(e,{Z:function(){return l}});var r=n(2053),i=n(50959),s={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M924.8 625.7l-65.5-56c3.1-19 4.7-38.4 4.7-57.8s-1.6-38.8-4.7-57.8l65.5-56a32.03 32.03 0 009.3-35.2l-.9-2.6a443.74 443.74 0 00-79.7-137.9l-1.8-2.1a32.12 32.12 0 00-35.1-9.5l-81.3 28.9c-30-24.6-63.5-44-99.7-57.6l-15.7-85a32.05 32.05 0 00-25.8-25.7l-2.7-.5c-52.1-9.4-106.9-9.4-159 0l-2.7.5a32.05 32.05 0 00-25.8 25.7l-15.8 85.4a351.86 351.86 0 00-99 57.4l-81.9-29.1a32 32 0 00-35.1 9.5l-1.8 2.1a446.02 446.02 0 00-79.7 137.9l-.9 2.6c-4.5 12.5-.8 26.5 9.3 35.2l66.3 56.6c-3.1 18.8-4.6 38-4.6 57.1 0 19.2 1.5 38.4 4.6 57.1L99 625.5a32.03 32.03 0 00-9.3 35.2l.9 2.6c18.1 50.4 44.9 96.9 79.7 137.9l1.8 2.1a32.12 32.12 0 0035.1 9.5l81.9-29.1c29.8 24.5 63.1 43.9 99 57.4l15.8 85.4a32.05 32.05 0 0025.8 25.7l2.7.5a449.4 449.4 0 00159 0l2.7-.5a32.05 32.05 0 0025.8-25.7l15.7-85a350 350 0 0099.7-57.6l81.3 28.9a32 32 0 0035.1-9.5l1.8-2.1c34.8-41.1 61.6-87.5 79.7-137.9l.9-2.6c4.5-12.3.8-26.3-9.3-35zM788.3 465.9c2.5 15.1 3.8 30.6 3.8 46.1s-1.3 31-3.8 46.1l-6.6 40.1 74.7 63.9a370.03 370.03 0 01-42.6 73.6L721 702.8l-31.4 25.8c-23.9 19.6-50.5 35-79.3 45.8l-38.1 14.3-17.9 97a377.5 377.5 0 01-85 0l-17.9-97.2-37.8-14.5c-28.5-10.8-55-26.2-78.7-45.7l-31.4-25.9-93.4 33.2c-17-22.9-31.2-47.6-42.6-73.6l75.5-64.5-6.5-40c-2.4-14.9-3.7-30.3-3.7-45.5 0-15.3 1.2-30.6 3.7-45.5l6.5-40-75.5-64.5c11.3-26.1 25.6-50.7 42.6-73.6l93.4 33.2 31.4-25.9c23.7-19.5 50.2-34.9 78.7-45.7l37.9-14.3 17.9-97.2c28.1-3.2 56.8-3.2 85 0l17.9 97 38.1 14.3c28.7 10.8 55.4 26.2 79.3 45.8l31.4 25.8 92.8-32.9c17 22.9 31.2 47.6 42.6 73.6L781.8 426l6.5 39.9zM512 326c-97.2 0-176 78.8-176 176s78.8 176 176 176 176-78.8 176-176-78.8-176-176-176zm79.2 255.2A111.6 111.6 0 01512 614c-29.9 0-58-11.7-79.2-32.8A111.6 111.6 0 01400 502c0-29.9 11.7-58 32.8-79.2C454 401.6 482.1 390 512 390c29.9 0 58 11.6 79.2 32.8A111.6 111.6 0 01624 502c0 29.9-11.7 58-32.8 79.2z"}}]},name:"setting",theme:"outlined"},o=n(82350),a=function(t,e){return i.createElement(o.Z,(0,r.Z)({},t,{ref:e,icon:s}))};var l=i.forwardRef(a)},42176:function(t,e,n){"use strict";n.d(e,{Z:function(){return l}});var r=n(2053),i=n(50959),s={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M752 664c-28.5 0-54.8 10-75.4 26.7L469.4 540.8a160.68 160.68 0 000-57.6l207.2-149.9C697.2 350 723.5 360 752 360c66.2 0 120-53.8 120-120s-53.8-120-120-120-120 53.8-120 120c0 11.6 1.6 22.7 4.7 33.3L439.9 415.8C410.7 377.1 364.3 352 312 352c-88.4 0-160 71.6-160 160s71.6 160 160 160c52.3 0 98.7-25.1 127.9-63.8l196.8 142.5c-3.1 10.6-4.7 21.8-4.7 33.3 0 66.2 53.8 120 120 120s120-53.8 120-120-53.8-120-120-120zm0-476c28.7 0 52 23.3 52 52s-23.3 52-52 52-52-23.3-52-52 23.3-52 52-52zM312 600c-48.5 0-88-39.5-88-88s39.5-88 88-88 88 39.5 88 88-39.5 88-88 88zm440 236c-28.7 0-52-23.3-52-52s23.3-52 52-52 52 23.3 52 52-23.3 52-52 52z"}}]},name:"share-alt",theme:"outlined"},o=n(82350),a=function(t,e){return i.createElement(o.Z,(0,r.Z)({},t,{ref:e,icon:s}))};var l=i.forwardRef(a)},57591:function(t,e,n){"use strict";n.d(e,{Z:function(){return l}});var r=n(2053),i=n(50959),s={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M928 160H96c-17.7 0-32 14.3-32 32v640c0 17.7 14.3 32 32 32h832c17.7 0 32-14.3 32-32V192c0-17.7-14.3-32-32-32zm-40 208H676V232h212v136zm0 224H676V432h212v160zM412 432h200v160H412V432zm200-64H412V232h200v136zm-476 64h212v160H136V432zm0-200h212v136H136V232zm0 424h212v136H136V656zm276 0h200v136H412V656zm476 136H676V656h212v136z"}}]},name:"table",theme:"outlined"},o=n(82350),a=function(t,e){return i.createElement(o.Z,(0,r.Z)({},t,{ref:e,icon:s}))};var l=i.forwardRef(a)},89543:function(t,e,n){"use strict";n.d(e,{Z:function(){return l}});var r=n(2053),i=n(50959),s={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M400 317.7h73.9V656c0 4.4 3.6 8 8 8h60c4.4 0 8-3.6 8-8V317.7H624c6.7 0 10.4-7.7 6.3-12.9L518.3 163a8 8 0 00-12.6 0l-112 141.7c-4.1 5.3-.4 13 6.3 13zM878 626h-60c-4.4 0-8 3.6-8 8v154H214V634c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v198c0 17.7 14.3 32 32 32h684c17.7 0 32-14.3 32-32V634c0-4.4-3.6-8-8-8z"}}]},name:"upload",theme:"outlined"},o=n(82350),a=function(t,e){return i.createElement(o.Z,(0,r.Z)({},t,{ref:e,icon:s}))};var l=i.forwardRef(a)},75377:function(t,e,n){"use strict";n.d(e,{Z:function(){return l}});var r=n(2053),i=n(50959),s={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M464 720a48 48 0 1096 0 48 48 0 10-96 0zm16-304v184c0 4.4 3.6 8 8 8h48c4.4 0 8-3.6 8-8V416c0-4.4-3.6-8-8-8h-48c-4.4 0-8 3.6-8 8zm475.7 440l-416-720c-6.2-10.7-16.9-16-27.7-16s-21.6 5.3-27.7 16l-416 720C56 877.4 71.4 904 96 904h832c24.6 0 40-26.6 27.7-48zm-783.5-27.9L512 239.9l339.8 588.2H172.2z"}}]},name:"warning",theme:"outlined"},o=n(82350),a=function(t,e){return i.createElement(o.Z,(0,r.Z)({},t,{ref:e,icon:s}))};var l=i.forwardRef(a)},6724:function(t,e,n){t.exports={graphlib:n(68509),layout:n(13104),debug:n(36939),util:{time:n(92304).time,notime:n(92304).notime},version:n(90975)}},93143:function(t,e,n){"use strict";var r=n(8217),i=n(23742);t.exports={run:function(t){var e="greedy"===t.graph().acyclicer?i(t,function(t){return function(e){return t.edge(e).weight}}(t)):function(t){var e=[],n={},i={};function s(o){r.has(i,o)||(i[o]=!0,n[o]=!0,r.forEach(t.outEdges(o),(function(t){r.has(n,t.w)?e.push(t):s(t.w)})),delete n[o])}return r.forEach(t.nodes(),s),e}(t);r.forEach(e,(function(e){var n=t.edge(e);t.removeEdge(e),n.forwardName=e.name,n.reversed=!0,t.setEdge(e.w,e.v,n,r.uniqueId("rev"))}))},undo:function(t){r.forEach(t.edges(),(function(e){var n=t.edge(e);if(n.reversed){t.removeEdge(e);var r=n.forwardName;delete n.reversed,delete n.forwardName,t.setEdge(e.w,e.v,n,r)}}))}}},24186:function(t,e,n){var r=n(8217),i=n(92304);function s(t,e,n,r,s,o){var a={width:0,height:0,rank:o,borderType:e},l=s[e][o-1],u=i.addDummyNode(t,"border",a,n);s[e][o]=u,t.setParent(u,r),l&&t.setEdge(l,u,{weight:1})}t.exports=function(t){r.forEach(t.children(),(function e(n){var i=t.children(n),o=t.node(n);if(i.length&&r.forEach(i,e),r.has(o,"minRank")){o.borderLeft=[],o.borderRight=[];for(var a=o.minRank,l=o.maxRank+1;a<l;++a)s(t,"borderLeft","_bl",n,o,a),s(t,"borderRight","_br",n,o,a)}}))}},83032:function(t,e,n){"use strict";var r=n(8217);function i(t){r.forEach(t.nodes(),(function(e){s(t.node(e))})),r.forEach(t.edges(),(function(e){s(t.edge(e))}))}function s(t){var e=t.width;t.width=t.height,t.height=e}function o(t){t.y=-t.y}function a(t){var e=t.x;t.x=t.y,t.y=e}t.exports={adjust:function(t){var e=t.graph().rankdir.toLowerCase();"lr"!==e&&"rl"!==e||i(t)},undo:function(t){var e=t.graph().rankdir.toLowerCase();"bt"!==e&&"rl"!==e||function(t){r.forEach(t.nodes(),(function(e){o(t.node(e))})),r.forEach(t.edges(),(function(e){var n=t.edge(e);r.forEach(n.points,o),r.has(n,"y")&&o(n)}))}(t);"lr"!==e&&"rl"!==e||(!function(t){r.forEach(t.nodes(),(function(e){a(t.node(e))})),r.forEach(t.edges(),(function(e){var n=t.edge(e);r.forEach(n.points,a),r.has(n,"x")&&a(n)}))}(t),i(t))}}},40094:function(t){function e(){var t={};t._next=t._prev=t,this._sentinel=t}function n(t){t._prev._next=t._next,t._next._prev=t._prev,delete t._next,delete t._prev}function r(t,e){if("_next"!==t&&"_prev"!==t)return e}t.exports=e,e.prototype.dequeue=function(){var t=this._sentinel,e=t._prev;if(e!==t)return n(e),e},e.prototype.enqueue=function(t){var e=this._sentinel;t._prev&&t._next&&n(t),t._next=e._next,e._next._prev=t,e._next=t,t._prev=e},e.prototype.toString=function(){for(var t=[],e=this._sentinel,n=e._prev;n!==e;)t.push(JSON.stringify(n,r)),n=n._prev;return"["+t.join(", ")+"]"}},36939:function(t,e,n){var r=n(8217),i=n(92304),s=n(68509).Graph;t.exports={debugOrdering:function(t){var e=i.buildLayerMatrix(t),n=new s({compound:!0,multigraph:!0}).setGraph({});return r.forEach(t.nodes(),(function(e){n.setNode(e,{label:e}),n.setParent(e,"layer"+t.node(e).rank)})),r.forEach(t.edges(),(function(t){n.setEdge(t.v,t.w,{},t.name)})),r.forEach(e,(function(t,e){var i="layer"+e;n.setNode(i,{rank:"same"}),r.reduce(t,(function(t,e){return n.setEdge(t,e,{style:"invis"}),e}))})),n}}},68509:function(t,e,n){var r;try{r=n(16239)}catch(t){}r||(r=window.graphlib),t.exports=r},23742:function(t,e,n){var r=n(8217),i=n(68509).Graph,s=n(40094);t.exports=function(t,e){if(t.nodeCount()<=1)return[];var n=function(t,e){var n=new i,o=0,a=0;r.forEach(t.nodes(),(function(t){n.setNode(t,{v:t,in:0,out:0})})),r.forEach(t.edges(),(function(t){var r=n.edge(t.v,t.w)||0,i=e(t),s=r+i;n.setEdge(t.v,t.w,s),a=Math.max(a,n.node(t.v).out+=i),o=Math.max(o,n.node(t.w).in+=i)}));var u=r.range(a+o+3).map((function(){return new s})),c=o+1;return r.forEach(n.nodes(),(function(t){l(u,c,n.node(t))})),{graph:n,buckets:u,zeroIdx:c}}(t,e||o),u=function(t,e,n){var r,i=[],s=e[e.length-1],o=e[0];for(;t.nodeCount();){for(;r=o.dequeue();)a(t,e,n,r);for(;r=s.dequeue();)a(t,e,n,r);if(t.nodeCount())for(var l=e.length-2;l>0;--l)if(r=e[l].dequeue()){i=i.concat(a(t,e,n,r,!0));break}}return i}(n.graph,n.buckets,n.zeroIdx);return r.flatten(r.map(u,(function(e){return t.outEdges(e.v,e.w)})),!0)};var o=r.constant(1);function a(t,e,n,i,s){var o=s?[]:void 0;return r.forEach(t.inEdges(i.v),(function(r){var i=t.edge(r),a=t.node(r.v);s&&o.push({v:r.v,w:r.w}),a.out-=i,l(e,n,a)})),r.forEach(t.outEdges(i.v),(function(r){var i=t.edge(r),s=r.w,o=t.node(s);o.in-=i,l(e,n,o)})),t.removeNode(i.v),o}function l(t,e,n){n.out?n.in?t[n.out-n.in+e].enqueue(n):t[t.length-1].enqueue(n):t[0].enqueue(n)}},13104:function(t,e,n){"use strict";var r=n(8217),i=n(93143),s=n(67099),o=n(65511),a=n(92304).normalizeRanks,l=n(24685),u=n(92304).removeEmptyRanks,c=n(59832),h=n(24186),d=n(83032),p=n(89717),f=n(63363),m=n(92304),g=n(68509).Graph;t.exports=function(t,e){var n=e&&e.debugTiming?m.time:m.notime;n("layout",(function(){var e=n("  buildLayoutGraph",(function(){return function(t){var e=new g({multigraph:!0,compound:!0}),n=T(t.graph());return e.setGraph(r.merge({},y,E(n,v),r.pick(n,_))),r.forEach(t.nodes(),(function(n){var i=T(t.node(n));e.setNode(n,r.defaults(E(i,x),b)),e.setParent(n,t.parent(n))})),r.forEach(t.edges(),(function(n){var i=T(t.edge(n));e.setEdge(n,r.merge({},S,E(i,w),r.pick(i,M)))})),e}(t)}));n("  runLayout",(function(){!function(t,e){e("    makeSpaceForEdgeLabels",(function(){!function(t){var e=t.graph();e.ranksep/=2,r.forEach(t.edges(),(function(n){var r=t.edge(n);r.minlen*=2,"c"!==r.labelpos.toLowerCase()&&("TB"===e.rankdir||"BT"===e.rankdir?r.width+=r.labeloffset:r.height+=r.labeloffset)}))}(t)})),e("    removeSelfEdges",(function(){!function(t){r.forEach(t.edges(),(function(e){if(e.v===e.w){var n=t.node(e.v);n.selfEdges||(n.selfEdges=[]),n.selfEdges.push({e:e,label:t.edge(e)}),t.removeEdge(e)}}))}(t)})),e("    acyclic",(function(){i.run(t)})),e("    nestingGraph.run",(function(){c.run(t)})),e("    rank",(function(){o(m.asNonCompoundGraph(t))})),e("    injectEdgeLabelProxies",(function(){!function(t){r.forEach(t.edges(),(function(e){var n=t.edge(e);if(n.width&&n.height){var r=t.node(e.v),i={rank:(t.node(e.w).rank-r.rank)/2+r.rank,e:e};m.addDummyNode(t,"edge-proxy",i,"_ep")}}))}(t)})),e("    removeEmptyRanks",(function(){u(t)})),e("    nestingGraph.cleanup",(function(){c.cleanup(t)})),e("    normalizeRanks",(function(){a(t)})),e("    assignRankMinMax",(function(){!function(t){var e=0;r.forEach(t.nodes(),(function(n){var i=t.node(n);i.borderTop&&(i.minRank=t.node(i.borderTop).rank,i.maxRank=t.node(i.borderBottom).rank,e=r.max(e,i.maxRank))})),t.graph().maxRank=e}(t)})),e("    removeEdgeLabelProxies",(function(){!function(t){r.forEach(t.nodes(),(function(e){var n=t.node(e);"edge-proxy"===n.dummy&&(t.edge(n.e).labelRank=n.rank,t.removeNode(e))}))}(t)})),e("    normalize.run",(function(){s.run(t)})),e("    parentDummyChains",(function(){l(t)})),e("    addBorderSegments",(function(){h(t)})),e("    order",(function(){p(t)})),e("    insertSelfEdges",(function(){!function(t){var e=m.buildLayerMatrix(t);r.forEach(e,(function(e){var n=0;r.forEach(e,(function(e,i){var s=t.node(e);s.order=i+n,r.forEach(s.selfEdges,(function(e){m.addDummyNode(t,"selfedge",{width:e.label.width,height:e.label.height,rank:s.rank,order:i+ ++n,e:e.e,label:e.label},"_se")})),delete s.selfEdges}))}))}(t)})),e("    adjustCoordinateSystem",(function(){d.adjust(t)})),e("    position",(function(){f(t)})),e("    positionSelfEdges",(function(){!function(t){r.forEach(t.nodes(),(function(e){var n=t.node(e);if("selfedge"===n.dummy){var r=t.node(n.e.v),i=r.x+r.width/2,s=r.y,o=n.x-i,a=r.height/2;t.setEdge(n.e,n.label),t.removeNode(e),n.label.points=[{x:i+2*o/3,y:s-a},{x:i+5*o/6,y:s-a},{x:i+o,y:s},{x:i+5*o/6,y:s+a},{x:i+2*o/3,y:s+a}],n.label.x=n.x,n.label.y=n.y}}))}(t)})),e("    removeBorderNodes",(function(){!function(t){r.forEach(t.nodes(),(function(e){if(t.children(e).length){var n=t.node(e),i=t.node(n.borderTop),s=t.node(n.borderBottom),o=t.node(r.last(n.borderLeft)),a=t.node(r.last(n.borderRight));n.width=Math.abs(a.x-o.x),n.height=Math.abs(s.y-i.y),n.x=o.x+n.width/2,n.y=i.y+n.height/2}})),r.forEach(t.nodes(),(function(e){"border"===t.node(e).dummy&&t.removeNode(e)}))}(t)})),e("    normalize.undo",(function(){s.undo(t)})),e("    fixupEdgeLabelCoords",(function(){!function(t){r.forEach(t.edges(),(function(e){var n=t.edge(e);if(r.has(n,"x"))switch("l"!==n.labelpos&&"r"!==n.labelpos||(n.width-=n.labeloffset),n.labelpos){case"l":n.x-=n.width/2+n.labeloffset;break;case"r":n.x+=n.width/2+n.labeloffset}}))}(t)})),e("    undoCoordinateSystem",(function(){d.undo(t)})),e("    translateGraph",(function(){!function(t){var e=Number.POSITIVE_INFINITY,n=0,i=Number.POSITIVE_INFINITY,s=0,o=t.graph(),a=o.marginx||0,l=o.marginy||0;function u(t){var r=t.x,o=t.y,a=t.width,l=t.height;e=Math.min(e,r-a/2),n=Math.max(n,r+a/2),i=Math.min(i,o-l/2),s=Math.max(s,o+l/2)}r.forEach(t.nodes(),(function(e){u(t.node(e))})),r.forEach(t.edges(),(function(e){var n=t.edge(e);r.has(n,"x")&&u(n)})),e-=a,i-=l,r.forEach(t.nodes(),(function(n){var r=t.node(n);r.x-=e,r.y-=i})),r.forEach(t.edges(),(function(n){var s=t.edge(n);r.forEach(s.points,(function(t){t.x-=e,t.y-=i})),r.has(s,"x")&&(s.x-=e),r.has(s,"y")&&(s.y-=i)})),o.width=n-e+a,o.height=s-i+l}(t)})),e("    assignNodeIntersects",(function(){!function(t){r.forEach(t.edges(),(function(e){var n,r,i=t.edge(e),s=t.node(e.v),o=t.node(e.w);i.points?(n=i.points[0],r=i.points[i.points.length-1]):(i.points=[],n=o,r=s),i.points.unshift(m.intersectRect(s,n)),i.points.push(m.intersectRect(o,r))}))}(t)})),e("    reversePoints",(function(){!function(t){r.forEach(t.edges(),(function(e){var n=t.edge(e);n.reversed&&n.points.reverse()}))}(t)})),e("    acyclic.undo",(function(){i.undo(t)}))}(e,n)})),n("  updateInputGraph",(function(){!function(t,e){r.forEach(t.nodes(),(function(n){var r=t.node(n),i=e.node(n);r&&(r.x=i.x,r.y=i.y,e.children(n).length&&(r.width=i.width,r.height=i.height))})),r.forEach(t.edges(),(function(n){var i=t.edge(n),s=e.edge(n);i.points=s.points,r.has(s,"x")&&(i.x=s.x,i.y=s.y)})),t.graph().width=e.graph().width,t.graph().height=e.graph().height}(t,e)}))}))};var v=["nodesep","edgesep","ranksep","marginx","marginy"],y={ranksep:50,edgesep:20,nodesep:50,rankdir:"tb"},_=["acyclicer","ranker","rankdir","align"],x=["width","height"],b={width:0,height:0},w=["minlen","weight","width","height","labeloffset"],S={minlen:1,weight:1,width:0,height:0,labeloffset:10,labelpos:"r"},M=["labelpos"];function E(t,e){return r.mapValues(r.pick(t,e),Number)}function T(t){var e={};return r.forEach(t,(function(t,n){e[n.toLowerCase()]=t})),e}},8217:function(t,e,n){var r;try{r={cloneDeep:n(32222),constant:n(64806),defaults:n(91099),each:n(15828),filter:n(3149),find:n(33170),flatten:n(22612),forEach:n(17489),forIn:n(37229),has:n(56611),isUndefined:n(89300),last:n(25674),map:n(65512),mapValues:n(65632),max:n(80212),merge:n(67929),min:n(71516),minBy:n(88371),now:n(76668),pick:n(19334),range:n(61178),reduce:n(6355),sortBy:n(84715),uniqueId:n(53274),values:n(61017),zipObject:n(64058)}}catch(t){}r||(r=window._),t.exports=r},59832:function(t,e,n){var r=n(8217),i=n(92304);function s(t,e,n,o,a,l,u){var c=t.children(u);if(c.length){var h=i.addBorderNode(t,"_bt"),d=i.addBorderNode(t,"_bb"),p=t.node(u);t.setParent(h,u),p.borderTop=h,t.setParent(d,u),p.borderBottom=d,r.forEach(c,(function(r){s(t,e,n,o,a,l,r);var i=t.node(r),c=i.borderTop?i.borderTop:r,p=i.borderBottom?i.borderBottom:r,f=i.borderTop?o:2*o,m=c!==p?1:a-l[u]+1;t.setEdge(h,c,{weight:f,minlen:m,nestingEdge:!0}),t.setEdge(p,d,{weight:f,minlen:m,nestingEdge:!0})})),t.parent(u)||t.setEdge(e,h,{weight:0,minlen:a+l[u]})}else u!==e&&t.setEdge(e,u,{weight:0,minlen:n})}t.exports={run:function(t){var e=i.addDummyNode(t,"root",{},"_root"),n=function(t){var e={};function n(i,s){var o=t.children(i);o&&o.length&&r.forEach(o,(function(t){n(t,s+1)})),e[i]=s}return r.forEach(t.children(),(function(t){n(t,1)})),e}(t),o=r.max(r.values(n))-1,a=2*o+1;t.graph().nestingRoot=e,r.forEach(t.edges(),(function(e){t.edge(e).minlen*=a}));var l=function(t){return r.reduce(t.edges(),(function(e,n){return e+t.edge(n).weight}),0)}(t)+1;r.forEach(t.children(),(function(r){s(t,e,a,l,o,n,r)})),t.graph().nodeRankFactor=a},cleanup:function(t){var e=t.graph();t.removeNode(e.nestingRoot),delete e.nestingRoot,r.forEach(t.edges(),(function(e){t.edge(e).nestingEdge&&t.removeEdge(e)}))}}},67099:function(t,e,n){"use strict";var r=n(8217),i=n(92304);t.exports={run:function(t){t.graph().dummyChains=[],r.forEach(t.edges(),(function(e){!function(t,e){var n,r,s,o=e.v,a=t.node(o).rank,l=e.w,u=t.node(l).rank,c=e.name,h=t.edge(e),d=h.labelRank;if(u===a+1)return;for(t.removeEdge(e),s=0,++a;a<u;++s,++a)h.points=[],r={width:0,height:0,edgeLabel:h,edgeObj:e,rank:a},n=i.addDummyNode(t,"edge",r,"_d"),a===d&&(r.width=h.width,r.height=h.height,r.dummy="edge-label",r.labelpos=h.labelpos),t.setEdge(o,n,{weight:h.weight},c),0===s&&t.graph().dummyChains.push(n),o=n;t.setEdge(o,l,{weight:h.weight},c)}(t,e)}))},undo:function(t){r.forEach(t.graph().dummyChains,(function(e){var n,r=t.node(e),i=r.edgeLabel;for(t.setEdge(r.edgeObj,i);r.dummy;)n=t.successors(e)[0],t.removeNode(e),i.points.push({x:r.x,y:r.y}),"edge-label"===r.dummy&&(i.x=r.x,i.y=r.y,i.width=r.width,i.height=r.height),e=n,r=t.node(e)}))}}},72952:function(t,e,n){var r=n(8217);t.exports=function(t,e,n){var i,s={};r.forEach(n,(function(n){for(var r,o,a=t.parent(n);a;){if((r=t.parent(a))?(o=s[r],s[r]=a):(o=i,i=a),o&&o!==a)return void e.setEdge(o,a);a=r}}))}},22207:function(t,e,n){var r=n(8217);t.exports=function(t,e){return r.map(e,(function(e){var n=t.inEdges(e);if(n.length){var i=r.reduce(n,(function(e,n){var r=t.edge(n),i=t.node(n.v);return{sum:e.sum+r.weight*i.order,weight:e.weight+r.weight}}),{sum:0,weight:0});return{v:e,barycenter:i.sum/i.weight,weight:i.weight}}return{v:e}}))}},9643:function(t,e,n){var r=n(8217),i=n(68509).Graph;t.exports=function(t,e,n){var s=function(t){var e;for(;t.hasNode(e=r.uniqueId("_root")););return e}(t),o=new i({compound:!0}).setGraph({root:s}).setDefaultNodeLabel((function(e){return t.node(e)}));return r.forEach(t.nodes(),(function(i){var a=t.node(i),l=t.parent(i);(a.rank===e||a.minRank<=e&&e<=a.maxRank)&&(o.setNode(i),o.setParent(i,l||s),r.forEach(t[n](i),(function(e){var n=e.v===i?e.w:e.v,s=o.edge(n,i),a=r.isUndefined(s)?0:s.weight;o.setEdge(n,i,{weight:t.edge(e).weight+a})})),r.has(a,"minRank")&&o.setNode(i,{borderLeft:a.borderLeft[e],borderRight:a.borderRight[e]}))})),o}},51094:function(t,e,n){"use strict";var r=n(8217);function i(t,e,n){for(var i=r.zipObject(n,r.map(n,(function(t,e){return e}))),s=r.flatten(r.map(e,(function(e){return r.sortBy(r.map(t.outEdges(e),(function(e){return{pos:i[e.w],weight:t.edge(e).weight}})),"pos")})),!0),o=1;o<n.length;)o<<=1;var a=2*o-1;o-=1;var l=r.map(new Array(a),(function(){return 0})),u=0;return r.forEach(s.forEach((function(t){var e=t.pos+o;l[e]+=t.weight;for(var n=0;e>0;)e%2&&(n+=l[e+1]),l[e=e-1>>1]+=t.weight;u+=t.weight*n}))),u}t.exports=function(t,e){for(var n=0,r=1;r<e.length;++r)n+=i(t,e[r-1],e[r]);return n}},89717:function(t,e,n){"use strict";var r=n(8217),i=n(89853),s=n(51094),o=n(66675),a=n(9643),l=n(72952),u=n(68509).Graph,c=n(92304);function h(t,e,n){return r.map(e,(function(e){return a(t,e,n)}))}function d(t,e){var n=new u;r.forEach(t,(function(t){var i=t.graph().root,s=o(t,i,n,e);r.forEach(s.vs,(function(e,n){t.node(e).order=n})),l(t,n,s.vs)}))}function p(t,e){r.forEach(e,(function(e){r.forEach(e,(function(e,n){t.node(e).order=n}))}))}t.exports=function(t){var e=c.maxRank(t),n=h(t,r.range(1,e+1),"inEdges"),o=h(t,r.range(e-1,-1,-1),"outEdges"),a=i(t);p(t,a);for(var l,u=Number.POSITIVE_INFINITY,f=0,m=0;m<4;++f,++m){d(f%2?n:o,f%4>=2),a=c.buildLayerMatrix(t);var g=s(t,a);g<u&&(m=0,l=r.cloneDeep(a),u=g)}p(t,l)}},89853:function(t,e,n){"use strict";var r=n(8217);t.exports=function(t){var e={},n=r.filter(t.nodes(),(function(e){return!t.children(e).length})),i=r.max(r.map(n,(function(e){return t.node(e).rank}))),s=r.map(r.range(i+1),(function(){return[]}));var o=r.sortBy(n,(function(e){return t.node(e).rank}));return r.forEach(o,(function n(i){if(r.has(e,i))return;e[i]=!0;var o=t.node(i);s[o.rank].push(i),r.forEach(t.successors(i),n)})),s}},5171:function(t,e,n){"use strict";var r=n(8217);t.exports=function(t,e){var n={};return r.forEach(t,(function(t,e){var i=n[t.v]={indegree:0,in:[],out:[],vs:[t.v],i:e};r.isUndefined(t.barycenter)||(i.barycenter=t.barycenter,i.weight=t.weight)})),r.forEach(e.edges(),(function(t){var e=n[t.v],i=n[t.w];r.isUndefined(e)||r.isUndefined(i)||(i.indegree++,e.out.push(n[t.w]))})),function(t){var e=[];function n(t){return function(e){e.merged||(r.isUndefined(e.barycenter)||r.isUndefined(t.barycenter)||e.barycenter>=t.barycenter)&&function(t,e){var n=0,r=0;t.weight&&(n+=t.barycenter*t.weight,r+=t.weight);e.weight&&(n+=e.barycenter*e.weight,r+=e.weight);t.vs=e.vs.concat(t.vs),t.barycenter=n/r,t.weight=r,t.i=Math.min(e.i,t.i),e.merged=!0}(t,e)}}function i(e){return function(n){n.in.push(e),0==--n.indegree&&t.push(n)}}for(;t.length;){var s=t.pop();e.push(s),r.forEach(s.in.reverse(),n(s)),r.forEach(s.out,i(s))}return r.map(r.filter(e,(function(t){return!t.merged})),(function(t){return r.pick(t,["vs","i","barycenter","weight"])}))}(r.filter(n,(function(t){return!t.indegree})))}},66675:function(t,e,n){var r=n(8217),i=n(22207),s=n(5171),o=n(45737);t.exports=function t(e,n,a,l){var u=e.children(n),c=e.node(n),h=c?c.borderLeft:void 0,d=c?c.borderRight:void 0,p={};h&&(u=r.filter(u,(function(t){return t!==h&&t!==d})));var f=i(e,u);r.forEach(f,(function(n){if(e.children(n.v).length){var i=t(e,n.v,a,l);p[n.v]=i,r.has(i,"barycenter")&&(s=n,o=i,r.isUndefined(s.barycenter)?(s.barycenter=o.barycenter,s.weight=o.weight):(s.barycenter=(s.barycenter*s.weight+o.barycenter*o.weight)/(s.weight+o.weight),s.weight+=o.weight))}var s,o}));var m=s(f,a);!function(t,e){r.forEach(t,(function(t){t.vs=r.flatten(t.vs.map((function(t){return e[t]?e[t].vs:t})),!0)}))}(m,p);var g=o(m,l);if(h&&(g.vs=r.flatten([h,g.vs,d],!0),e.predecessors(h).length)){var v=e.node(e.predecessors(h)[0]),y=e.node(e.predecessors(d)[0]);r.has(g,"barycenter")||(g.barycenter=0,g.weight=0),g.barycenter=(g.barycenter*g.weight+v.order+y.order)/(g.weight+2),g.weight+=2}return g}},45737:function(t,e,n){var r=n(8217),i=n(92304);function s(t,e,n){for(var i;e.length&&(i=r.last(e)).i<=n;)e.pop(),t.push(i.vs),n++;return n}t.exports=function(t,e){var n=i.partition(t,(function(t){return r.has(t,"barycenter")})),o=n.lhs,a=r.sortBy(n.rhs,(function(t){return-t.i})),l=[],u=0,c=0,h=0;o.sort((d=!!e,function(t,e){return t.barycenter<e.barycenter?-1:t.barycenter>e.barycenter?1:d?e.i-t.i:t.i-e.i})),h=s(l,a,h),r.forEach(o,(function(t){h+=t.vs.length,l.push(t.vs),u+=t.barycenter*t.weight,c+=t.weight,h=s(l,a,h)}));var d;var p={vs:r.flatten(l,!0)};c&&(p.barycenter=u/c,p.weight=c);return p}},24685:function(t,e,n){var r=n(8217);t.exports=function(t){var e=function(t){var e={},n=0;function i(s){var o=n;r.forEach(t.children(s),i),e[s]={low:o,lim:n++}}return r.forEach(t.children(),i),e}(t);r.forEach(t.graph().dummyChains,(function(n){for(var r=t.node(n),i=r.edgeObj,s=function(t,e,n,r){var i,s,o=[],a=[],l=Math.min(e[n].low,e[r].low),u=Math.max(e[n].lim,e[r].lim);i=n;do{i=t.parent(i),o.push(i)}while(i&&(e[i].low>l||u>e[i].lim));s=i,i=r;for(;(i=t.parent(i))!==s;)a.push(i);return{path:o.concat(a.reverse()),lca:s}}(t,e,i.v,i.w),o=s.path,a=s.lca,l=0,u=o[l],c=!0;n!==i.w;){if(r=t.node(n),c){for(;(u=o[l])!==a&&t.node(u).maxRank<r.rank;)l++;u===a&&(c=!1)}if(!c){for(;l<o.length-1&&t.node(u=o[l+1]).minRank<=r.rank;)l++;u=o[l]}t.setParent(n,u),n=t.successors(n)[0]}}))}},21006:function(t,e,n){"use strict";var r=n(8217),i=n(68509).Graph,s=n(92304);function o(t,e){var n={};return r.reduce(e,(function(e,i){var s=0,o=0,a=e.length,u=r.last(i);return r.forEach(i,(function(e,c){var h=function(t,e){if(t.node(e).dummy)return r.find(t.predecessors(e),(function(e){return t.node(e).dummy}))}(t,e),d=h?t.node(h).order:a;(h||e===u)&&(r.forEach(i.slice(o,c+1),(function(e){r.forEach(t.predecessors(e),(function(r){var i=t.node(r),o=i.order;!(o<s||d<o)||i.dummy&&t.node(e).dummy||l(n,r,e)}))})),o=c+1,s=d)})),i})),n}function a(t,e){var n={};function i(e,i,s,o,a){var u;r.forEach(r.range(i,s),(function(i){u=e[i],t.node(u).dummy&&r.forEach(t.predecessors(u),(function(e){var r=t.node(e);r.dummy&&(r.order<o||r.order>a)&&l(n,e,u)}))}))}return r.reduce(e,(function(e,n){var s,o=-1,a=0;return r.forEach(n,(function(r,l){if("border"===t.node(r).dummy){var u=t.predecessors(r);u.length&&(s=t.node(u[0]).order,i(n,a,l,o,s),a=l,o=s)}i(n,a,n.length,s,e.length)})),n})),n}function l(t,e,n){if(e>n){var r=e;e=n,n=r}var i=t[e];i||(t[e]=i={}),i[n]=!0}function u(t,e,n){if(e>n){var i=e;e=n,n=i}return r.has(t[e],n)}function c(t,e,n,i){var s={},o={},a={};return r.forEach(e,(function(t){r.forEach(t,(function(t,e){s[t]=t,o[t]=t,a[t]=e}))})),r.forEach(e,(function(t){var e=-1;r.forEach(t,(function(t){var l=i(t);if(l.length){l=r.sortBy(l,(function(t){return a[t]}));for(var c=(l.length-1)/2,h=Math.floor(c),d=Math.ceil(c);h<=d;++h){var p=l[h];o[t]===t&&e<a[p]&&!u(n,t,p)&&(o[p]=t,o[t]=s[t]=s[p],e=a[p])}}}))})),{root:s,align:o}}function h(t,e,n,s,o){var a={},l=function(t,e,n,s){var o=new i,a=t.graph(),l=function(t,e,n){return function(i,s,o){var a,l=i.node(s),u=i.node(o),c=0;if(c+=l.width/2,r.has(l,"labelpos"))switch(l.labelpos.toLowerCase()){case"l":a=-l.width/2;break;case"r":a=l.width/2}if(a&&(c+=n?a:-a),a=0,c+=(l.dummy?e:t)/2,c+=(u.dummy?e:t)/2,c+=u.width/2,r.has(u,"labelpos"))switch(u.labelpos.toLowerCase()){case"l":a=u.width/2;break;case"r":a=-u.width/2}return a&&(c+=n?a:-a),a=0,c}}(a.nodesep,a.edgesep,s);return r.forEach(e,(function(e){var i;r.forEach(e,(function(e){var r=n[e];if(o.setNode(r),i){var s=n[i],a=o.edge(s,r);o.setEdge(s,r,Math.max(l(t,e,i),a||0))}i=e}))})),o}(t,e,n,o),u=o?"borderLeft":"borderRight";function c(t,e){for(var n=l.nodes(),r=n.pop(),i={};r;)i[r]?t(r):(i[r]=!0,n.push(r),n=n.concat(e(r))),r=n.pop()}return c((function(t){a[t]=l.inEdges(t).reduce((function(t,e){return Math.max(t,a[e.v]+l.edge(e))}),0)}),l.predecessors.bind(l)),c((function(e){var n=l.outEdges(e).reduce((function(t,e){return Math.min(t,a[e.w]-l.edge(e))}),Number.POSITIVE_INFINITY),r=t.node(e);n!==Number.POSITIVE_INFINITY&&r.borderType!==u&&(a[e]=Math.max(a[e],n))}),l.successors.bind(l)),r.forEach(s,(function(t){a[t]=a[n[t]]})),a}function d(t,e){return r.minBy(r.values(e),(function(e){var n=Number.NEGATIVE_INFINITY,i=Number.POSITIVE_INFINITY;return r.forIn(e,(function(e,r){var s=function(t,e){return t.node(e).width}(t,r)/2;n=Math.max(e+s,n),i=Math.min(e-s,i)})),n-i}))}function p(t,e){var n=r.values(e),i=r.min(n),s=r.max(n);r.forEach(["u","d"],(function(n){r.forEach(["l","r"],(function(o){var a,l=n+o,u=t[l];if(u!==e){var c=r.values(u);(a="l"===o?i-r.min(c):s-r.max(c))&&(t[l]=r.mapValues(u,(function(t){return t+a})))}}))}))}function f(t,e){return r.mapValues(t.ul,(function(n,i){if(e)return t[e.toLowerCase()][i];var s=r.sortBy(r.map(t,i));return(s[1]+s[2])/2}))}t.exports={positionX:function(t){var e,n=s.buildLayerMatrix(t),i=r.merge(o(t,n),a(t,n)),l={};r.forEach(["u","d"],(function(s){e="u"===s?n:r.values(n).reverse(),r.forEach(["l","r"],(function(n){"r"===n&&(e=r.map(e,(function(t){return r.values(t).reverse()})));var o=("u"===s?t.predecessors:t.successors).bind(t),a=c(t,e,i,o),u=h(t,e,a.root,a.align,"r"===n);"r"===n&&(u=r.mapValues(u,(function(t){return-t}))),l[s+n]=u}))}));var u=d(t,l);return p(l,u),f(l,t.graph().align)},findType1Conflicts:o,findType2Conflicts:a,addConflict:l,hasConflict:u,verticalAlignment:c,horizontalCompaction:h,alignCoordinates:p,findSmallestWidthAlignment:d,balance:f}},63363:function(t,e,n){"use strict";var r=n(8217),i=n(92304),s=n(21006).positionX;t.exports=function(t){(function(t){var e=i.buildLayerMatrix(t),n=t.graph().ranksep,s=0;r.forEach(e,(function(e){var i=r.max(r.map(e,(function(e){return t.node(e).height})));r.forEach(e,(function(e){t.node(e).y=s+i/2})),s+=i+n}))})(t=i.asNonCompoundGraph(t)),r.forEach(s(t),(function(e,n){t.node(n).x=e}))}},31848:function(t,e,n){"use strict";var r=n(8217),i=n(68509).Graph,s=n(74211).slack;function o(t,e){return r.forEach(t.nodes(),(function n(i){r.forEach(e.nodeEdges(i),(function(r){var o=r.v,a=i===o?r.w:o;t.hasNode(a)||s(e,r)||(t.setNode(a,{}),t.setEdge(i,a,{}),n(a))}))})),t.nodeCount()}function a(t,e){return r.minBy(e.edges(),(function(n){if(t.hasNode(n.v)!==t.hasNode(n.w))return s(e,n)}))}function l(t,e,n){r.forEach(t.nodes(),(function(t){e.node(t).rank+=n}))}t.exports=function(t){var e,n,r=new i({directed:!1}),u=t.nodes()[0],c=t.nodeCount();r.setNode(u,{});for(;o(r,t)<c;)e=a(r,t),n=r.hasNode(e.v)?s(t,e):-s(t,e),l(r,t,n);return r}},65511:function(t,e,n){"use strict";var r=n(74211).longestPath,i=n(31848),s=n(37736);t.exports=function(t){switch(t.graph().ranker){case"network-simplex":default:a(t);break;case"tight-tree":!function(t){r(t),i(t)}(t);break;case"longest-path":o(t)}};var o=r;function a(t){s(t)}},37736:function(t,e,n){"use strict";var r=n(8217),i=n(31848),s=n(74211).slack,o=n(74211).longestPath,a=n(68509).alg.preorder,l=n(68509).alg.postorder,u=n(92304).simplify;function c(t){t=u(t),o(t);var e,n=i(t);for(p(n),h(n,t);e=m(n);)v(n,t,e,g(n,t,e))}function h(t,e){var n=l(t,t.nodes());n=n.slice(0,n.length-1),r.forEach(n,(function(n){!function(t,e,n){var r=t.node(n),i=r.parent;t.edge(n,i).cutvalue=d(t,e,n)}(t,e,n)}))}function d(t,e,n){var i=t.node(n).parent,s=!0,o=e.edge(n,i),a=0;return o||(s=!1,o=e.edge(i,n)),a=o.weight,r.forEach(e.nodeEdges(n),(function(r){var o,l,u=r.v===n,c=u?r.w:r.v;if(c!==i){var h=u===s,d=e.edge(r).weight;if(a+=h?d:-d,o=n,l=c,t.hasEdge(o,l)){var p=t.edge(n,c).cutvalue;a+=h?-p:p}}})),a}function p(t,e){arguments.length<2&&(e=t.nodes()[0]),f(t,{},1,e)}function f(t,e,n,i,s){var o=n,a=t.node(i);return e[i]=!0,r.forEach(t.neighbors(i),(function(s){r.has(e,s)||(n=f(t,e,n,s,i))})),a.low=o,a.lim=n++,s?a.parent=s:delete a.parent,n}function m(t){return r.find(t.edges(),(function(e){return t.edge(e).cutvalue<0}))}function g(t,e,n){var i=n.v,o=n.w;e.hasEdge(i,o)||(i=n.w,o=n.v);var a=t.node(i),l=t.node(o),u=a,c=!1;a.lim>l.lim&&(u=l,c=!0);var h=r.filter(e.edges(),(function(e){return c===y(t,t.node(e.v),u)&&c!==y(t,t.node(e.w),u)}));return r.minBy(h,(function(t){return s(e,t)}))}function v(t,e,n,i){var s=n.v,o=n.w;t.removeEdge(s,o),t.setEdge(i.v,i.w,{}),p(t),h(t,e),function(t,e){var n=r.find(t.nodes(),(function(t){return!e.node(t).parent})),i=a(t,n);i=i.slice(1),r.forEach(i,(function(n){var r=t.node(n).parent,i=e.edge(n,r),s=!1;i||(i=e.edge(r,n),s=!0),e.node(n).rank=e.node(r).rank+(s?i.minlen:-i.minlen)}))}(t,e)}function y(t,e,n){return n.low<=e.lim&&e.lim<=n.lim}t.exports=c,c.initLowLimValues=p,c.initCutValues=h,c.calcCutValue=d,c.leaveEdge=m,c.enterEdge=g,c.exchangeEdges=v},74211:function(t,e,n){"use strict";var r=n(8217);t.exports={longestPath:function(t){var e={};r.forEach(t.sources(),(function n(i){var s=t.node(i);if(r.has(e,i))return s.rank;e[i]=!0;var o=r.min(r.map(t.outEdges(i),(function(e){return n(e.w)-t.edge(e).minlen})));return o!==Number.POSITIVE_INFINITY&&null!=o||(o=0),s.rank=o}))},slack:function(t,e){return t.node(e.w).rank-t.node(e.v).rank-t.edge(e).minlen}}},92304:function(t,e,n){"use strict";var r=n(8217),i=n(68509).Graph;function s(t,e,n,i){var s;do{s=r.uniqueId(i)}while(t.hasNode(s));return n.dummy=e,t.setNode(s,n),s}function o(t){return r.max(r.map(t.nodes(),(function(e){var n=t.node(e).rank;if(!r.isUndefined(n))return n})))}t.exports={addDummyNode:s,simplify:function(t){var e=(new i).setGraph(t.graph());return r.forEach(t.nodes(),(function(n){e.setNode(n,t.node(n))})),r.forEach(t.edges(),(function(n){var r=e.edge(n.v,n.w)||{weight:0,minlen:1},i=t.edge(n);e.setEdge(n.v,n.w,{weight:r.weight+i.weight,minlen:Math.max(r.minlen,i.minlen)})})),e},asNonCompoundGraph:function(t){var e=new i({multigraph:t.isMultigraph()}).setGraph(t.graph());return r.forEach(t.nodes(),(function(n){t.children(n).length||e.setNode(n,t.node(n))})),r.forEach(t.edges(),(function(n){e.setEdge(n,t.edge(n))})),e},successorWeights:function(t){var e=r.map(t.nodes(),(function(e){var n={};return r.forEach(t.outEdges(e),(function(e){n[e.w]=(n[e.w]||0)+t.edge(e).weight})),n}));return r.zipObject(t.nodes(),e)},predecessorWeights:function(t){var e=r.map(t.nodes(),(function(e){var n={};return r.forEach(t.inEdges(e),(function(e){n[e.v]=(n[e.v]||0)+t.edge(e).weight})),n}));return r.zipObject(t.nodes(),e)},intersectRect:function(t,e){var n,r,i=t.x,s=t.y,o=e.x-i,a=e.y-s,l=t.width/2,u=t.height/2;if(!o&&!a)throw new Error("Not possible to find intersection inside of the rectangle");Math.abs(a)*l>Math.abs(o)*u?(a<0&&(u=-u),n=u*o/a,r=u):(o<0&&(l=-l),n=l,r=l*a/o);return{x:i+n,y:s+r}},buildLayerMatrix:function(t){var e=r.map(r.range(o(t)+1),(function(){return[]}));return r.forEach(t.nodes(),(function(n){var i=t.node(n),s=i.rank;r.isUndefined(s)||(e[s][i.order]=n)})),e},normalizeRanks:function(t){var e=r.min(r.map(t.nodes(),(function(e){return t.node(e).rank})));r.forEach(t.nodes(),(function(n){var i=t.node(n);r.has(i,"rank")&&(i.rank-=e)}))},removeEmptyRanks:function(t){var e=r.min(r.map(t.nodes(),(function(e){return t.node(e).rank}))),n=[];r.forEach(t.nodes(),(function(r){var i=t.node(r).rank-e;n[i]||(n[i]=[]),n[i].push(r)}));var i=0,s=t.graph().nodeRankFactor;r.forEach(n,(function(e,n){r.isUndefined(e)&&n%s!=0?--i:i&&r.forEach(e,(function(e){t.node(e).rank+=i}))}))},addBorderNode:function(t,e,n,r){var i={width:0,height:0};arguments.length>=4&&(i.rank=n,i.order=r);return s(t,"border",i,e)},maxRank:o,partition:function(t,e){var n={lhs:[],rhs:[]};return r.forEach(t,(function(t){e(t)?n.lhs.push(t):n.rhs.push(t)})),n},time:function(t,e){var n=r.now();try{return e()}finally{console.log(t+" time: "+(r.now()-n)+"ms")}},notime:function(t,e){return e()}}},90975:function(t){t.exports="0.8.5"},16239:function(t,e,n){var r=n(23617);t.exports={Graph:r.Graph,json:n(53988),alg:n(92010),version:r.version}},49004:function(t,e,n){var r=n(91124);t.exports=function(t){var e,n={},i=[];function s(i){r.has(n,i)||(n[i]=!0,e.push(i),r.each(t.successors(i),s),r.each(t.predecessors(i),s))}return r.each(t.nodes(),(function(t){e=[],s(t),e.length&&i.push(e)})),i}},10689:function(t,e,n){var r=n(91124);function i(t,e,n,s,o,a){r.has(s,e)||(s[e]=!0,n||a.push(e),r.each(o(e),(function(e){i(t,e,n,s,o,a)})),n&&a.push(e))}t.exports=function(t,e,n){r.isArray(e)||(e=[e]);var s=(t.isDirected()?t.successors:t.neighbors).bind(t),o=[],a={};return r.each(e,(function(e){if(!t.hasNode(e))throw new Error("Graph does not have node: "+e);i(t,e,"post"===n,a,s,o)})),o}},53659:function(t,e,n){var r=n(95070),i=n(91124);t.exports=function(t,e,n){return i.transform(t.nodes(),(function(i,s){i[s]=r(t,s,e,n)}),{})}},95070:function(t,e,n){var r=n(91124),i=n(60392);t.exports=function(t,e,n,r){return function(t,e,n,r){var s,o,a={},l=new i,u=function(t){var e=t.v!==s?t.v:t.w,r=a[e],i=n(t),u=o.distance+i;if(i<0)throw new Error("dijkstra does not allow negative edge weights. Bad edge: "+t+" Weight: "+i);u<r.distance&&(r.distance=u,r.predecessor=s,l.decrease(e,u))};t.nodes().forEach((function(t){var n=t===e?0:Number.POSITIVE_INFINITY;a[t]={distance:n},l.add(t,n)}));for(;l.size()>0&&(s=l.removeMin(),(o=a[s]).distance!==Number.POSITIVE_INFINITY);)r(s).forEach(u);return a}(t,String(e),n||s,r||function(e){return t.outEdges(e)})};var s=r.constant(1)},53548:function(t,e,n){var r=n(91124),i=n(87299);t.exports=function(t){return r.filter(i(t),(function(e){return e.length>1||1===e.length&&t.hasEdge(e[0],e[0])}))}},1637:function(t,e,n){var r=n(91124);t.exports=function(t,e,n){return function(t,e,n){var r={},i=t.nodes();return i.forEach((function(t){r[t]={},r[t][t]={distance:0},i.forEach((function(e){t!==e&&(r[t][e]={distance:Number.POSITIVE_INFINITY})})),n(t).forEach((function(n){var i=n.v===t?n.w:n.v,s=e(n);r[t][i]={distance:s,predecessor:t}}))})),i.forEach((function(t){var e=r[t];i.forEach((function(n){var s=r[n];i.forEach((function(n){var r=s[t],i=e[n],o=s[n],a=r.distance+i.distance;a<o.distance&&(o.distance=a,o.predecessor=i.predecessor)}))}))})),r}(t,e||i,n||function(e){return t.outEdges(e)})};var i=r.constant(1)},92010:function(t,e,n){t.exports={components:n(49004),dijkstra:n(95070),dijkstraAll:n(53659),findCycles:n(53548),floydWarshall:n(1637),isAcyclic:n(52974),postorder:n(88021),preorder:n(35954),prim:n(61102),tarjan:n(87299),topsort:n(12177)}},52974:function(t,e,n){var r=n(12177);t.exports=function(t){try{r(t)}catch(t){if(t instanceof r.CycleException)return!1;throw t}return!0}},88021:function(t,e,n){var r=n(10689);t.exports=function(t,e){return r(t,e,"post")}},35954:function(t,e,n){var r=n(10689);t.exports=function(t,e){return r(t,e,"pre")}},61102:function(t,e,n){var r=n(91124),i=n(58415),s=n(60392);t.exports=function(t,e){var n,o=new i,a={},l=new s;function u(t){var r=t.v===n?t.w:t.v,i=l.priority(r);if(void 0!==i){var s=e(t);s<i&&(a[r]=n,l.decrease(r,s))}}if(0===t.nodeCount())return o;r.each(t.nodes(),(function(t){l.add(t,Number.POSITIVE_INFINITY),o.setNode(t)})),l.decrease(t.nodes()[0],0);var c=!1;for(;l.size()>0;){if(n=l.removeMin(),r.has(a,n))o.setEdge(n,a[n]);else{if(c)throw new Error("Input graph is not connected: "+t);c=!0}t.nodeEdges(n).forEach(u)}return o}},87299:function(t,e,n){var r=n(91124);t.exports=function(t){var e=0,n=[],i={},s=[];function o(a){var l=i[a]={onStack:!0,lowlink:e,index:e++};if(n.push(a),t.successors(a).forEach((function(t){r.has(i,t)?i[t].onStack&&(l.lowlink=Math.min(l.lowlink,i[t].index)):(o(t),l.lowlink=Math.min(l.lowlink,i[t].lowlink))})),l.lowlink===l.index){var u,c=[];do{u=n.pop(),i[u].onStack=!1,c.push(u)}while(a!==u);s.push(c)}}return t.nodes().forEach((function(t){r.has(i,t)||o(t)})),s}},12177:function(t,e,n){var r=n(91124);function i(t){var e={},n={},i=[];if(r.each(t.sinks(),(function o(a){if(r.has(n,a))throw new s;r.has(e,a)||(n[a]=!0,e[a]=!0,r.each(t.predecessors(a),o),delete n[a],i.push(a))})),r.size(e)!==t.nodeCount())throw new s;return i}function s(){}t.exports=i,i.CycleException=s,s.prototype=new Error},60392:function(t,e,n){var r=n(91124);function i(){this._arr=[],this._keyIndices={}}t.exports=i,i.prototype.size=function(){return this._arr.length},i.prototype.keys=function(){return this._arr.map((function(t){return t.key}))},i.prototype.has=function(t){return r.has(this._keyIndices,t)},i.prototype.priority=function(t){var e=this._keyIndices[t];if(void 0!==e)return this._arr[e].priority},i.prototype.min=function(){if(0===this.size())throw new Error("Queue underflow");return this._arr[0].key},i.prototype.add=function(t,e){var n=this._keyIndices;if(t=String(t),!r.has(n,t)){var i=this._arr,s=i.length;return n[t]=s,i.push({key:t,priority:e}),this._decrease(s),!0}return!1},i.prototype.removeMin=function(){this._swap(0,this._arr.length-1);var t=this._arr.pop();return delete this._keyIndices[t.key],this._heapify(0),t.key},i.prototype.decrease=function(t,e){var n=this._keyIndices[t];if(e>this._arr[n].priority)throw new Error("New priority is greater than current priority. Key: "+t+" Old: "+this._arr[n].priority+" New: "+e);this._arr[n].priority=e,this._decrease(n)},i.prototype._heapify=function(t){var e=this._arr,n=2*t,r=n+1,i=t;n<e.length&&(i=e[n].priority<e[i].priority?n:i,r<e.length&&(i=e[r].priority<e[i].priority?r:i),i!==t&&(this._swap(t,i),this._heapify(i)))},i.prototype._decrease=function(t){for(var e,n=this._arr,r=n[t].priority;0!==t&&!(n[e=t>>1].priority<r);)this._swap(t,e),t=e},i.prototype._swap=function(t,e){var n=this._arr,r=this._keyIndices,i=n[t],s=n[e];n[t]=s,n[e]=i,r[s.key]=t,r[i.key]=e}},58415:function(t,e,n){"use strict";var r=n(91124);t.exports=s;var i="\0";function s(t){this._isDirected=!r.has(t,"directed")||t.directed,this._isMultigraph=!!r.has(t,"multigraph")&&t.multigraph,this._isCompound=!!r.has(t,"compound")&&t.compound,this._label=void 0,this._defaultNodeLabelFn=r.constant(void 0),this._defaultEdgeLabelFn=r.constant(void 0),this._nodes={},this._isCompound&&(this._parent={},this._children={},this._children[i]={}),this._in={},this._preds={},this._out={},this._sucs={},this._edgeObjs={},this._edgeLabels={}}function o(t,e){t[e]?t[e]++:t[e]=1}function a(t,e){--t[e]||delete t[e]}function l(t,e,n,i){var s=""+e,o=""+n;if(!t&&s>o){var a=s;s=o,o=a}return s+""+o+""+(r.isUndefined(i)?"\0":i)}function u(t,e,n,r){var i=""+e,s=""+n;if(!t&&i>s){var o=i;i=s,s=o}var a={v:i,w:s};return r&&(a.name=r),a}function c(t,e){return l(t,e.v,e.w,e.name)}s.prototype._nodeCount=0,s.prototype._edgeCount=0,s.prototype.isDirected=function(){return this._isDirected},s.prototype.isMultigraph=function(){return this._isMultigraph},s.prototype.isCompound=function(){return this._isCompound},s.prototype.setGraph=function(t){return this._label=t,this},s.prototype.graph=function(){return this._label},s.prototype.setDefaultNodeLabel=function(t){return r.isFunction(t)||(t=r.constant(t)),this._defaultNodeLabelFn=t,this},s.prototype.nodeCount=function(){return this._nodeCount},s.prototype.nodes=function(){return r.keys(this._nodes)},s.prototype.sources=function(){var t=this;return r.filter(this.nodes(),(function(e){return r.isEmpty(t._in[e])}))},s.prototype.sinks=function(){var t=this;return r.filter(this.nodes(),(function(e){return r.isEmpty(t._out[e])}))},s.prototype.setNodes=function(t,e){var n=arguments,i=this;return r.each(t,(function(t){n.length>1?i.setNode(t,e):i.setNode(t)})),this},s.prototype.setNode=function(t,e){return r.has(this._nodes,t)?(arguments.length>1&&(this._nodes[t]=e),this):(this._nodes[t]=arguments.length>1?e:this._defaultNodeLabelFn(t),this._isCompound&&(this._parent[t]=i,this._children[t]={},this._children[i][t]=!0),this._in[t]={},this._preds[t]={},this._out[t]={},this._sucs[t]={},++this._nodeCount,this)},s.prototype.node=function(t){return this._nodes[t]},s.prototype.hasNode=function(t){return r.has(this._nodes,t)},s.prototype.removeNode=function(t){var e=this;if(r.has(this._nodes,t)){var n=function(t){e.removeEdge(e._edgeObjs[t])};delete this._nodes[t],this._isCompound&&(this._removeFromParentsChildList(t),delete this._parent[t],r.each(this.children(t),(function(t){e.setParent(t)})),delete this._children[t]),r.each(r.keys(this._in[t]),n),delete this._in[t],delete this._preds[t],r.each(r.keys(this._out[t]),n),delete this._out[t],delete this._sucs[t],--this._nodeCount}return this},s.prototype.setParent=function(t,e){if(!this._isCompound)throw new Error("Cannot set parent in a non-compound graph");if(r.isUndefined(e))e=i;else{for(var n=e+="";!r.isUndefined(n);n=this.parent(n))if(n===t)throw new Error("Setting "+e+" as parent of "+t+" would create a cycle");this.setNode(e)}return this.setNode(t),this._removeFromParentsChildList(t),this._parent[t]=e,this._children[e][t]=!0,this},s.prototype._removeFromParentsChildList=function(t){delete this._children[this._parent[t]][t]},s.prototype.parent=function(t){if(this._isCompound){var e=this._parent[t];if(e!==i)return e}},s.prototype.children=function(t){if(r.isUndefined(t)&&(t=i),this._isCompound){var e=this._children[t];if(e)return r.keys(e)}else{if(t===i)return this.nodes();if(this.hasNode(t))return[]}},s.prototype.predecessors=function(t){var e=this._preds[t];if(e)return r.keys(e)},s.prototype.successors=function(t){var e=this._sucs[t];if(e)return r.keys(e)},s.prototype.neighbors=function(t){var e=this.predecessors(t);if(e)return r.union(e,this.successors(t))},s.prototype.isLeaf=function(t){return 0===(this.isDirected()?this.successors(t):this.neighbors(t)).length},s.prototype.filterNodes=function(t){var e=new this.constructor({directed:this._isDirected,multigraph:this._isMultigraph,compound:this._isCompound});e.setGraph(this.graph());var n=this;r.each(this._nodes,(function(n,r){t(r)&&e.setNode(r,n)})),r.each(this._edgeObjs,(function(t){e.hasNode(t.v)&&e.hasNode(t.w)&&e.setEdge(t,n.edge(t))}));var i={};function s(t){var r=n.parent(t);return void 0===r||e.hasNode(r)?(i[t]=r,r):r in i?i[r]:s(r)}return this._isCompound&&r.each(e.nodes(),(function(t){e.setParent(t,s(t))})),e},s.prototype.setDefaultEdgeLabel=function(t){return r.isFunction(t)||(t=r.constant(t)),this._defaultEdgeLabelFn=t,this},s.prototype.edgeCount=function(){return this._edgeCount},s.prototype.edges=function(){return r.values(this._edgeObjs)},s.prototype.setPath=function(t,e){var n=this,i=arguments;return r.reduce(t,(function(t,r){return i.length>1?n.setEdge(t,r,e):n.setEdge(t,r),r})),this},s.prototype.setEdge=function(){var t,e,n,i,s=!1,a=arguments[0];"object"==typeof a&&null!==a&&"v"in a?(t=a.v,e=a.w,n=a.name,2===arguments.length&&(i=arguments[1],s=!0)):(t=a,e=arguments[1],n=arguments[3],arguments.length>2&&(i=arguments[2],s=!0)),t=""+t,e=""+e,r.isUndefined(n)||(n=""+n);var c=l(this._isDirected,t,e,n);if(r.has(this._edgeLabels,c))return s&&(this._edgeLabels[c]=i),this;if(!r.isUndefined(n)&&!this._isMultigraph)throw new Error("Cannot set a named edge when isMultigraph = false");this.setNode(t),this.setNode(e),this._edgeLabels[c]=s?i:this._defaultEdgeLabelFn(t,e,n);var h=u(this._isDirected,t,e,n);return t=h.v,e=h.w,Object.freeze(h),this._edgeObjs[c]=h,o(this._preds[e],t),o(this._sucs[t],e),this._in[e][c]=h,this._out[t][c]=h,this._edgeCount++,this},s.prototype.edge=function(t,e,n){var r=1===arguments.length?c(this._isDirected,arguments[0]):l(this._isDirected,t,e,n);return this._edgeLabels[r]},s.prototype.hasEdge=function(t,e,n){var i=1===arguments.length?c(this._isDirected,arguments[0]):l(this._isDirected,t,e,n);return r.has(this._edgeLabels,i)},s.prototype.removeEdge=function(t,e,n){var r=1===arguments.length?c(this._isDirected,arguments[0]):l(this._isDirected,t,e,n),i=this._edgeObjs[r];return i&&(t=i.v,e=i.w,delete this._edgeLabels[r],delete this._edgeObjs[r],a(this._preds[e],t),a(this._sucs[t],e),delete this._in[e][r],delete this._out[t][r],this._edgeCount--),this},s.prototype.inEdges=function(t,e){var n=this._in[t];if(n){var i=r.values(n);return e?r.filter(i,(function(t){return t.v===e})):i}},s.prototype.outEdges=function(t,e){var n=this._out[t];if(n){var i=r.values(n);return e?r.filter(i,(function(t){return t.w===e})):i}},s.prototype.nodeEdges=function(t,e){var n=this.inEdges(t,e);if(n)return n.concat(this.outEdges(t,e))}},23617:function(t,e,n){t.exports={Graph:n(58415),version:n(58183)}},53988:function(t,e,n){var r=n(91124),i=n(58415);function s(t){return r.map(t.nodes(),(function(e){var n=t.node(e),i=t.parent(e),s={v:e};return r.isUndefined(n)||(s.value=n),r.isUndefined(i)||(s.parent=i),s}))}function o(t){return r.map(t.edges(),(function(e){var n=t.edge(e),i={v:e.v,w:e.w};return r.isUndefined(e.name)||(i.name=e.name),r.isUndefined(n)||(i.value=n),i}))}t.exports={write:function(t){var e={options:{directed:t.isDirected(),multigraph:t.isMultigraph(),compound:t.isCompound()},nodes:s(t),edges:o(t)};r.isUndefined(t.graph())||(e.value=r.clone(t.graph()));return e},read:function(t){var e=new i(t.options).setGraph(t.value);return r.each(t.nodes,(function(t){e.setNode(t.v,t.value),t.parent&&e.setParent(t.v,t.parent)})),r.each(t.edges,(function(t){e.setEdge({v:t.v,w:t.w,name:t.name},t.value)})),e}}},91124:function(t,e,n){var r;try{r={clone:n(55824),constant:n(64806),each:n(15828),filter:n(3149),has:n(56611),isArray:n(24669),isEmpty:n(82691),isFunction:n(92042),isUndefined:n(89300),keys:n(50579),map:n(65512),reduce:n(6355),size:n(81430),transform:n(68742),union:n(29974),values:n(61017)}}catch(t){}r||(r=window._),t.exports=r},58183:function(t){t.exports="2.1.8"},5490:function(t,e,n){"use strict";n.d(e,{KT:function(){return B}});const r=(()=>{let t=0;return()=>(t+=1,`u${`0000${(Math.random()*36**4<<0).toString(36)}`.slice(-4)}${t}`)})();function i(t){const e=[];for(let n=0,r=t.length;n<r;n++)e.push(t[n]);return e}function s(t,e){const n=(t.ownerDocument.defaultView||window).getComputedStyle(t).getPropertyValue(e);return n?parseFloat(n.replace("px","")):0}function o(t,e={}){return{width:e.width||function(t){const e=s(t,"border-left-width"),n=s(t,"border-right-width");return t.clientWidth+e+n}(t),height:e.height||function(t){const e=s(t,"border-top-width"),n=s(t,"border-bottom-width");return t.clientHeight+e+n}(t)}}function a(t){return new Promise(((e,n)=>{const r=new Image;r.decode=()=>e(r),r.onload=()=>e(r),r.onerror=n,r.crossOrigin="anonymous",r.decoding="async",r.src=t}))}async function l(t,e,n){const r="http://www.w3.org/2000/svg",i=document.createElementNS(r,"svg"),s=document.createElementNS(r,"foreignObject");return i.setAttribute("width",`${e}`),i.setAttribute("height",`${n}`),i.setAttribute("viewBox",`0 0 ${e} ${n}`),s.setAttribute("width","100%"),s.setAttribute("height","100%"),s.setAttribute("x","0"),s.setAttribute("y","0"),s.setAttribute("externalResourcesRequired","true"),i.appendChild(s),s.appendChild(t),async function(t){return Promise.resolve().then((()=>(new XMLSerializer).serializeToString(t))).then(encodeURIComponent).then((t=>`data:image/svg+xml;charset=utf-8,${t}`))}(i)}const u=(t,e)=>{if(t instanceof e)return!0;const n=Object.getPrototypeOf(t);return null!==n&&(n.constructor.name===e.name||u(n,e))};function c(t,e,n){const r=`.${t}:${e}`,s=n.cssText?function(t){const e=t.getPropertyValue("content");return`${t.cssText} content: '${e.replace(/'|"/g,"")}';`}(n):function(t){return i(t).map((e=>`${e}: ${t.getPropertyValue(e)}${t.getPropertyPriority(e)?" !important":""};`)).join(" ")}(n);return document.createTextNode(`${r}{${s}}`)}function h(t,e,n){const i=window.getComputedStyle(t,n),s=i.getPropertyValue("content");if(""===s||"none"===s)return;const o=r();try{e.className=`${e.className} ${o}`}catch(t){return}const a=document.createElement("style");a.appendChild(c(o,n,i)),e.appendChild(a)}const d="application/font-woff",p="image/jpeg",f={woff:d,woff2:d,ttf:"application/font-truetype",eot:"application/vnd.ms-fontobject",png:"image/png",jpg:p,jpeg:p,gif:"image/gif",tiff:"image/tiff",svg:"image/svg+xml",webp:"image/webp"};function m(t){const e=function(t){const e=/\.([^./]*?)$/g.exec(t);return e?e[1]:""}(t).toLowerCase();return f[e]||""}function g(t){return-1!==t.search(/^(data:)/)}function v(t,e){return`data:${e};base64,${t}`}async function y(t,e,n){const r=await fetch(t,e);if(404===r.status)throw new Error(`Resource "${r.url}" not found`);const i=await r.blob();return new Promise(((t,e)=>{const s=new FileReader;s.onerror=e,s.onloadend=()=>{try{t(n({res:r,result:s.result}))}catch(t){e(t)}},s.readAsDataURL(i)}))}const _={};async function x(t,e,n){const r=function(t,e,n){let r=t.replace(/\?.*/,"");return n&&(r=t),/ttf|otf|eot|woff2?/i.test(r)&&(r=r.replace(/.*\//,"")),e?`[${e}]${r}`:r}(t,e,n.includeQueryParams);if(null!=_[r])return _[r];let i;n.cacheBust&&(t+=(/\?/.test(t)?"&":"?")+(new Date).getTime());try{const r=await y(t,n.fetchRequestInit,(({res:t,result:n})=>(e||(e=t.headers.get("Content-Type")||""),function(t){return t.split(/,/)[1]}(n))));i=v(r,e)}catch(e){i=n.imagePlaceholder||"";let r=`Failed to fetch resource: ${t}`;e&&(r="string"==typeof e?e:e.message),r&&console.warn(r)}return _[r]=i,i}async function b(t,e){return u(t,HTMLCanvasElement)?async function(t){const e=t.toDataURL();return"data:,"===e?t.cloneNode(!1):a(e)}(t):u(t,HTMLVideoElement)?async function(t,e){if(t.currentSrc){const e=document.createElement("canvas"),n=e.getContext("2d");return e.width=t.clientWidth,e.height=t.clientHeight,null==n||n.drawImage(t,0,0,e.width,e.height),a(e.toDataURL())}const n=t.poster,r=m(n);return a(await x(n,r,e))}(t,e):u(t,HTMLIFrameElement)?async function(t){var e;try{if(null===(e=null==t?void 0:t.contentDocument)||void 0===e?void 0:e.body)return await S(t.contentDocument.body,{},!0)}catch(t){}return t.cloneNode(!1)}(t):t.cloneNode(!1)}function w(t,e){return u(e,Element)&&(function(t,e){const n=e.style;if(!n)return;const r=window.getComputedStyle(t);r.cssText?(n.cssText=r.cssText,n.transformOrigin=r.transformOrigin):i(r).forEach((i=>{let s=r.getPropertyValue(i);if("font-size"===i&&s.endsWith("px")){const t=Math.floor(parseFloat(s.substring(0,s.length-2)))-.1;s=`${t}px`}u(t,HTMLIFrameElement)&&"display"===i&&"inline"===s&&(s="block"),"d"===i&&e.getAttribute("d")&&(s=`path(${e.getAttribute("d")})`),n.setProperty(i,s,r.getPropertyPriority(i))}))}(t,e),function(t,e){h(t,e,":before"),h(t,e,":after")}(t,e),function(t,e){u(t,HTMLTextAreaElement)&&(e.innerHTML=t.value),u(t,HTMLInputElement)&&e.setAttribute("value",t.value)}(t,e),function(t,e){if(u(t,HTMLSelectElement)){const n=e,r=Array.from(n.children).find((e=>t.value===e.getAttribute("value")));r&&r.setAttribute("selected","")}}(t,e)),e}async function S(t,e,n){return n||!e.filter||e.filter(t)?Promise.resolve(t).then((t=>b(t,e))).then((n=>async function(t,e,n){var r,s;let o=[];var a;return o=null!=(a=t).tagName&&"SLOT"===a.tagName.toUpperCase()&&t.assignedNodes?i(t.assignedNodes()):u(t,HTMLIFrameElement)&&(null===(r=t.contentDocument)||void 0===r?void 0:r.body)?i(t.contentDocument.body.childNodes):i((null!==(s=t.shadowRoot)&&void 0!==s?s:t).childNodes),0===o.length||u(t,HTMLVideoElement)||await o.reduce(((t,r)=>t.then((()=>S(r,n))).then((t=>{t&&e.appendChild(t)}))),Promise.resolve()),e}(t,n,e))).then((e=>w(t,e))).then((t=>async function(t,e){const n=t.querySelectorAll?t.querySelectorAll("use"):[];if(0===n.length)return t;const r={};for(let i=0;i<n.length;i++){const s=n[i].getAttribute("xlink:href");if(s){const n=t.querySelector(s),i=document.querySelector(s);n||!i||r[s]||(r[s]=await S(i,e,!0))}}const i=Object.values(r);if(i.length){const e="http://www.w3.org/1999/xhtml",n=document.createElementNS(e,"svg");n.setAttribute("xmlns",e),n.style.position="absolute",n.style.width="0",n.style.height="0",n.style.overflow="hidden",n.style.display="none";const r=document.createElementNS(e,"defs");n.appendChild(r);for(let t=0;t<i.length;t++)r.appendChild(i[t]);t.appendChild(n)}return t}(t,e))):null}const M=/url\((['"]?)([^'"]+?)\1\)/g,E=/url\([^)]+\)\s*format\((["']?)([^"']+)\1\)/g,T=/src:\s*(?:url\([^)]+\)\s*format\([^)]+\)[,;]\s*)+/g;async function A(t,e,n,r,i){try{const s=n?function(t,e){if(t.match(/^[a-z]+:\/\//i))return t;if(t.match(/^\/\//))return window.location.protocol+t;if(t.match(/^[a-z]+:/i))return t;const n=document.implementation.createHTMLDocument(),r=n.createElement("base"),i=n.createElement("a");return n.head.appendChild(r),n.body.appendChild(i),e&&(r.href=e),i.href=t,i.href}(e,n):e,o=m(e);let a;if(i){a=v(await i(s),o)}else a=await x(s,o,r);return t.replace(function(t){const e=t.replace(/([.*+?^${}()|\[\]\/\\])/g,"\\$1");return new RegExp(`(url\\(['"]?)(${e})(['"]?\\))`,"g")}(e),`$1${a}$3`)}catch(t){}return t}function C(t){return-1!==t.search(M)}async function R(t,e,n){if(!C(t))return t;const r=function(t,{preferredFontFormat:e}){return e?t.replace(T,(t=>{for(;;){const[n,,r]=E.exec(t)||[];if(!r)return"";if(r===e)return`src: ${n};`}})):t}(t,n),i=function(t){const e=[];return t.replace(M,((t,n,r)=>(e.push(r),t))),e.filter((t=>!g(t)))}(r);return i.reduce(((t,r)=>t.then((t=>A(t,r,e,n)))),Promise.resolve(r))}async function N(t,e,n){var r;const i=null===(r=e.style)||void 0===r?void 0:r.getPropertyValue(t);if(i){const r=await R(i,null,n);return e.style.setProperty(t,r,e.style.getPropertyPriority(t)),!0}return!1}async function P(t,e){u(t,Element)&&(await async function(t,e){await N("background",t,e)||await N("background-image",t,e),await N("mask",t,e)||await N("mask-image",t,e)}(t,e),await async function(t,e){const n=u(t,HTMLImageElement);if((!n||g(t.src))&&(!u(t,SVGImageElement)||g(t.href.baseVal)))return;const r=n?t.src:t.href.baseVal,i=await x(r,m(r),e);await new Promise(((e,r)=>{t.onload=e,t.onerror=r;const s=t;s.decode&&(s.decode=e),"lazy"===s.loading&&(s.loading="eager"),n?(t.srcset="",t.src=i):t.href.baseVal=i}))}(t,e),await async function(t,e){const n=i(t.childNodes).map((t=>P(t,e)));await Promise.all(n).then((()=>t))}(t,e))}const I={};async function O(t){let e=I[t];if(null!=e)return e;const n=await fetch(t);return e={url:t,cssText:await n.text()},I[t]=e,e}async function D(t,e){let n=t.cssText;const r=/url\(["']?([^"')]+)["']?\)/g,i=(n.match(/url\([^)]+\)/g)||[]).map((async i=>{let s=i.replace(r,"$1");return s.startsWith("https://")||(s=new URL(s,t.url).href),y(s,e.fetchRequestInit,(({result:t})=>(n=n.replace(i,`url(${t})`),[i,t])))}));return Promise.all(i).then((()=>n))}function L(t){if(null==t)return[];const e=[];let n=t.replace(/(\/\*[\s\S]*?\*\/)/gi,"");const r=new RegExp("((@.*?keyframes [\\s\\S]*?){([\\s\\S]*?}\\s*?)})","gi");for(;;){const t=r.exec(n);if(null===t)break;e.push(t[0])}n=n.replace(r,"");const i=/@import[\s\S]*?url\([^)]*\)[\s\S]*?;/gi,s=new RegExp("((\\s*?(?:\\/\\*[\\s\\S]*?\\*\\/)?\\s*?@media[\\s\\S]*?){([\\s\\S]*?)}\\s*?})|(([\\s\\S]*?){([\\s\\S]*?)})","gi");for(;;){let t=i.exec(n);if(null===t){if(t=s.exec(n),null===t)break;i.lastIndex=s.lastIndex}else s.lastIndex=i.lastIndex;e.push(t[0])}return e}async function U(t,e){if(null==t.ownerDocument)throw new Error("Provided element is not within a Document");const n=i(t.ownerDocument.styleSheets),r=await async function(t,e){const n=[],r=[];return t.forEach((n=>{if("cssRules"in n)try{i(n.cssRules||[]).forEach(((t,i)=>{if(t.type===CSSRule.IMPORT_RULE){let s=i+1;const o=O(t.href).then((t=>D(t,e))).then((t=>L(t).forEach((t=>{try{n.insertRule(t,t.startsWith("@import")?s+=1:n.cssRules.length)}catch(e){console.error("Error inserting rule from remote css",{rule:t,error:e})}})))).catch((t=>{console.error("Error loading remote css",t.toString())}));r.push(o)}}))}catch(i){const s=t.find((t=>null==t.href))||document.styleSheets[0];null!=n.href&&r.push(O(n.href).then((t=>D(t,e))).then((t=>L(t).forEach((t=>{s.insertRule(t,n.cssRules.length)})))).catch((t=>{console.error("Error loading remote stylesheet",t)}))),console.error("Error inlining remote css file",i)}})),Promise.all(r).then((()=>(t.forEach((t=>{if("cssRules"in t)try{i(t.cssRules||[]).forEach((t=>{n.push(t)}))}catch(e){console.error(`Error while reading CSS rules from ${t.href}`,e)}})),n)))}(n,e);return function(t){return t.filter((t=>t.type===CSSRule.FONT_FACE_RULE)).filter((t=>C(t.style.getPropertyValue("src"))))}(r)}async function k(t,e){const n=null!=e.fontEmbedCSS?e.fontEmbedCSS:e.skipFonts?null:await async function(t,e){const n=await U(t,e);return(await Promise.all(n.map((t=>{const n=t.parentStyleSheet?t.parentStyleSheet.href:null;return R(t.cssText,n,e)})))).join("\n")}(t,e);if(n){const e=document.createElement("style"),r=document.createTextNode(n);e.appendChild(r),t.firstChild?t.insertBefore(e,t.firstChild):t.appendChild(e)}}async function B(t,e={}){const{width:n,height:r}=o(t,e),i=await S(t,e,!0);await k(i,e),await P(i,e),function(t,e){const{style:n}=t;e.backgroundColor&&(n.backgroundColor=e.backgroundColor),e.width&&(n.width=`${e.width}px`),e.height&&(n.height=`${e.height}px`);const r=e.style;null!=r&&Object.keys(r).forEach((t=>{n[t]=r[t]}))}(i,e);return await l(i,n,r)}},87269:function(t,e,n){var r=n(47758)(n(29165),"DataView");t.exports=r},88987:function(t,e,n){var r=n(71519),i=n(82999),s=n(76111),o=n(50506),a=n(80845);function l(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}l.prototype.clear=r,l.prototype.delete=i,l.prototype.get=s,l.prototype.has=o,l.prototype.set=a,t.exports=l},175:function(t,e,n){var r=n(2173),i=n(33752),s=n(10548),o=n(63410),a=n(3564);function l(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}l.prototype.clear=r,l.prototype.delete=i,l.prototype.get=s,l.prototype.has=o,l.prototype.set=a,t.exports=l},35922:function(t,e,n){var r=n(47758)(n(29165),"Map");t.exports=r},9440:function(t,e,n){var r=n(7140),i=n(56504),s=n(88833),o=n(80953),a=n(70724);function l(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}l.prototype.clear=r,l.prototype.delete=i,l.prototype.get=s,l.prototype.has=o,l.prototype.set=a,t.exports=l},6795:function(t,e,n){var r=n(47758)(n(29165),"Promise");t.exports=r},81956:function(t,e,n){var r=n(47758)(n(29165),"Set");t.exports=r},78188:function(t,e,n){var r=n(9440),i=n(96659),s=n(97230);function o(t){var e=-1,n=null==t?0:t.length;for(this.__data__=new r;++e<n;)this.add(t[e])}o.prototype.add=o.prototype.push=i,o.prototype.has=s,t.exports=o},5929:function(t,e,n){var r=n(175),i=n(40551),s=n(4090),o=n(47694),a=n(86220),l=n(68958);function u(t){var e=this.__data__=new r(t);this.size=e.size}u.prototype.clear=i,u.prototype.delete=s,u.prototype.get=o,u.prototype.has=a,u.prototype.set=l,t.exports=u},74396:function(t,e,n){var r=n(29165).Symbol;t.exports=r},92210:function(t,e,n){var r=n(29165).Uint8Array;t.exports=r},69477:function(t,e,n){var r=n(47758)(n(29165),"WeakMap");t.exports=r},93501:function(t){t.exports=function(t,e,n){switch(n.length){case 0:return t.call(e);case 1:return t.call(e,n[0]);case 2:return t.call(e,n[0],n[1]);case 3:return t.call(e,n[0],n[1],n[2])}return t.apply(e,n)}},21662:function(t){t.exports=function(t,e){for(var n=-1,r=null==t?0:t.length;++n<r&&!1!==e(t[n],n,t););return t}},48969:function(t){t.exports=function(t,e){for(var n=-1,r=null==t?0:t.length,i=0,s=[];++n<r;){var o=t[n];e(o,n,t)&&(s[i++]=o)}return s}},45170:function(t,e,n){var r=n(13807);t.exports=function(t,e){return!!(null==t?0:t.length)&&r(t,e,0)>-1}},94936:function(t){t.exports=function(t,e,n){for(var r=-1,i=null==t?0:t.length;++r<i;)if(n(e,t[r]))return!0;return!1}},79809:function(t,e,n){var r=n(39739),i=n(30353),s=n(24669),o=n(61563),a=n(91010),l=n(73806),u=Object.prototype.hasOwnProperty;t.exports=function(t,e){var n=s(t),c=!n&&i(t),h=!n&&!c&&o(t),d=!n&&!c&&!h&&l(t),p=n||c||h||d,f=p?r(t.length,String):[],m=f.length;for(var g in t)!e&&!u.call(t,g)||p&&("length"==g||h&&("offset"==g||"parent"==g)||d&&("buffer"==g||"byteLength"==g||"byteOffset"==g)||a(g,m))||f.push(g);return f}},75697:function(t){t.exports=function(t,e){for(var n=-1,r=null==t?0:t.length,i=Array(r);++n<r;)i[n]=e(t[n],n,t);return i}},28486:function(t){t.exports=function(t,e){for(var n=-1,r=e.length,i=t.length;++n<r;)t[i+n]=e[n];return t}},30695:function(t){t.exports=function(t,e,n,r){var i=-1,s=null==t?0:t.length;for(r&&s&&(n=t[++i]);++i<s;)n=e(n,t[i],i,t);return n}},84330:function(t){t.exports=function(t,e){for(var n=-1,r=null==t?0:t.length;++n<r;)if(e(t[n],n,t))return!0;return!1}},15989:function(t,e,n){var r=n(17498)("length");t.exports=r},72340:function(t,e,n){var r=n(30404),i=n(42448);t.exports=function(t,e,n){(void 0!==n&&!i(t[e],n)||void 0===n&&!(e in t))&&r(t,e,n)}},93719:function(t,e,n){var r=n(30404),i=n(42448),s=Object.prototype.hasOwnProperty;t.exports=function(t,e,n){var o=t[e];s.call(t,e)&&i(o,n)&&(void 0!==n||e in t)||r(t,e,n)}},62718:function(t,e,n){var r=n(42448);t.exports=function(t,e){for(var n=t.length;n--;)if(r(t[n][0],e))return n;return-1}},43472:function(t,e,n){var r=n(92434),i=n(50579);t.exports=function(t,e){return t&&r(e,i(e),t)}},7254:function(t,e,n){var r=n(92434),i=n(37390);t.exports=function(t,e){return t&&r(e,i(e),t)}},30404:function(t,e,n){var r=n(34082);t.exports=function(t,e,n){"__proto__"==e&&r?r(t,e,{configurable:!0,enumerable:!0,value:n,writable:!0}):t[e]=n}},67410:function(t,e,n){var r=n(5929),i=n(21662),s=n(93719),o=n(43472),a=n(7254),l=n(39767),u=n(47165),c=n(8782),h=n(2667),d=n(69698),p=n(21699),f=n(81887),m=n(12195),g=n(46740),v=n(36404),y=n(24669),_=n(61563),x=n(32924),b=n(36838),w=n(45380),S=n(50579),M=n(37390),E="[object Arguments]",T="[object Function]",A="[object Object]",C={};C[E]=C["[object Array]"]=C["[object ArrayBuffer]"]=C["[object DataView]"]=C["[object Boolean]"]=C["[object Date]"]=C["[object Float32Array]"]=C["[object Float64Array]"]=C["[object Int8Array]"]=C["[object Int16Array]"]=C["[object Int32Array]"]=C["[object Map]"]=C["[object Number]"]=C[A]=C["[object RegExp]"]=C["[object Set]"]=C["[object String]"]=C["[object Symbol]"]=C["[object Uint8Array]"]=C["[object Uint8ClampedArray]"]=C["[object Uint16Array]"]=C["[object Uint32Array]"]=!0,C["[object Error]"]=C[T]=C["[object WeakMap]"]=!1,t.exports=function t(e,n,R,N,P,I){var O,D=1&n,L=2&n,U=4&n;if(R&&(O=P?R(e,N,P,I):R(e)),void 0!==O)return O;if(!b(e))return e;var k=y(e);if(k){if(O=m(e),!D)return u(e,O)}else{var B=f(e),F=B==T||"[object GeneratorFunction]"==B;if(_(e))return l(e,D);if(B==A||B==E||F&&!P){if(O=L||F?{}:v(e),!D)return L?h(e,a(O,e)):c(e,o(O,e))}else{if(!C[B])return P?e:{};O=g(e,B,D)}}I||(I=new r);var z=I.get(e);if(z)return z;I.set(e,O),w(e)?e.forEach((function(r){O.add(t(r,n,R,r,e,I))})):x(e)&&e.forEach((function(r,i){O.set(i,t(r,n,R,i,e,I))}));var V=k?void 0:(U?L?p:d:L?M:S)(e);return i(V||e,(function(r,i){V&&(r=e[i=r]),s(O,i,t(r,n,R,i,e,I))})),O}},91348:function(t,e,n){var r=n(36838),i=Object.create,s=function(){function t(){}return function(e){if(!r(e))return{};if(i)return i(e);t.prototype=e;var n=new t;return t.prototype=void 0,n}}();t.exports=s},30438:function(t,e,n){var r=n(61343),i=n(4118)(r);t.exports=i},24210:function(t,e,n){var r=n(16764);t.exports=function(t,e,n){for(var i=-1,s=t.length;++i<s;){var o=t[i],a=e(o);if(null!=a&&(void 0===l?a==a&&!r(a):n(a,l)))var l=a,u=o}return u}},88286:function(t,e,n){var r=n(30438);t.exports=function(t,e){var n=[];return r(t,(function(t,r,i){e(t,r,i)&&n.push(t)})),n}},92504:function(t){t.exports=function(t,e,n,r){for(var i=t.length,s=n+(r?1:-1);r?s--:++s<i;)if(e(t[s],s,t))return s;return-1}},98768:function(t,e,n){var r=n(28486),i=n(89465);t.exports=function t(e,n,s,o,a){var l=-1,u=e.length;for(s||(s=i),a||(a=[]);++l<u;){var c=e[l];n>0&&s(c)?n>1?t(c,n-1,s,o,a):r(a,c):o||(a[a.length]=c)}return a}},91030:function(t,e,n){var r=n(29)();t.exports=r},61343:function(t,e,n){var r=n(91030),i=n(50579);t.exports=function(t,e){return t&&r(t,e,i)}},97499:function(t,e,n){var r=n(60399),i=n(77817);t.exports=function(t,e){for(var n=0,s=(e=r(e,t)).length;null!=t&&n<s;)t=t[i(e[n++])];return n&&n==s?t:void 0}},38084:function(t,e,n){var r=n(28486),i=n(24669);t.exports=function(t,e,n){var s=e(t);return i(t)?s:r(s,n(t))}},80732:function(t,e,n){var r=n(74396),i=n(31239),s=n(57058),o=r?r.toStringTag:void 0;t.exports=function(t){return null==t?void 0===t?"[object Undefined]":"[object Null]":o&&o in Object(t)?i(t):s(t)}},39491:function(t){t.exports=function(t,e){return t>e}},45435:function(t){var e=Object.prototype.hasOwnProperty;t.exports=function(t,n){return null!=t&&e.call(t,n)}},71664:function(t){t.exports=function(t,e){return null!=t&&e in Object(t)}},13807:function(t,e,n){var r=n(92504),i=n(99940),s=n(3729);t.exports=function(t,e,n){return e==e?s(t,e,n):r(t,i,n)}},84742:function(t,e,n){var r=n(80732),i=n(55073);t.exports=function(t){return i(t)&&"[object Arguments]"==r(t)}},6620:function(t,e,n){var r=n(83977),i=n(55073);t.exports=function t(e,n,s,o,a){return e===n||(null==e||null==n||!i(e)&&!i(n)?e!=e&&n!=n:r(e,n,s,o,t,a))}},83977:function(t,e,n){var r=n(5929),i=n(22684),s=n(7456),o=n(18120),a=n(81887),l=n(24669),u=n(61563),c=n(73806),h="[object Arguments]",d="[object Array]",p="[object Object]",f=Object.prototype.hasOwnProperty;t.exports=function(t,e,n,m,g,v){var y=l(t),_=l(e),x=y?d:a(t),b=_?d:a(e),w=(x=x==h?p:x)==p,S=(b=b==h?p:b)==p,M=x==b;if(M&&u(t)){if(!u(e))return!1;y=!0,w=!1}if(M&&!w)return v||(v=new r),y||c(t)?i(t,e,n,m,g,v):s(t,e,x,n,m,g,v);if(!(1&n)){var E=w&&f.call(t,"__wrapped__"),T=S&&f.call(e,"__wrapped__");if(E||T){var A=E?t.value():t,C=T?e.value():e;return v||(v=new r),g(A,C,n,m,v)}}return!!M&&(v||(v=new r),o(t,e,n,m,g,v))}},64033:function(t,e,n){var r=n(81887),i=n(55073);t.exports=function(t){return i(t)&&"[object Map]"==r(t)}},27122:function(t,e,n){var r=n(5929),i=n(6620);t.exports=function(t,e,n,s){var o=n.length,a=o,l=!s;if(null==t)return!a;for(t=Object(t);o--;){var u=n[o];if(l&&u[2]?u[1]!==t[u[0]]:!(u[0]in t))return!1}for(;++o<a;){var c=(u=n[o])[0],h=t[c],d=u[1];if(l&&u[2]){if(void 0===h&&!(c in t))return!1}else{var p=new r;if(s)var f=s(h,d,c,t,e,p);if(!(void 0===f?i(d,h,3,s,p):f))return!1}}return!0}},99940:function(t){t.exports=function(t){return t!=t}},58939:function(t,e,n){var r=n(92042),i=n(90654),s=n(36838),o=n(51059),a=/^\[object .+?Constructor\]$/,l=Function.prototype,u=Object.prototype,c=l.toString,h=u.hasOwnProperty,d=RegExp("^"+c.call(h).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");t.exports=function(t){return!(!s(t)||i(t))&&(r(t)?d:a).test(o(t))}},28264:function(t,e,n){var r=n(81887),i=n(55073);t.exports=function(t){return i(t)&&"[object Set]"==r(t)}},22882:function(t,e,n){var r=n(80732),i=n(17216),s=n(55073),o={};o["[object Float32Array]"]=o["[object Float64Array]"]=o["[object Int8Array]"]=o["[object Int16Array]"]=o["[object Int32Array]"]=o["[object Uint8Array]"]=o["[object Uint8ClampedArray]"]=o["[object Uint16Array]"]=o["[object Uint32Array]"]=!0,o["[object Arguments]"]=o["[object Array]"]=o["[object ArrayBuffer]"]=o["[object Boolean]"]=o["[object DataView]"]=o["[object Date]"]=o["[object Error]"]=o["[object Function]"]=o["[object Map]"]=o["[object Number]"]=o["[object Object]"]=o["[object RegExp]"]=o["[object Set]"]=o["[object String]"]=o["[object WeakMap]"]=!1,t.exports=function(t){return s(t)&&i(t.length)&&!!o[r(t)]}},5673:function(t,e,n){var r=n(3772),i=n(30493),s=n(48148),o=n(24669),a=n(51798);t.exports=function(t){return"function"==typeof t?t:null==t?s:"object"==typeof t?o(t)?i(t[0],t[1]):r(t):a(t)}},87473:function(t,e,n){var r=n(92963),i=n(14457),s=Object.prototype.hasOwnProperty;t.exports=function(t){if(!r(t))return i(t);var e=[];for(var n in Object(t))s.call(t,n)&&"constructor"!=n&&e.push(n);return e}},52506:function(t,e,n){var r=n(36838),i=n(92963),s=n(10814),o=Object.prototype.hasOwnProperty;t.exports=function(t){if(!r(t))return s(t);var e=i(t),n=[];for(var a in t)("constructor"!=a||!e&&o.call(t,a))&&n.push(a);return n}},42800:function(t){t.exports=function(t,e){return t<e}},66494:function(t,e,n){var r=n(30438),i=n(47428);t.exports=function(t,e){var n=-1,s=i(t)?Array(t.length):[];return r(t,(function(t,r,i){s[++n]=e(t,r,i)})),s}},3772:function(t,e,n){var r=n(27122),i=n(67487),s=n(78857);t.exports=function(t){var e=i(t);return 1==e.length&&e[0][2]?s(e[0][0],e[0][1]):function(n){return n===t||r(n,t,e)}}},30493:function(t,e,n){var r=n(6620),i=n(65439),s=n(28281),o=n(2610),a=n(92769),l=n(78857),u=n(77817);t.exports=function(t,e){return o(t)&&a(e)?l(u(t),e):function(n){var o=i(n,t);return void 0===o&&o===e?s(n,t):r(e,o,3)}}},97254:function(t,e,n){var r=n(5929),i=n(72340),s=n(91030),o=n(10715),a=n(36838),l=n(37390),u=n(72014);t.exports=function t(e,n,c,h,d){e!==n&&s(n,(function(s,l){if(d||(d=new r),a(s))o(e,n,l,c,t,h,d);else{var p=h?h(u(e,l),s,l+"",e,n,d):void 0;void 0===p&&(p=s),i(e,l,p)}}),l)}},10715:function(t,e,n){var r=n(72340),i=n(39767),s=n(27136),o=n(47165),a=n(36404),l=n(30353),u=n(24669),c=n(57348),h=n(61563),d=n(92042),p=n(36838),f=n(69143),m=n(73806),g=n(72014),v=n(85111);t.exports=function(t,e,n,y,_,x,b){var w=g(t,n),S=g(e,n),M=b.get(S);if(M)r(t,n,M);else{var E=x?x(w,S,n+"",t,e,b):void 0,T=void 0===E;if(T){var A=u(S),C=!A&&h(S),R=!A&&!C&&m(S);E=S,A||C||R?u(w)?E=w:c(w)?E=o(w):C?(T=!1,E=i(S,!0)):R?(T=!1,E=s(S,!0)):E=[]:f(S)||l(S)?(E=w,l(w)?E=v(w):p(w)&&!d(w)||(E=a(S))):T=!1}T&&(b.set(S,E),_(E,S,y,x,b),b.delete(S)),r(t,n,E)}}},84994:function(t,e,n){var r=n(75697),i=n(97499),s=n(5673),o=n(66494),a=n(16584),l=n(58792),u=n(35395),c=n(48148),h=n(24669);t.exports=function(t,e,n){e=e.length?r(e,(function(t){return h(t)?function(e){return i(e,1===t.length?t[0]:t)}:t})):[c];var d=-1;e=r(e,l(s));var p=o(t,(function(t,n,i){return{criteria:r(e,(function(e){return e(t)})),index:++d,value:t}}));return a(p,(function(t,e){return u(t,e,n)}))}},54822:function(t,e,n){var r=n(32648),i=n(28281);t.exports=function(t,e){return r(t,e,(function(e,n){return i(t,n)}))}},32648:function(t,e,n){var r=n(97499),i=n(85713),s=n(60399);t.exports=function(t,e,n){for(var o=-1,a=e.length,l={};++o<a;){var u=e[o],c=r(t,u);n(c,u)&&i(l,s(u,t),c)}return l}},17498:function(t){t.exports=function(t){return function(e){return null==e?void 0:e[t]}}},71e3:function(t,e,n){var r=n(97499);t.exports=function(t){return function(e){return r(e,t)}}},5108:function(t){var e=Math.ceil,n=Math.max;t.exports=function(t,r,i,s){for(var o=-1,a=n(e((r-t)/(i||1)),0),l=Array(a);a--;)l[s?a:++o]=t,t+=i;return l}},75857:function(t){t.exports=function(t,e,n,r,i){return i(t,(function(t,i,s){n=r?(r=!1,t):e(n,t,i,s)})),n}},5125:function(t,e,n){var r=n(48148),i=n(20323),s=n(71564);t.exports=function(t,e){return s(i(t,e,r),t+"")}},85713:function(t,e,n){var r=n(93719),i=n(60399),s=n(91010),o=n(36838),a=n(77817);t.exports=function(t,e,n,l){if(!o(t))return t;for(var u=-1,c=(e=i(e,t)).length,h=c-1,d=t;null!=d&&++u<c;){var p=a(e[u]),f=n;if("__proto__"===p||"constructor"===p||"prototype"===p)return t;if(u!=h){var m=d[p];void 0===(f=l?l(m,p,d):void 0)&&(f=o(m)?m:s(e[u+1])?[]:{})}r(d,p,f),d=d[p]}return t}},56447:function(t,e,n){var r=n(64806),i=n(34082),s=n(48148),o=i?function(t,e){return i(t,"toString",{configurable:!0,enumerable:!1,value:r(e),writable:!0})}:s;t.exports=o},16584:function(t){t.exports=function(t,e){var n=t.length;for(t.sort(e);n--;)t[n]=t[n].value;return t}},39739:function(t){t.exports=function(t,e){for(var n=-1,r=Array(t);++n<t;)r[n]=e(n);return r}},73150:function(t,e,n){var r=n(74396),i=n(75697),s=n(24669),o=n(16764),a=r?r.prototype:void 0,l=a?a.toString:void 0;t.exports=function t(e){if("string"==typeof e)return e;if(s(e))return i(e,t)+"";if(o(e))return l?l.call(e):"";var n=e+"";return"0"==n&&1/e==-Infinity?"-0":n}},33124:function(t,e,n){var r=n(82996),i=/^\s+/;t.exports=function(t){return t?t.slice(0,r(t)+1).replace(i,""):t}},58792:function(t){t.exports=function(t){return function(e){return t(e)}}},95453:function(t,e,n){var r=n(78188),i=n(45170),s=n(94936),o=n(29880),a=n(17319),l=n(79967);t.exports=function(t,e,n){var u=-1,c=i,h=t.length,d=!0,p=[],f=p;if(n)d=!1,c=s;else if(h>=200){var m=e?null:a(t);if(m)return l(m);d=!1,c=o,f=new r}else f=e?[]:p;t:for(;++u<h;){var g=t[u],v=e?e(g):g;if(g=n||0!==g?g:0,d&&v==v){for(var y=f.length;y--;)if(f[y]===v)continue t;e&&f.push(v),p.push(g)}else c(f,v,n)||(f!==p&&f.push(v),p.push(g))}return p}},44290:function(t,e,n){var r=n(75697);t.exports=function(t,e){return r(e,(function(e){return t[e]}))}},59654:function(t){t.exports=function(t,e,n){for(var r=-1,i=t.length,s=e.length,o={};++r<i;){var a=r<s?e[r]:void 0;n(o,t[r],a)}return o}},29880:function(t){t.exports=function(t,e){return t.has(e)}},97008:function(t,e,n){var r=n(48148);t.exports=function(t){return"function"==typeof t?t:r}},60399:function(t,e,n){var r=n(24669),i=n(2610),s=n(77057),o=n(8389);t.exports=function(t,e){return r(t)?t:i(t,e)?[t]:s(o(t))}},78925:function(t,e,n){var r=n(92210);t.exports=function(t){var e=new t.constructor(t.byteLength);return new r(e).set(new r(t)),e}},39767:function(t,e,n){t=n.nmd(t);var r=n(29165),i=e&&!e.nodeType&&e,s=i&&t&&!t.nodeType&&t,o=s&&s.exports===i?r.Buffer:void 0,a=o?o.allocUnsafe:void 0;t.exports=function(t,e){if(e)return t.slice();var n=t.length,r=a?a(n):new t.constructor(n);return t.copy(r),r}},56157:function(t,e,n){var r=n(78925);t.exports=function(t,e){var n=e?r(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.byteLength)}},80101:function(t){var e=/\w*$/;t.exports=function(t){var n=new t.constructor(t.source,e.exec(t));return n.lastIndex=t.lastIndex,n}},54920:function(t,e,n){var r=n(74396),i=r?r.prototype:void 0,s=i?i.valueOf:void 0;t.exports=function(t){return s?Object(s.call(t)):{}}},27136:function(t,e,n){var r=n(78925);t.exports=function(t,e){var n=e?r(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.length)}},24687:function(t,e,n){var r=n(16764);t.exports=function(t,e){if(t!==e){var n=void 0!==t,i=null===t,s=t==t,o=r(t),a=void 0!==e,l=null===e,u=e==e,c=r(e);if(!l&&!c&&!o&&t>e||o&&a&&u&&!l&&!c||i&&a&&u||!n&&u||!s)return 1;if(!i&&!o&&!c&&t<e||c&&n&&s&&!i&&!o||l&&n&&s||!a&&s||!u)return-1}return 0}},35395:function(t,e,n){var r=n(24687);t.exports=function(t,e,n){for(var i=-1,s=t.criteria,o=e.criteria,a=s.length,l=n.length;++i<a;){var u=r(s[i],o[i]);if(u)return i>=l?u:u*("desc"==n[i]?-1:1)}return t.index-e.index}},47165:function(t){t.exports=function(t,e){var n=-1,r=t.length;for(e||(e=Array(r));++n<r;)e[n]=t[n];return e}},92434:function(t,e,n){var r=n(93719),i=n(30404);t.exports=function(t,e,n,s){var o=!n;n||(n={});for(var a=-1,l=e.length;++a<l;){var u=e[a],c=s?s(n[u],t[u],u,n,t):void 0;void 0===c&&(c=t[u]),o?i(n,u,c):r(n,u,c)}return n}},8782:function(t,e,n){var r=n(92434),i=n(97482);t.exports=function(t,e){return r(t,i(t),e)}},2667:function(t,e,n){var r=n(92434),i=n(41288);t.exports=function(t,e){return r(t,i(t),e)}},36633:function(t,e,n){var r=n(29165)["__core-js_shared__"];t.exports=r},77991:function(t,e,n){var r=n(5125),i=n(97616);t.exports=function(t){return r((function(e,n){var r=-1,s=n.length,o=s>1?n[s-1]:void 0,a=s>2?n[2]:void 0;for(o=t.length>3&&"function"==typeof o?(s--,o):void 0,a&&i(n[0],n[1],a)&&(o=s<3?void 0:o,s=1),e=Object(e);++r<s;){var l=n[r];l&&t(e,l,r,o)}return e}))}},4118:function(t,e,n){var r=n(47428);t.exports=function(t,e){return function(n,i){if(null==n)return n;if(!r(n))return t(n,i);for(var s=n.length,o=e?s:-1,a=Object(n);(e?o--:++o<s)&&!1!==i(a[o],o,a););return n}}},29:function(t){t.exports=function(t){return function(e,n,r){for(var i=-1,s=Object(e),o=r(e),a=o.length;a--;){var l=o[t?a:++i];if(!1===n(s[l],l,s))break}return e}}},34715:function(t,e,n){var r=n(5673),i=n(47428),s=n(50579);t.exports=function(t){return function(e,n,o){var a=Object(e);if(!i(e)){var l=r(n,3);e=s(e),n=function(t){return l(a[t],t,a)}}var u=t(e,n,o);return u>-1?a[l?e[u]:u]:void 0}}},1293:function(t,e,n){var r=n(5108),i=n(97616),s=n(70986);t.exports=function(t){return function(e,n,o){return o&&"number"!=typeof o&&i(e,n,o)&&(n=o=void 0),e=s(e),void 0===n?(n=e,e=0):n=s(n),o=void 0===o?e<n?1:-1:s(o),r(e,n,o,t)}}},17319:function(t,e,n){var r=n(81956),i=n(43226),s=n(79967),o=r&&1/s(new r([,-0]))[1]==1/0?function(t){return new r(t)}:i;t.exports=o},34082:function(t,e,n){var r=n(47758),i=function(){try{var t=r(Object,"defineProperty");return t({},"",{}),t}catch(t){}}();t.exports=i},22684:function(t,e,n){var r=n(78188),i=n(84330),s=n(29880);t.exports=function(t,e,n,o,a,l){var u=1&n,c=t.length,h=e.length;if(c!=h&&!(u&&h>c))return!1;var d=l.get(t),p=l.get(e);if(d&&p)return d==e&&p==t;var f=-1,m=!0,g=2&n?new r:void 0;for(l.set(t,e),l.set(e,t);++f<c;){var v=t[f],y=e[f];if(o)var _=u?o(y,v,f,e,t,l):o(v,y,f,t,e,l);if(void 0!==_){if(_)continue;m=!1;break}if(g){if(!i(e,(function(t,e){if(!s(g,e)&&(v===t||a(v,t,n,o,l)))return g.push(e)}))){m=!1;break}}else if(v!==y&&!a(v,y,n,o,l)){m=!1;break}}return l.delete(t),l.delete(e),m}},7456:function(t,e,n){var r=n(74396),i=n(92210),s=n(42448),o=n(22684),a=n(7523),l=n(79967),u=r?r.prototype:void 0,c=u?u.valueOf:void 0;t.exports=function(t,e,n,r,u,h,d){switch(n){case"[object DataView]":if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case"[object ArrayBuffer]":return!(t.byteLength!=e.byteLength||!h(new i(t),new i(e)));case"[object Boolean]":case"[object Date]":case"[object Number]":return s(+t,+e);case"[object Error]":return t.name==e.name&&t.message==e.message;case"[object RegExp]":case"[object String]":return t==e+"";case"[object Map]":var p=a;case"[object Set]":var f=1&r;if(p||(p=l),t.size!=e.size&&!f)return!1;var m=d.get(t);if(m)return m==e;r|=2,d.set(t,e);var g=o(p(t),p(e),r,u,h,d);return d.delete(t),g;case"[object Symbol]":if(c)return c.call(t)==c.call(e)}return!1}},18120:function(t,e,n){var r=n(69698),i=Object.prototype.hasOwnProperty;t.exports=function(t,e,n,s,o,a){var l=1&n,u=r(t),c=u.length;if(c!=r(e).length&&!l)return!1;for(var h=c;h--;){var d=u[h];if(!(l?d in e:i.call(e,d)))return!1}var p=a.get(t),f=a.get(e);if(p&&f)return p==e&&f==t;var m=!0;a.set(t,e),a.set(e,t);for(var g=l;++h<c;){var v=t[d=u[h]],y=e[d];if(s)var _=l?s(y,v,d,e,t,a):s(v,y,d,t,e,a);if(!(void 0===_?v===y||o(v,y,n,s,a):_)){m=!1;break}g||(g="constructor"==d)}if(m&&!g){var x=t.constructor,b=e.constructor;x==b||!("constructor"in t)||!("constructor"in e)||"function"==typeof x&&x instanceof x&&"function"==typeof b&&b instanceof b||(m=!1)}return a.delete(t),a.delete(e),m}},54874:function(t,e,n){var r=n(22612),i=n(20323),s=n(71564);t.exports=function(t){return s(i(t,void 0,r),t+"")}},96476:function(t,e,n){var r="object"==typeof n.g&&n.g&&n.g.Object===Object&&n.g;t.exports=r},69698:function(t,e,n){var r=n(38084),i=n(97482),s=n(50579);t.exports=function(t){return r(t,s,i)}},21699:function(t,e,n){var r=n(38084),i=n(41288),s=n(37390);t.exports=function(t){return r(t,s,i)}},67707:function(t,e,n){var r=n(3880);t.exports=function(t,e){var n=t.__data__;return r(e)?n["string"==typeof e?"string":"hash"]:n.map}},67487:function(t,e,n){var r=n(92769),i=n(50579);t.exports=function(t){for(var e=i(t),n=e.length;n--;){var s=e[n],o=t[s];e[n]=[s,o,r(o)]}return e}},47758:function(t,e,n){var r=n(58939),i=n(9149);t.exports=function(t,e){var n=i(t,e);return r(n)?n:void 0}},11389:function(t,e,n){var r=n(75542)(Object.getPrototypeOf,Object);t.exports=r},31239:function(t,e,n){var r=n(74396),i=Object.prototype,s=i.hasOwnProperty,o=i.toString,a=r?r.toStringTag:void 0;t.exports=function(t){var e=s.call(t,a),n=t[a];try{t[a]=void 0;var r=!0}catch(t){}var i=o.call(t);return r&&(e?t[a]=n:delete t[a]),i}},97482:function(t,e,n){var r=n(48969),i=n(68036),s=Object.prototype.propertyIsEnumerable,o=Object.getOwnPropertySymbols,a=o?function(t){return null==t?[]:(t=Object(t),r(o(t),(function(e){return s.call(t,e)})))}:i;t.exports=a},41288:function(t,e,n){var r=n(28486),i=n(11389),s=n(97482),o=n(68036),a=Object.getOwnPropertySymbols?function(t){for(var e=[];t;)r(e,s(t)),t=i(t);return e}:o;t.exports=a},81887:function(t,e,n){var r=n(87269),i=n(35922),s=n(6795),o=n(81956),a=n(69477),l=n(80732),u=n(51059),c="[object Map]",h="[object Promise]",d="[object Set]",p="[object WeakMap]",f="[object DataView]",m=u(r),g=u(i),v=u(s),y=u(o),_=u(a),x=l;(r&&x(new r(new ArrayBuffer(1)))!=f||i&&x(new i)!=c||s&&x(s.resolve())!=h||o&&x(new o)!=d||a&&x(new a)!=p)&&(x=function(t){var e=l(t),n="[object Object]"==e?t.constructor:void 0,r=n?u(n):"";if(r)switch(r){case m:return f;case g:return c;case v:return h;case y:return d;case _:return p}return e}),t.exports=x},9149:function(t){t.exports=function(t,e){return null==t?void 0:t[e]}},3638:function(t,e,n){var r=n(60399),i=n(30353),s=n(24669),o=n(91010),a=n(17216),l=n(77817);t.exports=function(t,e,n){for(var u=-1,c=(e=r(e,t)).length,h=!1;++u<c;){var d=l(e[u]);if(!(h=null!=t&&n(t,d)))break;t=t[d]}return h||++u!=c?h:!!(c=null==t?0:t.length)&&a(c)&&o(d,c)&&(s(t)||i(t))}},30080:function(t){var e=RegExp("[\\u200d\\ud800-\\udfff\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff\\ufe0e\\ufe0f]");t.exports=function(t){return e.test(t)}},71519:function(t,e,n){var r=n(37722);t.exports=function(){this.__data__=r?r(null):{},this.size=0}},82999:function(t){t.exports=function(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e}},76111:function(t,e,n){var r=n(37722),i=Object.prototype.hasOwnProperty;t.exports=function(t){var e=this.__data__;if(r){var n=e[t];return"__lodash_hash_undefined__"===n?void 0:n}return i.call(e,t)?e[t]:void 0}},50506:function(t,e,n){var r=n(37722),i=Object.prototype.hasOwnProperty;t.exports=function(t){var e=this.__data__;return r?void 0!==e[t]:i.call(e,t)}},80845:function(t,e,n){var r=n(37722);t.exports=function(t,e){var n=this.__data__;return this.size+=this.has(t)?0:1,n[t]=r&&void 0===e?"__lodash_hash_undefined__":e,this}},12195:function(t){var e=Object.prototype.hasOwnProperty;t.exports=function(t){var n=t.length,r=new t.constructor(n);return n&&"string"==typeof t[0]&&e.call(t,"index")&&(r.index=t.index,r.input=t.input),r}},46740:function(t,e,n){var r=n(78925),i=n(56157),s=n(80101),o=n(54920),a=n(27136);t.exports=function(t,e,n){var l=t.constructor;switch(e){case"[object ArrayBuffer]":return r(t);case"[object Boolean]":case"[object Date]":return new l(+t);case"[object DataView]":return i(t,n);case"[object Float32Array]":case"[object Float64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":return a(t,n);case"[object Map]":case"[object Set]":return new l;case"[object Number]":case"[object String]":return new l(t);case"[object RegExp]":return s(t);case"[object Symbol]":return o(t)}}},36404:function(t,e,n){var r=n(91348),i=n(11389),s=n(92963);t.exports=function(t){return"function"!=typeof t.constructor||s(t)?{}:r(i(t))}},89465:function(t,e,n){var r=n(74396),i=n(30353),s=n(24669),o=r?r.isConcatSpreadable:void 0;t.exports=function(t){return s(t)||i(t)||!!(o&&t&&t[o])}},91010:function(t){var e=/^(?:0|[1-9]\d*)$/;t.exports=function(t,n){var r=typeof t;return!!(n=null==n?9007199254740991:n)&&("number"==r||"symbol"!=r&&e.test(t))&&t>-1&&t%1==0&&t<n}},97616:function(t,e,n){var r=n(42448),i=n(47428),s=n(91010),o=n(36838);t.exports=function(t,e,n){if(!o(n))return!1;var a=typeof e;return!!("number"==a?i(n)&&s(e,n.length):"string"==a&&e in n)&&r(n[e],t)}},2610:function(t,e,n){var r=n(24669),i=n(16764),s=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,o=/^\w*$/;t.exports=function(t,e){if(r(t))return!1;var n=typeof t;return!("number"!=n&&"symbol"!=n&&"boolean"!=n&&null!=t&&!i(t))||(o.test(t)||!s.test(t)||null!=e&&t in Object(e))}},3880:function(t){t.exports=function(t){var e=typeof t;return"string"==e||"number"==e||"symbol"==e||"boolean"==e?"__proto__"!==t:null===t}},90654:function(t,e,n){var r,i=n(36633),s=(r=/[^.]+$/.exec(i&&i.keys&&i.keys.IE_PROTO||""))?"Symbol(src)_1."+r:"";t.exports=function(t){return!!s&&s in t}},92963:function(t){var e=Object.prototype;t.exports=function(t){var n=t&&t.constructor;return t===("function"==typeof n&&n.prototype||e)}},92769:function(t,e,n){var r=n(36838);t.exports=function(t){return t==t&&!r(t)}},2173:function(t){t.exports=function(){this.__data__=[],this.size=0}},33752:function(t,e,n){var r=n(62718),i=Array.prototype.splice;t.exports=function(t){var e=this.__data__,n=r(e,t);return!(n<0)&&(n==e.length-1?e.pop():i.call(e,n,1),--this.size,!0)}},10548:function(t,e,n){var r=n(62718);t.exports=function(t){var e=this.__data__,n=r(e,t);return n<0?void 0:e[n][1]}},63410:function(t,e,n){var r=n(62718);t.exports=function(t){return r(this.__data__,t)>-1}},3564:function(t,e,n){var r=n(62718);t.exports=function(t,e){var n=this.__data__,i=r(n,t);return i<0?(++this.size,n.push([t,e])):n[i][1]=e,this}},7140:function(t,e,n){var r=n(88987),i=n(175),s=n(35922);t.exports=function(){this.size=0,this.__data__={hash:new r,map:new(s||i),string:new r}}},56504:function(t,e,n){var r=n(67707);t.exports=function(t){var e=r(this,t).delete(t);return this.size-=e?1:0,e}},88833:function(t,e,n){var r=n(67707);t.exports=function(t){return r(this,t).get(t)}},80953:function(t,e,n){var r=n(67707);t.exports=function(t){return r(this,t).has(t)}},70724:function(t,e,n){var r=n(67707);t.exports=function(t,e){var n=r(this,t),i=n.size;return n.set(t,e),this.size+=n.size==i?0:1,this}},7523:function(t){t.exports=function(t){var e=-1,n=Array(t.size);return t.forEach((function(t,r){n[++e]=[r,t]})),n}},78857:function(t){t.exports=function(t,e){return function(n){return null!=n&&(n[t]===e&&(void 0!==e||t in Object(n)))}}},45171:function(t,e,n){var r=n(34736);t.exports=function(t){var e=r(t,(function(t){return 500===n.size&&n.clear(),t})),n=e.cache;return e}},37722:function(t,e,n){var r=n(47758)(Object,"create");t.exports=r},14457:function(t,e,n){var r=n(75542)(Object.keys,Object);t.exports=r},10814:function(t){t.exports=function(t){var e=[];if(null!=t)for(var n in Object(t))e.push(n);return e}},8478:function(t,e,n){t=n.nmd(t);var r=n(96476),i=e&&!e.nodeType&&e,s=i&&t&&!t.nodeType&&t,o=s&&s.exports===i&&r.process,a=function(){try{var t=s&&s.require&&s.require("util").types;return t||o&&o.binding&&o.binding("util")}catch(t){}}();t.exports=a},57058:function(t){var e=Object.prototype.toString;t.exports=function(t){return e.call(t)}},75542:function(t){t.exports=function(t,e){return function(n){return t(e(n))}}},20323:function(t,e,n){var r=n(93501),i=Math.max;t.exports=function(t,e,n){return e=i(void 0===e?t.length-1:e,0),function(){for(var s=arguments,o=-1,a=i(s.length-e,0),l=Array(a);++o<a;)l[o]=s[e+o];o=-1;for(var u=Array(e+1);++o<e;)u[o]=s[o];return u[e]=n(l),r(t,this,u)}}},29165:function(t,e,n){var r=n(96476),i="object"==typeof self&&self&&self.Object===Object&&self,s=r||i||Function("return this")();t.exports=s},72014:function(t){t.exports=function(t,e){if(("constructor"!==e||"function"!=typeof t[e])&&"__proto__"!=e)return t[e]}},96659:function(t){t.exports=function(t){return this.__data__.set(t,"__lodash_hash_undefined__"),this}},97230:function(t){t.exports=function(t){return this.__data__.has(t)}},79967:function(t){t.exports=function(t){var e=-1,n=Array(t.size);return t.forEach((function(t){n[++e]=t})),n}},71564:function(t,e,n){var r=n(56447),i=n(15509)(r);t.exports=i},15509:function(t){var e=Date.now;t.exports=function(t){var n=0,r=0;return function(){var i=e(),s=16-(i-r);if(r=i,s>0){if(++n>=800)return arguments[0]}else n=0;return t.apply(void 0,arguments)}}},40551:function(t,e,n){var r=n(175);t.exports=function(){this.__data__=new r,this.size=0}},4090:function(t){t.exports=function(t){var e=this.__data__,n=e.delete(t);return this.size=e.size,n}},47694:function(t){t.exports=function(t){return this.__data__.get(t)}},86220:function(t){t.exports=function(t){return this.__data__.has(t)}},68958:function(t,e,n){var r=n(175),i=n(35922),s=n(9440);t.exports=function(t,e){var n=this.__data__;if(n instanceof r){var o=n.__data__;if(!i||o.length<199)return o.push([t,e]),this.size=++n.size,this;n=this.__data__=new s(o)}return n.set(t,e),this.size=n.size,this}},3729:function(t){t.exports=function(t,e,n){for(var r=n-1,i=t.length;++r<i;)if(t[r]===e)return r;return-1}},68905:function(t,e,n){var r=n(15989),i=n(30080),s=n(43352);t.exports=function(t){return i(t)?s(t):r(t)}},77057:function(t,e,n){var r=n(45171),i=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,s=/\\(\\)?/g,o=r((function(t){var e=[];return 46===t.charCodeAt(0)&&e.push(""),t.replace(i,(function(t,n,r,i){e.push(r?i.replace(s,"$1"):n||t)})),e}));t.exports=o},77817:function(t,e,n){var r=n(16764);t.exports=function(t){if("string"==typeof t||r(t))return t;var e=t+"";return"0"==e&&1/t==-Infinity?"-0":e}},51059:function(t){var e=Function.prototype.toString;t.exports=function(t){if(null!=t){try{return e.call(t)}catch(t){}try{return t+""}catch(t){}}return""}},82996:function(t){var e=/\s/;t.exports=function(t){for(var n=t.length;n--&&e.test(t.charAt(n)););return n}},43352:function(t){var e="\\ud800-\\udfff",n="["+e+"]",r="[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]",i="\\ud83c[\\udffb-\\udfff]",s="[^"+e+"]",o="(?:\\ud83c[\\udde6-\\uddff]){2}",a="[\\ud800-\\udbff][\\udc00-\\udfff]",l="(?:"+r+"|"+i+")"+"?",u="[\\ufe0e\\ufe0f]?",c=u+l+("(?:\\u200d(?:"+[s,o,a].join("|")+")"+u+l+")*"),h="(?:"+[s+r+"?",r,o,a,n].join("|")+")",d=RegExp(i+"(?="+i+")|"+h+c,"g");t.exports=function(t){for(var e=d.lastIndex=0;d.test(t);)++e;return e}},55824:function(t,e,n){var r=n(67410);t.exports=function(t){return r(t,4)}},32222:function(t,e,n){var r=n(67410);t.exports=function(t){return r(t,5)}},64806:function(t){t.exports=function(t){return function(){return t}}},91099:function(t,e,n){var r=n(5125),i=n(42448),s=n(97616),o=n(37390),a=Object.prototype,l=a.hasOwnProperty,u=r((function(t,e){t=Object(t);var n=-1,r=e.length,u=r>2?e[2]:void 0;for(u&&s(e[0],e[1],u)&&(r=1);++n<r;)for(var c=e[n],h=o(c),d=-1,p=h.length;++d<p;){var f=h[d],m=t[f];(void 0===m||i(m,a[f])&&!l.call(t,f))&&(t[f]=c[f])}return t}));t.exports=u},15828:function(t,e,n){t.exports=n(17489)},42448:function(t){t.exports=function(t,e){return t===e||t!=t&&e!=e}},3149:function(t,e,n){var r=n(48969),i=n(88286),s=n(5673),o=n(24669);t.exports=function(t,e){return(o(t)?r:i)(t,s(e,3))}},33170:function(t,e,n){var r=n(34715)(n(33886));t.exports=r},33886:function(t,e,n){var r=n(92504),i=n(5673),s=n(20426),o=Math.max;t.exports=function(t,e,n){var a=null==t?0:t.length;if(!a)return-1;var l=null==n?0:s(n);return l<0&&(l=o(a+l,0)),r(t,i(e,3),l)}},22612:function(t,e,n){var r=n(98768);t.exports=function(t){return(null==t?0:t.length)?r(t,1):[]}},17489:function(t,e,n){var r=n(21662),i=n(30438),s=n(97008),o=n(24669);t.exports=function(t,e){return(o(t)?r:i)(t,s(e))}},37229:function(t,e,n){var r=n(91030),i=n(97008),s=n(37390);t.exports=function(t,e){return null==t?t:r(t,i(e),s)}},65439:function(t,e,n){var r=n(97499);t.exports=function(t,e,n){var i=null==t?void 0:r(t,e);return void 0===i?n:i}},56611:function(t,e,n){var r=n(45435),i=n(3638);t.exports=function(t,e){return null!=t&&i(t,e,r)}},28281:function(t,e,n){var r=n(71664),i=n(3638);t.exports=function(t,e){return null!=t&&i(t,e,r)}},48148:function(t){t.exports=function(t){return t}},30353:function(t,e,n){var r=n(84742),i=n(55073),s=Object.prototype,o=s.hasOwnProperty,a=s.propertyIsEnumerable,l=r(function(){return arguments}())?r:function(t){return i(t)&&o.call(t,"callee")&&!a.call(t,"callee")};t.exports=l},24669:function(t){var e=Array.isArray;t.exports=e},47428:function(t,e,n){var r=n(92042),i=n(17216);t.exports=function(t){return null!=t&&i(t.length)&&!r(t)}},57348:function(t,e,n){var r=n(47428),i=n(55073);t.exports=function(t){return i(t)&&r(t)}},61563:function(t,e,n){t=n.nmd(t);var r=n(29165),i=n(84193),s=e&&!e.nodeType&&e,o=s&&t&&!t.nodeType&&t,a=o&&o.exports===s?r.Buffer:void 0,l=(a?a.isBuffer:void 0)||i;t.exports=l},82691:function(t,e,n){var r=n(87473),i=n(81887),s=n(30353),o=n(24669),a=n(47428),l=n(61563),u=n(92963),c=n(73806),h=Object.prototype.hasOwnProperty;t.exports=function(t){if(null==t)return!0;if(a(t)&&(o(t)||"string"==typeof t||"function"==typeof t.splice||l(t)||c(t)||s(t)))return!t.length;var e=i(t);if("[object Map]"==e||"[object Set]"==e)return!t.size;if(u(t))return!r(t).length;for(var n in t)if(h.call(t,n))return!1;return!0}},92042:function(t,e,n){var r=n(80732),i=n(36838);t.exports=function(t){if(!i(t))return!1;var e=r(t);return"[object Function]"==e||"[object GeneratorFunction]"==e||"[object AsyncFunction]"==e||"[object Proxy]"==e}},17216:function(t){t.exports=function(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=9007199254740991}},32924:function(t,e,n){var r=n(64033),i=n(58792),s=n(8478),o=s&&s.isMap,a=o?i(o):r;t.exports=a},36838:function(t){t.exports=function(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)}},55073:function(t){t.exports=function(t){return null!=t&&"object"==typeof t}},69143:function(t,e,n){var r=n(80732),i=n(11389),s=n(55073),o=Function.prototype,a=Object.prototype,l=o.toString,u=a.hasOwnProperty,c=l.call(Object);t.exports=function(t){if(!s(t)||"[object Object]"!=r(t))return!1;var e=i(t);if(null===e)return!0;var n=u.call(e,"constructor")&&e.constructor;return"function"==typeof n&&n instanceof n&&l.call(n)==c}},45380:function(t,e,n){var r=n(28264),i=n(58792),s=n(8478),o=s&&s.isSet,a=o?i(o):r;t.exports=a},56549:function(t,e,n){var r=n(80732),i=n(24669),s=n(55073);t.exports=function(t){return"string"==typeof t||!i(t)&&s(t)&&"[object String]"==r(t)}},16764:function(t,e,n){var r=n(80732),i=n(55073);t.exports=function(t){return"symbol"==typeof t||i(t)&&"[object Symbol]"==r(t)}},73806:function(t,e,n){var r=n(22882),i=n(58792),s=n(8478),o=s&&s.isTypedArray,a=o?i(o):r;t.exports=a},89300:function(t){t.exports=function(t){return void 0===t}},50579:function(t,e,n){var r=n(79809),i=n(87473),s=n(47428);t.exports=function(t){return s(t)?r(t):i(t)}},37390:function(t,e,n){var r=n(79809),i=n(52506),s=n(47428);t.exports=function(t){return s(t)?r(t,!0):i(t)}},25674:function(t){t.exports=function(t){var e=null==t?0:t.length;return e?t[e-1]:void 0}},65512:function(t,e,n){var r=n(75697),i=n(5673),s=n(66494),o=n(24669);t.exports=function(t,e){return(o(t)?r:s)(t,i(e,3))}},65632:function(t,e,n){var r=n(30404),i=n(61343),s=n(5673);t.exports=function(t,e){var n={};return e=s(e,3),i(t,(function(t,i,s){r(n,i,e(t,i,s))})),n}},80212:function(t,e,n){var r=n(24210),i=n(39491),s=n(48148);t.exports=function(t){return t&&t.length?r(t,s,i):void 0}},34736:function(t,e,n){var r=n(9440);function i(t,e){if("function"!=typeof t||null!=e&&"function"!=typeof e)throw new TypeError("Expected a function");var n=function(){var r=arguments,i=e?e.apply(this,r):r[0],s=n.cache;if(s.has(i))return s.get(i);var o=t.apply(this,r);return n.cache=s.set(i,o)||s,o};return n.cache=new(i.Cache||r),n}i.Cache=r,t.exports=i},67929:function(t,e,n){var r=n(97254),i=n(77991)((function(t,e,n){r(t,e,n)}));t.exports=i},71516:function(t,e,n){var r=n(24210),i=n(42800),s=n(48148);t.exports=function(t){return t&&t.length?r(t,s,i):void 0}},88371:function(t,e,n){var r=n(24210),i=n(5673),s=n(42800);t.exports=function(t,e){return t&&t.length?r(t,i(e,2),s):void 0}},43226:function(t){t.exports=function(){}},76668:function(t,e,n){var r=n(29165);t.exports=function(){return r.Date.now()}},19334:function(t,e,n){var r=n(54822),i=n(54874)((function(t,e){return null==t?{}:r(t,e)}));t.exports=i},51798:function(t,e,n){var r=n(17498),i=n(71e3),s=n(2610),o=n(77817);t.exports=function(t){return s(t)?r(o(t)):i(t)}},61178:function(t,e,n){var r=n(1293)();t.exports=r},6355:function(t,e,n){var r=n(30695),i=n(30438),s=n(5673),o=n(75857),a=n(24669);t.exports=function(t,e,n){var l=a(t)?r:o,u=arguments.length<3;return l(t,s(e,4),n,u,i)}},81430:function(t,e,n){var r=n(87473),i=n(81887),s=n(47428),o=n(56549),a=n(68905);t.exports=function(t){if(null==t)return 0;if(s(t))return o(t)?a(t):t.length;var e=i(t);return"[object Map]"==e||"[object Set]"==e?t.size:r(t).length}},84715:function(t,e,n){var r=n(98768),i=n(84994),s=n(5125),o=n(97616),a=s((function(t,e){if(null==t)return[];var n=e.length;return n>1&&o(t,e[0],e[1])?e=[]:n>2&&o(e[0],e[1],e[2])&&(e=[e[0]]),i(t,r(e,1),[])}));t.exports=a},68036:function(t){t.exports=function(){return[]}},84193:function(t){t.exports=function(){return!1}},70986:function(t,e,n){var r=n(12448),i=1/0;t.exports=function(t){return t?(t=r(t))===i||t===-1/0?17976931348623157e292*(t<0?-1:1):t==t?t:0:0===t?t:0}},20426:function(t,e,n){var r=n(70986);t.exports=function(t){var e=r(t),n=e%1;return e==e?n?e-n:e:0}},12448:function(t,e,n){var r=n(33124),i=n(36838),s=n(16764),o=/^[-+]0x[0-9a-f]+$/i,a=/^0b[01]+$/i,l=/^0o[0-7]+$/i,u=parseInt;t.exports=function(t){if("number"==typeof t)return t;if(s(t))return NaN;if(i(t)){var e="function"==typeof t.valueOf?t.valueOf():t;t=i(e)?e+"":e}if("string"!=typeof t)return 0===t?t:+t;t=r(t);var n=a.test(t);return n||l.test(t)?u(t.slice(2),n?2:8):o.test(t)?NaN:+t}},85111:function(t,e,n){var r=n(92434),i=n(37390);t.exports=function(t){return r(t,i(t))}},8389:function(t,e,n){var r=n(73150);t.exports=function(t){return null==t?"":r(t)}},68742:function(t,e,n){var r=n(21662),i=n(91348),s=n(61343),o=n(5673),a=n(11389),l=n(24669),u=n(61563),c=n(92042),h=n(36838),d=n(73806);t.exports=function(t,e,n){var p=l(t),f=p||u(t)||d(t);if(e=o(e,4),null==n){var m=t&&t.constructor;n=f?p?new m:[]:h(t)&&c(m)?i(a(t)):{}}return(f?r:s)(t,(function(t,r,i){return e(n,t,r,i)})),n}},29974:function(t,e,n){var r=n(98768),i=n(5125),s=n(95453),o=n(57348),a=i((function(t){return s(r(t,1,o,!0))}));t.exports=a},53274:function(t,e,n){var r=n(8389),i=0;t.exports=function(t){var e=++i;return r(t)+e}},61017:function(t,e,n){var r=n(44290),i=n(50579);t.exports=function(t){return null==t?[]:r(t,i(t))}},64058:function(t,e,n){var r=n(93719),i=n(59654);t.exports=function(t,e){return i(t||[],e||[],r)}},73971:function(t){t.exports=function(t){!function(t){if(!t)throw new Error("Eventify cannot use falsy object as events subject");for(var e=["on","fire","off"],n=0;n<e.length;++n)if(t.hasOwnProperty(e[n]))throw new Error("Subject cannot be eventified, since it already has property '"+e[n]+"'")}(t);var e=function(t){var e=Object.create(null);return{on:function(n,r,i){if("function"!=typeof r)throw new Error("callback is expected to be a function");var s=e[n];return s||(s=e[n]=[]),s.push({callback:r,ctx:i}),t},off:function(n,r){if(void 0===n)return e=Object.create(null),t;if(e[n])if("function"!=typeof r)delete e[n];else for(var i=e[n],s=0;s<i.length;++s)i[s].callback===r&&i.splice(s,1);return t},fire:function(n){var r,i=e[n];if(!i)return t;arguments.length>1&&(r=Array.prototype.splice.call(arguments,1));for(var s=0;s<i.length;++s){var o=i[s];o.callback.apply(o.ctx,r)}return t}}}(t);return t.on=e.on,t.off=e.off,t.fire=e.fire,t}},88291:function(t,e,n){t.exports=function(t,e){if(!t)throw new Error("Graph structure cannot be undefined");var s=(e&&e.createSimulator||n(71985))(e);if(Array.isArray(e))throw new Error("Physics settings is expected to be an object");var o=t.version>19?function(e){var n=t.getLinks(e);return n?1+n.size/3:1}:function(e){var n=t.getLinks(e);return n?1+n.length/3:1};e&&"function"==typeof e.nodeMass&&(o=e.nodeMass);var a=new Map,l={},u=0,c=s.settings.springTransform||i;u=0,t.forEachNode((function(t){g(t.id),u+=1})),t.forEachLink(y),t.on("changed",m);var h=!1,d={step:function(){if(0===u)return p(!0),!0;var t=s.step();d.lastMove=t,d.fire("step");var e=t/u<=.01;return p(e),e},getNodePosition:function(t){return b(t).pos},setNodePosition:function(t){var e=b(t);e.setPosition.apply(e,Array.prototype.slice.call(arguments,1))},getLinkPosition:function(t){var e=l[t];if(e)return{from:e.from.pos,to:e.to.pos}},getGraphRect:function(){return s.getBBox()},forEachBody:f,pinNode:function(t,e){b(t.id).isPinned=!!e},isNodePinned:function(t){return b(t.id).isPinned},dispose:function(){t.off("changed",m),d.fire("disposed")},getBody:function(t){return a.get(t)},getSpring:function(e,n){var r;if(void 0===n)r="object"!=typeof e?e:e.id;else{var i=t.hasLink(e,n);if(!i)return;r=i.id}return l[r]},getForceVectorLength:function(){var t=0,e=0;return f((function(n){t+=Math.abs(n.force.x),e+=Math.abs(n.force.y)})),Math.sqrt(t*t+e*e)},simulator:s,graph:t,lastMove:0};return r(d),d;function p(t){var e;h!==t&&(h=t,e=t,d.fire("stable",e))}function f(t){a.forEach(t)}function m(e){for(var n=0;n<e.length;++n){var r=e[n];"add"===r.changeType?(r.node&&g(r.node.id),r.link&&y(r.link)):"remove"===r.changeType&&(r.node&&v(r.node),r.link&&_(r.link))}u=t.getNodesCount()}function g(e){var n=a.get(e);if(!n){var r=t.getNode(e);if(!r)throw new Error("initBody() was called with unknown node id");var i=r.position;if(!i){var o=function(t){var e=[];if(!t.links)return e;for(var n=Math.min(t.links.length,2),r=0;r<n;++r){var i=t.links[r],s=i.fromId!==t.id?a.get(i.fromId):a.get(i.toId);s&&s.pos&&e.push(s)}return e}(r);i=s.getBestNewBodyPosition(o)}(n=s.addBodyAt(i)).id=e,a.set(e,n),x(e),function(t){return t&&(t.isPinned||t.data&&t.data.isPinned)}(r)&&(n.isPinned=!0)}}function v(t){var e=t.id,n=a.get(e);n&&(a.delete(e),s.removeBody(n))}function y(t){x(t.fromId),x(t.toId);var e=a.get(t.fromId),n=a.get(t.toId),r=s.addSpring(e,n,t.length);c(t,r),l[t.id]=r}function _(e){var n=l[e.id];if(n){var r=t.getNode(e.fromId),i=t.getNode(e.toId);r&&x(r.id),i&&x(i.id),delete l[e.id],s.removeSpring(n)}}function x(t){var e=a.get(t);if(e.mass=o(t),Number.isNaN(e.mass))throw new Error("Node mass should be a number")}function b(t){var e=a.get(t);return e||(g(t),e=a.get(t)),e}},t.exports.simulator=n(71985);var r=n(73971);function i(){}},36974:function(t,e,n){const r=n(40552);t.exports=function(t){return function(e,n){let i=n&&n.indent||0,s=n&&void 0!==n.join?n.join:"\n",o=Array(i+1).join(" "),a=[];for(let n=0;n<t;++n){let t=r(n),i=0===n?"":o;a.push(i+e.replace(/{var}/g,t))}return a.join(s)}}},62835:function(t,e,n){t.exports=function(t){let e=i(t);return new Function("bodies","settings","random",e)},t.exports.generateFunctionBody=i;const r=n(36974);function i(t){let e=r(t);return`\n  var boundingBox = {\n    ${e("min_{var}: 0, max_{var}: 0,",{indent:4})}\n  };\n\n  return {\n    box: boundingBox,\n\n    update: updateBoundingBox,\n\n    reset: resetBoundingBox,\n\n    getBestNewPosition: function (neighbors) {\n      var ${e("base_{var} = 0",{join:", "})};\n\n      if (neighbors.length) {\n        for (var i = 0; i < neighbors.length; ++i) {\n          let neighborPos = neighbors[i].pos;\n          ${e("base_{var} += neighborPos.{var};",{indent:10})}\n        }\n\n        ${e("base_{var} /= neighbors.length;",{indent:8})}\n      } else {\n        ${e("base_{var} = (boundingBox.min_{var} + boundingBox.max_{var}) / 2;",{indent:8})}\n      }\n\n      var springLength = settings.springLength;\n      return {\n        ${e("{var}: base_{var} + (random.nextDouble() - 0.5) * springLength,",{indent:8})}\n      };\n    }\n  };\n\n  function updateBoundingBox() {\n    var i = bodies.length;\n    if (i === 0) return; // No bodies - no borders.\n\n    ${e("var max_{var} = -Infinity;",{indent:4})}\n    ${e("var min_{var} = Infinity;",{indent:4})}\n\n    while(i--) {\n      // this is O(n), it could be done faster with quadtree, if we check the root node bounds\n      var bodyPos = bodies[i].pos;\n      ${e("if (bodyPos.{var} < min_{var}) min_{var} = bodyPos.{var};",{indent:6})}\n      ${e("if (bodyPos.{var} > max_{var}) max_{var} = bodyPos.{var};",{indent:6})}\n    }\n\n    ${e("boundingBox.min_{var} = min_{var};",{indent:4})}\n    ${e("boundingBox.max_{var} = max_{var};",{indent:4})}\n  }\n\n  function resetBoundingBox() {\n    ${e("boundingBox.min_{var} = boundingBox.max_{var} = 0;",{indent:4})}\n  }\n`}},54821:function(t,e,n){const r=n(36974);function i(t,e){return`\n${o(t,e)}\n${s(t)}\nreturn {Body: Body, Vector: Vector};\n`}function s(t){let e=r(t),n=e("{var}",{join:", "});return`\nfunction Body(${n}) {\n  this.isPinned = false;\n  this.pos = new Vector(${n});\n  this.force = new Vector();\n  this.velocity = new Vector();\n  this.mass = 1;\n\n  this.springCount = 0;\n  this.springLength = 0;\n}\n\nBody.prototype.reset = function() {\n  this.force.reset();\n  this.springCount = 0;\n  this.springLength = 0;\n}\n\nBody.prototype.setPosition = function (${n}) {\n  ${e("this.pos.{var} = {var} || 0;",{indent:2})}\n};`}function o(t,e){let n=r(t),i="";return e&&(i=`${n("\n   var v{var};\nObject.defineProperty(this, '{var}', {\n  set: function(v) { \n    if (!Number.isFinite(v)) throw new Error('Cannot set non-numbers to {var}');\n    v{var} = v; \n  },\n  get: function() { return v{var}; }\n});")}`),`function Vector(${n("{var}",{join:", "})}) {\n  ${i}\n    if (typeof arguments[0] === 'object') {\n      // could be another vector\n      let v = arguments[0];\n      ${n('if (!Number.isFinite(v.{var})) throw new Error("Expected value is not a finite number at Vector constructor ({var})");',{indent:4})}\n      ${n("this.{var} = v.{var};",{indent:4})}\n    } else {\n      ${n('this.{var} = typeof {var} === "number" ? {var} : 0;',{indent:4})}\n    }\n  }\n  \n  Vector.prototype.reset = function () {\n    ${n("this.{var} = ",{join:""})}0;\n  };`}t.exports=function(t,e){let n=i(t,e),{Body:r}=new Function(n)();return r},t.exports.generateCreateBodyFunctionBody=i,t.exports.getVectorCode=o,t.exports.getBodyCode=s},94176:function(t,e,n){const r=n(36974);function i(t){return`\n  if (!Number.isFinite(options.dragCoefficient)) throw new Error('dragCoefficient is not a finite number');\n\n  return {\n    update: function(body) {\n      ${r(t)("body.force.{var} -= options.dragCoefficient * body.velocity.{var};",{indent:6})}\n    }\n  };\n`}t.exports=function(t){let e=i(t);return new Function("options",e)},t.exports.generateCreateDragForceFunctionBody=i},62770:function(t,e,n){const r=n(36974);function i(t){let e=r(t);return`\n  if (!Number.isFinite(options.springCoefficient)) throw new Error('Spring coefficient is not a number');\n  if (!Number.isFinite(options.springLength)) throw new Error('Spring length is not a number');\n\n  return {\n    /**\n     * Updates forces acting on a spring\n     */\n    update: function (spring) {\n      var body1 = spring.from;\n      var body2 = spring.to;\n      var length = spring.length < 0 ? options.springLength : spring.length;\n      ${e("var d{var} = body2.pos.{var} - body1.pos.{var};",{indent:6})}\n      var r = Math.sqrt(${e("d{var} * d{var}",{join:" + "})});\n\n      if (r === 0) {\n        ${e("d{var} = (random.nextDouble() - 0.5) / 50;",{indent:8})}\n        r = Math.sqrt(${e("d{var} * d{var}",{join:" + "})});\n      }\n\n      var d = r - length;\n      var coefficient = ((spring.coefficient > 0) ? spring.coefficient : options.springCoefficient) * d / r;\n\n      ${e("body1.force.{var} += coefficient * d{var}",{indent:6})};\n      body1.springCount += 1;\n      body1.springLength += r;\n\n      ${e("body2.force.{var} -= coefficient * d{var}",{indent:6})};\n      body2.springCount += 1;\n      body2.springLength += r;\n    }\n  };\n`}t.exports=function(t){let e=i(t);return new Function("options","random",e)},t.exports.generateCreateSpringForceFunctionBody=i},16008:function(t,e,n){const r=n(36974);function i(t){let e=r(t);return`\n  var length = bodies.length;\n  if (length === 0) return 0;\n\n  ${e("var d{var} = 0, t{var} = 0;",{indent:2})}\n\n  for (var i = 0; i < length; ++i) {\n    var body = bodies[i];\n    if (body.isPinned) continue;\n\n    if (adaptiveTimeStepWeight && body.springCount) {\n      timeStep = (adaptiveTimeStepWeight * body.springLength/body.springCount);\n    }\n\n    var coeff = timeStep / body.mass;\n\n    ${e("body.velocity.{var} += coeff * body.force.{var};",{indent:4})}\n    ${e("var v{var} = body.velocity.{var};",{indent:4})}\n    var v = Math.sqrt(${e("v{var} * v{var}",{join:" + "})});\n\n    if (v > 1) {\n      // We normalize it so that we move within timeStep range. \n      // for the case when v <= 1 - we let velocity to fade out.\n      ${e("body.velocity.{var} = v{var} / v;",{indent:6})}\n    }\n\n    ${e("d{var} = timeStep * body.velocity.{var};",{indent:4})}\n\n    ${e("body.pos.{var} += d{var};",{indent:4})}\n\n    ${e("t{var} += Math.abs(d{var});",{indent:4})}\n  }\n\n  return (${e("t{var} * t{var}",{join:" + "})})/length;\n`}t.exports=function(t){let e=i(t);return new Function("bodies","timeStep","adaptiveTimeStepWeight",e)},t.exports.generateIntegratorFunctionBody=i},84933:function(t,e,n){const r=n(36974),i=n(40552);function s(t){let e=r(t),n=Math.pow(2,t);return`\n${c()}\n${u(t)}\n${o(t)}\n${l(t)}\n${a(t)}\n\nfunction createQuadTree(options, random) {\n  options = options || {};\n  options.gravity = typeof options.gravity === 'number' ? options.gravity : -1;\n  options.theta = typeof options.theta === 'number' ? options.theta : 0.8;\n\n  var gravity = options.gravity;\n  var updateQueue = [];\n  var insertStack = new InsertStack();\n  var theta = options.theta;\n\n  var nodesCache = [];\n  var currentInCache = 0;\n  var root = newNode();\n\n  return {\n    insertBodies: insertBodies,\n\n    /**\n     * Gets root node if it is present\n     */\n    getRoot: function() {\n      return root;\n    },\n\n    updateBodyForce: update,\n\n    options: function(newOptions) {\n      if (newOptions) {\n        if (typeof newOptions.gravity === 'number') {\n          gravity = newOptions.gravity;\n        }\n        if (typeof newOptions.theta === 'number') {\n          theta = newOptions.theta;\n        }\n\n        return this;\n      }\n\n      return {\n        gravity: gravity,\n        theta: theta\n      };\n    }\n  };\n\n  function newNode() {\n    // To avoid pressure on GC we reuse nodes.\n    var node = nodesCache[currentInCache];\n    if (node) {\n${function(t){let e=[];for(let r=0;r<n;++r)e.push(`${t}quad${r} = null;`);return e.join("\n")}("      node.")}\n      node.body = null;\n      node.mass = ${e("node.mass_{var} = ",{join:""})}0;\n      ${e("node.min_{var} = node.max_{var} = ",{join:""})}0;\n    } else {\n      node = new QuadNode();\n      nodesCache[currentInCache] = node;\n    }\n\n    ++currentInCache;\n    return node;\n  }\n\n  function update(sourceBody) {\n    var queue = updateQueue;\n    var v;\n    ${e("var d{var};",{indent:4})}\n    var r; \n    ${e("var f{var} = 0;",{indent:4})}\n    var queueLength = 1;\n    var shiftIdx = 0;\n    var pushIdx = 1;\n\n    queue[0] = root;\n\n    while (queueLength) {\n      var node = queue[shiftIdx];\n      var body = node.body;\n\n      queueLength -= 1;\n      shiftIdx += 1;\n      var differentBody = (body !== sourceBody);\n      if (body && differentBody) {\n        // If the current node is a leaf node (and it is not source body),\n        // calculate the force exerted by the current node on body, and add this\n        // amount to body's net force.\n        ${e("d{var} = body.pos.{var} - sourceBody.pos.{var};",{indent:8})}\n        r = Math.sqrt(${e("d{var} * d{var}",{join:" + "})});\n\n        if (r === 0) {\n          // Poor man's protection against zero distance.\n          ${e("d{var} = (random.nextDouble() - 0.5) / 50;",{indent:10})}\n          r = Math.sqrt(${e("d{var} * d{var}",{join:" + "})});\n        }\n\n        // This is standard gravitation force calculation but we divide\n        // by r^3 to save two operations when normalizing force vector.\n        v = gravity * body.mass * sourceBody.mass / (r * r * r);\n        ${e("f{var} += v * d{var};",{indent:8})}\n      } else if (differentBody) {\n        // Otherwise, calculate the ratio s / r,  where s is the width of the region\n        // represented by the internal node, and r is the distance between the body\n        // and the node's center-of-mass\n        ${e("d{var} = node.mass_{var} / node.mass - sourceBody.pos.{var};",{indent:8})}\n        r = Math.sqrt(${e("d{var} * d{var}",{join:" + "})});\n\n        if (r === 0) {\n          // Sorry about code duplication. I don't want to create many functions\n          // right away. Just want to see performance first.\n          ${e("d{var} = (random.nextDouble() - 0.5) / 50;",{indent:10})}\n          r = Math.sqrt(${e("d{var} * d{var}",{join:" + "})});\n        }\n        // If s / r < , treat this internal node as a single body, and calculate the\n        // force it exerts on sourceBody, and add this amount to sourceBody's net force.\n        if ((node.max_${i(0)} - node.min_${i(0)}) / r < theta) {\n          // in the if statement above we consider node's width only\n          // because the region was made into square during tree creation.\n          // Thus there is no difference between using width or height.\n          v = gravity * node.mass * sourceBody.mass / (r * r * r);\n          ${e("f{var} += v * d{var};",{indent:10})}\n        } else {\n          // Otherwise, run the procedure recursively on each of the current node's children.\n\n          // I intentionally unfolded this loop, to save several CPU cycles.\n${function(){let t=Array(11).join(" "),e=[];for(let r=0;r<n;++r)e.push(t+`if (node.quad${r}) {`),e.push(t+`  queue[pushIdx] = node.quad${r};`),e.push(t+"  queueLength += 1;"),e.push(t+"  pushIdx += 1;"),e.push(t+"}");return e.join("\n")}()}\n        }\n      }\n    }\n\n    ${e("sourceBody.force.{var} += f{var};",{indent:4})}\n  }\n\n  function insertBodies(bodies) {\n    ${e("var {var}min = Number.MAX_VALUE;",{indent:4})}\n    ${e("var {var}max = Number.MIN_VALUE;",{indent:4})}\n    var i = bodies.length;\n\n    // To reduce quad tree depth we are looking for exact bounding box of all particles.\n    while (i--) {\n      var pos = bodies[i].pos;\n      ${e("if (pos.{var} < {var}min) {var}min = pos.{var};",{indent:6})}\n      ${e("if (pos.{var} > {var}max) {var}max = pos.{var};",{indent:6})}\n    }\n\n    // Makes the bounds square.\n    var maxSideLength = -Infinity;\n    ${e("if ({var}max - {var}min > maxSideLength) maxSideLength = {var}max - {var}min ;",{indent:4})}\n\n    currentInCache = 0;\n    root = newNode();\n    ${e("root.min_{var} = {var}min;",{indent:4})}\n    ${e("root.max_{var} = {var}min + maxSideLength;",{indent:4})}\n\n    i = bodies.length - 1;\n    if (i >= 0) {\n      root.body = bodies[i];\n    }\n    while (i--) {\n      insert(bodies[i], root);\n    }\n  }\n\n  function insert(newBody) {\n    insertStack.reset();\n    insertStack.push(root, newBody);\n\n    while (!insertStack.isEmpty()) {\n      var stackItem = insertStack.pop();\n      var node = stackItem.node;\n      var body = stackItem.body;\n\n      if (!node.body) {\n        // This is internal node. Update the total mass of the node and center-of-mass.\n        ${e("var {var} = body.pos.{var};",{indent:8})}\n        node.mass += body.mass;\n        ${e("node.mass_{var} += body.mass * {var};",{indent:8})}\n\n        // Recursively insert the body in the appropriate quadrant.\n        // But first find the appropriate quadrant.\n        var quadIdx = 0; // Assume we are in the 0's quad.\n        ${e("var min_{var} = node.min_{var};",{indent:8})}\n        ${e("var max_{var} = (min_{var} + node.max_{var}) / 2;",{indent:8})}\n\n${function(e){let n=[],r=Array(e+1).join(" ");for(let e=0;e<t;++e)n.push(r+`if (${i(e)} > max_${i(e)}) {`),n.push(r+`  quadIdx = quadIdx + ${Math.pow(2,e)};`),n.push(r+`  min_${i(e)} = max_${i(e)};`),n.push(r+`  max_${i(e)} = node.max_${i(e)};`),n.push(r+"}");return n.join("\n")}(8)}\n\n        var child = getChild(node, quadIdx);\n\n        if (!child) {\n          // The node is internal but this quadrant is not taken. Add\n          // subnode to it.\n          child = newNode();\n          ${e("child.min_{var} = min_{var};",{indent:10})}\n          ${e("child.max_{var} = max_{var};",{indent:10})}\n          child.body = body;\n\n          setChild(node, quadIdx, child);\n        } else {\n          // continue searching in this quadrant.\n          insertStack.push(child, body);\n        }\n      } else {\n        // We are trying to add to the leaf node.\n        // We have to convert current leaf into internal node\n        // and continue adding two nodes.\n        var oldBody = node.body;\n        node.body = null; // internal nodes do not cary bodies\n\n        if (isSamePosition(oldBody.pos, body.pos)) {\n          // Prevent infinite subdivision by bumping one node\n          // anywhere in this quadrant\n          var retriesCount = 3;\n          do {\n            var offset = random.nextDouble();\n            ${e("var d{var} = (node.max_{var} - node.min_{var}) * offset;",{indent:12})}\n\n            ${e("oldBody.pos.{var} = node.min_{var} + d{var};",{indent:12})}\n            retriesCount -= 1;\n            // Make sure we don't bump it out of the box. If we do, next iteration should fix it\n          } while (retriesCount > 0 && isSamePosition(oldBody.pos, body.pos));\n\n          if (retriesCount === 0 && isSamePosition(oldBody.pos, body.pos)) {\n            // This is very bad, we ran out of precision.\n            // if we do not return from the method we'll get into\n            // infinite loop here. So we sacrifice correctness of layout, and keep the app running\n            // Next layout iteration should get larger bounding box in the first step and fix this\n            return;\n          }\n        }\n        // Next iteration should subdivide node further.\n        insertStack.push(node, oldBody);\n        insertStack.push(node, body);\n      }\n    }\n  }\n}\nreturn createQuadTree;\n\n`}function o(t){let e=r(t);return`\n  function isSamePosition(point1, point2) {\n    ${e("var d{var} = Math.abs(point1.{var} - point2.{var});",{indent:2})}\n  \n    return ${e("d{var} < 1e-8",{join:" && "})};\n  }  \n`}function a(t){var e=Math.pow(2,t);return`\nfunction setChild(node, idx, child) {\n  ${function(){let t=[];for(let n=0;n<e;++n){let e=0===n?"  ":"  else ";t.push(`${e}if (idx === ${n}) node.quad${n} = child;`)}return t.join("\n")}()}\n}`}function l(t){return`function getChild(node, idx) {\n${function(){let e=[],n=Math.pow(2,t);for(let t=0;t<n;++t)e.push(`  if (idx === ${t}) return node.quad${t};`);return e.join("\n")}()}\n  return null;\n}`}function u(t){let e=r(t),n=Math.pow(2,t);return`\nfunction QuadNode() {\n  // body stored inside this node. In quad tree only leaf nodes (by construction)\n  // contain bodies:\n  this.body = null;\n\n  // Child nodes are stored in quads. Each quad is presented by number:\n  // 0 | 1\n  // -----\n  // 2 | 3\n${function(t){let e=[];for(let r=0;r<n;++r)e.push(`${t}quad${r} = null;`);return e.join("\n")}("  this.")}\n\n  // Total mass of current node\n  this.mass = 0;\n\n  // Center of mass coordinates\n  ${e("this.mass_{var} = 0;",{indent:2})}\n\n  // bounding box coordinates\n  ${e("this.min_{var} = 0;",{indent:2})}\n  ${e("this.max_{var} = 0;",{indent:2})}\n}\n`}function c(){return"\n/**\n * Our implementation of QuadTree is non-recursive to avoid GC hit\n * This data structure represent stack of elements\n * which we are trying to insert into quad tree.\n */\nfunction InsertStack () {\n    this.stack = [];\n    this.popIdx = 0;\n}\n\nInsertStack.prototype = {\n    isEmpty: function() {\n        return this.popIdx === 0;\n    },\n    push: function (node, body) {\n        var item = this.stack[this.popIdx];\n        if (!item) {\n            // we are trying to avoid memory pressure: create new element\n            // only when absolutely necessary\n            this.stack[this.popIdx] = new InsertStackElement(node, body);\n        } else {\n            item.node = node;\n            item.body = body;\n        }\n        ++this.popIdx;\n    },\n    pop: function () {\n        if (this.popIdx > 0) {\n            return this.stack[--this.popIdx];\n        }\n    },\n    reset: function () {\n        this.popIdx = 0;\n    }\n};\n\nfunction InsertStackElement(node, body) {\n    this.node = node; // QuadTree node\n    this.body = body; // physical body which needs to be inserted to node\n}\n"}t.exports=function(t){let e=s(t);return new Function(e)()},t.exports.generateQuadTreeFunctionBody=s,t.exports.getInsertStackCode=c,t.exports.getQuadNodeCode=u,t.exports.isSamePosition=o,t.exports.getChildBodyCode=l,t.exports.setChildBodyCode=a},40552:function(t){t.exports=function(t){return 0===t?"x":1===t?"y":2===t?"z":"c"+(t+1)}},71985:function(t,e,n){t.exports=function(t){var e=n(48235),h=n(77876),d=n(73971);if(t){if(void 0!==t.springCoeff)throw new Error("springCoeff was renamed to springCoefficient");if(void 0!==t.dragCoeff)throw new Error("dragCoeff was renamed to dragCoefficient")}t=h(t,{springLength:10,springCoefficient:.8,gravity:-12,theta:.8,dragCoefficient:.9,timeStep:.5,adaptiveTimeStepWeight:0,dimensions:2,debug:!1});var p=u[t.dimensions];if(!p){var f=t.dimensions;p={Body:r(f,t.debug),createQuadTree:i(f),createBounds:s(f),createDragForce:o(f),createSpringForce:a(f),integrate:l(f)},u[f]=p}var m=p.Body,g=p.createQuadTree,v=p.createBounds,y=p.createDragForce,_=p.createSpringForce,x=p.integrate,b=n(71951).random(42),w=[],S=[],M=g(t,b),E=v(w,t,b),T=_(t,b),A=y(t),C=[],R=new Map,N=0;O("nbody",(function(){if(0===w.length)return;M.insertBodies(w);var t=w.length;for(;t--;){var e=w[t];e.isPinned||(e.reset(),M.updateBodyForce(e),A.update(e))}})),O("spring",(function(){var t=S.length;for(;t--;)T.update(S[t])}));var P={bodies:w,quadTree:M,springs:S,settings:t,addForce:O,removeForce:function(t){var e=C.indexOf(R.get(t));if(e<0)return;C.splice(e,1),R.delete(t)},getForces:function(){return R},step:function(){for(var e=0;e<C.length;++e)C[e](N);var n=x(w,t.timeStep,t.adaptiveTimeStepWeight);return N+=1,n},addBody:function(t){if(!t)throw new Error("Body is required");return w.push(t),t},addBodyAt:function(t){if(!t)throw new Error("Body position is required");var e=(t=>new m(t))(t);return w.push(e),e},removeBody:function(t){if(t){var e=w.indexOf(t);if(!(e<0))return w.splice(e,1),0===w.length&&E.reset(),!0}},addSpring:function(t,n,r,i){if(!t||!n)throw new Error("Cannot add null spring to force simulator");"number"!=typeof r&&(r=-1);var s=new e(t,n,r,i>=0?i:-1);return S.push(s),s},getTotalMovement:function(){return 0},removeSpring:function(t){if(t){var e=S.indexOf(t);return e>-1?(S.splice(e,1),!0):void 0}},getBestNewBodyPosition:function(t){return E.getBestNewPosition(t)},getBBox:I,getBoundingBox:I,invalidateBBox:function(){console.warn("invalidateBBox() is deprecated, bounds always recomputed on `getBBox()` call")},gravity:function(e){return void 0!==e?(t.gravity=e,M.options({gravity:e}),this):t.gravity},theta:function(e){return void 0!==e?(t.theta=e,M.options({theta:e}),this):t.theta},random:b};return function(t,e){for(var n in t)c(t,e,n)}(t,P),d(P),P;function I(){return E.update(),E.box}function O(t,e){if(R.has(t))throw new Error("Force "+t+" is already added");R.set(t,e),C.push(e)}};var r=n(54821),i=n(84933),s=n(62835),o=n(94176),a=n(62770),l=n(16008),u={};function c(t,e,n){if(t.hasOwnProperty(n)&&"function"!=typeof e[n]){var r=Number.isFinite(t[n]);e[n]=r?function(r){if(void 0!==r){if(!Number.isFinite(r))throw new Error("Value of "+n+" should be a valid number.");return t[n]=r,e}return t[n]}:function(r){return void 0!==r?(t[n]=r,e):t[n]}}}},48235:function(t){t.exports=function(t,e,n,r){this.from=t,this.to=e,this.length=n,this.coefficient=r}},64794:function(t,e,n){t.exports=function(t){"uniqueLinkId"in(t=t||{})&&(console.warn("ngraph.graph: Starting from version 0.14 `uniqueLinkId` is deprecated.\nUse `multigraph` option instead\n","\n","Note: there is also change in default behavior: From now on each graph\nis considered to be not a multigraph by default (each edge is unique)."),t.multigraph=t.uniqueLinkId);void 0===t.multigraph&&(t.multigraph=!1);if("function"!=typeof Map)throw new Error("ngraph.graph requires `Map` to be defined. Please polyfill it before using ngraph");var e=new Map,n=new Map,l={},u=0,c=t.multigraph?function(t,e,n){var r=a(t,e),i=l.hasOwnProperty(r);if(i||E(t,e)){i||(l[r]=0);var s="@"+ ++l[r];r=a(t+s,e+s)}return new o(t,e,n,r)}:function(t,e,r){var i=a(t,e),s=n.get(i);if(s)return s.data=r,s;return new o(t,e,r,i)},h=[],d=T,p=T,f=T,m=T,g={version:20,addNode:_,addLink:function(t,e,r){f();var i=x(t)||_(t),o=x(e)||_(e),a=c(t,e,r),l=n.has(a.id);n.set(a.id,a),s(i,a),t!==e&&s(o,a);return d(a,l?"update":"add"),m(),a},removeLink:function(t,e){void 0!==e&&(t=E(t,e));return M(t)},removeNode:b,getNode:x,getNodeCount:w,getLinkCount:S,getEdgeCount:S,getLinksCount:S,getNodesCount:w,getLinks:function(t){var e=x(t);return e?e.links:null},forEachNode:R,forEachLinkedNode:function(t,n,r){var i=x(t);if(i&&i.links&&"function"==typeof n)return r?function(t,n,r){var i=t.values(),s=i.next();for(;!s.done;){var o=s.value;if(o.fromId===n&&r(e.get(o.toId),o))return!0;s=i.next()}}(i.links,t,n):function(t,n,r){var i=t.values(),s=i.next();for(;!s.done;){var o=s.value,a=o.fromId===n?o.toId:o.fromId;if(r(e.get(a),o))return!0;s=i.next()}}(i.links,t,n)},forEachLink:function(t){if("function"==typeof t)for(var e=n.values(),r=e.next();!r.done;){if(t(r.value))return!0;r=e.next()}},beginUpdate:f,endUpdate:m,clear:function(){f(),R((function(t){b(t.id)})),m()},hasLink:E,hasNode:x,getLink:E};return r(g),function(){var t=g.on;function e(){return g.beginUpdate=f=A,g.endUpdate=m=C,d=v,p=y,g.on=t,t.apply(g,arguments)}g.on=e}(),g;function v(t,e){h.push({link:t,changeType:e})}function y(t,e){h.push({node:t,changeType:e})}function _(t,n){if(void 0===t)throw new Error("Invalid node identifier");f();var r=x(t);return r?(r.data=n,p(r,"update")):(r=new i(t,n),p(r,"add")),e.set(t,r),m(),r}function x(t){return e.get(t)}function b(t){var n=x(t);if(!n)return!1;f();var r=n.links;return r&&(r.forEach(M),n.links=null),e.delete(t),p(n,"remove"),m(),!0}function w(){return e.size}function S(){return n.size}function M(t){if(!t)return!1;if(!n.get(t.id))return!1;f(),n.delete(t.id);var e=x(t.fromId),r=x(t.toId);return e&&e.links.delete(t),r&&r.links.delete(t),d(t,"remove"),m(),!0}function E(t,e){if(void 0!==t&&void 0!==e)return n.get(a(t,e))}function T(){}function A(){u+=1}function C(){0===(u-=1)&&h.length>0&&(g.fire("changed",h),h.length=0)}function R(t){if("function"!=typeof t)throw new Error("Function is expected to iterate over graph nodes. You passed "+t);for(var n=e.values(),r=n.next();!r.done;){if(t(r.value))return!0;r=n.next()}}};var r=n(73971);function i(t,e){this.id=t,this.links=null,this.data=e}function s(t,e){t.links?t.links.add(e):t.links=new Set([e])}function o(t,e,n,r){this.fromId=t,this.toId=e,this.data=n,this.id=r}function a(t,e){return t.toString()+" "+e.toString()}},77876:function(t){t.exports=function t(e,n){var r;e||(e={});if(n)for(r in n)if(n.hasOwnProperty(r)){var i=e.hasOwnProperty(r),s=typeof n[r];!i||typeof e[r]!==s?e[r]=n[r]:"object"===s&&(e[r]=t(e[r],n[r]))}return e}},71951:function(t){function e(t){return new n("number"==typeof t?t:+new Date)}function n(t){this.seed=t}function r(t){return Math.sqrt(2*Math.PI/t)*Math.pow(1/Math.E*(t+1/(12*t-1/(10*t))),t)}function i(){var t=this.seed;return t=4294967295&(3042594569^(t=(t=4294967295&((t=(t=4294967295&(3345072700^(t=t+2127912214+(t<<12)&4294967295)^t>>>19))+374761393+(t<<5)&4294967295)+3550635116^t<<9))+4251993797+(t<<3)&4294967295)^t>>>16),this.seed=t,(268435455&t)/268435456}t.exports=e,t.exports.random=e,t.exports.randomIterator=function(t,n){var r=n||e();if("function"!=typeof r.next)throw new Error("customRandom does not match expected API: next() function is missing");return{forEach:function(e){var n,i,s;for(n=t.length-1;n>0;--n)i=r.next(n+1),s=t[i],t[i]=t[n],t[n]=s,e(s);t.length&&e(t[0])},shuffle:function(){var e,n,i;for(e=t.length-1;e>0;--e)n=r.next(e+1),i=t[n],t[n]=t[e],t[e]=i;return t}}},n.prototype.next=function(t){return Math.floor(this.nextDouble()*t)},n.prototype.nextDouble=i,n.prototype.uniform=i,n.prototype.gaussian=function(){var t,e,n;do{t=(e=2*this.nextDouble()-1)*e+(n=2*this.nextDouble()-1)*n}while(t>=1||0===t);return e*Math.sqrt(-2*Math.log(t)/t)},n.prototype.levy=function(){var t=1.5,e=Math.pow(r(2.5)*Math.sin(Math.PI*t/2)/(r(1.25)*t*Math.pow(2,.25)),1/t);return this.gaussian()*e/Math.pow(Math.abs(this.gaussian()),1/t)}},79627:function(t,e,n){"use strict";var r=n(50959);var i="function"==typeof Object.is?Object.is:function(t,e){return t===e&&(0!==t||1/t==1/e)||t!=t&&e!=e},s=r.useState,o=r.useEffect,a=r.useLayoutEffect,l=r.useDebugValue;function u(t){var e=t.getSnapshot;t=t.value;try{var n=e();return!i(t,n)}catch(t){return!0}}var c="undefined"==typeof window||void 0===window.document||void 0===window.document.createElement?function(t,e){return e()}:function(t,e){var n=e(),r=s({inst:{value:n,getSnapshot:e}}),i=r[0].inst,c=r[1];return a((function(){i.value=n,i.getSnapshot=e,u(i)&&c({inst:i})}),[t,n,e]),o((function(){return u(i)&&c({inst:i}),t((function(){u(i)&&c({inst:i})}))}),[t]),l(n),n};e.useSyncExternalStore=void 0!==r.useSyncExternalStore?r.useSyncExternalStore:c},56550:function(t,e,n){"use strict";var r=n(50959),i=n(87287);var s="function"==typeof Object.is?Object.is:function(t,e){return t===e&&(0!==t||1/t==1/e)||t!=t&&e!=e},o=i.useSyncExternalStore,a=r.useRef,l=r.useEffect,u=r.useMemo,c=r.useDebugValue;e.useSyncExternalStoreWithSelector=function(t,e,n,r,i){var h=a(null);if(null===h.current){var d={hasValue:!1,value:null};h.current=d}else d=h.current;h=u((function(){function t(t){if(!l){if(l=!0,o=t,t=r(t),void 0!==i&&d.hasValue){var e=d.value;if(i(e,t))return a=e}return a=t}if(e=a,s(o,t))return e;var n=r(t);return void 0!==i&&i(e,n)?e:(o=t,a=n)}var o,a,l=!1,u=void 0===n?null:n;return[function(){return t(e())},null===u?void 0:function(){return t(u())}]}),[e,n,r,i]);var p=o(t,h[0],h[1]);return l((function(){d.hasValue=!0,d.value=p}),[p]),c(p),p}},87287:function(t,e,n){"use strict";t.exports=n(79627)},9714:function(t,e,n){"use strict";t.exports=n(56550)},62950:function(t,e,n){"use strict";n.d(e,{Z:function(){return u}});var r={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};let i;const s=new Uint8Array(16);function o(){if(!i&&(i="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!i))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return i(s)}const a=[];for(let t=0;t<256;++t)a.push((t+256).toString(16).slice(1));function l(t,e=0){return a[t[e+0]]+a[t[e+1]]+a[t[e+2]]+a[t[e+3]]+"-"+a[t[e+4]]+a[t[e+5]]+"-"+a[t[e+6]]+a[t[e+7]]+"-"+a[t[e+8]]+a[t[e+9]]+"-"+a[t[e+10]]+a[t[e+11]]+a[t[e+12]]+a[t[e+13]]+a[t[e+14]]+a[t[e+15]]}var u=function(t,e,n){if(r.randomUUID&&!e&&!t)return r.randomUUID();const i=(t=t||{}).random||(t.rng||o)();if(i[6]=15&i[6]|64,i[8]=63&i[8]|128,e){n=n||0;for(let t=0;t<16;++t)e[n+t]=i[t];return e}return l(i)}},62541:function(t,e,n){var r=n(88353);function i(t){var e,n;function i(e,n){try{var o=t[e](n),a=o.value,l=a instanceof r;Promise.resolve(l?a.v:a).then((function(n){if(l){var r="return"===e?"return":"next";if(!a.k||n.done)return i(r,n);n=t[r](n).value}s(o.done?"return":"normal",n)}),(function(t){i("throw",t)}))}catch(t){s("throw",t)}}function s(t,r){switch(t){case"return":e.resolve({value:r,done:!0});break;case"throw":e.reject(r);break;default:e.resolve({value:r,done:!1})}(e=e.next)?i(e.key,e.arg):n=null}this._invoke=function(t,r){return new Promise((function(s,o){var a={key:t,arg:r,resolve:s,reject:o,next:null};n?n=n.next=a:(e=n=a,i(t,r))}))},"function"!=typeof t.return&&(this.return=void 0)}i.prototype["function"==typeof Symbol&&Symbol.asyncIterator||"@@asyncIterator"]=function(){return this},i.prototype.next=function(t){return this._invoke("next",t)},i.prototype.throw=function(t){return this._invoke("throw",t)},i.prototype.return=function(t){return this._invoke("return",t)},t.exports=i,t.exports.__esModule=!0,t.exports.default=t.exports},88353:function(t){t.exports=function(t,e){this.v=t,this.k=e},t.exports.__esModule=!0,t.exports.default=t.exports},38498:function(t,e,n){var r=n(78770);t.exports=function(t){if(Array.isArray(t))return r(t)},t.exports.__esModule=!0,t.exports.default=t.exports},56751:function(t,e,n){var r=n(88353);t.exports=function(t){var e={},n=!1;function i(e,i){return n=!0,i=new Promise((function(n){n(t[e](i))})),{done:!1,value:new r(i,1)}}return e["undefined"!=typeof Symbol&&Symbol.iterator||"@@iterator"]=function(){return this},e.next=function(t){return n?(n=!1,t):i("next",t)},"function"==typeof t.throw&&(e.throw=function(t){if(n)throw n=!1,t;return i("throw",t)}),"function"==typeof t.return&&(e.return=function(t){return n?(n=!1,t):i("return",t)}),e},t.exports.__esModule=!0,t.exports.default=t.exports},75487:function(t){function e(t){function n(t){if(Object(t)!==t)return Promise.reject(new TypeError(t+" is not an object."));var e=t.done;return Promise.resolve(t.value).then((function(t){return{value:t,done:e}}))}return e=function(t){this.s=t,this.n=t.next},e.prototype={s:null,n:null,next:function(){return n(this.n.apply(this.s,arguments))},return:function(t){var e=this.s.return;return void 0===e?Promise.resolve({value:t,done:!0}):n(e.apply(this.s,arguments))},throw:function(t){var e=this.s.return;return void 0===e?Promise.reject(t):n(e.apply(this.s,arguments))}},new e(t)}t.exports=function(t){var n,r,i,s=2;for("undefined"!=typeof Symbol&&(r=Symbol.asyncIterator,i=Symbol.iterator);s--;){if(r&&null!=(n=t[r]))return n.call(t);if(i&&null!=(n=t[i]))return new e(n.call(t));r="@@asyncIterator",i="@@iterator"}throw new TypeError("Object is not async iterable")},t.exports.__esModule=!0,t.exports.default=t.exports},34067:function(t,e,n){var r=n(88353);t.exports=function(t){return new r(t,0)},t.exports.__esModule=!0,t.exports.default=t.exports},335:function(t,e,n){var r=n(31479);t.exports=function(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=r(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var i=0,s=function(){};return{s:s,n:function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}},e:function(t){throw t},f:s}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,l=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){l=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(l)throw o}}}},t.exports.__esModule=!0,t.exports.default=t.exports},20698:function(t){t.exports=function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)},t.exports.__esModule=!0,t.exports.default=t.exports},91162:function(t){t.exports=function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")},t.exports.__esModule=!0,t.exports.default=t.exports},57724:function(t,e,n){var r=n(50040),i=n(20698),s=n(31479),o=n(44804);t.exports=function(t){return r(t)||i(t)||s(t)||o()},t.exports.__esModule=!0,t.exports.default=t.exports},15558:function(t,e,n){var r=n(38498),i=n(20698),s=n(31479),o=n(91162);t.exports=function(t){return r(t)||i(t)||s(t)||o()},t.exports.__esModule=!0,t.exports.default=t.exports},24661:function(t,e,n){var r=n(62541);t.exports=function(t){return function(){return new r(t.apply(this,arguments))}},t.exports.__esModule=!0,t.exports.default=t.exports},19363:function(t,e,n){"use strict";n.d(e,{Z:function(){return qO}});const r="170",i={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},s=0,o=1,a=2,l=3,u=100,c=301,h=302,d=303,p=304,f=306,m=1e3,g=1001,v=1002,y=1003,_=1005,x=1006,b=1007,w=1008,S=1009,M=1010,E=1011,T=1012,A=1013,C=1014,R=1015,N=1016,P=1017,I=1018,O=1020,D=35902,L=1023,U=1026,k=1027,B=1028,F=1029,z=1031,V=1033,G=33776,j=33777,H=33778,W=33779,q=35840,X=35841,Z=35842,$=35843,Y=36196,K=37492,J=37496,Q=37808,tt=37809,et=37810,nt=37811,rt=37812,it=37813,st=37814,ot=37815,at=37816,lt=37817,ut=37818,ct=37819,ht=37820,dt=37821,pt=36492,ft=36494,mt=36495,gt=36284,vt=36285,yt=36286,_t=2300,xt=2301,bt=2302,wt=2400,St=2401,Mt=2402,Et="",Tt="srgb",At="srgb-linear",Ct="linear",Rt="srgb",Nt=7680,Pt=35044,It="300 es",Ot=2e3,Dt=2001;class Lt{addEventListener(t,e){void 0===this._listeners&&(this._listeners={});const n=this._listeners;void 0===n[t]&&(n[t]=[]),-1===n[t].indexOf(e)&&n[t].push(e)}hasEventListener(t,e){if(void 0===this._listeners)return!1;const n=this._listeners;return void 0!==n[t]&&-1!==n[t].indexOf(e)}removeEventListener(t,e){if(void 0===this._listeners)return;const n=this._listeners[t];if(void 0!==n){const t=n.indexOf(e);-1!==t&&n.splice(t,1)}}dispatchEvent(t){if(void 0===this._listeners)return;const e=this._listeners[t.type];if(void 0!==e){t.target=this;const n=e.slice(0);for(let e=0,r=n.length;e<r;e++)n[e].call(this,t);t.target=null}}}const Ut=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let kt=1234567;const Bt=Math.PI/180,Ft=180/Math.PI;function zt(){const t=4294967295*Math.random()|0,e=4294967295*Math.random()|0,n=4294967295*Math.random()|0,r=4294967295*Math.random()|0;return(Ut[255&t]+Ut[t>>8&255]+Ut[t>>16&255]+Ut[t>>24&255]+"-"+Ut[255&e]+Ut[e>>8&255]+"-"+Ut[e>>16&15|64]+Ut[e>>24&255]+"-"+Ut[63&n|128]+Ut[n>>8&255]+"-"+Ut[n>>16&255]+Ut[n>>24&255]+Ut[255&r]+Ut[r>>8&255]+Ut[r>>16&255]+Ut[r>>24&255]).toLowerCase()}function Vt(t,e,n){return Math.max(e,Math.min(n,t))}function Gt(t,e){return(t%e+e)%e}function jt(t,e,n){return(1-n)*t+n*e}function Ht(t,e){switch(e.constructor){case Float32Array:return t;case Uint32Array:return t/4294967295;case Uint16Array:return t/65535;case Uint8Array:return t/255;case Int32Array:return Math.max(t/2147483647,-1);case Int16Array:return Math.max(t/32767,-1);case Int8Array:return Math.max(t/127,-1);default:throw new Error("Invalid component type.")}}function Wt(t,e){switch(e.constructor){case Float32Array:return t;case Uint32Array:return Math.round(4294967295*t);case Uint16Array:return Math.round(65535*t);case Uint8Array:return Math.round(255*t);case Int32Array:return Math.round(2147483647*t);case Int16Array:return Math.round(32767*t);case Int8Array:return Math.round(127*t);default:throw new Error("Invalid component type.")}}const qt={DEG2RAD:Bt,RAD2DEG:Ft,generateUUID:zt,clamp:Vt,euclideanModulo:Gt,mapLinear:function(t,e,n,r,i){return r+(t-e)*(i-r)/(n-e)},inverseLerp:function(t,e,n){return t!==e?(n-t)/(e-t):0},lerp:jt,damp:function(t,e,n,r){return jt(t,e,1-Math.exp(-n*r))},pingpong:function(t,e=1){return e-Math.abs(Gt(t,2*e)-e)},smoothstep:function(t,e,n){return t<=e?0:t>=n?1:(t=(t-e)/(n-e))*t*(3-2*t)},smootherstep:function(t,e,n){return t<=e?0:t>=n?1:(t=(t-e)/(n-e))*t*t*(t*(6*t-15)+10)},randInt:function(t,e){return t+Math.floor(Math.random()*(e-t+1))},randFloat:function(t,e){return t+Math.random()*(e-t)},randFloatSpread:function(t){return t*(.5-Math.random())},seededRandom:function(t){void 0!==t&&(kt=t);let e=kt+=1831565813;return e=Math.imul(e^e>>>15,1|e),e^=e+Math.imul(e^e>>>7,61|e),((e^e>>>14)>>>0)/4294967296},degToRad:function(t){return t*Bt},radToDeg:function(t){return t*Ft},isPowerOfTwo:function(t){return 0==(t&t-1)&&0!==t},ceilPowerOfTwo:function(t){return Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))},floorPowerOfTwo:function(t){return Math.pow(2,Math.floor(Math.log(t)/Math.LN2))},setQuaternionFromProperEuler:function(t,e,n,r,i){const s=Math.cos,o=Math.sin,a=s(n/2),l=o(n/2),u=s((e+r)/2),c=o((e+r)/2),h=s((e-r)/2),d=o((e-r)/2),p=s((r-e)/2),f=o((r-e)/2);switch(i){case"XYX":t.set(a*c,l*h,l*d,a*u);break;case"YZY":t.set(l*d,a*c,l*h,a*u);break;case"ZXZ":t.set(l*h,l*d,a*c,a*u);break;case"XZX":t.set(a*c,l*f,l*p,a*u);break;case"YXY":t.set(l*p,a*c,l*f,a*u);break;case"ZYZ":t.set(l*f,l*p,a*c,a*u);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+i)}},normalize:Wt,denormalize:Ht};class Xt{constructor(t=0,e=0){Xt.prototype.isVector2=!0,this.x=t,this.y=e}get width(){return this.x}set width(t){this.x=t}get height(){return this.y}set height(t){this.y=t}set(t,e){return this.x=t,this.y=e,this}setScalar(t){return this.x=t,this.y=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y)}copy(t){return this.x=t.x,this.y=t.y,this}add(t){return this.x+=t.x,this.y+=t.y,this}addScalar(t){return this.x+=t,this.y+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this}subScalar(t){return this.x-=t,this.y-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this}multiply(t){return this.x*=t.x,this.y*=t.y,this}multiplyScalar(t){return this.x*=t,this.y*=t,this}divide(t){return this.x/=t.x,this.y/=t.y,this}divideScalar(t){return this.multiplyScalar(1/t)}applyMatrix3(t){const e=this.x,n=this.y,r=t.elements;return this.x=r[0]*e+r[3]*n+r[6],this.y=r[1]*e+r[4]*n+r[7],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this}clampLength(t,e){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(t,Math.min(e,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(t){const e=Math.sqrt(this.lengthSq()*t.lengthSq());if(0===e)return Math.PI/2;const n=this.dot(t)/e;return Math.acos(Vt(n,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,n=this.y-t.y;return e*e+n*n}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this}lerpVectors(t,e,n){return this.x=t.x+(e.x-t.x)*n,this.y=t.y+(e.y-t.y)*n,this}equals(t){return t.x===this.x&&t.y===this.y}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this}rotateAround(t,e){const n=Math.cos(e),r=Math.sin(e),i=this.x-t.x,s=this.y-t.y;return this.x=i*n-s*r+t.x,this.y=i*r+s*n+t.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class Zt{constructor(t,e,n,r,i,s,o,a,l){Zt.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],void 0!==t&&this.set(t,e,n,r,i,s,o,a,l)}set(t,e,n,r,i,s,o,a,l){const u=this.elements;return u[0]=t,u[1]=r,u[2]=o,u[3]=e,u[4]=i,u[5]=a,u[6]=n,u[7]=s,u[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(t){const e=this.elements,n=t.elements;return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],this}extractBasis(t,e,n){return t.setFromMatrix3Column(this,0),e.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}setFromMatrix4(t){const e=t.elements;return this.set(e[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10]),this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const n=t.elements,r=e.elements,i=this.elements,s=n[0],o=n[3],a=n[6],l=n[1],u=n[4],c=n[7],h=n[2],d=n[5],p=n[8],f=r[0],m=r[3],g=r[6],v=r[1],y=r[4],_=r[7],x=r[2],b=r[5],w=r[8];return i[0]=s*f+o*v+a*x,i[3]=s*m+o*y+a*b,i[6]=s*g+o*_+a*w,i[1]=l*f+u*v+c*x,i[4]=l*m+u*y+c*b,i[7]=l*g+u*_+c*w,i[2]=h*f+d*v+p*x,i[5]=h*m+d*y+p*b,i[8]=h*g+d*_+p*w,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[3]*=t,e[6]*=t,e[1]*=t,e[4]*=t,e[7]*=t,e[2]*=t,e[5]*=t,e[8]*=t,this}determinant(){const t=this.elements,e=t[0],n=t[1],r=t[2],i=t[3],s=t[4],o=t[5],a=t[6],l=t[7],u=t[8];return e*s*u-e*o*l-n*i*u+n*o*a+r*i*l-r*s*a}invert(){const t=this.elements,e=t[0],n=t[1],r=t[2],i=t[3],s=t[4],o=t[5],a=t[6],l=t[7],u=t[8],c=u*s-o*l,h=o*a-u*i,d=l*i-s*a,p=e*c+n*h+r*d;if(0===p)return this.set(0,0,0,0,0,0,0,0,0);const f=1/p;return t[0]=c*f,t[1]=(r*l-u*n)*f,t[2]=(o*n-r*s)*f,t[3]=h*f,t[4]=(u*e-r*a)*f,t[5]=(r*i-o*e)*f,t[6]=d*f,t[7]=(n*a-l*e)*f,t[8]=(s*e-n*i)*f,this}transpose(){let t;const e=this.elements;return t=e[1],e[1]=e[3],e[3]=t,t=e[2],e[2]=e[6],e[6]=t,t=e[5],e[5]=e[7],e[7]=t,this}getNormalMatrix(t){return this.setFromMatrix4(t).invert().transpose()}transposeIntoArray(t){const e=this.elements;return t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8],this}setUvTransform(t,e,n,r,i,s,o){const a=Math.cos(i),l=Math.sin(i);return this.set(n*a,n*l,-n*(a*s+l*o)+s+t,-r*l,r*a,-r*(-l*s+a*o)+o+e,0,0,1),this}scale(t,e){return this.premultiply($t.makeScale(t,e)),this}rotate(t){return this.premultiply($t.makeRotation(-t)),this}translate(t,e){return this.premultiply($t.makeTranslation(t,e)),this}makeTranslation(t,e){return t.isVector2?this.set(1,0,t.x,0,1,t.y,0,0,1):this.set(1,0,t,0,1,e,0,0,1),this}makeRotation(t){const e=Math.cos(t),n=Math.sin(t);return this.set(e,-n,0,n,e,0,0,0,1),this}makeScale(t,e){return this.set(t,0,0,0,e,0,0,0,1),this}equals(t){const e=this.elements,n=t.elements;for(let t=0;t<9;t++)if(e[t]!==n[t])return!1;return!0}fromArray(t,e=0){for(let n=0;n<9;n++)this.elements[n]=t[n+e];return this}toArray(t=[],e=0){const n=this.elements;return t[e]=n[0],t[e+1]=n[1],t[e+2]=n[2],t[e+3]=n[3],t[e+4]=n[4],t[e+5]=n[5],t[e+6]=n[6],t[e+7]=n[7],t[e+8]=n[8],t}clone(){return(new this.constructor).fromArray(this.elements)}}const $t=new Zt;function Yt(t){for(let e=t.length-1;e>=0;--e)if(t[e]>=65535)return!0;return!1}Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array;function Kt(t){return document.createElementNS("http://www.w3.org/1999/xhtml",t)}function Jt(){const t=Kt("canvas");return t.style.display="block",t}const Qt={};function te(t){t in Qt||(Qt[t]=!0,console.warn(t))}const ee={enabled:!0,workingColorSpace:At,spaces:{},convert:function(t,e,n){return!1!==this.enabled&&e!==n&&e&&n?(this.spaces[e].transfer===Rt&&(t.r=ne(t.r),t.g=ne(t.g),t.b=ne(t.b)),this.spaces[e].primaries!==this.spaces[n].primaries&&(t.applyMatrix3(this.spaces[e].toXYZ),t.applyMatrix3(this.spaces[n].fromXYZ)),this.spaces[n].transfer===Rt&&(t.r=re(t.r),t.g=re(t.g),t.b=re(t.b)),t):t},fromWorkingColorSpace:function(t,e){return this.convert(t,this.workingColorSpace,e)},toWorkingColorSpace:function(t,e){return this.convert(t,e,this.workingColorSpace)},getPrimaries:function(t){return this.spaces[t].primaries},getTransfer:function(t){return t===Et?Ct:this.spaces[t].transfer},getLuminanceCoefficients:function(t,e=this.workingColorSpace){return t.fromArray(this.spaces[e].luminanceCoefficients)},define:function(t){Object.assign(this.spaces,t)},_getMatrix:function(t,e,n){return t.copy(this.spaces[e].toXYZ).multiply(this.spaces[n].fromXYZ)},_getDrawingBufferColorSpace:function(t){return this.spaces[t].outputColorSpaceConfig.drawingBufferColorSpace},_getUnpackColorSpace:function(t=this.workingColorSpace){return this.spaces[t].workingColorSpaceConfig.unpackColorSpace}};function ne(t){return t<.04045?.0773993808*t:Math.pow(.9478672986*t+.0521327014,2.4)}function re(t){return t<.0031308?12.92*t:1.055*Math.pow(t,.41666)-.055}const ie=[.64,.33,.3,.6,.15,.06],se=[.2126,.7152,.0722],oe=[.3127,.329],ae=(new Zt).set(.4123908,.3575843,.1804808,.212639,.7151687,.0721923,.0193308,.1191948,.9505322),le=(new Zt).set(3.2409699,-1.5373832,-.4986108,-.9692436,1.8759675,.0415551,.0556301,-.203977,1.0569715);let ue;ee.define({[At]:{primaries:ie,whitePoint:oe,transfer:Ct,toXYZ:ae,fromXYZ:le,luminanceCoefficients:se,workingColorSpaceConfig:{unpackColorSpace:Tt},outputColorSpaceConfig:{drawingBufferColorSpace:Tt}},[Tt]:{primaries:ie,whitePoint:oe,transfer:Rt,toXYZ:ae,fromXYZ:le,luminanceCoefficients:se,outputColorSpaceConfig:{drawingBufferColorSpace:Tt}}});class ce{static getDataURL(t){if(/^data:/i.test(t.src))return t.src;if("undefined"==typeof HTMLCanvasElement)return t.src;let e;if(t instanceof HTMLCanvasElement)e=t;else{void 0===ue&&(ue=Kt("canvas")),ue.width=t.width,ue.height=t.height;const n=ue.getContext("2d");t instanceof ImageData?n.putImageData(t,0,0):n.drawImage(t,0,0,t.width,t.height),e=ue}return e.width>2048||e.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",t),e.toDataURL("image/jpeg",.6)):e.toDataURL("image/png")}static sRGBToLinear(t){if("undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap){const e=Kt("canvas");e.width=t.width,e.height=t.height;const n=e.getContext("2d");n.drawImage(t,0,0,t.width,t.height);const r=n.getImageData(0,0,t.width,t.height),i=r.data;for(let t=0;t<i.length;t++)i[t]=255*ne(i[t]/255);return n.putImageData(r,0,0),e}if(t.data){const e=t.data.slice(0);for(let t=0;t<e.length;t++)e instanceof Uint8Array||e instanceof Uint8ClampedArray?e[t]=Math.floor(255*ne(e[t]/255)):e[t]=ne(e[t]);return{data:e,width:t.width,height:t.height}}return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),t}}let he=0;class de{constructor(t=null){this.isSource=!0,Object.defineProperty(this,"id",{value:he++}),this.uuid=zt(),this.data=t,this.dataReady=!0,this.version=0}set needsUpdate(t){!0===t&&this.version++}toJSON(t){const e=void 0===t||"string"==typeof t;if(!e&&void 0!==t.images[this.uuid])return t.images[this.uuid];const n={uuid:this.uuid,url:""},r=this.data;if(null!==r){let t;if(Array.isArray(r)){t=[];for(let e=0,n=r.length;e<n;e++)r[e].isDataTexture?t.push(pe(r[e].image)):t.push(pe(r[e]))}else t=pe(r);n.url=t}return e||(t.images[this.uuid]=n),n}}function pe(t){return"undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap?ce.getDataURL(t):t.data?{data:Array.from(t.data),width:t.width,height:t.height,type:t.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let fe=0;class me extends Lt{constructor(t=me.DEFAULT_IMAGE,e=me.DEFAULT_MAPPING,n=1001,r=1001,i=1006,s=1008,o=1023,a=1009,l=me.DEFAULT_ANISOTROPY,u=""){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:fe++}),this.uuid=zt(),this.name="",this.source=new de(t),this.mipmaps=[],this.mapping=e,this.channel=0,this.wrapS=n,this.wrapT=r,this.magFilter=i,this.minFilter=s,this.anisotropy=l,this.format=o,this.internalFormat=null,this.type=a,this.offset=new Xt(0,0),this.repeat=new Xt(1,1),this.center=new Xt(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Zt,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.colorSpace=u,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.pmremVersion=0}get image(){return this.source.data}set image(t=null){this.source.data=t}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return(new this.constructor).copy(this)}copy(t){return this.name=t.name,this.source=t.source,this.mipmaps=t.mipmaps.slice(0),this.mapping=t.mapping,this.channel=t.channel,this.wrapS=t.wrapS,this.wrapT=t.wrapT,this.magFilter=t.magFilter,this.minFilter=t.minFilter,this.anisotropy=t.anisotropy,this.format=t.format,this.internalFormat=t.internalFormat,this.type=t.type,this.offset.copy(t.offset),this.repeat.copy(t.repeat),this.center.copy(t.center),this.rotation=t.rotation,this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrix.copy(t.matrix),this.generateMipmaps=t.generateMipmaps,this.premultiplyAlpha=t.premultiplyAlpha,this.flipY=t.flipY,this.unpackAlignment=t.unpackAlignment,this.colorSpace=t.colorSpace,this.userData=JSON.parse(JSON.stringify(t.userData)),this.needsUpdate=!0,this}toJSON(t){const e=void 0===t||"string"==typeof t;if(!e&&void 0!==t.textures[this.uuid])return t.textures[this.uuid];const n={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(t).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(n.userData=this.userData),e||(t.textures[this.uuid]=n),n}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(t){if(300!==this.mapping)return t;if(t.applyMatrix3(this.matrix),t.x<0||t.x>1)switch(this.wrapS){case m:t.x=t.x-Math.floor(t.x);break;case g:t.x=t.x<0?0:1;break;case v:1===Math.abs(Math.floor(t.x)%2)?t.x=Math.ceil(t.x)-t.x:t.x=t.x-Math.floor(t.x)}if(t.y<0||t.y>1)switch(this.wrapT){case m:t.y=t.y-Math.floor(t.y);break;case g:t.y=t.y<0?0:1;break;case v:1===Math.abs(Math.floor(t.y)%2)?t.y=Math.ceil(t.y)-t.y:t.y=t.y-Math.floor(t.y)}return this.flipY&&(t.y=1-t.y),t}set needsUpdate(t){!0===t&&(this.version++,this.source.needsUpdate=!0)}set needsPMREMUpdate(t){!0===t&&this.pmremVersion++}}me.DEFAULT_IMAGE=null,me.DEFAULT_MAPPING=300,me.DEFAULT_ANISOTROPY=1;class ge{constructor(t=0,e=0,n=0,r=1){ge.prototype.isVector4=!0,this.x=t,this.y=e,this.z=n,this.w=r}get width(){return this.z}set width(t){this.z=t}get height(){return this.w}set height(t){this.w=t}set(t,e,n,r){return this.x=t,this.y=e,this.z=n,this.w=r,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this.w=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setW(t){return this.w=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;case 3:this.w=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=void 0!==t.w?t.w:1,this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this.w+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this.w=t.w+e.w,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this.w+=t.w*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this.w-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this.w=t.w-e.w,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this.w*=t.w,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this}applyMatrix4(t){const e=this.x,n=this.y,r=this.z,i=this.w,s=t.elements;return this.x=s[0]*e+s[4]*n+s[8]*r+s[12]*i,this.y=s[1]*e+s[5]*n+s[9]*r+s[13]*i,this.z=s[2]*e+s[6]*n+s[10]*r+s[14]*i,this.w=s[3]*e+s[7]*n+s[11]*r+s[15]*i,this}divide(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this.w/=t.w,this}divideScalar(t){return this.multiplyScalar(1/t)}setAxisAngleFromQuaternion(t){this.w=2*Math.acos(t.w);const e=Math.sqrt(1-t.w*t.w);return e<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=t.x/e,this.y=t.y/e,this.z=t.z/e),this}setAxisAngleFromRotationMatrix(t){let e,n,r,i;const s=.01,o=.1,a=t.elements,l=a[0],u=a[4],c=a[8],h=a[1],d=a[5],p=a[9],f=a[2],m=a[6],g=a[10];if(Math.abs(u-h)<s&&Math.abs(c-f)<s&&Math.abs(p-m)<s){if(Math.abs(u+h)<o&&Math.abs(c+f)<o&&Math.abs(p+m)<o&&Math.abs(l+d+g-3)<o)return this.set(1,0,0,0),this;e=Math.PI;const t=(l+1)/2,a=(d+1)/2,v=(g+1)/2,y=(u+h)/4,_=(c+f)/4,x=(p+m)/4;return t>a&&t>v?t<s?(n=0,r=.707106781,i=.707106781):(n=Math.sqrt(t),r=y/n,i=_/n):a>v?a<s?(n=.707106781,r=0,i=.707106781):(r=Math.sqrt(a),n=y/r,i=x/r):v<s?(n=.707106781,r=.707106781,i=0):(i=Math.sqrt(v),n=_/i,r=x/i),this.set(n,r,i,e),this}let v=Math.sqrt((m-p)*(m-p)+(c-f)*(c-f)+(h-u)*(h-u));return Math.abs(v)<.001&&(v=1),this.x=(m-p)/v,this.y=(c-f)/v,this.z=(h-u)/v,this.w=Math.acos((l+d+g-1)/2),this}setFromMatrixPosition(t){const e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this.w=e[15],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this.w=Math.min(this.w,t.w),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this.w=Math.max(this.w,t.w),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this.w=Math.max(t.w,Math.min(e.w,this.w)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this.w=Math.max(t,Math.min(e,this.w)),this}clampLength(t,e){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(t,Math.min(e,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this.w+=(t.w-this.w)*e,this}lerpVectors(t,e,n){return this.x=t.x+(e.x-t.x)*n,this.y=t.y+(e.y-t.y)*n,this.z=t.z+(e.z-t.z)*n,this.w=t.w+(e.w-t.w)*n,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this.w=t[e+3],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t[e+3]=this.w,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this.w=t.getW(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class ve extends Lt{constructor(t=1,e=1,n={}){super(),this.isRenderTarget=!0,this.width=t,this.height=e,this.depth=1,this.scissor=new ge(0,0,t,e),this.scissorTest=!1,this.viewport=new ge(0,0,t,e);const r={width:t,height:e,depth:1};n=Object.assign({generateMipmaps:!1,internalFormat:null,minFilter:x,depthBuffer:!0,stencilBuffer:!1,resolveDepthBuffer:!0,resolveStencilBuffer:!0,depthTexture:null,samples:0,count:1},n);const i=new me(r,n.mapping,n.wrapS,n.wrapT,n.magFilter,n.minFilter,n.format,n.type,n.anisotropy,n.colorSpace);i.flipY=!1,i.generateMipmaps=n.generateMipmaps,i.internalFormat=n.internalFormat,this.textures=[];const s=n.count;for(let t=0;t<s;t++)this.textures[t]=i.clone(),this.textures[t].isRenderTargetTexture=!0;this.depthBuffer=n.depthBuffer,this.stencilBuffer=n.stencilBuffer,this.resolveDepthBuffer=n.resolveDepthBuffer,this.resolveStencilBuffer=n.resolveStencilBuffer,this.depthTexture=n.depthTexture,this.samples=n.samples}get texture(){return this.textures[0]}set texture(t){this.textures[0]=t}setSize(t,e,n=1){if(this.width!==t||this.height!==e||this.depth!==n){this.width=t,this.height=e,this.depth=n;for(let r=0,i=this.textures.length;r<i;r++)this.textures[r].image.width=t,this.textures[r].image.height=e,this.textures[r].image.depth=n;this.dispose()}this.viewport.set(0,0,t,e),this.scissor.set(0,0,t,e)}clone(){return(new this.constructor).copy(this)}copy(t){this.width=t.width,this.height=t.height,this.depth=t.depth,this.scissor.copy(t.scissor),this.scissorTest=t.scissorTest,this.viewport.copy(t.viewport),this.textures.length=0;for(let e=0,n=t.textures.length;e<n;e++)this.textures[e]=t.textures[e].clone(),this.textures[e].isRenderTargetTexture=!0;const e=Object.assign({},t.texture.image);return this.texture.source=new de(e),this.depthBuffer=t.depthBuffer,this.stencilBuffer=t.stencilBuffer,this.resolveDepthBuffer=t.resolveDepthBuffer,this.resolveStencilBuffer=t.resolveStencilBuffer,null!==t.depthTexture&&(this.depthTexture=t.depthTexture.clone()),this.samples=t.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class ye extends ve{constructor(t=1,e=1,n={}){super(t,e,n),this.isWebGLRenderTarget=!0}}class _e extends me{constructor(t=null,e=1,n=1,r=1){super(null),this.isDataArrayTexture=!0,this.image={data:t,width:e,height:n,depth:r},this.magFilter=y,this.minFilter=y,this.wrapR=g,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.layerUpdates=new Set}addLayerUpdate(t){this.layerUpdates.add(t)}clearLayerUpdates(){this.layerUpdates.clear()}}class xe extends me{constructor(t=null,e=1,n=1,r=1){super(null),this.isData3DTexture=!0,this.image={data:t,width:e,height:n,depth:r},this.magFilter=y,this.minFilter=y,this.wrapR=g,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class be{constructor(t=0,e=0,n=0,r=1){this.isQuaternion=!0,this._x=t,this._y=e,this._z=n,this._w=r}static slerpFlat(t,e,n,r,i,s,o){let a=n[r+0],l=n[r+1],u=n[r+2],c=n[r+3];const h=i[s+0],d=i[s+1],p=i[s+2],f=i[s+3];if(0===o)return t[e+0]=a,t[e+1]=l,t[e+2]=u,void(t[e+3]=c);if(1===o)return t[e+0]=h,t[e+1]=d,t[e+2]=p,void(t[e+3]=f);if(c!==f||a!==h||l!==d||u!==p){let t=1-o;const e=a*h+l*d+u*p+c*f,n=e>=0?1:-1,r=1-e*e;if(r>Number.EPSILON){const i=Math.sqrt(r),s=Math.atan2(i,e*n);t=Math.sin(t*s)/i,o=Math.sin(o*s)/i}const i=o*n;if(a=a*t+h*i,l=l*t+d*i,u=u*t+p*i,c=c*t+f*i,t===1-o){const t=1/Math.sqrt(a*a+l*l+u*u+c*c);a*=t,l*=t,u*=t,c*=t}}t[e]=a,t[e+1]=l,t[e+2]=u,t[e+3]=c}static multiplyQuaternionsFlat(t,e,n,r,i,s){const o=n[r],a=n[r+1],l=n[r+2],u=n[r+3],c=i[s],h=i[s+1],d=i[s+2],p=i[s+3];return t[e]=o*p+u*c+a*d-l*h,t[e+1]=a*p+u*h+l*c-o*d,t[e+2]=l*p+u*d+o*h-a*c,t[e+3]=u*p-o*c-a*h-l*d,t}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get w(){return this._w}set w(t){this._w=t,this._onChangeCallback()}set(t,e,n,r){return this._x=t,this._y=e,this._z=n,this._w=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this._onChangeCallback(),this}setFromEuler(t,e=!0){const n=t._x,r=t._y,i=t._z,s=t._order,o=Math.cos,a=Math.sin,l=o(n/2),u=o(r/2),c=o(i/2),h=a(n/2),d=a(r/2),p=a(i/2);switch(s){case"XYZ":this._x=h*u*c+l*d*p,this._y=l*d*c-h*u*p,this._z=l*u*p+h*d*c,this._w=l*u*c-h*d*p;break;case"YXZ":this._x=h*u*c+l*d*p,this._y=l*d*c-h*u*p,this._z=l*u*p-h*d*c,this._w=l*u*c+h*d*p;break;case"ZXY":this._x=h*u*c-l*d*p,this._y=l*d*c+h*u*p,this._z=l*u*p+h*d*c,this._w=l*u*c-h*d*p;break;case"ZYX":this._x=h*u*c-l*d*p,this._y=l*d*c+h*u*p,this._z=l*u*p-h*d*c,this._w=l*u*c+h*d*p;break;case"YZX":this._x=h*u*c+l*d*p,this._y=l*d*c+h*u*p,this._z=l*u*p-h*d*c,this._w=l*u*c-h*d*p;break;case"XZY":this._x=h*u*c-l*d*p,this._y=l*d*c-h*u*p,this._z=l*u*p+h*d*c,this._w=l*u*c+h*d*p;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+s)}return!0===e&&this._onChangeCallback(),this}setFromAxisAngle(t,e){const n=e/2,r=Math.sin(n);return this._x=t.x*r,this._y=t.y*r,this._z=t.z*r,this._w=Math.cos(n),this._onChangeCallback(),this}setFromRotationMatrix(t){const e=t.elements,n=e[0],r=e[4],i=e[8],s=e[1],o=e[5],a=e[9],l=e[2],u=e[6],c=e[10],h=n+o+c;if(h>0){const t=.5/Math.sqrt(h+1);this._w=.25/t,this._x=(u-a)*t,this._y=(i-l)*t,this._z=(s-r)*t}else if(n>o&&n>c){const t=2*Math.sqrt(1+n-o-c);this._w=(u-a)/t,this._x=.25*t,this._y=(r+s)/t,this._z=(i+l)/t}else if(o>c){const t=2*Math.sqrt(1+o-n-c);this._w=(i-l)/t,this._x=(r+s)/t,this._y=.25*t,this._z=(a+u)/t}else{const t=2*Math.sqrt(1+c-n-o);this._w=(s-r)/t,this._x=(i+l)/t,this._y=(a+u)/t,this._z=.25*t}return this._onChangeCallback(),this}setFromUnitVectors(t,e){let n=t.dot(e)+1;return n<Number.EPSILON?(n=0,Math.abs(t.x)>Math.abs(t.z)?(this._x=-t.y,this._y=t.x,this._z=0,this._w=n):(this._x=0,this._y=-t.z,this._z=t.y,this._w=n)):(this._x=t.y*e.z-t.z*e.y,this._y=t.z*e.x-t.x*e.z,this._z=t.x*e.y-t.y*e.x,this._w=n),this.normalize()}angleTo(t){return 2*Math.acos(Math.abs(Vt(this.dot(t),-1,1)))}rotateTowards(t,e){const n=this.angleTo(t);if(0===n)return this;const r=Math.min(1,e/n);return this.slerp(t,r),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let t=this.length();return 0===t?(this._x=0,this._y=0,this._z=0,this._w=1):(t=1/t,this._x=this._x*t,this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this._onChangeCallback(),this}multiply(t){return this.multiplyQuaternions(this,t)}premultiply(t){return this.multiplyQuaternions(t,this)}multiplyQuaternions(t,e){const n=t._x,r=t._y,i=t._z,s=t._w,o=e._x,a=e._y,l=e._z,u=e._w;return this._x=n*u+s*o+r*l-i*a,this._y=r*u+s*a+i*o-n*l,this._z=i*u+s*l+n*a-r*o,this._w=s*u-n*o-r*a-i*l,this._onChangeCallback(),this}slerp(t,e){if(0===e)return this;if(1===e)return this.copy(t);const n=this._x,r=this._y,i=this._z,s=this._w;let o=s*t._w+n*t._x+r*t._y+i*t._z;if(o<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,o=-o):this.copy(t),o>=1)return this._w=s,this._x=n,this._y=r,this._z=i,this;const a=1-o*o;if(a<=Number.EPSILON){const t=1-e;return this._w=t*s+e*this._w,this._x=t*n+e*this._x,this._y=t*r+e*this._y,this._z=t*i+e*this._z,this.normalize(),this}const l=Math.sqrt(a),u=Math.atan2(l,o),c=Math.sin((1-e)*u)/l,h=Math.sin(e*u)/l;return this._w=s*c+this._w*h,this._x=n*c+this._x*h,this._y=r*c+this._y*h,this._z=i*c+this._z*h,this._onChangeCallback(),this}slerpQuaternions(t,e,n){return this.copy(t).slerp(e,n)}random(){const t=2*Math.PI*Math.random(),e=2*Math.PI*Math.random(),n=Math.random(),r=Math.sqrt(1-n),i=Math.sqrt(n);return this.set(r*Math.sin(t),r*Math.cos(t),i*Math.sin(e),i*Math.cos(e))}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w}fromArray(t,e=0){return this._x=t[e],this._y=t[e+1],this._z=t[e+2],this._w=t[e+3],this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._w,t}fromBufferAttribute(t,e){return this._x=t.getX(e),this._y=t.getY(e),this._z=t.getZ(e),this._w=t.getW(e),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class we{constructor(t=0,e=0,n=0){we.prototype.isVector3=!0,this.x=t,this.y=e,this.z=n}set(t,e,n){return void 0===n&&(n=this.z),this.x=t,this.y=e,this.z=n,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this}multiplyVectors(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this}applyEuler(t){return this.applyQuaternion(Me.setFromEuler(t))}applyAxisAngle(t,e){return this.applyQuaternion(Me.setFromAxisAngle(t,e))}applyMatrix3(t){const e=this.x,n=this.y,r=this.z,i=t.elements;return this.x=i[0]*e+i[3]*n+i[6]*r,this.y=i[1]*e+i[4]*n+i[7]*r,this.z=i[2]*e+i[5]*n+i[8]*r,this}applyNormalMatrix(t){return this.applyMatrix3(t).normalize()}applyMatrix4(t){const e=this.x,n=this.y,r=this.z,i=t.elements,s=1/(i[3]*e+i[7]*n+i[11]*r+i[15]);return this.x=(i[0]*e+i[4]*n+i[8]*r+i[12])*s,this.y=(i[1]*e+i[5]*n+i[9]*r+i[13])*s,this.z=(i[2]*e+i[6]*n+i[10]*r+i[14])*s,this}applyQuaternion(t){const e=this.x,n=this.y,r=this.z,i=t.x,s=t.y,o=t.z,a=t.w,l=2*(s*r-o*n),u=2*(o*e-i*r),c=2*(i*n-s*e);return this.x=e+a*l+s*c-o*u,this.y=n+a*u+o*l-i*c,this.z=r+a*c+i*u-s*l,this}project(t){return this.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix)}unproject(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld)}transformDirection(t){const e=this.x,n=this.y,r=this.z,i=t.elements;return this.x=i[0]*e+i[4]*n+i[8]*r,this.y=i[1]*e+i[5]*n+i[9]*r,this.z=i[2]*e+i[6]*n+i[10]*r,this.normalize()}divide(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this}divideScalar(t){return this.multiplyScalar(1/t)}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this}clampLength(t,e){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(t,Math.min(e,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this}lerpVectors(t,e,n){return this.x=t.x+(e.x-t.x)*n,this.y=t.y+(e.y-t.y)*n,this.z=t.z+(e.z-t.z)*n,this}cross(t){return this.crossVectors(this,t)}crossVectors(t,e){const n=t.x,r=t.y,i=t.z,s=e.x,o=e.y,a=e.z;return this.x=r*a-i*o,this.y=i*s-n*a,this.z=n*o-r*s,this}projectOnVector(t){const e=t.lengthSq();if(0===e)return this.set(0,0,0);const n=t.dot(this)/e;return this.copy(t).multiplyScalar(n)}projectOnPlane(t){return Se.copy(this).projectOnVector(t),this.sub(Se)}reflect(t){return this.sub(Se.copy(t).multiplyScalar(2*this.dot(t)))}angleTo(t){const e=Math.sqrt(this.lengthSq()*t.lengthSq());if(0===e)return Math.PI/2;const n=this.dot(t)/e;return Math.acos(Vt(n,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,n=this.y-t.y,r=this.z-t.z;return e*e+n*n+r*r}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)}setFromSpherical(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)}setFromSphericalCoords(t,e,n){const r=Math.sin(e)*t;return this.x=r*Math.sin(n),this.y=Math.cos(e)*t,this.z=r*Math.cos(n),this}setFromCylindrical(t){return this.setFromCylindricalCoords(t.radius,t.theta,t.y)}setFromCylindricalCoords(t,e,n){return this.x=t*Math.sin(e),this.y=n,this.z=t*Math.cos(e),this}setFromMatrixPosition(t){const e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this}setFromMatrixScale(t){const e=this.setFromMatrixColumn(t,0).length(),n=this.setFromMatrixColumn(t,1).length(),r=this.setFromMatrixColumn(t,2).length();return this.x=e,this.y=n,this.z=r,this}setFromMatrixColumn(t,e){return this.fromArray(t.elements,4*e)}setFromMatrix3Column(t,e){return this.fromArray(t.elements,3*e)}setFromEuler(t){return this.x=t._x,this.y=t._y,this.z=t._z,this}setFromColor(t){return this.x=t.r,this.y=t.g,this.z=t.b,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const t=Math.random()*Math.PI*2,e=2*Math.random()-1,n=Math.sqrt(1-e*e);return this.x=n*Math.cos(t),this.y=e,this.z=n*Math.sin(t),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const Se=new we,Me=new be;class Ee{constructor(t=new we(1/0,1/0,1/0),e=new we(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=t,this.max=e}set(t,e){return this.min.copy(t),this.max.copy(e),this}setFromArray(t){this.makeEmpty();for(let e=0,n=t.length;e<n;e+=3)this.expandByPoint(Ae.fromArray(t,e));return this}setFromBufferAttribute(t){this.makeEmpty();for(let e=0,n=t.count;e<n;e++)this.expandByPoint(Ae.fromBufferAttribute(t,e));return this}setFromPoints(t){this.makeEmpty();for(let e=0,n=t.length;e<n;e++)this.expandByPoint(t[e]);return this}setFromCenterAndSize(t,e){const n=Ae.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(n),this.max.copy(t).add(n),this}setFromObject(t,e=!1){return this.makeEmpty(),this.expandByObject(t,e)}clone(){return(new this.constructor).copy(this)}copy(t){return this.min.copy(t.min),this.max.copy(t.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(t){return this.isEmpty()?t.set(0,0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(t){return this.isEmpty()?t.set(0,0,0):t.subVectors(this.max,this.min)}expandByPoint(t){return this.min.min(t),this.max.max(t),this}expandByVector(t){return this.min.sub(t),this.max.add(t),this}expandByScalar(t){return this.min.addScalar(-t),this.max.addScalar(t),this}expandByObject(t,e=!1){t.updateWorldMatrix(!1,!1);const n=t.geometry;if(void 0!==n){const r=n.getAttribute("position");if(!0===e&&void 0!==r&&!0!==t.isInstancedMesh)for(let e=0,n=r.count;e<n;e++)!0===t.isMesh?t.getVertexPosition(e,Ae):Ae.fromBufferAttribute(r,e),Ae.applyMatrix4(t.matrixWorld),this.expandByPoint(Ae);else void 0!==t.boundingBox?(null===t.boundingBox&&t.computeBoundingBox(),Ce.copy(t.boundingBox)):(null===n.boundingBox&&n.computeBoundingBox(),Ce.copy(n.boundingBox)),Ce.applyMatrix4(t.matrixWorld),this.union(Ce)}const r=t.children;for(let t=0,n=r.length;t<n;t++)this.expandByObject(r[t],e);return this}containsPoint(t){return t.x>=this.min.x&&t.x<=this.max.x&&t.y>=this.min.y&&t.y<=this.max.y&&t.z>=this.min.z&&t.z<=this.max.z}containsBox(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y&&this.min.z<=t.min.z&&t.max.z<=this.max.z}getParameter(t,e){return e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y),(t.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(t){return t.max.x>=this.min.x&&t.min.x<=this.max.x&&t.max.y>=this.min.y&&t.min.y<=this.max.y&&t.max.z>=this.min.z&&t.min.z<=this.max.z}intersectsSphere(t){return this.clampPoint(t.center,Ae),Ae.distanceToSquared(t.center)<=t.radius*t.radius}intersectsPlane(t){let e,n;return t.normal.x>0?(e=t.normal.x*this.min.x,n=t.normal.x*this.max.x):(e=t.normal.x*this.max.x,n=t.normal.x*this.min.x),t.normal.y>0?(e+=t.normal.y*this.min.y,n+=t.normal.y*this.max.y):(e+=t.normal.y*this.max.y,n+=t.normal.y*this.min.y),t.normal.z>0?(e+=t.normal.z*this.min.z,n+=t.normal.z*this.max.z):(e+=t.normal.z*this.max.z,n+=t.normal.z*this.min.z),e<=-t.constant&&n>=-t.constant}intersectsTriangle(t){if(this.isEmpty())return!1;this.getCenter(Le),Ue.subVectors(this.max,Le),Re.subVectors(t.a,Le),Ne.subVectors(t.b,Le),Pe.subVectors(t.c,Le),Ie.subVectors(Ne,Re),Oe.subVectors(Pe,Ne),De.subVectors(Re,Pe);let e=[0,-Ie.z,Ie.y,0,-Oe.z,Oe.y,0,-De.z,De.y,Ie.z,0,-Ie.x,Oe.z,0,-Oe.x,De.z,0,-De.x,-Ie.y,Ie.x,0,-Oe.y,Oe.x,0,-De.y,De.x,0];return!!Fe(e,Re,Ne,Pe,Ue)&&(e=[1,0,0,0,1,0,0,0,1],!!Fe(e,Re,Ne,Pe,Ue)&&(ke.crossVectors(Ie,Oe),e=[ke.x,ke.y,ke.z],Fe(e,Re,Ne,Pe,Ue)))}clampPoint(t,e){return e.copy(t).clamp(this.min,this.max)}distanceToPoint(t){return this.clampPoint(t,Ae).distanceTo(t)}getBoundingSphere(t){return this.isEmpty()?t.makeEmpty():(this.getCenter(t.center),t.radius=.5*this.getSize(Ae).length()),t}intersect(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this}union(t){return this.min.min(t.min),this.max.max(t.max),this}applyMatrix4(t){return this.isEmpty()||(Te[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),Te[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),Te[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),Te[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),Te[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),Te[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),Te[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),Te[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.setFromPoints(Te)),this}translate(t){return this.min.add(t),this.max.add(t),this}equals(t){return t.min.equals(this.min)&&t.max.equals(this.max)}}const Te=[new we,new we,new we,new we,new we,new we,new we,new we],Ae=new we,Ce=new Ee,Re=new we,Ne=new we,Pe=new we,Ie=new we,Oe=new we,De=new we,Le=new we,Ue=new we,ke=new we,Be=new we;function Fe(t,e,n,r,i){for(let s=0,o=t.length-3;s<=o;s+=3){Be.fromArray(t,s);const o=i.x*Math.abs(Be.x)+i.y*Math.abs(Be.y)+i.z*Math.abs(Be.z),a=e.dot(Be),l=n.dot(Be),u=r.dot(Be);if(Math.max(-Math.max(a,l,u),Math.min(a,l,u))>o)return!1}return!0}const ze=new Ee,Ve=new we,Ge=new we;class je{constructor(t=new we,e=-1){this.isSphere=!0,this.center=t,this.radius=e}set(t,e){return this.center.copy(t),this.radius=e,this}setFromPoints(t,e){const n=this.center;void 0!==e?n.copy(e):ze.setFromPoints(t).getCenter(n);let r=0;for(let e=0,i=t.length;e<i;e++)r=Math.max(r,n.distanceToSquared(t[e]));return this.radius=Math.sqrt(r),this}copy(t){return this.center.copy(t.center),this.radius=t.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(t){return t.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(t){return t.distanceTo(this.center)-this.radius}intersectsSphere(t){const e=this.radius+t.radius;return t.center.distanceToSquared(this.center)<=e*e}intersectsBox(t){return t.intersectsSphere(this)}intersectsPlane(t){return Math.abs(t.distanceToPoint(this.center))<=this.radius}clampPoint(t,e){const n=this.center.distanceToSquared(t);return e.copy(t),n>this.radius*this.radius&&(e.sub(this.center).normalize(),e.multiplyScalar(this.radius).add(this.center)),e}getBoundingBox(t){return this.isEmpty()?(t.makeEmpty(),t):(t.set(this.center,this.center),t.expandByScalar(this.radius),t)}applyMatrix4(t){return this.center.applyMatrix4(t),this.radius=this.radius*t.getMaxScaleOnAxis(),this}translate(t){return this.center.add(t),this}expandByPoint(t){if(this.isEmpty())return this.center.copy(t),this.radius=0,this;Ve.subVectors(t,this.center);const e=Ve.lengthSq();if(e>this.radius*this.radius){const t=Math.sqrt(e),n=.5*(t-this.radius);this.center.addScaledVector(Ve,n/t),this.radius+=n}return this}union(t){return t.isEmpty()?this:this.isEmpty()?(this.copy(t),this):(!0===this.center.equals(t.center)?this.radius=Math.max(this.radius,t.radius):(Ge.subVectors(t.center,this.center).setLength(t.radius),this.expandByPoint(Ve.copy(t.center).add(Ge)),this.expandByPoint(Ve.copy(t.center).sub(Ge))),this)}equals(t){return t.center.equals(this.center)&&t.radius===this.radius}clone(){return(new this.constructor).copy(this)}}const He=new we,We=new we,qe=new we,Xe=new we,Ze=new we,$e=new we,Ye=new we;class Ke{constructor(t=new we,e=new we(0,0,-1)){this.origin=t,this.direction=e}set(t,e){return this.origin.copy(t),this.direction.copy(e),this}copy(t){return this.origin.copy(t.origin),this.direction.copy(t.direction),this}at(t,e){return e.copy(this.origin).addScaledVector(this.direction,t)}lookAt(t){return this.direction.copy(t).sub(this.origin).normalize(),this}recast(t){return this.origin.copy(this.at(t,He)),this}closestPointToPoint(t,e){e.subVectors(t,this.origin);const n=e.dot(this.direction);return n<0?e.copy(this.origin):e.copy(this.origin).addScaledVector(this.direction,n)}distanceToPoint(t){return Math.sqrt(this.distanceSqToPoint(t))}distanceSqToPoint(t){const e=He.subVectors(t,this.origin).dot(this.direction);return e<0?this.origin.distanceToSquared(t):(He.copy(this.origin).addScaledVector(this.direction,e),He.distanceToSquared(t))}distanceSqToSegment(t,e,n,r){We.copy(t).add(e).multiplyScalar(.5),qe.copy(e).sub(t).normalize(),Xe.copy(this.origin).sub(We);const i=.5*t.distanceTo(e),s=-this.direction.dot(qe),o=Xe.dot(this.direction),a=-Xe.dot(qe),l=Xe.lengthSq(),u=Math.abs(1-s*s);let c,h,d,p;if(u>0)if(c=s*a-o,h=s*o-a,p=i*u,c>=0)if(h>=-p)if(h<=p){const t=1/u;c*=t,h*=t,d=c*(c+s*h+2*o)+h*(s*c+h+2*a)+l}else h=i,c=Math.max(0,-(s*h+o)),d=-c*c+h*(h+2*a)+l;else h=-i,c=Math.max(0,-(s*h+o)),d=-c*c+h*(h+2*a)+l;else h<=-p?(c=Math.max(0,-(-s*i+o)),h=c>0?-i:Math.min(Math.max(-i,-a),i),d=-c*c+h*(h+2*a)+l):h<=p?(c=0,h=Math.min(Math.max(-i,-a),i),d=h*(h+2*a)+l):(c=Math.max(0,-(s*i+o)),h=c>0?i:Math.min(Math.max(-i,-a),i),d=-c*c+h*(h+2*a)+l);else h=s>0?-i:i,c=Math.max(0,-(s*h+o)),d=-c*c+h*(h+2*a)+l;return n&&n.copy(this.origin).addScaledVector(this.direction,c),r&&r.copy(We).addScaledVector(qe,h),d}intersectSphere(t,e){He.subVectors(t.center,this.origin);const n=He.dot(this.direction),r=He.dot(He)-n*n,i=t.radius*t.radius;if(r>i)return null;const s=Math.sqrt(i-r),o=n-s,a=n+s;return a<0?null:o<0?this.at(a,e):this.at(o,e)}intersectsSphere(t){return this.distanceSqToPoint(t.center)<=t.radius*t.radius}distanceToPlane(t){const e=t.normal.dot(this.direction);if(0===e)return 0===t.distanceToPoint(this.origin)?0:null;const n=-(this.origin.dot(t.normal)+t.constant)/e;return n>=0?n:null}intersectPlane(t,e){const n=this.distanceToPlane(t);return null===n?null:this.at(n,e)}intersectsPlane(t){const e=t.distanceToPoint(this.origin);if(0===e)return!0;return t.normal.dot(this.direction)*e<0}intersectBox(t,e){let n,r,i,s,o,a;const l=1/this.direction.x,u=1/this.direction.y,c=1/this.direction.z,h=this.origin;return l>=0?(n=(t.min.x-h.x)*l,r=(t.max.x-h.x)*l):(n=(t.max.x-h.x)*l,r=(t.min.x-h.x)*l),u>=0?(i=(t.min.y-h.y)*u,s=(t.max.y-h.y)*u):(i=(t.max.y-h.y)*u,s=(t.min.y-h.y)*u),n>s||i>r?null:((i>n||isNaN(n))&&(n=i),(s<r||isNaN(r))&&(r=s),c>=0?(o=(t.min.z-h.z)*c,a=(t.max.z-h.z)*c):(o=(t.max.z-h.z)*c,a=(t.min.z-h.z)*c),n>a||o>r?null:((o>n||n!=n)&&(n=o),(a<r||r!=r)&&(r=a),r<0?null:this.at(n>=0?n:r,e)))}intersectsBox(t){return null!==this.intersectBox(t,He)}intersectTriangle(t,e,n,r,i){Ze.subVectors(e,t),$e.subVectors(n,t),Ye.crossVectors(Ze,$e);let s,o=this.direction.dot(Ye);if(o>0){if(r)return null;s=1}else{if(!(o<0))return null;s=-1,o=-o}Xe.subVectors(this.origin,t);const a=s*this.direction.dot($e.crossVectors(Xe,$e));if(a<0)return null;const l=s*this.direction.dot(Ze.cross(Xe));if(l<0)return null;if(a+l>o)return null;const u=-s*Xe.dot(Ye);return u<0?null:this.at(u/o,i)}applyMatrix4(t){return this.origin.applyMatrix4(t),this.direction.transformDirection(t),this}equals(t){return t.origin.equals(this.origin)&&t.direction.equals(this.direction)}clone(){return(new this.constructor).copy(this)}}class Je{constructor(t,e,n,r,i,s,o,a,l,u,c,h,d,p,f,m){Je.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],void 0!==t&&this.set(t,e,n,r,i,s,o,a,l,u,c,h,d,p,f,m)}set(t,e,n,r,i,s,o,a,l,u,c,h,d,p,f,m){const g=this.elements;return g[0]=t,g[4]=e,g[8]=n,g[12]=r,g[1]=i,g[5]=s,g[9]=o,g[13]=a,g[2]=l,g[6]=u,g[10]=c,g[14]=h,g[3]=d,g[7]=p,g[11]=f,g[15]=m,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return(new Je).fromArray(this.elements)}copy(t){const e=this.elements,n=t.elements;return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],e[9]=n[9],e[10]=n[10],e[11]=n[11],e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15],this}copyPosition(t){const e=this.elements,n=t.elements;return e[12]=n[12],e[13]=n[13],e[14]=n[14],this}setFromMatrix3(t){const e=t.elements;return this.set(e[0],e[3],e[6],0,e[1],e[4],e[7],0,e[2],e[5],e[8],0,0,0,0,1),this}extractBasis(t,e,n){return t.setFromMatrixColumn(this,0),e.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this}makeBasis(t,e,n){return this.set(t.x,e.x,n.x,0,t.y,e.y,n.y,0,t.z,e.z,n.z,0,0,0,0,1),this}extractRotation(t){const e=this.elements,n=t.elements,r=1/Qe.setFromMatrixColumn(t,0).length(),i=1/Qe.setFromMatrixColumn(t,1).length(),s=1/Qe.setFromMatrixColumn(t,2).length();return e[0]=n[0]*r,e[1]=n[1]*r,e[2]=n[2]*r,e[3]=0,e[4]=n[4]*i,e[5]=n[5]*i,e[6]=n[6]*i,e[7]=0,e[8]=n[8]*s,e[9]=n[9]*s,e[10]=n[10]*s,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromEuler(t){const e=this.elements,n=t.x,r=t.y,i=t.z,s=Math.cos(n),o=Math.sin(n),a=Math.cos(r),l=Math.sin(r),u=Math.cos(i),c=Math.sin(i);if("XYZ"===t.order){const t=s*u,n=s*c,r=o*u,i=o*c;e[0]=a*u,e[4]=-a*c,e[8]=l,e[1]=n+r*l,e[5]=t-i*l,e[9]=-o*a,e[2]=i-t*l,e[6]=r+n*l,e[10]=s*a}else if("YXZ"===t.order){const t=a*u,n=a*c,r=l*u,i=l*c;e[0]=t+i*o,e[4]=r*o-n,e[8]=s*l,e[1]=s*c,e[5]=s*u,e[9]=-o,e[2]=n*o-r,e[6]=i+t*o,e[10]=s*a}else if("ZXY"===t.order){const t=a*u,n=a*c,r=l*u,i=l*c;e[0]=t-i*o,e[4]=-s*c,e[8]=r+n*o,e[1]=n+r*o,e[5]=s*u,e[9]=i-t*o,e[2]=-s*l,e[6]=o,e[10]=s*a}else if("ZYX"===t.order){const t=s*u,n=s*c,r=o*u,i=o*c;e[0]=a*u,e[4]=r*l-n,e[8]=t*l+i,e[1]=a*c,e[5]=i*l+t,e[9]=n*l-r,e[2]=-l,e[6]=o*a,e[10]=s*a}else if("YZX"===t.order){const t=s*a,n=s*l,r=o*a,i=o*l;e[0]=a*u,e[4]=i-t*c,e[8]=r*c+n,e[1]=c,e[5]=s*u,e[9]=-o*u,e[2]=-l*u,e[6]=n*c+r,e[10]=t-i*c}else if("XZY"===t.order){const t=s*a,n=s*l,r=o*a,i=o*l;e[0]=a*u,e[4]=-c,e[8]=l*u,e[1]=t*c+i,e[5]=s*u,e[9]=n*c-r,e[2]=r*c-n,e[6]=o*u,e[10]=i*c+t}return e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromQuaternion(t){return this.compose(en,t,nn)}lookAt(t,e,n){const r=this.elements;return on.subVectors(t,e),0===on.lengthSq()&&(on.z=1),on.normalize(),rn.crossVectors(n,on),0===rn.lengthSq()&&(1===Math.abs(n.z)?on.x+=1e-4:on.z+=1e-4,on.normalize(),rn.crossVectors(n,on)),rn.normalize(),sn.crossVectors(on,rn),r[0]=rn.x,r[4]=sn.x,r[8]=on.x,r[1]=rn.y,r[5]=sn.y,r[9]=on.y,r[2]=rn.z,r[6]=sn.z,r[10]=on.z,this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const n=t.elements,r=e.elements,i=this.elements,s=n[0],o=n[4],a=n[8],l=n[12],u=n[1],c=n[5],h=n[9],d=n[13],p=n[2],f=n[6],m=n[10],g=n[14],v=n[3],y=n[7],_=n[11],x=n[15],b=r[0],w=r[4],S=r[8],M=r[12],E=r[1],T=r[5],A=r[9],C=r[13],R=r[2],N=r[6],P=r[10],I=r[14],O=r[3],D=r[7],L=r[11],U=r[15];return i[0]=s*b+o*E+a*R+l*O,i[4]=s*w+o*T+a*N+l*D,i[8]=s*S+o*A+a*P+l*L,i[12]=s*M+o*C+a*I+l*U,i[1]=u*b+c*E+h*R+d*O,i[5]=u*w+c*T+h*N+d*D,i[9]=u*S+c*A+h*P+d*L,i[13]=u*M+c*C+h*I+d*U,i[2]=p*b+f*E+m*R+g*O,i[6]=p*w+f*T+m*N+g*D,i[10]=p*S+f*A+m*P+g*L,i[14]=p*M+f*C+m*I+g*U,i[3]=v*b+y*E+_*R+x*O,i[7]=v*w+y*T+_*N+x*D,i[11]=v*S+y*A+_*P+x*L,i[15]=v*M+y*C+_*I+x*U,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[4]*=t,e[8]*=t,e[12]*=t,e[1]*=t,e[5]*=t,e[9]*=t,e[13]*=t,e[2]*=t,e[6]*=t,e[10]*=t,e[14]*=t,e[3]*=t,e[7]*=t,e[11]*=t,e[15]*=t,this}determinant(){const t=this.elements,e=t[0],n=t[4],r=t[8],i=t[12],s=t[1],o=t[5],a=t[9],l=t[13],u=t[2],c=t[6],h=t[10],d=t[14];return t[3]*(+i*a*c-r*l*c-i*o*h+n*l*h+r*o*d-n*a*d)+t[7]*(+e*a*d-e*l*h+i*s*h-r*s*d+r*l*u-i*a*u)+t[11]*(+e*l*c-e*o*d-i*s*c+n*s*d+i*o*u-n*l*u)+t[15]*(-r*o*u-e*a*c+e*o*h+r*s*c-n*s*h+n*a*u)}transpose(){const t=this.elements;let e;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this}setPosition(t,e,n){const r=this.elements;return t.isVector3?(r[12]=t.x,r[13]=t.y,r[14]=t.z):(r[12]=t,r[13]=e,r[14]=n),this}invert(){const t=this.elements,e=t[0],n=t[1],r=t[2],i=t[3],s=t[4],o=t[5],a=t[6],l=t[7],u=t[8],c=t[9],h=t[10],d=t[11],p=t[12],f=t[13],m=t[14],g=t[15],v=c*m*l-f*h*l+f*a*d-o*m*d-c*a*g+o*h*g,y=p*h*l-u*m*l-p*a*d+s*m*d+u*a*g-s*h*g,_=u*f*l-p*c*l+p*o*d-s*f*d-u*o*g+s*c*g,x=p*c*a-u*f*a-p*o*h+s*f*h+u*o*m-s*c*m,b=e*v+n*y+r*_+i*x;if(0===b)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const w=1/b;return t[0]=v*w,t[1]=(f*h*i-c*m*i-f*r*d+n*m*d+c*r*g-n*h*g)*w,t[2]=(o*m*i-f*a*i+f*r*l-n*m*l-o*r*g+n*a*g)*w,t[3]=(c*a*i-o*h*i-c*r*l+n*h*l+o*r*d-n*a*d)*w,t[4]=y*w,t[5]=(u*m*i-p*h*i+p*r*d-e*m*d-u*r*g+e*h*g)*w,t[6]=(p*a*i-s*m*i-p*r*l+e*m*l+s*r*g-e*a*g)*w,t[7]=(s*h*i-u*a*i+u*r*l-e*h*l-s*r*d+e*a*d)*w,t[8]=_*w,t[9]=(p*c*i-u*f*i-p*n*d+e*f*d+u*n*g-e*c*g)*w,t[10]=(s*f*i-p*o*i+p*n*l-e*f*l-s*n*g+e*o*g)*w,t[11]=(u*o*i-s*c*i-u*n*l+e*c*l+s*n*d-e*o*d)*w,t[12]=x*w,t[13]=(u*f*r-p*c*r+p*n*h-e*f*h-u*n*m+e*c*m)*w,t[14]=(p*o*r-s*f*r-p*n*a+e*f*a+s*n*m-e*o*m)*w,t[15]=(s*c*r-u*o*r+u*n*a-e*c*a-s*n*h+e*o*h)*w,this}scale(t){const e=this.elements,n=t.x,r=t.y,i=t.z;return e[0]*=n,e[4]*=r,e[8]*=i,e[1]*=n,e[5]*=r,e[9]*=i,e[2]*=n,e[6]*=r,e[10]*=i,e[3]*=n,e[7]*=r,e[11]*=i,this}getMaxScaleOnAxis(){const t=this.elements,e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],n=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],r=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(e,n,r))}makeTranslation(t,e,n){return t.isVector3?this.set(1,0,0,t.x,0,1,0,t.y,0,0,1,t.z,0,0,0,1):this.set(1,0,0,t,0,1,0,e,0,0,1,n,0,0,0,1),this}makeRotationX(t){const e=Math.cos(t),n=Math.sin(t);return this.set(1,0,0,0,0,e,-n,0,0,n,e,0,0,0,0,1),this}makeRotationY(t){const e=Math.cos(t),n=Math.sin(t);return this.set(e,0,n,0,0,1,0,0,-n,0,e,0,0,0,0,1),this}makeRotationZ(t){const e=Math.cos(t),n=Math.sin(t);return this.set(e,-n,0,0,n,e,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(t,e){const n=Math.cos(e),r=Math.sin(e),i=1-n,s=t.x,o=t.y,a=t.z,l=i*s,u=i*o;return this.set(l*s+n,l*o-r*a,l*a+r*o,0,l*o+r*a,u*o+n,u*a-r*s,0,l*a-r*o,u*a+r*s,i*a*a+n,0,0,0,0,1),this}makeScale(t,e,n){return this.set(t,0,0,0,0,e,0,0,0,0,n,0,0,0,0,1),this}makeShear(t,e,n,r,i,s){return this.set(1,n,i,0,t,1,s,0,e,r,1,0,0,0,0,1),this}compose(t,e,n){const r=this.elements,i=e._x,s=e._y,o=e._z,a=e._w,l=i+i,u=s+s,c=o+o,h=i*l,d=i*u,p=i*c,f=s*u,m=s*c,g=o*c,v=a*l,y=a*u,_=a*c,x=n.x,b=n.y,w=n.z;return r[0]=(1-(f+g))*x,r[1]=(d+_)*x,r[2]=(p-y)*x,r[3]=0,r[4]=(d-_)*b,r[5]=(1-(h+g))*b,r[6]=(m+v)*b,r[7]=0,r[8]=(p+y)*w,r[9]=(m-v)*w,r[10]=(1-(h+f))*w,r[11]=0,r[12]=t.x,r[13]=t.y,r[14]=t.z,r[15]=1,this}decompose(t,e,n){const r=this.elements;let i=Qe.set(r[0],r[1],r[2]).length();const s=Qe.set(r[4],r[5],r[6]).length(),o=Qe.set(r[8],r[9],r[10]).length();this.determinant()<0&&(i=-i),t.x=r[12],t.y=r[13],t.z=r[14],tn.copy(this);const a=1/i,l=1/s,u=1/o;return tn.elements[0]*=a,tn.elements[1]*=a,tn.elements[2]*=a,tn.elements[4]*=l,tn.elements[5]*=l,tn.elements[6]*=l,tn.elements[8]*=u,tn.elements[9]*=u,tn.elements[10]*=u,e.setFromRotationMatrix(tn),n.x=i,n.y=s,n.z=o,this}makePerspective(t,e,n,r,i,s,o=2e3){const a=this.elements,l=2*i/(e-t),u=2*i/(n-r),c=(e+t)/(e-t),h=(n+r)/(n-r);let d,p;if(o===Ot)d=-(s+i)/(s-i),p=-2*s*i/(s-i);else{if(o!==Dt)throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+o);d=-s/(s-i),p=-s*i/(s-i)}return a[0]=l,a[4]=0,a[8]=c,a[12]=0,a[1]=0,a[5]=u,a[9]=h,a[13]=0,a[2]=0,a[6]=0,a[10]=d,a[14]=p,a[3]=0,a[7]=0,a[11]=-1,a[15]=0,this}makeOrthographic(t,e,n,r,i,s,o=2e3){const a=this.elements,l=1/(e-t),u=1/(n-r),c=1/(s-i),h=(e+t)*l,d=(n+r)*u;let p,f;if(o===Ot)p=(s+i)*c,f=-2*c;else{if(o!==Dt)throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+o);p=i*c,f=-1*c}return a[0]=2*l,a[4]=0,a[8]=0,a[12]=-h,a[1]=0,a[5]=2*u,a[9]=0,a[13]=-d,a[2]=0,a[6]=0,a[10]=f,a[14]=-p,a[3]=0,a[7]=0,a[11]=0,a[15]=1,this}equals(t){const e=this.elements,n=t.elements;for(let t=0;t<16;t++)if(e[t]!==n[t])return!1;return!0}fromArray(t,e=0){for(let n=0;n<16;n++)this.elements[n]=t[n+e];return this}toArray(t=[],e=0){const n=this.elements;return t[e]=n[0],t[e+1]=n[1],t[e+2]=n[2],t[e+3]=n[3],t[e+4]=n[4],t[e+5]=n[5],t[e+6]=n[6],t[e+7]=n[7],t[e+8]=n[8],t[e+9]=n[9],t[e+10]=n[10],t[e+11]=n[11],t[e+12]=n[12],t[e+13]=n[13],t[e+14]=n[14],t[e+15]=n[15],t}}const Qe=new we,tn=new Je,en=new we(0,0,0),nn=new we(1,1,1),rn=new we,sn=new we,on=new we,an=new Je,ln=new be;class un{constructor(t=0,e=0,n=0,r=un.DEFAULT_ORDER){this.isEuler=!0,this._x=t,this._y=e,this._z=n,this._order=r}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get order(){return this._order}set order(t){this._order=t,this._onChangeCallback()}set(t,e,n,r=this._order){return this._x=t,this._y=e,this._z=n,this._order=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this._onChangeCallback(),this}setFromRotationMatrix(t,e=this._order,n=!0){const r=t.elements,i=r[0],s=r[4],o=r[8],a=r[1],l=r[5],u=r[9],c=r[2],h=r[6],d=r[10];switch(e){case"XYZ":this._y=Math.asin(Vt(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(-u,d),this._z=Math.atan2(-s,i)):(this._x=Math.atan2(h,l),this._z=0);break;case"YXZ":this._x=Math.asin(-Vt(u,-1,1)),Math.abs(u)<.9999999?(this._y=Math.atan2(o,d),this._z=Math.atan2(a,l)):(this._y=Math.atan2(-c,i),this._z=0);break;case"ZXY":this._x=Math.asin(Vt(h,-1,1)),Math.abs(h)<.9999999?(this._y=Math.atan2(-c,d),this._z=Math.atan2(-s,l)):(this._y=0,this._z=Math.atan2(a,i));break;case"ZYX":this._y=Math.asin(-Vt(c,-1,1)),Math.abs(c)<.9999999?(this._x=Math.atan2(h,d),this._z=Math.atan2(a,i)):(this._x=0,this._z=Math.atan2(-s,l));break;case"YZX":this._z=Math.asin(Vt(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-u,l),this._y=Math.atan2(-c,i)):(this._x=0,this._y=Math.atan2(o,d));break;case"XZY":this._z=Math.asin(-Vt(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(h,l),this._y=Math.atan2(o,i)):(this._x=Math.atan2(-u,d),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+e)}return this._order=e,!0===n&&this._onChangeCallback(),this}setFromQuaternion(t,e,n){return an.makeRotationFromQuaternion(t),this.setFromRotationMatrix(an,e,n)}setFromVector3(t,e=this._order){return this.set(t.x,t.y,t.z,e)}reorder(t){return ln.setFromEuler(this),this.setFromQuaternion(ln,t)}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order}fromArray(t){return this._x=t[0],this._y=t[1],this._z=t[2],void 0!==t[3]&&(this._order=t[3]),this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._order,t}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}un.DEFAULT_ORDER="XYZ";class cn{constructor(){this.mask=1}set(t){this.mask=(1<<t|0)>>>0}enable(t){this.mask|=1<<t|0}enableAll(){this.mask=-1}toggle(t){this.mask^=1<<t|0}disable(t){this.mask&=~(1<<t|0)}disableAll(){this.mask=0}test(t){return 0!=(this.mask&t.mask)}isEnabled(t){return 0!=(this.mask&(1<<t|0))}}let hn=0;const dn=new we,pn=new be,fn=new Je,mn=new we,gn=new we,vn=new we,yn=new be,_n=new we(1,0,0),xn=new we(0,1,0),bn=new we(0,0,1),wn={type:"added"},Sn={type:"removed"},Mn={type:"childadded",child:null},En={type:"childremoved",child:null};class Tn extends Lt{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:hn++}),this.uuid=zt(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Tn.DEFAULT_UP.clone();const t=new we,e=new un,n=new be,r=new we(1,1,1);e._onChange((function(){n.setFromEuler(e,!1)})),n._onChange((function(){e.setFromQuaternion(n,void 0,!1)})),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:t},rotation:{configurable:!0,enumerable:!0,value:e},quaternion:{configurable:!0,enumerable:!0,value:n},scale:{configurable:!0,enumerable:!0,value:r},modelViewMatrix:{value:new Je},normalMatrix:{value:new Zt}}),this.matrix=new Je,this.matrixWorld=new Je,this.matrixAutoUpdate=Tn.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=Tn.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new cn,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(t){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(t),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(t){return this.quaternion.premultiply(t),this}setRotationFromAxisAngle(t,e){this.quaternion.setFromAxisAngle(t,e)}setRotationFromEuler(t){this.quaternion.setFromEuler(t,!0)}setRotationFromMatrix(t){this.quaternion.setFromRotationMatrix(t)}setRotationFromQuaternion(t){this.quaternion.copy(t)}rotateOnAxis(t,e){return pn.setFromAxisAngle(t,e),this.quaternion.multiply(pn),this}rotateOnWorldAxis(t,e){return pn.setFromAxisAngle(t,e),this.quaternion.premultiply(pn),this}rotateX(t){return this.rotateOnAxis(_n,t)}rotateY(t){return this.rotateOnAxis(xn,t)}rotateZ(t){return this.rotateOnAxis(bn,t)}translateOnAxis(t,e){return dn.copy(t).applyQuaternion(this.quaternion),this.position.add(dn.multiplyScalar(e)),this}translateX(t){return this.translateOnAxis(_n,t)}translateY(t){return this.translateOnAxis(xn,t)}translateZ(t){return this.translateOnAxis(bn,t)}localToWorld(t){return this.updateWorldMatrix(!0,!1),t.applyMatrix4(this.matrixWorld)}worldToLocal(t){return this.updateWorldMatrix(!0,!1),t.applyMatrix4(fn.copy(this.matrixWorld).invert())}lookAt(t,e,n){t.isVector3?mn.copy(t):mn.set(t,e,n);const r=this.parent;this.updateWorldMatrix(!0,!1),gn.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?fn.lookAt(gn,mn,this.up):fn.lookAt(mn,gn,this.up),this.quaternion.setFromRotationMatrix(fn),r&&(fn.extractRotation(r.matrixWorld),pn.setFromRotationMatrix(fn),this.quaternion.premultiply(pn.invert()))}add(t){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return t===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",t),this):(t&&t.isObject3D?(t.removeFromParent(),t.parent=this,this.children.push(t),t.dispatchEvent(wn),Mn.child=t,this.dispatchEvent(Mn),Mn.child=null):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",t),this)}remove(t){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.remove(arguments[t]);return this}const e=this.children.indexOf(t);return-1!==e&&(t.parent=null,this.children.splice(e,1),t.dispatchEvent(Sn),En.child=t,this.dispatchEvent(En),En.child=null),this}removeFromParent(){const t=this.parent;return null!==t&&t.remove(this),this}clear(){return this.remove(...this.children)}attach(t){return this.updateWorldMatrix(!0,!1),fn.copy(this.matrixWorld).invert(),null!==t.parent&&(t.parent.updateWorldMatrix(!0,!1),fn.multiply(t.parent.matrixWorld)),t.applyMatrix4(fn),t.removeFromParent(),t.parent=this,this.children.push(t),t.updateWorldMatrix(!1,!0),t.dispatchEvent(wn),Mn.child=t,this.dispatchEvent(Mn),Mn.child=null,this}getObjectById(t){return this.getObjectByProperty("id",t)}getObjectByName(t){return this.getObjectByProperty("name",t)}getObjectByProperty(t,e){if(this[t]===e)return this;for(let n=0,r=this.children.length;n<r;n++){const r=this.children[n].getObjectByProperty(t,e);if(void 0!==r)return r}}getObjectsByProperty(t,e,n=[]){this[t]===e&&n.push(this);const r=this.children;for(let i=0,s=r.length;i<s;i++)r[i].getObjectsByProperty(t,e,n);return n}getWorldPosition(t){return this.updateWorldMatrix(!0,!1),t.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(gn,t,vn),t}getWorldScale(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(gn,yn,t),t}getWorldDirection(t){this.updateWorldMatrix(!0,!1);const e=this.matrixWorld.elements;return t.set(e[8],e[9],e[10]).normalize()}raycast(){}traverse(t){t(this);const e=this.children;for(let n=0,r=e.length;n<r;n++)e[n].traverse(t)}traverseVisible(t){if(!1===this.visible)return;t(this);const e=this.children;for(let n=0,r=e.length;n<r;n++)e[n].traverseVisible(t)}traverseAncestors(t){const e=this.parent;null!==e&&(t(e),e.traverseAncestors(t))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(!0===this.matrixWorldAutoUpdate&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),this.matrixWorldNeedsUpdate=!1,t=!0);const e=this.children;for(let n=0,r=e.length;n<r;n++){e[n].updateMatrixWorld(t)}}updateWorldMatrix(t,e){const n=this.parent;if(!0===t&&null!==n&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),!0===this.matrixWorldAutoUpdate&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),!0===e){const t=this.children;for(let e=0,n=t.length;e<n;e++){t[e].updateWorldMatrix(!1,!0)}}}toJSON(t){const e=void 0===t||"string"==typeof t,n={};e&&(t={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},n.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});const r={};function i(e,n){return void 0===e[n.uuid]&&(e[n.uuid]=n.toJSON(t)),n.uuid}if(r.uuid=this.uuid,r.type=this.type,""!==this.name&&(r.name=this.name),!0===this.castShadow&&(r.castShadow=!0),!0===this.receiveShadow&&(r.receiveShadow=!0),!1===this.visible&&(r.visible=!1),!1===this.frustumCulled&&(r.frustumCulled=!1),0!==this.renderOrder&&(r.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(r.userData=this.userData),r.layers=this.layers.mask,r.matrix=this.matrix.toArray(),r.up=this.up.toArray(),!1===this.matrixAutoUpdate&&(r.matrixAutoUpdate=!1),this.isInstancedMesh&&(r.type="InstancedMesh",r.count=this.count,r.instanceMatrix=this.instanceMatrix.toJSON(),null!==this.instanceColor&&(r.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(r.type="BatchedMesh",r.perObjectFrustumCulled=this.perObjectFrustumCulled,r.sortObjects=this.sortObjects,r.drawRanges=this._drawRanges,r.reservedRanges=this._reservedRanges,r.visibility=this._visibility,r.active=this._active,r.bounds=this._bounds.map((t=>({boxInitialized:t.boxInitialized,boxMin:t.box.min.toArray(),boxMax:t.box.max.toArray(),sphereInitialized:t.sphereInitialized,sphereRadius:t.sphere.radius,sphereCenter:t.sphere.center.toArray()}))),r.maxInstanceCount=this._maxInstanceCount,r.maxVertexCount=this._maxVertexCount,r.maxIndexCount=this._maxIndexCount,r.geometryInitialized=this._geometryInitialized,r.geometryCount=this._geometryCount,r.matricesTexture=this._matricesTexture.toJSON(t),null!==this._colorsTexture&&(r.colorsTexture=this._colorsTexture.toJSON(t)),null!==this.boundingSphere&&(r.boundingSphere={center:r.boundingSphere.center.toArray(),radius:r.boundingSphere.radius}),null!==this.boundingBox&&(r.boundingBox={min:r.boundingBox.min.toArray(),max:r.boundingBox.max.toArray()})),this.isScene)this.background&&(this.background.isColor?r.background=this.background.toJSON():this.background.isTexture&&(r.background=this.background.toJSON(t).uuid)),this.environment&&this.environment.isTexture&&!0!==this.environment.isRenderTargetTexture&&(r.environment=this.environment.toJSON(t).uuid);else if(this.isMesh||this.isLine||this.isPoints){r.geometry=i(t.geometries,this.geometry);const e=this.geometry.parameters;if(void 0!==e&&void 0!==e.shapes){const n=e.shapes;if(Array.isArray(n))for(let e=0,r=n.length;e<r;e++){const r=n[e];i(t.shapes,r)}else i(t.shapes,n)}}if(this.isSkinnedMesh&&(r.bindMode=this.bindMode,r.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(i(t.skeletons,this.skeleton),r.skeleton=this.skeleton.uuid)),void 0!==this.material)if(Array.isArray(this.material)){const e=[];for(let n=0,r=this.material.length;n<r;n++)e.push(i(t.materials,this.material[n]));r.material=e}else r.material=i(t.materials,this.material);if(this.children.length>0){r.children=[];for(let e=0;e<this.children.length;e++)r.children.push(this.children[e].toJSON(t).object)}if(this.animations.length>0){r.animations=[];for(let e=0;e<this.animations.length;e++){const n=this.animations[e];r.animations.push(i(t.animations,n))}}if(e){const e=s(t.geometries),r=s(t.materials),i=s(t.textures),o=s(t.images),a=s(t.shapes),l=s(t.skeletons),u=s(t.animations),c=s(t.nodes);e.length>0&&(n.geometries=e),r.length>0&&(n.materials=r),i.length>0&&(n.textures=i),o.length>0&&(n.images=o),a.length>0&&(n.shapes=a),l.length>0&&(n.skeletons=l),u.length>0&&(n.animations=u),c.length>0&&(n.nodes=c)}return n.object=r,n;function s(t){const e=[];for(const n in t){const r=t[n];delete r.metadata,e.push(r)}return e}}clone(t){return(new this.constructor).copy(this,t)}copy(t,e=!0){if(this.name=t.name,this.up.copy(t.up),this.position.copy(t.position),this.rotation.order=t.rotation.order,this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.matrix.copy(t.matrix),this.matrixWorld.copy(t.matrixWorld),this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrixWorldAutoUpdate=t.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate,this.layers.mask=t.layers.mask,this.visible=t.visible,this.castShadow=t.castShadow,this.receiveShadow=t.receiveShadow,this.frustumCulled=t.frustumCulled,this.renderOrder=t.renderOrder,this.animations=t.animations.slice(),this.userData=JSON.parse(JSON.stringify(t.userData)),!0===e)for(let e=0;e<t.children.length;e++){const n=t.children[e];this.add(n.clone())}return this}}Tn.DEFAULT_UP=new we(0,1,0),Tn.DEFAULT_MATRIX_AUTO_UPDATE=!0,Tn.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const An=new we,Cn=new we,Rn=new we,Nn=new we,Pn=new we,In=new we,On=new we,Dn=new we,Ln=new we,Un=new we,kn=new ge,Bn=new ge,Fn=new ge;class zn{constructor(t=new we,e=new we,n=new we){this.a=t,this.b=e,this.c=n}static getNormal(t,e,n,r){r.subVectors(n,e),An.subVectors(t,e),r.cross(An);const i=r.lengthSq();return i>0?r.multiplyScalar(1/Math.sqrt(i)):r.set(0,0,0)}static getBarycoord(t,e,n,r,i){An.subVectors(r,e),Cn.subVectors(n,e),Rn.subVectors(t,e);const s=An.dot(An),o=An.dot(Cn),a=An.dot(Rn),l=Cn.dot(Cn),u=Cn.dot(Rn),c=s*l-o*o;if(0===c)return i.set(0,0,0),null;const h=1/c,d=(l*a-o*u)*h,p=(s*u-o*a)*h;return i.set(1-d-p,p,d)}static containsPoint(t,e,n,r){return null!==this.getBarycoord(t,e,n,r,Nn)&&(Nn.x>=0&&Nn.y>=0&&Nn.x+Nn.y<=1)}static getInterpolation(t,e,n,r,i,s,o,a){return null===this.getBarycoord(t,e,n,r,Nn)?(a.x=0,a.y=0,"z"in a&&(a.z=0),"w"in a&&(a.w=0),null):(a.setScalar(0),a.addScaledVector(i,Nn.x),a.addScaledVector(s,Nn.y),a.addScaledVector(o,Nn.z),a)}static getInterpolatedAttribute(t,e,n,r,i,s){return kn.setScalar(0),Bn.setScalar(0),Fn.setScalar(0),kn.fromBufferAttribute(t,e),Bn.fromBufferAttribute(t,n),Fn.fromBufferAttribute(t,r),s.setScalar(0),s.addScaledVector(kn,i.x),s.addScaledVector(Bn,i.y),s.addScaledVector(Fn,i.z),s}static isFrontFacing(t,e,n,r){return An.subVectors(n,e),Cn.subVectors(t,e),An.cross(Cn).dot(r)<0}set(t,e,n){return this.a.copy(t),this.b.copy(e),this.c.copy(n),this}setFromPointsAndIndices(t,e,n,r){return this.a.copy(t[e]),this.b.copy(t[n]),this.c.copy(t[r]),this}setFromAttributeAndIndices(t,e,n,r){return this.a.fromBufferAttribute(t,e),this.b.fromBufferAttribute(t,n),this.c.fromBufferAttribute(t,r),this}clone(){return(new this.constructor).copy(this)}copy(t){return this.a.copy(t.a),this.b.copy(t.b),this.c.copy(t.c),this}getArea(){return An.subVectors(this.c,this.b),Cn.subVectors(this.a,this.b),.5*An.cross(Cn).length()}getMidpoint(t){return t.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(t){return zn.getNormal(this.a,this.b,this.c,t)}getPlane(t){return t.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(t,e){return zn.getBarycoord(t,this.a,this.b,this.c,e)}getInterpolation(t,e,n,r,i){return zn.getInterpolation(t,this.a,this.b,this.c,e,n,r,i)}containsPoint(t){return zn.containsPoint(t,this.a,this.b,this.c)}isFrontFacing(t){return zn.isFrontFacing(this.a,this.b,this.c,t)}intersectsBox(t){return t.intersectsTriangle(this)}closestPointToPoint(t,e){const n=this.a,r=this.b,i=this.c;let s,o;Pn.subVectors(r,n),In.subVectors(i,n),Dn.subVectors(t,n);const a=Pn.dot(Dn),l=In.dot(Dn);if(a<=0&&l<=0)return e.copy(n);Ln.subVectors(t,r);const u=Pn.dot(Ln),c=In.dot(Ln);if(u>=0&&c<=u)return e.copy(r);const h=a*c-u*l;if(h<=0&&a>=0&&u<=0)return s=a/(a-u),e.copy(n).addScaledVector(Pn,s);Un.subVectors(t,i);const d=Pn.dot(Un),p=In.dot(Un);if(p>=0&&d<=p)return e.copy(i);const f=d*l-a*p;if(f<=0&&l>=0&&p<=0)return o=l/(l-p),e.copy(n).addScaledVector(In,o);const m=u*p-d*c;if(m<=0&&c-u>=0&&d-p>=0)return On.subVectors(i,r),o=(c-u)/(c-u+(d-p)),e.copy(r).addScaledVector(On,o);const g=1/(m+f+h);return s=f*g,o=h*g,e.copy(n).addScaledVector(Pn,s).addScaledVector(In,o)}equals(t){return t.a.equals(this.a)&&t.b.equals(this.b)&&t.c.equals(this.c)}}const Vn={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Gn={h:0,s:0,l:0},jn={h:0,s:0,l:0};function Hn(t,e,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?t+6*(e-t)*n:n<.5?e:n<2/3?t+6*(e-t)*(2/3-n):t}class Wn{constructor(t,e,n){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(t,e,n)}set(t,e,n){if(void 0===e&&void 0===n){const e=t;e&&e.isColor?this.copy(e):"number"==typeof e?this.setHex(e):"string"==typeof e&&this.setStyle(e)}else this.setRGB(t,e,n);return this}setScalar(t){return this.r=t,this.g=t,this.b=t,this}setHex(t,e=Tt){return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(255&t)/255,ee.toWorkingColorSpace(this,e),this}setRGB(t,e,n,r=ee.workingColorSpace){return this.r=t,this.g=e,this.b=n,ee.toWorkingColorSpace(this,r),this}setHSL(t,e,n,r=ee.workingColorSpace){if(t=Gt(t,1),e=Vt(e,0,1),n=Vt(n,0,1),0===e)this.r=this.g=this.b=n;else{const r=n<=.5?n*(1+e):n+e-n*e,i=2*n-r;this.r=Hn(i,r,t+1/3),this.g=Hn(i,r,t),this.b=Hn(i,r,t-1/3)}return ee.toWorkingColorSpace(this,r),this}setStyle(t,e=Tt){function n(e){void 0!==e&&parseFloat(e)<1&&console.warn("THREE.Color: Alpha component of "+t+" will be ignored.")}let r;if(r=/^(\w+)\(([^\)]*)\)/.exec(t)){let i;const s=r[1],o=r[2];switch(s){case"rgb":case"rgba":if(i=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return n(i[4]),this.setRGB(Math.min(255,parseInt(i[1],10))/255,Math.min(255,parseInt(i[2],10))/255,Math.min(255,parseInt(i[3],10))/255,e);if(i=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return n(i[4]),this.setRGB(Math.min(100,parseInt(i[1],10))/100,Math.min(100,parseInt(i[2],10))/100,Math.min(100,parseInt(i[3],10))/100,e);break;case"hsl":case"hsla":if(i=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return n(i[4]),this.setHSL(parseFloat(i[1])/360,parseFloat(i[2])/100,parseFloat(i[3])/100,e);break;default:console.warn("THREE.Color: Unknown color model "+t)}}else if(r=/^\#([A-Fa-f\d]+)$/.exec(t)){const n=r[1],i=n.length;if(3===i)return this.setRGB(parseInt(n.charAt(0),16)/15,parseInt(n.charAt(1),16)/15,parseInt(n.charAt(2),16)/15,e);if(6===i)return this.setHex(parseInt(n,16),e);console.warn("THREE.Color: Invalid hex color "+t)}else if(t&&t.length>0)return this.setColorName(t,e);return this}setColorName(t,e=Tt){const n=Vn[t.toLowerCase()];return void 0!==n?this.setHex(n,e):console.warn("THREE.Color: Unknown color "+t),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(t){return this.r=t.r,this.g=t.g,this.b=t.b,this}copySRGBToLinear(t){return this.r=ne(t.r),this.g=ne(t.g),this.b=ne(t.b),this}copyLinearToSRGB(t){return this.r=re(t.r),this.g=re(t.g),this.b=re(t.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(t=Tt){return ee.fromWorkingColorSpace(qn.copy(this),t),65536*Math.round(Vt(255*qn.r,0,255))+256*Math.round(Vt(255*qn.g,0,255))+Math.round(Vt(255*qn.b,0,255))}getHexString(t=Tt){return("000000"+this.getHex(t).toString(16)).slice(-6)}getHSL(t,e=ee.workingColorSpace){ee.fromWorkingColorSpace(qn.copy(this),e);const n=qn.r,r=qn.g,i=qn.b,s=Math.max(n,r,i),o=Math.min(n,r,i);let a,l;const u=(o+s)/2;if(o===s)a=0,l=0;else{const t=s-o;switch(l=u<=.5?t/(s+o):t/(2-s-o),s){case n:a=(r-i)/t+(r<i?6:0);break;case r:a=(i-n)/t+2;break;case i:a=(n-r)/t+4}a/=6}return t.h=a,t.s=l,t.l=u,t}getRGB(t,e=ee.workingColorSpace){return ee.fromWorkingColorSpace(qn.copy(this),e),t.r=qn.r,t.g=qn.g,t.b=qn.b,t}getStyle(t=Tt){ee.fromWorkingColorSpace(qn.copy(this),t);const e=qn.r,n=qn.g,r=qn.b;return t!==Tt?`color(${t} ${e.toFixed(3)} ${n.toFixed(3)} ${r.toFixed(3)})`:`rgb(${Math.round(255*e)},${Math.round(255*n)},${Math.round(255*r)})`}offsetHSL(t,e,n){return this.getHSL(Gn),this.setHSL(Gn.h+t,Gn.s+e,Gn.l+n)}add(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this}addColors(t,e){return this.r=t.r+e.r,this.g=t.g+e.g,this.b=t.b+e.b,this}addScalar(t){return this.r+=t,this.g+=t,this.b+=t,this}sub(t){return this.r=Math.max(0,this.r-t.r),this.g=Math.max(0,this.g-t.g),this.b=Math.max(0,this.b-t.b),this}multiply(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this}multiplyScalar(t){return this.r*=t,this.g*=t,this.b*=t,this}lerp(t,e){return this.r+=(t.r-this.r)*e,this.g+=(t.g-this.g)*e,this.b+=(t.b-this.b)*e,this}lerpColors(t,e,n){return this.r=t.r+(e.r-t.r)*n,this.g=t.g+(e.g-t.g)*n,this.b=t.b+(e.b-t.b)*n,this}lerpHSL(t,e){this.getHSL(Gn),t.getHSL(jn);const n=jt(Gn.h,jn.h,e),r=jt(Gn.s,jn.s,e),i=jt(Gn.l,jn.l,e);return this.setHSL(n,r,i),this}setFromVector3(t){return this.r=t.x,this.g=t.y,this.b=t.z,this}applyMatrix3(t){const e=this.r,n=this.g,r=this.b,i=t.elements;return this.r=i[0]*e+i[3]*n+i[6]*r,this.g=i[1]*e+i[4]*n+i[7]*r,this.b=i[2]*e+i[5]*n+i[8]*r,this}equals(t){return t.r===this.r&&t.g===this.g&&t.b===this.b}fromArray(t,e=0){return this.r=t[e],this.g=t[e+1],this.b=t[e+2],this}toArray(t=[],e=0){return t[e]=this.r,t[e+1]=this.g,t[e+2]=this.b,t}fromBufferAttribute(t,e){return this.r=t.getX(e),this.g=t.getY(e),this.b=t.getZ(e),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const qn=new Wn;Wn.NAMES=Vn;let Xn=0;class Zn extends Lt{static get type(){return"Material"}get type(){return this.constructor.type}set type(t){}constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:Xn++}),this.uuid=zt(),this.name="",this.blending=1,this.side=0,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=204,this.blendDst=205,this.blendEquation=u,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new Wn(0,0,0),this.blendAlpha=0,this.depthFunc=3,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=519,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=Nt,this.stencilZFail=Nt,this.stencilZPass=Nt,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(t){this._alphaTest>0!=t>0&&this.version++,this._alphaTest=t}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(t){if(void 0!==t)for(const e in t){const n=t[e];if(void 0===n){console.warn(`THREE.Material: parameter '${e}' has value of undefined.`);continue}const r=this[e];void 0!==r?r&&r.isColor?r.set(n):r&&r.isVector3&&n&&n.isVector3?r.copy(n):this[e]=n:console.warn(`THREE.Material: '${e}' is not a property of THREE.${this.type}.`)}}toJSON(t){const e=void 0===t||"string"==typeof t;e&&(t={textures:{},images:{}});const n={metadata:{version:4.6,type:"Material",generator:"Material.toJSON"}};function r(t){const e=[];for(const n in t){const r=t[n];delete r.metadata,e.push(r)}return e}if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),void 0!==this.roughness&&(n.roughness=this.roughness),void 0!==this.metalness&&(n.metalness=this.metalness),void 0!==this.sheen&&(n.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(n.sheenColor=this.sheenColor.getHex()),void 0!==this.sheenRoughness&&(n.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),void 0!==this.emissiveIntensity&&1!==this.emissiveIntensity&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),void 0!==this.specularIntensity&&(n.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(n.specularColor=this.specularColor.getHex()),void 0!==this.shininess&&(n.shininess=this.shininess),void 0!==this.clearcoat&&(n.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(n.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(n.clearcoatMap=this.clearcoatMap.toJSON(t).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(n.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(t).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(n.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(t).uuid,n.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),void 0!==this.dispersion&&(n.dispersion=this.dispersion),void 0!==this.iridescence&&(n.iridescence=this.iridescence),void 0!==this.iridescenceIOR&&(n.iridescenceIOR=this.iridescenceIOR),void 0!==this.iridescenceThicknessRange&&(n.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(n.iridescenceMap=this.iridescenceMap.toJSON(t).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(n.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(t).uuid),void 0!==this.anisotropy&&(n.anisotropy=this.anisotropy),void 0!==this.anisotropyRotation&&(n.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(n.anisotropyMap=this.anisotropyMap.toJSON(t).uuid),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(t).uuid),this.matcap&&this.matcap.isTexture&&(n.matcap=this.matcap.toJSON(t).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(t).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(t).uuid,n.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(n.aoMap=this.aoMap.toJSON(t).uuid,n.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(t).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(t).uuid,n.normalMapType=this.normalMapType,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(t).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(t).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(t).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(t).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(t).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(n.specularIntensityMap=this.specularIntensityMap.toJSON(t).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(n.specularColorMap=this.specularColorMap.toJSON(t).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(t).uuid,void 0!==this.combine&&(n.combine=this.combine)),void 0!==this.envMapRotation&&(n.envMapRotation=this.envMapRotation.toArray()),void 0!==this.envMapIntensity&&(n.envMapIntensity=this.envMapIntensity),void 0!==this.reflectivity&&(n.reflectivity=this.reflectivity),void 0!==this.refractionRatio&&(n.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(t).uuid),void 0!==this.transmission&&(n.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(n.transmissionMap=this.transmissionMap.toJSON(t).uuid),void 0!==this.thickness&&(n.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(n.thicknessMap=this.thicknessMap.toJSON(t).uuid),void 0!==this.attenuationDistance&&this.attenuationDistance!==1/0&&(n.attenuationDistance=this.attenuationDistance),void 0!==this.attenuationColor&&(n.attenuationColor=this.attenuationColor.getHex()),void 0!==this.size&&(n.size=this.size),null!==this.shadowSide&&(n.shadowSide=this.shadowSide),void 0!==this.sizeAttenuation&&(n.sizeAttenuation=this.sizeAttenuation),1!==this.blending&&(n.blending=this.blending),0!==this.side&&(n.side=this.side),!0===this.vertexColors&&(n.vertexColors=!0),this.opacity<1&&(n.opacity=this.opacity),!0===this.transparent&&(n.transparent=!0),204!==this.blendSrc&&(n.blendSrc=this.blendSrc),205!==this.blendDst&&(n.blendDst=this.blendDst),this.blendEquation!==u&&(n.blendEquation=this.blendEquation),null!==this.blendSrcAlpha&&(n.blendSrcAlpha=this.blendSrcAlpha),null!==this.blendDstAlpha&&(n.blendDstAlpha=this.blendDstAlpha),null!==this.blendEquationAlpha&&(n.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(n.blendColor=this.blendColor.getHex()),0!==this.blendAlpha&&(n.blendAlpha=this.blendAlpha),3!==this.depthFunc&&(n.depthFunc=this.depthFunc),!1===this.depthTest&&(n.depthTest=this.depthTest),!1===this.depthWrite&&(n.depthWrite=this.depthWrite),!1===this.colorWrite&&(n.colorWrite=this.colorWrite),255!==this.stencilWriteMask&&(n.stencilWriteMask=this.stencilWriteMask),519!==this.stencilFunc&&(n.stencilFunc=this.stencilFunc),0!==this.stencilRef&&(n.stencilRef=this.stencilRef),255!==this.stencilFuncMask&&(n.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==Nt&&(n.stencilFail=this.stencilFail),this.stencilZFail!==Nt&&(n.stencilZFail=this.stencilZFail),this.stencilZPass!==Nt&&(n.stencilZPass=this.stencilZPass),!0===this.stencilWrite&&(n.stencilWrite=this.stencilWrite),void 0!==this.rotation&&0!==this.rotation&&(n.rotation=this.rotation),!0===this.polygonOffset&&(n.polygonOffset=!0),0!==this.polygonOffsetFactor&&(n.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(n.polygonOffsetUnits=this.polygonOffsetUnits),void 0!==this.linewidth&&1!==this.linewidth&&(n.linewidth=this.linewidth),void 0!==this.dashSize&&(n.dashSize=this.dashSize),void 0!==this.gapSize&&(n.gapSize=this.gapSize),void 0!==this.scale&&(n.scale=this.scale),!0===this.dithering&&(n.dithering=!0),this.alphaTest>0&&(n.alphaTest=this.alphaTest),!0===this.alphaHash&&(n.alphaHash=!0),!0===this.alphaToCoverage&&(n.alphaToCoverage=!0),!0===this.premultipliedAlpha&&(n.premultipliedAlpha=!0),!0===this.forceSinglePass&&(n.forceSinglePass=!0),!0===this.wireframe&&(n.wireframe=!0),this.wireframeLinewidth>1&&(n.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(n.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(n.wireframeLinejoin=this.wireframeLinejoin),!0===this.flatShading&&(n.flatShading=!0),!1===this.visible&&(n.visible=!1),!1===this.toneMapped&&(n.toneMapped=!1),!1===this.fog&&(n.fog=!1),Object.keys(this.userData).length>0&&(n.userData=this.userData),e){const e=r(t.textures),i=r(t.images);e.length>0&&(n.textures=e),i.length>0&&(n.images=i)}return n}clone(){return(new this.constructor).copy(this)}copy(t){this.name=t.name,this.blending=t.blending,this.side=t.side,this.vertexColors=t.vertexColors,this.opacity=t.opacity,this.transparent=t.transparent,this.blendSrc=t.blendSrc,this.blendDst=t.blendDst,this.blendEquation=t.blendEquation,this.blendSrcAlpha=t.blendSrcAlpha,this.blendDstAlpha=t.blendDstAlpha,this.blendEquationAlpha=t.blendEquationAlpha,this.blendColor.copy(t.blendColor),this.blendAlpha=t.blendAlpha,this.depthFunc=t.depthFunc,this.depthTest=t.depthTest,this.depthWrite=t.depthWrite,this.stencilWriteMask=t.stencilWriteMask,this.stencilFunc=t.stencilFunc,this.stencilRef=t.stencilRef,this.stencilFuncMask=t.stencilFuncMask,this.stencilFail=t.stencilFail,this.stencilZFail=t.stencilZFail,this.stencilZPass=t.stencilZPass,this.stencilWrite=t.stencilWrite;const e=t.clippingPlanes;let n=null;if(null!==e){const t=e.length;n=new Array(t);for(let r=0;r!==t;++r)n[r]=e[r].clone()}return this.clippingPlanes=n,this.clipIntersection=t.clipIntersection,this.clipShadows=t.clipShadows,this.shadowSide=t.shadowSide,this.colorWrite=t.colorWrite,this.precision=t.precision,this.polygonOffset=t.polygonOffset,this.polygonOffsetFactor=t.polygonOffsetFactor,this.polygonOffsetUnits=t.polygonOffsetUnits,this.dithering=t.dithering,this.alphaTest=t.alphaTest,this.alphaHash=t.alphaHash,this.alphaToCoverage=t.alphaToCoverage,this.premultipliedAlpha=t.premultipliedAlpha,this.forceSinglePass=t.forceSinglePass,this.visible=t.visible,this.toneMapped=t.toneMapped,this.userData=JSON.parse(JSON.stringify(t.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(t){!0===t&&this.version++}onBuild(){console.warn("Material: onBuild() has been removed.")}}class $n extends Zn{static get type(){return"MeshBasicMaterial"}constructor(t){super(),this.isMeshBasicMaterial=!0,this.color=new Wn(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new un,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapRotation.copy(t.envMapRotation),this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.fog=t.fog,this}}const Yn=new we,Kn=new Xt;class Jn{constructor(t,e,n=!1){if(Array.isArray(t))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=t,this.itemSize=e,this.count=void 0!==t?t.length/e:0,this.normalized=n,this.usage=Pt,this.updateRanges=[],this.gpuType=R,this.version=0}onUploadCallback(){}set needsUpdate(t){!0===t&&this.version++}setUsage(t){return this.usage=t,this}addUpdateRange(t,e){this.updateRanges.push({start:t,count:e})}clearUpdateRanges(){this.updateRanges.length=0}copy(t){return this.name=t.name,this.array=new t.array.constructor(t.array),this.itemSize=t.itemSize,this.count=t.count,this.normalized=t.normalized,this.usage=t.usage,this.gpuType=t.gpuType,this}copyAt(t,e,n){t*=this.itemSize,n*=e.itemSize;for(let r=0,i=this.itemSize;r<i;r++)this.array[t+r]=e.array[n+r];return this}copyArray(t){return this.array.set(t),this}applyMatrix3(t){if(2===this.itemSize)for(let e=0,n=this.count;e<n;e++)Kn.fromBufferAttribute(this,e),Kn.applyMatrix3(t),this.setXY(e,Kn.x,Kn.y);else if(3===this.itemSize)for(let e=0,n=this.count;e<n;e++)Yn.fromBufferAttribute(this,e),Yn.applyMatrix3(t),this.setXYZ(e,Yn.x,Yn.y,Yn.z);return this}applyMatrix4(t){for(let e=0,n=this.count;e<n;e++)Yn.fromBufferAttribute(this,e),Yn.applyMatrix4(t),this.setXYZ(e,Yn.x,Yn.y,Yn.z);return this}applyNormalMatrix(t){for(let e=0,n=this.count;e<n;e++)Yn.fromBufferAttribute(this,e),Yn.applyNormalMatrix(t),this.setXYZ(e,Yn.x,Yn.y,Yn.z);return this}transformDirection(t){for(let e=0,n=this.count;e<n;e++)Yn.fromBufferAttribute(this,e),Yn.transformDirection(t),this.setXYZ(e,Yn.x,Yn.y,Yn.z);return this}set(t,e=0){return this.array.set(t,e),this}getComponent(t,e){let n=this.array[t*this.itemSize+e];return this.normalized&&(n=Ht(n,this.array)),n}setComponent(t,e,n){return this.normalized&&(n=Wt(n,this.array)),this.array[t*this.itemSize+e]=n,this}getX(t){let e=this.array[t*this.itemSize];return this.normalized&&(e=Ht(e,this.array)),e}setX(t,e){return this.normalized&&(e=Wt(e,this.array)),this.array[t*this.itemSize]=e,this}getY(t){let e=this.array[t*this.itemSize+1];return this.normalized&&(e=Ht(e,this.array)),e}setY(t,e){return this.normalized&&(e=Wt(e,this.array)),this.array[t*this.itemSize+1]=e,this}getZ(t){let e=this.array[t*this.itemSize+2];return this.normalized&&(e=Ht(e,this.array)),e}setZ(t,e){return this.normalized&&(e=Wt(e,this.array)),this.array[t*this.itemSize+2]=e,this}getW(t){let e=this.array[t*this.itemSize+3];return this.normalized&&(e=Ht(e,this.array)),e}setW(t,e){return this.normalized&&(e=Wt(e,this.array)),this.array[t*this.itemSize+3]=e,this}setXY(t,e,n){return t*=this.itemSize,this.normalized&&(e=Wt(e,this.array),n=Wt(n,this.array)),this.array[t+0]=e,this.array[t+1]=n,this}setXYZ(t,e,n,r){return t*=this.itemSize,this.normalized&&(e=Wt(e,this.array),n=Wt(n,this.array),r=Wt(r,this.array)),this.array[t+0]=e,this.array[t+1]=n,this.array[t+2]=r,this}setXYZW(t,e,n,r,i){return t*=this.itemSize,this.normalized&&(e=Wt(e,this.array),n=Wt(n,this.array),r=Wt(r,this.array),i=Wt(i,this.array)),this.array[t+0]=e,this.array[t+1]=n,this.array[t+2]=r,this.array[t+3]=i,this}onUpload(t){return this.onUploadCallback=t,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const t={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return""!==this.name&&(t.name=this.name),this.usage!==Pt&&(t.usage=this.usage),t}}class Qn extends Jn{constructor(t,e,n){super(new Uint16Array(t),e,n)}}class tr extends Jn{constructor(t,e,n){super(new Uint32Array(t),e,n)}}class er extends Jn{constructor(t,e,n){super(new Float32Array(t),e,n)}}let nr=0;const rr=new Je,ir=new Tn,sr=new we,or=new Ee,ar=new Ee,lr=new we;class ur extends Lt{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:nr++}),this.uuid=zt(),this.name="",this.type="BufferGeometry",this.index=null,this.indirect=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(t){return Array.isArray(t)?this.index=new(Yt(t)?tr:Qn)(t,1):this.index=t,this}setIndirect(t){return this.indirect=t,this}getIndirect(){return this.indirect}getAttribute(t){return this.attributes[t]}setAttribute(t,e){return this.attributes[t]=e,this}deleteAttribute(t){return delete this.attributes[t],this}hasAttribute(t){return void 0!==this.attributes[t]}addGroup(t,e,n=0){this.groups.push({start:t,count:e,materialIndex:n})}clearGroups(){this.groups=[]}setDrawRange(t,e){this.drawRange.start=t,this.drawRange.count=e}applyMatrix4(t){const e=this.attributes.position;void 0!==e&&(e.applyMatrix4(t),e.needsUpdate=!0);const n=this.attributes.normal;if(void 0!==n){const e=(new Zt).getNormalMatrix(t);n.applyNormalMatrix(e),n.needsUpdate=!0}const r=this.attributes.tangent;return void 0!==r&&(r.transformDirection(t),r.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}applyQuaternion(t){return rr.makeRotationFromQuaternion(t),this.applyMatrix4(rr),this}rotateX(t){return rr.makeRotationX(t),this.applyMatrix4(rr),this}rotateY(t){return rr.makeRotationY(t),this.applyMatrix4(rr),this}rotateZ(t){return rr.makeRotationZ(t),this.applyMatrix4(rr),this}translate(t,e,n){return rr.makeTranslation(t,e,n),this.applyMatrix4(rr),this}scale(t,e,n){return rr.makeScale(t,e,n),this.applyMatrix4(rr),this}lookAt(t){return ir.lookAt(t),ir.updateMatrix(),this.applyMatrix4(ir.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(sr).negate(),this.translate(sr.x,sr.y,sr.z),this}setFromPoints(t){const e=this.getAttribute("position");if(void 0===e){const e=[];for(let n=0,r=t.length;n<r;n++){const r=t[n];e.push(r.x,r.y,r.z||0)}this.setAttribute("position",new er(e,3))}else{for(let n=0,r=e.count;n<r;n++){const r=t[n];e.setXYZ(n,r.x,r.y,r.z||0)}t.length>e.count&&console.warn("THREE.BufferGeometry: Buffer size too small for points data. Use .dispose() and create a new geometry."),e.needsUpdate=!0}return this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new Ee);const t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute)return console.error("THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box.",this),void this.boundingBox.set(new we(-1/0,-1/0,-1/0),new we(1/0,1/0,1/0));if(void 0!==t){if(this.boundingBox.setFromBufferAttribute(t),e)for(let t=0,n=e.length;t<n;t++){const n=e[t];or.setFromBufferAttribute(n),this.morphTargetsRelative?(lr.addVectors(this.boundingBox.min,or.min),this.boundingBox.expandByPoint(lr),lr.addVectors(this.boundingBox.max,or.max),this.boundingBox.expandByPoint(lr)):(this.boundingBox.expandByPoint(or.min),this.boundingBox.expandByPoint(or.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new je);const t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute)return console.error("THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere.",this),void this.boundingSphere.set(new we,1/0);if(t){const n=this.boundingSphere.center;if(or.setFromBufferAttribute(t),e)for(let t=0,n=e.length;t<n;t++){const n=e[t];ar.setFromBufferAttribute(n),this.morphTargetsRelative?(lr.addVectors(or.min,ar.min),or.expandByPoint(lr),lr.addVectors(or.max,ar.max),or.expandByPoint(lr)):(or.expandByPoint(ar.min),or.expandByPoint(ar.max))}or.getCenter(n);let r=0;for(let e=0,i=t.count;e<i;e++)lr.fromBufferAttribute(t,e),r=Math.max(r,n.distanceToSquared(lr));if(e)for(let i=0,s=e.length;i<s;i++){const s=e[i],o=this.morphTargetsRelative;for(let e=0,i=s.count;e<i;e++)lr.fromBufferAttribute(s,e),o&&(sr.fromBufferAttribute(t,e),lr.add(sr)),r=Math.max(r,n.distanceToSquared(lr))}this.boundingSphere.radius=Math.sqrt(r),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const t=this.index,e=this.attributes;if(null===t||void 0===e.position||void 0===e.normal||void 0===e.uv)return void console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");const n=e.position,r=e.normal,i=e.uv;!1===this.hasAttribute("tangent")&&this.setAttribute("tangent",new Jn(new Float32Array(4*n.count),4));const s=this.getAttribute("tangent"),o=[],a=[];for(let t=0;t<n.count;t++)o[t]=new we,a[t]=new we;const l=new we,u=new we,c=new we,h=new Xt,d=new Xt,p=new Xt,f=new we,m=new we;function g(t,e,r){l.fromBufferAttribute(n,t),u.fromBufferAttribute(n,e),c.fromBufferAttribute(n,r),h.fromBufferAttribute(i,t),d.fromBufferAttribute(i,e),p.fromBufferAttribute(i,r),u.sub(l),c.sub(l),d.sub(h),p.sub(h);const s=1/(d.x*p.y-p.x*d.y);isFinite(s)&&(f.copy(u).multiplyScalar(p.y).addScaledVector(c,-d.y).multiplyScalar(s),m.copy(c).multiplyScalar(d.x).addScaledVector(u,-p.x).multiplyScalar(s),o[t].add(f),o[e].add(f),o[r].add(f),a[t].add(m),a[e].add(m),a[r].add(m))}let v=this.groups;0===v.length&&(v=[{start:0,count:t.count}]);for(let e=0,n=v.length;e<n;++e){const n=v[e],r=n.start;for(let e=r,i=r+n.count;e<i;e+=3)g(t.getX(e+0),t.getX(e+1),t.getX(e+2))}const y=new we,_=new we,x=new we,b=new we;function w(t){x.fromBufferAttribute(r,t),b.copy(x);const e=o[t];y.copy(e),y.sub(x.multiplyScalar(x.dot(e))).normalize(),_.crossVectors(b,e);const n=_.dot(a[t])<0?-1:1;s.setXYZW(t,y.x,y.y,y.z,n)}for(let e=0,n=v.length;e<n;++e){const n=v[e],r=n.start;for(let e=r,i=r+n.count;e<i;e+=3)w(t.getX(e+0)),w(t.getX(e+1)),w(t.getX(e+2))}}computeVertexNormals(){const t=this.index,e=this.getAttribute("position");if(void 0!==e){let n=this.getAttribute("normal");if(void 0===n)n=new Jn(new Float32Array(3*e.count),3),this.setAttribute("normal",n);else for(let t=0,e=n.count;t<e;t++)n.setXYZ(t,0,0,0);const r=new we,i=new we,s=new we,o=new we,a=new we,l=new we,u=new we,c=new we;if(t)for(let h=0,d=t.count;h<d;h+=3){const d=t.getX(h+0),p=t.getX(h+1),f=t.getX(h+2);r.fromBufferAttribute(e,d),i.fromBufferAttribute(e,p),s.fromBufferAttribute(e,f),u.subVectors(s,i),c.subVectors(r,i),u.cross(c),o.fromBufferAttribute(n,d),a.fromBufferAttribute(n,p),l.fromBufferAttribute(n,f),o.add(u),a.add(u),l.add(u),n.setXYZ(d,o.x,o.y,o.z),n.setXYZ(p,a.x,a.y,a.z),n.setXYZ(f,l.x,l.y,l.z)}else for(let t=0,o=e.count;t<o;t+=3)r.fromBufferAttribute(e,t+0),i.fromBufferAttribute(e,t+1),s.fromBufferAttribute(e,t+2),u.subVectors(s,i),c.subVectors(r,i),u.cross(c),n.setXYZ(t+0,u.x,u.y,u.z),n.setXYZ(t+1,u.x,u.y,u.z),n.setXYZ(t+2,u.x,u.y,u.z);this.normalizeNormals(),n.needsUpdate=!0}}normalizeNormals(){const t=this.attributes.normal;for(let e=0,n=t.count;e<n;e++)lr.fromBufferAttribute(t,e),lr.normalize(),t.setXYZ(e,lr.x,lr.y,lr.z)}toNonIndexed(){function t(t,e){const n=t.array,r=t.itemSize,i=t.normalized,s=new n.constructor(e.length*r);let o=0,a=0;for(let i=0,l=e.length;i<l;i++){o=t.isInterleavedBufferAttribute?e[i]*t.data.stride+t.offset:e[i]*r;for(let t=0;t<r;t++)s[a++]=n[o++]}return new Jn(s,r,i)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const e=new ur,n=this.index.array,r=this.attributes;for(const i in r){const s=t(r[i],n);e.setAttribute(i,s)}const i=this.morphAttributes;for(const r in i){const s=[],o=i[r];for(let e=0,r=o.length;e<r;e++){const r=t(o[e],n);s.push(r)}e.morphAttributes[r]=s}e.morphTargetsRelative=this.morphTargetsRelative;const s=this.groups;for(let t=0,n=s.length;t<n;t++){const n=s[t];e.addGroup(n.start,n.count,n.materialIndex)}return e}toJSON(){const t={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(t.uuid=this.uuid,t.type=this.type,""!==this.name&&(t.name=this.name),Object.keys(this.userData).length>0&&(t.userData=this.userData),void 0!==this.parameters){const e=this.parameters;for(const n in e)void 0!==e[n]&&(t[n]=e[n]);return t}t.data={attributes:{}};const e=this.index;null!==e&&(t.data.index={type:e.array.constructor.name,array:Array.prototype.slice.call(e.array)});const n=this.attributes;for(const e in n){const r=n[e];t.data.attributes[e]=r.toJSON(t.data)}const r={};let i=!1;for(const e in this.morphAttributes){const n=this.morphAttributes[e],s=[];for(let e=0,r=n.length;e<r;e++){const r=n[e];s.push(r.toJSON(t.data))}s.length>0&&(r[e]=s,i=!0)}i&&(t.data.morphAttributes=r,t.data.morphTargetsRelative=this.morphTargetsRelative);const s=this.groups;s.length>0&&(t.data.groups=JSON.parse(JSON.stringify(s)));const o=this.boundingSphere;return null!==o&&(t.data.boundingSphere={center:o.center.toArray(),radius:o.radius}),t}clone(){return(new this.constructor).copy(this)}copy(t){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const e={};this.name=t.name;const n=t.index;null!==n&&this.setIndex(n.clone(e));const r=t.attributes;for(const t in r){const n=r[t];this.setAttribute(t,n.clone(e))}const i=t.morphAttributes;for(const t in i){const n=[],r=i[t];for(let t=0,i=r.length;t<i;t++)n.push(r[t].clone(e));this.morphAttributes[t]=n}this.morphTargetsRelative=t.morphTargetsRelative;const s=t.groups;for(let t=0,e=s.length;t<e;t++){const e=s[t];this.addGroup(e.start,e.count,e.materialIndex)}const o=t.boundingBox;null!==o&&(this.boundingBox=o.clone());const a=t.boundingSphere;return null!==a&&(this.boundingSphere=a.clone()),this.drawRange.start=t.drawRange.start,this.drawRange.count=t.drawRange.count,this.userData=t.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const cr=new Je,hr=new Ke,dr=new je,pr=new we,fr=new we,mr=new we,gr=new we,vr=new we,yr=new we,_r=new we,xr=new we;class br extends Tn{constructor(t=new ur,e=new $n){super(),this.isMesh=!0,this.type="Mesh",this.geometry=t,this.material=e,this.updateMorphTargets()}copy(t,e){return super.copy(t,e),void 0!==t.morphTargetInfluences&&(this.morphTargetInfluences=t.morphTargetInfluences.slice()),void 0!==t.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},t.morphTargetDictionary)),this.material=Array.isArray(t.material)?t.material.slice():t.material,this.geometry=t.geometry,this}updateMorphTargets(){const t=this.geometry.morphAttributes,e=Object.keys(t);if(e.length>0){const n=t[e[0]];if(void 0!==n){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let t=0,e=n.length;t<e;t++){const e=n[t].name||String(t);this.morphTargetInfluences.push(0),this.morphTargetDictionary[e]=t}}}}getVertexPosition(t,e){const n=this.geometry,r=n.attributes.position,i=n.morphAttributes.position,s=n.morphTargetsRelative;e.fromBufferAttribute(r,t);const o=this.morphTargetInfluences;if(i&&o){yr.set(0,0,0);for(let n=0,r=i.length;n<r;n++){const r=o[n],a=i[n];0!==r&&(vr.fromBufferAttribute(a,t),s?yr.addScaledVector(vr,r):yr.addScaledVector(vr.sub(e),r))}e.add(yr)}return e}raycast(t,e){const n=this.geometry,r=this.material,i=this.matrixWorld;if(void 0!==r){if(null===n.boundingSphere&&n.computeBoundingSphere(),dr.copy(n.boundingSphere),dr.applyMatrix4(i),hr.copy(t.ray).recast(t.near),!1===dr.containsPoint(hr.origin)){if(null===hr.intersectSphere(dr,pr))return;if(hr.origin.distanceToSquared(pr)>(t.far-t.near)**2)return}cr.copy(i).invert(),hr.copy(t.ray).applyMatrix4(cr),null!==n.boundingBox&&!1===hr.intersectsBox(n.boundingBox)||this._computeIntersections(t,e,hr)}}_computeIntersections(t,e,n){let r;const i=this.geometry,s=this.material,o=i.index,a=i.attributes.position,l=i.attributes.uv,u=i.attributes.uv1,c=i.attributes.normal,h=i.groups,d=i.drawRange;if(null!==o)if(Array.isArray(s))for(let i=0,a=h.length;i<a;i++){const a=h[i],p=s[a.materialIndex];for(let i=Math.max(a.start,d.start),s=Math.min(o.count,Math.min(a.start+a.count,d.start+d.count));i<s;i+=3){r=wr(this,p,t,n,l,u,c,o.getX(i),o.getX(i+1),o.getX(i+2)),r&&(r.faceIndex=Math.floor(i/3),r.face.materialIndex=a.materialIndex,e.push(r))}}else{for(let i=Math.max(0,d.start),a=Math.min(o.count,d.start+d.count);i<a;i+=3){r=wr(this,s,t,n,l,u,c,o.getX(i),o.getX(i+1),o.getX(i+2)),r&&(r.faceIndex=Math.floor(i/3),e.push(r))}}else if(void 0!==a)if(Array.isArray(s))for(let i=0,o=h.length;i<o;i++){const o=h[i],p=s[o.materialIndex];for(let i=Math.max(o.start,d.start),s=Math.min(a.count,Math.min(o.start+o.count,d.start+d.count));i<s;i+=3){r=wr(this,p,t,n,l,u,c,i,i+1,i+2),r&&(r.faceIndex=Math.floor(i/3),r.face.materialIndex=o.materialIndex,e.push(r))}}else{for(let i=Math.max(0,d.start),o=Math.min(a.count,d.start+d.count);i<o;i+=3){r=wr(this,s,t,n,l,u,c,i,i+1,i+2),r&&(r.faceIndex=Math.floor(i/3),e.push(r))}}}}function wr(t,e,n,r,i,s,o,a,l,u){t.getVertexPosition(a,fr),t.getVertexPosition(l,mr),t.getVertexPosition(u,gr);const c=function(t,e,n,r,i,s,o,a){let l;if(l=1===e.side?r.intersectTriangle(o,s,i,!0,a):r.intersectTriangle(i,s,o,0===e.side,a),null===l)return null;xr.copy(a),xr.applyMatrix4(t.matrixWorld);const u=n.ray.origin.distanceTo(xr);return u<n.near||u>n.far?null:{distance:u,point:xr.clone(),object:t}}(t,e,n,r,fr,mr,gr,_r);if(c){const t=new we;zn.getBarycoord(_r,fr,mr,gr,t),i&&(c.uv=zn.getInterpolatedAttribute(i,a,l,u,t,new Xt)),s&&(c.uv1=zn.getInterpolatedAttribute(s,a,l,u,t,new Xt)),o&&(c.normal=zn.getInterpolatedAttribute(o,a,l,u,t,new we),c.normal.dot(r.direction)>0&&c.normal.multiplyScalar(-1));const e={a:a,b:l,c:u,normal:new we,materialIndex:0};zn.getNormal(fr,mr,gr,e.normal),c.face=e,c.barycoord=t}return c}class Sr extends ur{constructor(t=1,e=1,n=1,r=1,i=1,s=1){super(),this.type="BoxGeometry",this.parameters={width:t,height:e,depth:n,widthSegments:r,heightSegments:i,depthSegments:s};const o=this;r=Math.floor(r),i=Math.floor(i),s=Math.floor(s);const a=[],l=[],u=[],c=[];let h=0,d=0;function p(t,e,n,r,i,s,p,f,m,g,v){const y=s/m,_=p/g,x=s/2,b=p/2,w=f/2,S=m+1,M=g+1;let E=0,T=0;const A=new we;for(let s=0;s<M;s++){const o=s*_-b;for(let a=0;a<S;a++){const h=a*y-x;A[t]=h*r,A[e]=o*i,A[n]=w,l.push(A.x,A.y,A.z),A[t]=0,A[e]=0,A[n]=f>0?1:-1,u.push(A.x,A.y,A.z),c.push(a/m),c.push(1-s/g),E+=1}}for(let t=0;t<g;t++)for(let e=0;e<m;e++){const n=h+e+S*t,r=h+e+S*(t+1),i=h+(e+1)+S*(t+1),s=h+(e+1)+S*t;a.push(n,r,s),a.push(r,i,s),T+=6}o.addGroup(d,T,v),d+=T,h+=E}p("z","y","x",-1,-1,n,e,t,s,i,0),p("z","y","x",1,-1,n,e,-t,s,i,1),p("x","z","y",1,1,t,n,e,r,s,2),p("x","z","y",1,-1,t,n,-e,r,s,3),p("x","y","z",1,-1,t,e,n,r,i,4),p("x","y","z",-1,-1,t,e,-n,r,i,5),this.setIndex(a),this.setAttribute("position",new er(l,3)),this.setAttribute("normal",new er(u,3)),this.setAttribute("uv",new er(c,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new Sr(t.width,t.height,t.depth,t.widthSegments,t.heightSegments,t.depthSegments)}}function Mr(t){const e={};for(const n in t){e[n]={};for(const r in t[n]){const i=t[n][r];i&&(i.isColor||i.isMatrix3||i.isMatrix4||i.isVector2||i.isVector3||i.isVector4||i.isTexture||i.isQuaternion)?i.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),e[n][r]=null):e[n][r]=i.clone():Array.isArray(i)?e[n][r]=i.slice():e[n][r]=i}}return e}function Er(t){const e={};for(let n=0;n<t.length;n++){const r=Mr(t[n]);for(const t in r)e[t]=r[t]}return e}function Tr(t){const e=t.getRenderTarget();return null===e?t.outputColorSpace:!0===e.isXRRenderTarget?e.texture.colorSpace:ee.workingColorSpace}const Ar={clone:Mr,merge:Er};class Cr extends Zn{static get type(){return"ShaderMaterial"}constructor(t){super(),this.isShaderMaterial=!0,this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={clipCullDistance:!1,multiDraw:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,void 0!==t&&this.setValues(t)}copy(t){return super.copy(t),this.fragmentShader=t.fragmentShader,this.vertexShader=t.vertexShader,this.uniforms=Mr(t.uniforms),this.uniformsGroups=function(t){const e=[];for(let n=0;n<t.length;n++)e.push(t[n].clone());return e}(t.uniformsGroups),this.defines=Object.assign({},t.defines),this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.fog=t.fog,this.lights=t.lights,this.clipping=t.clipping,this.extensions=Object.assign({},t.extensions),this.glslVersion=t.glslVersion,this}toJSON(t){const e=super.toJSON(t);e.glslVersion=this.glslVersion,e.uniforms={};for(const n in this.uniforms){const r=this.uniforms[n].value;r&&r.isTexture?e.uniforms[n]={type:"t",value:r.toJSON(t).uuid}:r&&r.isColor?e.uniforms[n]={type:"c",value:r.getHex()}:r&&r.isVector2?e.uniforms[n]={type:"v2",value:r.toArray()}:r&&r.isVector3?e.uniforms[n]={type:"v3",value:r.toArray()}:r&&r.isVector4?e.uniforms[n]={type:"v4",value:r.toArray()}:r&&r.isMatrix3?e.uniforms[n]={type:"m3",value:r.toArray()}:r&&r.isMatrix4?e.uniforms[n]={type:"m4",value:r.toArray()}:e.uniforms[n]={value:r}}Object.keys(this.defines).length>0&&(e.defines=this.defines),e.vertexShader=this.vertexShader,e.fragmentShader=this.fragmentShader,e.lights=this.lights,e.clipping=this.clipping;const n={};for(const t in this.extensions)!0===this.extensions[t]&&(n[t]=!0);return Object.keys(n).length>0&&(e.extensions=n),e}}class Rr extends Tn{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new Je,this.projectionMatrix=new Je,this.projectionMatrixInverse=new Je,this.coordinateSystem=Ot}copy(t,e){return super.copy(t,e),this.matrixWorldInverse.copy(t.matrixWorldInverse),this.projectionMatrix.copy(t.projectionMatrix),this.projectionMatrixInverse.copy(t.projectionMatrixInverse),this.coordinateSystem=t.coordinateSystem,this}getWorldDirection(t){return super.getWorldDirection(t).negate()}updateMatrixWorld(t){super.updateMatrixWorld(t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(t,e){super.updateWorldMatrix(t,e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return(new this.constructor).copy(this)}}const Nr=new we,Pr=new Xt,Ir=new Xt;class Or extends Rr{constructor(t=50,e=1,n=.1,r=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=t,this.zoom=1,this.near=n,this.far=r,this.focus=10,this.aspect=e,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(t,e){return super.copy(t,e),this.fov=t.fov,this.zoom=t.zoom,this.near=t.near,this.far=t.far,this.focus=t.focus,this.aspect=t.aspect,this.view=null===t.view?null:Object.assign({},t.view),this.filmGauge=t.filmGauge,this.filmOffset=t.filmOffset,this}setFocalLength(t){const e=.5*this.getFilmHeight()/t;this.fov=2*Ft*Math.atan(e),this.updateProjectionMatrix()}getFocalLength(){const t=Math.tan(.5*Bt*this.fov);return.5*this.getFilmHeight()/t}getEffectiveFOV(){return 2*Ft*Math.atan(Math.tan(.5*Bt*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}getViewBounds(t,e,n){Nr.set(-1,-1,.5).applyMatrix4(this.projectionMatrixInverse),e.set(Nr.x,Nr.y).multiplyScalar(-t/Nr.z),Nr.set(1,1,.5).applyMatrix4(this.projectionMatrixInverse),n.set(Nr.x,Nr.y).multiplyScalar(-t/Nr.z)}getViewSize(t,e){return this.getViewBounds(t,Pr,Ir),e.subVectors(Ir,Pr)}setViewOffset(t,e,n,r,i,s){this.aspect=t/e,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=n,this.view.offsetY=r,this.view.width=i,this.view.height=s,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const t=this.near;let e=t*Math.tan(.5*Bt*this.fov)/this.zoom,n=2*e,r=this.aspect*n,i=-.5*r;const s=this.view;if(null!==this.view&&this.view.enabled){const t=s.fullWidth,o=s.fullHeight;i+=s.offsetX*r/t,e-=s.offsetY*n/o,r*=s.width/t,n*=s.height/o}const o=this.filmOffset;0!==o&&(i+=t*o/this.getFilmWidth()),this.projectionMatrix.makePerspective(i,i+r,e,e-n,t,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(t){const e=super.toJSON(t);return e.object.fov=this.fov,e.object.zoom=this.zoom,e.object.near=this.near,e.object.far=this.far,e.object.focus=this.focus,e.object.aspect=this.aspect,null!==this.view&&(e.object.view=Object.assign({},this.view)),e.object.filmGauge=this.filmGauge,e.object.filmOffset=this.filmOffset,e}}const Dr=-90;class Lr extends Tn{constructor(t,e,n){super(),this.type="CubeCamera",this.renderTarget=n,this.coordinateSystem=null,this.activeMipmapLevel=0;const r=new Or(Dr,1,t,e);r.layers=this.layers,this.add(r);const i=new Or(Dr,1,t,e);i.layers=this.layers,this.add(i);const s=new Or(Dr,1,t,e);s.layers=this.layers,this.add(s);const o=new Or(Dr,1,t,e);o.layers=this.layers,this.add(o);const a=new Or(Dr,1,t,e);a.layers=this.layers,this.add(a);const l=new Or(Dr,1,t,e);l.layers=this.layers,this.add(l)}updateCoordinateSystem(){const t=this.coordinateSystem,e=this.children.concat(),[n,r,i,s,o,a]=e;for(const t of e)this.remove(t);if(t===Ot)n.up.set(0,1,0),n.lookAt(1,0,0),r.up.set(0,1,0),r.lookAt(-1,0,0),i.up.set(0,0,-1),i.lookAt(0,1,0),s.up.set(0,0,1),s.lookAt(0,-1,0),o.up.set(0,1,0),o.lookAt(0,0,1),a.up.set(0,1,0),a.lookAt(0,0,-1);else{if(t!==Dt)throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+t);n.up.set(0,-1,0),n.lookAt(-1,0,0),r.up.set(0,-1,0),r.lookAt(1,0,0),i.up.set(0,0,1),i.lookAt(0,1,0),s.up.set(0,0,-1),s.lookAt(0,-1,0),o.up.set(0,-1,0),o.lookAt(0,0,1),a.up.set(0,-1,0),a.lookAt(0,0,-1)}for(const t of e)this.add(t),t.updateMatrixWorld()}update(t,e){null===this.parent&&this.updateMatrixWorld();const{renderTarget:n,activeMipmapLevel:r}=this;this.coordinateSystem!==t.coordinateSystem&&(this.coordinateSystem=t.coordinateSystem,this.updateCoordinateSystem());const[i,s,o,a,l,u]=this.children,c=t.getRenderTarget(),h=t.getActiveCubeFace(),d=t.getActiveMipmapLevel(),p=t.xr.enabled;t.xr.enabled=!1;const f=n.texture.generateMipmaps;n.texture.generateMipmaps=!1,t.setRenderTarget(n,0,r),t.render(e,i),t.setRenderTarget(n,1,r),t.render(e,s),t.setRenderTarget(n,2,r),t.render(e,o),t.setRenderTarget(n,3,r),t.render(e,a),t.setRenderTarget(n,4,r),t.render(e,l),n.texture.generateMipmaps=f,t.setRenderTarget(n,5,r),t.render(e,u),t.setRenderTarget(c,h,d),t.xr.enabled=p,n.texture.needsPMREMUpdate=!0}}class Ur extends me{constructor(t,e,n,r,i,s,o,a,l,u){super(t=void 0!==t?t:[],e=void 0!==e?e:c,n,r,i,s,o,a,l,u),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(t){this.image=t}}class kr extends ye{constructor(t=1,e={}){super(t,t,e),this.isWebGLCubeRenderTarget=!0;const n={width:t,height:t,depth:1},r=[n,n,n,n,n,n];this.texture=new Ur(r,e.mapping,e.wrapS,e.wrapT,e.magFilter,e.minFilter,e.format,e.type,e.anisotropy,e.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=void 0!==e.generateMipmaps&&e.generateMipmaps,this.texture.minFilter=void 0!==e.minFilter?e.minFilter:x}fromEquirectangularTexture(t,e){this.texture.type=e.type,this.texture.colorSpace=e.colorSpace,this.texture.generateMipmaps=e.generateMipmaps,this.texture.minFilter=e.minFilter,this.texture.magFilter=e.magFilter;const n={uniforms:{tEquirect:{value:null}},vertexShader:"\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\tvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\n\t\t\t\t\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t\t#include <project_vertex>\n\n\t\t\t\t}\n\t\t\t",fragmentShader:"\n\n\t\t\t\tuniform sampler2D tEquirect;\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\t#include <common>\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvec3 direction = normalize( vWorldDirection );\n\n\t\t\t\t\tvec2 sampleUV = equirectUv( direction );\n\n\t\t\t\t\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\n\t\t\t\t}\n\t\t\t"},r=new Sr(5,5,5),i=new Cr({name:"CubemapFromEquirect",uniforms:Mr(n.uniforms),vertexShader:n.vertexShader,fragmentShader:n.fragmentShader,side:1,blending:0});i.uniforms.tEquirect.value=e;const s=new br(r,i),o=e.minFilter;e.minFilter===w&&(e.minFilter=x);return new Lr(1,10,this).update(t,s),e.minFilter=o,s.geometry.dispose(),s.material.dispose(),this}clear(t,e,n,r){const i=t.getRenderTarget();for(let i=0;i<6;i++)t.setRenderTarget(this,i),t.clear(e,n,r);t.setRenderTarget(i)}}const Br=new we,Fr=new we,zr=new Zt;class Vr{constructor(t=new we(1,0,0),e=0){this.isPlane=!0,this.normal=t,this.constant=e}set(t,e){return this.normal.copy(t),this.constant=e,this}setComponents(t,e,n,r){return this.normal.set(t,e,n),this.constant=r,this}setFromNormalAndCoplanarPoint(t,e){return this.normal.copy(t),this.constant=-e.dot(this.normal),this}setFromCoplanarPoints(t,e,n){const r=Br.subVectors(n,e).cross(Fr.subVectors(t,e)).normalize();return this.setFromNormalAndCoplanarPoint(r,t),this}copy(t){return this.normal.copy(t.normal),this.constant=t.constant,this}normalize(){const t=1/this.normal.length();return this.normal.multiplyScalar(t),this.constant*=t,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(t){return this.normal.dot(t)+this.constant}distanceToSphere(t){return this.distanceToPoint(t.center)-t.radius}projectPoint(t,e){return e.copy(t).addScaledVector(this.normal,-this.distanceToPoint(t))}intersectLine(t,e){const n=t.delta(Br),r=this.normal.dot(n);if(0===r)return 0===this.distanceToPoint(t.start)?e.copy(t.start):null;const i=-(t.start.dot(this.normal)+this.constant)/r;return i<0||i>1?null:e.copy(t.start).addScaledVector(n,i)}intersectsLine(t){const e=this.distanceToPoint(t.start),n=this.distanceToPoint(t.end);return e<0&&n>0||n<0&&e>0}intersectsBox(t){return t.intersectsPlane(this)}intersectsSphere(t){return t.intersectsPlane(this)}coplanarPoint(t){return t.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(t,e){const n=e||zr.getNormalMatrix(t),r=this.coplanarPoint(Br).applyMatrix4(t),i=this.normal.applyMatrix3(n).normalize();return this.constant=-r.dot(i),this}translate(t){return this.constant-=t.dot(this.normal),this}equals(t){return t.normal.equals(this.normal)&&t.constant===this.constant}clone(){return(new this.constructor).copy(this)}}const Gr=new je,jr=new we;class Hr{constructor(t=new Vr,e=new Vr,n=new Vr,r=new Vr,i=new Vr,s=new Vr){this.planes=[t,e,n,r,i,s]}set(t,e,n,r,i,s){const o=this.planes;return o[0].copy(t),o[1].copy(e),o[2].copy(n),o[3].copy(r),o[4].copy(i),o[5].copy(s),this}copy(t){const e=this.planes;for(let n=0;n<6;n++)e[n].copy(t.planes[n]);return this}setFromProjectionMatrix(t,e=2e3){const n=this.planes,r=t.elements,i=r[0],s=r[1],o=r[2],a=r[3],l=r[4],u=r[5],c=r[6],h=r[7],d=r[8],p=r[9],f=r[10],m=r[11],g=r[12],v=r[13],y=r[14],_=r[15];if(n[0].setComponents(a-i,h-l,m-d,_-g).normalize(),n[1].setComponents(a+i,h+l,m+d,_+g).normalize(),n[2].setComponents(a+s,h+u,m+p,_+v).normalize(),n[3].setComponents(a-s,h-u,m-p,_-v).normalize(),n[4].setComponents(a-o,h-c,m-f,_-y).normalize(),e===Ot)n[5].setComponents(a+o,h+c,m+f,_+y).normalize();else{if(e!==Dt)throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+e);n[5].setComponents(o,c,f,y).normalize()}return this}intersectsObject(t){if(void 0!==t.boundingSphere)null===t.boundingSphere&&t.computeBoundingSphere(),Gr.copy(t.boundingSphere).applyMatrix4(t.matrixWorld);else{const e=t.geometry;null===e.boundingSphere&&e.computeBoundingSphere(),Gr.copy(e.boundingSphere).applyMatrix4(t.matrixWorld)}return this.intersectsSphere(Gr)}intersectsSprite(t){return Gr.center.set(0,0,0),Gr.radius=.7071067811865476,Gr.applyMatrix4(t.matrixWorld),this.intersectsSphere(Gr)}intersectsSphere(t){const e=this.planes,n=t.center,r=-t.radius;for(let t=0;t<6;t++){if(e[t].distanceToPoint(n)<r)return!1}return!0}intersectsBox(t){const e=this.planes;for(let n=0;n<6;n++){const r=e[n];if(jr.x=r.normal.x>0?t.max.x:t.min.x,jr.y=r.normal.y>0?t.max.y:t.min.y,jr.z=r.normal.z>0?t.max.z:t.min.z,r.distanceToPoint(jr)<0)return!1}return!0}containsPoint(t){const e=this.planes;for(let n=0;n<6;n++)if(e[n].distanceToPoint(t)<0)return!1;return!0}clone(){return(new this.constructor).copy(this)}}function Wr(){let t=null,e=!1,n=null,r=null;function i(e,s){n(e,s),r=t.requestAnimationFrame(i)}return{start:function(){!0!==e&&null!==n&&(r=t.requestAnimationFrame(i),e=!0)},stop:function(){t.cancelAnimationFrame(r),e=!1},setAnimationLoop:function(t){n=t},setContext:function(e){t=e}}}function qr(t){const e=new WeakMap;return{get:function(t){return t.isInterleavedBufferAttribute&&(t=t.data),e.get(t)},remove:function(n){n.isInterleavedBufferAttribute&&(n=n.data);const r=e.get(n);r&&(t.deleteBuffer(r.buffer),e.delete(n))},update:function(n,r){if(n.isInterleavedBufferAttribute&&(n=n.data),n.isGLBufferAttribute){const t=e.get(n);return void((!t||t.version<n.version)&&e.set(n,{buffer:n.buffer,type:n.type,bytesPerElement:n.elementSize,version:n.version}))}const i=e.get(n);if(void 0===i)e.set(n,function(e,n){const r=e.array,i=e.usage,s=r.byteLength,o=t.createBuffer();let a;if(t.bindBuffer(n,o),t.bufferData(n,r,i),e.onUploadCallback(),r instanceof Float32Array)a=t.FLOAT;else if(r instanceof Uint16Array)a=e.isFloat16BufferAttribute?t.HALF_FLOAT:t.UNSIGNED_SHORT;else if(r instanceof Int16Array)a=t.SHORT;else if(r instanceof Uint32Array)a=t.UNSIGNED_INT;else if(r instanceof Int32Array)a=t.INT;else if(r instanceof Int8Array)a=t.BYTE;else if(r instanceof Uint8Array)a=t.UNSIGNED_BYTE;else{if(!(r instanceof Uint8ClampedArray))throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+r);a=t.UNSIGNED_BYTE}return{buffer:o,type:a,bytesPerElement:r.BYTES_PER_ELEMENT,version:e.version,size:s}}(n,r));else if(i.version<n.version){if(i.size!==n.array.byteLength)throw new Error("THREE.WebGLAttributes: The size of the buffer attribute's array buffer does not match the original size. Resizing buffer attributes is not supported.");!function(e,n,r){const i=n.array,s=n.updateRanges;if(t.bindBuffer(r,e),0===s.length)t.bufferSubData(r,0,i);else{s.sort(((t,e)=>t.start-e.start));let e=0;for(let t=1;t<s.length;t++){const n=s[e],r=s[t];r.start<=n.start+n.count+1?n.count=Math.max(n.count,r.start+r.count-n.start):(++e,s[e]=r)}s.length=e+1;for(let e=0,n=s.length;e<n;e++){const n=s[e];t.bufferSubData(r,n.start*i.BYTES_PER_ELEMENT,i,n.start,n.count)}n.clearUpdateRanges()}n.onUploadCallback()}(i.buffer,n,r),i.version=n.version}}}}class Xr extends ur{constructor(t=1,e=1,n=1,r=1){super(),this.type="PlaneGeometry",this.parameters={width:t,height:e,widthSegments:n,heightSegments:r};const i=t/2,s=e/2,o=Math.floor(n),a=Math.floor(r),l=o+1,u=a+1,c=t/o,h=e/a,d=[],p=[],f=[],m=[];for(let t=0;t<u;t++){const e=t*h-s;for(let n=0;n<l;n++){const r=n*c-i;p.push(r,-e,0),f.push(0,0,1),m.push(n/o),m.push(1-t/a)}}for(let t=0;t<a;t++)for(let e=0;e<o;e++){const n=e+l*t,r=e+l*(t+1),i=e+1+l*(t+1),s=e+1+l*t;d.push(n,r,s),d.push(r,i,s)}this.setIndex(d),this.setAttribute("position",new er(p,3)),this.setAttribute("normal",new er(f,3)),this.setAttribute("uv",new er(m,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new Xr(t.width,t.height,t.widthSegments,t.heightSegments)}}const Zr={alphahash_fragment:"#ifdef USE_ALPHAHASH\n\tif ( diffuseColor.a < getAlphaHashThreshold( vPosition ) ) discard;\n#endif",alphahash_pars_fragment:"#ifdef USE_ALPHAHASH\n\tconst float ALPHA_HASH_SCALE = 0.05;\n\tfloat hash2D( vec2 value ) {\n\t\treturn fract( 1.0e4 * sin( 17.0 * value.x + 0.1 * value.y ) * ( 0.1 + abs( sin( 13.0 * value.y + value.x ) ) ) );\n\t}\n\tfloat hash3D( vec3 value ) {\n\t\treturn hash2D( vec2( hash2D( value.xy ), value.z ) );\n\t}\n\tfloat getAlphaHashThreshold( vec3 position ) {\n\t\tfloat maxDeriv = max(\n\t\t\tlength( dFdx( position.xyz ) ),\n\t\t\tlength( dFdy( position.xyz ) )\n\t\t);\n\t\tfloat pixScale = 1.0 / ( ALPHA_HASH_SCALE * maxDeriv );\n\t\tvec2 pixScales = vec2(\n\t\t\texp2( floor( log2( pixScale ) ) ),\n\t\t\texp2( ceil( log2( pixScale ) ) )\n\t\t);\n\t\tvec2 alpha = vec2(\n\t\t\thash3D( floor( pixScales.x * position.xyz ) ),\n\t\t\thash3D( floor( pixScales.y * position.xyz ) )\n\t\t);\n\t\tfloat lerpFactor = fract( log2( pixScale ) );\n\t\tfloat x = ( 1.0 - lerpFactor ) * alpha.x + lerpFactor * alpha.y;\n\t\tfloat a = min( lerpFactor, 1.0 - lerpFactor );\n\t\tvec3 cases = vec3(\n\t\t\tx * x / ( 2.0 * a * ( 1.0 - a ) ),\n\t\t\t( x - 0.5 * a ) / ( 1.0 - a ),\n\t\t\t1.0 - ( ( 1.0 - x ) * ( 1.0 - x ) / ( 2.0 * a * ( 1.0 - a ) ) )\n\t\t);\n\t\tfloat threshold = ( x < ( 1.0 - a ) )\n\t\t\t? ( ( x < a ) ? cases.x : cases.y )\n\t\t\t: cases.z;\n\t\treturn clamp( threshold , 1.0e-6, 1.0 );\n\t}\n#endif",alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;\n#endif",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",alphatest_fragment:"#ifdef USE_ALPHATEST\n\t#ifdef ALPHA_TO_COVERAGE\n\tdiffuseColor.a = smoothstep( alphaTest, alphaTest + fwidth( diffuseColor.a ), diffuseColor.a );\n\tif ( diffuseColor.a == 0.0 ) discard;\n\t#else\n\tif ( diffuseColor.a < alphaTest ) discard;\n\t#endif\n#endif",alphatest_pars_fragment:"#ifdef USE_ALPHATEST\n\tuniform float alphaTest;\n#endif",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_CLEARCOAT ) \n\t\tclearcoatSpecularIndirect *= ambientOcclusion;\n\t#endif\n\t#if defined( USE_SHEEN ) \n\t\tsheenSpecularIndirect *= ambientOcclusion;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\t\tfloat dotNV = saturate( dot( geometryNormal, geometryViewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );\n\t#endif\n#endif",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",batching_pars_vertex:"#ifdef USE_BATCHING\n\t#if ! defined( GL_ANGLE_multi_draw )\n\t#define gl_DrawID _gl_DrawID\n\tuniform int _gl_DrawID;\n\t#endif\n\tuniform highp sampler2D batchingTexture;\n\tuniform highp usampler2D batchingIdTexture;\n\tmat4 getBatchingMatrix( const in float i ) {\n\t\tint size = textureSize( batchingTexture, 0 ).x;\n\t\tint j = int( i ) * 4;\n\t\tint x = j % size;\n\t\tint y = j / size;\n\t\tvec4 v1 = texelFetch( batchingTexture, ivec2( x, y ), 0 );\n\t\tvec4 v2 = texelFetch( batchingTexture, ivec2( x + 1, y ), 0 );\n\t\tvec4 v3 = texelFetch( batchingTexture, ivec2( x + 2, y ), 0 );\n\t\tvec4 v4 = texelFetch( batchingTexture, ivec2( x + 3, y ), 0 );\n\t\treturn mat4( v1, v2, v3, v4 );\n\t}\n\tfloat getIndirectIndex( const in int i ) {\n\t\tint size = textureSize( batchingIdTexture, 0 ).x;\n\t\tint x = i % size;\n\t\tint y = i / size;\n\t\treturn float( texelFetch( batchingIdTexture, ivec2( x, y ), 0 ).r );\n\t}\n#endif\n#ifdef USE_BATCHING_COLOR\n\tuniform sampler2D batchingColorTexture;\n\tvec3 getBatchingColor( const in float i ) {\n\t\tint size = textureSize( batchingColorTexture, 0 ).x;\n\t\tint j = int( i );\n\t\tint x = j % size;\n\t\tint y = j / size;\n\t\treturn texelFetch( batchingColorTexture, ivec2( x, y ), 0 ).rgb;\n\t}\n#endif",batching_vertex:"#ifdef USE_BATCHING\n\tmat4 batchingMatrix = getBatchingMatrix( getIndirectIndex( gl_DrawID ) );\n#endif",begin_vertex:"vec3 transformed = vec3( position );\n#ifdef USE_ALPHAHASH\n\tvPosition = vec3( position );\n#endif",beginnormal_vertex:"vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif",bsdfs:"float G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, 1.0, dotVH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n} // validated",iridescence_fragment:"#ifdef USE_IRIDESCENCE\n\tconst mat3 XYZ_TO_REC709 = mat3(\n\t\t 3.2404542, -0.9692660,  0.0556434,\n\t\t-1.5371385,  1.8760108, -0.2040259,\n\t\t-0.4985314,  0.0415560,  1.0572252\n\t);\n\tvec3 Fresnel0ToIor( vec3 fresnel0 ) {\n\t\tvec3 sqrtF0 = sqrt( fresnel0 );\n\t\treturn ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );\n\t}\n\tvec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {\n\t\treturn pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );\n\t}\n\tfloat IorToFresnel0( float transmittedIor, float incidentIor ) {\n\t\treturn pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));\n\t}\n\tvec3 evalSensitivity( float OPD, vec3 shift ) {\n\t\tfloat phase = 2.0 * PI * OPD * 1.0e-9;\n\t\tvec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );\n\t\tvec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );\n\t\tvec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );\n\t\tvec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );\n\t\txyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );\n\t\txyz /= 1.0685e-7;\n\t\tvec3 rgb = XYZ_TO_REC709 * xyz;\n\t\treturn rgb;\n\t}\n\tvec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {\n\t\tvec3 I;\n\t\tfloat iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );\n\t\tfloat sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );\n\t\tfloat cosTheta2Sq = 1.0 - sinTheta2Sq;\n\t\tif ( cosTheta2Sq < 0.0 ) {\n\t\t\treturn vec3( 1.0 );\n\t\t}\n\t\tfloat cosTheta2 = sqrt( cosTheta2Sq );\n\t\tfloat R0 = IorToFresnel0( iridescenceIOR, outsideIOR );\n\t\tfloat R12 = F_Schlick( R0, 1.0, cosTheta1 );\n\t\tfloat T121 = 1.0 - R12;\n\t\tfloat phi12 = 0.0;\n\t\tif ( iridescenceIOR < outsideIOR ) phi12 = PI;\n\t\tfloat phi21 = PI - phi12;\n\t\tvec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );\t\tvec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );\n\t\tvec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );\n\t\tvec3 phi23 = vec3( 0.0 );\n\t\tif ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;\n\t\tif ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;\n\t\tif ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;\n\t\tfloat OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;\n\t\tvec3 phi = vec3( phi21 ) + phi23;\n\t\tvec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );\n\t\tvec3 r123 = sqrt( R123 );\n\t\tvec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );\n\t\tvec3 C0 = R12 + Rs;\n\t\tI = C0;\n\t\tvec3 Cm = Rs - T121;\n\t\tfor ( int m = 1; m <= 2; ++ m ) {\n\t\t\tCm *= r123;\n\t\t\tvec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );\n\t\t\tI += Cm * Sm;\n\t\t}\n\t\treturn max( I, vec3( 0.0 ) );\n\t}\n#endif",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vBumpMapUv );\n\t\tvec2 dSTdy = dFdy( vBumpMapUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {\n\t\tvec3 vSigmaX = normalize( dFdx( surf_pos.xyz ) );\n\t\tvec3 vSigmaY = normalize( dFdy( surf_pos.xyz ) );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 ) * faceDirection;\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#ifdef ALPHA_TO_COVERAGE\n\t\tfloat distanceToPlane, distanceGradient;\n\t\tfloat clipOpacity = 1.0;\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tdistanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;\n\t\t\tdistanceGradient = fwidth( distanceToPlane ) / 2.0;\n\t\t\tclipOpacity *= smoothstep( - distanceGradient, distanceGradient, distanceToPlane );\n\t\t\tif ( clipOpacity == 0.0 ) discard;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\t\tfloat unionClipOpacity = 1.0;\n\t\t\t#pragma unroll_loop_start\n\t\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\t\tplane = clippingPlanes[ i ];\n\t\t\t\tdistanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;\n\t\t\t\tdistanceGradient = fwidth( distanceToPlane ) / 2.0;\n\t\t\t\tunionClipOpacity *= 1.0 - smoothstep( - distanceGradient, distanceGradient, distanceToPlane );\n\t\t\t}\n\t\t\t#pragma unroll_loop_end\n\t\t\tclipOpacity *= 1.0 - unionClipOpacity;\n\t\t#endif\n\t\tdiffuseColor.a *= clipOpacity;\n\t\tif ( diffuseColor.a == 0.0 ) discard;\n\t#else\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tif ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\t\tbool clipped = true;\n\t\t\t#pragma unroll_loop_start\n\t\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\t\tplane = clippingPlanes[ i ];\n\t\t\t\tclipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t\t}\n\t\t\t#pragma unroll_loop_end\n\t\t\tif ( clipped ) discard;\n\t\t#endif\n\t#endif\n#endif",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n#endif",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvClipPosition = - mvPosition.xyz;\n#endif",color_fragment:"#if defined( USE_COLOR_ALPHA )\n\tdiffuseColor *= vColor;\n#elif defined( USE_COLOR )\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR )\n\tvarying vec3 vColor;\n#endif",color_pars_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )\n\tvarying vec3 vColor;\n#endif",color_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvColor = vec4( 1.0 );\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )\n\tvColor = vec3( 1.0 );\n#endif\n#ifdef USE_COLOR\n\tvColor *= color;\n#endif\n#ifdef USE_INSTANCING_COLOR\n\tvColor.xyz *= instanceColor.xyz;\n#endif\n#ifdef USE_BATCHING_COLOR\n\tvec3 batchingColor = getBatchingColor( getIndirectIndex( gl_DrawID ) );\n\tvColor.xyz *= batchingColor.xyz;\n#endif",common:"#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement( a ) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nvec3 pow2( const in vec3 x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }\nfloat average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract( sin( sn ) * c );\n}\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\n#ifdef USE_ALPHAHASH\n\tvarying vec3 vPosition;\n#endif\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nbool isPerspectiveMatrix( mat4 m ) {\n\treturn m[ 2 ][ 3 ] == - 1.0;\n}\nvec2 equirectUv( in vec3 dir ) {\n\tfloat u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\n\tfloat v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\treturn vec2( u, v );\n}\nvec3 BRDF_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n}\nfloat F_Schlick( const in float f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n} // validated",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n\t#define cubeUV_minMipLevel 4.0\n\t#define cubeUV_minTileSize 16.0\n\tfloat getFace( vec3 direction ) {\n\t\tvec3 absDirection = abs( direction );\n\t\tfloat face = - 1.0;\n\t\tif ( absDirection.x > absDirection.z ) {\n\t\t\tif ( absDirection.x > absDirection.y )\n\t\t\t\tface = direction.x > 0.0 ? 0.0 : 3.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t} else {\n\t\t\tif ( absDirection.z > absDirection.y )\n\t\t\t\tface = direction.z > 0.0 ? 2.0 : 5.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t}\n\t\treturn face;\n\t}\n\tvec2 getUV( vec3 direction, float face ) {\n\t\tvec2 uv;\n\t\tif ( face == 0.0 ) {\n\t\t\tuv = vec2( direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 1.0 ) {\n\t\t\tuv = vec2( - direction.x, - direction.z ) / abs( direction.y );\n\t\t} else if ( face == 2.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.y ) / abs( direction.z );\n\t\t} else if ( face == 3.0 ) {\n\t\t\tuv = vec2( - direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 4.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.z ) / abs( direction.y );\n\t\t} else {\n\t\t\tuv = vec2( direction.x, direction.y ) / abs( direction.z );\n\t\t}\n\t\treturn 0.5 * ( uv + 1.0 );\n\t}\n\tvec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {\n\t\tfloat face = getFace( direction );\n\t\tfloat filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );\n\t\tmipInt = max( mipInt, cubeUV_minMipLevel );\n\t\tfloat faceSize = exp2( mipInt );\n\t\thighp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;\n\t\tif ( face > 2.0 ) {\n\t\t\tuv.y += faceSize;\n\t\t\tface -= 3.0;\n\t\t}\n\t\tuv.x += face * faceSize;\n\t\tuv.x += filterInt * 3.0 * cubeUV_minTileSize;\n\t\tuv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );\n\t\tuv.x *= CUBEUV_TEXEL_WIDTH;\n\t\tuv.y *= CUBEUV_TEXEL_HEIGHT;\n\t\t#ifdef texture2DGradEXT\n\t\t\treturn texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;\n\t\t#else\n\t\t\treturn texture2D( envMap, uv ).rgb;\n\t\t#endif\n\t}\n\t#define cubeUV_r0 1.0\n\t#define cubeUV_m0 - 2.0\n\t#define cubeUV_r1 0.8\n\t#define cubeUV_m1 - 1.0\n\t#define cubeUV_r4 0.4\n\t#define cubeUV_m4 2.0\n\t#define cubeUV_r5 0.305\n\t#define cubeUV_m5 3.0\n\t#define cubeUV_r6 0.21\n\t#define cubeUV_m6 4.0\n\tfloat roughnessToMip( float roughness ) {\n\t\tfloat mip = 0.0;\n\t\tif ( roughness >= cubeUV_r1 ) {\n\t\t\tmip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;\n\t\t} else if ( roughness >= cubeUV_r4 ) {\n\t\t\tmip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;\n\t\t} else if ( roughness >= cubeUV_r5 ) {\n\t\t\tmip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;\n\t\t} else if ( roughness >= cubeUV_r6 ) {\n\t\t\tmip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;\n\t\t} else {\n\t\t\tmip = - 2.0 * log2( 1.16 * roughness );\t\t}\n\t\treturn mip;\n\t}\n\tvec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {\n\t\tfloat mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );\n\t\tfloat mipF = fract( mip );\n\t\tfloat mipInt = floor( mip );\n\t\tvec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );\n\t\tif ( mipF == 0.0 ) {\n\t\t\treturn vec4( color0, 1.0 );\n\t\t} else {\n\t\t\tvec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );\n\t\t\treturn vec4( mix( color0, color1, mipF ), 1.0 );\n\t\t}\n\t}\n#endif",defaultnormal_vertex:"vec3 transformedNormal = objectNormal;\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = objectTangent;\n#endif\n#ifdef USE_BATCHING\n\tmat3 bm = mat3( batchingMatrix );\n\ttransformedNormal /= vec3( dot( bm[ 0 ], bm[ 0 ] ), dot( bm[ 1 ], bm[ 1 ] ), dot( bm[ 2 ], bm[ 2 ] ) );\n\ttransformedNormal = bm * transformedNormal;\n\t#ifdef USE_TANGENT\n\t\ttransformedTangent = bm * transformedTangent;\n\t#endif\n#endif\n#ifdef USE_INSTANCING\n\tmat3 im = mat3( instanceMatrix );\n\ttransformedNormal /= vec3( dot( im[ 0 ], im[ 0 ] ), dot( im[ 1 ], im[ 1 ] ), dot( im[ 2 ], im[ 2 ] ) );\n\ttransformedNormal = im * transformedNormal;\n\t#ifdef USE_TANGENT\n\t\ttransformedTangent = im * transformedTangent;\n\t#endif\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\ttransformedTangent = ( modelViewMatrix * vec4( transformedTangent, 0.0 ) ).xyz;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );\n\t#ifdef DECODE_VIDEO_TEXTURE_EMISSIVE\n\t\temissiveColor = sRGBTransferEOTF( emissiveColor );\n\t#endif\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",colorspace_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",colorspace_pars_fragment:"vec4 LinearTransferOETF( in vec4 value ) {\n\treturn value;\n}\nvec4 sRGBTransferEOTF( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );\n}\nvec4 sRGBTransferOETF( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}",envmap_fragment:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvec3 cameraToFrag;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, envMapRotation * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",envmap_common_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\tuniform mat3 envMapRotation;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float reflectivity;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",envmap_physical_pars_fragment:"#ifdef USE_ENVMAP\n\tvec3 getIBLIrradiance( const in vec3 normal ) {\n\t\t#ifdef ENVMAP_TYPE_CUBE_UV\n\t\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, envMapRotation * worldNormal, 1.0 );\n\t\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n\tvec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {\n\t\t#ifdef ENVMAP_TYPE_CUBE_UV\n\t\t\tvec3 reflectVec = reflect( - viewDir, normal );\n\t\t\treflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\t\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, envMapRotation * reflectVec, roughness );\n\t\t\treturn envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n\t#ifdef USE_ANISOTROPY\n\t\tvec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {\n\t\t\t#ifdef ENVMAP_TYPE_CUBE_UV\n\t\t\t\tvec3 bentNormal = cross( bitangent, viewDir );\n\t\t\t\tbentNormal = normalize( cross( bentNormal, bitangent ) );\n\t\t\t\tbentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );\n\t\t\t\treturn getIBLRadiance( viewDir, bentNormal, roughness );\n\t\t\t#else\n\t\t\t\treturn vec3( 0.0 );\n\t\t\t#endif\n\t\t}\n\t#endif\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",fog_vertex:"#ifdef USE_FOG\n\tvFogDepth = - mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n\tvarying float vFogDepth;\n#endif",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, vFogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float vFogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",gradientmap_pars_fragment:"#ifdef USE_GRADIENTMAP\n\tuniform sampler2D gradientMap;\n#endif\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\tfloat dotNL = dot( normal, lightDirection );\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t#ifdef USE_GRADIENTMAP\n\t\treturn vec3( texture2D( gradientMap, coord ).r );\n\t#else\n\t\tvec2 fw = fwidth( coord ) * 0.5;\n\t\treturn mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );\n\t#endif\n}",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_fragment:"LambertMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularStrength = specularStrength;",lights_lambert_pars_fragment:"varying vec3 vViewPosition;\nstruct LambertMaterial {\n\tvec3 diffuseColor;\n\tfloat specularStrength;\n};\nvoid RE_Direct_Lambert( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometryNormal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Lambert\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Lambert",lights_pars_begin:"uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\n#if defined( USE_LIGHT_PROBES )\n\tuniform vec3 lightProbe[ 9 ];\n#endif\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {\n\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\treturn irradiance;\n}\nfloat getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\tif ( cutoffDistance > 0.0 ) {\n\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t}\n\treturn distanceFalloff;\n}\nfloat getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {\n\treturn smoothstep( coneCosine, penumbraCosine, angleCosine );\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalLightInfo( const in DirectionalLight directionalLight, out IncidentLight light ) {\n\t\tlight.color = directionalLight.color;\n\t\tlight.direction = directionalLight.direction;\n\t\tlight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointLightInfo( const in PointLight pointLight, const in vec3 geometryPosition, out IncidentLight light ) {\n\t\tvec3 lVector = pointLight.position - geometryPosition;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tlight.color = pointLight.color;\n\t\tlight.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );\n\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotLightInfo( const in SpotLight spotLight, const in vec3 geometryPosition, out IncidentLight light ) {\n\t\tvec3 lVector = spotLight.position - geometryPosition;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat angleCos = dot( light.direction, spotLight.direction );\n\t\tfloat spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\tif ( spotAttenuation > 0.0 ) {\n\t\t\tfloat lightDistance = length( lVector );\n\t\t\tlight.color = spotLight.color * spotAttenuation;\n\t\t\tlight.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t\t} else {\n\t\t\tlight.color = vec3( 0.0 );\n\t\t\tlight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {\n\t\tfloat dotNL = dot( normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\treturn irradiance;\n\t}\n#endif",lights_toon_fragment:"ToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;",lights_toon_pars_fragment:"varying vec3 vViewPosition;\nstruct ToonMaterial {\n\tvec3 diffuseColor;\n};\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\tvec3 irradiance = getGradientIrradiance( geometryNormal, directLight.direction ) * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment:"varying vec3 vViewPosition;\nstruct BlinnPhongMaterial {\n\tvec3 diffuseColor;\n\tvec3 specularColor;\n\tfloat specularShininess;\n\tfloat specularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometryNormal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometryViewDir, geometryNormal, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nvec3 dxy = max( abs( dFdx( nonPerturbedNormal ) ), abs( dFdy( nonPerturbedNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;\nmaterial.roughness = min( material.roughness, 1.0 );\n#ifdef IOR\n\tmaterial.ior = ior;\n\t#ifdef USE_SPECULAR\n\t\tfloat specularIntensityFactor = specularIntensity;\n\t\tvec3 specularColorFactor = specularColor;\n\t\t#ifdef USE_SPECULAR_COLORMAP\n\t\t\tspecularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;\n\t\t#endif\n\t\t#ifdef USE_SPECULAR_INTENSITYMAP\n\t\t\tspecularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;\n\t\t#endif\n\t\tmaterial.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );\n\t#else\n\t\tfloat specularIntensityFactor = 1.0;\n\t\tvec3 specularColorFactor = vec3( 1.0 );\n\t\tmaterial.specularF90 = 1.0;\n\t#endif\n\tmaterial.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );\n\tmaterial.specularF90 = 1.0;\n#endif\n#ifdef USE_CLEARCOAT\n\tmaterial.clearcoat = clearcoat;\n\tmaterial.clearcoatRoughness = clearcoatRoughness;\n\tmaterial.clearcoatF0 = vec3( 0.04 );\n\tmaterial.clearcoatF90 = 1.0;\n\t#ifdef USE_CLEARCOATMAP\n\t\tmaterial.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;\n\t#endif\n\t#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\t\tmaterial.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;\n\t#endif\n\tmaterial.clearcoat = saturate( material.clearcoat );\tmaterial.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness += geometryRoughness;\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n#endif\n#ifdef USE_DISPERSION\n\tmaterial.dispersion = dispersion;\n#endif\n#ifdef USE_IRIDESCENCE\n\tmaterial.iridescence = iridescence;\n\tmaterial.iridescenceIOR = iridescenceIOR;\n\t#ifdef USE_IRIDESCENCEMAP\n\t\tmaterial.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;\n\t#endif\n\t#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\t\tmaterial.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;\n\t#else\n\t\tmaterial.iridescenceThickness = iridescenceThicknessMaximum;\n\t#endif\n#endif\n#ifdef USE_SHEEN\n\tmaterial.sheenColor = sheenColor;\n\t#ifdef USE_SHEEN_COLORMAP\n\t\tmaterial.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;\n\t#endif\n\tmaterial.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );\n\t#ifdef USE_SHEEN_ROUGHNESSMAP\n\t\tmaterial.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;\n\t#endif\n#endif\n#ifdef USE_ANISOTROPY\n\t#ifdef USE_ANISOTROPYMAP\n\t\tmat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );\n\t\tvec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;\n\t\tvec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;\n\t#else\n\t\tvec2 anisotropyV = anisotropyVector;\n\t#endif\n\tmaterial.anisotropy = length( anisotropyV );\n\tif( material.anisotropy == 0.0 ) {\n\t\tanisotropyV = vec2( 1.0, 0.0 );\n\t} else {\n\t\tanisotropyV /= material.anisotropy;\n\t\tmaterial.anisotropy = saturate( material.anisotropy );\n\t}\n\tmaterial.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );\n\tmaterial.anisotropyT = tbn[ 0 ] * anisotropyV.x + tbn[ 1 ] * anisotropyV.y;\n\tmaterial.anisotropyB = tbn[ 1 ] * anisotropyV.x - tbn[ 0 ] * anisotropyV.y;\n#endif",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3 diffuseColor;\n\tfloat roughness;\n\tvec3 specularColor;\n\tfloat specularF90;\n\tfloat dispersion;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat clearcoat;\n\t\tfloat clearcoatRoughness;\n\t\tvec3 clearcoatF0;\n\t\tfloat clearcoatF90;\n\t#endif\n\t#ifdef USE_IRIDESCENCE\n\t\tfloat iridescence;\n\t\tfloat iridescenceIOR;\n\t\tfloat iridescenceThickness;\n\t\tvec3 iridescenceFresnel;\n\t\tvec3 iridescenceF0;\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tvec3 sheenColor;\n\t\tfloat sheenRoughness;\n\t#endif\n\t#ifdef IOR\n\t\tfloat ior;\n\t#endif\n\t#ifdef USE_TRANSMISSION\n\t\tfloat transmission;\n\t\tfloat transmissionAlpha;\n\t\tfloat thickness;\n\t\tfloat attenuationDistance;\n\t\tvec3 attenuationColor;\n\t#endif\n\t#ifdef USE_ANISOTROPY\n\t\tfloat anisotropy;\n\t\tfloat alphaT;\n\t\tvec3 anisotropyT;\n\t\tvec3 anisotropyB;\n\t#endif\n};\nvec3 clearcoatSpecularDirect = vec3( 0.0 );\nvec3 clearcoatSpecularIndirect = vec3( 0.0 );\nvec3 sheenSpecularDirect = vec3( 0.0 );\nvec3 sheenSpecularIndirect = vec3(0.0 );\nvec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {\n    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );\n    float x2 = x * x;\n    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );\n    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );\n}\nfloat V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\n#ifdef USE_ANISOTROPY\n\tfloat V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {\n\t\tfloat gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );\n\t\tfloat gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );\n\t\tfloat v = 0.5 / ( gv + gl );\n\t\treturn saturate(v);\n\t}\n\tfloat D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {\n\t\tfloat a2 = alphaT * alphaB;\n\t\thighp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );\n\t\thighp float v2 = dot( v, v );\n\t\tfloat w2 = a2 / v2;\n\t\treturn RECIPROCAL_PI * a2 * pow2 ( w2 );\n\t}\n#endif\n#ifdef USE_CLEARCOAT\n\tvec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {\n\t\tvec3 f0 = material.clearcoatF0;\n\t\tfloat f90 = material.clearcoatF90;\n\t\tfloat roughness = material.clearcoatRoughness;\n\t\tfloat alpha = pow2( roughness );\n\t\tvec3 halfDir = normalize( lightDir + viewDir );\n\t\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\t\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\t\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\t\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\t\tvec3 F = F_Schlick( f0, f90, dotVH );\n\t\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\t\tfloat D = D_GGX( alpha, dotNH );\n\t\treturn F * ( V * D );\n\t}\n#endif\nvec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {\n\tvec3 f0 = material.specularColor;\n\tfloat f90 = material.specularF90;\n\tfloat roughness = material.roughness;\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( f0, f90, dotVH );\n\t#ifdef USE_IRIDESCENCE\n\t\tF = mix( F, material.iridescenceFresnel, material.iridescence );\n\t#endif\n\t#ifdef USE_ANISOTROPY\n\t\tfloat dotTL = dot( material.anisotropyT, lightDir );\n\t\tfloat dotTV = dot( material.anisotropyT, viewDir );\n\t\tfloat dotTH = dot( material.anisotropyT, halfDir );\n\t\tfloat dotBL = dot( material.anisotropyB, lightDir );\n\t\tfloat dotBV = dot( material.anisotropyB, viewDir );\n\t\tfloat dotBH = dot( material.anisotropyB, halfDir );\n\t\tfloat V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );\n\t\tfloat D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );\n\t#else\n\t\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\t\tfloat D = D_GGX( alpha, dotNH );\n\t#endif\n\treturn F * ( V * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie( float roughness, float dotNH ) {\n\tfloat alpha = pow2( roughness );\n\tfloat invAlpha = 1.0 / alpha;\n\tfloat cos2h = dotNH * dotNH;\n\tfloat sin2h = max( 1.0 - cos2h, 0.0078125 );\n\treturn ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );\n}\nfloat V_Neubelt( float dotNV, float dotNL ) {\n\treturn saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );\n}\nvec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat D = D_Charlie( sheenRoughness, dotNH );\n\tfloat V = V_Neubelt( dotNV, dotNL );\n\treturn sheenColor * ( D * V );\n}\n#endif\nfloat IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat r2 = roughness * roughness;\n\tfloat a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;\n\tfloat b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;\n\tfloat DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );\n\treturn saturate( DG * RECIPROCAL_PI );\n}\nvec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\tvec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;\n\treturn fab;\n}\nvec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\treturn specularColor * fab.x + specularF90 * fab.y;\n}\n#ifdef USE_IRIDESCENCE\nvoid computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#else\nvoid computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#endif\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\t#ifdef USE_IRIDESCENCE\n\t\tvec3 Fr = mix( specularColor, iridescenceF0, iridescence );\n\t#else\n\t\tvec3 Fr = specularColor;\n\t#endif\n\tvec3 FssEss = Fr * fab.x + specularF90 * fab.y;\n\tfloat Ess = fab.x + fab.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometryNormal;\n\t\tvec3 viewDir = geometryViewDir;\n\t\tvec3 position = geometryPosition;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.roughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometryNormal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNLcc = saturate( dot( geometryClearcoatNormal, directLight.direction ) );\n\t\tvec3 ccIrradiance = dotNLcc * directLight.color;\n\t\tclearcoatSpecularDirect += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometryViewDir, geometryClearcoatNormal, material );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecularDirect += irradiance * BRDF_Sheen( directLight.direction, geometryViewDir, geometryNormal, material.sheenColor, material.sheenRoughness );\n\t#endif\n\treflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometryViewDir, geometryNormal, material );\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatSpecularIndirect += clearcoatRadiance * EnvironmentBRDF( geometryClearcoatNormal, geometryViewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecularIndirect += irradiance * material.sheenColor * IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );\n\t#endif\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\t#ifdef USE_IRIDESCENCE\n\t\tcomputeMultiscatteringIridescence( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );\n\t#else\n\t\tcomputeMultiscattering( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );\n\t#endif\n\tvec3 totalScattering = singleScattering + multiScattering;\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );\n\treflectedLight.indirectSpecular += radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",lights_fragment_begin:"\nvec3 geometryPosition = - vViewPosition;\nvec3 geometryNormal = normal;\nvec3 geometryViewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\nvec3 geometryClearcoatNormal = vec3( 0.0 );\n#ifdef USE_CLEARCOAT\n\tgeometryClearcoatNormal = clearcoatNormal;\n#endif\n#ifdef USE_IRIDESCENCE\n\tfloat dotNVi = saturate( dot( normal, geometryViewDir ) );\n\tif ( material.iridescenceThickness == 0.0 ) {\n\t\tmaterial.iridescence = 0.0;\n\t} else {\n\t\tmaterial.iridescence = saturate( material.iridescence );\n\t}\n\tif ( material.iridescence > 0.0 ) {\n\t\tmaterial.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );\n\t\tmaterial.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );\n\t}\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointLightInfo( pointLight, geometryPosition, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tpointLightShadow = pointLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowIntensity, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\tvec4 spotColor;\n\tvec3 spotLightCoord;\n\tbool inSpotLightMap;\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotLightInfo( spotLight, geometryPosition, directLight );\n\t\t#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )\n\t\t#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX\n\t\t#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\t#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS\n\t\t#else\n\t\t#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )\n\t\t#endif\n\t\t#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )\n\t\t\tspotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;\n\t\t\tinSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );\n\t\t\tspotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );\n\t\t\tdirectLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;\n\t\t#endif\n\t\t#undef SPOT_LIGHT_MAP_INDEX\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tspotLightShadow = spotLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowIntensity, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalLightInfo( directionalLight, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowIntensity, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 iblIrradiance = vec3( 0.0 );\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\t#if defined( USE_LIGHT_PROBES )\n\t\tirradiance += getLightProbeIrradiance( lightProbe, geometryNormal );\n\t#endif\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometryNormal );\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vLightMapUv );\n\t\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tiblIrradiance += getIBLIrradiance( geometryNormal );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\t#ifdef USE_ANISOTROPY\n\t\tradiance += getIBLAnisotropyRadiance( geometryViewDir, geometryNormal, material.roughness, material.anisotropyB, material.anisotropy );\n\t#else\n\t\tradiance += getIBLRadiance( geometryViewDir, geometryNormal, material.roughness );\n\t#endif\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatRadiance += getIBLRadiance( geometryViewDir, geometryClearcoatNormal, material.clearcoatRoughness );\n\t#endif\n#endif",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n#endif",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF )\n\tgl_FragDepth = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#if defined( USE_LOGDEPTHBUF )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\tvFragDepth = 1.0 + gl_Position.w;\n\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n#endif",map_fragment:"#ifdef USE_MAP\n\tvec4 sampledDiffuseColor = texture2D( map, vMapUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\tsampledDiffuseColor = sRGBTransferEOTF( sampledDiffuseColor );\n\t#endif\n\tdiffuseColor *= sampledDiffuseColor;\n#endif",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",map_particle_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\t#if defined( USE_POINTS_UV )\n\t\tvec2 uv = vUv;\n\t#else\n\t\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n\t#endif\n#endif\n#ifdef USE_MAP\n\tdiffuseColor *= texture2D( map, uv );\n#endif\n#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif",map_particle_pars_fragment:"#if defined( USE_POINTS_UV )\n\tvarying vec2 vUv;\n#else\n\t#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\t\tuniform mat3 uvTransform;\n\t#endif\n#endif\n#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphinstance_vertex:"#ifdef USE_INSTANCING_MORPH\n\tfloat morphTargetInfluences[ MORPHTARGETS_COUNT ];\n\tfloat morphTargetBaseInfluence = texelFetch( morphTexture, ivec2( 0, gl_InstanceID ), 0 ).r;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\tmorphTargetInfluences[i] =  texelFetch( morphTexture, ivec2( i + 1, gl_InstanceID ), 0 ).r;\n\t}\n#endif",morphcolor_vertex:"#if defined( USE_MORPHCOLORS )\n\tvColor *= morphTargetBaseInfluence;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t#if defined( USE_COLOR_ALPHA )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];\n\t\t#elif defined( USE_COLOR )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];\n\t\t#endif\n\t}\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal *= morphTargetBaseInfluence;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\tif ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];\n\t}\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\t#ifndef USE_INSTANCING_MORPH\n\t\tuniform float morphTargetBaseInfluence;\n\t\tuniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];\n\t#endif\n\tuniform sampler2DArray morphTargetsTexture;\n\tuniform ivec2 morphTargetsTextureSize;\n\tvec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {\n\t\tint texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;\n\t\tint y = texelIndex / morphTargetsTextureSize.x;\n\t\tint x = texelIndex - y * morphTargetsTextureSize.x;\n\t\tivec3 morphUV = ivec3( x, y, morphTargetIndex );\n\t\treturn texelFetch( morphTargetsTexture, morphUV, 0 );\n\t}\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed *= morphTargetBaseInfluence;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\tif ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];\n\t}\n#endif",normal_fragment_begin:"float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;\n#ifdef FLAT_SHADED\n\tvec3 fdx = dFdx( vViewPosition );\n\tvec3 fdy = dFdy( vViewPosition );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal *= faceDirection;\n\t#endif\n#endif\n#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )\n\t#ifdef USE_TANGENT\n\t\tmat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );\n\t#else\n\t\tmat3 tbn = getTangentFrame( - vViewPosition, normal,\n\t\t#if defined( USE_NORMALMAP )\n\t\t\tvNormalMapUv\n\t\t#elif defined( USE_CLEARCOAT_NORMALMAP )\n\t\t\tvClearcoatNormalMapUv\n\t\t#else\n\t\t\tvUv\n\t\t#endif\n\t\t);\n\t#endif\n\t#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )\n\t\ttbn[0] *= faceDirection;\n\t\ttbn[1] *= faceDirection;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\t#ifdef USE_TANGENT\n\t\tmat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );\n\t#else\n\t\tmat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );\n\t#endif\n\t#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )\n\t\ttbn2[0] *= faceDirection;\n\t\ttbn2[1] *= faceDirection;\n\t#endif\n#endif\nvec3 nonPerturbedNormal = normal;",normal_fragment_maps:"#ifdef USE_NORMALMAP_OBJECTSPACE\n\tnormal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;\n\t#ifdef FLIP_SIDED\n\t\tnormal = - normal;\n\t#endif\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\tnormal = normalize( normalMatrix * normal );\n#elif defined( USE_NORMALMAP_TANGENTSPACE )\n\tvec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\tnormal = normalize( tbn * mapN );\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );\n#endif",normal_pars_fragment:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_pars_vertex:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_vertex:"#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n#endif\n#ifdef USE_NORMALMAP_OBJECTSPACE\n\tuniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )\n\tmat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {\n\t\tvec3 q0 = dFdx( eye_pos.xyz );\n\t\tvec3 q1 = dFdy( eye_pos.xyz );\n\t\tvec2 st0 = dFdx( uv.st );\n\t\tvec2 st1 = dFdy( uv.st );\n\t\tvec3 N = surf_norm;\n\t\tvec3 q1perp = cross( q1, N );\n\t\tvec3 q0perp = cross( N, q0 );\n\t\tvec3 T = q1perp * st0.x + q0perp * st1.x;\n\t\tvec3 B = q1perp * st0.y + q0perp * st1.y;\n\t\tfloat det = max( dot( T, T ), dot( B, B ) );\n\t\tfloat scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );\n\t\treturn mat3( T * scale, B * scale, N );\n\t}\n#endif",clearcoat_normal_fragment_begin:"#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal = nonPerturbedNormal;\n#endif",clearcoat_normal_fragment_maps:"#ifdef USE_CLEARCOAT_NORMALMAP\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\tclearcoatNormal = normalize( tbn2 * clearcoatMapN );\n#endif",clearcoat_pars_fragment:"#ifdef USE_CLEARCOATMAP\n\tuniform sampler2D clearcoatMap;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform sampler2D clearcoatRoughnessMap;\n#endif",iridescence_pars_fragment:"#ifdef USE_IRIDESCENCEMAP\n\tuniform sampler2D iridescenceMap;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tuniform sampler2D iridescenceThicknessMap;\n#endif",opaque_fragment:"#ifdef OPAQUE\ndiffuseColor.a = 1.0;\n#endif\n#ifdef USE_TRANSMISSION\ndiffuseColor.a *= material.transmissionAlpha;\n#endif\ngl_FragColor = vec4( outgoingLight, diffuseColor.a );",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;const float ShiftRight8 = 1. / 256.;\nconst float Inv255 = 1. / 255.;\nconst vec4 PackFactors = vec4( 1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0 );\nconst vec2 UnpackFactors2 = vec2( UnpackDownscale, 1.0 / PackFactors.g );\nconst vec3 UnpackFactors3 = vec3( UnpackDownscale / PackFactors.rg, 1.0 / PackFactors.b );\nconst vec4 UnpackFactors4 = vec4( UnpackDownscale / PackFactors.rgb, 1.0 / PackFactors.a );\nvec4 packDepthToRGBA( const in float v ) {\n\tif( v <= 0.0 )\n\t\treturn vec4( 0., 0., 0., 0. );\n\tif( v >= 1.0 )\n\t\treturn vec4( 1., 1., 1., 1. );\n\tfloat vuf;\n\tfloat af = modf( v * PackFactors.a, vuf );\n\tfloat bf = modf( vuf * ShiftRight8, vuf );\n\tfloat gf = modf( vuf * ShiftRight8, vuf );\n\treturn vec4( vuf * Inv255, gf * PackUpscale, bf * PackUpscale, af );\n}\nvec3 packDepthToRGB( const in float v ) {\n\tif( v <= 0.0 )\n\t\treturn vec3( 0., 0., 0. );\n\tif( v >= 1.0 )\n\t\treturn vec3( 1., 1., 1. );\n\tfloat vuf;\n\tfloat bf = modf( v * PackFactors.b, vuf );\n\tfloat gf = modf( vuf * ShiftRight8, vuf );\n\treturn vec3( vuf * Inv255, gf * PackUpscale, bf );\n}\nvec2 packDepthToRG( const in float v ) {\n\tif( v <= 0.0 )\n\t\treturn vec2( 0., 0. );\n\tif( v >= 1.0 )\n\t\treturn vec2( 1., 1. );\n\tfloat vuf;\n\tfloat gf = modf( v * 256., vuf );\n\treturn vec2( vuf * Inv255, gf );\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors4 );\n}\nfloat unpackRGBToDepth( const in vec3 v ) {\n\treturn dot( v, UnpackFactors3 );\n}\nfloat unpackRGToDepth( const in vec2 v ) {\n\treturn v.r * UnpackFactors2.r + v.g * UnpackFactors2.g;\n}\nvec4 pack2HalfToRGBA( const in vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );\n}\nvec2 unpackRGBATo2Half( const in vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {\n\treturn depth * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * depth - far );\n}",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex:"vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_BATCHING\n\tmvPosition = batchingMatrix * mvPosition;\n#endif\n#ifdef USE_INSTANCING\n\tmvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment:"#ifdef DITHERING\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment:"#ifdef DITHERING\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#if NUM_SPOT_LIGHT_COORDS > 0\n\tvarying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];\n#endif\n#if NUM_SPOT_LIGHT_MAPS > 0\n\tuniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];\n#endif\n#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowIntensity;\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowIntensity;\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowIntensity;\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\t\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\n\t}\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\t\tfloat occlusion = 1.0;\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\t\tfloat hard_shadow = step( compare , distribution.x );\n\t\tif (hard_shadow != 1.0 ) {\n\t\t\tfloat distance = compare - distribution.x ;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance );\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\t\t}\n\t\treturn occlusion;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;\n\t\tbool frustumTest = inFrustum && shadowCoord.z <= 1.0;\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx = texelSize.x;\n\t\t\tfloat dy = texelSize.y;\n\t\t\tvec2 uv = shadowCoord.xy;\n\t\t\tvec2 f = fract( uv * shadowMapSize + 0.5 );\n\t\t\tuv -= f * texelSize;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, uv, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t f.y )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn mix( 1.0, shadow, shadowIntensity );\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tfloat shadow = 1.0;\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\t\n\t\tfloat lightToPositionLength = length( lightToPosition );\n\t\tif ( lightToPositionLength - shadowCameraFar <= 0.0 && lightToPositionLength - shadowCameraNear >= 0.0 ) {\n\t\t\tfloat dp = ( lightToPositionLength - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\t\tdp += shadowBias;\n\t\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\t\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\t\tshadow = (\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t\t) * ( 1.0 / 9.0 );\n\t\t\t#else\n\t\t\t\tshadow = texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t\t#endif\n\t\t}\n\t\treturn mix( 1.0, shadow, shadowIntensity );\n\t}\n#endif",shadowmap_pars_vertex:"#if NUM_SPOT_LIGHT_COORDS > 0\n\tuniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];\n\tvarying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];\n#endif\n#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowIntensity;\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowIntensity;\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowIntensity;\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n#endif",shadowmap_vertex:"#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )\n\tvec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\tvec4 shadowWorldPosition;\n#endif\n#if defined( USE_SHADOWMAP )\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );\n\t\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );\n\t\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if NUM_SPOT_LIGHT_COORDS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition;\n\t\t#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\t\tshadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;\n\t\t#endif\n\t\tvSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n#endif",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tdirectionalLight = directionalLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowIntensity, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tspotLight = spotLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowIntensity, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tpointLight = pointLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowIntensity, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#endif\n\treturn shadow;\n}",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\tuniform highp sampler2D boneTexture;\n\tmat4 getBoneMatrix( const in float i ) {\n\t\tint size = textureSize( boneTexture, 0 ).x;\n\t\tint j = int( i ) * 4;\n\t\tint x = j % size;\n\t\tint y = j / size;\n\t\tvec4 v1 = texelFetch( boneTexture, ivec2( x, y ), 0 );\n\t\tvec4 v2 = texelFetch( boneTexture, ivec2( x + 1, y ), 0 );\n\t\tvec4 v3 = texelFetch( boneTexture, ivec2( x + 2, y ), 0 );\n\t\tvec4 v4 = texelFetch( boneTexture, ivec2( x + 3, y ), 0 );\n\t\treturn mat4( v1, v2, v3, v4 );\n\t}\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment:"#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn saturate( toneMappingExposure * color );\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\nvec3 CineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 RRTAndODTFit( vec3 v ) {\n\tvec3 a = v * ( v + 0.0245786 ) - 0.000090537;\n\tvec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;\n\treturn a / b;\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tconst mat3 ACESInputMat = mat3(\n\t\tvec3( 0.59719, 0.07600, 0.02840 ),\t\tvec3( 0.35458, 0.90834, 0.13383 ),\n\t\tvec3( 0.04823, 0.01566, 0.83777 )\n\t);\n\tconst mat3 ACESOutputMat = mat3(\n\t\tvec3(  1.60475, -0.10208, -0.00327 ),\t\tvec3( -0.53108,  1.10813, -0.07276 ),\n\t\tvec3( -0.07367, -0.00605,  1.07602 )\n\t);\n\tcolor *= toneMappingExposure / 0.6;\n\tcolor = ACESInputMat * color;\n\tcolor = RRTAndODTFit( color );\n\tcolor = ACESOutputMat * color;\n\treturn saturate( color );\n}\nconst mat3 LINEAR_REC2020_TO_LINEAR_SRGB = mat3(\n\tvec3( 1.6605, - 0.1246, - 0.0182 ),\n\tvec3( - 0.5876, 1.1329, - 0.1006 ),\n\tvec3( - 0.0728, - 0.0083, 1.1187 )\n);\nconst mat3 LINEAR_SRGB_TO_LINEAR_REC2020 = mat3(\n\tvec3( 0.6274, 0.0691, 0.0164 ),\n\tvec3( 0.3293, 0.9195, 0.0880 ),\n\tvec3( 0.0433, 0.0113, 0.8956 )\n);\nvec3 agxDefaultContrastApprox( vec3 x ) {\n\tvec3 x2 = x * x;\n\tvec3 x4 = x2 * x2;\n\treturn + 15.5 * x4 * x2\n\t\t- 40.14 * x4 * x\n\t\t+ 31.96 * x4\n\t\t- 6.868 * x2 * x\n\t\t+ 0.4298 * x2\n\t\t+ 0.1191 * x\n\t\t- 0.00232;\n}\nvec3 AgXToneMapping( vec3 color ) {\n\tconst mat3 AgXInsetMatrix = mat3(\n\t\tvec3( 0.856627153315983, 0.137318972929847, 0.11189821299995 ),\n\t\tvec3( 0.0951212405381588, 0.761241990602591, 0.0767994186031903 ),\n\t\tvec3( 0.0482516061458583, 0.101439036467562, 0.811302368396859 )\n\t);\n\tconst mat3 AgXOutsetMatrix = mat3(\n\t\tvec3( 1.1271005818144368, - 0.1413297634984383, - 0.14132976349843826 ),\n\t\tvec3( - 0.11060664309660323, 1.157823702216272, - 0.11060664309660294 ),\n\t\tvec3( - 0.016493938717834573, - 0.016493938717834257, 1.2519364065950405 )\n\t);\n\tconst float AgxMinEv = - 12.47393;\tconst float AgxMaxEv = 4.026069;\n\tcolor *= toneMappingExposure;\n\tcolor = LINEAR_SRGB_TO_LINEAR_REC2020 * color;\n\tcolor = AgXInsetMatrix * color;\n\tcolor = max( color, 1e-10 );\tcolor = log2( color );\n\tcolor = ( color - AgxMinEv ) / ( AgxMaxEv - AgxMinEv );\n\tcolor = clamp( color, 0.0, 1.0 );\n\tcolor = agxDefaultContrastApprox( color );\n\tcolor = AgXOutsetMatrix * color;\n\tcolor = pow( max( vec3( 0.0 ), color ), vec3( 2.2 ) );\n\tcolor = LINEAR_REC2020_TO_LINEAR_SRGB * color;\n\tcolor = clamp( color, 0.0, 1.0 );\n\treturn color;\n}\nvec3 NeutralToneMapping( vec3 color ) {\n\tconst float StartCompression = 0.8 - 0.04;\n\tconst float Desaturation = 0.15;\n\tcolor *= toneMappingExposure;\n\tfloat x = min( color.r, min( color.g, color.b ) );\n\tfloat offset = x < 0.08 ? x - 6.25 * x * x : 0.04;\n\tcolor -= offset;\n\tfloat peak = max( color.r, max( color.g, color.b ) );\n\tif ( peak < StartCompression ) return color;\n\tfloat d = 1. - StartCompression;\n\tfloat newPeak = 1. - d * d / ( peak + d - StartCompression );\n\tcolor *= newPeak / peak;\n\tfloat g = 1. - 1. / ( Desaturation * ( peak - newPeak ) + 1. );\n\treturn mix( color, vec3( newPeak ), g );\n}\nvec3 CustomToneMapping( vec3 color ) { return color; }",transmission_fragment:"#ifdef USE_TRANSMISSION\n\tmaterial.transmission = transmission;\n\tmaterial.transmissionAlpha = 1.0;\n\tmaterial.thickness = thickness;\n\tmaterial.attenuationDistance = attenuationDistance;\n\tmaterial.attenuationColor = attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tmaterial.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tmaterial.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;\n\t#endif\n\tvec3 pos = vWorldPosition;\n\tvec3 v = normalize( cameraPosition - pos );\n\tvec3 n = inverseTransformDirection( normal, viewMatrix );\n\tvec4 transmitted = getIBLVolumeRefraction(\n\t\tn, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,\n\t\tpos, modelMatrix, viewMatrix, projectionMatrix, material.dispersion, material.ior, material.thickness,\n\t\tmaterial.attenuationColor, material.attenuationDistance );\n\tmaterial.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );\n\ttotalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );\n#endif",transmission_pars_fragment:"#ifdef USE_TRANSMISSION\n\tuniform float transmission;\n\tuniform float thickness;\n\tuniform float attenuationDistance;\n\tuniform vec3 attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tuniform sampler2D transmissionMap;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tuniform sampler2D thicknessMap;\n\t#endif\n\tuniform vec2 transmissionSamplerSize;\n\tuniform sampler2D transmissionSamplerMap;\n\tuniform mat4 modelMatrix;\n\tuniform mat4 projectionMatrix;\n\tvarying vec3 vWorldPosition;\n\tfloat w0( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );\n\t}\n\tfloat w1( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );\n\t}\n\tfloat w2( float a ){\n\t\treturn ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );\n\t}\n\tfloat w3( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a * a * a );\n\t}\n\tfloat g0( float a ) {\n\t\treturn w0( a ) + w1( a );\n\t}\n\tfloat g1( float a ) {\n\t\treturn w2( a ) + w3( a );\n\t}\n\tfloat h0( float a ) {\n\t\treturn - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );\n\t}\n\tfloat h1( float a ) {\n\t\treturn 1.0 + w3( a ) / ( w2( a ) + w3( a ) );\n\t}\n\tvec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {\n\t\tuv = uv * texelSize.zw + 0.5;\n\t\tvec2 iuv = floor( uv );\n\t\tvec2 fuv = fract( uv );\n\t\tfloat g0x = g0( fuv.x );\n\t\tfloat g1x = g1( fuv.x );\n\t\tfloat h0x = h0( fuv.x );\n\t\tfloat h1x = h1( fuv.x );\n\t\tfloat h0y = h0( fuv.y );\n\t\tfloat h1y = h1( fuv.y );\n\t\tvec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;\n\t\treturn g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +\n\t\t\tg1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );\n\t}\n\tvec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {\n\t\tvec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );\n\t\tvec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );\n\t\tvec2 fLodSizeInv = 1.0 / fLodSize;\n\t\tvec2 cLodSizeInv = 1.0 / cLodSize;\n\t\tvec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );\n\t\tvec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );\n\t\treturn mix( fSample, cSample, fract( lod ) );\n\t}\n\tvec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {\n\t\tvec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );\n\t\tvec3 modelScale;\n\t\tmodelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );\n\t\tmodelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );\n\t\tmodelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );\n\t\treturn normalize( refractionVector ) * thickness * modelScale;\n\t}\n\tfloat applyIorToRoughness( const in float roughness, const in float ior ) {\n\t\treturn roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );\n\t}\n\tvec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {\n\t\tfloat lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );\n\t\treturn textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );\n\t}\n\tvec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tif ( isinf( attenuationDistance ) ) {\n\t\t\treturn vec3( 1.0 );\n\t\t} else {\n\t\t\tvec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;\n\t\t\tvec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );\t\t\treturn transmittance;\n\t\t}\n\t}\n\tvec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,\n\t\tconst in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,\n\t\tconst in mat4 viewMatrix, const in mat4 projMatrix, const in float dispersion, const in float ior, const in float thickness,\n\t\tconst in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tvec4 transmittedLight;\n\t\tvec3 transmittance;\n\t\t#ifdef USE_DISPERSION\n\t\t\tfloat halfSpread = ( ior - 1.0 ) * 0.025 * dispersion;\n\t\t\tvec3 iors = vec3( ior - halfSpread, ior, ior + halfSpread );\n\t\t\tfor ( int i = 0; i < 3; i ++ ) {\n\t\t\t\tvec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, iors[ i ], modelMatrix );\n\t\t\t\tvec3 refractedRayExit = position + transmissionRay;\n\t\t\n\t\t\t\tvec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );\n\t\t\t\tvec2 refractionCoords = ndcPos.xy / ndcPos.w;\n\t\t\t\trefractionCoords += 1.0;\n\t\t\t\trefractionCoords /= 2.0;\n\t\t\n\t\t\t\tvec4 transmissionSample = getTransmissionSample( refractionCoords, roughness, iors[ i ] );\n\t\t\t\ttransmittedLight[ i ] = transmissionSample[ i ];\n\t\t\t\ttransmittedLight.a += transmissionSample.a;\n\t\t\t\ttransmittance[ i ] = diffuseColor[ i ] * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance )[ i ];\n\t\t\t}\n\t\t\ttransmittedLight.a /= 3.0;\n\t\t\n\t\t#else\n\t\t\n\t\t\tvec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );\n\t\t\tvec3 refractedRayExit = position + transmissionRay;\n\t\t\tvec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );\n\t\t\tvec2 refractionCoords = ndcPos.xy / ndcPos.w;\n\t\t\trefractionCoords += 1.0;\n\t\t\trefractionCoords /= 2.0;\n\t\t\ttransmittedLight = getTransmissionSample( refractionCoords, roughness, ior );\n\t\t\ttransmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );\n\t\t\n\t\t#endif\n\t\tvec3 attenuatedColor = transmittance * transmittedLight.rgb;\n\t\tvec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );\n\t\tfloat transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;\n\t\treturn vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );\n\t}\n#endif",uv_pars_fragment:"#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n\tvarying vec2 vUv;\n#endif\n#ifdef USE_MAP\n\tvarying vec2 vMapUv;\n#endif\n#ifdef USE_ALPHAMAP\n\tvarying vec2 vAlphaMapUv;\n#endif\n#ifdef USE_LIGHTMAP\n\tvarying vec2 vLightMapUv;\n#endif\n#ifdef USE_AOMAP\n\tvarying vec2 vAoMapUv;\n#endif\n#ifdef USE_BUMPMAP\n\tvarying vec2 vBumpMapUv;\n#endif\n#ifdef USE_NORMALMAP\n\tvarying vec2 vNormalMapUv;\n#endif\n#ifdef USE_EMISSIVEMAP\n\tvarying vec2 vEmissiveMapUv;\n#endif\n#ifdef USE_METALNESSMAP\n\tvarying vec2 vMetalnessMapUv;\n#endif\n#ifdef USE_ROUGHNESSMAP\n\tvarying vec2 vRoughnessMapUv;\n#endif\n#ifdef USE_ANISOTROPYMAP\n\tvarying vec2 vAnisotropyMapUv;\n#endif\n#ifdef USE_CLEARCOATMAP\n\tvarying vec2 vClearcoatMapUv;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tvarying vec2 vClearcoatNormalMapUv;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tvarying vec2 vClearcoatRoughnessMapUv;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\tvarying vec2 vIridescenceMapUv;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tvarying vec2 vIridescenceThicknessMapUv;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\tvarying vec2 vSheenColorMapUv;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\tvarying vec2 vSheenRoughnessMapUv;\n#endif\n#ifdef USE_SPECULARMAP\n\tvarying vec2 vSpecularMapUv;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\tvarying vec2 vSpecularColorMapUv;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\tvarying vec2 vSpecularIntensityMapUv;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\tuniform mat3 transmissionMapTransform;\n\tvarying vec2 vTransmissionMapUv;\n#endif\n#ifdef USE_THICKNESSMAP\n\tuniform mat3 thicknessMapTransform;\n\tvarying vec2 vThicknessMapUv;\n#endif",uv_pars_vertex:"#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n\tvarying vec2 vUv;\n#endif\n#ifdef USE_MAP\n\tuniform mat3 mapTransform;\n\tvarying vec2 vMapUv;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform mat3 alphaMapTransform;\n\tvarying vec2 vAlphaMapUv;\n#endif\n#ifdef USE_LIGHTMAP\n\tuniform mat3 lightMapTransform;\n\tvarying vec2 vLightMapUv;\n#endif\n#ifdef USE_AOMAP\n\tuniform mat3 aoMapTransform;\n\tvarying vec2 vAoMapUv;\n#endif\n#ifdef USE_BUMPMAP\n\tuniform mat3 bumpMapTransform;\n\tvarying vec2 vBumpMapUv;\n#endif\n#ifdef USE_NORMALMAP\n\tuniform mat3 normalMapTransform;\n\tvarying vec2 vNormalMapUv;\n#endif\n#ifdef USE_DISPLACEMENTMAP\n\tuniform mat3 displacementMapTransform;\n\tvarying vec2 vDisplacementMapUv;\n#endif\n#ifdef USE_EMISSIVEMAP\n\tuniform mat3 emissiveMapTransform;\n\tvarying vec2 vEmissiveMapUv;\n#endif\n#ifdef USE_METALNESSMAP\n\tuniform mat3 metalnessMapTransform;\n\tvarying vec2 vMetalnessMapUv;\n#endif\n#ifdef USE_ROUGHNESSMAP\n\tuniform mat3 roughnessMapTransform;\n\tvarying vec2 vRoughnessMapUv;\n#endif\n#ifdef USE_ANISOTROPYMAP\n\tuniform mat3 anisotropyMapTransform;\n\tvarying vec2 vAnisotropyMapUv;\n#endif\n#ifdef USE_CLEARCOATMAP\n\tuniform mat3 clearcoatMapTransform;\n\tvarying vec2 vClearcoatMapUv;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform mat3 clearcoatNormalMapTransform;\n\tvarying vec2 vClearcoatNormalMapUv;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform mat3 clearcoatRoughnessMapTransform;\n\tvarying vec2 vClearcoatRoughnessMapUv;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\tuniform mat3 sheenColorMapTransform;\n\tvarying vec2 vSheenColorMapUv;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\tuniform mat3 sheenRoughnessMapTransform;\n\tvarying vec2 vSheenRoughnessMapUv;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\tuniform mat3 iridescenceMapTransform;\n\tvarying vec2 vIridescenceMapUv;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tuniform mat3 iridescenceThicknessMapTransform;\n\tvarying vec2 vIridescenceThicknessMapUv;\n#endif\n#ifdef USE_SPECULARMAP\n\tuniform mat3 specularMapTransform;\n\tvarying vec2 vSpecularMapUv;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\tuniform mat3 specularColorMapTransform;\n\tvarying vec2 vSpecularColorMapUv;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\tuniform mat3 specularIntensityMapTransform;\n\tvarying vec2 vSpecularIntensityMapUv;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\tuniform mat3 transmissionMapTransform;\n\tvarying vec2 vTransmissionMapUv;\n#endif\n#ifdef USE_THICKNESSMAP\n\tuniform mat3 thicknessMapTransform;\n\tvarying vec2 vThicknessMapUv;\n#endif",uv_vertex:"#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n\tvUv = vec3( uv, 1 ).xy;\n#endif\n#ifdef USE_MAP\n\tvMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ALPHAMAP\n\tvAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_LIGHTMAP\n\tvLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_AOMAP\n\tvAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_BUMPMAP\n\tvBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_NORMALMAP\n\tvNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_DISPLACEMENTMAP\n\tvDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_EMISSIVEMAP\n\tvEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_METALNESSMAP\n\tvMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ROUGHNESSMAP\n\tvRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ANISOTROPYMAP\n\tvAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOATMAP\n\tvClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tvClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tvClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\tvIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tvIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\tvSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\tvSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULARMAP\n\tvSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\tvSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\tvSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\tvTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_THICKNESSMAP\n\tvThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\t#ifdef USE_BATCHING\n\t\tworldPosition = batchingMatrix * worldPosition;\n\t#endif\n\t#ifdef USE_INSTANCING\n\t\tworldPosition = instanceMatrix * worldPosition;\n\t#endif\n\tworldPosition = modelMatrix * worldPosition;\n#endif",background_vert:"varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",background_frag:"uniform sampler2D t2D;\nuniform float backgroundIntensity;\nvarying vec2 vUv;\nvoid main() {\n\tvec4 texColor = texture2D( t2D, vUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\ttexColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );\n\t#endif\n\ttexColor.rgb *= backgroundIntensity;\n\tgl_FragColor = texColor;\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",backgroundCube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",backgroundCube_frag:"#ifdef ENVMAP_TYPE_CUBE\n\tuniform samplerCube envMap;\n#elif defined( ENVMAP_TYPE_CUBE_UV )\n\tuniform sampler2D envMap;\n#endif\nuniform float flipEnvMap;\nuniform float backgroundBlurriness;\nuniform float backgroundIntensity;\nuniform mat3 backgroundRotation;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 texColor = textureCube( envMap, backgroundRotation * vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec4 texColor = textureCubeUV( envMap, backgroundRotation * vWorldDirection, backgroundBlurriness );\n\t#else\n\t\tvec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t#endif\n\ttexColor.rgb *= backgroundIntensity;\n\tgl_FragColor = texColor;\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",cube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",cube_frag:"uniform samplerCube tCube;\nuniform float tFlip;\nuniform float opacity;\nvarying vec3 vWorldDirection;\nvoid main() {\n\tvec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );\n\tgl_FragColor = texColor;\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",depth_vert:"#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <uv_vertex>\n\t#include <batching_vertex>\n\t#include <skinbase_vertex>\n\t#include <morphinstance_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvHighPrecisionZW = gl_Position.zw;\n}",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <clipping_planes_fragment>\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <logdepthbuf_fragment>\n\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( fragCoordZ );\n\t#elif DEPTH_PACKING == 3202\n\t\tgl_FragColor = vec4( packDepthToRGB( fragCoordZ ), 1.0 );\n\t#elif DEPTH_PACKING == 3203\n\t\tgl_FragColor = vec4( packDepthToRG( fragCoordZ ), 0.0, 1.0 );\n\t#endif\n}",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <batching_vertex>\n\t#include <skinbase_vertex>\n\t#include <morphinstance_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <clipping_planes_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",equirect_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV = equirectUv( direction );\n\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\tvLineDistance = scale * lineDistance;\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",meshbasic_vert:"#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinbase_vertex>\n\t\t#include <skinnormal_vertex>\n\t\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vLightMapUv );\n\t\treflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshlambert_vert:"#define LAMBERT\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshlambert_frag:"#define LAMBERT\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_lambert_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_lambert_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshmatcap_vert:"#define MATCAP\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",meshmatcap_frag:"#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t#else\n\t\tvec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshnormal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvarying vec3 vViewPosition;\n#endif\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",meshnormal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvarying vec3 vViewPosition;\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( 0.0, 0.0, 0.0, opacity );\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), diffuseColor.a );\n\t#ifdef OPAQUE\n\t\tgl_FragColor.a = 1.0;\n\t#endif\n}",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphysical_vert:"#define STANDARD\nvarying vec3 vViewPosition;\n#ifdef USE_TRANSMISSION\n\tvarying vec3 vWorldPosition;\n#endif\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n#ifdef USE_TRANSMISSION\n\tvWorldPosition = worldPosition.xyz;\n#endif\n}",meshphysical_frag:"#define STANDARD\n#ifdef PHYSICAL\n\t#define IOR\n\t#define USE_SPECULAR\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef IOR\n\tuniform float ior;\n#endif\n#ifdef USE_SPECULAR\n\tuniform float specularIntensity;\n\tuniform vec3 specularColor;\n\t#ifdef USE_SPECULAR_COLORMAP\n\t\tuniform sampler2D specularColorMap;\n\t#endif\n\t#ifdef USE_SPECULAR_INTENSITYMAP\n\t\tuniform sampler2D specularIntensityMap;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_DISPERSION\n\tuniform float dispersion;\n#endif\n#ifdef USE_IRIDESCENCE\n\tuniform float iridescence;\n\tuniform float iridescenceIOR;\n\tuniform float iridescenceThicknessMinimum;\n\tuniform float iridescenceThicknessMaximum;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheenColor;\n\tuniform float sheenRoughness;\n\t#ifdef USE_SHEEN_COLORMAP\n\t\tuniform sampler2D sheenColorMap;\n\t#endif\n\t#ifdef USE_SHEEN_ROUGHNESSMAP\n\t\tuniform sampler2D sheenRoughnessMap;\n\t#endif\n#endif\n#ifdef USE_ANISOTROPY\n\tuniform vec2 anisotropyVector;\n\t#ifdef USE_ANISOTROPYMAP\n\t\tuniform sampler2D anisotropyMap;\n\t#endif\n#endif\nvarying vec3 vViewPosition;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <iridescence_fragment>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_physical_pars_fragment>\n#include <transmission_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <iridescence_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;\n\tvec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;\n\t#include <transmission_fragment>\n\tvec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;\n\t#ifdef USE_SHEEN\n\t\tfloat sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );\n\t\toutgoingLight = outgoingLight * sheenEnergyComp + sheenSpecularDirect + sheenSpecularIndirect;\n\t#endif\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNVcc = saturate( dot( geometryClearcoatNormal, geometryViewDir ) );\n\t\tvec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );\n\t\toutgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + ( clearcoatSpecularDirect + clearcoatSpecularIndirect ) * material.clearcoat;\n\t#endif\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshtoon_vert:"#define TOON\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshtoon_frag:"#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n#ifdef USE_POINTS_UV\n\tvarying vec2 vUv;\n\tuniform mat3 uvTransform;\n#endif\nvoid main() {\n\t#ifdef USE_POINTS_UV\n\t\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\t#endif\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",shadow_vert:"#include <common>\n#include <batching_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <logdepthbuf_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\t#include <logdepthbuf_fragment>\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n}",sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix[ 3 ];\n\tvec2 scale = vec2( length( modelMatrix[ 0 ].xyz ), length( modelMatrix[ 1 ].xyz ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n}"},$r={common:{diffuse:{value:new Wn(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new Zt},alphaMap:{value:null},alphaMapTransform:{value:new Zt},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new Zt}},envmap:{envMap:{value:null},envMapRotation:{value:new Zt},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new Zt}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new Zt}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new Zt},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new Zt},normalScale:{value:new Xt(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new Zt},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new Zt}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new Zt}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new Zt}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Wn(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new Wn(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new Zt},alphaTest:{value:0},uvTransform:{value:new Zt}},sprite:{diffuse:{value:new Wn(16777215)},opacity:{value:1},center:{value:new Xt(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new Zt},alphaMap:{value:null},alphaMapTransform:{value:new Zt},alphaTest:{value:0}}},Yr={basic:{uniforms:Er([$r.common,$r.specularmap,$r.envmap,$r.aomap,$r.lightmap,$r.fog]),vertexShader:Zr.meshbasic_vert,fragmentShader:Zr.meshbasic_frag},lambert:{uniforms:Er([$r.common,$r.specularmap,$r.envmap,$r.aomap,$r.lightmap,$r.emissivemap,$r.bumpmap,$r.normalmap,$r.displacementmap,$r.fog,$r.lights,{emissive:{value:new Wn(0)}}]),vertexShader:Zr.meshlambert_vert,fragmentShader:Zr.meshlambert_frag},phong:{uniforms:Er([$r.common,$r.specularmap,$r.envmap,$r.aomap,$r.lightmap,$r.emissivemap,$r.bumpmap,$r.normalmap,$r.displacementmap,$r.fog,$r.lights,{emissive:{value:new Wn(0)},specular:{value:new Wn(1118481)},shininess:{value:30}}]),vertexShader:Zr.meshphong_vert,fragmentShader:Zr.meshphong_frag},standard:{uniforms:Er([$r.common,$r.envmap,$r.aomap,$r.lightmap,$r.emissivemap,$r.bumpmap,$r.normalmap,$r.displacementmap,$r.roughnessmap,$r.metalnessmap,$r.fog,$r.lights,{emissive:{value:new Wn(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:Zr.meshphysical_vert,fragmentShader:Zr.meshphysical_frag},toon:{uniforms:Er([$r.common,$r.aomap,$r.lightmap,$r.emissivemap,$r.bumpmap,$r.normalmap,$r.displacementmap,$r.gradientmap,$r.fog,$r.lights,{emissive:{value:new Wn(0)}}]),vertexShader:Zr.meshtoon_vert,fragmentShader:Zr.meshtoon_frag},matcap:{uniforms:Er([$r.common,$r.bumpmap,$r.normalmap,$r.displacementmap,$r.fog,{matcap:{value:null}}]),vertexShader:Zr.meshmatcap_vert,fragmentShader:Zr.meshmatcap_frag},points:{uniforms:Er([$r.points,$r.fog]),vertexShader:Zr.points_vert,fragmentShader:Zr.points_frag},dashed:{uniforms:Er([$r.common,$r.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Zr.linedashed_vert,fragmentShader:Zr.linedashed_frag},depth:{uniforms:Er([$r.common,$r.displacementmap]),vertexShader:Zr.depth_vert,fragmentShader:Zr.depth_frag},normal:{uniforms:Er([$r.common,$r.bumpmap,$r.normalmap,$r.displacementmap,{opacity:{value:1}}]),vertexShader:Zr.meshnormal_vert,fragmentShader:Zr.meshnormal_frag},sprite:{uniforms:Er([$r.sprite,$r.fog]),vertexShader:Zr.sprite_vert,fragmentShader:Zr.sprite_frag},background:{uniforms:{uvTransform:{value:new Zt},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:Zr.background_vert,fragmentShader:Zr.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1},backgroundRotation:{value:new Zt}},vertexShader:Zr.backgroundCube_vert,fragmentShader:Zr.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:Zr.cube_vert,fragmentShader:Zr.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:Zr.equirect_vert,fragmentShader:Zr.equirect_frag},distanceRGBA:{uniforms:Er([$r.common,$r.displacementmap,{referencePosition:{value:new we},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:Zr.distanceRGBA_vert,fragmentShader:Zr.distanceRGBA_frag},shadow:{uniforms:Er([$r.lights,$r.fog,{color:{value:new Wn(0)},opacity:{value:1}}]),vertexShader:Zr.shadow_vert,fragmentShader:Zr.shadow_frag}};Yr.physical={uniforms:Er([Yr.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new Zt},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new Zt},clearcoatNormalScale:{value:new Xt(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new Zt},dispersion:{value:0},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new Zt},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new Zt},sheen:{value:0},sheenColor:{value:new Wn(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new Zt},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new Zt},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new Zt},transmissionSamplerSize:{value:new Xt},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new Zt},attenuationDistance:{value:0},attenuationColor:{value:new Wn(0)},specularColor:{value:new Wn(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new Zt},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new Zt},anisotropyVector:{value:new Xt},anisotropyMap:{value:null},anisotropyMapTransform:{value:new Zt}}]),vertexShader:Zr.meshphysical_vert,fragmentShader:Zr.meshphysical_frag};const Kr={r:0,b:0,g:0},Jr=new un,Qr=new Je;function ti(t,e,n,r,i,s,o){const a=new Wn(0);let l,u,c=!0===s?0:1,h=null,d=0,p=null;function m(t){let r=!0===t.isScene?t.background:null;if(r&&r.isTexture){r=(t.backgroundBlurriness>0?n:e).get(r)}return r}function g(e,n){e.getRGB(Kr,Tr(t)),r.buffers.color.setClear(Kr.r,Kr.g,Kr.b,n,o)}return{getClearColor:function(){return a},setClearColor:function(t,e=1){a.set(t),c=e,g(a,c)},getClearAlpha:function(){return c},setClearAlpha:function(t){c=t,g(a,c)},render:function(e){let n=!1;const i=m(e);null===i?g(a,c):i&&i.isColor&&(g(i,1),n=!0);const s=t.xr.getEnvironmentBlendMode();"additive"===s?r.buffers.color.setClear(0,0,0,1,o):"alpha-blend"===s&&r.buffers.color.setClear(0,0,0,0,o),(t.autoClear||n)&&(r.buffers.depth.setTest(!0),r.buffers.depth.setMask(!0),r.buffers.color.setMask(!0),t.clear(t.autoClearColor,t.autoClearDepth,t.autoClearStencil))},addToRenderList:function(e,n){const r=m(n);r&&(r.isCubeTexture||r.mapping===f)?(void 0===u&&(u=new br(new Sr(1,1,1),new Cr({name:"BackgroundCubeMaterial",uniforms:Mr(Yr.backgroundCube.uniforms),vertexShader:Yr.backgroundCube.vertexShader,fragmentShader:Yr.backgroundCube.fragmentShader,side:1,depthTest:!1,depthWrite:!1,fog:!1})),u.geometry.deleteAttribute("normal"),u.geometry.deleteAttribute("uv"),u.onBeforeRender=function(t,e,n){this.matrixWorld.copyPosition(n.matrixWorld)},Object.defineProperty(u.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),i.update(u)),Jr.copy(n.backgroundRotation),Jr.x*=-1,Jr.y*=-1,Jr.z*=-1,r.isCubeTexture&&!1===r.isRenderTargetTexture&&(Jr.y*=-1,Jr.z*=-1),u.material.uniforms.envMap.value=r,u.material.uniforms.flipEnvMap.value=r.isCubeTexture&&!1===r.isRenderTargetTexture?-1:1,u.material.uniforms.backgroundBlurriness.value=n.backgroundBlurriness,u.material.uniforms.backgroundIntensity.value=n.backgroundIntensity,u.material.uniforms.backgroundRotation.value.setFromMatrix4(Qr.makeRotationFromEuler(Jr)),u.material.toneMapped=ee.getTransfer(r.colorSpace)!==Rt,h===r&&d===r.version&&p===t.toneMapping||(u.material.needsUpdate=!0,h=r,d=r.version,p=t.toneMapping),u.layers.enableAll(),e.unshift(u,u.geometry,u.material,0,0,null)):r&&r.isTexture&&(void 0===l&&(l=new br(new Xr(2,2),new Cr({name:"BackgroundMaterial",uniforms:Mr(Yr.background.uniforms),vertexShader:Yr.background.vertexShader,fragmentShader:Yr.background.fragmentShader,side:0,depthTest:!1,depthWrite:!1,fog:!1})),l.geometry.deleteAttribute("normal"),Object.defineProperty(l.material,"map",{get:function(){return this.uniforms.t2D.value}}),i.update(l)),l.material.uniforms.t2D.value=r,l.material.uniforms.backgroundIntensity.value=n.backgroundIntensity,l.material.toneMapped=ee.getTransfer(r.colorSpace)!==Rt,!0===r.matrixAutoUpdate&&r.updateMatrix(),l.material.uniforms.uvTransform.value.copy(r.matrix),h===r&&d===r.version&&p===t.toneMapping||(l.material.needsUpdate=!0,h=r,d=r.version,p=t.toneMapping),l.layers.enableAll(),e.unshift(l,l.geometry,l.material,0,0,null))}}}function ei(t,e){const n=t.getParameter(t.MAX_VERTEX_ATTRIBS),r={},i=u(null);let s=i,o=!1;function a(e){return t.bindVertexArray(e)}function l(e){return t.deleteVertexArray(e)}function u(t){const e=[],r=[],i=[];for(let t=0;t<n;t++)e[t]=0,r[t]=0,i[t]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:e,enabledAttributes:r,attributeDivisors:i,object:t,attributes:{},index:null}}function c(){const t=s.newAttributes;for(let e=0,n=t.length;e<n;e++)t[e]=0}function h(t){d(t,0)}function d(e,n){const r=s.newAttributes,i=s.enabledAttributes,o=s.attributeDivisors;r[e]=1,0===i[e]&&(t.enableVertexAttribArray(e),i[e]=1),o[e]!==n&&(t.vertexAttribDivisor(e,n),o[e]=n)}function p(){const e=s.newAttributes,n=s.enabledAttributes;for(let r=0,i=n.length;r<i;r++)n[r]!==e[r]&&(t.disableVertexAttribArray(r),n[r]=0)}function f(e,n,r,i,s,o,a){!0===a?t.vertexAttribIPointer(e,n,r,s,o):t.vertexAttribPointer(e,n,r,i,s,o)}function m(){g(),o=!0,s!==i&&(s=i,a(s.object))}function g(){i.geometry=null,i.program=null,i.wireframe=!1}return{setup:function(n,i,l,m,g){let v=!1;const y=function(e,n,i){const s=!0===i.wireframe;let o=r[e.id];void 0===o&&(o={},r[e.id]=o);let a=o[n.id];void 0===a&&(a={},o[n.id]=a);let l=a[s];void 0===l&&(l=u(t.createVertexArray()),a[s]=l);return l}(m,l,i);s!==y&&(s=y,a(s.object)),v=function(t,e,n,r){const i=s.attributes,o=e.attributes;let a=0;const l=n.getAttributes();for(const e in l){if(l[e].location>=0){const n=i[e];let r=o[e];if(void 0===r&&("instanceMatrix"===e&&t.instanceMatrix&&(r=t.instanceMatrix),"instanceColor"===e&&t.instanceColor&&(r=t.instanceColor)),void 0===n)return!0;if(n.attribute!==r)return!0;if(r&&n.data!==r.data)return!0;a++}}return s.attributesNum!==a||s.index!==r}(n,m,l,g),v&&function(t,e,n,r){const i={},o=e.attributes;let a=0;const l=n.getAttributes();for(const e in l){if(l[e].location>=0){let n=o[e];void 0===n&&("instanceMatrix"===e&&t.instanceMatrix&&(n=t.instanceMatrix),"instanceColor"===e&&t.instanceColor&&(n=t.instanceColor));const r={};r.attribute=n,n&&n.data&&(r.data=n.data),i[e]=r,a++}}s.attributes=i,s.attributesNum=a,s.index=r}(n,m,l,g),null!==g&&e.update(g,t.ELEMENT_ARRAY_BUFFER),(v||o)&&(o=!1,function(n,r,i,s){c();const o=s.attributes,a=i.getAttributes(),l=r.defaultAttributeValues;for(const r in a){const i=a[r];if(i.location>=0){let a=o[r];if(void 0===a&&("instanceMatrix"===r&&n.instanceMatrix&&(a=n.instanceMatrix),"instanceColor"===r&&n.instanceColor&&(a=n.instanceColor)),void 0!==a){const r=a.normalized,o=a.itemSize,l=e.get(a);if(void 0===l)continue;const u=l.buffer,c=l.type,p=l.bytesPerElement,m=c===t.INT||c===t.UNSIGNED_INT||a.gpuType===A;if(a.isInterleavedBufferAttribute){const e=a.data,l=e.stride,g=a.offset;if(e.isInstancedInterleavedBuffer){for(let t=0;t<i.locationSize;t++)d(i.location+t,e.meshPerAttribute);!0!==n.isInstancedMesh&&void 0===s._maxInstanceCount&&(s._maxInstanceCount=e.meshPerAttribute*e.count)}else for(let t=0;t<i.locationSize;t++)h(i.location+t);t.bindBuffer(t.ARRAY_BUFFER,u);for(let t=0;t<i.locationSize;t++)f(i.location+t,o/i.locationSize,c,r,l*p,(g+o/i.locationSize*t)*p,m)}else{if(a.isInstancedBufferAttribute){for(let t=0;t<i.locationSize;t++)d(i.location+t,a.meshPerAttribute);!0!==n.isInstancedMesh&&void 0===s._maxInstanceCount&&(s._maxInstanceCount=a.meshPerAttribute*a.count)}else for(let t=0;t<i.locationSize;t++)h(i.location+t);t.bindBuffer(t.ARRAY_BUFFER,u);for(let t=0;t<i.locationSize;t++)f(i.location+t,o/i.locationSize,c,r,o*p,o/i.locationSize*t*p,m)}}else if(void 0!==l){const e=l[r];if(void 0!==e)switch(e.length){case 2:t.vertexAttrib2fv(i.location,e);break;case 3:t.vertexAttrib3fv(i.location,e);break;case 4:t.vertexAttrib4fv(i.location,e);break;default:t.vertexAttrib1fv(i.location,e)}}}}p()}(n,i,l,m),null!==g&&t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,e.get(g).buffer))},reset:m,resetDefaultState:g,dispose:function(){m();for(const t in r){const e=r[t];for(const t in e){const n=e[t];for(const t in n)l(n[t].object),delete n[t];delete e[t]}delete r[t]}},releaseStatesOfGeometry:function(t){if(void 0===r[t.id])return;const e=r[t.id];for(const t in e){const n=e[t];for(const t in n)l(n[t].object),delete n[t];delete e[t]}delete r[t.id]},releaseStatesOfProgram:function(t){for(const e in r){const n=r[e];if(void 0===n[t.id])continue;const i=n[t.id];for(const t in i)l(i[t].object),delete i[t];delete n[t.id]}},initAttributes:c,enableAttribute:h,disableUnusedAttributes:p}}function ni(t,e,n){let r;function i(e,i,s){0!==s&&(t.drawArraysInstanced(r,e,i,s),n.update(i,r,s))}this.setMode=function(t){r=t},this.render=function(e,i){t.drawArrays(r,e,i),n.update(i,r,1)},this.renderInstances=i,this.renderMultiDraw=function(t,i,s){if(0===s)return;e.get("WEBGL_multi_draw").multiDrawArraysWEBGL(r,t,0,i,0,s);let o=0;for(let t=0;t<s;t++)o+=i[t];n.update(o,r,1)},this.renderMultiDrawInstances=function(t,s,o,a){if(0===o)return;const l=e.get("WEBGL_multi_draw");if(null===l)for(let e=0;e<t.length;e++)i(t[e],s[e],a[e]);else{l.multiDrawArraysInstancedWEBGL(r,t,0,s,0,a,0,o);let e=0;for(let t=0;t<o;t++)e+=s[t]*a[t];n.update(e,r,1)}}}function ri(t,e,n,r){let i;function s(e){if("highp"===e){if(t.getShaderPrecisionFormat(t.VERTEX_SHADER,t.HIGH_FLOAT).precision>0&&t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.HIGH_FLOAT).precision>0)return"highp";e="mediump"}return"mediump"===e&&t.getShaderPrecisionFormat(t.VERTEX_SHADER,t.MEDIUM_FLOAT).precision>0&&t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}let o=void 0!==n.precision?n.precision:"highp";const a=s(o);a!==o&&(console.warn("THREE.WebGLRenderer:",o,"not supported, using",a,"instead."),o=a);const l=!0===n.logarithmicDepthBuffer,u=!0===n.reverseDepthBuffer&&e.has("EXT_clip_control"),c=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),h=t.getParameter(t.MAX_VERTEX_TEXTURE_IMAGE_UNITS);return{isWebGL2:!0,getMaxAnisotropy:function(){if(void 0!==i)return i;if(!0===e.has("EXT_texture_filter_anisotropic")){const n=e.get("EXT_texture_filter_anisotropic");i=t.getParameter(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else i=0;return i},getMaxPrecision:s,textureFormatReadable:function(e){return e===L||r.convert(e)===t.getParameter(t.IMPLEMENTATION_COLOR_READ_FORMAT)},textureTypeReadable:function(n){const i=n===N&&(e.has("EXT_color_buffer_half_float")||e.has("EXT_color_buffer_float"));return!(n!==S&&r.convert(n)!==t.getParameter(t.IMPLEMENTATION_COLOR_READ_TYPE)&&n!==R&&!i)},precision:o,logarithmicDepthBuffer:l,reverseDepthBuffer:u,maxTextures:c,maxVertexTextures:h,maxTextureSize:t.getParameter(t.MAX_TEXTURE_SIZE),maxCubemapSize:t.getParameter(t.MAX_CUBE_MAP_TEXTURE_SIZE),maxAttributes:t.getParameter(t.MAX_VERTEX_ATTRIBS),maxVertexUniforms:t.getParameter(t.MAX_VERTEX_UNIFORM_VECTORS),maxVaryings:t.getParameter(t.MAX_VARYING_VECTORS),maxFragmentUniforms:t.getParameter(t.MAX_FRAGMENT_UNIFORM_VECTORS),vertexTextures:h>0,maxSamples:t.getParameter(t.MAX_SAMPLES)}}function ii(t){const e=this;let n=null,r=0,i=!1,s=!1;const o=new Vr,a=new Zt,l={value:null,needsUpdate:!1};function u(t,n,r,i){const s=null!==t?t.length:0;let u=null;if(0!==s){if(u=l.value,!0!==i||null===u){const e=r+4*s,i=n.matrixWorldInverse;a.getNormalMatrix(i),(null===u||u.length<e)&&(u=new Float32Array(e));for(let e=0,n=r;e!==s;++e,n+=4)o.copy(t[e]).applyMatrix4(i,a),o.normal.toArray(u,n),u[n+3]=o.constant}l.value=u,l.needsUpdate=!0}return e.numPlanes=s,e.numIntersection=0,u}this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(t,e){const n=0!==t.length||e||0!==r||i;return i=e,r=t.length,n},this.beginShadows=function(){s=!0,u(null)},this.endShadows=function(){s=!1},this.setGlobalState=function(t,e){n=u(t,e,0)},this.setState=function(o,a,c){const h=o.clippingPlanes,d=o.clipIntersection,p=o.clipShadows,f=t.get(o);if(!i||null===h||0===h.length||s&&!p)s?u(null):function(){l.value!==n&&(l.value=n,l.needsUpdate=r>0);e.numPlanes=r,e.numIntersection=0}();else{const t=s?0:r,e=4*t;let i=f.clippingState||null;l.value=i,i=u(h,a,e,c);for(let t=0;t!==e;++t)i[t]=n[t];f.clippingState=i,this.numIntersection=d?this.numPlanes:0,this.numPlanes+=t}}}function si(t){let e=new WeakMap;function n(t,e){return e===d?t.mapping=c:e===p&&(t.mapping=h),t}function r(t){const n=t.target;n.removeEventListener("dispose",r);const i=e.get(n);void 0!==i&&(e.delete(n),i.dispose())}return{get:function(i){if(i&&i.isTexture){const s=i.mapping;if(s===d||s===p){if(e.has(i)){return n(e.get(i).texture,i.mapping)}{const s=i.image;if(s&&s.height>0){const o=new kr(s.height);return o.fromEquirectangularTexture(t,i),e.set(i,o),i.addEventListener("dispose",r),n(o.texture,i.mapping)}return null}}}return i},dispose:function(){e=new WeakMap}}}class oi extends Rr{constructor(t=-1,e=1,n=1,r=-1,i=.1,s=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=t,this.right=e,this.top=n,this.bottom=r,this.near=i,this.far=s,this.updateProjectionMatrix()}copy(t,e){return super.copy(t,e),this.left=t.left,this.right=t.right,this.top=t.top,this.bottom=t.bottom,this.near=t.near,this.far=t.far,this.zoom=t.zoom,this.view=null===t.view?null:Object.assign({},t.view),this}setViewOffset(t,e,n,r,i,s){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=n,this.view.offsetY=r,this.view.width=i,this.view.height=s,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const t=(this.right-this.left)/(2*this.zoom),e=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,r=(this.top+this.bottom)/2;let i=n-t,s=n+t,o=r+e,a=r-e;if(null!==this.view&&this.view.enabled){const t=(this.right-this.left)/this.view.fullWidth/this.zoom,e=(this.top-this.bottom)/this.view.fullHeight/this.zoom;i+=t*this.view.offsetX,s=i+t*this.view.width,o-=e*this.view.offsetY,a=o-e*this.view.height}this.projectionMatrix.makeOrthographic(i,s,o,a,this.near,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(t){const e=super.toJSON(t);return e.object.zoom=this.zoom,e.object.left=this.left,e.object.right=this.right,e.object.top=this.top,e.object.bottom=this.bottom,e.object.near=this.near,e.object.far=this.far,null!==this.view&&(e.object.view=Object.assign({},this.view)),e}}const ai=[.125,.215,.35,.446,.526,.582],li=20,ui=new oi,ci=new Wn;let hi=null,di=0,pi=0,fi=!1;const mi=(1+Math.sqrt(5))/2,gi=1/mi,vi=[new we(-mi,gi,0),new we(mi,gi,0),new we(-gi,0,mi),new we(gi,0,mi),new we(0,mi,-gi),new we(0,mi,gi),new we(-1,1,-1),new we(1,1,-1),new we(-1,1,1),new we(1,1,1)];class yi{constructor(t){this._renderer=t,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(t,e=0,n=.1,r=100){hi=this._renderer.getRenderTarget(),di=this._renderer.getActiveCubeFace(),pi=this._renderer.getActiveMipmapLevel(),fi=this._renderer.xr.enabled,this._renderer.xr.enabled=!1,this._setSize(256);const i=this._allocateTargets();return i.depthBuffer=!0,this._sceneToCubeUV(t,n,r,i),e>0&&this._blur(i,0,0,e),this._applyPMREM(i),this._cleanup(i),i}fromEquirectangular(t,e=null){return this._fromTexture(t,e)}fromCubemap(t,e=null){return this._fromTexture(t,e)}compileCubemapShader(){null===this._cubemapMaterial&&(this._cubemapMaterial=wi(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){null===this._equirectMaterial&&(this._equirectMaterial=bi(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),null!==this._cubemapMaterial&&this._cubemapMaterial.dispose(),null!==this._equirectMaterial&&this._equirectMaterial.dispose()}_setSize(t){this._lodMax=Math.floor(Math.log2(t)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){null!==this._blurMaterial&&this._blurMaterial.dispose(),null!==this._pingPongRenderTarget&&this._pingPongRenderTarget.dispose();for(let t=0;t<this._lodPlanes.length;t++)this._lodPlanes[t].dispose()}_cleanup(t){this._renderer.setRenderTarget(hi,di,pi),this._renderer.xr.enabled=fi,t.scissorTest=!1,xi(t,0,0,t.width,t.height)}_fromTexture(t,e){t.mapping===c||t.mapping===h?this._setSize(0===t.image.length?16:t.image[0].width||t.image[0].image.width):this._setSize(t.image.width/4),hi=this._renderer.getRenderTarget(),di=this._renderer.getActiveCubeFace(),pi=this._renderer.getActiveMipmapLevel(),fi=this._renderer.xr.enabled,this._renderer.xr.enabled=!1;const n=e||this._allocateTargets();return this._textureToCubeUV(t,n),this._applyPMREM(n),this._cleanup(n),n}_allocateTargets(){const t=3*Math.max(this._cubeSize,112),e=4*this._cubeSize,n={magFilter:x,minFilter:x,generateMipmaps:!1,type:N,format:L,colorSpace:At,depthBuffer:!1},r=_i(t,e,n);if(null===this._pingPongRenderTarget||this._pingPongRenderTarget.width!==t||this._pingPongRenderTarget.height!==e){null!==this._pingPongRenderTarget&&this._dispose(),this._pingPongRenderTarget=_i(t,e,n);const{_lodMax:r}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=function(t){const e=[],n=[],r=[];let i=t;const s=t-4+1+ai.length;for(let o=0;o<s;o++){const s=Math.pow(2,i);n.push(s);let a=1/s;o>t-4?a=ai[o-t+4-1]:0===o&&(a=0),r.push(a);const l=1/(s-2),u=-l,c=1+l,h=[u,u,c,u,c,c,u,u,c,c,u,c],d=6,p=6,f=3,m=2,g=1,v=new Float32Array(f*p*d),y=new Float32Array(m*p*d),_=new Float32Array(g*p*d);for(let t=0;t<d;t++){const e=t%3*2/3-1,n=t>2?0:-1,r=[e,n,0,e+2/3,n,0,e+2/3,n+1,0,e,n,0,e+2/3,n+1,0,e,n+1,0];v.set(r,f*p*t),y.set(h,m*p*t);const i=[t,t,t,t,t,t];_.set(i,g*p*t)}const x=new ur;x.setAttribute("position",new Jn(v,f)),x.setAttribute("uv",new Jn(y,m)),x.setAttribute("faceIndex",new Jn(_,g)),e.push(x),i>4&&i--}return{lodPlanes:e,sizeLods:n,sigmas:r}}(r)),this._blurMaterial=function(t,e,n){const r=new Float32Array(li),i=new we(0,1,0),s=new Cr({name:"SphericalGaussianBlur",defines:{n:li,CUBEUV_TEXEL_WIDTH:1/e,CUBEUV_TEXEL_HEIGHT:1/n,CUBEUV_MAX_MIP:`${t}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:r},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:i}},vertexShader:Si(),fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform int samples;\n\t\t\tuniform float weights[ n ];\n\t\t\tuniform bool latitudinal;\n\t\t\tuniform float dTheta;\n\t\t\tuniform float mipInt;\n\t\t\tuniform vec3 poleAxis;\n\n\t\t\t#define ENVMAP_TYPE_CUBE_UV\n\t\t\t#include <cube_uv_reflection_fragment>\n\n\t\t\tvec3 getSample( float theta, vec3 axis ) {\n\n\t\t\t\tfloat cosTheta = cos( theta );\n\t\t\t\t// Rodrigues' axis-angle rotation\n\t\t\t\tvec3 sampleDirection = vOutputDirection * cosTheta\n\t\t\t\t\t+ cross( axis, vOutputDirection ) * sin( theta )\n\t\t\t\t\t+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );\n\n\t\t\t\treturn bilinearCubeUV( envMap, sampleDirection, mipInt );\n\n\t\t\t}\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );\n\n\t\t\t\tif ( all( equal( axis, vec3( 0.0 ) ) ) ) {\n\n\t\t\t\t\taxis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );\n\n\t\t\t\t}\n\n\t\t\t\taxis = normalize( axis );\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );\n\n\t\t\t\tfor ( int i = 1; i < n; i++ ) {\n\n\t\t\t\t\tif ( i >= samples ) {\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tfloat theta = dTheta * float( i );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( theta, axis );\n\n\t\t\t\t}\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1});return s}(r,t,e)}return r}_compileMaterial(t){const e=new br(this._lodPlanes[0],t);this._renderer.compile(e,ui)}_sceneToCubeUV(t,e,n,r){const i=new Or(90,1,e,n),s=[1,-1,1,1,1,1],o=[1,1,1,-1,-1,-1],a=this._renderer,l=a.autoClear,u=a.toneMapping;a.getClearColor(ci),a.toneMapping=0,a.autoClear=!1;const c=new $n({name:"PMREM.Background",side:1,depthWrite:!1,depthTest:!1}),h=new br(new Sr,c);let d=!1;const p=t.background;p?p.isColor&&(c.color.copy(p),t.background=null,d=!0):(c.color.copy(ci),d=!0);for(let e=0;e<6;e++){const n=e%3;0===n?(i.up.set(0,s[e],0),i.lookAt(o[e],0,0)):1===n?(i.up.set(0,0,s[e]),i.lookAt(0,o[e],0)):(i.up.set(0,s[e],0),i.lookAt(0,0,o[e]));const l=this._cubeSize;xi(r,n*l,e>2?l:0,l,l),a.setRenderTarget(r),d&&a.render(h,i),a.render(t,i)}h.geometry.dispose(),h.material.dispose(),a.toneMapping=u,a.autoClear=l,t.background=p}_textureToCubeUV(t,e){const n=this._renderer,r=t.mapping===c||t.mapping===h;r?(null===this._cubemapMaterial&&(this._cubemapMaterial=wi()),this._cubemapMaterial.uniforms.flipEnvMap.value=!1===t.isRenderTargetTexture?-1:1):null===this._equirectMaterial&&(this._equirectMaterial=bi());const i=r?this._cubemapMaterial:this._equirectMaterial,s=new br(this._lodPlanes[0],i);i.uniforms.envMap.value=t;const o=this._cubeSize;xi(e,0,0,3*o,2*o),n.setRenderTarget(e),n.render(s,ui)}_applyPMREM(t){const e=this._renderer,n=e.autoClear;e.autoClear=!1;const r=this._lodPlanes.length;for(let e=1;e<r;e++){const n=Math.sqrt(this._sigmas[e]*this._sigmas[e]-this._sigmas[e-1]*this._sigmas[e-1]),i=vi[(r-e-1)%vi.length];this._blur(t,e-1,e,n,i)}e.autoClear=n}_blur(t,e,n,r,i){const s=this._pingPongRenderTarget;this._halfBlur(t,s,e,n,r,"latitudinal",i),this._halfBlur(s,t,n,n,r,"longitudinal",i)}_halfBlur(t,e,n,r,i,s,o){const a=this._renderer,l=this._blurMaterial;"latitudinal"!==s&&"longitudinal"!==s&&console.error("blur direction must be either latitudinal or longitudinal!");const u=new br(this._lodPlanes[r],l),c=l.uniforms,h=this._sizeLods[n]-1,d=isFinite(i)?Math.PI/(2*h):2*Math.PI/39,p=i/d,f=isFinite(i)?1+Math.floor(3*p):li;f>li&&console.warn(`sigmaRadians, ${i}, is too large and will clip, as it requested ${f} samples when the maximum is set to 20`);const m=[];let g=0;for(let t=0;t<li;++t){const e=t/p,n=Math.exp(-e*e/2);m.push(n),0===t?g+=n:t<f&&(g+=2*n)}for(let t=0;t<m.length;t++)m[t]=m[t]/g;c.envMap.value=t.texture,c.samples.value=f,c.weights.value=m,c.latitudinal.value="latitudinal"===s,o&&(c.poleAxis.value=o);const{_lodMax:v}=this;c.dTheta.value=d,c.mipInt.value=v-n;const y=this._sizeLods[r];xi(e,3*y*(r>v-4?r-v+4:0),4*(this._cubeSize-y),3*y,2*y),a.setRenderTarget(e),a.render(u,ui)}}function _i(t,e,n){const r=new ye(t,e,n);return r.texture.mapping=f,r.texture.name="PMREM.cubeUv",r.scissorTest=!0,r}function xi(t,e,n,r,i){t.viewport.set(e,n,r,i),t.scissor.set(e,n,r,i)}function bi(){return new Cr({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:Si(),fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\n\t\t\t#include <common>\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 outputDirection = normalize( vOutputDirection );\n\t\t\t\tvec2 uv = equirectUv( outputDirection );\n\n\t\t\t\tgl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1})}function wi(){return new Cr({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:Si(),fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tuniform float flipEnvMap;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform samplerCube envMap;\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1})}function Si(){return"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t"}function Mi(t){let e=new WeakMap,n=null;function r(t){const n=t.target;n.removeEventListener("dispose",r);const i=e.get(n);void 0!==i&&(e.delete(n),i.dispose())}return{get:function(i){if(i&&i.isTexture){const s=i.mapping,o=s===d||s===p,a=s===c||s===h;if(o||a){let s=e.get(i);const l=void 0!==s?s.texture.pmremVersion:0;if(i.isRenderTargetTexture&&i.pmremVersion!==l)return null===n&&(n=new yi(t)),s=o?n.fromEquirectangular(i,s):n.fromCubemap(i,s),s.texture.pmremVersion=i.pmremVersion,e.set(i,s),s.texture;if(void 0!==s)return s.texture;{const l=i.image;return o&&l&&l.height>0||a&&l&&function(t){let e=0;const n=6;for(let r=0;r<n;r++)void 0!==t[r]&&e++;return e===n}(l)?(null===n&&(n=new yi(t)),s=o?n.fromEquirectangular(i):n.fromCubemap(i),s.texture.pmremVersion=i.pmremVersion,e.set(i,s),i.addEventListener("dispose",r),s.texture):null}}}return i},dispose:function(){e=new WeakMap,null!==n&&(n.dispose(),n=null)}}}function Ei(t){const e={};function n(n){if(void 0!==e[n])return e[n];let r;switch(n){case"WEBGL_depth_texture":r=t.getExtension("WEBGL_depth_texture")||t.getExtension("MOZ_WEBGL_depth_texture")||t.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":r=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":r=t.getExtension("WEBGL_compressed_texture_s3tc")||t.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":r=t.getExtension("WEBGL_compressed_texture_pvrtc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:r=t.getExtension(n)}return e[n]=r,r}return{has:function(t){return null!==n(t)},init:function(){n("EXT_color_buffer_float"),n("WEBGL_clip_cull_distance"),n("OES_texture_float_linear"),n("EXT_color_buffer_half_float"),n("WEBGL_multisampled_render_to_texture"),n("WEBGL_render_shared_exponent")},get:function(t){const e=n(t);return null===e&&te("THREE.WebGLRenderer: "+t+" extension not supported."),e}}}function Ti(t,e,n,r){const i={},s=new WeakMap;function o(t){const a=t.target;null!==a.index&&e.remove(a.index);for(const t in a.attributes)e.remove(a.attributes[t]);for(const t in a.morphAttributes){const n=a.morphAttributes[t];for(let t=0,r=n.length;t<r;t++)e.remove(n[t])}a.removeEventListener("dispose",o),delete i[a.id];const l=s.get(a);l&&(e.remove(l),s.delete(a)),r.releaseStatesOfGeometry(a),!0===a.isInstancedBufferGeometry&&delete a._maxInstanceCount,n.memory.geometries--}function a(t){const n=[],r=t.index,i=t.attributes.position;let o=0;if(null!==r){const t=r.array;o=r.version;for(let e=0,r=t.length;e<r;e+=3){const r=t[e+0],i=t[e+1],s=t[e+2];n.push(r,i,i,s,s,r)}}else{if(void 0===i)return;{const t=i.array;o=i.version;for(let e=0,r=t.length/3-1;e<r;e+=3){const t=e+0,r=e+1,i=e+2;n.push(t,r,r,i,i,t)}}}const a=new(Yt(n)?tr:Qn)(n,1);a.version=o;const l=s.get(t);l&&e.remove(l),s.set(t,a)}return{get:function(t,e){return!0===i[e.id]||(e.addEventListener("dispose",o),i[e.id]=!0,n.memory.geometries++),e},update:function(n){const r=n.attributes;for(const n in r)e.update(r[n],t.ARRAY_BUFFER);const i=n.morphAttributes;for(const n in i){const r=i[n];for(let n=0,i=r.length;n<i;n++)e.update(r[n],t.ARRAY_BUFFER)}},getWireframeAttribute:function(t){const e=s.get(t);if(e){const n=t.index;null!==n&&e.version<n.version&&a(t)}else a(t);return s.get(t)}}}function Ai(t,e,n){let r,i,s;function o(e,o,a){0!==a&&(t.drawElementsInstanced(r,o,i,e*s,a),n.update(o,r,a))}this.setMode=function(t){r=t},this.setIndex=function(t){i=t.type,s=t.bytesPerElement},this.render=function(e,o){t.drawElements(r,o,i,e*s),n.update(o,r,1)},this.renderInstances=o,this.renderMultiDraw=function(t,s,o){if(0===o)return;e.get("WEBGL_multi_draw").multiDrawElementsWEBGL(r,s,0,i,t,0,o);let a=0;for(let t=0;t<o;t++)a+=s[t];n.update(a,r,1)},this.renderMultiDrawInstances=function(t,a,l,u){if(0===l)return;const c=e.get("WEBGL_multi_draw");if(null===c)for(let e=0;e<t.length;e++)o(t[e]/s,a[e],u[e]);else{c.multiDrawElementsInstancedWEBGL(r,a,0,i,t,0,u,0,l);let e=0;for(let t=0;t<l;t++)e+=a[t]*u[t];n.update(e,r,1)}}}function Ci(t){const e={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:e,programs:null,autoReset:!0,reset:function(){e.calls=0,e.triangles=0,e.points=0,e.lines=0},update:function(n,r,i){switch(e.calls++,r){case t.TRIANGLES:e.triangles+=i*(n/3);break;case t.LINES:e.lines+=i*(n/2);break;case t.LINE_STRIP:e.lines+=i*(n-1);break;case t.LINE_LOOP:e.lines+=i*n;break;case t.POINTS:e.points+=i*n;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",r)}}}}function Ri(t,e,n){const r=new WeakMap,i=new ge;return{update:function(s,o,a){const l=s.morphTargetInfluences,u=o.morphAttributes.position||o.morphAttributes.normal||o.morphAttributes.color,c=void 0!==u?u.length:0;let h=r.get(o);if(void 0===h||h.count!==c){void 0!==h&&h.texture.dispose();const d=void 0!==o.morphAttributes.position,p=void 0!==o.morphAttributes.normal,f=void 0!==o.morphAttributes.color,m=o.morphAttributes.position||[],g=o.morphAttributes.normal||[],v=o.morphAttributes.color||[];let y=0;!0===d&&(y=1),!0===p&&(y=2),!0===f&&(y=3);let _=o.attributes.position.count*y,x=1;_>e.maxTextureSize&&(x=Math.ceil(_/e.maxTextureSize),_=e.maxTextureSize);const b=new Float32Array(_*x*4*c),w=new _e(b,_,x,c);w.type=R,w.needsUpdate=!0;const S=4*y;for(let E=0;E<c;E++){const T=m[E],A=g[E],C=v[E],N=_*x*4*E;for(let P=0;P<T.count;P++){const I=P*S;!0===d&&(i.fromBufferAttribute(T,P),b[N+I+0]=i.x,b[N+I+1]=i.y,b[N+I+2]=i.z,b[N+I+3]=0),!0===p&&(i.fromBufferAttribute(A,P),b[N+I+4]=i.x,b[N+I+5]=i.y,b[N+I+6]=i.z,b[N+I+7]=0),!0===f&&(i.fromBufferAttribute(C,P),b[N+I+8]=i.x,b[N+I+9]=i.y,b[N+I+10]=i.z,b[N+I+11]=4===C.itemSize?i.w:1)}}function M(){w.dispose(),r.delete(o),o.removeEventListener("dispose",M)}h={count:c,texture:w,size:new Xt(_,x)},r.set(o,h),o.addEventListener("dispose",M)}if(!0===s.isInstancedMesh&&null!==s.morphTexture)a.getUniforms().setValue(t,"morphTexture",s.morphTexture,n);else{let O=0;for(let L=0;L<l.length;L++)O+=l[L];const D=o.morphTargetsRelative?1:1-O;a.getUniforms().setValue(t,"morphTargetBaseInfluence",D),a.getUniforms().setValue(t,"morphTargetInfluences",l)}a.getUniforms().setValue(t,"morphTargetsTexture",h.texture,n),a.getUniforms().setValue(t,"morphTargetsTextureSize",h.size)}}}function Ni(t,e,n,r){let i=new WeakMap;function s(t){const e=t.target;e.removeEventListener("dispose",s),n.remove(e.instanceMatrix),null!==e.instanceColor&&n.remove(e.instanceColor)}return{update:function(o){const a=r.render.frame,l=o.geometry,u=e.get(o,l);if(i.get(u)!==a&&(e.update(u),i.set(u,a)),o.isInstancedMesh&&(!1===o.hasEventListener("dispose",s)&&o.addEventListener("dispose",s),i.get(o)!==a&&(n.update(o.instanceMatrix,t.ARRAY_BUFFER),null!==o.instanceColor&&n.update(o.instanceColor,t.ARRAY_BUFFER),i.set(o,a))),o.isSkinnedMesh){const t=o.skeleton;i.get(t)!==a&&(t.update(),i.set(t,a))}return u},dispose:function(){i=new WeakMap}}}class Pi extends me{constructor(t,e,n,r,i,s,o,a,l,u=1026){if(u!==U&&u!==k)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===n&&u===U&&(n=C),void 0===n&&u===k&&(n=O),super(null,r,i,s,o,a,u,n,l),this.isDepthTexture=!0,this.image={width:t,height:e},this.magFilter=void 0!==o?o:y,this.minFilter=void 0!==a?a:y,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(t){return super.copy(t),this.compareFunction=t.compareFunction,this}toJSON(t){const e=super.toJSON(t);return null!==this.compareFunction&&(e.compareFunction=this.compareFunction),e}}const Ii=new me,Oi=new Pi(1,1),Di=new _e,Li=new xe,Ui=new Ur,ki=[],Bi=[],Fi=new Float32Array(16),zi=new Float32Array(9),Vi=new Float32Array(4);function Gi(t,e,n){const r=t[0];if(r<=0||r>0)return t;const i=e*n;let s=ki[i];if(void 0===s&&(s=new Float32Array(i),ki[i]=s),0!==e){r.toArray(s,0);for(let r=1,i=0;r!==e;++r)i+=n,t[r].toArray(s,i)}return s}function ji(t,e){if(t.length!==e.length)return!1;for(let n=0,r=t.length;n<r;n++)if(t[n]!==e[n])return!1;return!0}function Hi(t,e){for(let n=0,r=e.length;n<r;n++)t[n]=e[n]}function Wi(t,e){let n=Bi[e];void 0===n&&(n=new Int32Array(e),Bi[e]=n);for(let r=0;r!==e;++r)n[r]=t.allocateTextureUnit();return n}function qi(t,e){const n=this.cache;n[0]!==e&&(t.uniform1f(this.addr,e),n[0]=e)}function Xi(t,e){const n=this.cache;if(void 0!==e.x)n[0]===e.x&&n[1]===e.y||(t.uniform2f(this.addr,e.x,e.y),n[0]=e.x,n[1]=e.y);else{if(ji(n,e))return;t.uniform2fv(this.addr,e),Hi(n,e)}}function Zi(t,e){const n=this.cache;if(void 0!==e.x)n[0]===e.x&&n[1]===e.y&&n[2]===e.z||(t.uniform3f(this.addr,e.x,e.y,e.z),n[0]=e.x,n[1]=e.y,n[2]=e.z);else if(void 0!==e.r)n[0]===e.r&&n[1]===e.g&&n[2]===e.b||(t.uniform3f(this.addr,e.r,e.g,e.b),n[0]=e.r,n[1]=e.g,n[2]=e.b);else{if(ji(n,e))return;t.uniform3fv(this.addr,e),Hi(n,e)}}function $i(t,e){const n=this.cache;if(void 0!==e.x)n[0]===e.x&&n[1]===e.y&&n[2]===e.z&&n[3]===e.w||(t.uniform4f(this.addr,e.x,e.y,e.z,e.w),n[0]=e.x,n[1]=e.y,n[2]=e.z,n[3]=e.w);else{if(ji(n,e))return;t.uniform4fv(this.addr,e),Hi(n,e)}}function Yi(t,e){const n=this.cache,r=e.elements;if(void 0===r){if(ji(n,e))return;t.uniformMatrix2fv(this.addr,!1,e),Hi(n,e)}else{if(ji(n,r))return;Vi.set(r),t.uniformMatrix2fv(this.addr,!1,Vi),Hi(n,r)}}function Ki(t,e){const n=this.cache,r=e.elements;if(void 0===r){if(ji(n,e))return;t.uniformMatrix3fv(this.addr,!1,e),Hi(n,e)}else{if(ji(n,r))return;zi.set(r),t.uniformMatrix3fv(this.addr,!1,zi),Hi(n,r)}}function Ji(t,e){const n=this.cache,r=e.elements;if(void 0===r){if(ji(n,e))return;t.uniformMatrix4fv(this.addr,!1,e),Hi(n,e)}else{if(ji(n,r))return;Fi.set(r),t.uniformMatrix4fv(this.addr,!1,Fi),Hi(n,r)}}function Qi(t,e){const n=this.cache;n[0]!==e&&(t.uniform1i(this.addr,e),n[0]=e)}function ts(t,e){const n=this.cache;if(void 0!==e.x)n[0]===e.x&&n[1]===e.y||(t.uniform2i(this.addr,e.x,e.y),n[0]=e.x,n[1]=e.y);else{if(ji(n,e))return;t.uniform2iv(this.addr,e),Hi(n,e)}}function es(t,e){const n=this.cache;if(void 0!==e.x)n[0]===e.x&&n[1]===e.y&&n[2]===e.z||(t.uniform3i(this.addr,e.x,e.y,e.z),n[0]=e.x,n[1]=e.y,n[2]=e.z);else{if(ji(n,e))return;t.uniform3iv(this.addr,e),Hi(n,e)}}function ns(t,e){const n=this.cache;if(void 0!==e.x)n[0]===e.x&&n[1]===e.y&&n[2]===e.z&&n[3]===e.w||(t.uniform4i(this.addr,e.x,e.y,e.z,e.w),n[0]=e.x,n[1]=e.y,n[2]=e.z,n[3]=e.w);else{if(ji(n,e))return;t.uniform4iv(this.addr,e),Hi(n,e)}}function rs(t,e){const n=this.cache;n[0]!==e&&(t.uniform1ui(this.addr,e),n[0]=e)}function is(t,e){const n=this.cache;if(void 0!==e.x)n[0]===e.x&&n[1]===e.y||(t.uniform2ui(this.addr,e.x,e.y),n[0]=e.x,n[1]=e.y);else{if(ji(n,e))return;t.uniform2uiv(this.addr,e),Hi(n,e)}}function ss(t,e){const n=this.cache;if(void 0!==e.x)n[0]===e.x&&n[1]===e.y&&n[2]===e.z||(t.uniform3ui(this.addr,e.x,e.y,e.z),n[0]=e.x,n[1]=e.y,n[2]=e.z);else{if(ji(n,e))return;t.uniform3uiv(this.addr,e),Hi(n,e)}}function os(t,e){const n=this.cache;if(void 0!==e.x)n[0]===e.x&&n[1]===e.y&&n[2]===e.z&&n[3]===e.w||(t.uniform4ui(this.addr,e.x,e.y,e.z,e.w),n[0]=e.x,n[1]=e.y,n[2]=e.z,n[3]=e.w);else{if(ji(n,e))return;t.uniform4uiv(this.addr,e),Hi(n,e)}}function as(t,e,n){const r=this.cache,i=n.allocateTextureUnit();let s;r[0]!==i&&(t.uniform1i(this.addr,i),r[0]=i),this.type===t.SAMPLER_2D_SHADOW?(Oi.compareFunction=515,s=Oi):s=Ii,n.setTexture2D(e||s,i)}function ls(t,e,n){const r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(t.uniform1i(this.addr,i),r[0]=i),n.setTexture3D(e||Li,i)}function us(t,e,n){const r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(t.uniform1i(this.addr,i),r[0]=i),n.setTextureCube(e||Ui,i)}function cs(t,e,n){const r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(t.uniform1i(this.addr,i),r[0]=i),n.setTexture2DArray(e||Di,i)}function hs(t,e){t.uniform1fv(this.addr,e)}function ds(t,e){const n=Gi(e,this.size,2);t.uniform2fv(this.addr,n)}function ps(t,e){const n=Gi(e,this.size,3);t.uniform3fv(this.addr,n)}function fs(t,e){const n=Gi(e,this.size,4);t.uniform4fv(this.addr,n)}function ms(t,e){const n=Gi(e,this.size,4);t.uniformMatrix2fv(this.addr,!1,n)}function gs(t,e){const n=Gi(e,this.size,9);t.uniformMatrix3fv(this.addr,!1,n)}function vs(t,e){const n=Gi(e,this.size,16);t.uniformMatrix4fv(this.addr,!1,n)}function ys(t,e){t.uniform1iv(this.addr,e)}function _s(t,e){t.uniform2iv(this.addr,e)}function xs(t,e){t.uniform3iv(this.addr,e)}function bs(t,e){t.uniform4iv(this.addr,e)}function ws(t,e){t.uniform1uiv(this.addr,e)}function Ss(t,e){t.uniform2uiv(this.addr,e)}function Ms(t,e){t.uniform3uiv(this.addr,e)}function Es(t,e){t.uniform4uiv(this.addr,e)}function Ts(t,e,n){const r=this.cache,i=e.length,s=Wi(n,i);ji(r,s)||(t.uniform1iv(this.addr,s),Hi(r,s));for(let t=0;t!==i;++t)n.setTexture2D(e[t]||Ii,s[t])}function As(t,e,n){const r=this.cache,i=e.length,s=Wi(n,i);ji(r,s)||(t.uniform1iv(this.addr,s),Hi(r,s));for(let t=0;t!==i;++t)n.setTexture3D(e[t]||Li,s[t])}function Cs(t,e,n){const r=this.cache,i=e.length,s=Wi(n,i);ji(r,s)||(t.uniform1iv(this.addr,s),Hi(r,s));for(let t=0;t!==i;++t)n.setTextureCube(e[t]||Ui,s[t])}function Rs(t,e,n){const r=this.cache,i=e.length,s=Wi(n,i);ji(r,s)||(t.uniform1iv(this.addr,s),Hi(r,s));for(let t=0;t!==i;++t)n.setTexture2DArray(e[t]||Di,s[t])}class Ns{constructor(t,e,n){this.id=t,this.addr=n,this.cache=[],this.type=e.type,this.setValue=function(t){switch(t){case 5126:return qi;case 35664:return Xi;case 35665:return Zi;case 35666:return $i;case 35674:return Yi;case 35675:return Ki;case 35676:return Ji;case 5124:case 35670:return Qi;case 35667:case 35671:return ts;case 35668:case 35672:return es;case 35669:case 35673:return ns;case 5125:return rs;case 36294:return is;case 36295:return ss;case 36296:return os;case 35678:case 36198:case 36298:case 36306:case 35682:return as;case 35679:case 36299:case 36307:return ls;case 35680:case 36300:case 36308:case 36293:return us;case 36289:case 36303:case 36311:case 36292:return cs}}(e.type)}}class Ps{constructor(t,e,n){this.id=t,this.addr=n,this.cache=[],this.type=e.type,this.size=e.size,this.setValue=function(t){switch(t){case 5126:return hs;case 35664:return ds;case 35665:return ps;case 35666:return fs;case 35674:return ms;case 35675:return gs;case 35676:return vs;case 5124:case 35670:return ys;case 35667:case 35671:return _s;case 35668:case 35672:return xs;case 35669:case 35673:return bs;case 5125:return ws;case 36294:return Ss;case 36295:return Ms;case 36296:return Es;case 35678:case 36198:case 36298:case 36306:case 35682:return Ts;case 35679:case 36299:case 36307:return As;case 35680:case 36300:case 36308:case 36293:return Cs;case 36289:case 36303:case 36311:case 36292:return Rs}}(e.type)}}class Is{constructor(t){this.id=t,this.seq=[],this.map={}}setValue(t,e,n){const r=this.seq;for(let i=0,s=r.length;i!==s;++i){const s=r[i];s.setValue(t,e[s.id],n)}}}const Os=/(\w+)(\])?(\[|\.)?/g;function Ds(t,e){t.seq.push(e),t.map[e.id]=e}function Ls(t,e,n){const r=t.name,i=r.length;for(Os.lastIndex=0;;){const s=Os.exec(r),o=Os.lastIndex;let a=s[1];const l="]"===s[2],u=s[3];if(l&&(a|=0),void 0===u||"["===u&&o+2===i){Ds(n,void 0===u?new Ns(a,t,e):new Ps(a,t,e));break}{let t=n.map[a];void 0===t&&(t=new Is(a),Ds(n,t)),n=t}}}class Us{constructor(t,e){this.seq=[],this.map={};const n=t.getProgramParameter(e,t.ACTIVE_UNIFORMS);for(let r=0;r<n;++r){const n=t.getActiveUniform(e,r);Ls(n,t.getUniformLocation(e,n.name),this)}}setValue(t,e,n,r){const i=this.map[e];void 0!==i&&i.setValue(t,n,r)}setOptional(t,e,n){const r=e[n];void 0!==r&&this.setValue(t,n,r)}static upload(t,e,n,r){for(let i=0,s=e.length;i!==s;++i){const s=e[i],o=n[s.id];!1!==o.needsUpdate&&s.setValue(t,o.value,r)}}static seqWithValue(t,e){const n=[];for(let r=0,i=t.length;r!==i;++r){const i=t[r];i.id in e&&n.push(i)}return n}}function ks(t,e,n){const r=t.createShader(e);return t.shaderSource(r,n),t.compileShader(r),r}let Bs=0;const Fs=new Zt;function zs(t,e,n){const r=t.getShaderParameter(e,t.COMPILE_STATUS),i=t.getShaderInfoLog(e).trim();if(r&&""===i)return"";const s=/ERROR: 0:(\d+)/.exec(i);if(s){const r=parseInt(s[1]);return n.toUpperCase()+"\n\n"+i+"\n\n"+function(t,e){const n=t.split("\n"),r=[],i=Math.max(e-6,0),s=Math.min(e+6,n.length);for(let t=i;t<s;t++){const i=t+1;r.push(`${i===e?">":" "} ${i}: ${n[t]}`)}return r.join("\n")}(t.getShaderSource(e),r)}return i}function Vs(t,e){const n=function(t){ee._getMatrix(Fs,ee.workingColorSpace,t);const e=`mat3( ${Fs.elements.map((t=>t.toFixed(4)))} )`;switch(ee.getTransfer(t)){case Ct:return[e,"LinearTransferOETF"];case Rt:return[e,"sRGBTransferOETF"];default:return console.warn("THREE.WebGLProgram: Unsupported color space: ",t),[e,"LinearTransferOETF"]}}(e);return[`vec4 ${t}( vec4 value ) {`,`\treturn ${n[1]}( vec4( value.rgb * ${n[0]}, value.a ) );`,"}"].join("\n")}function Gs(t,e){let n;switch(e){case 1:n="Linear";break;case 2:n="Reinhard";break;case 3:n="Cineon";break;case 4:n="ACESFilmic";break;case 6:n="AgX";break;case 7:n="Neutral";break;case 5:n="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",e),n="Linear"}return"vec3 "+t+"( vec3 color ) { return "+n+"ToneMapping( color ); }"}const js=new we;function Hs(){ee.getLuminanceCoefficients(js);return["float luminance( const in vec3 rgb ) {",`\tconst vec3 weights = vec3( ${js.x.toFixed(4)}, ${js.y.toFixed(4)}, ${js.z.toFixed(4)} );`,"\treturn dot( weights, rgb );","}"].join("\n")}function Ws(t){return""!==t}function qs(t,e){const n=e.numSpotLightShadows+e.numSpotLightMaps-e.numSpotLightShadowsWithMaps;return t.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,e.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,n).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,e.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function Xs(t,e){return t.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}const Zs=/^[ \t]*#include +<([\w\d./]+)>/gm;function $s(t){return t.replace(Zs,Ks)}const Ys=new Map;function Ks(t,e){let n=Zr[e];if(void 0===n){const t=Ys.get(e);if(void 0===t)throw new Error("Can not resolve #include <"+e+">");n=Zr[t],console.warn('THREE.WebGLRenderer: Shader chunk "%s" has been deprecated. Use "%s" instead.',e,t)}return $s(n)}const Js=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function Qs(t){return t.replace(Js,to)}function to(t,e,n,r){let i="";for(let t=parseInt(e);t<parseInt(n);t++)i+=r.replace(/\[\s*i\s*\]/g,"[ "+t+" ]").replace(/UNROLLED_LOOP_INDEX/g,t);return i}function eo(t){let e=`precision ${t.precision} float;\n\tprecision ${t.precision} int;\n\tprecision ${t.precision} sampler2D;\n\tprecision ${t.precision} samplerCube;\n\tprecision ${t.precision} sampler3D;\n\tprecision ${t.precision} sampler2DArray;\n\tprecision ${t.precision} sampler2DShadow;\n\tprecision ${t.precision} samplerCubeShadow;\n\tprecision ${t.precision} sampler2DArrayShadow;\n\tprecision ${t.precision} isampler2D;\n\tprecision ${t.precision} isampler3D;\n\tprecision ${t.precision} isamplerCube;\n\tprecision ${t.precision} isampler2DArray;\n\tprecision ${t.precision} usampler2D;\n\tprecision ${t.precision} usampler3D;\n\tprecision ${t.precision} usamplerCube;\n\tprecision ${t.precision} usampler2DArray;\n\t`;return"highp"===t.precision?e+="\n#define HIGH_PRECISION":"mediump"===t.precision?e+="\n#define MEDIUM_PRECISION":"lowp"===t.precision&&(e+="\n#define LOW_PRECISION"),e}function no(t,e,n,r){const i=t.getContext(),s=n.defines;let o=n.vertexShader,a=n.fragmentShader;const l=function(t){let e="SHADOWMAP_TYPE_BASIC";return 1===t.shadowMapType?e="SHADOWMAP_TYPE_PCF":2===t.shadowMapType?e="SHADOWMAP_TYPE_PCF_SOFT":3===t.shadowMapType&&(e="SHADOWMAP_TYPE_VSM"),e}(n),u=function(t){let e="ENVMAP_TYPE_CUBE";if(t.envMap)switch(t.envMapMode){case c:case h:e="ENVMAP_TYPE_CUBE";break;case f:e="ENVMAP_TYPE_CUBE_UV"}return e}(n),d=function(t){let e="ENVMAP_MODE_REFLECTION";t.envMap&&t.envMapMode===h&&(e="ENVMAP_MODE_REFRACTION");return e}(n),p=function(t){let e="ENVMAP_BLENDING_NONE";if(t.envMap)switch(t.combine){case 0:e="ENVMAP_BLENDING_MULTIPLY";break;case 1:e="ENVMAP_BLENDING_MIX";break;case 2:e="ENVMAP_BLENDING_ADD"}return e}(n),m=function(t){const e=t.envMapCubeUVHeight;if(null===e)return null;const n=Math.log2(e)-2,r=1/e;return{texelWidth:1/(3*Math.max(Math.pow(2,n),112)),texelHeight:r,maxMip:n}}(n),g=function(t){return[t.extensionClipCullDistance?"#extension GL_ANGLE_clip_cull_distance : require":"",t.extensionMultiDraw?"#extension GL_ANGLE_multi_draw : require":""].filter(Ws).join("\n")}(n),v=function(t){const e=[];for(const n in t){const r=t[n];!1!==r&&e.push("#define "+n+" "+r)}return e.join("\n")}(s),y=i.createProgram();let _,x,b=n.glslVersion?"#version "+n.glslVersion+"\n":"";n.isRawShaderMaterial?(_=["#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,v].filter(Ws).join("\n"),_.length>0&&(_+="\n"),x=["#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,v].filter(Ws).join("\n"),x.length>0&&(x+="\n")):(_=[eo(n),"#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,v,n.extensionClipCullDistance?"#define USE_CLIP_DISTANCE":"",n.batching?"#define USE_BATCHING":"",n.batchingColor?"#define USE_BATCHING_COLOR":"",n.instancing?"#define USE_INSTANCING":"",n.instancingColor?"#define USE_INSTANCING_COLOR":"",n.instancingMorph?"#define USE_INSTANCING_MORPH":"",n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+d:"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",n.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",n.displacementMap?"#define USE_DISPLACEMENTMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.anisotropy?"#define USE_ANISOTROPY":"",n.anisotropyMap?"#define USE_ANISOTROPYMAP":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",n.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",n.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.alphaHash?"#define USE_ALPHAHASH":"",n.transmission?"#define USE_TRANSMISSION":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.thicknessMap?"#define USE_THICKNESSMAP":"",n.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",n.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",n.mapUv?"#define MAP_UV "+n.mapUv:"",n.alphaMapUv?"#define ALPHAMAP_UV "+n.alphaMapUv:"",n.lightMapUv?"#define LIGHTMAP_UV "+n.lightMapUv:"",n.aoMapUv?"#define AOMAP_UV "+n.aoMapUv:"",n.emissiveMapUv?"#define EMISSIVEMAP_UV "+n.emissiveMapUv:"",n.bumpMapUv?"#define BUMPMAP_UV "+n.bumpMapUv:"",n.normalMapUv?"#define NORMALMAP_UV "+n.normalMapUv:"",n.displacementMapUv?"#define DISPLACEMENTMAP_UV "+n.displacementMapUv:"",n.metalnessMapUv?"#define METALNESSMAP_UV "+n.metalnessMapUv:"",n.roughnessMapUv?"#define ROUGHNESSMAP_UV "+n.roughnessMapUv:"",n.anisotropyMapUv?"#define ANISOTROPYMAP_UV "+n.anisotropyMapUv:"",n.clearcoatMapUv?"#define CLEARCOATMAP_UV "+n.clearcoatMapUv:"",n.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+n.clearcoatNormalMapUv:"",n.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+n.clearcoatRoughnessMapUv:"",n.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+n.iridescenceMapUv:"",n.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+n.iridescenceThicknessMapUv:"",n.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+n.sheenColorMapUv:"",n.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+n.sheenRoughnessMapUv:"",n.specularMapUv?"#define SPECULARMAP_UV "+n.specularMapUv:"",n.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+n.specularColorMapUv:"",n.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+n.specularIntensityMapUv:"",n.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+n.transmissionMapUv:"",n.thicknessMapUv?"#define THICKNESSMAP_UV "+n.thicknessMapUv:"",n.vertexTangents&&!1===n.flatShading?"#define USE_TANGENT":"",n.vertexColors?"#define USE_COLOR":"",n.vertexAlphas?"#define USE_COLOR_ALPHA":"",n.vertexUv1s?"#define USE_UV1":"",n.vertexUv2s?"#define USE_UV2":"",n.vertexUv3s?"#define USE_UV3":"",n.pointsUvs?"#define USE_POINTS_UV":"",n.flatShading?"#define FLAT_SHADED":"",n.skinning?"#define USE_SKINNING":"",n.morphTargets?"#define USE_MORPHTARGETS":"",n.morphNormals&&!1===n.flatShading?"#define USE_MORPHNORMALS":"",n.morphColors?"#define USE_MORPHCOLORS":"",n.morphTargetsCount>0?"#define MORPHTARGETS_TEXTURE_STRIDE "+n.morphTextureStride:"",n.morphTargetsCount>0?"#define MORPHTARGETS_COUNT "+n.morphTargetsCount:"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+l:"",n.sizeAttenuation?"#define USE_SIZEATTENUATION":"",n.numLightProbes>0?"#define USE_LIGHT_PROBES":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.reverseDepthBuffer?"#define USE_REVERSEDEPTHBUF":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","\tattribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","\tattribute vec3 instanceColor;","#endif","#ifdef USE_INSTANCING_MORPH","\tuniform sampler2D morphTexture;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","\tattribute vec2 uv1;","#endif","#ifdef USE_UV2","\tattribute vec2 uv2;","#endif","#ifdef USE_UV3","\tattribute vec2 uv3;","#endif","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","\tattribute vec4 color;","#elif defined( USE_COLOR )","\tattribute vec3 color;","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(Ws).join("\n"),x=[eo(n),"#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,v,n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.alphaToCoverage?"#define ALPHA_TO_COVERAGE":"",n.map?"#define USE_MAP":"",n.matcap?"#define USE_MATCAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+u:"",n.envMap?"#define "+d:"",n.envMap?"#define "+p:"",m?"#define CUBEUV_TEXEL_WIDTH "+m.texelWidth:"",m?"#define CUBEUV_TEXEL_HEIGHT "+m.texelHeight:"",m?"#define CUBEUV_MAX_MIP "+m.maxMip+".0":"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",n.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.anisotropy?"#define USE_ANISOTROPY":"",n.anisotropyMap?"#define USE_ANISOTROPYMAP":"",n.clearcoat?"#define USE_CLEARCOAT":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.dispersion?"#define USE_DISPERSION":"",n.iridescence?"#define USE_IRIDESCENCE":"",n.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",n.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",n.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.alphaTest?"#define USE_ALPHATEST":"",n.alphaHash?"#define USE_ALPHAHASH":"",n.sheen?"#define USE_SHEEN":"",n.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",n.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",n.transmission?"#define USE_TRANSMISSION":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.thicknessMap?"#define USE_THICKNESSMAP":"",n.vertexTangents&&!1===n.flatShading?"#define USE_TANGENT":"",n.vertexColors||n.instancingColor||n.batchingColor?"#define USE_COLOR":"",n.vertexAlphas?"#define USE_COLOR_ALPHA":"",n.vertexUv1s?"#define USE_UV1":"",n.vertexUv2s?"#define USE_UV2":"",n.vertexUv3s?"#define USE_UV3":"",n.pointsUvs?"#define USE_POINTS_UV":"",n.gradientMap?"#define USE_GRADIENTMAP":"",n.flatShading?"#define FLAT_SHADED":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+l:"",n.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",n.numLightProbes>0?"#define USE_LIGHT_PROBES":"",n.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",n.decodeVideoTextureEmissive?"#define DECODE_VIDEO_TEXTURE_EMISSIVE":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.reverseDepthBuffer?"#define USE_REVERSEDEPTHBUF":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",0!==n.toneMapping?"#define TONE_MAPPING":"",0!==n.toneMapping?Zr.tonemapping_pars_fragment:"",0!==n.toneMapping?Gs("toneMapping",n.toneMapping):"",n.dithering?"#define DITHERING":"",n.opaque?"#define OPAQUE":"",Zr.colorspace_pars_fragment,Vs("linearToOutputTexel",n.outputColorSpace),Hs(),n.useDepthPacking?"#define DEPTH_PACKING "+n.depthPacking:"","\n"].filter(Ws).join("\n")),o=$s(o),o=qs(o,n),o=Xs(o,n),a=$s(a),a=qs(a,n),a=Xs(a,n),o=Qs(o),a=Qs(a),!0!==n.isRawShaderMaterial&&(b="#version 300 es\n",_=[g,"#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+_,x=["#define varying in",n.glslVersion===It?"":"layout(location = 0) out highp vec4 pc_fragColor;",n.glslVersion===It?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+x);const w=b+_+o,S=b+x+a,M=ks(i,i.VERTEX_SHADER,w),E=ks(i,i.FRAGMENT_SHADER,S);function T(e){if(t.debug.checkShaderErrors){const n=i.getProgramInfoLog(y).trim(),r=i.getShaderInfoLog(M).trim(),s=i.getShaderInfoLog(E).trim();let o=!0,a=!0;if(!1===i.getProgramParameter(y,i.LINK_STATUS))if(o=!1,"function"==typeof t.debug.onShaderError)t.debug.onShaderError(i,y,M,E);else{const t=zs(i,M,"vertex"),r=zs(i,E,"fragment");console.error("THREE.WebGLProgram: Shader Error "+i.getError()+" - VALIDATE_STATUS "+i.getProgramParameter(y,i.VALIDATE_STATUS)+"\n\nMaterial Name: "+e.name+"\nMaterial Type: "+e.type+"\n\nProgram Info Log: "+n+"\n"+t+"\n"+r)}else""!==n?console.warn("THREE.WebGLProgram: Program Info Log:",n):""!==r&&""!==s||(a=!1);a&&(e.diagnostics={runnable:o,programLog:n,vertexShader:{log:r,prefix:_},fragmentShader:{log:s,prefix:x}})}i.deleteShader(M),i.deleteShader(E),A=new Us(i,y),C=function(t,e){const n={},r=t.getProgramParameter(e,t.ACTIVE_ATTRIBUTES);for(let i=0;i<r;i++){const r=t.getActiveAttrib(e,i),s=r.name;let o=1;r.type===t.FLOAT_MAT2&&(o=2),r.type===t.FLOAT_MAT3&&(o=3),r.type===t.FLOAT_MAT4&&(o=4),n[s]={type:r.type,location:t.getAttribLocation(e,s),locationSize:o}}return n}(i,y)}let A,C;i.attachShader(y,M),i.attachShader(y,E),void 0!==n.index0AttributeName?i.bindAttribLocation(y,0,n.index0AttributeName):!0===n.morphTargets&&i.bindAttribLocation(y,0,"position"),i.linkProgram(y),this.getUniforms=function(){return void 0===A&&T(this),A},this.getAttributes=function(){return void 0===C&&T(this),C};let R=!1===n.rendererExtensionParallelShaderCompile;return this.isReady=function(){return!1===R&&(R=i.getProgramParameter(y,37297)),R},this.destroy=function(){r.releaseStatesOfProgram(this),i.deleteProgram(y),this.program=void 0},this.type=n.shaderType,this.name=n.shaderName,this.id=Bs++,this.cacheKey=e,this.usedTimes=1,this.program=y,this.vertexShader=M,this.fragmentShader=E,this}let ro=0;class io{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(t){const e=t.vertexShader,n=t.fragmentShader,r=this._getShaderStage(e),i=this._getShaderStage(n),s=this._getShaderCacheForMaterial(t);return!1===s.has(r)&&(s.add(r),r.usedTimes++),!1===s.has(i)&&(s.add(i),i.usedTimes++),this}remove(t){const e=this.materialCache.get(t);for(const t of e)t.usedTimes--,0===t.usedTimes&&this.shaderCache.delete(t.code);return this.materialCache.delete(t),this}getVertexShaderID(t){return this._getShaderStage(t.vertexShader).id}getFragmentShaderID(t){return this._getShaderStage(t.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(t){const e=this.materialCache;let n=e.get(t);return void 0===n&&(n=new Set,e.set(t,n)),n}_getShaderStage(t){const e=this.shaderCache;let n=e.get(t);return void 0===n&&(n=new so(t),e.set(t,n)),n}}class so{constructor(t){this.id=ro++,this.code=t,this.usedTimes=0}}function oo(t,e,n,r,i,s,o){const a=new cn,l=new io,u=new Set,c=[],h=i.logarithmicDepthBuffer,d=i.vertexTextures;let p=i.precision;const m={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function g(t){return u.add(t),0===t?"uv":`uv${t}`}return{getParameters:function(s,a,c,v,y){const _=v.fog,x=y.geometry,b=s.isMeshStandardMaterial?v.environment:null,w=(s.isMeshStandardMaterial?n:e).get(s.envMap||b),S=w&&w.mapping===f?w.image.height:null,M=m[s.type];null!==s.precision&&(p=i.getMaxPrecision(s.precision),p!==s.precision&&console.warn("THREE.WebGLProgram.getParameters:",s.precision,"not supported, using",p,"instead."));const E=x.morphAttributes.position||x.morphAttributes.normal||x.morphAttributes.color,T=void 0!==E?E.length:0;let A,C,R,N,P=0;if(void 0!==x.morphAttributes.position&&(P=1),void 0!==x.morphAttributes.normal&&(P=2),void 0!==x.morphAttributes.color&&(P=3),M){const t=Yr[M];A=t.vertexShader,C=t.fragmentShader}else A=s.vertexShader,C=s.fragmentShader,l.update(s),R=l.getVertexShaderID(s),N=l.getFragmentShaderID(s);const I=t.getRenderTarget(),O=t.state.buffers.depth.getReversed(),D=!0===y.isInstancedMesh,L=!0===y.isBatchedMesh,U=!!s.map,k=!!s.matcap,B=!!w,F=!!s.aoMap,z=!!s.lightMap,V=!!s.bumpMap,G=!!s.normalMap,j=!!s.displacementMap,H=!!s.emissiveMap,W=!!s.metalnessMap,q=!!s.roughnessMap,X=s.anisotropy>0,Z=s.clearcoat>0,$=s.dispersion>0,Y=s.iridescence>0,K=s.sheen>0,J=s.transmission>0,Q=X&&!!s.anisotropyMap,tt=Z&&!!s.clearcoatMap,et=Z&&!!s.clearcoatNormalMap,nt=Z&&!!s.clearcoatRoughnessMap,rt=Y&&!!s.iridescenceMap,it=Y&&!!s.iridescenceThicknessMap,st=K&&!!s.sheenColorMap,ot=K&&!!s.sheenRoughnessMap,at=!!s.specularMap,lt=!!s.specularColorMap,ut=!!s.specularIntensityMap,ct=J&&!!s.transmissionMap,ht=J&&!!s.thicknessMap,dt=!!s.gradientMap,pt=!!s.alphaMap,ft=s.alphaTest>0,mt=!!s.alphaHash,gt=!!s.extensions;let vt=0;s.toneMapped&&(null!==I&&!0!==I.isXRRenderTarget||(vt=t.toneMapping));const yt={shaderID:M,shaderType:s.type,shaderName:s.name,vertexShader:A,fragmentShader:C,defines:s.defines,customVertexShaderID:R,customFragmentShaderID:N,isRawShaderMaterial:!0===s.isRawShaderMaterial,glslVersion:s.glslVersion,precision:p,batching:L,batchingColor:L&&null!==y._colorsTexture,instancing:D,instancingColor:D&&null!==y.instanceColor,instancingMorph:D&&null!==y.morphTexture,supportsVertexTextures:d,outputColorSpace:null===I?t.outputColorSpace:!0===I.isXRRenderTarget?I.texture.colorSpace:At,alphaToCoverage:!!s.alphaToCoverage,map:U,matcap:k,envMap:B,envMapMode:B&&w.mapping,envMapCubeUVHeight:S,aoMap:F,lightMap:z,bumpMap:V,normalMap:G,displacementMap:d&&j,emissiveMap:H,normalMapObjectSpace:G&&1===s.normalMapType,normalMapTangentSpace:G&&0===s.normalMapType,metalnessMap:W,roughnessMap:q,anisotropy:X,anisotropyMap:Q,clearcoat:Z,clearcoatMap:tt,clearcoatNormalMap:et,clearcoatRoughnessMap:nt,dispersion:$,iridescence:Y,iridescenceMap:rt,iridescenceThicknessMap:it,sheen:K,sheenColorMap:st,sheenRoughnessMap:ot,specularMap:at,specularColorMap:lt,specularIntensityMap:ut,transmission:J,transmissionMap:ct,thicknessMap:ht,gradientMap:dt,opaque:!1===s.transparent&&1===s.blending&&!1===s.alphaToCoverage,alphaMap:pt,alphaTest:ft,alphaHash:mt,combine:s.combine,mapUv:U&&g(s.map.channel),aoMapUv:F&&g(s.aoMap.channel),lightMapUv:z&&g(s.lightMap.channel),bumpMapUv:V&&g(s.bumpMap.channel),normalMapUv:G&&g(s.normalMap.channel),displacementMapUv:j&&g(s.displacementMap.channel),emissiveMapUv:H&&g(s.emissiveMap.channel),metalnessMapUv:W&&g(s.metalnessMap.channel),roughnessMapUv:q&&g(s.roughnessMap.channel),anisotropyMapUv:Q&&g(s.anisotropyMap.channel),clearcoatMapUv:tt&&g(s.clearcoatMap.channel),clearcoatNormalMapUv:et&&g(s.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:nt&&g(s.clearcoatRoughnessMap.channel),iridescenceMapUv:rt&&g(s.iridescenceMap.channel),iridescenceThicknessMapUv:it&&g(s.iridescenceThicknessMap.channel),sheenColorMapUv:st&&g(s.sheenColorMap.channel),sheenRoughnessMapUv:ot&&g(s.sheenRoughnessMap.channel),specularMapUv:at&&g(s.specularMap.channel),specularColorMapUv:lt&&g(s.specularColorMap.channel),specularIntensityMapUv:ut&&g(s.specularIntensityMap.channel),transmissionMapUv:ct&&g(s.transmissionMap.channel),thicknessMapUv:ht&&g(s.thicknessMap.channel),alphaMapUv:pt&&g(s.alphaMap.channel),vertexTangents:!!x.attributes.tangent&&(G||X),vertexColors:s.vertexColors,vertexAlphas:!0===s.vertexColors&&!!x.attributes.color&&4===x.attributes.color.itemSize,pointsUvs:!0===y.isPoints&&!!x.attributes.uv&&(U||pt),fog:!!_,useFog:!0===s.fog,fogExp2:!!_&&_.isFogExp2,flatShading:!0===s.flatShading,sizeAttenuation:!0===s.sizeAttenuation,logarithmicDepthBuffer:h,reverseDepthBuffer:O,skinning:!0===y.isSkinnedMesh,morphTargets:void 0!==x.morphAttributes.position,morphNormals:void 0!==x.morphAttributes.normal,morphColors:void 0!==x.morphAttributes.color,morphTargetsCount:T,morphTextureStride:P,numDirLights:a.directional.length,numPointLights:a.point.length,numSpotLights:a.spot.length,numSpotLightMaps:a.spotLightMap.length,numRectAreaLights:a.rectArea.length,numHemiLights:a.hemi.length,numDirLightShadows:a.directionalShadowMap.length,numPointLightShadows:a.pointShadowMap.length,numSpotLightShadows:a.spotShadowMap.length,numSpotLightShadowsWithMaps:a.numSpotLightShadowsWithMaps,numLightProbes:a.numLightProbes,numClippingPlanes:o.numPlanes,numClipIntersection:o.numIntersection,dithering:s.dithering,shadowMapEnabled:t.shadowMap.enabled&&c.length>0,shadowMapType:t.shadowMap.type,toneMapping:vt,decodeVideoTexture:U&&!0===s.map.isVideoTexture&&ee.getTransfer(s.map.colorSpace)===Rt,decodeVideoTextureEmissive:H&&!0===s.emissiveMap.isVideoTexture&&ee.getTransfer(s.emissiveMap.colorSpace)===Rt,premultipliedAlpha:s.premultipliedAlpha,doubleSided:2===s.side,flipSided:1===s.side,useDepthPacking:s.depthPacking>=0,depthPacking:s.depthPacking||0,index0AttributeName:s.index0AttributeName,extensionClipCullDistance:gt&&!0===s.extensions.clipCullDistance&&r.has("WEBGL_clip_cull_distance"),extensionMultiDraw:(gt&&!0===s.extensions.multiDraw||L)&&r.has("WEBGL_multi_draw"),rendererExtensionParallelShaderCompile:r.has("KHR_parallel_shader_compile"),customProgramCacheKey:s.customProgramCacheKey()};return yt.vertexUv1s=u.has(1),yt.vertexUv2s=u.has(2),yt.vertexUv3s=u.has(3),u.clear(),yt},getProgramCacheKey:function(e){const n=[];if(e.shaderID?n.push(e.shaderID):(n.push(e.customVertexShaderID),n.push(e.customFragmentShaderID)),void 0!==e.defines)for(const t in e.defines)n.push(t),n.push(e.defines[t]);return!1===e.isRawShaderMaterial&&(!function(t,e){t.push(e.precision),t.push(e.outputColorSpace),t.push(e.envMapMode),t.push(e.envMapCubeUVHeight),t.push(e.mapUv),t.push(e.alphaMapUv),t.push(e.lightMapUv),t.push(e.aoMapUv),t.push(e.bumpMapUv),t.push(e.normalMapUv),t.push(e.displacementMapUv),t.push(e.emissiveMapUv),t.push(e.metalnessMapUv),t.push(e.roughnessMapUv),t.push(e.anisotropyMapUv),t.push(e.clearcoatMapUv),t.push(e.clearcoatNormalMapUv),t.push(e.clearcoatRoughnessMapUv),t.push(e.iridescenceMapUv),t.push(e.iridescenceThicknessMapUv),t.push(e.sheenColorMapUv),t.push(e.sheenRoughnessMapUv),t.push(e.specularMapUv),t.push(e.specularColorMapUv),t.push(e.specularIntensityMapUv),t.push(e.transmissionMapUv),t.push(e.thicknessMapUv),t.push(e.combine),t.push(e.fogExp2),t.push(e.sizeAttenuation),t.push(e.morphTargetsCount),t.push(e.morphAttributeCount),t.push(e.numDirLights),t.push(e.numPointLights),t.push(e.numSpotLights),t.push(e.numSpotLightMaps),t.push(e.numHemiLights),t.push(e.numRectAreaLights),t.push(e.numDirLightShadows),t.push(e.numPointLightShadows),t.push(e.numSpotLightShadows),t.push(e.numSpotLightShadowsWithMaps),t.push(e.numLightProbes),t.push(e.shadowMapType),t.push(e.toneMapping),t.push(e.numClippingPlanes),t.push(e.numClipIntersection),t.push(e.depthPacking)}(n,e),function(t,e){a.disableAll(),e.supportsVertexTextures&&a.enable(0);e.instancing&&a.enable(1);e.instancingColor&&a.enable(2);e.instancingMorph&&a.enable(3);e.matcap&&a.enable(4);e.envMap&&a.enable(5);e.normalMapObjectSpace&&a.enable(6);e.normalMapTangentSpace&&a.enable(7);e.clearcoat&&a.enable(8);e.iridescence&&a.enable(9);e.alphaTest&&a.enable(10);e.vertexColors&&a.enable(11);e.vertexAlphas&&a.enable(12);e.vertexUv1s&&a.enable(13);e.vertexUv2s&&a.enable(14);e.vertexUv3s&&a.enable(15);e.vertexTangents&&a.enable(16);e.anisotropy&&a.enable(17);e.alphaHash&&a.enable(18);e.batching&&a.enable(19);e.dispersion&&a.enable(20);e.batchingColor&&a.enable(21);t.push(a.mask),a.disableAll(),e.fog&&a.enable(0);e.useFog&&a.enable(1);e.flatShading&&a.enable(2);e.logarithmicDepthBuffer&&a.enable(3);e.reverseDepthBuffer&&a.enable(4);e.skinning&&a.enable(5);e.morphTargets&&a.enable(6);e.morphNormals&&a.enable(7);e.morphColors&&a.enable(8);e.premultipliedAlpha&&a.enable(9);e.shadowMapEnabled&&a.enable(10);e.doubleSided&&a.enable(11);e.flipSided&&a.enable(12);e.useDepthPacking&&a.enable(13);e.dithering&&a.enable(14);e.transmission&&a.enable(15);e.sheen&&a.enable(16);e.opaque&&a.enable(17);e.pointsUvs&&a.enable(18);e.decodeVideoTexture&&a.enable(19);e.decodeVideoTextureEmissive&&a.enable(20);e.alphaToCoverage&&a.enable(21);t.push(a.mask)}(n,e),n.push(t.outputColorSpace)),n.push(e.customProgramCacheKey),n.join()},getUniforms:function(t){const e=m[t.type];let n;if(e){const t=Yr[e];n=Ar.clone(t.uniforms)}else n=t.uniforms;return n},acquireProgram:function(e,n){let r;for(let t=0,e=c.length;t<e;t++){const e=c[t];if(e.cacheKey===n){r=e,++r.usedTimes;break}}return void 0===r&&(r=new no(t,n,e,s),c.push(r)),r},releaseProgram:function(t){if(0==--t.usedTimes){const e=c.indexOf(t);c[e]=c[c.length-1],c.pop(),t.destroy()}},releaseShaderCache:function(t){l.remove(t)},programs:c,dispose:function(){l.dispose()}}}function ao(){let t=new WeakMap;return{has:function(e){return t.has(e)},get:function(e){let n=t.get(e);return void 0===n&&(n={},t.set(e,n)),n},remove:function(e){t.delete(e)},update:function(e,n,r){t.get(e)[n]=r},dispose:function(){t=new WeakMap}}}function lo(t,e){return t.groupOrder!==e.groupOrder?t.groupOrder-e.groupOrder:t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.material.id!==e.material.id?t.material.id-e.material.id:t.z!==e.z?t.z-e.z:t.id-e.id}function uo(t,e){return t.groupOrder!==e.groupOrder?t.groupOrder-e.groupOrder:t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.z!==e.z?e.z-t.z:t.id-e.id}function co(){const t=[];let e=0;const n=[],r=[],i=[];function s(n,r,i,s,o,a){let l=t[e];return void 0===l?(l={id:n.id,object:n,geometry:r,material:i,groupOrder:s,renderOrder:n.renderOrder,z:o,group:a},t[e]=l):(l.id=n.id,l.object=n,l.geometry=r,l.material=i,l.groupOrder=s,l.renderOrder=n.renderOrder,l.z=o,l.group=a),e++,l}return{opaque:n,transmissive:r,transparent:i,init:function(){e=0,n.length=0,r.length=0,i.length=0},push:function(t,e,o,a,l,u){const c=s(t,e,o,a,l,u);o.transmission>0?r.push(c):!0===o.transparent?i.push(c):n.push(c)},unshift:function(t,e,o,a,l,u){const c=s(t,e,o,a,l,u);o.transmission>0?r.unshift(c):!0===o.transparent?i.unshift(c):n.unshift(c)},finish:function(){for(let n=e,r=t.length;n<r;n++){const e=t[n];if(null===e.id)break;e.id=null,e.object=null,e.geometry=null,e.material=null,e.group=null}},sort:function(t,e){n.length>1&&n.sort(t||lo),r.length>1&&r.sort(e||uo),i.length>1&&i.sort(e||uo)}}}function ho(){let t=new WeakMap;return{get:function(e,n){const r=t.get(e);let i;return void 0===r?(i=new co,t.set(e,[i])):n>=r.length?(i=new co,r.push(i)):i=r[n],i},dispose:function(){t=new WeakMap}}}function po(){const t={};return{get:function(e){if(void 0!==t[e.id])return t[e.id];let n;switch(e.type){case"DirectionalLight":n={direction:new we,color:new Wn};break;case"SpotLight":n={position:new we,direction:new we,color:new Wn,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":n={position:new we,color:new Wn,distance:0,decay:0};break;case"HemisphereLight":n={direction:new we,skyColor:new Wn,groundColor:new Wn};break;case"RectAreaLight":n={color:new Wn,position:new we,halfWidth:new we,halfHeight:new we}}return t[e.id]=n,n}}}let fo=0;function mo(t,e){return(e.castShadow?2:0)-(t.castShadow?2:0)+(e.map?1:0)-(t.map?1:0)}function go(t){const e=new po,n=function(){const t={};return{get:function(e){if(void 0!==t[e.id])return t[e.id];let n;switch(e.type){case"DirectionalLight":case"SpotLight":n={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Xt};break;case"PointLight":n={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Xt,shadowCameraNear:1,shadowCameraFar:1e3}}return t[e.id]=n,n}}}(),r={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1,numLightProbes:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0,numLightProbes:0};for(let t=0;t<9;t++)r.probe.push(new we);const i=new we,s=new Je,o=new Je;return{setup:function(i){let s=0,o=0,a=0;for(let t=0;t<9;t++)r.probe[t].set(0,0,0);let l=0,u=0,c=0,h=0,d=0,p=0,f=0,m=0,g=0,v=0,y=0;i.sort(mo);for(let t=0,_=i.length;t<_;t++){const _=i[t],x=_.color,b=_.intensity,w=_.distance,S=_.shadow&&_.shadow.map?_.shadow.map.texture:null;if(_.isAmbientLight)s+=x.r*b,o+=x.g*b,a+=x.b*b;else if(_.isLightProbe){for(let t=0;t<9;t++)r.probe[t].addScaledVector(_.sh.coefficients[t],b);y++}else if(_.isDirectionalLight){const t=e.get(_);if(t.color.copy(_.color).multiplyScalar(_.intensity),_.castShadow){const t=_.shadow,e=n.get(_);e.shadowIntensity=t.intensity,e.shadowBias=t.bias,e.shadowNormalBias=t.normalBias,e.shadowRadius=t.radius,e.shadowMapSize=t.mapSize,r.directionalShadow[l]=e,r.directionalShadowMap[l]=S,r.directionalShadowMatrix[l]=_.shadow.matrix,p++}r.directional[l]=t,l++}else if(_.isSpotLight){const t=e.get(_);t.position.setFromMatrixPosition(_.matrixWorld),t.color.copy(x).multiplyScalar(b),t.distance=w,t.coneCos=Math.cos(_.angle),t.penumbraCos=Math.cos(_.angle*(1-_.penumbra)),t.decay=_.decay,r.spot[c]=t;const i=_.shadow;if(_.map&&(r.spotLightMap[g]=_.map,g++,i.updateMatrices(_),_.castShadow&&v++),r.spotLightMatrix[c]=i.matrix,_.castShadow){const t=n.get(_);t.shadowIntensity=i.intensity,t.shadowBias=i.bias,t.shadowNormalBias=i.normalBias,t.shadowRadius=i.radius,t.shadowMapSize=i.mapSize,r.spotShadow[c]=t,r.spotShadowMap[c]=S,m++}c++}else if(_.isRectAreaLight){const t=e.get(_);t.color.copy(x).multiplyScalar(b),t.halfWidth.set(.5*_.width,0,0),t.halfHeight.set(0,.5*_.height,0),r.rectArea[h]=t,h++}else if(_.isPointLight){const t=e.get(_);if(t.color.copy(_.color).multiplyScalar(_.intensity),t.distance=_.distance,t.decay=_.decay,_.castShadow){const t=_.shadow,e=n.get(_);e.shadowIntensity=t.intensity,e.shadowBias=t.bias,e.shadowNormalBias=t.normalBias,e.shadowRadius=t.radius,e.shadowMapSize=t.mapSize,e.shadowCameraNear=t.camera.near,e.shadowCameraFar=t.camera.far,r.pointShadow[u]=e,r.pointShadowMap[u]=S,r.pointShadowMatrix[u]=_.shadow.matrix,f++}r.point[u]=t,u++}else if(_.isHemisphereLight){const t=e.get(_);t.skyColor.copy(_.color).multiplyScalar(b),t.groundColor.copy(_.groundColor).multiplyScalar(b),r.hemi[d]=t,d++}}h>0&&(!0===t.has("OES_texture_float_linear")?(r.rectAreaLTC1=$r.LTC_FLOAT_1,r.rectAreaLTC2=$r.LTC_FLOAT_2):(r.rectAreaLTC1=$r.LTC_HALF_1,r.rectAreaLTC2=$r.LTC_HALF_2)),r.ambient[0]=s,r.ambient[1]=o,r.ambient[2]=a;const _=r.hash;_.directionalLength===l&&_.pointLength===u&&_.spotLength===c&&_.rectAreaLength===h&&_.hemiLength===d&&_.numDirectionalShadows===p&&_.numPointShadows===f&&_.numSpotShadows===m&&_.numSpotMaps===g&&_.numLightProbes===y||(r.directional.length=l,r.spot.length=c,r.rectArea.length=h,r.point.length=u,r.hemi.length=d,r.directionalShadow.length=p,r.directionalShadowMap.length=p,r.pointShadow.length=f,r.pointShadowMap.length=f,r.spotShadow.length=m,r.spotShadowMap.length=m,r.directionalShadowMatrix.length=p,r.pointShadowMatrix.length=f,r.spotLightMatrix.length=m+g-v,r.spotLightMap.length=g,r.numSpotLightShadowsWithMaps=v,r.numLightProbes=y,_.directionalLength=l,_.pointLength=u,_.spotLength=c,_.rectAreaLength=h,_.hemiLength=d,_.numDirectionalShadows=p,_.numPointShadows=f,_.numSpotShadows=m,_.numSpotMaps=g,_.numLightProbes=y,r.version=fo++)},setupView:function(t,e){let n=0,a=0,l=0,u=0,c=0;const h=e.matrixWorldInverse;for(let e=0,d=t.length;e<d;e++){const d=t[e];if(d.isDirectionalLight){const t=r.directional[n];t.direction.setFromMatrixPosition(d.matrixWorld),i.setFromMatrixPosition(d.target.matrixWorld),t.direction.sub(i),t.direction.transformDirection(h),n++}else if(d.isSpotLight){const t=r.spot[l];t.position.setFromMatrixPosition(d.matrixWorld),t.position.applyMatrix4(h),t.direction.setFromMatrixPosition(d.matrixWorld),i.setFromMatrixPosition(d.target.matrixWorld),t.direction.sub(i),t.direction.transformDirection(h),l++}else if(d.isRectAreaLight){const t=r.rectArea[u];t.position.setFromMatrixPosition(d.matrixWorld),t.position.applyMatrix4(h),o.identity(),s.copy(d.matrixWorld),s.premultiply(h),o.extractRotation(s),t.halfWidth.set(.5*d.width,0,0),t.halfHeight.set(0,.5*d.height,0),t.halfWidth.applyMatrix4(o),t.halfHeight.applyMatrix4(o),u++}else if(d.isPointLight){const t=r.point[a];t.position.setFromMatrixPosition(d.matrixWorld),t.position.applyMatrix4(h),a++}else if(d.isHemisphereLight){const t=r.hemi[c];t.direction.setFromMatrixPosition(d.matrixWorld),t.direction.transformDirection(h),c++}}},state:r}}function vo(t){const e=new go(t),n=[],r=[];const i={lightsArray:n,shadowsArray:r,camera:null,lights:e,transmissionRenderTarget:{}};return{init:function(t){i.camera=t,n.length=0,r.length=0},state:i,setupLights:function(){e.setup(n)},setupLightsView:function(t){e.setupView(n,t)},pushLight:function(t){n.push(t)},pushShadow:function(t){r.push(t)}}}function yo(t){let e=new WeakMap;return{get:function(n,r=0){const i=e.get(n);let s;return void 0===i?(s=new vo(t),e.set(n,[s])):r>=i.length?(s=new vo(t),i.push(s)):s=i[r],s},dispose:function(){e=new WeakMap}}}class _o extends Zn{static get type(){return"MeshDepthMaterial"}constructor(t){super(),this.isMeshDepthMaterial=!0,this.depthPacking=3200,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(t)}copy(t){return super.copy(t),this.depthPacking=t.depthPacking,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this}}class xo extends Zn{static get type(){return"MeshDistanceMaterial"}constructor(t){super(),this.isMeshDistanceMaterial=!0,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(t)}copy(t){return super.copy(t),this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this}}function bo(t,e,n){let r=new Hr;const i=new Xt,s=new Xt,o=new ge,a=new _o({depthPacking:3201}),l=new xo,u={},c=n.maxTextureSize,h={0:1,1:0,2:2},d=new Cr({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new Xt},radius:{value:4}},vertexShader:"void main() {\n\tgl_Position = vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n#include <packing>\nvoid main() {\n\tconst float samples = float( VSM_SAMPLES );\n\tfloat mean = 0.0;\n\tfloat squared_mean = 0.0;\n\tfloat uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );\n\tfloat uvStart = samples <= 1.0 ? 0.0 : - 1.0;\n\tfor ( float i = 0.0; i < samples; i ++ ) {\n\t\tfloat uvOffset = uvStart + i * uvStride;\n\t\t#ifdef HORIZONTAL_PASS\n\t\t\tvec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );\n\t\t\tmean += distribution.x;\n\t\t\tsquared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n\t\t#else\n\t\t\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );\n\t\t\tmean += depth;\n\t\t\tsquared_mean += depth * depth;\n\t\t#endif\n\t}\n\tmean = mean / samples;\n\tsquared_mean = squared_mean / samples;\n\tfloat std_dev = sqrt( squared_mean - mean * mean );\n\tgl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n}"}),p=d.clone();p.defines.HORIZONTAL_PASS=1;const f=new ur;f.setAttribute("position",new Jn(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const m=new br(f,d),g=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=1;let v=this.type;function _(n,r){const s=e.update(m);d.defines.VSM_SAMPLES!==n.blurSamples&&(d.defines.VSM_SAMPLES=n.blurSamples,p.defines.VSM_SAMPLES=n.blurSamples,d.needsUpdate=!0,p.needsUpdate=!0),null===n.mapPass&&(n.mapPass=new ye(i.x,i.y)),d.uniforms.shadow_pass.value=n.map.texture,d.uniforms.resolution.value=n.mapSize,d.uniforms.radius.value=n.radius,t.setRenderTarget(n.mapPass),t.clear(),t.renderBufferDirect(r,null,s,d,m,null),p.uniforms.shadow_pass.value=n.mapPass.texture,p.uniforms.resolution.value=n.mapSize,p.uniforms.radius.value=n.radius,t.setRenderTarget(n.map),t.clear(),t.renderBufferDirect(r,null,s,p,m,null)}function x(e,n,r,i){let s=null;const o=!0===r.isPointLight?e.customDistanceMaterial:e.customDepthMaterial;if(void 0!==o)s=o;else if(s=!0===r.isPointLight?l:a,t.localClippingEnabled&&!0===n.clipShadows&&Array.isArray(n.clippingPlanes)&&0!==n.clippingPlanes.length||n.displacementMap&&0!==n.displacementScale||n.alphaMap&&n.alphaTest>0||n.map&&n.alphaTest>0){const t=s.uuid,e=n.uuid;let r=u[t];void 0===r&&(r={},u[t]=r);let i=r[e];void 0===i&&(i=s.clone(),r[e]=i,n.addEventListener("dispose",w)),s=i}if(s.visible=n.visible,s.wireframe=n.wireframe,s.side=3===i?null!==n.shadowSide?n.shadowSide:n.side:null!==n.shadowSide?n.shadowSide:h[n.side],s.alphaMap=n.alphaMap,s.alphaTest=n.alphaTest,s.map=n.map,s.clipShadows=n.clipShadows,s.clippingPlanes=n.clippingPlanes,s.clipIntersection=n.clipIntersection,s.displacementMap=n.displacementMap,s.displacementScale=n.displacementScale,s.displacementBias=n.displacementBias,s.wireframeLinewidth=n.wireframeLinewidth,s.linewidth=n.linewidth,!0===r.isPointLight&&!0===s.isMeshDistanceMaterial){t.properties.get(s).light=r}return s}function b(n,i,s,o,a){if(!1===n.visible)return;if(n.layers.test(i.layers)&&(n.isMesh||n.isLine||n.isPoints)&&(n.castShadow||n.receiveShadow&&3===a)&&(!n.frustumCulled||r.intersectsObject(n))){n.modelViewMatrix.multiplyMatrices(s.matrixWorldInverse,n.matrixWorld);const r=e.update(n),l=n.material;if(Array.isArray(l)){const e=r.groups;for(let u=0,c=e.length;u<c;u++){const c=e[u],h=l[c.materialIndex];if(h&&h.visible){const e=x(n,h,o,a);n.onBeforeShadow(t,n,i,s,r,e,c),t.renderBufferDirect(s,null,r,e,n,c),n.onAfterShadow(t,n,i,s,r,e,c)}}}else if(l.visible){const e=x(n,l,o,a);n.onBeforeShadow(t,n,i,s,r,e,null),t.renderBufferDirect(s,null,r,e,n,null),n.onAfterShadow(t,n,i,s,r,e,null)}}const l=n.children;for(let t=0,e=l.length;t<e;t++)b(l[t],i,s,o,a)}function w(t){t.target.removeEventListener("dispose",w);for(const e in u){const n=u[e],r=t.target.uuid;if(r in n){n[r].dispose(),delete n[r]}}}this.render=function(e,n,a){if(!1===g.enabled)return;if(!1===g.autoUpdate&&!1===g.needsUpdate)return;if(0===e.length)return;const l=t.getRenderTarget(),u=t.getActiveCubeFace(),h=t.getActiveMipmapLevel(),d=t.state;d.setBlending(0),d.buffers.color.setClear(1,1,1,1),d.buffers.depth.setTest(!0),d.setScissorTest(!1);const p=3!==v&&3===this.type,f=3===v&&3!==this.type;for(let l=0,u=e.length;l<u;l++){const u=e[l],h=u.shadow;if(void 0===h){console.warn("THREE.WebGLShadowMap:",u,"has no shadow.");continue}if(!1===h.autoUpdate&&!1===h.needsUpdate)continue;i.copy(h.mapSize);const m=h.getFrameExtents();if(i.multiply(m),s.copy(h.mapSize),(i.x>c||i.y>c)&&(i.x>c&&(s.x=Math.floor(c/m.x),i.x=s.x*m.x,h.mapSize.x=s.x),i.y>c&&(s.y=Math.floor(c/m.y),i.y=s.y*m.y,h.mapSize.y=s.y)),null===h.map||!0===p||!0===f){const t=3!==this.type?{minFilter:y,magFilter:y}:{};null!==h.map&&h.map.dispose(),h.map=new ye(i.x,i.y,t),h.map.texture.name=u.name+".shadowMap",h.camera.updateProjectionMatrix()}t.setRenderTarget(h.map),t.clear();const g=h.getViewportCount();for(let t=0;t<g;t++){const e=h.getViewport(t);o.set(s.x*e.x,s.y*e.y,s.x*e.z,s.y*e.w),d.viewport(o),h.updateMatrices(u,t),r=h.getFrustum(),b(n,a,h.camera,u,this.type)}!0!==h.isPointLightShadow&&3===this.type&&_(h,a),h.needsUpdate=!1}v=this.type,g.needsUpdate=!1,t.setRenderTarget(l,u,h)}}const wo={0:1,2:6,4:7,3:5,1:0,6:2,7:4,5:3};function So(t,e){const n=new function(){let e=!1;const n=new ge;let r=null;const i=new ge(0,0,0,0);return{setMask:function(n){r===n||e||(t.colorMask(n,n,n,n),r=n)},setLocked:function(t){e=t},setClear:function(e,r,s,o,a){!0===a&&(e*=o,r*=o,s*=o),n.set(e,r,s,o),!1===i.equals(n)&&(t.clearColor(e,r,s,o),i.copy(n))},reset:function(){e=!1,r=null,i.set(-1,0,0,0)}}},r=new function(){let n=!1,r=!1,i=null,s=null,o=null;return{setReversed:function(t){if(r!==t){const t=e.get("EXT_clip_control");r?t.clipControlEXT(t.LOWER_LEFT_EXT,t.ZERO_TO_ONE_EXT):t.clipControlEXT(t.LOWER_LEFT_EXT,t.NEGATIVE_ONE_TO_ONE_EXT);const n=o;o=null,this.setClear(n)}r=t},getReversed:function(){return r},setTest:function(e){e?V(t.DEPTH_TEST):G(t.DEPTH_TEST)},setMask:function(e){i===e||n||(t.depthMask(e),i=e)},setFunc:function(e){if(r&&(e=wo[e]),s!==e){switch(e){case 0:t.depthFunc(t.NEVER);break;case 1:t.depthFunc(t.ALWAYS);break;case 2:t.depthFunc(t.LESS);break;case 3:default:t.depthFunc(t.LEQUAL);break;case 4:t.depthFunc(t.EQUAL);break;case 5:t.depthFunc(t.GEQUAL);break;case 6:t.depthFunc(t.GREATER);break;case 7:t.depthFunc(t.NOTEQUAL)}s=e}},setLocked:function(t){n=t},setClear:function(e){o!==e&&(r&&(e=1-e),t.clearDepth(e),o=e)},reset:function(){n=!1,i=null,s=null,o=null,r=!1}}},i=new function(){let e=!1,n=null,r=null,i=null,s=null,o=null,a=null,l=null,u=null;return{setTest:function(n){e||(n?V(t.STENCIL_TEST):G(t.STENCIL_TEST))},setMask:function(r){n===r||e||(t.stencilMask(r),n=r)},setFunc:function(e,n,o){r===e&&i===n&&s===o||(t.stencilFunc(e,n,o),r=e,i=n,s=o)},setOp:function(e,n,r){o===e&&a===n&&l===r||(t.stencilOp(e,n,r),o=e,a=n,l=r)},setLocked:function(t){e=t},setClear:function(e){u!==e&&(t.clearStencil(e),u=e)},reset:function(){e=!1,n=null,r=null,i=null,s=null,o=null,a=null,l=null,u=null}}},s=new WeakMap,o=new WeakMap;let a={},l={},c=new WeakMap,h=[],d=null,p=!1,f=null,m=null,g=null,v=null,y=null,_=null,x=null,b=new Wn(0,0,0),w=0,S=!1,M=null,E=null,T=null,A=null,C=null;const R=t.getParameter(t.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let N=!1,P=0;const I=t.getParameter(t.VERSION);-1!==I.indexOf("WebGL")?(P=parseFloat(/^WebGL (\d)/.exec(I)[1]),N=P>=1):-1!==I.indexOf("OpenGL ES")&&(P=parseFloat(/^OpenGL ES (\d)/.exec(I)[1]),N=P>=2);let O=null,D={};const L=t.getParameter(t.SCISSOR_BOX),U=t.getParameter(t.VIEWPORT),k=(new ge).fromArray(L),B=(new ge).fromArray(U);function F(e,n,r,i){const s=new Uint8Array(4),o=t.createTexture();t.bindTexture(e,o),t.texParameteri(e,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(e,t.TEXTURE_MAG_FILTER,t.NEAREST);for(let o=0;o<r;o++)e===t.TEXTURE_3D||e===t.TEXTURE_2D_ARRAY?t.texImage3D(n,0,t.RGBA,1,1,i,0,t.RGBA,t.UNSIGNED_BYTE,s):t.texImage2D(n+o,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,s);return o}const z={};function V(e){!0!==a[e]&&(t.enable(e),a[e]=!0)}function G(e){!1!==a[e]&&(t.disable(e),a[e]=!1)}z[t.TEXTURE_2D]=F(t.TEXTURE_2D,t.TEXTURE_2D,1),z[t.TEXTURE_CUBE_MAP]=F(t.TEXTURE_CUBE_MAP,t.TEXTURE_CUBE_MAP_POSITIVE_X,6),z[t.TEXTURE_2D_ARRAY]=F(t.TEXTURE_2D_ARRAY,t.TEXTURE_2D_ARRAY,1,1),z[t.TEXTURE_3D]=F(t.TEXTURE_3D,t.TEXTURE_3D,1,1),n.setClear(0,0,0,1),r.setClear(1),i.setClear(0),V(t.DEPTH_TEST),r.setFunc(3),q(!1),X(1),V(t.CULL_FACE),W(0);const j={[u]:t.FUNC_ADD,101:t.FUNC_SUBTRACT,102:t.FUNC_REVERSE_SUBTRACT};j[103]=t.MIN,j[104]=t.MAX;const H={200:t.ZERO,201:t.ONE,202:t.SRC_COLOR,204:t.SRC_ALPHA,210:t.SRC_ALPHA_SATURATE,208:t.DST_COLOR,206:t.DST_ALPHA,203:t.ONE_MINUS_SRC_COLOR,205:t.ONE_MINUS_SRC_ALPHA,209:t.ONE_MINUS_DST_COLOR,207:t.ONE_MINUS_DST_ALPHA,211:t.CONSTANT_COLOR,212:t.ONE_MINUS_CONSTANT_COLOR,213:t.CONSTANT_ALPHA,214:t.ONE_MINUS_CONSTANT_ALPHA};function W(e,n,r,i,s,o,a,l,c,h){if(0!==e){if(!1===p&&(V(t.BLEND),p=!0),5===e)s=s||n,o=o||r,a=a||i,n===m&&s===y||(t.blendEquationSeparate(j[n],j[s]),m=n,y=s),r===g&&i===v&&o===_&&a===x||(t.blendFuncSeparate(H[r],H[i],H[o],H[a]),g=r,v=i,_=o,x=a),!1!==l.equals(b)&&c===w||(t.blendColor(l.r,l.g,l.b,c),b.copy(l),w=c),f=e,S=!1;else if(e!==f||h!==S){if(m===u&&y===u||(t.blendEquation(t.FUNC_ADD),m=u,y=u),h)switch(e){case 1:t.blendFuncSeparate(t.ONE,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA);break;case 2:t.blendFunc(t.ONE,t.ONE);break;case 3:t.blendFuncSeparate(t.ZERO,t.ONE_MINUS_SRC_COLOR,t.ZERO,t.ONE);break;case 4:t.blendFuncSeparate(t.ZERO,t.SRC_COLOR,t.ZERO,t.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",e)}else switch(e){case 1:t.blendFuncSeparate(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA);break;case 2:t.blendFunc(t.SRC_ALPHA,t.ONE);break;case 3:t.blendFuncSeparate(t.ZERO,t.ONE_MINUS_SRC_COLOR,t.ZERO,t.ONE);break;case 4:t.blendFunc(t.ZERO,t.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",e)}g=null,v=null,_=null,x=null,b.set(0,0,0),w=0,f=e,S=h}}else!0===p&&(G(t.BLEND),p=!1)}function q(e){M!==e&&(e?t.frontFace(t.CW):t.frontFace(t.CCW),M=e)}function X(e){0!==e?(V(t.CULL_FACE),e!==E&&(1===e?t.cullFace(t.BACK):2===e?t.cullFace(t.FRONT):t.cullFace(t.FRONT_AND_BACK))):G(t.CULL_FACE),E=e}function Z(e,n,r){e?(V(t.POLYGON_OFFSET_FILL),A===n&&C===r||(t.polygonOffset(n,r),A=n,C=r)):G(t.POLYGON_OFFSET_FILL)}return{buffers:{color:n,depth:r,stencil:i},enable:V,disable:G,bindFramebuffer:function(e,n){return l[e]!==n&&(t.bindFramebuffer(e,n),l[e]=n,e===t.DRAW_FRAMEBUFFER&&(l[t.FRAMEBUFFER]=n),e===t.FRAMEBUFFER&&(l[t.DRAW_FRAMEBUFFER]=n),!0)},drawBuffers:function(e,n){let r=h,i=!1;if(e){r=c.get(n),void 0===r&&(r=[],c.set(n,r));const s=e.textures;if(r.length!==s.length||r[0]!==t.COLOR_ATTACHMENT0){for(let e=0,n=s.length;e<n;e++)r[e]=t.COLOR_ATTACHMENT0+e;r.length=s.length,i=!0}}else r[0]!==t.BACK&&(r[0]=t.BACK,i=!0);i&&t.drawBuffers(r)},useProgram:function(e){return d!==e&&(t.useProgram(e),d=e,!0)},setBlending:W,setMaterial:function(e,s){2===e.side?G(t.CULL_FACE):V(t.CULL_FACE);let o=1===e.side;s&&(o=!o),q(o),1===e.blending&&!1===e.transparent?W(0):W(e.blending,e.blendEquation,e.blendSrc,e.blendDst,e.blendEquationAlpha,e.blendSrcAlpha,e.blendDstAlpha,e.blendColor,e.blendAlpha,e.premultipliedAlpha),r.setFunc(e.depthFunc),r.setTest(e.depthTest),r.setMask(e.depthWrite),n.setMask(e.colorWrite);const a=e.stencilWrite;i.setTest(a),a&&(i.setMask(e.stencilWriteMask),i.setFunc(e.stencilFunc,e.stencilRef,e.stencilFuncMask),i.setOp(e.stencilFail,e.stencilZFail,e.stencilZPass)),Z(e.polygonOffset,e.polygonOffsetFactor,e.polygonOffsetUnits),!0===e.alphaToCoverage?V(t.SAMPLE_ALPHA_TO_COVERAGE):G(t.SAMPLE_ALPHA_TO_COVERAGE)},setFlipSided:q,setCullFace:X,setLineWidth:function(e){e!==T&&(N&&t.lineWidth(e),T=e)},setPolygonOffset:Z,setScissorTest:function(e){e?V(t.SCISSOR_TEST):G(t.SCISSOR_TEST)},activeTexture:function(e){void 0===e&&(e=t.TEXTURE0+R-1),O!==e&&(t.activeTexture(e),O=e)},bindTexture:function(e,n,r){void 0===r&&(r=null===O?t.TEXTURE0+R-1:O);let i=D[r];void 0===i&&(i={type:void 0,texture:void 0},D[r]=i),i.type===e&&i.texture===n||(O!==r&&(t.activeTexture(r),O=r),t.bindTexture(e,n||z[e]),i.type=e,i.texture=n)},unbindTexture:function(){const e=D[O];void 0!==e&&void 0!==e.type&&(t.bindTexture(e.type,null),e.type=void 0,e.texture=void 0)},compressedTexImage2D:function(){try{t.compressedTexImage2D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},compressedTexImage3D:function(){try{t.compressedTexImage3D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texImage2D:function(){try{t.texImage2D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texImage3D:function(){try{t.texImage3D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},updateUBOMapping:function(e,n){let r=o.get(n);void 0===r&&(r=new WeakMap,o.set(n,r));let i=r.get(e);void 0===i&&(i=t.getUniformBlockIndex(n,e.name),r.set(e,i))},uniformBlockBinding:function(e,n){const r=o.get(n).get(e);s.get(n)!==r&&(t.uniformBlockBinding(n,r,e.__bindingPointIndex),s.set(n,r))},texStorage2D:function(){try{t.texStorage2D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texStorage3D:function(){try{t.texStorage3D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texSubImage2D:function(){try{t.texSubImage2D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texSubImage3D:function(){try{t.texSubImage3D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},compressedTexSubImage2D:function(){try{t.compressedTexSubImage2D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},compressedTexSubImage3D:function(){try{t.compressedTexSubImage3D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},scissor:function(e){!1===k.equals(e)&&(t.scissor(e.x,e.y,e.z,e.w),k.copy(e))},viewport:function(e){!1===B.equals(e)&&(t.viewport(e.x,e.y,e.z,e.w),B.copy(e))},reset:function(){t.disable(t.BLEND),t.disable(t.CULL_FACE),t.disable(t.DEPTH_TEST),t.disable(t.POLYGON_OFFSET_FILL),t.disable(t.SCISSOR_TEST),t.disable(t.STENCIL_TEST),t.disable(t.SAMPLE_ALPHA_TO_COVERAGE),t.blendEquation(t.FUNC_ADD),t.blendFunc(t.ONE,t.ZERO),t.blendFuncSeparate(t.ONE,t.ZERO,t.ONE,t.ZERO),t.blendColor(0,0,0,0),t.colorMask(!0,!0,!0,!0),t.clearColor(0,0,0,0),t.depthMask(!0),t.depthFunc(t.LESS),r.setReversed(!1),t.clearDepth(1),t.stencilMask(4294967295),t.stencilFunc(t.ALWAYS,0,4294967295),t.stencilOp(t.KEEP,t.KEEP,t.KEEP),t.clearStencil(0),t.cullFace(t.BACK),t.frontFace(t.CCW),t.polygonOffset(0,0),t.activeTexture(t.TEXTURE0),t.bindFramebuffer(t.FRAMEBUFFER,null),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,null),t.bindFramebuffer(t.READ_FRAMEBUFFER,null),t.useProgram(null),t.lineWidth(1),t.scissor(0,0,t.canvas.width,t.canvas.height),t.viewport(0,0,t.canvas.width,t.canvas.height),a={},O=null,D={},l={},c=new WeakMap,h=[],d=null,p=!1,f=null,m=null,g=null,v=null,y=null,_=null,x=null,b=new Wn(0,0,0),w=0,S=!1,M=null,E=null,T=null,A=null,C=null,k.set(0,0,t.canvas.width,t.canvas.height),B.set(0,0,t.canvas.width,t.canvas.height),n.reset(),r.reset(),i.reset()}}}function Mo(t,e,n,r){const i=function(t){switch(t){case S:case M:return{byteLength:1,components:1};case T:case E:case N:return{byteLength:2,components:1};case P:case I:return{byteLength:2,components:4};case C:case A:case R:return{byteLength:4,components:1};case D:return{byteLength:4,components:3}}throw new Error(`Unknown texture type ${t}.`)}(r);switch(n){case 1021:case 1024:return t*e;case 1025:return t*e*2;case B:case F:return t*e/i.components*i.byteLength;case 1030:case z:return t*e*2/i.components*i.byteLength;case 1022:return t*e*3/i.components*i.byteLength;case L:case V:return t*e*4/i.components*i.byteLength;case G:case j:return Math.floor((t+3)/4)*Math.floor((e+3)/4)*8;case H:case W:return Math.floor((t+3)/4)*Math.floor((e+3)/4)*16;case X:case $:return Math.max(t,16)*Math.max(e,8)/4;case q:case Z:return Math.max(t,8)*Math.max(e,8)/2;case Y:case K:return Math.floor((t+3)/4)*Math.floor((e+3)/4)*8;case J:case Q:return Math.floor((t+3)/4)*Math.floor((e+3)/4)*16;case tt:return Math.floor((t+4)/5)*Math.floor((e+3)/4)*16;case et:return Math.floor((t+4)/5)*Math.floor((e+4)/5)*16;case nt:return Math.floor((t+5)/6)*Math.floor((e+4)/5)*16;case rt:return Math.floor((t+5)/6)*Math.floor((e+5)/6)*16;case it:return Math.floor((t+7)/8)*Math.floor((e+4)/5)*16;case st:return Math.floor((t+7)/8)*Math.floor((e+5)/6)*16;case ot:return Math.floor((t+7)/8)*Math.floor((e+7)/8)*16;case at:return Math.floor((t+9)/10)*Math.floor((e+4)/5)*16;case lt:return Math.floor((t+9)/10)*Math.floor((e+5)/6)*16;case ut:return Math.floor((t+9)/10)*Math.floor((e+7)/8)*16;case ct:return Math.floor((t+9)/10)*Math.floor((e+9)/10)*16;case ht:return Math.floor((t+11)/12)*Math.floor((e+9)/10)*16;case dt:return Math.floor((t+11)/12)*Math.floor((e+11)/12)*16;case pt:case ft:case mt:return Math.ceil(t/4)*Math.ceil(e/4)*16;case 36283:case gt:return Math.ceil(t/4)*Math.ceil(e/4)*8;case vt:case yt:return Math.ceil(t/4)*Math.ceil(e/4)*16}throw new Error(`Unable to determine texture byte length for ${n} format.`)}function Eo(t,e,n,r,i,s,o){const a=e.has("WEBGL_multisampled_render_to_texture")?e.get("WEBGL_multisampled_render_to_texture"):null,l="undefined"!=typeof navigator&&/OculusBrowser/g.test(navigator.userAgent),u=new Xt,c=new WeakMap;let h;const d=new WeakMap;let p=!1;try{p="undefined"!=typeof OffscreenCanvas&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch(t){}function f(t,e){return p?new OffscreenCanvas(t,e):Kt("canvas")}function M(t,e,n){let r=1;const i=rt(t);if((i.width>n||i.height>n)&&(r=n/Math.max(i.width,i.height)),r<1){if("undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap||"undefined"!=typeof VideoFrame&&t instanceof VideoFrame){const n=Math.floor(r*i.width),s=Math.floor(r*i.height);void 0===h&&(h=f(n,s));const o=e?f(n,s):h;o.width=n,o.height=s;return o.getContext("2d").drawImage(t,0,0,n,s),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+i.width+"x"+i.height+") to ("+n+"x"+s+")."),o}return"data"in t&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+i.width+"x"+i.height+")."),t}return t}function E(t){return t.generateMipmaps}function A(e){t.generateMipmap(e)}function N(e){return e.isWebGLCubeRenderTarget?t.TEXTURE_CUBE_MAP:e.isWebGL3DRenderTarget?t.TEXTURE_3D:e.isWebGLArrayRenderTarget||e.isCompressedArrayTexture?t.TEXTURE_2D_ARRAY:t.TEXTURE_2D}function P(n,r,i,s,o=!1){if(null!==n){if(void 0!==t[n])return t[n];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+n+"'")}let a=r;if(r===t.RED&&(i===t.FLOAT&&(a=t.R32F),i===t.HALF_FLOAT&&(a=t.R16F),i===t.UNSIGNED_BYTE&&(a=t.R8)),r===t.RED_INTEGER&&(i===t.UNSIGNED_BYTE&&(a=t.R8UI),i===t.UNSIGNED_SHORT&&(a=t.R16UI),i===t.UNSIGNED_INT&&(a=t.R32UI),i===t.BYTE&&(a=t.R8I),i===t.SHORT&&(a=t.R16I),i===t.INT&&(a=t.R32I)),r===t.RG&&(i===t.FLOAT&&(a=t.RG32F),i===t.HALF_FLOAT&&(a=t.RG16F),i===t.UNSIGNED_BYTE&&(a=t.RG8)),r===t.RG_INTEGER&&(i===t.UNSIGNED_BYTE&&(a=t.RG8UI),i===t.UNSIGNED_SHORT&&(a=t.RG16UI),i===t.UNSIGNED_INT&&(a=t.RG32UI),i===t.BYTE&&(a=t.RG8I),i===t.SHORT&&(a=t.RG16I),i===t.INT&&(a=t.RG32I)),r===t.RGB_INTEGER&&(i===t.UNSIGNED_BYTE&&(a=t.RGB8UI),i===t.UNSIGNED_SHORT&&(a=t.RGB16UI),i===t.UNSIGNED_INT&&(a=t.RGB32UI),i===t.BYTE&&(a=t.RGB8I),i===t.SHORT&&(a=t.RGB16I),i===t.INT&&(a=t.RGB32I)),r===t.RGBA_INTEGER&&(i===t.UNSIGNED_BYTE&&(a=t.RGBA8UI),i===t.UNSIGNED_SHORT&&(a=t.RGBA16UI),i===t.UNSIGNED_INT&&(a=t.RGBA32UI),i===t.BYTE&&(a=t.RGBA8I),i===t.SHORT&&(a=t.RGBA16I),i===t.INT&&(a=t.RGBA32I)),r===t.RGB&&i===t.UNSIGNED_INT_5_9_9_9_REV&&(a=t.RGB9_E5),r===t.RGBA){const e=o?Ct:ee.getTransfer(s);i===t.FLOAT&&(a=t.RGBA32F),i===t.HALF_FLOAT&&(a=t.RGBA16F),i===t.UNSIGNED_BYTE&&(a=e===Rt?t.SRGB8_ALPHA8:t.RGBA8),i===t.UNSIGNED_SHORT_4_4_4_4&&(a=t.RGBA4),i===t.UNSIGNED_SHORT_5_5_5_1&&(a=t.RGB5_A1)}return a!==t.R16F&&a!==t.R32F&&a!==t.RG16F&&a!==t.RG32F&&a!==t.RGBA16F&&a!==t.RGBA32F||e.get("EXT_color_buffer_float"),a}function I(e,n){let r;return e?null===n||n===C||n===O?r=t.DEPTH24_STENCIL8:n===R?r=t.DEPTH32F_STENCIL8:n===T&&(r=t.DEPTH24_STENCIL8,console.warn("DepthTexture: 16 bit depth attachment is not supported with stencil. Using 24-bit attachment.")):null===n||n===C||n===O?r=t.DEPTH_COMPONENT24:n===R?r=t.DEPTH_COMPONENT32F:n===T&&(r=t.DEPTH_COMPONENT16),r}function D(t,e){return!0===E(t)||t.isFramebufferTexture&&t.minFilter!==y&&t.minFilter!==x?Math.log2(Math.max(e.width,e.height))+1:void 0!==t.mipmaps&&t.mipmaps.length>0?t.mipmaps.length:t.isCompressedTexture&&Array.isArray(t.image)?e.mipmaps.length:1}function B(t){const e=t.target;e.removeEventListener("dispose",B),function(t){const e=r.get(t);if(void 0===e.__webglInit)return;const n=t.source,i=d.get(n);if(i){const r=i[e.__cacheKey];r.usedTimes--,0===r.usedTimes&&z(t),0===Object.keys(i).length&&d.delete(n)}r.remove(t)}(e),e.isVideoTexture&&c.delete(e)}function F(e){const n=e.target;n.removeEventListener("dispose",F),function(e){const n=r.get(e);e.depthTexture&&(e.depthTexture.dispose(),r.remove(e.depthTexture));if(e.isWebGLCubeRenderTarget)for(let e=0;e<6;e++){if(Array.isArray(n.__webglFramebuffer[e]))for(let r=0;r<n.__webglFramebuffer[e].length;r++)t.deleteFramebuffer(n.__webglFramebuffer[e][r]);else t.deleteFramebuffer(n.__webglFramebuffer[e]);n.__webglDepthbuffer&&t.deleteRenderbuffer(n.__webglDepthbuffer[e])}else{if(Array.isArray(n.__webglFramebuffer))for(let e=0;e<n.__webglFramebuffer.length;e++)t.deleteFramebuffer(n.__webglFramebuffer[e]);else t.deleteFramebuffer(n.__webglFramebuffer);if(n.__webglDepthbuffer&&t.deleteRenderbuffer(n.__webglDepthbuffer),n.__webglMultisampledFramebuffer&&t.deleteFramebuffer(n.__webglMultisampledFramebuffer),n.__webglColorRenderbuffer)for(let e=0;e<n.__webglColorRenderbuffer.length;e++)n.__webglColorRenderbuffer[e]&&t.deleteRenderbuffer(n.__webglColorRenderbuffer[e]);n.__webglDepthRenderbuffer&&t.deleteRenderbuffer(n.__webglDepthRenderbuffer)}const i=e.textures;for(let e=0,n=i.length;e<n;e++){const n=r.get(i[e]);n.__webglTexture&&(t.deleteTexture(n.__webglTexture),o.memory.textures--),r.remove(i[e])}r.remove(e)}(n)}function z(e){const n=r.get(e);t.deleteTexture(n.__webglTexture);const i=e.source;delete d.get(i)[n.__cacheKey],o.memory.textures--}let V=0;function G(e,i){const s=r.get(e);if(e.isVideoTexture&&function(t){const e=o.render.frame;c.get(t)!==e&&(c.set(t,e),t.update())}(e),!1===e.isRenderTargetTexture&&e.version>0&&s.__version!==e.version){const t=e.image;if(null===t)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else{if(!1!==t.complete)return void Z(s,e,i);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}n.bindTexture(t.TEXTURE_2D,s.__webglTexture,t.TEXTURE0+i)}const j={[m]:t.REPEAT,[g]:t.CLAMP_TO_EDGE,[v]:t.MIRRORED_REPEAT},H={[y]:t.NEAREST,1004:t.NEAREST_MIPMAP_NEAREST,[_]:t.NEAREST_MIPMAP_LINEAR,[x]:t.LINEAR,[b]:t.LINEAR_MIPMAP_NEAREST,[w]:t.LINEAR_MIPMAP_LINEAR},W={512:t.NEVER,519:t.ALWAYS,513:t.LESS,515:t.LEQUAL,514:t.EQUAL,518:t.GEQUAL,516:t.GREATER,517:t.NOTEQUAL};function q(n,s){if(s.type!==R||!1!==e.has("OES_texture_float_linear")||s.magFilter!==x&&s.magFilter!==b&&s.magFilter!==_&&s.magFilter!==w&&s.minFilter!==x&&s.minFilter!==b&&s.minFilter!==_&&s.minFilter!==w||console.warn("THREE.WebGLRenderer: Unable to use linear filtering with floating point textures. OES_texture_float_linear not supported on this device."),t.texParameteri(n,t.TEXTURE_WRAP_S,j[s.wrapS]),t.texParameteri(n,t.TEXTURE_WRAP_T,j[s.wrapT]),n!==t.TEXTURE_3D&&n!==t.TEXTURE_2D_ARRAY||t.texParameteri(n,t.TEXTURE_WRAP_R,j[s.wrapR]),t.texParameteri(n,t.TEXTURE_MAG_FILTER,H[s.magFilter]),t.texParameteri(n,t.TEXTURE_MIN_FILTER,H[s.minFilter]),s.compareFunction&&(t.texParameteri(n,t.TEXTURE_COMPARE_MODE,t.COMPARE_REF_TO_TEXTURE),t.texParameteri(n,t.TEXTURE_COMPARE_FUNC,W[s.compareFunction])),!0===e.has("EXT_texture_filter_anisotropic")){if(s.magFilter===y)return;if(s.minFilter!==_&&s.minFilter!==w)return;if(s.type===R&&!1===e.has("OES_texture_float_linear"))return;if(s.anisotropy>1||r.get(s).__currentAnisotropy){const o=e.get("EXT_texture_filter_anisotropic");t.texParameterf(n,o.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(s.anisotropy,i.getMaxAnisotropy())),r.get(s).__currentAnisotropy=s.anisotropy}}}function X(e,n){let r=!1;void 0===e.__webglInit&&(e.__webglInit=!0,n.addEventListener("dispose",B));const i=n.source;let s=d.get(i);void 0===s&&(s={},d.set(i,s));const a=function(t){const e=[];return e.push(t.wrapS),e.push(t.wrapT),e.push(t.wrapR||0),e.push(t.magFilter),e.push(t.minFilter),e.push(t.anisotropy),e.push(t.internalFormat),e.push(t.format),e.push(t.type),e.push(t.generateMipmaps),e.push(t.premultiplyAlpha),e.push(t.flipY),e.push(t.unpackAlignment),e.push(t.colorSpace),e.join()}(n);if(a!==e.__cacheKey){void 0===s[a]&&(s[a]={texture:t.createTexture(),usedTimes:0},o.memory.textures++,r=!0),s[a].usedTimes++;const i=s[e.__cacheKey];void 0!==i&&(s[e.__cacheKey].usedTimes--,0===i.usedTimes&&z(n)),e.__cacheKey=a,e.__webglTexture=s[a].texture}return r}function Z(e,o,a){let l=t.TEXTURE_2D;(o.isDataArrayTexture||o.isCompressedArrayTexture)&&(l=t.TEXTURE_2D_ARRAY),o.isData3DTexture&&(l=t.TEXTURE_3D);const u=X(e,o),c=o.source;n.bindTexture(l,e.__webglTexture,t.TEXTURE0+a);const h=r.get(c);if(c.version!==h.__version||!0===u){n.activeTexture(t.TEXTURE0+a);const e=ee.getPrimaries(ee.workingColorSpace),r=o.colorSpace===Et?null:ee.getPrimaries(o.colorSpace),d=o.colorSpace===Et||e===r?t.NONE:t.BROWSER_DEFAULT_WEBGL;t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,o.flipY),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,o.premultiplyAlpha),t.pixelStorei(t.UNPACK_ALIGNMENT,o.unpackAlignment),t.pixelStorei(t.UNPACK_COLORSPACE_CONVERSION_WEBGL,d);let p=M(o.image,!1,i.maxTextureSize);p=nt(o,p);const f=s.convert(o.format,o.colorSpace),m=s.convert(o.type);let g,v=P(o.internalFormat,f,m,o.colorSpace,o.isVideoTexture);q(l,o);const y=o.mipmaps,_=!0!==o.isVideoTexture,x=void 0===h.__version||!0===u,b=c.dataReady,w=D(o,p);if(o.isDepthTexture)v=I(o.format===k,o.type),x&&(_?n.texStorage2D(t.TEXTURE_2D,1,v,p.width,p.height):n.texImage2D(t.TEXTURE_2D,0,v,p.width,p.height,0,f,m,null));else if(o.isDataTexture)if(y.length>0){_&&x&&n.texStorage2D(t.TEXTURE_2D,w,v,y[0].width,y[0].height);for(let e=0,r=y.length;e<r;e++)g=y[e],_?b&&n.texSubImage2D(t.TEXTURE_2D,e,0,0,g.width,g.height,f,m,g.data):n.texImage2D(t.TEXTURE_2D,e,v,g.width,g.height,0,f,m,g.data);o.generateMipmaps=!1}else _?(x&&n.texStorage2D(t.TEXTURE_2D,w,v,p.width,p.height),b&&n.texSubImage2D(t.TEXTURE_2D,0,0,0,p.width,p.height,f,m,p.data)):n.texImage2D(t.TEXTURE_2D,0,v,p.width,p.height,0,f,m,p.data);else if(o.isCompressedTexture)if(o.isCompressedArrayTexture){_&&x&&n.texStorage3D(t.TEXTURE_2D_ARRAY,w,v,y[0].width,y[0].height,p.depth);for(let e=0,r=y.length;e<r;e++)if(g=y[e],o.format!==L)if(null!==f)if(_){if(b)if(o.layerUpdates.size>0){const r=Mo(g.width,g.height,o.format,o.type);for(const i of o.layerUpdates){const s=g.data.subarray(i*r/g.data.BYTES_PER_ELEMENT,(i+1)*r/g.data.BYTES_PER_ELEMENT);n.compressedTexSubImage3D(t.TEXTURE_2D_ARRAY,e,0,0,i,g.width,g.height,1,f,s)}o.clearLayerUpdates()}else n.compressedTexSubImage3D(t.TEXTURE_2D_ARRAY,e,0,0,0,g.width,g.height,p.depth,f,g.data)}else n.compressedTexImage3D(t.TEXTURE_2D_ARRAY,e,v,g.width,g.height,p.depth,0,g.data,0,0);else console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()");else _?b&&n.texSubImage3D(t.TEXTURE_2D_ARRAY,e,0,0,0,g.width,g.height,p.depth,f,m,g.data):n.texImage3D(t.TEXTURE_2D_ARRAY,e,v,g.width,g.height,p.depth,0,f,m,g.data)}else{_&&x&&n.texStorage2D(t.TEXTURE_2D,w,v,y[0].width,y[0].height);for(let e=0,r=y.length;e<r;e++)g=y[e],o.format!==L?null!==f?_?b&&n.compressedTexSubImage2D(t.TEXTURE_2D,e,0,0,g.width,g.height,f,g.data):n.compressedTexImage2D(t.TEXTURE_2D,e,v,g.width,g.height,0,g.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):_?b&&n.texSubImage2D(t.TEXTURE_2D,e,0,0,g.width,g.height,f,m,g.data):n.texImage2D(t.TEXTURE_2D,e,v,g.width,g.height,0,f,m,g.data)}else if(o.isDataArrayTexture)if(_){if(x&&n.texStorage3D(t.TEXTURE_2D_ARRAY,w,v,p.width,p.height,p.depth),b)if(o.layerUpdates.size>0){const e=Mo(p.width,p.height,o.format,o.type);for(const r of o.layerUpdates){const i=p.data.subarray(r*e/p.data.BYTES_PER_ELEMENT,(r+1)*e/p.data.BYTES_PER_ELEMENT);n.texSubImage3D(t.TEXTURE_2D_ARRAY,0,0,0,r,p.width,p.height,1,f,m,i)}o.clearLayerUpdates()}else n.texSubImage3D(t.TEXTURE_2D_ARRAY,0,0,0,0,p.width,p.height,p.depth,f,m,p.data)}else n.texImage3D(t.TEXTURE_2D_ARRAY,0,v,p.width,p.height,p.depth,0,f,m,p.data);else if(o.isData3DTexture)_?(x&&n.texStorage3D(t.TEXTURE_3D,w,v,p.width,p.height,p.depth),b&&n.texSubImage3D(t.TEXTURE_3D,0,0,0,0,p.width,p.height,p.depth,f,m,p.data)):n.texImage3D(t.TEXTURE_3D,0,v,p.width,p.height,p.depth,0,f,m,p.data);else if(o.isFramebufferTexture){if(x)if(_)n.texStorage2D(t.TEXTURE_2D,w,v,p.width,p.height);else{let e=p.width,r=p.height;for(let i=0;i<w;i++)n.texImage2D(t.TEXTURE_2D,i,v,e,r,0,f,m,null),e>>=1,r>>=1}}else if(y.length>0){if(_&&x){const e=rt(y[0]);n.texStorage2D(t.TEXTURE_2D,w,v,e.width,e.height)}for(let e=0,r=y.length;e<r;e++)g=y[e],_?b&&n.texSubImage2D(t.TEXTURE_2D,e,0,0,f,m,g):n.texImage2D(t.TEXTURE_2D,e,v,f,m,g);o.generateMipmaps=!1}else if(_){if(x){const e=rt(p);n.texStorage2D(t.TEXTURE_2D,w,v,e.width,e.height)}b&&n.texSubImage2D(t.TEXTURE_2D,0,0,0,f,m,p)}else n.texImage2D(t.TEXTURE_2D,0,v,f,m,p);E(o)&&A(l),h.__version=c.version,o.onUpdate&&o.onUpdate(o)}e.__version=o.version}function $(e,i,o,l,u,c){const h=s.convert(o.format,o.colorSpace),d=s.convert(o.type),p=P(o.internalFormat,h,d,o.colorSpace),f=r.get(i),m=r.get(o);if(m.__renderTarget=i,!f.__hasExternalTextures){const e=Math.max(1,i.width>>c),r=Math.max(1,i.height>>c);u===t.TEXTURE_3D||u===t.TEXTURE_2D_ARRAY?n.texImage3D(u,c,p,e,r,i.depth,0,h,d,null):n.texImage2D(u,c,p,e,r,0,h,d,null)}n.bindFramebuffer(t.FRAMEBUFFER,e),et(i)?a.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,l,u,m.__webglTexture,0,tt(i)):(u===t.TEXTURE_2D||u>=t.TEXTURE_CUBE_MAP_POSITIVE_X&&u<=t.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&t.framebufferTexture2D(t.FRAMEBUFFER,l,u,m.__webglTexture,c),n.bindFramebuffer(t.FRAMEBUFFER,null)}function Y(e,n,r){if(t.bindRenderbuffer(t.RENDERBUFFER,e),n.depthBuffer){const i=n.depthTexture,s=i&&i.isDepthTexture?i.type:null,o=I(n.stencilBuffer,s),l=n.stencilBuffer?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT,u=tt(n);et(n)?a.renderbufferStorageMultisampleEXT(t.RENDERBUFFER,u,o,n.width,n.height):r?t.renderbufferStorageMultisample(t.RENDERBUFFER,u,o,n.width,n.height):t.renderbufferStorage(t.RENDERBUFFER,o,n.width,n.height),t.framebufferRenderbuffer(t.FRAMEBUFFER,l,t.RENDERBUFFER,e)}else{const e=n.textures;for(let i=0;i<e.length;i++){const o=e[i],l=s.convert(o.format,o.colorSpace),u=s.convert(o.type),c=P(o.internalFormat,l,u,o.colorSpace),h=tt(n);r&&!1===et(n)?t.renderbufferStorageMultisample(t.RENDERBUFFER,h,c,n.width,n.height):et(n)?a.renderbufferStorageMultisampleEXT(t.RENDERBUFFER,h,c,n.width,n.height):t.renderbufferStorage(t.RENDERBUFFER,c,n.width,n.height)}}t.bindRenderbuffer(t.RENDERBUFFER,null)}function K(e){const i=r.get(e),s=!0===e.isWebGLCubeRenderTarget;if(i.__boundDepthTexture!==e.depthTexture){const t=e.depthTexture;if(i.__depthDisposeCallback&&i.__depthDisposeCallback(),t){const e=()=>{delete i.__boundDepthTexture,delete i.__depthDisposeCallback,t.removeEventListener("dispose",e)};t.addEventListener("dispose",e),i.__depthDisposeCallback=e}i.__boundDepthTexture=t}if(e.depthTexture&&!i.__autoAllocateDepthBuffer){if(s)throw new Error("target.depthTexture not supported in Cube render targets");!function(e,i){if(i&&i.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(n.bindFramebuffer(t.FRAMEBUFFER,e),!i.depthTexture||!i.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");const s=r.get(i.depthTexture);s.__renderTarget=i,s.__webglTexture&&i.depthTexture.image.width===i.width&&i.depthTexture.image.height===i.height||(i.depthTexture.image.width=i.width,i.depthTexture.image.height=i.height,i.depthTexture.needsUpdate=!0),G(i.depthTexture,0);const o=s.__webglTexture,l=tt(i);if(i.depthTexture.format===U)et(i)?a.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.TEXTURE_2D,o,0,l):t.framebufferTexture2D(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.TEXTURE_2D,o,0);else{if(i.depthTexture.format!==k)throw new Error("Unknown depthTexture format");et(i)?a.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,t.DEPTH_STENCIL_ATTACHMENT,t.TEXTURE_2D,o,0,l):t.framebufferTexture2D(t.FRAMEBUFFER,t.DEPTH_STENCIL_ATTACHMENT,t.TEXTURE_2D,o,0)}}(i.__webglFramebuffer,e)}else if(s){i.__webglDepthbuffer=[];for(let r=0;r<6;r++)if(n.bindFramebuffer(t.FRAMEBUFFER,i.__webglFramebuffer[r]),void 0===i.__webglDepthbuffer[r])i.__webglDepthbuffer[r]=t.createRenderbuffer(),Y(i.__webglDepthbuffer[r],e,!1);else{const n=e.stencilBuffer?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT,s=i.__webglDepthbuffer[r];t.bindRenderbuffer(t.RENDERBUFFER,s),t.framebufferRenderbuffer(t.FRAMEBUFFER,n,t.RENDERBUFFER,s)}}else if(n.bindFramebuffer(t.FRAMEBUFFER,i.__webglFramebuffer),void 0===i.__webglDepthbuffer)i.__webglDepthbuffer=t.createRenderbuffer(),Y(i.__webglDepthbuffer,e,!1);else{const n=e.stencilBuffer?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT,r=i.__webglDepthbuffer;t.bindRenderbuffer(t.RENDERBUFFER,r),t.framebufferRenderbuffer(t.FRAMEBUFFER,n,t.RENDERBUFFER,r)}n.bindFramebuffer(t.FRAMEBUFFER,null)}const J=[],Q=[];function tt(t){return Math.min(i.maxSamples,t.samples)}function et(t){const n=r.get(t);return t.samples>0&&!0===e.has("WEBGL_multisampled_render_to_texture")&&!1!==n.__useRenderToTexture}function nt(t,e){const n=t.colorSpace,r=t.format,i=t.type;return!0===t.isCompressedTexture||!0===t.isVideoTexture||n!==At&&n!==Et&&(ee.getTransfer(n)===Rt?r===L&&i===S||console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture color space:",n)),e}function rt(t){return"undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement?(u.width=t.naturalWidth||t.width,u.height=t.naturalHeight||t.height):"undefined"!=typeof VideoFrame&&t instanceof VideoFrame?(u.width=t.displayWidth,u.height=t.displayHeight):(u.width=t.width,u.height=t.height),u}this.allocateTextureUnit=function(){const t=V;return t>=i.maxTextures&&console.warn("THREE.WebGLTextures: Trying to use "+t+" texture units while this GPU supports only "+i.maxTextures),V+=1,t},this.resetTextureUnits=function(){V=0},this.setTexture2D=G,this.setTexture2DArray=function(e,i){const s=r.get(e);e.version>0&&s.__version!==e.version?Z(s,e,i):n.bindTexture(t.TEXTURE_2D_ARRAY,s.__webglTexture,t.TEXTURE0+i)},this.setTexture3D=function(e,i){const s=r.get(e);e.version>0&&s.__version!==e.version?Z(s,e,i):n.bindTexture(t.TEXTURE_3D,s.__webglTexture,t.TEXTURE0+i)},this.setTextureCube=function(e,o){const a=r.get(e);e.version>0&&a.__version!==e.version?function(e,o,a){if(6!==o.image.length)return;const l=X(e,o),u=o.source;n.bindTexture(t.TEXTURE_CUBE_MAP,e.__webglTexture,t.TEXTURE0+a);const c=r.get(u);if(u.version!==c.__version||!0===l){n.activeTexture(t.TEXTURE0+a);const e=ee.getPrimaries(ee.workingColorSpace),r=o.colorSpace===Et?null:ee.getPrimaries(o.colorSpace),h=o.colorSpace===Et||e===r?t.NONE:t.BROWSER_DEFAULT_WEBGL;t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,o.flipY),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,o.premultiplyAlpha),t.pixelStorei(t.UNPACK_ALIGNMENT,o.unpackAlignment),t.pixelStorei(t.UNPACK_COLORSPACE_CONVERSION_WEBGL,h);const d=o.isCompressedTexture||o.image[0].isCompressedTexture,p=o.image[0]&&o.image[0].isDataTexture,f=[];for(let t=0;t<6;t++)f[t]=d||p?p?o.image[t].image:o.image[t]:M(o.image[t],!0,i.maxCubemapSize),f[t]=nt(o,f[t]);const m=f[0],g=s.convert(o.format,o.colorSpace),v=s.convert(o.type),y=P(o.internalFormat,g,v,o.colorSpace),_=!0!==o.isVideoTexture,x=void 0===c.__version||!0===l,b=u.dataReady;let w,S=D(o,m);if(q(t.TEXTURE_CUBE_MAP,o),d){_&&x&&n.texStorage2D(t.TEXTURE_CUBE_MAP,S,y,m.width,m.height);for(let e=0;e<6;e++){w=f[e].mipmaps;for(let r=0;r<w.length;r++){const i=w[r];o.format!==L?null!==g?_?b&&n.compressedTexSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,r,0,0,i.width,i.height,g,i.data):n.compressedTexImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,r,y,i.width,i.height,0,i.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):_?b&&n.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,r,0,0,i.width,i.height,g,v,i.data):n.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,r,y,i.width,i.height,0,g,v,i.data)}}}else{if(w=o.mipmaps,_&&x){w.length>0&&S++;const e=rt(f[0]);n.texStorage2D(t.TEXTURE_CUBE_MAP,S,y,e.width,e.height)}for(let e=0;e<6;e++)if(p){_?b&&n.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,0,0,0,f[e].width,f[e].height,g,v,f[e].data):n.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,0,y,f[e].width,f[e].height,0,g,v,f[e].data);for(let r=0;r<w.length;r++){const i=w[r].image[e].image;_?b&&n.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,r+1,0,0,i.width,i.height,g,v,i.data):n.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,r+1,y,i.width,i.height,0,g,v,i.data)}}else{_?b&&n.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,0,0,0,g,v,f[e]):n.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,0,y,g,v,f[e]);for(let r=0;r<w.length;r++){const i=w[r];_?b&&n.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,r+1,0,0,g,v,i.image[e]):n.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,r+1,y,g,v,i.image[e])}}}E(o)&&A(t.TEXTURE_CUBE_MAP),c.__version=u.version,o.onUpdate&&o.onUpdate(o)}e.__version=o.version}(a,e,o):n.bindTexture(t.TEXTURE_CUBE_MAP,a.__webglTexture,t.TEXTURE0+o)},this.rebindTextures=function(e,n,i){const s=r.get(e);void 0!==n&&$(s.__webglFramebuffer,e,e.texture,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,0),void 0!==i&&K(e)},this.setupRenderTarget=function(e){const i=e.texture,a=r.get(e),l=r.get(i);e.addEventListener("dispose",F);const u=e.textures,c=!0===e.isWebGLCubeRenderTarget,h=u.length>1;if(h||(void 0===l.__webglTexture&&(l.__webglTexture=t.createTexture()),l.__version=i.version,o.memory.textures++),c){a.__webglFramebuffer=[];for(let e=0;e<6;e++)if(i.mipmaps&&i.mipmaps.length>0){a.__webglFramebuffer[e]=[];for(let n=0;n<i.mipmaps.length;n++)a.__webglFramebuffer[e][n]=t.createFramebuffer()}else a.__webglFramebuffer[e]=t.createFramebuffer()}else{if(i.mipmaps&&i.mipmaps.length>0){a.__webglFramebuffer=[];for(let e=0;e<i.mipmaps.length;e++)a.__webglFramebuffer[e]=t.createFramebuffer()}else a.__webglFramebuffer=t.createFramebuffer();if(h)for(let e=0,n=u.length;e<n;e++){const n=r.get(u[e]);void 0===n.__webglTexture&&(n.__webglTexture=t.createTexture(),o.memory.textures++)}if(e.samples>0&&!1===et(e)){a.__webglMultisampledFramebuffer=t.createFramebuffer(),a.__webglColorRenderbuffer=[],n.bindFramebuffer(t.FRAMEBUFFER,a.__webglMultisampledFramebuffer);for(let n=0;n<u.length;n++){const r=u[n];a.__webglColorRenderbuffer[n]=t.createRenderbuffer(),t.bindRenderbuffer(t.RENDERBUFFER,a.__webglColorRenderbuffer[n]);const i=s.convert(r.format,r.colorSpace),o=s.convert(r.type),l=P(r.internalFormat,i,o,r.colorSpace,!0===e.isXRRenderTarget),c=tt(e);t.renderbufferStorageMultisample(t.RENDERBUFFER,c,l,e.width,e.height),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0+n,t.RENDERBUFFER,a.__webglColorRenderbuffer[n])}t.bindRenderbuffer(t.RENDERBUFFER,null),e.depthBuffer&&(a.__webglDepthRenderbuffer=t.createRenderbuffer(),Y(a.__webglDepthRenderbuffer,e,!0)),n.bindFramebuffer(t.FRAMEBUFFER,null)}}if(c){n.bindTexture(t.TEXTURE_CUBE_MAP,l.__webglTexture),q(t.TEXTURE_CUBE_MAP,i);for(let n=0;n<6;n++)if(i.mipmaps&&i.mipmaps.length>0)for(let r=0;r<i.mipmaps.length;r++)$(a.__webglFramebuffer[n][r],e,i,t.COLOR_ATTACHMENT0,t.TEXTURE_CUBE_MAP_POSITIVE_X+n,r);else $(a.__webglFramebuffer[n],e,i,t.COLOR_ATTACHMENT0,t.TEXTURE_CUBE_MAP_POSITIVE_X+n,0);E(i)&&A(t.TEXTURE_CUBE_MAP),n.unbindTexture()}else if(h){for(let i=0,s=u.length;i<s;i++){const s=u[i],o=r.get(s);n.bindTexture(t.TEXTURE_2D,o.__webglTexture),q(t.TEXTURE_2D,s),$(a.__webglFramebuffer,e,s,t.COLOR_ATTACHMENT0+i,t.TEXTURE_2D,0),E(s)&&A(t.TEXTURE_2D)}n.unbindTexture()}else{let r=t.TEXTURE_2D;if((e.isWebGL3DRenderTarget||e.isWebGLArrayRenderTarget)&&(r=e.isWebGL3DRenderTarget?t.TEXTURE_3D:t.TEXTURE_2D_ARRAY),n.bindTexture(r,l.__webglTexture),q(r,i),i.mipmaps&&i.mipmaps.length>0)for(let n=0;n<i.mipmaps.length;n++)$(a.__webglFramebuffer[n],e,i,t.COLOR_ATTACHMENT0,r,n);else $(a.__webglFramebuffer,e,i,t.COLOR_ATTACHMENT0,r,0);E(i)&&A(r),n.unbindTexture()}e.depthBuffer&&K(e)},this.updateRenderTargetMipmap=function(t){const e=t.textures;for(let i=0,s=e.length;i<s;i++){const s=e[i];if(E(s)){const e=N(t),i=r.get(s).__webglTexture;n.bindTexture(e,i),A(e),n.unbindTexture()}}},this.updateMultisampleRenderTarget=function(e){if(e.samples>0)if(!1===et(e)){const i=e.textures,s=e.width,o=e.height;let a=t.COLOR_BUFFER_BIT;const u=e.stencilBuffer?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT,c=r.get(e),h=i.length>1;if(h)for(let e=0;e<i.length;e++)n.bindFramebuffer(t.FRAMEBUFFER,c.__webglMultisampledFramebuffer),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0+e,t.RENDERBUFFER,null),n.bindFramebuffer(t.FRAMEBUFFER,c.__webglFramebuffer),t.framebufferTexture2D(t.DRAW_FRAMEBUFFER,t.COLOR_ATTACHMENT0+e,t.TEXTURE_2D,null,0);n.bindFramebuffer(t.READ_FRAMEBUFFER,c.__webglMultisampledFramebuffer),n.bindFramebuffer(t.DRAW_FRAMEBUFFER,c.__webglFramebuffer);for(let n=0;n<i.length;n++){if(e.resolveDepthBuffer&&(e.depthBuffer&&(a|=t.DEPTH_BUFFER_BIT),e.stencilBuffer&&e.resolveStencilBuffer&&(a|=t.STENCIL_BUFFER_BIT)),h){t.framebufferRenderbuffer(t.READ_FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.RENDERBUFFER,c.__webglColorRenderbuffer[n]);const e=r.get(i[n]).__webglTexture;t.framebufferTexture2D(t.DRAW_FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,e,0)}t.blitFramebuffer(0,0,s,o,0,0,s,o,a,t.NEAREST),!0===l&&(J.length=0,Q.length=0,J.push(t.COLOR_ATTACHMENT0+n),e.depthBuffer&&!1===e.resolveDepthBuffer&&(J.push(u),Q.push(u),t.invalidateFramebuffer(t.DRAW_FRAMEBUFFER,Q)),t.invalidateFramebuffer(t.READ_FRAMEBUFFER,J))}if(n.bindFramebuffer(t.READ_FRAMEBUFFER,null),n.bindFramebuffer(t.DRAW_FRAMEBUFFER,null),h)for(let e=0;e<i.length;e++){n.bindFramebuffer(t.FRAMEBUFFER,c.__webglMultisampledFramebuffer),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0+e,t.RENDERBUFFER,c.__webglColorRenderbuffer[e]);const s=r.get(i[e]).__webglTexture;n.bindFramebuffer(t.FRAMEBUFFER,c.__webglFramebuffer),t.framebufferTexture2D(t.DRAW_FRAMEBUFFER,t.COLOR_ATTACHMENT0+e,t.TEXTURE_2D,s,0)}n.bindFramebuffer(t.DRAW_FRAMEBUFFER,c.__webglMultisampledFramebuffer)}else if(e.depthBuffer&&!1===e.resolveDepthBuffer&&l){const n=e.stencilBuffer?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT;t.invalidateFramebuffer(t.DRAW_FRAMEBUFFER,[n])}},this.setupDepthRenderbuffer=K,this.setupFrameBufferTexture=$,this.useMultisampledRTT=et}function To(t,e){return{convert:function(n,r=""){let i;const s=ee.getTransfer(r);if(n===S)return t.UNSIGNED_BYTE;if(n===P)return t.UNSIGNED_SHORT_4_4_4_4;if(n===I)return t.UNSIGNED_SHORT_5_5_5_1;if(n===D)return t.UNSIGNED_INT_5_9_9_9_REV;if(n===M)return t.BYTE;if(n===E)return t.SHORT;if(n===T)return t.UNSIGNED_SHORT;if(n===A)return t.INT;if(n===C)return t.UNSIGNED_INT;if(n===R)return t.FLOAT;if(n===N)return t.HALF_FLOAT;if(1021===n)return t.ALPHA;if(1022===n)return t.RGB;if(n===L)return t.RGBA;if(1024===n)return t.LUMINANCE;if(1025===n)return t.LUMINANCE_ALPHA;if(n===U)return t.DEPTH_COMPONENT;if(n===k)return t.DEPTH_STENCIL;if(n===B)return t.RED;if(n===F)return t.RED_INTEGER;if(1030===n)return t.RG;if(n===z)return t.RG_INTEGER;if(n===V)return t.RGBA_INTEGER;if(n===G||n===j||n===H||n===W)if(s===Rt){if(i=e.get("WEBGL_compressed_texture_s3tc_srgb"),null===i)return null;if(n===G)return i.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(n===j)return i.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(n===H)return i.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(n===W)return i.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else{if(i=e.get("WEBGL_compressed_texture_s3tc"),null===i)return null;if(n===G)return i.COMPRESSED_RGB_S3TC_DXT1_EXT;if(n===j)return i.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(n===H)return i.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(n===W)return i.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(n===q||n===X||n===Z||n===$){if(i=e.get("WEBGL_compressed_texture_pvrtc"),null===i)return null;if(n===q)return i.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(n===X)return i.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(n===Z)return i.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(n===$)return i.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(n===Y||n===K||n===J){if(i=e.get("WEBGL_compressed_texture_etc"),null===i)return null;if(n===Y||n===K)return s===Rt?i.COMPRESSED_SRGB8_ETC2:i.COMPRESSED_RGB8_ETC2;if(n===J)return s===Rt?i.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:i.COMPRESSED_RGBA8_ETC2_EAC}if(n===Q||n===tt||n===et||n===nt||n===rt||n===it||n===st||n===ot||n===at||n===lt||n===ut||n===ct||n===ht||n===dt){if(i=e.get("WEBGL_compressed_texture_astc"),null===i)return null;if(n===Q)return s===Rt?i.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:i.COMPRESSED_RGBA_ASTC_4x4_KHR;if(n===tt)return s===Rt?i.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:i.COMPRESSED_RGBA_ASTC_5x4_KHR;if(n===et)return s===Rt?i.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:i.COMPRESSED_RGBA_ASTC_5x5_KHR;if(n===nt)return s===Rt?i.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:i.COMPRESSED_RGBA_ASTC_6x5_KHR;if(n===rt)return s===Rt?i.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:i.COMPRESSED_RGBA_ASTC_6x6_KHR;if(n===it)return s===Rt?i.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:i.COMPRESSED_RGBA_ASTC_8x5_KHR;if(n===st)return s===Rt?i.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:i.COMPRESSED_RGBA_ASTC_8x6_KHR;if(n===ot)return s===Rt?i.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:i.COMPRESSED_RGBA_ASTC_8x8_KHR;if(n===at)return s===Rt?i.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:i.COMPRESSED_RGBA_ASTC_10x5_KHR;if(n===lt)return s===Rt?i.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:i.COMPRESSED_RGBA_ASTC_10x6_KHR;if(n===ut)return s===Rt?i.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:i.COMPRESSED_RGBA_ASTC_10x8_KHR;if(n===ct)return s===Rt?i.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:i.COMPRESSED_RGBA_ASTC_10x10_KHR;if(n===ht)return s===Rt?i.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:i.COMPRESSED_RGBA_ASTC_12x10_KHR;if(n===dt)return s===Rt?i.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:i.COMPRESSED_RGBA_ASTC_12x12_KHR}if(n===pt||n===ft||n===mt){if(i=e.get("EXT_texture_compression_bptc"),null===i)return null;if(n===pt)return s===Rt?i.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:i.COMPRESSED_RGBA_BPTC_UNORM_EXT;if(n===ft)return i.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT;if(n===mt)return i.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT}if(36283===n||n===gt||n===vt||n===yt){if(i=e.get("EXT_texture_compression_rgtc"),null===i)return null;if(n===pt)return i.COMPRESSED_RED_RGTC1_EXT;if(n===gt)return i.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(n===vt)return i.COMPRESSED_RED_GREEN_RGTC2_EXT;if(n===yt)return i.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}return n===O?t.UNSIGNED_INT_24_8:void 0!==t[n]?t[n]:null}}}class Ao extends Or{constructor(t=[]){super(),this.isArrayCamera=!0,this.cameras=t}}class Co extends Tn{constructor(){super(),this.isGroup=!0,this.type="Group"}}const Ro={type:"move"};class No{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return null===this._hand&&(this._hand=new Co,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return null===this._targetRay&&(this._targetRay=new Co,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new we,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new we),this._targetRay}getGripSpace(){return null===this._grip&&(this._grip=new Co,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new we,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new we),this._grip}dispatchEvent(t){return null!==this._targetRay&&this._targetRay.dispatchEvent(t),null!==this._grip&&this._grip.dispatchEvent(t),null!==this._hand&&this._hand.dispatchEvent(t),this}connect(t){if(t&&t.hand){const e=this._hand;if(e)for(const n of t.hand.values())this._getHandJoint(e,n)}return this.dispatchEvent({type:"connected",data:t}),this}disconnect(t){return this.dispatchEvent({type:"disconnected",data:t}),null!==this._targetRay&&(this._targetRay.visible=!1),null!==this._grip&&(this._grip.visible=!1),null!==this._hand&&(this._hand.visible=!1),this}update(t,e,n){let r=null,i=null,s=null;const o=this._targetRay,a=this._grip,l=this._hand;if(t&&"visible-blurred"!==e.session.visibilityState){if(l&&t.hand){s=!0;for(const r of t.hand.values()){const t=e.getJointPose(r,n),i=this._getHandJoint(l,r);null!==t&&(i.matrix.fromArray(t.transform.matrix),i.matrix.decompose(i.position,i.rotation,i.scale),i.matrixWorldNeedsUpdate=!0,i.jointRadius=t.radius),i.visible=null!==t}const r=l.joints["index-finger-tip"],i=l.joints["thumb-tip"],o=r.position.distanceTo(i.position),a=.02,u=.005;l.inputState.pinching&&o>a+u?(l.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:t.handedness,target:this})):!l.inputState.pinching&&o<=a-u&&(l.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:t.handedness,target:this}))}else null!==a&&t.gripSpace&&(i=e.getPose(t.gripSpace,n),null!==i&&(a.matrix.fromArray(i.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale),a.matrixWorldNeedsUpdate=!0,i.linearVelocity?(a.hasLinearVelocity=!0,a.linearVelocity.copy(i.linearVelocity)):a.hasLinearVelocity=!1,i.angularVelocity?(a.hasAngularVelocity=!0,a.angularVelocity.copy(i.angularVelocity)):a.hasAngularVelocity=!1));null!==o&&(r=e.getPose(t.targetRaySpace,n),null===r&&null!==i&&(r=i),null!==r&&(o.matrix.fromArray(r.transform.matrix),o.matrix.decompose(o.position,o.rotation,o.scale),o.matrixWorldNeedsUpdate=!0,r.linearVelocity?(o.hasLinearVelocity=!0,o.linearVelocity.copy(r.linearVelocity)):o.hasLinearVelocity=!1,r.angularVelocity?(o.hasAngularVelocity=!0,o.angularVelocity.copy(r.angularVelocity)):o.hasAngularVelocity=!1,this.dispatchEvent(Ro)))}return null!==o&&(o.visible=null!==r),null!==a&&(a.visible=null!==i),null!==l&&(l.visible=null!==s),this}_getHandJoint(t,e){if(void 0===t.joints[e.jointName]){const n=new Co;n.matrixAutoUpdate=!1,n.visible=!1,t.joints[e.jointName]=n,t.add(n)}return t.joints[e.jointName]}}class Po{constructor(){this.texture=null,this.mesh=null,this.depthNear=0,this.depthFar=0}init(t,e,n){if(null===this.texture){const r=new me;t.properties.get(r).__webglTexture=e.texture,e.depthNear==n.depthNear&&e.depthFar==n.depthFar||(this.depthNear=e.depthNear,this.depthFar=e.depthFar),this.texture=r}}getMesh(t){if(null!==this.texture&&null===this.mesh){const e=t.cameras[0].viewport,n=new Cr({vertexShader:"\nvoid main() {\n\n\tgl_Position = vec4( position, 1.0 );\n\n}",fragmentShader:"\nuniform sampler2DArray depthColor;\nuniform float depthWidth;\nuniform float depthHeight;\n\nvoid main() {\n\n\tvec2 coord = vec2( gl_FragCoord.x / depthWidth, gl_FragCoord.y / depthHeight );\n\n\tif ( coord.x >= 1.0 ) {\n\n\t\tgl_FragDepth = texture( depthColor, vec3( coord.x - 1.0, coord.y, 1 ) ).r;\n\n\t} else {\n\n\t\tgl_FragDepth = texture( depthColor, vec3( coord.x, coord.y, 0 ) ).r;\n\n\t}\n\n}",uniforms:{depthColor:{value:this.texture},depthWidth:{value:e.z},depthHeight:{value:e.w}}});this.mesh=new br(new Xr(20,20),n)}return this.mesh}reset(){this.texture=null,this.mesh=null}getDepthTexture(){return this.texture}}class Io extends Lt{constructor(t,e){super();const n=this;let r=null,i=1,s=null,o="local-floor",a=1,l=null,u=null,c=null,h=null,d=null,p=null;const f=new Po,m=e.getContextAttributes();let g=null,v=null;const y=[],_=[],x=new Xt;let b=null;const w=new Or;w.viewport=new ge;const M=new Or;M.viewport=new ge;const E=[w,M],T=new Ao;let A=null,R=null;function N(t){const e=_.indexOf(t.inputSource);if(-1===e)return;const n=y[e];void 0!==n&&(n.update(t.inputSource,t.frame,l||s),n.dispatchEvent({type:t.type,data:t.inputSource}))}function P(){r.removeEventListener("select",N),r.removeEventListener("selectstart",N),r.removeEventListener("selectend",N),r.removeEventListener("squeeze",N),r.removeEventListener("squeezestart",N),r.removeEventListener("squeezeend",N),r.removeEventListener("end",P),r.removeEventListener("inputsourceschange",I);for(let t=0;t<y.length;t++){const e=_[t];null!==e&&(_[t]=null,y[t].disconnect(e))}A=null,R=null,f.reset(),t.setRenderTarget(g),d=null,h=null,c=null,r=null,v=null,V.stop(),n.isPresenting=!1,t.setPixelRatio(b),t.setSize(x.width,x.height,!1),n.dispatchEvent({type:"sessionend"})}function I(t){for(let e=0;e<t.removed.length;e++){const n=t.removed[e],r=_.indexOf(n);r>=0&&(_[r]=null,y[r].disconnect(n))}for(let e=0;e<t.added.length;e++){const n=t.added[e];let r=_.indexOf(n);if(-1===r){for(let t=0;t<y.length;t++){if(t>=_.length){_.push(n),r=t;break}if(null===_[t]){_[t]=n,r=t;break}}if(-1===r)break}const i=y[r];i&&i.connect(n)}}this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(t){let e=y[t];return void 0===e&&(e=new No,y[t]=e),e.getTargetRaySpace()},this.getControllerGrip=function(t){let e=y[t];return void 0===e&&(e=new No,y[t]=e),e.getGripSpace()},this.getHand=function(t){let e=y[t];return void 0===e&&(e=new No,y[t]=e),e.getHandSpace()},this.setFramebufferScaleFactor=function(t){i=t,!0===n.isPresenting&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(t){o=t,!0===n.isPresenting&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return l||s},this.setReferenceSpace=function(t){l=t},this.getBaseLayer=function(){return null!==h?h:d},this.getBinding=function(){return c},this.getFrame=function(){return p},this.getSession=function(){return r},this.setSession=async function(u){if(r=u,null!==r){if(g=t.getRenderTarget(),r.addEventListener("select",N),r.addEventListener("selectstart",N),r.addEventListener("selectend",N),r.addEventListener("squeeze",N),r.addEventListener("squeezestart",N),r.addEventListener("squeezeend",N),r.addEventListener("end",P),r.addEventListener("inputsourceschange",I),!0!==m.xrCompatible&&await e.makeXRCompatible(),b=t.getPixelRatio(),t.getSize(x),void 0===r.renderState.layers){const n={antialias:m.antialias,alpha:!0,depth:m.depth,stencil:m.stencil,framebufferScaleFactor:i};d=new XRWebGLLayer(r,e,n),r.updateRenderState({baseLayer:d}),t.setPixelRatio(1),t.setSize(d.framebufferWidth,d.framebufferHeight,!1),v=new ye(d.framebufferWidth,d.framebufferHeight,{format:L,type:S,colorSpace:t.outputColorSpace,stencilBuffer:m.stencil})}else{let n=null,s=null,o=null;m.depth&&(o=m.stencil?e.DEPTH24_STENCIL8:e.DEPTH_COMPONENT24,n=m.stencil?k:U,s=m.stencil?O:C);const a={colorFormat:e.RGBA8,depthFormat:o,scaleFactor:i};c=new XRWebGLBinding(r,e),h=c.createProjectionLayer(a),r.updateRenderState({layers:[h]}),t.setPixelRatio(1),t.setSize(h.textureWidth,h.textureHeight,!1),v=new ye(h.textureWidth,h.textureHeight,{format:L,type:S,depthTexture:new Pi(h.textureWidth,h.textureHeight,s,void 0,void 0,void 0,void 0,void 0,void 0,n),stencilBuffer:m.stencil,colorSpace:t.outputColorSpace,samples:m.antialias?4:0,resolveDepthBuffer:!1===h.ignoreDepthValues})}v.isXRRenderTarget=!0,this.setFoveation(a),l=null,s=await r.requestReferenceSpace(o),V.setContext(r),V.start(),n.isPresenting=!0,n.dispatchEvent({type:"sessionstart"})}},this.getEnvironmentBlendMode=function(){if(null!==r)return r.environmentBlendMode},this.getDepthTexture=function(){return f.getDepthTexture()};const D=new we,B=new we;function F(t,e){null===e?t.matrixWorld.copy(t.matrix):t.matrixWorld.multiplyMatrices(e.matrixWorld,t.matrix),t.matrixWorldInverse.copy(t.matrixWorld).invert()}this.updateCamera=function(t){if(null===r)return;let e=t.near,n=t.far;null!==f.texture&&(f.depthNear>0&&(e=f.depthNear),f.depthFar>0&&(n=f.depthFar)),T.near=M.near=w.near=e,T.far=M.far=w.far=n,A===T.near&&R===T.far||(r.updateRenderState({depthNear:T.near,depthFar:T.far}),A=T.near,R=T.far),w.layers.mask=2|t.layers.mask,M.layers.mask=4|t.layers.mask,T.layers.mask=w.layers.mask|M.layers.mask;const i=t.parent,s=T.cameras;F(T,i);for(let t=0;t<s.length;t++)F(s[t],i);2===s.length?function(t,e,n){D.setFromMatrixPosition(e.matrixWorld),B.setFromMatrixPosition(n.matrixWorld);const r=D.distanceTo(B),i=e.projectionMatrix.elements,s=n.projectionMatrix.elements,o=i[14]/(i[10]-1),a=i[14]/(i[10]+1),l=(i[9]+1)/i[5],u=(i[9]-1)/i[5],c=(i[8]-1)/i[0],h=(s[8]+1)/s[0],d=o*c,p=o*h,f=r/(-c+h),m=f*-c;if(e.matrixWorld.decompose(t.position,t.quaternion,t.scale),t.translateX(m),t.translateZ(f),t.matrixWorld.compose(t.position,t.quaternion,t.scale),t.matrixWorldInverse.copy(t.matrixWorld).invert(),-1===i[10])t.projectionMatrix.copy(e.projectionMatrix),t.projectionMatrixInverse.copy(e.projectionMatrixInverse);else{const e=o+f,n=a+f,i=d-m,s=p+(r-m),c=l*a/n*e,h=u*a/n*e;t.projectionMatrix.makePerspective(i,s,c,h,e,n),t.projectionMatrixInverse.copy(t.projectionMatrix).invert()}}(T,w,M):T.projectionMatrix.copy(w.projectionMatrix),function(t,e,n){null===n?t.matrix.copy(e.matrixWorld):(t.matrix.copy(n.matrixWorld),t.matrix.invert(),t.matrix.multiply(e.matrixWorld));t.matrix.decompose(t.position,t.quaternion,t.scale),t.updateMatrixWorld(!0),t.projectionMatrix.copy(e.projectionMatrix),t.projectionMatrixInverse.copy(e.projectionMatrixInverse),t.isPerspectiveCamera&&(t.fov=2*Ft*Math.atan(1/t.projectionMatrix.elements[5]),t.zoom=1)}(t,T,i)},this.getCamera=function(){return T},this.getFoveation=function(){if(null!==h||null!==d)return a},this.setFoveation=function(t){a=t,null!==h&&(h.fixedFoveation=t),null!==d&&void 0!==d.fixedFoveation&&(d.fixedFoveation=t)},this.hasDepthSensing=function(){return null!==f.texture},this.getDepthSensingMesh=function(){return f.getMesh(T)};let z=null;const V=new Wr;V.setAnimationLoop((function(e,i){if(u=i.getViewerPose(l||s),p=i,null!==u){const e=u.views;null!==d&&(t.setRenderTargetFramebuffer(v,d.framebuffer),t.setRenderTarget(v));let n=!1;e.length!==T.cameras.length&&(T.cameras.length=0,n=!0);for(let r=0;r<e.length;r++){const i=e[r];let s=null;if(null!==d)s=d.getViewport(i);else{const e=c.getViewSubImage(h,i);s=e.viewport,0===r&&(t.setRenderTargetTextures(v,e.colorTexture,h.ignoreDepthValues?void 0:e.depthStencilTexture),t.setRenderTarget(v))}let o=E[r];void 0===o&&(o=new Or,o.layers.enable(r),o.viewport=new ge,E[r]=o),o.matrix.fromArray(i.transform.matrix),o.matrix.decompose(o.position,o.quaternion,o.scale),o.projectionMatrix.fromArray(i.projectionMatrix),o.projectionMatrixInverse.copy(o.projectionMatrix).invert(),o.viewport.set(s.x,s.y,s.width,s.height),0===r&&(T.matrix.copy(o.matrix),T.matrix.decompose(T.position,T.quaternion,T.scale)),!0===n&&T.cameras.push(o)}const i=r.enabledFeatures;if(i&&i.includes("depth-sensing")){const n=c.getDepthInformation(e[0]);n&&n.isValid&&n.texture&&f.init(t,n,r.renderState)}}for(let t=0;t<y.length;t++){const e=_[t],n=y[t];null!==e&&void 0!==n&&n.update(e,i,l||s)}z&&z(e,i),i.detectedPlanes&&n.dispatchEvent({type:"planesdetected",data:i}),p=null})),this.setAnimationLoop=function(t){z=t},this.dispose=function(){}}}const Oo=new un,Do=new Je;function Lo(t,e){function n(t,e){!0===t.matrixAutoUpdate&&t.updateMatrix(),e.value.copy(t.matrix)}function r(t,r){t.opacity.value=r.opacity,r.color&&t.diffuse.value.copy(r.color),r.emissive&&t.emissive.value.copy(r.emissive).multiplyScalar(r.emissiveIntensity),r.map&&(t.map.value=r.map,n(r.map,t.mapTransform)),r.alphaMap&&(t.alphaMap.value=r.alphaMap,n(r.alphaMap,t.alphaMapTransform)),r.bumpMap&&(t.bumpMap.value=r.bumpMap,n(r.bumpMap,t.bumpMapTransform),t.bumpScale.value=r.bumpScale,1===r.side&&(t.bumpScale.value*=-1)),r.normalMap&&(t.normalMap.value=r.normalMap,n(r.normalMap,t.normalMapTransform),t.normalScale.value.copy(r.normalScale),1===r.side&&t.normalScale.value.negate()),r.displacementMap&&(t.displacementMap.value=r.displacementMap,n(r.displacementMap,t.displacementMapTransform),t.displacementScale.value=r.displacementScale,t.displacementBias.value=r.displacementBias),r.emissiveMap&&(t.emissiveMap.value=r.emissiveMap,n(r.emissiveMap,t.emissiveMapTransform)),r.specularMap&&(t.specularMap.value=r.specularMap,n(r.specularMap,t.specularMapTransform)),r.alphaTest>0&&(t.alphaTest.value=r.alphaTest);const i=e.get(r),s=i.envMap,o=i.envMapRotation;s&&(t.envMap.value=s,Oo.copy(o),Oo.x*=-1,Oo.y*=-1,Oo.z*=-1,s.isCubeTexture&&!1===s.isRenderTargetTexture&&(Oo.y*=-1,Oo.z*=-1),t.envMapRotation.value.setFromMatrix4(Do.makeRotationFromEuler(Oo)),t.flipEnvMap.value=s.isCubeTexture&&!1===s.isRenderTargetTexture?-1:1,t.reflectivity.value=r.reflectivity,t.ior.value=r.ior,t.refractionRatio.value=r.refractionRatio),r.lightMap&&(t.lightMap.value=r.lightMap,t.lightMapIntensity.value=r.lightMapIntensity,n(r.lightMap,t.lightMapTransform)),r.aoMap&&(t.aoMap.value=r.aoMap,t.aoMapIntensity.value=r.aoMapIntensity,n(r.aoMap,t.aoMapTransform))}return{refreshFogUniforms:function(e,n){n.color.getRGB(e.fogColor.value,Tr(t)),n.isFog?(e.fogNear.value=n.near,e.fogFar.value=n.far):n.isFogExp2&&(e.fogDensity.value=n.density)},refreshMaterialUniforms:function(t,i,s,o,a){i.isMeshBasicMaterial||i.isMeshLambertMaterial?r(t,i):i.isMeshToonMaterial?(r(t,i),function(t,e){e.gradientMap&&(t.gradientMap.value=e.gradientMap)}(t,i)):i.isMeshPhongMaterial?(r(t,i),function(t,e){t.specular.value.copy(e.specular),t.shininess.value=Math.max(e.shininess,1e-4)}(t,i)):i.isMeshStandardMaterial?(r(t,i),function(t,e){t.metalness.value=e.metalness,e.metalnessMap&&(t.metalnessMap.value=e.metalnessMap,n(e.metalnessMap,t.metalnessMapTransform));t.roughness.value=e.roughness,e.roughnessMap&&(t.roughnessMap.value=e.roughnessMap,n(e.roughnessMap,t.roughnessMapTransform));e.envMap&&(t.envMapIntensity.value=e.envMapIntensity)}(t,i),i.isMeshPhysicalMaterial&&function(t,e,r){t.ior.value=e.ior,e.sheen>0&&(t.sheenColor.value.copy(e.sheenColor).multiplyScalar(e.sheen),t.sheenRoughness.value=e.sheenRoughness,e.sheenColorMap&&(t.sheenColorMap.value=e.sheenColorMap,n(e.sheenColorMap,t.sheenColorMapTransform)),e.sheenRoughnessMap&&(t.sheenRoughnessMap.value=e.sheenRoughnessMap,n(e.sheenRoughnessMap,t.sheenRoughnessMapTransform)));e.clearcoat>0&&(t.clearcoat.value=e.clearcoat,t.clearcoatRoughness.value=e.clearcoatRoughness,e.clearcoatMap&&(t.clearcoatMap.value=e.clearcoatMap,n(e.clearcoatMap,t.clearcoatMapTransform)),e.clearcoatRoughnessMap&&(t.clearcoatRoughnessMap.value=e.clearcoatRoughnessMap,n(e.clearcoatRoughnessMap,t.clearcoatRoughnessMapTransform)),e.clearcoatNormalMap&&(t.clearcoatNormalMap.value=e.clearcoatNormalMap,n(e.clearcoatNormalMap,t.clearcoatNormalMapTransform),t.clearcoatNormalScale.value.copy(e.clearcoatNormalScale),1===e.side&&t.clearcoatNormalScale.value.negate()));e.dispersion>0&&(t.dispersion.value=e.dispersion);e.iridescence>0&&(t.iridescence.value=e.iridescence,t.iridescenceIOR.value=e.iridescenceIOR,t.iridescenceThicknessMinimum.value=e.iridescenceThicknessRange[0],t.iridescenceThicknessMaximum.value=e.iridescenceThicknessRange[1],e.iridescenceMap&&(t.iridescenceMap.value=e.iridescenceMap,n(e.iridescenceMap,t.iridescenceMapTransform)),e.iridescenceThicknessMap&&(t.iridescenceThicknessMap.value=e.iridescenceThicknessMap,n(e.iridescenceThicknessMap,t.iridescenceThicknessMapTransform)));e.transmission>0&&(t.transmission.value=e.transmission,t.transmissionSamplerMap.value=r.texture,t.transmissionSamplerSize.value.set(r.width,r.height),e.transmissionMap&&(t.transmissionMap.value=e.transmissionMap,n(e.transmissionMap,t.transmissionMapTransform)),t.thickness.value=e.thickness,e.thicknessMap&&(t.thicknessMap.value=e.thicknessMap,n(e.thicknessMap,t.thicknessMapTransform)),t.attenuationDistance.value=e.attenuationDistance,t.attenuationColor.value.copy(e.attenuationColor));e.anisotropy>0&&(t.anisotropyVector.value.set(e.anisotropy*Math.cos(e.anisotropyRotation),e.anisotropy*Math.sin(e.anisotropyRotation)),e.anisotropyMap&&(t.anisotropyMap.value=e.anisotropyMap,n(e.anisotropyMap,t.anisotropyMapTransform)));t.specularIntensity.value=e.specularIntensity,t.specularColor.value.copy(e.specularColor),e.specularColorMap&&(t.specularColorMap.value=e.specularColorMap,n(e.specularColorMap,t.specularColorMapTransform));e.specularIntensityMap&&(t.specularIntensityMap.value=e.specularIntensityMap,n(e.specularIntensityMap,t.specularIntensityMapTransform))}(t,i,a)):i.isMeshMatcapMaterial?(r(t,i),function(t,e){e.matcap&&(t.matcap.value=e.matcap)}(t,i)):i.isMeshDepthMaterial?r(t,i):i.isMeshDistanceMaterial?(r(t,i),function(t,n){const r=e.get(n).light;t.referencePosition.value.setFromMatrixPosition(r.matrixWorld),t.nearDistance.value=r.shadow.camera.near,t.farDistance.value=r.shadow.camera.far}(t,i)):i.isMeshNormalMaterial?r(t,i):i.isLineBasicMaterial?(function(t,e){t.diffuse.value.copy(e.color),t.opacity.value=e.opacity,e.map&&(t.map.value=e.map,n(e.map,t.mapTransform))}(t,i),i.isLineDashedMaterial&&function(t,e){t.dashSize.value=e.dashSize,t.totalSize.value=e.dashSize+e.gapSize,t.scale.value=e.scale}(t,i)):i.isPointsMaterial?function(t,e,r,i){t.diffuse.value.copy(e.color),t.opacity.value=e.opacity,t.size.value=e.size*r,t.scale.value=.5*i,e.map&&(t.map.value=e.map,n(e.map,t.uvTransform));e.alphaMap&&(t.alphaMap.value=e.alphaMap,n(e.alphaMap,t.alphaMapTransform));e.alphaTest>0&&(t.alphaTest.value=e.alphaTest)}(t,i,s,o):i.isSpriteMaterial?function(t,e){t.diffuse.value.copy(e.color),t.opacity.value=e.opacity,t.rotation.value=e.rotation,e.map&&(t.map.value=e.map,n(e.map,t.mapTransform));e.alphaMap&&(t.alphaMap.value=e.alphaMap,n(e.alphaMap,t.alphaMapTransform));e.alphaTest>0&&(t.alphaTest.value=e.alphaTest)}(t,i):i.isShadowMaterial?(t.color.value.copy(i.color),t.opacity.value=i.opacity):i.isShaderMaterial&&(i.uniformsNeedUpdate=!1)}}}function Uo(t,e,n,r){let i={},s={},o=[];const a=t.getParameter(t.MAX_UNIFORM_BUFFER_BINDINGS);function l(t,e,n,r){const i=t.value,s=e+"_"+n;if(void 0===r[s])return r[s]="number"==typeof i||"boolean"==typeof i?i:i.clone(),!0;{const t=r[s];if("number"==typeof i||"boolean"==typeof i){if(t!==i)return r[s]=i,!0}else if(!1===t.equals(i))return t.copy(i),!0}return!1}function u(t){const e={boundary:0,storage:0};return"number"==typeof t||"boolean"==typeof t?(e.boundary=4,e.storage=4):t.isVector2?(e.boundary=8,e.storage=8):t.isVector3||t.isColor?(e.boundary=16,e.storage=12):t.isVector4?(e.boundary=16,e.storage=16):t.isMatrix3?(e.boundary=48,e.storage=48):t.isMatrix4?(e.boundary=64,e.storage=64):t.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",t),e}function c(e){const n=e.target;n.removeEventListener("dispose",c);const r=o.indexOf(n.__bindingPointIndex);o.splice(r,1),t.deleteBuffer(i[n.id]),delete i[n.id],delete s[n.id]}return{bind:function(t,e){const n=e.program;r.uniformBlockBinding(t,n)},update:function(n,h){let d=i[n.id];void 0===d&&(!function(t){const e=t.uniforms;let n=0;const r=16;for(let t=0,i=e.length;t<i;t++){const i=Array.isArray(e[t])?e[t]:[e[t]];for(let t=0,e=i.length;t<e;t++){const e=i[t],s=Array.isArray(e.value)?e.value:[e.value];for(let t=0,i=s.length;t<i;t++){const i=u(s[t]),o=n%r,a=o%i.boundary,l=o+a;n+=a,0!==l&&r-l<i.storage&&(n+=r-l),e.__data=new Float32Array(i.storage/Float32Array.BYTES_PER_ELEMENT),e.__offset=n,n+=i.storage}}}const i=n%r;i>0&&(n+=r-i);t.__size=n,t.__cache={}}(n),d=function(e){const n=function(){for(let t=0;t<a;t++)if(-1===o.indexOf(t))return o.push(t),t;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}();e.__bindingPointIndex=n;const r=t.createBuffer(),i=e.__size,s=e.usage;return t.bindBuffer(t.UNIFORM_BUFFER,r),t.bufferData(t.UNIFORM_BUFFER,i,s),t.bindBuffer(t.UNIFORM_BUFFER,null),t.bindBufferBase(t.UNIFORM_BUFFER,n,r),r}(n),i[n.id]=d,n.addEventListener("dispose",c));const p=h.program;r.updateUBOMapping(n,p);const f=e.render.frame;s[n.id]!==f&&(!function(e){const n=i[e.id],r=e.uniforms,s=e.__cache;t.bindBuffer(t.UNIFORM_BUFFER,n);for(let e=0,n=r.length;e<n;e++){const n=Array.isArray(r[e])?r[e]:[r[e]];for(let r=0,i=n.length;r<i;r++){const i=n[r];if(!0===l(i,e,r,s)){const e=i.__offset,n=Array.isArray(i.value)?i.value:[i.value];let r=0;for(let s=0;s<n.length;s++){const o=n[s],a=u(o);"number"==typeof o||"boolean"==typeof o?(i.__data[0]=o,t.bufferSubData(t.UNIFORM_BUFFER,e+r,i.__data)):o.isMatrix3?(i.__data[0]=o.elements[0],i.__data[1]=o.elements[1],i.__data[2]=o.elements[2],i.__data[3]=0,i.__data[4]=o.elements[3],i.__data[5]=o.elements[4],i.__data[6]=o.elements[5],i.__data[7]=0,i.__data[8]=o.elements[6],i.__data[9]=o.elements[7],i.__data[10]=o.elements[8],i.__data[11]=0):(o.toArray(i.__data,r),r+=a.storage/Float32Array.BYTES_PER_ELEMENT)}t.bufferSubData(t.UNIFORM_BUFFER,e,i.__data)}}}t.bindBuffer(t.UNIFORM_BUFFER,null)}(n),s[n.id]=f)},dispose:function(){for(const e in i)t.deleteBuffer(i[e]);o=[],i={},s={}}}}class ko extends Tn{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.backgroundRotation=new un,this.environmentIntensity=1,this.environmentRotation=new un,this.overrideMaterial=null,"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(t,e){return super.copy(t,e),null!==t.background&&(this.background=t.background.clone()),null!==t.environment&&(this.environment=t.environment.clone()),null!==t.fog&&(this.fog=t.fog.clone()),this.backgroundBlurriness=t.backgroundBlurriness,this.backgroundIntensity=t.backgroundIntensity,this.backgroundRotation.copy(t.backgroundRotation),this.environmentIntensity=t.environmentIntensity,this.environmentRotation.copy(t.environmentRotation),null!==t.overrideMaterial&&(this.overrideMaterial=t.overrideMaterial.clone()),this.matrixAutoUpdate=t.matrixAutoUpdate,this}toJSON(t){const e=super.toJSON(t);return null!==this.fog&&(e.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(e.object.backgroundBlurriness=this.backgroundBlurriness),1!==this.backgroundIntensity&&(e.object.backgroundIntensity=this.backgroundIntensity),e.object.backgroundRotation=this.backgroundRotation.toArray(),1!==this.environmentIntensity&&(e.object.environmentIntensity=this.environmentIntensity),e.object.environmentRotation=this.environmentRotation.toArray(),e}}class Bo extends Zn{static get type(){return"LineBasicMaterial"}constructor(t){super(),this.isLineBasicMaterial=!0,this.color=new Wn(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.linewidth=t.linewidth,this.linecap=t.linecap,this.linejoin=t.linejoin,this.fog=t.fog,this}}const Fo=new we,zo=new we,Vo=new Je,Go=new Ke,jo=new je,Ho=new we,Wo=new we;class qo extends Tn{constructor(t=new ur,e=new Bo){super(),this.isLine=!0,this.type="Line",this.geometry=t,this.material=e,this.updateMorphTargets()}copy(t,e){return super.copy(t,e),this.material=Array.isArray(t.material)?t.material.slice():t.material,this.geometry=t.geometry,this}computeLineDistances(){const t=this.geometry;if(null===t.index){const e=t.attributes.position,n=[0];for(let t=1,r=e.count;t<r;t++)Fo.fromBufferAttribute(e,t-1),zo.fromBufferAttribute(e,t),n[t]=n[t-1],n[t]+=Fo.distanceTo(zo);t.setAttribute("lineDistance",new er(n,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(t,e){const n=this.geometry,r=this.matrixWorld,i=t.params.Line.threshold,s=n.drawRange;if(null===n.boundingSphere&&n.computeBoundingSphere(),jo.copy(n.boundingSphere),jo.applyMatrix4(r),jo.radius+=i,!1===t.ray.intersectsSphere(jo))return;Vo.copy(r).invert(),Go.copy(t.ray).applyMatrix4(Vo);const o=i/((this.scale.x+this.scale.y+this.scale.z)/3),a=o*o,l=this.isLineSegments?2:1,u=n.index,c=n.attributes.position;if(null!==u){const n=Math.max(0,s.start),r=Math.min(u.count,s.start+s.count);for(let i=n,s=r-1;i<s;i+=l){const n=u.getX(i),r=u.getX(i+1),s=Xo(this,t,Go,a,n,r);s&&e.push(s)}if(this.isLineLoop){const i=u.getX(r-1),s=u.getX(n),o=Xo(this,t,Go,a,i,s);o&&e.push(o)}}else{const n=Math.max(0,s.start),r=Math.min(c.count,s.start+s.count);for(let i=n,s=r-1;i<s;i+=l){const n=Xo(this,t,Go,a,i,i+1);n&&e.push(n)}if(this.isLineLoop){const i=Xo(this,t,Go,a,r-1,n);i&&e.push(i)}}}updateMorphTargets(){const t=this.geometry.morphAttributes,e=Object.keys(t);if(e.length>0){const n=t[e[0]];if(void 0!==n){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let t=0,e=n.length;t<e;t++){const e=n[t].name||String(t);this.morphTargetInfluences.push(0),this.morphTargetDictionary[e]=t}}}}}function Xo(t,e,n,r,i,s){const o=t.geometry.attributes.position;Fo.fromBufferAttribute(o,i),zo.fromBufferAttribute(o,s);if(n.distanceSqToSegment(Fo,zo,Ho,Wo)>r)return;Ho.applyMatrix4(t.matrixWorld);const a=e.ray.origin.distanceTo(Ho);return a<e.near||a>e.far?void 0:{distance:a,point:Wo.clone().applyMatrix4(t.matrixWorld),index:i,face:null,faceIndex:null,barycoord:null,object:t}}class Zo{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(t,e){const n=this.getUtoTmapping(t);return this.getPoint(n,e)}getPoints(t=5){const e=[];for(let n=0;n<=t;n++)e.push(this.getPoint(n/t));return e}getSpacedPoints(t=5){const e=[];for(let n=0;n<=t;n++)e.push(this.getPointAt(n/t));return e}getLength(){const t=this.getLengths();return t[t.length-1]}getLengths(t=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===t+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const e=[];let n,r=this.getPoint(0),i=0;e.push(0);for(let s=1;s<=t;s++)n=this.getPoint(s/t),i+=n.distanceTo(r),e.push(i),r=n;return this.cacheArcLengths=e,e}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(t,e){const n=this.getLengths();let r=0;const i=n.length;let s;s=e||t*n[i-1];let o,a=0,l=i-1;for(;a<=l;)if(r=Math.floor(a+(l-a)/2),o=n[r]-s,o<0)a=r+1;else{if(!(o>0)){l=r;break}l=r-1}if(r=l,n[r]===s)return r/(i-1);const u=n[r];return(r+(s-u)/(n[r+1]-u))/(i-1)}getTangent(t,e){const n=1e-4;let r=t-n,i=t+n;r<0&&(r=0),i>1&&(i=1);const s=this.getPoint(r),o=this.getPoint(i),a=e||(s.isVector2?new Xt:new we);return a.copy(o).sub(s).normalize(),a}getTangentAt(t,e){const n=this.getUtoTmapping(t);return this.getTangent(n,e)}computeFrenetFrames(t,e){const n=new we,r=[],i=[],s=[],o=new we,a=new Je;for(let e=0;e<=t;e++){const n=e/t;r[e]=this.getTangentAt(n,new we)}i[0]=new we,s[0]=new we;let l=Number.MAX_VALUE;const u=Math.abs(r[0].x),c=Math.abs(r[0].y),h=Math.abs(r[0].z);u<=l&&(l=u,n.set(1,0,0)),c<=l&&(l=c,n.set(0,1,0)),h<=l&&n.set(0,0,1),o.crossVectors(r[0],n).normalize(),i[0].crossVectors(r[0],o),s[0].crossVectors(r[0],i[0]);for(let e=1;e<=t;e++){if(i[e]=i[e-1].clone(),s[e]=s[e-1].clone(),o.crossVectors(r[e-1],r[e]),o.length()>Number.EPSILON){o.normalize();const t=Math.acos(Vt(r[e-1].dot(r[e]),-1,1));i[e].applyMatrix4(a.makeRotationAxis(o,t))}s[e].crossVectors(r[e],i[e])}if(!0===e){let e=Math.acos(Vt(i[0].dot(i[t]),-1,1));e/=t,r[0].dot(o.crossVectors(i[0],i[t]))>0&&(e=-e);for(let n=1;n<=t;n++)i[n].applyMatrix4(a.makeRotationAxis(r[n],e*n)),s[n].crossVectors(r[n],i[n])}return{tangents:r,normals:i,binormals:s}}clone(){return(new this.constructor).copy(this)}copy(t){return this.arcLengthDivisions=t.arcLengthDivisions,this}toJSON(){const t={metadata:{version:4.6,type:"Curve",generator:"Curve.toJSON"}};return t.arcLengthDivisions=this.arcLengthDivisions,t.type=this.type,t}fromJSON(t){return this.arcLengthDivisions=t.arcLengthDivisions,this}}class $o extends Zo{constructor(t=0,e=0,n=1,r=1,i=0,s=2*Math.PI,o=!1,a=0){super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=t,this.aY=e,this.xRadius=n,this.yRadius=r,this.aStartAngle=i,this.aEndAngle=s,this.aClockwise=o,this.aRotation=a}getPoint(t,e=new Xt){const n=e,r=2*Math.PI;let i=this.aEndAngle-this.aStartAngle;const s=Math.abs(i)<Number.EPSILON;for(;i<0;)i+=r;for(;i>r;)i-=r;i<Number.EPSILON&&(i=s?0:r),!0!==this.aClockwise||s||(i===r?i=-r:i-=r);const o=this.aStartAngle+t*i;let a=this.aX+this.xRadius*Math.cos(o),l=this.aY+this.yRadius*Math.sin(o);if(0!==this.aRotation){const t=Math.cos(this.aRotation),e=Math.sin(this.aRotation),n=a-this.aX,r=l-this.aY;a=n*t-r*e+this.aX,l=n*e+r*t+this.aY}return n.set(a,l)}copy(t){return super.copy(t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this}toJSON(){const t=super.toJSON();return t.aX=this.aX,t.aY=this.aY,t.xRadius=this.xRadius,t.yRadius=this.yRadius,t.aStartAngle=this.aStartAngle,t.aEndAngle=this.aEndAngle,t.aClockwise=this.aClockwise,t.aRotation=this.aRotation,t}fromJSON(t){return super.fromJSON(t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this}}function Yo(){let t=0,e=0,n=0,r=0;function i(i,s,o,a){t=i,e=o,n=-3*i+3*s-2*o-a,r=2*i-2*s+o+a}return{initCatmullRom:function(t,e,n,r,s){i(e,n,s*(n-t),s*(r-e))},initNonuniformCatmullRom:function(t,e,n,r,s,o,a){let l=(e-t)/s-(n-t)/(s+o)+(n-e)/o,u=(n-e)/o-(r-e)/(o+a)+(r-n)/a;l*=o,u*=o,i(e,n,l,u)},calc:function(i){const s=i*i;return t+e*i+n*s+r*(s*i)}}}const Ko=new we,Jo=new Yo,Qo=new Yo,ta=new Yo;function ea(t,e,n,r,i){const s=.5*(r-e),o=.5*(i-n),a=t*t;return(2*n-2*r+s+o)*(t*a)+(-3*n+3*r-2*s-o)*a+s*t+n}function na(t,e,n,r){return function(t,e){const n=1-t;return n*n*e}(t,e)+function(t,e){return 2*(1-t)*t*e}(t,n)+function(t,e){return t*t*e}(t,r)}function ra(t,e,n,r,i){return function(t,e){const n=1-t;return n*n*n*e}(t,e)+function(t,e){const n=1-t;return 3*n*n*t*e}(t,n)+function(t,e){return 3*(1-t)*t*t*e}(t,r)+function(t,e){return t*t*t*e}(t,i)}class ia extends Zo{constructor(t=new Xt,e=new Xt,n=new Xt,r=new Xt){super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=t,this.v1=e,this.v2=n,this.v3=r}getPoint(t,e=new Xt){const n=e,r=this.v0,i=this.v1,s=this.v2,o=this.v3;return n.set(ra(t,r.x,i.x,s.x,o.x),ra(t,r.y,i.y,s.y,o.y)),n}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this}}class sa extends Zo{constructor(t=new we,e=new we,n=new we,r=new we){super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=t,this.v1=e,this.v2=n,this.v3=r}getPoint(t,e=new we){const n=e,r=this.v0,i=this.v1,s=this.v2,o=this.v3;return n.set(ra(t,r.x,i.x,s.x,o.x),ra(t,r.y,i.y,s.y,o.y),ra(t,r.z,i.z,s.z,o.z)),n}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this}}class oa extends Zo{constructor(t=new Xt,e=new Xt){super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=t,this.v2=e}getPoint(t,e=new Xt){const n=e;return 1===t?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(t).add(this.v1)),n}getPointAt(t,e){return this.getPoint(t,e)}getTangent(t,e=new Xt){return e.subVectors(this.v2,this.v1).normalize()}getTangentAt(t,e){return this.getTangent(t,e)}copy(t){return super.copy(t),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}class aa extends Zo{constructor(t=new Xt,e=new Xt,n=new Xt){super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=t,this.v1=e,this.v2=n}getPoint(t,e=new Xt){const n=e,r=this.v0,i=this.v1,s=this.v2;return n.set(na(t,r.x,i.x,s.x),na(t,r.y,i.y,s.y)),n}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}class la extends Zo{constructor(t=new we,e=new we,n=new we){super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=t,this.v1=e,this.v2=n}getPoint(t,e=new we){const n=e,r=this.v0,i=this.v1,s=this.v2;return n.set(na(t,r.x,i.x,s.x),na(t,r.y,i.y,s.y),na(t,r.z,i.z,s.z)),n}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}class ua extends Zo{constructor(t=[]){super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=t}getPoint(t,e=new Xt){const n=e,r=this.points,i=(r.length-1)*t,s=Math.floor(i),o=i-s,a=r[0===s?s:s-1],l=r[s],u=r[s>r.length-2?r.length-1:s+1],c=r[s>r.length-3?r.length-1:s+2];return n.set(ea(o,a.x,l.x,u.x,c.x),ea(o,a.y,l.y,u.y,c.y)),n}copy(t){super.copy(t),this.points=[];for(let e=0,n=t.points.length;e<n;e++){const n=t.points[e];this.points.push(n.clone())}return this}toJSON(){const t=super.toJSON();t.points=[];for(let e=0,n=this.points.length;e<n;e++){const n=this.points[e];t.points.push(n.toArray())}return t}fromJSON(t){super.fromJSON(t),this.points=[];for(let e=0,n=t.points.length;e<n;e++){const n=t.points[e];this.points.push((new Xt).fromArray(n))}return this}}var ca=Object.freeze({__proto__:null,ArcCurve:class extends $o{constructor(t,e,n,r,i,s){super(t,e,n,n,r,i,s),this.isArcCurve=!0,this.type="ArcCurve"}},CatmullRomCurve3:class extends Zo{constructor(t=[],e=!1,n="centripetal",r=.5){super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=t,this.closed=e,this.curveType=n,this.tension=r}getPoint(t,e=new we){const n=e,r=this.points,i=r.length,s=(i-(this.closed?0:1))*t;let o,a,l=Math.floor(s),u=s-l;this.closed?l+=l>0?0:(Math.floor(Math.abs(l)/i)+1)*i:0===u&&l===i-1&&(l=i-2,u=1),this.closed||l>0?o=r[(l-1)%i]:(Ko.subVectors(r[0],r[1]).add(r[0]),o=Ko);const c=r[l%i],h=r[(l+1)%i];if(this.closed||l+2<i?a=r[(l+2)%i]:(Ko.subVectors(r[i-1],r[i-2]).add(r[i-1]),a=Ko),"centripetal"===this.curveType||"chordal"===this.curveType){const t="chordal"===this.curveType?.5:.25;let e=Math.pow(o.distanceToSquared(c),t),n=Math.pow(c.distanceToSquared(h),t),r=Math.pow(h.distanceToSquared(a),t);n<1e-4&&(n=1),e<1e-4&&(e=n),r<1e-4&&(r=n),Jo.initNonuniformCatmullRom(o.x,c.x,h.x,a.x,e,n,r),Qo.initNonuniformCatmullRom(o.y,c.y,h.y,a.y,e,n,r),ta.initNonuniformCatmullRom(o.z,c.z,h.z,a.z,e,n,r)}else"catmullrom"===this.curveType&&(Jo.initCatmullRom(o.x,c.x,h.x,a.x,this.tension),Qo.initCatmullRom(o.y,c.y,h.y,a.y,this.tension),ta.initCatmullRom(o.z,c.z,h.z,a.z,this.tension));return n.set(Jo.calc(u),Qo.calc(u),ta.calc(u)),n}copy(t){super.copy(t),this.points=[];for(let e=0,n=t.points.length;e<n;e++){const n=t.points[e];this.points.push(n.clone())}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this}toJSON(){const t=super.toJSON();t.points=[];for(let e=0,n=this.points.length;e<n;e++){const n=this.points[e];t.points.push(n.toArray())}return t.closed=this.closed,t.curveType=this.curveType,t.tension=this.tension,t}fromJSON(t){super.fromJSON(t),this.points=[];for(let e=0,n=t.points.length;e<n;e++){const n=t.points[e];this.points.push((new we).fromArray(n))}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this}},CubicBezierCurve:ia,CubicBezierCurve3:sa,EllipseCurve:$o,LineCurve:oa,LineCurve3:class extends Zo{constructor(t=new we,e=new we){super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=t,this.v2=e}getPoint(t,e=new we){const n=e;return 1===t?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(t).add(this.v1)),n}getPointAt(t,e){return this.getPoint(t,e)}getTangent(t,e=new we){return e.subVectors(this.v2,this.v1).normalize()}getTangentAt(t,e){return this.getTangent(t,e)}copy(t){return super.copy(t),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}},QuadraticBezierCurve:aa,QuadraticBezierCurve3:la,SplineCurve:ua});class ha extends ur{constructor(t=1,e=1,n=1,r=32,i=1,s=!1,o=0,a=2*Math.PI){super(),this.type="CylinderGeometry",this.parameters={radiusTop:t,radiusBottom:e,height:n,radialSegments:r,heightSegments:i,openEnded:s,thetaStart:o,thetaLength:a};const l=this;r=Math.floor(r),i=Math.floor(i);const u=[],c=[],h=[],d=[];let p=0;const f=[],m=n/2;let g=0;function v(n){const i=p,s=new Xt,f=new we;let v=0;const y=!0===n?t:e,_=!0===n?1:-1;for(let t=1;t<=r;t++)c.push(0,m*_,0),h.push(0,_,0),d.push(.5,.5),p++;const x=p;for(let t=0;t<=r;t++){const e=t/r*a+o,n=Math.cos(e),i=Math.sin(e);f.x=y*i,f.y=m*_,f.z=y*n,c.push(f.x,f.y,f.z),h.push(0,_,0),s.x=.5*n+.5,s.y=.5*i*_+.5,d.push(s.x,s.y),p++}for(let t=0;t<r;t++){const e=i+t,r=x+t;!0===n?u.push(r,r+1,e):u.push(r+1,r,e),v+=3}l.addGroup(g,v,!0===n?1:2),g+=v}!function(){const s=new we,v=new we;let y=0;const _=(e-t)/n;for(let l=0;l<=i;l++){const u=[],g=l/i,y=g*(e-t)+t;for(let t=0;t<=r;t++){const e=t/r,i=e*a+o,l=Math.sin(i),f=Math.cos(i);v.x=y*l,v.y=-g*n+m,v.z=y*f,c.push(v.x,v.y,v.z),s.set(l,_,f).normalize(),h.push(s.x,s.y,s.z),d.push(e,1-g),u.push(p++)}f.push(u)}for(let n=0;n<r;n++)for(let r=0;r<i;r++){const s=f[r][n],o=f[r+1][n],a=f[r+1][n+1],l=f[r][n+1];(t>0||0!==r)&&(u.push(s,o,l),y+=3),(e>0||r!==i-1)&&(u.push(o,a,l),y+=3)}l.addGroup(g,y,0),g+=y}(),!1===s&&(t>0&&v(!0),e>0&&v(!1)),this.setIndex(u),this.setAttribute("position",new er(c,3)),this.setAttribute("normal",new er(h,3)),this.setAttribute("uv",new er(d,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new ha(t.radiusTop,t.radiusBottom,t.height,t.radialSegments,t.heightSegments,t.openEnded,t.thetaStart,t.thetaLength)}}class da extends ha{constructor(t=1,e=1,n=32,r=1,i=!1,s=0,o=2*Math.PI){super(0,t,e,n,r,i,s,o),this.type="ConeGeometry",this.parameters={radius:t,height:e,radialSegments:n,heightSegments:r,openEnded:i,thetaStart:s,thetaLength:o}}static fromJSON(t){return new da(t.radius,t.height,t.radialSegments,t.heightSegments,t.openEnded,t.thetaStart,t.thetaLength)}}class pa extends ur{constructor(t=1,e=32,n=16,r=0,i=2*Math.PI,s=0,o=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:t,widthSegments:e,heightSegments:n,phiStart:r,phiLength:i,thetaStart:s,thetaLength:o},e=Math.max(3,Math.floor(e)),n=Math.max(2,Math.floor(n));const a=Math.min(s+o,Math.PI);let l=0;const u=[],c=new we,h=new we,d=[],p=[],f=[],m=[];for(let d=0;d<=n;d++){const g=[],v=d/n;let y=0;0===d&&0===s?y=.5/e:d===n&&a===Math.PI&&(y=-.5/e);for(let n=0;n<=e;n++){const a=n/e;c.x=-t*Math.cos(r+a*i)*Math.sin(s+v*o),c.y=t*Math.cos(s+v*o),c.z=t*Math.sin(r+a*i)*Math.sin(s+v*o),p.push(c.x,c.y,c.z),h.copy(c).normalize(),f.push(h.x,h.y,h.z),m.push(a+y,1-v),g.push(l++)}u.push(g)}for(let t=0;t<n;t++)for(let r=0;r<e;r++){const e=u[t][r+1],i=u[t][r],o=u[t+1][r],l=u[t+1][r+1];(0!==t||s>0)&&d.push(e,i,l),(t!==n-1||a<Math.PI)&&d.push(i,o,l)}this.setIndex(d),this.setAttribute("position",new er(p,3)),this.setAttribute("normal",new er(f,3)),this.setAttribute("uv",new er(m,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new pa(t.radius,t.widthSegments,t.heightSegments,t.phiStart,t.phiLength,t.thetaStart,t.thetaLength)}}class fa extends ur{constructor(t=new la(new we(-1,-1,0),new we(-1,1,0),new we(1,1,0)),e=64,n=1,r=8,i=!1){super(),this.type="TubeGeometry",this.parameters={path:t,tubularSegments:e,radius:n,radialSegments:r,closed:i};const s=t.computeFrenetFrames(e,i);this.tangents=s.tangents,this.normals=s.normals,this.binormals=s.binormals;const o=new we,a=new we,l=new Xt;let u=new we;const c=[],h=[],d=[],p=[];function f(i){u=t.getPointAt(i/e,u);const l=s.normals[i],d=s.binormals[i];for(let t=0;t<=r;t++){const e=t/r*Math.PI*2,i=Math.sin(e),s=-Math.cos(e);a.x=s*l.x+i*d.x,a.y=s*l.y+i*d.y,a.z=s*l.z+i*d.z,a.normalize(),h.push(a.x,a.y,a.z),o.x=u.x+n*a.x,o.y=u.y+n*a.y,o.z=u.z+n*a.z,c.push(o.x,o.y,o.z)}}!function(){for(let t=0;t<e;t++)f(t);f(!1===i?e:0),function(){for(let t=0;t<=e;t++)for(let n=0;n<=r;n++)l.x=t/e,l.y=n/r,d.push(l.x,l.y)}(),function(){for(let t=1;t<=e;t++)for(let e=1;e<=r;e++){const n=(r+1)*(t-1)+(e-1),i=(r+1)*t+(e-1),s=(r+1)*t+e,o=(r+1)*(t-1)+e;p.push(n,i,o),p.push(i,s,o)}}()}(),this.setIndex(p),this.setAttribute("position",new er(c,3)),this.setAttribute("normal",new er(h,3)),this.setAttribute("uv",new er(d,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}toJSON(){const t=super.toJSON();return t.path=this.parameters.path.toJSON(),t}static fromJSON(t){return new fa((new ca[t.path.type]).fromJSON(t.path),t.tubularSegments,t.radius,t.radialSegments,t.closed)}}class ma extends Zn{static get type(){return"MeshLambertMaterial"}constructor(t){super(),this.isMeshLambertMaterial=!0,this.color=new Wn(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Wn(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new Xt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new un,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapRotation.copy(t.envMapRotation),this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.flatShading=t.flatShading,this.fog=t.fog,this}}function ga(t,e,n){return!t||!n&&t.constructor===e?t:"number"==typeof e.BYTES_PER_ELEMENT?new e(t):Array.prototype.slice.call(t)}function va(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}class ya{constructor(t,e,n,r){this.parameterPositions=t,this._cachedIndex=0,this.resultBuffer=void 0!==r?r:new e.constructor(n),this.sampleValues=e,this.valueSize=n,this.settings=null,this.DefaultSettings_={}}evaluate(t){const e=this.parameterPositions;let n=this._cachedIndex,r=e[n],i=e[n-1];t:{e:{let s;n:{r:if(!(t<r)){for(let s=n+2;;){if(void 0===r){if(t<i)break r;return n=e.length,this._cachedIndex=n,this.copySampleValue_(n-1)}if(n===s)break;if(i=r,r=e[++n],t<r)break e}s=e.length;break n}if(t>=i)break t;{const o=e[1];t<o&&(n=2,i=o);for(let s=n-2;;){if(void 0===i)return this._cachedIndex=0,this.copySampleValue_(0);if(n===s)break;if(r=i,i=e[--n-1],t>=i)break e}s=n,n=0}}for(;n<s;){const r=n+s>>>1;t<e[r]?s=r:n=r+1}if(r=e[n],i=e[n-1],void 0===i)return this._cachedIndex=0,this.copySampleValue_(0);if(void 0===r)return n=e.length,this._cachedIndex=n,this.copySampleValue_(n-1)}this._cachedIndex=n,this.intervalChanged_(n,i,r)}return this.interpolate_(n,i,t,r)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(t){const e=this.resultBuffer,n=this.sampleValues,r=this.valueSize,i=t*r;for(let t=0;t!==r;++t)e[t]=n[i+t];return e}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}class _a extends ya{constructor(t,e,n,r){super(t,e,n,r),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:wt,endingEnd:wt}}intervalChanged_(t,e,n){const r=this.parameterPositions;let i=t-2,s=t+1,o=r[i],a=r[s];if(void 0===o)switch(this.getSettings_().endingStart){case St:i=t,o=2*e-n;break;case Mt:i=r.length-2,o=e+r[i]-r[i+1];break;default:i=t,o=n}if(void 0===a)switch(this.getSettings_().endingEnd){case St:s=t,a=2*n-e;break;case Mt:s=1,a=n+r[1]-r[0];break;default:s=t-1,a=e}const l=.5*(n-e),u=this.valueSize;this._weightPrev=l/(e-o),this._weightNext=l/(a-n),this._offsetPrev=i*u,this._offsetNext=s*u}interpolate_(t,e,n,r){const i=this.resultBuffer,s=this.sampleValues,o=this.valueSize,a=t*o,l=a-o,u=this._offsetPrev,c=this._offsetNext,h=this._weightPrev,d=this._weightNext,p=(n-e)/(r-e),f=p*p,m=f*p,g=-h*m+2*h*f-h*p,v=(1+h)*m+(-1.5-2*h)*f+(-.5+h)*p+1,y=(-1-d)*m+(1.5+d)*f+.5*p,_=d*m-d*f;for(let t=0;t!==o;++t)i[t]=g*s[u+t]+v*s[l+t]+y*s[a+t]+_*s[c+t];return i}}class xa extends ya{constructor(t,e,n,r){super(t,e,n,r)}interpolate_(t,e,n,r){const i=this.resultBuffer,s=this.sampleValues,o=this.valueSize,a=t*o,l=a-o,u=(n-e)/(r-e),c=1-u;for(let t=0;t!==o;++t)i[t]=s[l+t]*c+s[a+t]*u;return i}}class ba extends ya{constructor(t,e,n,r){super(t,e,n,r)}interpolate_(t){return this.copySampleValue_(t-1)}}class wa{constructor(t,e,n,r){if(void 0===t)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===e||0===e.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+t);this.name=t,this.times=ga(e,this.TimeBufferType),this.values=ga(n,this.ValueBufferType),this.setInterpolation(r||this.DefaultInterpolation)}static toJSON(t){const e=t.constructor;let n;if(e.toJSON!==this.toJSON)n=e.toJSON(t);else{n={name:t.name,times:ga(t.times,Array),values:ga(t.values,Array)};const e=t.getInterpolation();e!==t.DefaultInterpolation&&(n.interpolation=e)}return n.type=t.ValueTypeName,n}InterpolantFactoryMethodDiscrete(t){return new ba(this.times,this.values,this.getValueSize(),t)}InterpolantFactoryMethodLinear(t){return new xa(this.times,this.values,this.getValueSize(),t)}InterpolantFactoryMethodSmooth(t){return new _a(this.times,this.values,this.getValueSize(),t)}setInterpolation(t){let e;switch(t){case _t:e=this.InterpolantFactoryMethodDiscrete;break;case xt:e=this.InterpolantFactoryMethodLinear;break;case bt:e=this.InterpolantFactoryMethodSmooth}if(void 0===e){const e="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(t===this.DefaultInterpolation)throw new Error(e);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",e),this}return this.createInterpolant=e,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return _t;case this.InterpolantFactoryMethodLinear:return xt;case this.InterpolantFactoryMethodSmooth:return bt}}getValueSize(){return this.values.length/this.times.length}shift(t){if(0!==t){const e=this.times;for(let n=0,r=e.length;n!==r;++n)e[n]+=t}return this}scale(t){if(1!==t){const e=this.times;for(let n=0,r=e.length;n!==r;++n)e[n]*=t}return this}trim(t,e){const n=this.times,r=n.length;let i=0,s=r-1;for(;i!==r&&n[i]<t;)++i;for(;-1!==s&&n[s]>e;)--s;if(++s,0!==i||s!==r){i>=s&&(s=Math.max(s,1),i=s-1);const t=this.getValueSize();this.times=n.slice(i,s),this.values=this.values.slice(i*t,s*t)}return this}validate(){let t=!0;const e=this.getValueSize();e-Math.floor(e)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),t=!1);const n=this.times,r=this.values,i=n.length;0===i&&(console.error("THREE.KeyframeTrack: Track is empty.",this),t=!1);let s=null;for(let e=0;e!==i;e++){const r=n[e];if("number"==typeof r&&isNaN(r)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,e,r),t=!1;break}if(null!==s&&s>r){console.error("THREE.KeyframeTrack: Out of order keys.",this,e,r,s),t=!1;break}s=r}if(void 0!==r&&va(r))for(let e=0,n=r.length;e!==n;++e){const n=r[e];if(isNaN(n)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,e,n),t=!1;break}}return t}optimize(){const t=this.times.slice(),e=this.values.slice(),n=this.getValueSize(),r=this.getInterpolation()===bt,i=t.length-1;let s=1;for(let o=1;o<i;++o){let i=!1;const a=t[o];if(a!==t[o+1]&&(1!==o||a!==t[0]))if(r)i=!0;else{const t=o*n,r=t-n,s=t+n;for(let o=0;o!==n;++o){const n=e[t+o];if(n!==e[r+o]||n!==e[s+o]){i=!0;break}}}if(i){if(o!==s){t[s]=t[o];const r=o*n,i=s*n;for(let t=0;t!==n;++t)e[i+t]=e[r+t]}++s}}if(i>0){t[s]=t[i];for(let t=i*n,r=s*n,o=0;o!==n;++o)e[r+o]=e[t+o];++s}return s!==t.length?(this.times=t.slice(0,s),this.values=e.slice(0,s*n)):(this.times=t,this.values=e),this}clone(){const t=this.times.slice(),e=this.values.slice(),n=new(0,this.constructor)(this.name,t,e);return n.createInterpolant=this.createInterpolant,n}}wa.prototype.TimeBufferType=Float32Array,wa.prototype.ValueBufferType=Float32Array,wa.prototype.DefaultInterpolation=xt;class Sa extends wa{constructor(t,e,n){super(t,e,n)}}Sa.prototype.ValueTypeName="bool",Sa.prototype.ValueBufferType=Array,Sa.prototype.DefaultInterpolation=_t,Sa.prototype.InterpolantFactoryMethodLinear=void 0,Sa.prototype.InterpolantFactoryMethodSmooth=void 0;class Ma extends wa{}Ma.prototype.ValueTypeName="color";class Ea extends wa{}Ea.prototype.ValueTypeName="number";class Ta extends ya{constructor(t,e,n,r){super(t,e,n,r)}interpolate_(t,e,n,r){const i=this.resultBuffer,s=this.sampleValues,o=this.valueSize,a=(n-e)/(r-e);let l=t*o;for(let t=l+o;l!==t;l+=4)be.slerpFlat(i,0,s,l-o,s,l,a);return i}}class Aa extends wa{InterpolantFactoryMethodLinear(t){return new Ta(this.times,this.values,this.getValueSize(),t)}}Aa.prototype.ValueTypeName="quaternion",Aa.prototype.InterpolantFactoryMethodSmooth=void 0;class Ca extends wa{constructor(t,e,n){super(t,e,n)}}Ca.prototype.ValueTypeName="string",Ca.prototype.ValueBufferType=Array,Ca.prototype.DefaultInterpolation=_t,Ca.prototype.InterpolantFactoryMethodLinear=void 0,Ca.prototype.InterpolantFactoryMethodSmooth=void 0;class Ra extends wa{}Ra.prototype.ValueTypeName="vector";const Na={enabled:!1,files:{},add:function(t,e){!1!==this.enabled&&(this.files[t]=e)},get:function(t){if(!1!==this.enabled)return this.files[t]},remove:function(t){delete this.files[t]},clear:function(){this.files={}}};class Pa{constructor(t,e,n){const r=this;let i,s=!1,o=0,a=0;const l=[];this.onStart=void 0,this.onLoad=t,this.onProgress=e,this.onError=n,this.itemStart=function(t){a++,!1===s&&void 0!==r.onStart&&r.onStart(t,o,a),s=!0},this.itemEnd=function(t){o++,void 0!==r.onProgress&&r.onProgress(t,o,a),o===a&&(s=!1,void 0!==r.onLoad&&r.onLoad())},this.itemError=function(t){void 0!==r.onError&&r.onError(t)},this.resolveURL=function(t){return i?i(t):t},this.setURLModifier=function(t){return i=t,this},this.addHandler=function(t,e){return l.push(t,e),this},this.removeHandler=function(t){const e=l.indexOf(t);return-1!==e&&l.splice(e,2),this},this.getHandler=function(t){for(let e=0,n=l.length;e<n;e+=2){const n=l[e],r=l[e+1];if(n.global&&(n.lastIndex=0),n.test(t))return r}return null}}}const Ia=new Pa;class Oa{constructor(t){this.manager=void 0!==t?t:Ia,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(t,e){const n=this;return new Promise((function(r,i){n.load(t,r,e,i)}))}parse(){}setCrossOrigin(t){return this.crossOrigin=t,this}setWithCredentials(t){return this.withCredentials=t,this}setPath(t){return this.path=t,this}setResourcePath(t){return this.resourcePath=t,this}setRequestHeader(t){return this.requestHeader=t,this}}Oa.DEFAULT_MATERIAL_NAME="__DEFAULT";class Da extends Oa{constructor(t){super(t)}load(t,e,n,r){void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);const i=this,s=Na.get(t);if(void 0!==s)return i.manager.itemStart(t),setTimeout((function(){e&&e(s),i.manager.itemEnd(t)}),0),s;const o=Kt("img");function a(){u(),Na.add(t,this),e&&e(this),i.manager.itemEnd(t)}function l(e){u(),r&&r(e),i.manager.itemError(t),i.manager.itemEnd(t)}function u(){o.removeEventListener("load",a,!1),o.removeEventListener("error",l,!1)}return o.addEventListener("load",a,!1),o.addEventListener("error",l,!1),"data:"!==t.slice(0,5)&&void 0!==this.crossOrigin&&(o.crossOrigin=this.crossOrigin),i.manager.itemStart(t),o.src=t,o}}class La extends Tn{constructor(t,e=1){super(),this.isLight=!0,this.type="Light",this.color=new Wn(t),this.intensity=e}dispose(){}copy(t,e){return super.copy(t,e),this.color.copy(t.color),this.intensity=t.intensity,this}toJSON(t){const e=super.toJSON(t);return e.object.color=this.color.getHex(),e.object.intensity=this.intensity,void 0!==this.groundColor&&(e.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(e.object.distance=this.distance),void 0!==this.angle&&(e.object.angle=this.angle),void 0!==this.decay&&(e.object.decay=this.decay),void 0!==this.penumbra&&(e.object.penumbra=this.penumbra),void 0!==this.shadow&&(e.object.shadow=this.shadow.toJSON()),void 0!==this.target&&(e.object.target=this.target.uuid),e}}const Ua=new Je,ka=new we,Ba=new we;class Fa{constructor(t){this.camera=t,this.intensity=1,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new Xt(512,512),this.map=null,this.mapPass=null,this.matrix=new Je,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new Hr,this._frameExtents=new Xt(1,1),this._viewportCount=1,this._viewports=[new ge(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(t){const e=this.camera,n=this.matrix;ka.setFromMatrixPosition(t.matrixWorld),e.position.copy(ka),Ba.setFromMatrixPosition(t.target.matrixWorld),e.lookAt(Ba),e.updateMatrixWorld(),Ua.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Ua),n.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),n.multiply(Ua)}getViewport(t){return this._viewports[t]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(t){return this.camera=t.camera.clone(),this.intensity=t.intensity,this.bias=t.bias,this.radius=t.radius,this.mapSize.copy(t.mapSize),this}clone(){return(new this.constructor).copy(this)}toJSON(){const t={};return 1!==this.intensity&&(t.intensity=this.intensity),0!==this.bias&&(t.bias=this.bias),0!==this.normalBias&&(t.normalBias=this.normalBias),1!==this.radius&&(t.radius=this.radius),512===this.mapSize.x&&512===this.mapSize.y||(t.mapSize=this.mapSize.toArray()),t.camera=this.camera.toJSON(!1).object,delete t.camera.matrix,t}}class za extends Fa{constructor(){super(new oi(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class Va extends La{constructor(t,e){super(t,e),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(Tn.DEFAULT_UP),this.updateMatrix(),this.target=new Tn,this.shadow=new za}dispose(){this.shadow.dispose()}copy(t){return super.copy(t),this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}class Ga extends La{constructor(t,e){super(t,e),this.isAmbientLight=!0,this.type="AmbientLight"}}class ja{constructor(t=!0){this.autoStart=t,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=Ha(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let t=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const e=Ha();t=(e-this.oldTime)/1e3,this.oldTime=e,this.elapsedTime+=t}return t}}function Ha(){return performance.now()}const Wa="\\[\\]\\.:\\/",qa=new RegExp("["+Wa+"]","g"),Xa="[^"+Wa+"]",Za="[^"+Wa.replace("\\.","")+"]",$a=new RegExp("^"+/((?:WC+[\/:])*)/.source.replace("WC",Xa)+/(WCOD+)?/.source.replace("WCOD",Za)+/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",Xa)+/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",Xa)+"$"),Ya=["material","materials","bones","map"];class Ka{constructor(t,e,n){this.path=e,this.parsedPath=n||Ka.parseTrackName(e),this.node=Ka.findNode(t,this.parsedPath.nodeName),this.rootNode=t,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(t,e,n){return t&&t.isAnimationObjectGroup?new Ka.Composite(t,e,n):new Ka(t,e,n)}static sanitizeNodeName(t){return t.replace(/\s/g,"_").replace(qa,"")}static parseTrackName(t){const e=$a.exec(t);if(null===e)throw new Error("PropertyBinding: Cannot parse trackName: "+t);const n={nodeName:e[2],objectName:e[3],objectIndex:e[4],propertyName:e[5],propertyIndex:e[6]},r=n.nodeName&&n.nodeName.lastIndexOf(".");if(void 0!==r&&-1!==r){const t=n.nodeName.substring(r+1);-1!==Ya.indexOf(t)&&(n.nodeName=n.nodeName.substring(0,r),n.objectName=t)}if(null===n.propertyName||0===n.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+t);return n}static findNode(t,e){if(void 0===e||""===e||"."===e||-1===e||e===t.name||e===t.uuid)return t;if(t.skeleton){const n=t.skeleton.getBoneByName(e);if(void 0!==n)return n}if(t.children){const n=function(t){for(let r=0;r<t.length;r++){const i=t[r];if(i.name===e||i.uuid===e)return i;const s=n(i.children);if(s)return s}return null},r=n(t.children);if(r)return r}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(t,e){t[e]=this.targetObject[this.propertyName]}_getValue_array(t,e){const n=this.resolvedProperty;for(let r=0,i=n.length;r!==i;++r)t[e++]=n[r]}_getValue_arrayElement(t,e){t[e]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(t,e){this.resolvedProperty.toArray(t,e)}_setValue_direct(t,e){this.targetObject[this.propertyName]=t[e]}_setValue_direct_setNeedsUpdate(t,e){this.targetObject[this.propertyName]=t[e],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(t,e){this.targetObject[this.propertyName]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(t,e){const n=this.resolvedProperty;for(let r=0,i=n.length;r!==i;++r)n[r]=t[e++]}_setValue_array_setNeedsUpdate(t,e){const n=this.resolvedProperty;for(let r=0,i=n.length;r!==i;++r)n[r]=t[e++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(t,e){const n=this.resolvedProperty;for(let r=0,i=n.length;r!==i;++r)n[r]=t[e++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(t,e){this.resolvedProperty[this.propertyIndex]=t[e]}_setValue_arrayElement_setNeedsUpdate(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(t,e){this.resolvedProperty.fromArray(t,e)}_setValue_fromArray_setNeedsUpdate(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(t,e){this.bind(),this.getValue(t,e)}_setValue_unbound(t,e){this.bind(),this.setValue(t,e)}bind(){let t=this.node;const e=this.parsedPath,n=e.objectName,r=e.propertyName;let i=e.propertyIndex;if(t||(t=Ka.findNode(this.rootNode,e.nodeName),this.node=t),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!t)return void console.warn("THREE.PropertyBinding: No target node found for track: "+this.path+".");if(n){let r=e.objectIndex;switch(n){case"materials":if(!t.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!t.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);t=t.material.materials;break;case"bones":if(!t.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);t=t.skeleton.bones;for(let e=0;e<t.length;e++)if(t[e].name===r){r=e;break}break;case"map":if("map"in t){t=t.map;break}if(!t.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!t.material.map)return void console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);t=t.material.map;break;default:if(void 0===t[n])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);t=t[n]}if(void 0!==r){if(void 0===t[r])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,t);t=t[r]}}const s=t[r];if(void 0===s){const n=e.nodeName;return void console.error("THREE.PropertyBinding: Trying to update property for track: "+n+"."+r+" but it wasn't found.",t)}let o=this.Versioning.None;this.targetObject=t,void 0!==t.needsUpdate?o=this.Versioning.NeedsUpdate:void 0!==t.matrixWorldNeedsUpdate&&(o=this.Versioning.MatrixWorldNeedsUpdate);let a=this.BindingType.Direct;if(void 0!==i){if("morphTargetInfluences"===r){if(!t.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!t.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);void 0!==t.morphTargetDictionary[i]&&(i=t.morphTargetDictionary[i])}a=this.BindingType.ArrayElement,this.resolvedProperty=s,this.propertyIndex=i}else void 0!==s.fromArray&&void 0!==s.toArray?(a=this.BindingType.HasFromToArray,this.resolvedProperty=s):Array.isArray(s)?(a=this.BindingType.EntireArray,this.resolvedProperty=s):this.propertyName=r;this.getValue=this.GetterByBindingType[a],this.setValue=this.SetterByBindingTypeAndVersioning[a][o]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}Ka.Composite=class{constructor(t,e,n){const r=n||Ka.parseTrackName(e);this._targetGroup=t,this._bindings=t.subscribe_(e,r)}getValue(t,e){this.bind();const n=this._targetGroup.nCachedObjects_,r=this._bindings[n];void 0!==r&&r.getValue(t,e)}setValue(t,e){const n=this._bindings;for(let r=this._targetGroup.nCachedObjects_,i=n.length;r!==i;++r)n[r].setValue(t,e)}bind(){const t=this._bindings;for(let e=this._targetGroup.nCachedObjects_,n=t.length;e!==n;++e)t[e].bind()}unbind(){const t=this._bindings;for(let e=this._targetGroup.nCachedObjects_,n=t.length;e!==n;++e)t[e].unbind()}},Ka.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Ka.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},Ka.prototype.GetterByBindingType=[Ka.prototype._getValue_direct,Ka.prototype._getValue_array,Ka.prototype._getValue_arrayElement,Ka.prototype._getValue_toArray],Ka.prototype.SetterByBindingTypeAndVersioning=[[Ka.prototype._setValue_direct,Ka.prototype._setValue_direct_setNeedsUpdate,Ka.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[Ka.prototype._setValue_array,Ka.prototype._setValue_array_setNeedsUpdate,Ka.prototype._setValue_array_setMatrixWorldNeedsUpdate],[Ka.prototype._setValue_arrayElement,Ka.prototype._setValue_arrayElement_setNeedsUpdate,Ka.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[Ka.prototype._setValue_fromArray,Ka.prototype._setValue_fromArray_setNeedsUpdate,Ka.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];new Float32Array(1);const Ja=new Je;class Qa{constructor(t,e,n=0,r=1/0){this.ray=new Ke(t,e),this.near=n,this.far=r,this.camera=null,this.layers=new cn,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(t,e){this.ray.set(t,e)}setFromCamera(t,e){e.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(e.matrixWorld),this.ray.direction.set(t.x,t.y,.5).unproject(e).sub(this.ray.origin).normalize(),this.camera=e):e.isOrthographicCamera?(this.ray.origin.set(t.x,t.y,(e.near+e.far)/(e.near-e.far)).unproject(e),this.ray.direction.set(0,0,-1).transformDirection(e.matrixWorld),this.camera=e):console.error("THREE.Raycaster: Unsupported camera type: "+e.type)}setFromXRController(t){return Ja.identity().extractRotation(t.matrixWorld),this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(0,0,-1).applyMatrix4(Ja),this}intersectObject(t,e=!0,n=[]){return el(t,this,n,e),n.sort(tl),n}intersectObjects(t,e=!0,n=[]){for(let r=0,i=t.length;r<i;r++)el(t[r],this,n,e);return n.sort(tl),n}}function tl(t,e){return t.distance-e.distance}function el(t,e,n,r){let i=!0;if(t.layers.test(e.layers)){!1===t.raycast(e,n)&&(i=!1)}if(!0===i&&!0===r){const r=t.children;for(let t=0,i=r.length;t<i;t++)el(r[t],e,n,!0)}}class nl{constructor(t=1,e=0,n=0){return this.radius=t,this.phi=e,this.theta=n,this}set(t,e,n){return this.radius=t,this.phi=e,this.theta=n,this}copy(t){return this.radius=t.radius,this.phi=t.phi,this.theta=t.theta,this}makeSafe(){const t=1e-6;return this.phi=Math.max(t,Math.min(Math.PI-t,this.phi)),this}setFromVector3(t){return this.setFromCartesianCoords(t.x,t.y,t.z)}setFromCartesianCoords(t,e,n){return this.radius=Math.sqrt(t*t+e*e+n*n),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(t,n),this.phi=Math.acos(Vt(e/this.radius,-1,1))),this}clone(){return(new this.constructor).copy(this)}}class rl extends Lt{constructor(t,e=null){super(),this.object=t,this.domElement=e,this.enabled=!0,this.state=-1,this.keys={},this.mouseButtons={LEFT:null,MIDDLE:null,RIGHT:null},this.touches={ONE:null,TWO:null}}connect(){}disconnect(){}dispose(){}update(){}}"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:r}})),"undefined"!=typeof window&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=r);const il=new Vr,sl=new Xt,ol=new we,al=new Xt,ll=new Xt,ul=new we,cl=new we,hl=new Je,dl=new we,pl=new we;let fl=null,ml=null;const gl=[],vl=-1,yl=0,_l=1;class xl extends rl{constructor(t,e,n=null){super(e,n),this.objects=t,this.recursive=!0,this.transformGroup=!1,this.rotateSpeed=1,this.raycaster=new Qa,this.mouseButtons={LEFT:i.PAN,MIDDLE:i.PAN,RIGHT:i.ROTATE},this.touches={ONE:o},this._onPointerMove=bl.bind(this),this._onPointerDown=wl.bind(this),this._onPointerCancel=Sl.bind(this),this._onContextMenu=Ml.bind(this),null!==n&&this.connect()}connect(){this.domElement.addEventListener("pointermove",this._onPointerMove),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointerup",this._onPointerCancel),this.domElement.addEventListener("pointerleave",this._onPointerCancel),this.domElement.addEventListener("contextmenu",this._onContextMenu),this.domElement.style.touchAction="none"}disconnect(){this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointerup",this._onPointerCancel),this.domElement.removeEventListener("pointerleave",this._onPointerCancel),this.domElement.removeEventListener("contextmenu",this._onContextMenu),this.domElement.style.touchAction="auto",this.domElement.style.cursor=""}dispose(){this.disconnect()}_updatePointer(t){const e=this.domElement.getBoundingClientRect();sl.x=(t.clientX-e.left)/e.width*2-1,sl.y=-(t.clientY-e.top)/e.height*2+1}_updateState(t){let e;if("touch"===t.pointerType)e=this.touches.ONE;else switch(t.button){case 0:e=this.mouseButtons.LEFT;break;case 1:e=this.mouseButtons.MIDDLE;break;case 2:e=this.mouseButtons.RIGHT;break;default:e=null}switch(e){case i.PAN:case o:this.state=yl;break;case i.ROTATE:case s:this.state=_l;break;default:this.state=vl}}getRaycaster(){return console.warn("THREE.DragControls: getRaycaster() has been deprecated. Use controls.raycaster instead."),this.raycaster}setObjects(t){console.warn("THREE.DragControls: setObjects() has been deprecated. Use controls.objects instead."),this.objects=t}getObjects(){return console.warn("THREE.DragControls: getObjects() has been deprecated. Use controls.objects instead."),this.objects}activate(){console.warn("THREE.DragControls: activate() has been renamed to connect()."),this.connect()}deactivate(){console.warn("THREE.DragControls: deactivate() has been renamed to disconnect()."),this.disconnect()}set mode(t){console.warn("THREE.DragControls: The .mode property has been removed. Define the type of transformation via the .mouseButtons or .touches properties.")}get mode(){console.warn("THREE.DragControls: The .mode property has been removed. Define the type of transformation via the .mouseButtons or .touches properties.")}}function bl(t){const e=this.object,n=this.domElement,r=this.raycaster;if(!1!==this.enabled){if(this._updatePointer(t),r.setFromCamera(sl,e),fl)this.state===yl?r.ray.intersectPlane(il,ul)&&fl.position.copy(ul.sub(ol).applyMatrix4(hl)):this.state===_l&&(al.subVectors(sl,ll).multiplyScalar(this.rotateSpeed),fl.rotateOnWorldAxis(dl,al.x),fl.rotateOnWorldAxis(pl.normalize(),-al.y)),this.dispatchEvent({type:"drag",object:fl}),ll.copy(sl);else if("mouse"===t.pointerType||"pen"===t.pointerType)if(gl.length=0,r.setFromCamera(sl,e),r.intersectObjects(this.objects,this.recursive,gl),gl.length>0){const t=gl[0].object;il.setFromNormalAndCoplanarPoint(e.getWorldDirection(il.normal),cl.setFromMatrixPosition(t.matrixWorld)),ml!==t&&null!==ml&&(this.dispatchEvent({type:"hoveroff",object:ml}),n.style.cursor="auto",ml=null),ml!==t&&(this.dispatchEvent({type:"hoveron",object:t}),n.style.cursor="pointer",ml=t)}else null!==ml&&(this.dispatchEvent({type:"hoveroff",object:ml}),n.style.cursor="auto",ml=null);ll.copy(sl)}}function wl(t){const e=this.object,n=this.domElement,r=this.raycaster;!1!==this.enabled&&(this._updatePointer(t),this._updateState(t),gl.length=0,r.setFromCamera(sl,e),r.intersectObjects(this.objects,this.recursive,gl),gl.length>0&&(fl=!0===this.transformGroup?El(gl[0].object):gl[0].object,il.setFromNormalAndCoplanarPoint(e.getWorldDirection(il.normal),cl.setFromMatrixPosition(fl.matrixWorld)),r.ray.intersectPlane(il,ul)&&(this.state===yl?(hl.copy(fl.parent.matrixWorld).invert(),ol.copy(ul).sub(cl.setFromMatrixPosition(fl.matrixWorld))):this.state===_l&&(dl.set(0,1,0).applyQuaternion(e.quaternion).normalize(),pl.set(1,0,0).applyQuaternion(e.quaternion).normalize())),n.style.cursor="move",this.dispatchEvent({type:"dragstart",object:fl})),ll.copy(sl))}function Sl(){!1!==this.enabled&&(fl&&(this.dispatchEvent({type:"dragend",object:fl}),fl=null),this.domElement.style.cursor=ml?"pointer":"auto",this.state=vl)}function Ml(t){!1!==this.enabled&&t.preventDefault()}function El(t,e=null){return t.isGroup&&(e=t),null===t.parent?e:El(t.parent,e)}var Tl=n(13320),Al=n(5271),Cl=n(80621),Rl=n(44200),Nl=n(54476),Pl=n(64794),Il=n(88291),Ol=n(42358),Dl=n(66819),Ll=n(49085),Ul=n(86925),kl=n(37996);function Bl(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function Fl(t,e,n){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,e||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function zl(t,e){if(null==t)return{};var n,r,i=function(t,e){if(null==t)return{};var n,r,i={},s=Object.keys(t);for(r=0;r<s.length;r++)n=s[r],e.indexOf(n)>=0||(i[n]=t[n]);return i}(t,e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);for(r=0;r<s.length;r++)n=s[r],e.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(t,n)&&(i[n]=t[n])}return i}function Vl(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,i,s,o,a=[],l=!0,u=!1;try{if(s=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;l=!1}else for(;!(l=(r=s.call(n)).done)&&(a.push(r.value),a.length!==e);l=!0);}catch(t){u=!0,i=t}finally{try{if(!l&&null!=n.return&&(o=n.return(),Object(o)!==o))return}finally{if(u)throw i}}return a}}(t,e)||jl(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Gl(t){return function(t){if(Array.isArray(t))return Hl(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||jl(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function jl(t,e){if(t){if("string"==typeof t)return Hl(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Hl(t,e):void 0}}function Hl(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var Wl=["createObj","updateObj","exitObj","objBindAttr","dataBindAttr"];function ql(t,e,n){var r=n.objBindAttr,i=void 0===r?"__obj":r,s=n.dataBindAttr,o=void 0===s?"__data":s,a=n.idAccessor,l=n.purge,u=void 0!==l&&l,c=function(t){return t.hasOwnProperty(o)},h=e.filter((function(t){return!c(t)})),d=e.filter(c).map((function(t){return t[o]})),p=u?{enter:t,exit:d,update:[]}:function(t,e,n){var r={enter:[],update:[],exit:[]};if(n){var i=(0,kl.Z)(t,n,!1),s=(0,kl.Z)(e,n,!1),o=Object.assign({},i,s);Object.entries(o).forEach((function(t){var e=Vl(t,2),n=e[0],o=e[1],a=i.hasOwnProperty(n)?s.hasOwnProperty(n)?"update":"exit":"enter";r[a].push("update"===a?[i[n],s[n]]:o)}))}else{var a=new Set(t),l=new Set(e);new Set([].concat(Gl(a),Gl(l))).forEach((function(t){var e=a.has(t)?l.has(t)?"update":"exit":"enter";r[e].push("update"===e?[t,t]:t)}))}return r}(d,t,a);return p.update=p.update.map((function(t){var e=Vl(t,2),n=e[0],r=e[1];return n!==r&&(r[i]=n[i],r[i][o]=r),r})),p.exit=p.exit.concat(h.map((function(t){return Fl({},i,t)}))),p}function Xl(t,e,n,r,i){var s=i.createObj,o=void 0===s?function(t){return{}}:s,a=i.updateObj,l=void 0===a?function(t,e){}:a,u=i.exitObj,c=void 0===u?function(t){}:u,h=i.objBindAttr,d=void 0===h?"__obj":h,p=i.dataBindAttr,f=void 0===p?"__data":p,m=zl(i,Wl),g=ql(t,e,function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?Bl(Object(n),!0).forEach((function(e){Fl(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Bl(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}({objBindAttr:d,dataBindAttr:f},m)),v=g.enter,y=g.update;g.exit.forEach((function(t){var e=t[d];delete t[d],c(e),r(e)}));var _=function(t){var e=[];return t.forEach((function(t){var n=o(t);n&&(n[f]=t,t[d]=n,e.push(n))})),e}(v);!function(t){t.forEach((function(t){var e=t[d];e&&(e[f]=t,l(e,t))}))}([].concat(Gl(v),Gl(y))),_.forEach(n)}var Zl=n(9771),$l=n(22059),Yl=n(20680);function Kl(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}function Jl(t,e,n){return e=nu(e),function(t,e){if(e&&("object"==typeof e||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,iu()?Reflect.construct(e,n||[],nu(t).constructor):e.apply(t,n))}function Ql(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function tu(t,e,n){return Object.defineProperty(t,"prototype",{writable:!1}),t}function eu(t,e,n){return(e=function(t){var e=function(t,e){if("object"!=typeof t||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,e||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:e+""}(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function nu(t){return nu=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},nu(t)}function ru(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&lu(t,e)}function iu(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(iu=function(){return!!t})()}function su(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function ou(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?su(Object(n),!0).forEach((function(e){eu(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):su(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function au(t,e){if(null==t)return{};var n,r,i=function(t,e){if(null==t)return{};var n={};for(var r in t)if({}.hasOwnProperty.call(t,r)){if(e.includes(r))continue;n[r]=t[r]}return n}(t,e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);for(r=0;r<s.length;r++)n=s[r],e.includes(n)||{}.propertyIsEnumerable.call(t,n)&&(i[n]=t[n])}return i}function lu(t,e){return lu=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},lu(t,e)}function uu(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,i,s,o,a=[],l=!0,u=!1;try{if(s=(n=n.call(t)).next,0===e);else for(;!(l=(r=s.call(n)).done)&&(a.push(r.value),a.length!==e);l=!0);}catch(t){u=!0,i=t}finally{try{if(!l&&null!=n.return&&(o=n.return(),Object(o)!==o))return}finally{if(u)throw i}}return a}}(t,e)||du(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function cu(t){return function(t){if(Array.isArray(t))return Kl(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||du(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function hu(t){return hu="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},hu(t)}function du(t,e){if(t){if("string"==typeof t)return Kl(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Kl(t,e):void 0}}var pu=function(t){t instanceof Array?t.forEach(pu):(t.map&&t.map.dispose(),t.dispose())},fu=function(t){t.geometry&&t.geometry.dispose(),t.material&&pu(t.material),t.texture&&t.texture.dispose(),t.children&&t.children.forEach(fu)},mu=function(t){for(;t.children.length;){var e=t.children[0];t.remove(e),fu(e)}},gu=["objFilter"];function vu(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=n.objFilter,i=void 0===r?function(){return!0}:r,s=au(n,gu);return Xl(t,e.children.filter(i),(function(t){return e.add(t)}),(function(t){e.remove(t),mu(t)}),ou({objBindAttr:"__threeObj"},s))}var yu=function(t){return isNaN(t)?parseInt((0,Yl.Z)(t).toHex(),16):t},_u=function(t){return isNaN(t)?(0,Yl.Z)(t).getAlpha():1},xu=(0,Zl.Z)($l.Z);function bu(t,e,n){e&&"string"==typeof n&&t.filter((function(t){return!t[n]})).forEach((function(t){t[n]=xu(e(t))}))}var wu=window.THREE?window.THREE:{Group:Co,Mesh:br,MeshLambertMaterial:ma,Color:Wn,BufferGeometry:ur,BufferAttribute:Jn,Matrix4:Je,Vector3:we,SphereGeometry:pa,CylinderGeometry:ha,TubeGeometry:fa,ConeGeometry:da,Line:qo,LineBasicMaterial:Bo,QuadraticBezierCurve3:la,CubicBezierCurve3:sa,Box3:Ee},Su={graph:Pl,forcelayout:Il},Mu=(new wu.BufferGeometry).setAttribute?"setAttribute":"addAttribute",Eu=(new wu.BufferGeometry).applyMatrix4?"applyMatrix4":"applyMatrix",Tu=(0,Ol.Z)({props:{jsonUrl:{onChange:function(t,e){var n=this;t&&!e.fetchingJson&&(e.fetchingJson=!0,e.onLoading(),fetch(t).then((function(t){return t.json()})).then((function(t){e.fetchingJson=!1,e.onFinishLoading(t),n.graphData(t)})))},triggerUpdate:!1},graphData:{default:{nodes:[],links:[]},onChange:function(t,e){e.engineRunning=!1}},numDimensions:{default:3,onChange:function(t,e){var n=e.d3ForceLayout.force("charge");function r(t,e){t.forEach((function(t){delete t[e],delete t["v".concat(e)]}))}n&&n.strength(t>2?-60:-30),t<3&&r(e.graphData.nodes,"z"),t<2&&r(e.graphData.nodes,"y")}},dagMode:{onChange:function(t,e){!t&&"d3"===e.forceEngine&&(e.graphData.nodes||[]).forEach((function(t){return t.fx=t.fy=t.fz=void 0}))}},dagLevelDistance:{},dagNodeFilter:{default:function(t){return!0}},onDagError:{triggerUpdate:!1},nodeRelSize:{default:4},nodeId:{default:"id"},nodeVal:{default:"val"},nodeResolution:{default:8},nodeColor:{default:"color"},nodeAutoColorBy:{},nodeOpacity:{default:.75},nodeVisibility:{default:!0},nodeThreeObject:{},nodeThreeObjectExtend:{default:!1},nodePositionUpdate:{triggerUpdate:!1},linkSource:{default:"source"},linkTarget:{default:"target"},linkVisibility:{default:!0},linkColor:{default:"color"},linkAutoColorBy:{},linkOpacity:{default:.2},linkWidth:{},linkResolution:{default:6},linkCurvature:{default:0,triggerUpdate:!1},linkCurveRotation:{default:0,triggerUpdate:!1},linkMaterial:{},linkThreeObject:{},linkThreeObjectExtend:{default:!1},linkPositionUpdate:{triggerUpdate:!1},linkDirectionalArrowLength:{default:0},linkDirectionalArrowColor:{},linkDirectionalArrowRelPos:{default:.5,triggerUpdate:!1},linkDirectionalArrowResolution:{default:8},linkDirectionalParticles:{default:0},linkDirectionalParticleSpeed:{default:.01,triggerUpdate:!1},linkDirectionalParticleWidth:{default:.5},linkDirectionalParticleColor:{},linkDirectionalParticleResolution:{default:4},forceEngine:{default:"d3"},d3AlphaMin:{default:0},d3AlphaDecay:{default:.0228,triggerUpdate:!1,onChange:function(t,e){e.d3ForceLayout.alphaDecay(t)}},d3AlphaTarget:{default:0,triggerUpdate:!1,onChange:function(t,e){e.d3ForceLayout.alphaTarget(t)}},d3VelocityDecay:{default:.4,triggerUpdate:!1,onChange:function(t,e){e.d3ForceLayout.velocityDecay(t)}},ngraphPhysics:{default:{timeStep:20,gravity:-1.2,theta:.8,springLength:30,springCoefficient:8e-4,dragCoefficient:.02}},warmupTicks:{default:0,triggerUpdate:!1},cooldownTicks:{default:1/0,triggerUpdate:!1},cooldownTime:{default:15e3,triggerUpdate:!1},onLoading:{default:function(){},triggerUpdate:!1},onFinishLoading:{default:function(){},triggerUpdate:!1},onUpdate:{default:function(){},triggerUpdate:!1},onFinishUpdate:{default:function(){},triggerUpdate:!1},onEngineTick:{default:function(){},triggerUpdate:!1},onEngineStop:{default:function(){},triggerUpdate:!1}},methods:{refresh:function(t){return t._flushObjects=!0,t._rerender(),this},d3Force:function(t,e,n){return void 0===n?t.d3ForceLayout.force(e):(t.d3ForceLayout.force(e,n),this)},d3ReheatSimulation:function(t){return t.d3ForceLayout.alpha(1),this.resetCountdown(),this},resetCountdown:function(t){return t.cntTicks=0,t.startTickTime=new Date,t.engineRunning=!0,this},tickFrame:function(t){var e,n,r,i,s="ngraph"!==t.forceEngine;return t.engineRunning&&function(){++t.cntTicks>t.cooldownTicks||new Date-t.startTickTime>t.cooldownTime||s&&t.d3AlphaMin>0&&t.d3ForceLayout.alpha()<t.d3AlphaMin?(t.engineRunning=!1,t.onEngineStop()):(t.layout[s?"tick":"step"](),t.onEngineTick());var e=(0,Dl.Z)(t.nodeThreeObjectExtend);t.graphData.nodes.forEach((function(n){var r=n.__threeObj;if(r){var i=s?n:t.layout.getNodePosition(n[t.nodeId]),o=e(n);t.nodePositionUpdate&&t.nodePositionUpdate(o?r.children[0]:r,{x:i.x,y:i.y,z:i.z},n)&&!o||(r.position.x=i.x,r.position.y=i.y||0,r.position.z=i.z||0)}}));var n=(0,Dl.Z)(t.linkWidth),r=(0,Dl.Z)(t.linkCurvature),i=(0,Dl.Z)(t.linkCurveRotation),o=(0,Dl.Z)(t.linkThreeObjectExtend);function a(e){var n=s?e:t.layout.getLinkPosition(t.layout.graph.getLink(e.source,e.target).id),o=n[s?"source":"from"],a=n[s?"target":"to"];if(o&&a&&o.hasOwnProperty("x")&&a.hasOwnProperty("x")){var l=r(e);if(l){var u,c=new wu.Vector3(o.x,o.y||0,o.z||0),h=new wu.Vector3(a.x,a.y||0,a.z||0),d=c.distanceTo(h),p=i(e);if(d>0){var f=a.x-o.x,m=a.y-o.y||0,g=(new wu.Vector3).subVectors(h,c),v=g.clone().multiplyScalar(l).cross(0!==f||0!==m?new wu.Vector3(0,0,1):new wu.Vector3(0,1,0)).applyAxisAngle(g.normalize(),p).add((new wu.Vector3).addVectors(c,h).divideScalar(2));u=new wu.QuadraticBezierCurve3(c,v,h)}else{var y=70*l,_=-p,x=_+Math.PI/2;u=new wu.CubicBezierCurve3(c,new wu.Vector3(y*Math.cos(x),y*Math.sin(x),0).add(c),new wu.Vector3(y*Math.cos(_),y*Math.sin(_),0).add(c),h)}e.__curve=u}else e.__curve=null}}t.graphData.links.forEach((function(e){var r=e.__lineObj;if(r){var i=s?e:t.layout.getLinkPosition(t.layout.graph.getLink(e.source,e.target).id),l=i[s?"source":"from"],u=i[s?"target":"to"];if(l&&u&&l.hasOwnProperty("x")&&u.hasOwnProperty("x")){a(e);var c=o(e);if(!t.linkPositionUpdate||!t.linkPositionUpdate(c?r.children[1]:r,{start:{x:l.x,y:l.y,z:l.z},end:{x:u.x,y:u.y,z:u.z}},e)||c){var h=30,d=e.__curve,p=r.children.length?r.children[0]:r;if("Line"===p.type){if(d){var f=d.getPoints(h);p.geometry.getAttribute("position").array.length!==3*f.length&&p.geometry[Mu]("position",new wu.BufferAttribute(new Float32Array(3*f.length),3)),p.geometry.setFromPoints(f)}else{var m=p.geometry.getAttribute("position");m&&m.array&&6===m.array.length||p.geometry[Mu]("position",m=new wu.BufferAttribute(new Float32Array(6),3)),m.array[0]=l.x,m.array[1]=l.y||0,m.array[2]=l.z||0,m.array[3]=u.x,m.array[4]=u.y||0,m.array[5]=u.z||0,m.needsUpdate=!0}p.geometry.computeBoundingSphere()}else if("Mesh"===p.type)if(d){p.geometry.type.match(/^Tube(Buffer)?Geometry$/)||(p.position.set(0,0,0),p.rotation.set(0,0,0),p.scale.set(1,1,1));var g=Math.ceil(10*n(e))/10/2,v=new wu.TubeGeometry(d,h,g,t.linkResolution,!1);p.geometry.dispose(),p.geometry=v}else{if(!p.geometry.type.match(/^Cylinder(Buffer)?Geometry$/)){var y=Math.ceil(10*n(e))/10/2,_=new wu.CylinderGeometry(y,y,1,t.linkResolution,1,!1);_[Eu]((new wu.Matrix4).makeTranslation(0,.5,0)),_[Eu]((new wu.Matrix4).makeRotationX(Math.PI/2)),p.geometry.dispose(),p.geometry=_}var x=new wu.Vector3(l.x,l.y||0,l.z||0),b=new wu.Vector3(u.x,u.y||0,u.z||0),w=x.distanceTo(b);p.position.x=x.x,p.position.y=x.y,p.position.z=x.z,p.scale.z=w,p.parent.localToWorld(b),p.lookAt(b)}}}}}))}(),e=(0,Dl.Z)(t.linkDirectionalArrowRelPos),n=(0,Dl.Z)(t.linkDirectionalArrowLength),r=(0,Dl.Z)(t.nodeVal),t.graphData.links.forEach((function(i){var o=i.__arrowObj;if(o){var a=s?i:t.layout.getLinkPosition(t.layout.graph.getLink(i.source,i.target).id),l=a[s?"source":"from"],u=a[s?"target":"to"];if(l&&u&&l.hasOwnProperty("x")&&u.hasOwnProperty("x")){var c=Math.cbrt(Math.max(0,r(l)||1))*t.nodeRelSize,h=Math.cbrt(Math.max(0,r(u)||1))*t.nodeRelSize,d=n(i),p=e(i),f=i.__curve?function(t){return i.__curve.getPoint(t)}:function(t){var e=function(t,e,n,r){return e[t]+(n[t]-e[t])*r||0};return{x:e("x",l,u,t),y:e("y",l,u,t),z:e("z",l,u,t)}},m=i.__curve?i.__curve.getLength():Math.sqrt(["x","y","z"].map((function(t){return Math.pow((u[t]||0)-(l[t]||0),2)})).reduce((function(t,e){return t+e}),0)),g=c+d+(m-c-h-d)*p,v=f(g/m),y=f((g-d)/m);["x","y","z"].forEach((function(t){return o.position[t]=y[t]}));var _=function(t,e,n){if(iu())return Reflect.construct.apply(null,arguments);var r=[null];return r.push.apply(r,e),new(t.bind.apply(t,r))}(wu.Vector3,cu(["x","y","z"].map((function(t){return v[t]}))));o.parent.localToWorld(_),o.lookAt(_)}}})),i=(0,Dl.Z)(t.linkDirectionalParticleSpeed),t.graphData.links.forEach((function(e){var n=e.__photonsObj&&e.__photonsObj.children,r=e.__singleHopPhotonsObj&&e.__singleHopPhotonsObj.children;if(r&&r.length||n&&n.length){var o=s?e:t.layout.getLinkPosition(t.layout.graph.getLink(e.source,e.target).id),a=o[s?"source":"from"],l=o[s?"target":"to"];if(a&&l&&a.hasOwnProperty("x")&&l.hasOwnProperty("x")){var u=i(e),c=e.__curve?function(t){return e.__curve.getPoint(t)}:function(t){var e=function(t,e,n,r){return e[t]+(n[t]-e[t])*r||0};return{x:e("x",a,l,t),y:e("y",a,l,t),z:e("z",a,l,t)}};[].concat(cu(n||[]),cu(r||[])).forEach((function(t,e){var r="singleHopPhotons"===t.parent.__linkThreeObjType;if(t.hasOwnProperty("__progressRatio")||(t.__progressRatio=r?0:e/n.length),t.__progressRatio+=u,t.__progressRatio>=1){if(r)return t.parent.remove(t),void mu(t);t.__progressRatio=t.__progressRatio%1}var i=t.__progressRatio,s=c(i);["x","y","z"].forEach((function(e){return t.position[e]=s[e]}))}))}}})),this},emitParticle:function(t,e){if(e&&t.graphData.links.includes(e)){if(!e.__singleHopPhotonsObj){var n=new wu.Group;n.__linkThreeObjType="singleHopPhotons",e.__singleHopPhotonsObj=n,t.graphScene.add(n)}var r=(0,Dl.Z)(t.linkDirectionalParticleWidth),i=Math.ceil(10*r(e))/10/2,s=t.linkDirectionalParticleResolution,o=new wu.SphereGeometry(i,s,s),a=(0,Dl.Z)(t.linkColor),l=(0,Dl.Z)(t.linkDirectionalParticleColor)(e)||a(e)||"#f0f0f0",u=new wu.Color(yu(l)),c=3*t.linkOpacity,h=new wu.MeshLambertMaterial({color:u,transparent:!0,opacity:c});e.__singleHopPhotonsObj.add(new wu.Mesh(o,h))}return this},getGraphBbox:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){return!0};if(!t.initialised)return null;var n=function t(n){var r=[];if(n.geometry){n.geometry.computeBoundingBox();var i=new wu.Box3;i.copy(n.geometry.boundingBox).applyMatrix4(n.matrixWorld),r.push(i)}return r.concat.apply(r,cu((n.children||[]).filter((function(t){return!t.hasOwnProperty("__graphObjType")||"node"===t.__graphObjType&&e(t.__data)})).map(t)))}(t.graphScene);return n.length?Object.assign.apply(Object,cu(["x","y","z"].map((function(t){return eu({},t,[(0,Ll.Z)(n,(function(e){return e.min[t]})),(0,Ul.Z)(n,(function(e){return e.max[t]}))])})))):null}},stateInit:function(){return{d3ForceLayout:(0,Tl.Z)().force("link",(0,Al.Z)()).force("charge",(0,Cl.Z)()).force("center",(0,Rl.Z)()).force("dagRadial",null).stop(),engineRunning:!1}},init:function(t,e){e.graphScene=t},update:function(t,e){var n=function(t){return t.some((function(t){return e.hasOwnProperty(t)}))};if(t.engineRunning=!1,t.onUpdate(),null!==t.nodeAutoColorBy&&n(["nodeAutoColorBy","graphData","nodeColor"])&&bu(t.graphData.nodes,(0,Dl.Z)(t.nodeAutoColorBy),t.nodeColor),null!==t.linkAutoColorBy&&n(["linkAutoColorBy","graphData","linkColor"])&&bu(t.graphData.links,(0,Dl.Z)(t.linkAutoColorBy),t.linkColor),t._flushObjects||n(["graphData","nodeThreeObject","nodeThreeObjectExtend","nodeVal","nodeColor","nodeVisibility","nodeRelSize","nodeResolution","nodeOpacity"])){var r=(0,Dl.Z)(t.nodeThreeObject),i=(0,Dl.Z)(t.nodeThreeObjectExtend),s=(0,Dl.Z)(t.nodeVal),o=(0,Dl.Z)(t.nodeColor),a=(0,Dl.Z)(t.nodeVisibility),l={},u={};vu(t.graphData.nodes.filter(a),t.graphScene,{purge:t._flushObjects||n(["nodeThreeObject","nodeThreeObjectExtend"]),objFilter:function(t){return"node"===t.__graphObjType},createObj:function(e){var n,s=r(e),o=i(e);return s&&t.nodeThreeObject===s&&(s=s.clone()),s&&!o?n=s:((n=new wu.Mesh).__graphDefaultObj=!0,s&&o&&n.add(s)),n.__graphObjType="node",n},updateObj:function(e,n){if(e.__graphDefaultObj){var r=s(n)||1,i=Math.cbrt(r)*t.nodeRelSize,a=t.nodeResolution;e.geometry.type.match(/^Sphere(Buffer)?Geometry$/)&&e.geometry.parameters.radius===i&&e.geometry.parameters.widthSegments===a||(l.hasOwnProperty(r)||(l[r]=new wu.SphereGeometry(i,a,a)),e.geometry.dispose(),e.geometry=l[r]);var c=o(n),h=new wu.Color(yu(c||"#ffffaa")),d=t.nodeOpacity*_u(c);"MeshLambertMaterial"===e.material.type&&e.material.color.equals(h)&&e.material.opacity===d||(u.hasOwnProperty(c)||(u[c]=new wu.MeshLambertMaterial({color:h,transparent:!0,opacity:d})),e.material.dispose(),e.material=u[c])}}})}if(t._flushObjects||n(["graphData","linkThreeObject","linkThreeObjectExtend","linkMaterial","linkColor","linkWidth","linkVisibility","linkResolution","linkOpacity","linkDirectionalArrowLength","linkDirectionalArrowColor","linkDirectionalArrowResolution","linkDirectionalParticles","linkDirectionalParticleWidth","linkDirectionalParticleColor","linkDirectionalParticleResolution"])){var c=(0,Dl.Z)(t.linkThreeObject),h=(0,Dl.Z)(t.linkThreeObjectExtend),d=(0,Dl.Z)(t.linkMaterial),p=(0,Dl.Z)(t.linkVisibility),f=(0,Dl.Z)(t.linkColor),m=(0,Dl.Z)(t.linkWidth),g={},v={},y={},_=t.graphData.links.filter(p);if(vu(_,t.graphScene,{objBindAttr:"__lineObj",purge:t._flushObjects||n(["linkThreeObject","linkThreeObjectExtend","linkWidth"]),objFilter:function(t){return"link"===t.__graphObjType},exitObj:function(t){var e=t.__data&&t.__data.__singleHopPhotonsObj;e&&(e.parent.remove(e),mu(e),delete t.__data.__singleHopPhotonsObj)},createObj:function(e){var n,r,i=c(e),s=h(e);if(i&&t.linkThreeObject===i&&(i=i.clone()),!i||s)if(!!m(e))n=new wu.Mesh;else{var o=new wu.BufferGeometry;o[Mu]("position",new wu.BufferAttribute(new Float32Array(6),3)),n=new wu.Line(o)}return i?s?((r=new wu.Group).__graphDefaultObj=!0,r.add(n),r.add(i)):r=i:(r=n).__graphDefaultObj=!0,r.renderOrder=10,r.__graphObjType="link",r},updateObj:function(e,n){if(e.__graphDefaultObj){var r=e.children.length?e.children[0]:e,i=Math.ceil(10*m(n))/10,s=!!i;if(s){var o=i/2,a=t.linkResolution;if(!r.geometry.type.match(/^Cylinder(Buffer)?Geometry$/)||r.geometry.parameters.radiusTop!==o||r.geometry.parameters.radialSegments!==a){if(!g.hasOwnProperty(i)){var l=new wu.CylinderGeometry(o,o,1,a,1,!1);l[Eu]((new wu.Matrix4).makeTranslation(0,.5,0)),l[Eu]((new wu.Matrix4).makeRotationX(Math.PI/2)),g[i]=l}r.geometry.dispose(),r.geometry=g[i]}}var u=d(n);if(u)r.material=u;else{var c=f(n),h=new wu.Color(yu(c||"#f0f0f0")),p=t.linkOpacity*_u(c),_=s?"MeshLambertMaterial":"LineBasicMaterial";if(r.material.type!==_||!r.material.color.equals(h)||r.material.opacity!==p){var x=s?v:y;x.hasOwnProperty(c)||(x[c]=new wu[_]({color:h,transparent:p<1,opacity:p,depthWrite:p>=1})),r.material.dispose(),r.material=x[c]}}}}}),t.linkDirectionalArrowLength||e.hasOwnProperty("linkDirectionalArrowLength")){var x=(0,Dl.Z)(t.linkDirectionalArrowLength),b=(0,Dl.Z)(t.linkDirectionalArrowColor);vu(_.filter(x),t.graphScene,{objBindAttr:"__arrowObj",objFilter:function(t){return"arrow"===t.__linkThreeObjType},createObj:function(){var t=new wu.Mesh(void 0,new wu.MeshLambertMaterial({transparent:!0}));return t.__linkThreeObjType="arrow",t},updateObj:function(e,n){var r=x(n),i=t.linkDirectionalArrowResolution;if(!e.geometry.type.match(/^Cone(Buffer)?Geometry$/)||e.geometry.parameters.height!==r||e.geometry.parameters.radialSegments!==i){var s=new wu.ConeGeometry(.25*r,r,i);s.translate(0,r/2,0),s.rotateX(Math.PI/2),e.geometry.dispose(),e.geometry=s}var o=b(n)||f(n)||"#f0f0f0";e.material.color=new wu.Color(yu(o)),e.material.opacity=3*t.linkOpacity*_u(o)}})}if(t.linkDirectionalParticles||e.hasOwnProperty("linkDirectionalParticles")){var w=(0,Dl.Z)(t.linkDirectionalParticles),S=(0,Dl.Z)(t.linkDirectionalParticleWidth),M=(0,Dl.Z)(t.linkDirectionalParticleColor),E={},T={};vu(_.filter(w),t.graphScene,{objBindAttr:"__photonsObj",objFilter:function(t){return"photons"===t.__linkThreeObjType},createObj:function(){var t=new wu.Group;return t.__linkThreeObjType="photons",t},updateObj:function(e,n){var r,i=Math.round(Math.abs(w(n))),s=!!e.children.length&&e.children[0],o=Math.ceil(10*S(n))/10/2,a=t.linkDirectionalParticleResolution;s&&s.geometry.parameters.radius===o&&s.geometry.parameters.widthSegments===a?r=s.geometry:(T.hasOwnProperty(o)||(T[o]=new wu.SphereGeometry(o,a,a)),r=T[o],s&&s.geometry.dispose());var l,u=M(n)||f(n)||"#f0f0f0",c=new wu.Color(yu(u)),h=3*t.linkOpacity;s&&s.material.color.equals(c)&&s.material.opacity===h?l=s.material:(E.hasOwnProperty(u)||(E[u]=new wu.MeshLambertMaterial({color:c,transparent:!0,opacity:h})),l=E[u],s&&s.material.dispose()),vu(cu(new Array(i)).map((function(t,e){return{idx:e}})),e,{idAccessor:function(t){return t.idx},createObj:function(){return new wu.Mesh(r,l)},updateObj:function(t){t.geometry=r,t.material=l}})}})}}if(t._flushObjects=!1,n(["graphData","nodeId","linkSource","linkTarget","numDimensions","forceEngine","dagMode","dagNodeFilter","dagLevelDistance"])){t.engineRunning=!1,t.graphData.links.forEach((function(e){e.source=e[t.linkSource],e.target=e[t.linkTarget]}));var A,C="ngraph"!==t.forceEngine;if(C){(A=t.d3ForceLayout).stop().alpha(1).numDimensions(t.numDimensions).nodes(t.graphData.nodes);var R=t.d3ForceLayout.force("link");R&&R.id((function(e){return e[t.nodeId]})).links(t.graphData.links);var N=t.dagMode&&function(t,e){var n=t.nodes,r=t.links,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},s=i.nodeFilter,o=void 0===s?function(){return!0}:s,a=i.onLoopError,l=void 0===a?function(t){throw"Invalid DAG structure! Found cycle in node path: ".concat(t.join(" -> "),".")}:a,u={};n.forEach((function(t){return u[e(t)]={data:t,out:[],depth:-1,skip:!o(t)}})),r.forEach((function(t){var n=t.source,r=t.target,i=l(n),s=l(r);if(!u.hasOwnProperty(i))throw"Missing source node with id: ".concat(i);if(!u.hasOwnProperty(s))throw"Missing target node with id: ".concat(s);var o=u[i],a=u[s];function l(t){return"object"===hu(t)?e(t):t}o.out.push(a)}));var c=[];d(Object.values(u));var h=Object.assign.apply(Object,[{}].concat(cu(Object.entries(u).filter((function(t){return!uu(t,2)[1].skip})).map((function(t){var e=uu(t,2);return eu({},e[0],e[1].depth)})))));return h;function d(t){for(var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=function(){var i=t[s];if(-1!==n.indexOf(i)){var o=[].concat(cu(n.slice(n.indexOf(i))),[i]).map((function(t){return e(t.data)}));return c.some((function(t){return t.length===o.length&&t.every((function(t,e){return t===o[e]}))}))||(c.push(o),l(o)),1}r>i.depth&&(i.depth=r,d(i.out,[].concat(cu(n),[i]),r+(i.skip?0:1)))},s=0,o=t.length;s<o;s++)i()}}(t.graphData,(function(e){return e[t.nodeId]}),{nodeFilter:t.dagNodeFilter,onLoopError:t.onDagError||void 0}),P=Math.max.apply(Math,cu(Object.values(N||[]))),I=t.dagLevelDistance||t.graphData.nodes.length/(P||1)*2*(-1!==["radialin","radialout"].indexOf(t.dagMode)?.7:1);if(["lr","rl","td","bu","zin","zout"].includes(e.dagMode)){var O=["lr","rl"].includes(e.dagMode)?"fx":["td","bu"].includes(e.dagMode)?"fy":"fz";t.graphData.nodes.filter(t.dagNodeFilter).forEach((function(t){return delete t[O]}))}if(["lr","rl","td","bu","zin","zout"].includes(t.dagMode)){var D=["rl","td","zout"].includes(t.dagMode),L=["lr","rl"].includes(t.dagMode)?"fx":["td","bu"].includes(t.dagMode)?"fy":"fz";t.graphData.nodes.filter(t.dagNodeFilter).forEach((function(e){return e[L]=function(e){return(N[e[t.nodeId]]-P/2)*I*(D?-1:1)}(e)}))}t.d3ForceLayout.force("dagRadial",-1!==["radialin","radialout"].indexOf(t.dagMode)?(0,Nl.Z)((function(e){var n=N[e[t.nodeId]]||-1;return("radialin"===t.dagMode?P-n:n)*I})).strength((function(e){return t.dagNodeFilter(e)?1:0})):null)}else{var U=Su.graph();t.graphData.nodes.forEach((function(e){U.addNode(e[t.nodeId])})),t.graphData.links.forEach((function(t){U.addLink(t.source,t.target)})),(A=Su.forcelayout(U,ou({dimensions:t.numDimensions},t.ngraphPhysics))).graph=U}for(var k=0;k<t.warmupTicks&&!(C&&t.d3AlphaMin>0&&t.d3ForceLayout.alpha()<t.d3AlphaMin);k++)A[C?"tick":"step"]();t.layout=A,this.resetCountdown()}t.engineRunning=!0,t.onFinishUpdate()}});var Au=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Object,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=function(e){function r(){var e;Ql(this,r);for(var i=arguments.length,s=new Array(i),o=0;o<i;o++)s[o]=arguments[o];return(e=Jl(this,r,[].concat(s))).__kapsuleInstance=t().apply(void 0,[].concat(cu(n?[e]:[]),s)),e}return ru(r,e),tu(r)}(e);return Object.keys(t()).forEach((function(t){return r.prototype[t]=function(){var e,n=(e=this.__kapsuleInstance)[t].apply(e,arguments);return n===this.__kapsuleInstance?this:n}})),r}(Tu,(window.THREE?window.THREE:{Group:Co}).Group,!0);const Cu="170",Ru=100,Nu=204,Pu=205,Iu=300,Ou=301,Du=302,Lu=303,Uu=304,ku=306,Bu=1e3,Fu=1001,zu=1002,Vu=1003,Gu=1004,ju=1005,Hu=1006,Wu=1007,qu=1008,Xu=1009,Zu=1010,$u=1011,Yu=1012,Ku=1013,Ju=1014,Qu=1015,tc=1016,ec=1020,nc=1022,rc=1023,ic=1026,sc=1027,oc=1028,ac=1029,lc=1030,uc=1031,cc=1033,hc=33776,dc=33777,pc=33778,fc=33779,mc=37492,gc=37496,vc=37808,yc=37809,_c=37810,xc=37811,bc=37812,wc=37813,Sc=37814,Mc=37815,Ec=37816,Tc=37817,Ac=37818,Cc=37819,Rc=37820,Nc=37821,Pc=36492,Ic=2300,Oc=2301,Dc=2302,Lc=2400,Uc=2401,kc=2402,Bc="",Fc="srgb",zc="srgb-linear",Vc="linear",Gc="srgb",jc=7680,Hc=35044,Wc=35048,qc=2e3,Xc=2001;class Zc{addEventListener(t,e){void 0===this._listeners&&(this._listeners={});const n=this._listeners;void 0===n[t]&&(n[t]=[]),-1===n[t].indexOf(e)&&n[t].push(e)}hasEventListener(t,e){if(void 0===this._listeners)return!1;const n=this._listeners;return void 0!==n[t]&&-1!==n[t].indexOf(e)}removeEventListener(t,e){if(void 0===this._listeners)return;const n=this._listeners[t];if(void 0!==n){const t=n.indexOf(e);-1!==t&&n.splice(t,1)}}dispatchEvent(t){if(void 0===this._listeners)return;const e=this._listeners[t.type];if(void 0!==e){t.target=this;const n=e.slice(0);for(let e=0,r=n.length;e<r;e++)n[e].call(this,t);t.target=null}}}const $c=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let Yc=1234567;const Kc=Math.PI/180,Jc=180/Math.PI;function Qc(){const t=4294967295*Math.random()|0,e=4294967295*Math.random()|0,n=4294967295*Math.random()|0,r=4294967295*Math.random()|0;return($c[255&t]+$c[t>>8&255]+$c[t>>16&255]+$c[t>>24&255]+"-"+$c[255&e]+$c[e>>8&255]+"-"+$c[e>>16&15|64]+$c[e>>24&255]+"-"+$c[63&n|128]+$c[n>>8&255]+"-"+$c[n>>16&255]+$c[n>>24&255]+$c[255&r]+$c[r>>8&255]+$c[r>>16&255]+$c[r>>24&255]).toLowerCase()}function th(t,e,n){return Math.max(e,Math.min(n,t))}function eh(t,e){return(t%e+e)%e}function nh(t,e,n){return(1-n)*t+n*e}function rh(t,e){switch(e.constructor){case Float32Array:return t;case Uint32Array:return t/4294967295;case Uint16Array:return t/65535;case Uint8Array:return t/255;case Int32Array:return Math.max(t/2147483647,-1);case Int16Array:return Math.max(t/32767,-1);case Int8Array:return Math.max(t/127,-1);default:throw new Error("Invalid component type.")}}function ih(t,e){switch(e.constructor){case Float32Array:return t;case Uint32Array:return Math.round(4294967295*t);case Uint16Array:return Math.round(65535*t);case Uint8Array:return Math.round(255*t);case Int32Array:return Math.round(2147483647*t);case Int16Array:return Math.round(32767*t);case Int8Array:return Math.round(127*t);default:throw new Error("Invalid component type.")}}const sh={DEG2RAD:Kc,RAD2DEG:Jc,generateUUID:Qc,clamp:th,euclideanModulo:eh,mapLinear:function(t,e,n,r,i){return r+(t-e)*(i-r)/(n-e)},inverseLerp:function(t,e,n){return t!==e?(n-t)/(e-t):0},lerp:nh,damp:function(t,e,n,r){return nh(t,e,1-Math.exp(-n*r))},pingpong:function(t,e=1){return e-Math.abs(eh(t,2*e)-e)},smoothstep:function(t,e,n){return t<=e?0:t>=n?1:(t=(t-e)/(n-e))*t*(3-2*t)},smootherstep:function(t,e,n){return t<=e?0:t>=n?1:(t=(t-e)/(n-e))*t*t*(t*(6*t-15)+10)},randInt:function(t,e){return t+Math.floor(Math.random()*(e-t+1))},randFloat:function(t,e){return t+Math.random()*(e-t)},randFloatSpread:function(t){return t*(.5-Math.random())},seededRandom:function(t){void 0!==t&&(Yc=t);let e=Yc+=1831565813;return e=Math.imul(e^e>>>15,1|e),e^=e+Math.imul(e^e>>>7,61|e),((e^e>>>14)>>>0)/4294967296},degToRad:function(t){return t*Kc},radToDeg:function(t){return t*Jc},isPowerOfTwo:function(t){return 0==(t&t-1)&&0!==t},ceilPowerOfTwo:function(t){return Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))},floorPowerOfTwo:function(t){return Math.pow(2,Math.floor(Math.log(t)/Math.LN2))},setQuaternionFromProperEuler:function(t,e,n,r,i){const s=Math.cos,o=Math.sin,a=s(n/2),l=o(n/2),u=s((e+r)/2),c=o((e+r)/2),h=s((e-r)/2),d=o((e-r)/2),p=s((r-e)/2),f=o((r-e)/2);switch(i){case"XYX":t.set(a*c,l*h,l*d,a*u);break;case"YZY":t.set(l*d,a*c,l*h,a*u);break;case"ZXZ":t.set(l*h,l*d,a*c,a*u);break;case"XZX":t.set(a*c,l*f,l*p,a*u);break;case"YXY":t.set(l*p,a*c,l*f,a*u);break;case"ZYZ":t.set(l*f,l*p,a*c,a*u);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+i)}},normalize:ih,denormalize:rh};class oh{constructor(t=0,e=0){oh.prototype.isVector2=!0,this.x=t,this.y=e}get width(){return this.x}set width(t){this.x=t}get height(){return this.y}set height(t){this.y=t}set(t,e){return this.x=t,this.y=e,this}setScalar(t){return this.x=t,this.y=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y)}copy(t){return this.x=t.x,this.y=t.y,this}add(t){return this.x+=t.x,this.y+=t.y,this}addScalar(t){return this.x+=t,this.y+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this}subScalar(t){return this.x-=t,this.y-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this}multiply(t){return this.x*=t.x,this.y*=t.y,this}multiplyScalar(t){return this.x*=t,this.y*=t,this}divide(t){return this.x/=t.x,this.y/=t.y,this}divideScalar(t){return this.multiplyScalar(1/t)}applyMatrix3(t){const e=this.x,n=this.y,r=t.elements;return this.x=r[0]*e+r[3]*n+r[6],this.y=r[1]*e+r[4]*n+r[7],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this}clampLength(t,e){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(t,Math.min(e,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(t){const e=Math.sqrt(this.lengthSq()*t.lengthSq());if(0===e)return Math.PI/2;const n=this.dot(t)/e;return Math.acos(th(n,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,n=this.y-t.y;return e*e+n*n}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this}lerpVectors(t,e,n){return this.x=t.x+(e.x-t.x)*n,this.y=t.y+(e.y-t.y)*n,this}equals(t){return t.x===this.x&&t.y===this.y}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this}rotateAround(t,e){const n=Math.cos(e),r=Math.sin(e),i=this.x-t.x,s=this.y-t.y;return this.x=i*n-s*r+t.x,this.y=i*r+s*n+t.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class ah{constructor(t,e,n,r,i,s,o,a,l){ah.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],void 0!==t&&this.set(t,e,n,r,i,s,o,a,l)}set(t,e,n,r,i,s,o,a,l){const u=this.elements;return u[0]=t,u[1]=r,u[2]=o,u[3]=e,u[4]=i,u[5]=a,u[6]=n,u[7]=s,u[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(t){const e=this.elements,n=t.elements;return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],this}extractBasis(t,e,n){return t.setFromMatrix3Column(this,0),e.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}setFromMatrix4(t){const e=t.elements;return this.set(e[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10]),this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const n=t.elements,r=e.elements,i=this.elements,s=n[0],o=n[3],a=n[6],l=n[1],u=n[4],c=n[7],h=n[2],d=n[5],p=n[8],f=r[0],m=r[3],g=r[6],v=r[1],y=r[4],_=r[7],x=r[2],b=r[5],w=r[8];return i[0]=s*f+o*v+a*x,i[3]=s*m+o*y+a*b,i[6]=s*g+o*_+a*w,i[1]=l*f+u*v+c*x,i[4]=l*m+u*y+c*b,i[7]=l*g+u*_+c*w,i[2]=h*f+d*v+p*x,i[5]=h*m+d*y+p*b,i[8]=h*g+d*_+p*w,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[3]*=t,e[6]*=t,e[1]*=t,e[4]*=t,e[7]*=t,e[2]*=t,e[5]*=t,e[8]*=t,this}determinant(){const t=this.elements,e=t[0],n=t[1],r=t[2],i=t[3],s=t[4],o=t[5],a=t[6],l=t[7],u=t[8];return e*s*u-e*o*l-n*i*u+n*o*a+r*i*l-r*s*a}invert(){const t=this.elements,e=t[0],n=t[1],r=t[2],i=t[3],s=t[4],o=t[5],a=t[6],l=t[7],u=t[8],c=u*s-o*l,h=o*a-u*i,d=l*i-s*a,p=e*c+n*h+r*d;if(0===p)return this.set(0,0,0,0,0,0,0,0,0);const f=1/p;return t[0]=c*f,t[1]=(r*l-u*n)*f,t[2]=(o*n-r*s)*f,t[3]=h*f,t[4]=(u*e-r*a)*f,t[5]=(r*i-o*e)*f,t[6]=d*f,t[7]=(n*a-l*e)*f,t[8]=(s*e-n*i)*f,this}transpose(){let t;const e=this.elements;return t=e[1],e[1]=e[3],e[3]=t,t=e[2],e[2]=e[6],e[6]=t,t=e[5],e[5]=e[7],e[7]=t,this}getNormalMatrix(t){return this.setFromMatrix4(t).invert().transpose()}transposeIntoArray(t){const e=this.elements;return t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8],this}setUvTransform(t,e,n,r,i,s,o){const a=Math.cos(i),l=Math.sin(i);return this.set(n*a,n*l,-n*(a*s+l*o)+s+t,-r*l,r*a,-r*(-l*s+a*o)+o+e,0,0,1),this}scale(t,e){return this.premultiply(lh.makeScale(t,e)),this}rotate(t){return this.premultiply(lh.makeRotation(-t)),this}translate(t,e){return this.premultiply(lh.makeTranslation(t,e)),this}makeTranslation(t,e){return t.isVector2?this.set(1,0,t.x,0,1,t.y,0,0,1):this.set(1,0,t,0,1,e,0,0,1),this}makeRotation(t){const e=Math.cos(t),n=Math.sin(t);return this.set(e,-n,0,n,e,0,0,0,1),this}makeScale(t,e){return this.set(t,0,0,0,e,0,0,0,1),this}equals(t){const e=this.elements,n=t.elements;for(let t=0;t<9;t++)if(e[t]!==n[t])return!1;return!0}fromArray(t,e=0){for(let n=0;n<9;n++)this.elements[n]=t[n+e];return this}toArray(t=[],e=0){const n=this.elements;return t[e]=n[0],t[e+1]=n[1],t[e+2]=n[2],t[e+3]=n[3],t[e+4]=n[4],t[e+5]=n[5],t[e+6]=n[6],t[e+7]=n[7],t[e+8]=n[8],t}clone(){return(new this.constructor).fromArray(this.elements)}}const lh=new ah;Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array;function uh(t){return document.createElementNS("http://www.w3.org/1999/xhtml",t)}const ch={};const hh={enabled:!0,workingColorSpace:zc,spaces:{},convert:function(t,e,n){return!1!==this.enabled&&e!==n&&e&&n?(this.spaces[e].transfer===Gc&&(t.r=dh(t.r),t.g=dh(t.g),t.b=dh(t.b)),this.spaces[e].primaries!==this.spaces[n].primaries&&(t.applyMatrix3(this.spaces[e].toXYZ),t.applyMatrix3(this.spaces[n].fromXYZ)),this.spaces[n].transfer===Gc&&(t.r=ph(t.r),t.g=ph(t.g),t.b=ph(t.b)),t):t},fromWorkingColorSpace:function(t,e){return this.convert(t,this.workingColorSpace,e)},toWorkingColorSpace:function(t,e){return this.convert(t,e,this.workingColorSpace)},getPrimaries:function(t){return this.spaces[t].primaries},getTransfer:function(t){return t===Bc?Vc:this.spaces[t].transfer},getLuminanceCoefficients:function(t,e=this.workingColorSpace){return t.fromArray(this.spaces[e].luminanceCoefficients)},define:function(t){Object.assign(this.spaces,t)},_getMatrix:function(t,e,n){return t.copy(this.spaces[e].toXYZ).multiply(this.spaces[n].fromXYZ)},_getDrawingBufferColorSpace:function(t){return this.spaces[t].outputColorSpaceConfig.drawingBufferColorSpace},_getUnpackColorSpace:function(t=this.workingColorSpace){return this.spaces[t].workingColorSpaceConfig.unpackColorSpace}};function dh(t){return t<.04045?.0773993808*t:Math.pow(.9478672986*t+.0521327014,2.4)}function ph(t){return t<.0031308?12.92*t:1.055*Math.pow(t,.41666)-.055}const fh=[.64,.33,.3,.6,.15,.06],mh=[.2126,.7152,.0722],gh=[.3127,.329],vh=(new ah).set(.4123908,.3575843,.1804808,.212639,.7151687,.0721923,.0193308,.1191948,.9505322),yh=(new ah).set(3.2409699,-1.5373832,-.4986108,-.9692436,1.8759675,.0415551,.0556301,-.203977,1.0569715);let _h;hh.define({[zc]:{primaries:fh,whitePoint:gh,transfer:Vc,toXYZ:vh,fromXYZ:yh,luminanceCoefficients:mh,workingColorSpaceConfig:{unpackColorSpace:Fc},outputColorSpaceConfig:{drawingBufferColorSpace:Fc}},[Fc]:{primaries:fh,whitePoint:gh,transfer:Gc,toXYZ:vh,fromXYZ:yh,luminanceCoefficients:mh,outputColorSpaceConfig:{drawingBufferColorSpace:Fc}}});class xh{static getDataURL(t){if(/^data:/i.test(t.src))return t.src;if("undefined"==typeof HTMLCanvasElement)return t.src;let e;if(t instanceof HTMLCanvasElement)e=t;else{void 0===_h&&(_h=uh("canvas")),_h.width=t.width,_h.height=t.height;const n=_h.getContext("2d");t instanceof ImageData?n.putImageData(t,0,0):n.drawImage(t,0,0,t.width,t.height),e=_h}return e.width>2048||e.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",t),e.toDataURL("image/jpeg",.6)):e.toDataURL("image/png")}static sRGBToLinear(t){if("undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap){const e=uh("canvas");e.width=t.width,e.height=t.height;const n=e.getContext("2d");n.drawImage(t,0,0,t.width,t.height);const r=n.getImageData(0,0,t.width,t.height),i=r.data;for(let t=0;t<i.length;t++)i[t]=255*dh(i[t]/255);return n.putImageData(r,0,0),e}if(t.data){const e=t.data.slice(0);for(let t=0;t<e.length;t++)e instanceof Uint8Array||e instanceof Uint8ClampedArray?e[t]=Math.floor(255*dh(e[t]/255)):e[t]=dh(e[t]);return{data:e,width:t.width,height:t.height}}return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),t}}let bh=0;class wh{constructor(t=null){this.isSource=!0,Object.defineProperty(this,"id",{value:bh++}),this.uuid=Qc(),this.data=t,this.dataReady=!0,this.version=0}set needsUpdate(t){!0===t&&this.version++}toJSON(t){const e=void 0===t||"string"==typeof t;if(!e&&void 0!==t.images[this.uuid])return t.images[this.uuid];const n={uuid:this.uuid,url:""},r=this.data;if(null!==r){let t;if(Array.isArray(r)){t=[];for(let e=0,n=r.length;e<n;e++)r[e].isDataTexture?t.push(Sh(r[e].image)):t.push(Sh(r[e]))}else t=Sh(r);n.url=t}return e||(t.images[this.uuid]=n),n}}function Sh(t){return"undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap?xh.getDataURL(t):t.data?{data:Array.from(t.data),width:t.width,height:t.height,type:t.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let Mh=0;class Eh extends Zc{constructor(t=Eh.DEFAULT_IMAGE,e=Eh.DEFAULT_MAPPING,n=1001,r=1001,i=1006,s=1008,o=1023,a=1009,l=Eh.DEFAULT_ANISOTROPY,u=""){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:Mh++}),this.uuid=Qc(),this.name="",this.source=new wh(t),this.mipmaps=[],this.mapping=e,this.channel=0,this.wrapS=n,this.wrapT=r,this.magFilter=i,this.minFilter=s,this.anisotropy=l,this.format=o,this.internalFormat=null,this.type=a,this.offset=new oh(0,0),this.repeat=new oh(1,1),this.center=new oh(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new ah,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.colorSpace=u,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.pmremVersion=0}get image(){return this.source.data}set image(t=null){this.source.data=t}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return(new this.constructor).copy(this)}copy(t){return this.name=t.name,this.source=t.source,this.mipmaps=t.mipmaps.slice(0),this.mapping=t.mapping,this.channel=t.channel,this.wrapS=t.wrapS,this.wrapT=t.wrapT,this.magFilter=t.magFilter,this.minFilter=t.minFilter,this.anisotropy=t.anisotropy,this.format=t.format,this.internalFormat=t.internalFormat,this.type=t.type,this.offset.copy(t.offset),this.repeat.copy(t.repeat),this.center.copy(t.center),this.rotation=t.rotation,this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrix.copy(t.matrix),this.generateMipmaps=t.generateMipmaps,this.premultiplyAlpha=t.premultiplyAlpha,this.flipY=t.flipY,this.unpackAlignment=t.unpackAlignment,this.colorSpace=t.colorSpace,this.userData=JSON.parse(JSON.stringify(t.userData)),this.needsUpdate=!0,this}toJSON(t){const e=void 0===t||"string"==typeof t;if(!e&&void 0!==t.textures[this.uuid])return t.textures[this.uuid];const n={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(t).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(n.userData=this.userData),e||(t.textures[this.uuid]=n),n}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(t){if(this.mapping!==Iu)return t;if(t.applyMatrix3(this.matrix),t.x<0||t.x>1)switch(this.wrapS){case Bu:t.x=t.x-Math.floor(t.x);break;case Fu:t.x=t.x<0?0:1;break;case zu:1===Math.abs(Math.floor(t.x)%2)?t.x=Math.ceil(t.x)-t.x:t.x=t.x-Math.floor(t.x)}if(t.y<0||t.y>1)switch(this.wrapT){case Bu:t.y=t.y-Math.floor(t.y);break;case Fu:t.y=t.y<0?0:1;break;case zu:1===Math.abs(Math.floor(t.y)%2)?t.y=Math.ceil(t.y)-t.y:t.y=t.y-Math.floor(t.y)}return this.flipY&&(t.y=1-t.y),t}set needsUpdate(t){!0===t&&(this.version++,this.source.needsUpdate=!0)}set needsPMREMUpdate(t){!0===t&&this.pmremVersion++}}Eh.DEFAULT_IMAGE=null,Eh.DEFAULT_MAPPING=Iu,Eh.DEFAULT_ANISOTROPY=1;class Th{constructor(t=0,e=0,n=0,r=1){Th.prototype.isVector4=!0,this.x=t,this.y=e,this.z=n,this.w=r}get width(){return this.z}set width(t){this.z=t}get height(){return this.w}set height(t){this.w=t}set(t,e,n,r){return this.x=t,this.y=e,this.z=n,this.w=r,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this.w=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setW(t){return this.w=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;case 3:this.w=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=void 0!==t.w?t.w:1,this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this.w+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this.w=t.w+e.w,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this.w+=t.w*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this.w-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this.w=t.w-e.w,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this.w*=t.w,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this}applyMatrix4(t){const e=this.x,n=this.y,r=this.z,i=this.w,s=t.elements;return this.x=s[0]*e+s[4]*n+s[8]*r+s[12]*i,this.y=s[1]*e+s[5]*n+s[9]*r+s[13]*i,this.z=s[2]*e+s[6]*n+s[10]*r+s[14]*i,this.w=s[3]*e+s[7]*n+s[11]*r+s[15]*i,this}divide(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this.w/=t.w,this}divideScalar(t){return this.multiplyScalar(1/t)}setAxisAngleFromQuaternion(t){this.w=2*Math.acos(t.w);const e=Math.sqrt(1-t.w*t.w);return e<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=t.x/e,this.y=t.y/e,this.z=t.z/e),this}setAxisAngleFromRotationMatrix(t){let e,n,r,i;const s=.01,o=.1,a=t.elements,l=a[0],u=a[4],c=a[8],h=a[1],d=a[5],p=a[9],f=a[2],m=a[6],g=a[10];if(Math.abs(u-h)<s&&Math.abs(c-f)<s&&Math.abs(p-m)<s){if(Math.abs(u+h)<o&&Math.abs(c+f)<o&&Math.abs(p+m)<o&&Math.abs(l+d+g-3)<o)return this.set(1,0,0,0),this;e=Math.PI;const t=(l+1)/2,a=(d+1)/2,v=(g+1)/2,y=(u+h)/4,_=(c+f)/4,x=(p+m)/4;return t>a&&t>v?t<s?(n=0,r=.707106781,i=.707106781):(n=Math.sqrt(t),r=y/n,i=_/n):a>v?a<s?(n=.707106781,r=0,i=.707106781):(r=Math.sqrt(a),n=y/r,i=x/r):v<s?(n=.707106781,r=.707106781,i=0):(i=Math.sqrt(v),n=_/i,r=x/i),this.set(n,r,i,e),this}let v=Math.sqrt((m-p)*(m-p)+(c-f)*(c-f)+(h-u)*(h-u));return Math.abs(v)<.001&&(v=1),this.x=(m-p)/v,this.y=(c-f)/v,this.z=(h-u)/v,this.w=Math.acos((l+d+g-1)/2),this}setFromMatrixPosition(t){const e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this.w=e[15],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this.w=Math.min(this.w,t.w),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this.w=Math.max(this.w,t.w),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this.w=Math.max(t.w,Math.min(e.w,this.w)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this.w=Math.max(t,Math.min(e,this.w)),this}clampLength(t,e){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(t,Math.min(e,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this.w+=(t.w-this.w)*e,this}lerpVectors(t,e,n){return this.x=t.x+(e.x-t.x)*n,this.y=t.y+(e.y-t.y)*n,this.z=t.z+(e.z-t.z)*n,this.w=t.w+(e.w-t.w)*n,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this.w=t[e+3],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t[e+3]=this.w,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this.w=t.getW(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class Ah extends Zc{constructor(t=1,e=1,n={}){super(),this.isRenderTarget=!0,this.width=t,this.height=e,this.depth=1,this.scissor=new Th(0,0,t,e),this.scissorTest=!1,this.viewport=new Th(0,0,t,e);const r={width:t,height:e,depth:1};n=Object.assign({generateMipmaps:!1,internalFormat:null,minFilter:Hu,depthBuffer:!0,stencilBuffer:!1,resolveDepthBuffer:!0,resolveStencilBuffer:!0,depthTexture:null,samples:0,count:1},n);const i=new Eh(r,n.mapping,n.wrapS,n.wrapT,n.magFilter,n.minFilter,n.format,n.type,n.anisotropy,n.colorSpace);i.flipY=!1,i.generateMipmaps=n.generateMipmaps,i.internalFormat=n.internalFormat,this.textures=[];const s=n.count;for(let t=0;t<s;t++)this.textures[t]=i.clone(),this.textures[t].isRenderTargetTexture=!0;this.depthBuffer=n.depthBuffer,this.stencilBuffer=n.stencilBuffer,this.resolveDepthBuffer=n.resolveDepthBuffer,this.resolveStencilBuffer=n.resolveStencilBuffer,this.depthTexture=n.depthTexture,this.samples=n.samples}get texture(){return this.textures[0]}set texture(t){this.textures[0]=t}setSize(t,e,n=1){if(this.width!==t||this.height!==e||this.depth!==n){this.width=t,this.height=e,this.depth=n;for(let r=0,i=this.textures.length;r<i;r++)this.textures[r].image.width=t,this.textures[r].image.height=e,this.textures[r].image.depth=n;this.dispose()}this.viewport.set(0,0,t,e),this.scissor.set(0,0,t,e)}clone(){return(new this.constructor).copy(this)}copy(t){this.width=t.width,this.height=t.height,this.depth=t.depth,this.scissor.copy(t.scissor),this.scissorTest=t.scissorTest,this.viewport.copy(t.viewport),this.textures.length=0;for(let e=0,n=t.textures.length;e<n;e++)this.textures[e]=t.textures[e].clone(),this.textures[e].isRenderTargetTexture=!0;const e=Object.assign({},t.texture.image);return this.texture.source=new wh(e),this.depthBuffer=t.depthBuffer,this.stencilBuffer=t.stencilBuffer,this.resolveDepthBuffer=t.resolveDepthBuffer,this.resolveStencilBuffer=t.resolveStencilBuffer,null!==t.depthTexture&&(this.depthTexture=t.depthTexture.clone()),this.samples=t.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class Ch extends Ah{constructor(t=1,e=1,n={}){super(t,e,n),this.isWebGLRenderTarget=!0}}class Rh extends Eh{constructor(t=null,e=1,n=1,r=1){super(null),this.isDataArrayTexture=!0,this.image={data:t,width:e,height:n,depth:r},this.magFilter=Vu,this.minFilter=Vu,this.wrapR=Fu,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.layerUpdates=new Set}addLayerUpdate(t){this.layerUpdates.add(t)}clearLayerUpdates(){this.layerUpdates.clear()}}class Nh{constructor(t=0,e=0,n=0,r=1){this.isQuaternion=!0,this._x=t,this._y=e,this._z=n,this._w=r}static slerpFlat(t,e,n,r,i,s,o){let a=n[r+0],l=n[r+1],u=n[r+2],c=n[r+3];const h=i[s+0],d=i[s+1],p=i[s+2],f=i[s+3];if(0===o)return t[e+0]=a,t[e+1]=l,t[e+2]=u,void(t[e+3]=c);if(1===o)return t[e+0]=h,t[e+1]=d,t[e+2]=p,void(t[e+3]=f);if(c!==f||a!==h||l!==d||u!==p){let t=1-o;const e=a*h+l*d+u*p+c*f,n=e>=0?1:-1,r=1-e*e;if(r>Number.EPSILON){const i=Math.sqrt(r),s=Math.atan2(i,e*n);t=Math.sin(t*s)/i,o=Math.sin(o*s)/i}const i=o*n;if(a=a*t+h*i,l=l*t+d*i,u=u*t+p*i,c=c*t+f*i,t===1-o){const t=1/Math.sqrt(a*a+l*l+u*u+c*c);a*=t,l*=t,u*=t,c*=t}}t[e]=a,t[e+1]=l,t[e+2]=u,t[e+3]=c}static multiplyQuaternionsFlat(t,e,n,r,i,s){const o=n[r],a=n[r+1],l=n[r+2],u=n[r+3],c=i[s],h=i[s+1],d=i[s+2],p=i[s+3];return t[e]=o*p+u*c+a*d-l*h,t[e+1]=a*p+u*h+l*c-o*d,t[e+2]=l*p+u*d+o*h-a*c,t[e+3]=u*p-o*c-a*h-l*d,t}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get w(){return this._w}set w(t){this._w=t,this._onChangeCallback()}set(t,e,n,r){return this._x=t,this._y=e,this._z=n,this._w=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this._onChangeCallback(),this}setFromEuler(t,e=!0){const n=t._x,r=t._y,i=t._z,s=t._order,o=Math.cos,a=Math.sin,l=o(n/2),u=o(r/2),c=o(i/2),h=a(n/2),d=a(r/2),p=a(i/2);switch(s){case"XYZ":this._x=h*u*c+l*d*p,this._y=l*d*c-h*u*p,this._z=l*u*p+h*d*c,this._w=l*u*c-h*d*p;break;case"YXZ":this._x=h*u*c+l*d*p,this._y=l*d*c-h*u*p,this._z=l*u*p-h*d*c,this._w=l*u*c+h*d*p;break;case"ZXY":this._x=h*u*c-l*d*p,this._y=l*d*c+h*u*p,this._z=l*u*p+h*d*c,this._w=l*u*c-h*d*p;break;case"ZYX":this._x=h*u*c-l*d*p,this._y=l*d*c+h*u*p,this._z=l*u*p-h*d*c,this._w=l*u*c+h*d*p;break;case"YZX":this._x=h*u*c+l*d*p,this._y=l*d*c+h*u*p,this._z=l*u*p-h*d*c,this._w=l*u*c-h*d*p;break;case"XZY":this._x=h*u*c-l*d*p,this._y=l*d*c-h*u*p,this._z=l*u*p+h*d*c,this._w=l*u*c+h*d*p;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+s)}return!0===e&&this._onChangeCallback(),this}setFromAxisAngle(t,e){const n=e/2,r=Math.sin(n);return this._x=t.x*r,this._y=t.y*r,this._z=t.z*r,this._w=Math.cos(n),this._onChangeCallback(),this}setFromRotationMatrix(t){const e=t.elements,n=e[0],r=e[4],i=e[8],s=e[1],o=e[5],a=e[9],l=e[2],u=e[6],c=e[10],h=n+o+c;if(h>0){const t=.5/Math.sqrt(h+1);this._w=.25/t,this._x=(u-a)*t,this._y=(i-l)*t,this._z=(s-r)*t}else if(n>o&&n>c){const t=2*Math.sqrt(1+n-o-c);this._w=(u-a)/t,this._x=.25*t,this._y=(r+s)/t,this._z=(i+l)/t}else if(o>c){const t=2*Math.sqrt(1+o-n-c);this._w=(i-l)/t,this._x=(r+s)/t,this._y=.25*t,this._z=(a+u)/t}else{const t=2*Math.sqrt(1+c-n-o);this._w=(s-r)/t,this._x=(i+l)/t,this._y=(a+u)/t,this._z=.25*t}return this._onChangeCallback(),this}setFromUnitVectors(t,e){let n=t.dot(e)+1;return n<Number.EPSILON?(n=0,Math.abs(t.x)>Math.abs(t.z)?(this._x=-t.y,this._y=t.x,this._z=0,this._w=n):(this._x=0,this._y=-t.z,this._z=t.y,this._w=n)):(this._x=t.y*e.z-t.z*e.y,this._y=t.z*e.x-t.x*e.z,this._z=t.x*e.y-t.y*e.x,this._w=n),this.normalize()}angleTo(t){return 2*Math.acos(Math.abs(th(this.dot(t),-1,1)))}rotateTowards(t,e){const n=this.angleTo(t);if(0===n)return this;const r=Math.min(1,e/n);return this.slerp(t,r),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let t=this.length();return 0===t?(this._x=0,this._y=0,this._z=0,this._w=1):(t=1/t,this._x=this._x*t,this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this._onChangeCallback(),this}multiply(t){return this.multiplyQuaternions(this,t)}premultiply(t){return this.multiplyQuaternions(t,this)}multiplyQuaternions(t,e){const n=t._x,r=t._y,i=t._z,s=t._w,o=e._x,a=e._y,l=e._z,u=e._w;return this._x=n*u+s*o+r*l-i*a,this._y=r*u+s*a+i*o-n*l,this._z=i*u+s*l+n*a-r*o,this._w=s*u-n*o-r*a-i*l,this._onChangeCallback(),this}slerp(t,e){if(0===e)return this;if(1===e)return this.copy(t);const n=this._x,r=this._y,i=this._z,s=this._w;let o=s*t._w+n*t._x+r*t._y+i*t._z;if(o<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,o=-o):this.copy(t),o>=1)return this._w=s,this._x=n,this._y=r,this._z=i,this;const a=1-o*o;if(a<=Number.EPSILON){const t=1-e;return this._w=t*s+e*this._w,this._x=t*n+e*this._x,this._y=t*r+e*this._y,this._z=t*i+e*this._z,this.normalize(),this}const l=Math.sqrt(a),u=Math.atan2(l,o),c=Math.sin((1-e)*u)/l,h=Math.sin(e*u)/l;return this._w=s*c+this._w*h,this._x=n*c+this._x*h,this._y=r*c+this._y*h,this._z=i*c+this._z*h,this._onChangeCallback(),this}slerpQuaternions(t,e,n){return this.copy(t).slerp(e,n)}random(){const t=2*Math.PI*Math.random(),e=2*Math.PI*Math.random(),n=Math.random(),r=Math.sqrt(1-n),i=Math.sqrt(n);return this.set(r*Math.sin(t),r*Math.cos(t),i*Math.sin(e),i*Math.cos(e))}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w}fromArray(t,e=0){return this._x=t[e],this._y=t[e+1],this._z=t[e+2],this._w=t[e+3],this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._w,t}fromBufferAttribute(t,e){return this._x=t.getX(e),this._y=t.getY(e),this._z=t.getZ(e),this._w=t.getW(e),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class Ph{constructor(t=0,e=0,n=0){Ph.prototype.isVector3=!0,this.x=t,this.y=e,this.z=n}set(t,e,n){return void 0===n&&(n=this.z),this.x=t,this.y=e,this.z=n,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this}multiplyVectors(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this}applyEuler(t){return this.applyQuaternion(Oh.setFromEuler(t))}applyAxisAngle(t,e){return this.applyQuaternion(Oh.setFromAxisAngle(t,e))}applyMatrix3(t){const e=this.x,n=this.y,r=this.z,i=t.elements;return this.x=i[0]*e+i[3]*n+i[6]*r,this.y=i[1]*e+i[4]*n+i[7]*r,this.z=i[2]*e+i[5]*n+i[8]*r,this}applyNormalMatrix(t){return this.applyMatrix3(t).normalize()}applyMatrix4(t){const e=this.x,n=this.y,r=this.z,i=t.elements,s=1/(i[3]*e+i[7]*n+i[11]*r+i[15]);return this.x=(i[0]*e+i[4]*n+i[8]*r+i[12])*s,this.y=(i[1]*e+i[5]*n+i[9]*r+i[13])*s,this.z=(i[2]*e+i[6]*n+i[10]*r+i[14])*s,this}applyQuaternion(t){const e=this.x,n=this.y,r=this.z,i=t.x,s=t.y,o=t.z,a=t.w,l=2*(s*r-o*n),u=2*(o*e-i*r),c=2*(i*n-s*e);return this.x=e+a*l+s*c-o*u,this.y=n+a*u+o*l-i*c,this.z=r+a*c+i*u-s*l,this}project(t){return this.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix)}unproject(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld)}transformDirection(t){const e=this.x,n=this.y,r=this.z,i=t.elements;return this.x=i[0]*e+i[4]*n+i[8]*r,this.y=i[1]*e+i[5]*n+i[9]*r,this.z=i[2]*e+i[6]*n+i[10]*r,this.normalize()}divide(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this}divideScalar(t){return this.multiplyScalar(1/t)}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this}clampLength(t,e){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(t,Math.min(e,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this}lerpVectors(t,e,n){return this.x=t.x+(e.x-t.x)*n,this.y=t.y+(e.y-t.y)*n,this.z=t.z+(e.z-t.z)*n,this}cross(t){return this.crossVectors(this,t)}crossVectors(t,e){const n=t.x,r=t.y,i=t.z,s=e.x,o=e.y,a=e.z;return this.x=r*a-i*o,this.y=i*s-n*a,this.z=n*o-r*s,this}projectOnVector(t){const e=t.lengthSq();if(0===e)return this.set(0,0,0);const n=t.dot(this)/e;return this.copy(t).multiplyScalar(n)}projectOnPlane(t){return Ih.copy(this).projectOnVector(t),this.sub(Ih)}reflect(t){return this.sub(Ih.copy(t).multiplyScalar(2*this.dot(t)))}angleTo(t){const e=Math.sqrt(this.lengthSq()*t.lengthSq());if(0===e)return Math.PI/2;const n=this.dot(t)/e;return Math.acos(th(n,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,n=this.y-t.y,r=this.z-t.z;return e*e+n*n+r*r}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)}setFromSpherical(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)}setFromSphericalCoords(t,e,n){const r=Math.sin(e)*t;return this.x=r*Math.sin(n),this.y=Math.cos(e)*t,this.z=r*Math.cos(n),this}setFromCylindrical(t){return this.setFromCylindricalCoords(t.radius,t.theta,t.y)}setFromCylindricalCoords(t,e,n){return this.x=t*Math.sin(e),this.y=n,this.z=t*Math.cos(e),this}setFromMatrixPosition(t){const e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this}setFromMatrixScale(t){const e=this.setFromMatrixColumn(t,0).length(),n=this.setFromMatrixColumn(t,1).length(),r=this.setFromMatrixColumn(t,2).length();return this.x=e,this.y=n,this.z=r,this}setFromMatrixColumn(t,e){return this.fromArray(t.elements,4*e)}setFromMatrix3Column(t,e){return this.fromArray(t.elements,3*e)}setFromEuler(t){return this.x=t._x,this.y=t._y,this.z=t._z,this}setFromColor(t){return this.x=t.r,this.y=t.g,this.z=t.b,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const t=Math.random()*Math.PI*2,e=2*Math.random()-1,n=Math.sqrt(1-e*e);return this.x=n*Math.cos(t),this.y=e,this.z=n*Math.sin(t),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const Ih=new Ph,Oh=new Nh;class Dh{constructor(t=new Ph(1/0,1/0,1/0),e=new Ph(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=t,this.max=e}set(t,e){return this.min.copy(t),this.max.copy(e),this}setFromArray(t){this.makeEmpty();for(let e=0,n=t.length;e<n;e+=3)this.expandByPoint(Uh.fromArray(t,e));return this}setFromBufferAttribute(t){this.makeEmpty();for(let e=0,n=t.count;e<n;e++)this.expandByPoint(Uh.fromBufferAttribute(t,e));return this}setFromPoints(t){this.makeEmpty();for(let e=0,n=t.length;e<n;e++)this.expandByPoint(t[e]);return this}setFromCenterAndSize(t,e){const n=Uh.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(n),this.max.copy(t).add(n),this}setFromObject(t,e=!1){return this.makeEmpty(),this.expandByObject(t,e)}clone(){return(new this.constructor).copy(this)}copy(t){return this.min.copy(t.min),this.max.copy(t.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(t){return this.isEmpty()?t.set(0,0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(t){return this.isEmpty()?t.set(0,0,0):t.subVectors(this.max,this.min)}expandByPoint(t){return this.min.min(t),this.max.max(t),this}expandByVector(t){return this.min.sub(t),this.max.add(t),this}expandByScalar(t){return this.min.addScalar(-t),this.max.addScalar(t),this}expandByObject(t,e=!1){t.updateWorldMatrix(!1,!1);const n=t.geometry;if(void 0!==n){const r=n.getAttribute("position");if(!0===e&&void 0!==r&&!0!==t.isInstancedMesh)for(let e=0,n=r.count;e<n;e++)!0===t.isMesh?t.getVertexPosition(e,Uh):Uh.fromBufferAttribute(r,e),Uh.applyMatrix4(t.matrixWorld),this.expandByPoint(Uh);else void 0!==t.boundingBox?(null===t.boundingBox&&t.computeBoundingBox(),kh.copy(t.boundingBox)):(null===n.boundingBox&&n.computeBoundingBox(),kh.copy(n.boundingBox)),kh.applyMatrix4(t.matrixWorld),this.union(kh)}const r=t.children;for(let t=0,n=r.length;t<n;t++)this.expandByObject(r[t],e);return this}containsPoint(t){return t.x>=this.min.x&&t.x<=this.max.x&&t.y>=this.min.y&&t.y<=this.max.y&&t.z>=this.min.z&&t.z<=this.max.z}containsBox(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y&&this.min.z<=t.min.z&&t.max.z<=this.max.z}getParameter(t,e){return e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y),(t.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(t){return t.max.x>=this.min.x&&t.min.x<=this.max.x&&t.max.y>=this.min.y&&t.min.y<=this.max.y&&t.max.z>=this.min.z&&t.min.z<=this.max.z}intersectsSphere(t){return this.clampPoint(t.center,Uh),Uh.distanceToSquared(t.center)<=t.radius*t.radius}intersectsPlane(t){let e,n;return t.normal.x>0?(e=t.normal.x*this.min.x,n=t.normal.x*this.max.x):(e=t.normal.x*this.max.x,n=t.normal.x*this.min.x),t.normal.y>0?(e+=t.normal.y*this.min.y,n+=t.normal.y*this.max.y):(e+=t.normal.y*this.max.y,n+=t.normal.y*this.min.y),t.normal.z>0?(e+=t.normal.z*this.min.z,n+=t.normal.z*this.max.z):(e+=t.normal.z*this.max.z,n+=t.normal.z*this.min.z),e<=-t.constant&&n>=-t.constant}intersectsTriangle(t){if(this.isEmpty())return!1;this.getCenter(Hh),Wh.subVectors(this.max,Hh),Bh.subVectors(t.a,Hh),Fh.subVectors(t.b,Hh),zh.subVectors(t.c,Hh),Vh.subVectors(Fh,Bh),Gh.subVectors(zh,Fh),jh.subVectors(Bh,zh);let e=[0,-Vh.z,Vh.y,0,-Gh.z,Gh.y,0,-jh.z,jh.y,Vh.z,0,-Vh.x,Gh.z,0,-Gh.x,jh.z,0,-jh.x,-Vh.y,Vh.x,0,-Gh.y,Gh.x,0,-jh.y,jh.x,0];return!!Zh(e,Bh,Fh,zh,Wh)&&(e=[1,0,0,0,1,0,0,0,1],!!Zh(e,Bh,Fh,zh,Wh)&&(qh.crossVectors(Vh,Gh),e=[qh.x,qh.y,qh.z],Zh(e,Bh,Fh,zh,Wh)))}clampPoint(t,e){return e.copy(t).clamp(this.min,this.max)}distanceToPoint(t){return this.clampPoint(t,Uh).distanceTo(t)}getBoundingSphere(t){return this.isEmpty()?t.makeEmpty():(this.getCenter(t.center),t.radius=.5*this.getSize(Uh).length()),t}intersect(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this}union(t){return this.min.min(t.min),this.max.max(t.max),this}applyMatrix4(t){return this.isEmpty()||(Lh[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),Lh[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),Lh[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),Lh[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),Lh[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),Lh[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),Lh[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),Lh[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.setFromPoints(Lh)),this}translate(t){return this.min.add(t),this.max.add(t),this}equals(t){return t.min.equals(this.min)&&t.max.equals(this.max)}}const Lh=[new Ph,new Ph,new Ph,new Ph,new Ph,new Ph,new Ph,new Ph],Uh=new Ph,kh=new Dh,Bh=new Ph,Fh=new Ph,zh=new Ph,Vh=new Ph,Gh=new Ph,jh=new Ph,Hh=new Ph,Wh=new Ph,qh=new Ph,Xh=new Ph;function Zh(t,e,n,r,i){for(let s=0,o=t.length-3;s<=o;s+=3){Xh.fromArray(t,s);const o=i.x*Math.abs(Xh.x)+i.y*Math.abs(Xh.y)+i.z*Math.abs(Xh.z),a=e.dot(Xh),l=n.dot(Xh),u=r.dot(Xh);if(Math.max(-Math.max(a,l,u),Math.min(a,l,u))>o)return!1}return!0}const $h=new Dh,Yh=new Ph,Kh=new Ph;class Jh{constructor(t=new Ph,e=-1){this.isSphere=!0,this.center=t,this.radius=e}set(t,e){return this.center.copy(t),this.radius=e,this}setFromPoints(t,e){const n=this.center;void 0!==e?n.copy(e):$h.setFromPoints(t).getCenter(n);let r=0;for(let e=0,i=t.length;e<i;e++)r=Math.max(r,n.distanceToSquared(t[e]));return this.radius=Math.sqrt(r),this}copy(t){return this.center.copy(t.center),this.radius=t.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(t){return t.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(t){return t.distanceTo(this.center)-this.radius}intersectsSphere(t){const e=this.radius+t.radius;return t.center.distanceToSquared(this.center)<=e*e}intersectsBox(t){return t.intersectsSphere(this)}intersectsPlane(t){return Math.abs(t.distanceToPoint(this.center))<=this.radius}clampPoint(t,e){const n=this.center.distanceToSquared(t);return e.copy(t),n>this.radius*this.radius&&(e.sub(this.center).normalize(),e.multiplyScalar(this.radius).add(this.center)),e}getBoundingBox(t){return this.isEmpty()?(t.makeEmpty(),t):(t.set(this.center,this.center),t.expandByScalar(this.radius),t)}applyMatrix4(t){return this.center.applyMatrix4(t),this.radius=this.radius*t.getMaxScaleOnAxis(),this}translate(t){return this.center.add(t),this}expandByPoint(t){if(this.isEmpty())return this.center.copy(t),this.radius=0,this;Yh.subVectors(t,this.center);const e=Yh.lengthSq();if(e>this.radius*this.radius){const t=Math.sqrt(e),n=.5*(t-this.radius);this.center.addScaledVector(Yh,n/t),this.radius+=n}return this}union(t){return t.isEmpty()?this:this.isEmpty()?(this.copy(t),this):(!0===this.center.equals(t.center)?this.radius=Math.max(this.radius,t.radius):(Kh.subVectors(t.center,this.center).setLength(t.radius),this.expandByPoint(Yh.copy(t.center).add(Kh)),this.expandByPoint(Yh.copy(t.center).sub(Kh))),this)}equals(t){return t.center.equals(this.center)&&t.radius===this.radius}clone(){return(new this.constructor).copy(this)}}const Qh=new Ph,td=new Ph,ed=new Ph,nd=new Ph,rd=new Ph,id=new Ph,sd=new Ph;class od{constructor(t=new Ph,e=new Ph(0,0,-1)){this.origin=t,this.direction=e}set(t,e){return this.origin.copy(t),this.direction.copy(e),this}copy(t){return this.origin.copy(t.origin),this.direction.copy(t.direction),this}at(t,e){return e.copy(this.origin).addScaledVector(this.direction,t)}lookAt(t){return this.direction.copy(t).sub(this.origin).normalize(),this}recast(t){return this.origin.copy(this.at(t,Qh)),this}closestPointToPoint(t,e){e.subVectors(t,this.origin);const n=e.dot(this.direction);return n<0?e.copy(this.origin):e.copy(this.origin).addScaledVector(this.direction,n)}distanceToPoint(t){return Math.sqrt(this.distanceSqToPoint(t))}distanceSqToPoint(t){const e=Qh.subVectors(t,this.origin).dot(this.direction);return e<0?this.origin.distanceToSquared(t):(Qh.copy(this.origin).addScaledVector(this.direction,e),Qh.distanceToSquared(t))}distanceSqToSegment(t,e,n,r){td.copy(t).add(e).multiplyScalar(.5),ed.copy(e).sub(t).normalize(),nd.copy(this.origin).sub(td);const i=.5*t.distanceTo(e),s=-this.direction.dot(ed),o=nd.dot(this.direction),a=-nd.dot(ed),l=nd.lengthSq(),u=Math.abs(1-s*s);let c,h,d,p;if(u>0)if(c=s*a-o,h=s*o-a,p=i*u,c>=0)if(h>=-p)if(h<=p){const t=1/u;c*=t,h*=t,d=c*(c+s*h+2*o)+h*(s*c+h+2*a)+l}else h=i,c=Math.max(0,-(s*h+o)),d=-c*c+h*(h+2*a)+l;else h=-i,c=Math.max(0,-(s*h+o)),d=-c*c+h*(h+2*a)+l;else h<=-p?(c=Math.max(0,-(-s*i+o)),h=c>0?-i:Math.min(Math.max(-i,-a),i),d=-c*c+h*(h+2*a)+l):h<=p?(c=0,h=Math.min(Math.max(-i,-a),i),d=h*(h+2*a)+l):(c=Math.max(0,-(s*i+o)),h=c>0?i:Math.min(Math.max(-i,-a),i),d=-c*c+h*(h+2*a)+l);else h=s>0?-i:i,c=Math.max(0,-(s*h+o)),d=-c*c+h*(h+2*a)+l;return n&&n.copy(this.origin).addScaledVector(this.direction,c),r&&r.copy(td).addScaledVector(ed,h),d}intersectSphere(t,e){Qh.subVectors(t.center,this.origin);const n=Qh.dot(this.direction),r=Qh.dot(Qh)-n*n,i=t.radius*t.radius;if(r>i)return null;const s=Math.sqrt(i-r),o=n-s,a=n+s;return a<0?null:o<0?this.at(a,e):this.at(o,e)}intersectsSphere(t){return this.distanceSqToPoint(t.center)<=t.radius*t.radius}distanceToPlane(t){const e=t.normal.dot(this.direction);if(0===e)return 0===t.distanceToPoint(this.origin)?0:null;const n=-(this.origin.dot(t.normal)+t.constant)/e;return n>=0?n:null}intersectPlane(t,e){const n=this.distanceToPlane(t);return null===n?null:this.at(n,e)}intersectsPlane(t){const e=t.distanceToPoint(this.origin);if(0===e)return!0;return t.normal.dot(this.direction)*e<0}intersectBox(t,e){let n,r,i,s,o,a;const l=1/this.direction.x,u=1/this.direction.y,c=1/this.direction.z,h=this.origin;return l>=0?(n=(t.min.x-h.x)*l,r=(t.max.x-h.x)*l):(n=(t.max.x-h.x)*l,r=(t.min.x-h.x)*l),u>=0?(i=(t.min.y-h.y)*u,s=(t.max.y-h.y)*u):(i=(t.max.y-h.y)*u,s=(t.min.y-h.y)*u),n>s||i>r?null:((i>n||isNaN(n))&&(n=i),(s<r||isNaN(r))&&(r=s),c>=0?(o=(t.min.z-h.z)*c,a=(t.max.z-h.z)*c):(o=(t.max.z-h.z)*c,a=(t.min.z-h.z)*c),n>a||o>r?null:((o>n||n!=n)&&(n=o),(a<r||r!=r)&&(r=a),r<0?null:this.at(n>=0?n:r,e)))}intersectsBox(t){return null!==this.intersectBox(t,Qh)}intersectTriangle(t,e,n,r,i){rd.subVectors(e,t),id.subVectors(n,t),sd.crossVectors(rd,id);let s,o=this.direction.dot(sd);if(o>0){if(r)return null;s=1}else{if(!(o<0))return null;s=-1,o=-o}nd.subVectors(this.origin,t);const a=s*this.direction.dot(id.crossVectors(nd,id));if(a<0)return null;const l=s*this.direction.dot(rd.cross(nd));if(l<0)return null;if(a+l>o)return null;const u=-s*nd.dot(sd);return u<0?null:this.at(u/o,i)}applyMatrix4(t){return this.origin.applyMatrix4(t),this.direction.transformDirection(t),this}equals(t){return t.origin.equals(this.origin)&&t.direction.equals(this.direction)}clone(){return(new this.constructor).copy(this)}}class ad{constructor(t,e,n,r,i,s,o,a,l,u,c,h,d,p,f,m){ad.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],void 0!==t&&this.set(t,e,n,r,i,s,o,a,l,u,c,h,d,p,f,m)}set(t,e,n,r,i,s,o,a,l,u,c,h,d,p,f,m){const g=this.elements;return g[0]=t,g[4]=e,g[8]=n,g[12]=r,g[1]=i,g[5]=s,g[9]=o,g[13]=a,g[2]=l,g[6]=u,g[10]=c,g[14]=h,g[3]=d,g[7]=p,g[11]=f,g[15]=m,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return(new ad).fromArray(this.elements)}copy(t){const e=this.elements,n=t.elements;return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],e[9]=n[9],e[10]=n[10],e[11]=n[11],e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15],this}copyPosition(t){const e=this.elements,n=t.elements;return e[12]=n[12],e[13]=n[13],e[14]=n[14],this}setFromMatrix3(t){const e=t.elements;return this.set(e[0],e[3],e[6],0,e[1],e[4],e[7],0,e[2],e[5],e[8],0,0,0,0,1),this}extractBasis(t,e,n){return t.setFromMatrixColumn(this,0),e.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this}makeBasis(t,e,n){return this.set(t.x,e.x,n.x,0,t.y,e.y,n.y,0,t.z,e.z,n.z,0,0,0,0,1),this}extractRotation(t){const e=this.elements,n=t.elements,r=1/ld.setFromMatrixColumn(t,0).length(),i=1/ld.setFromMatrixColumn(t,1).length(),s=1/ld.setFromMatrixColumn(t,2).length();return e[0]=n[0]*r,e[1]=n[1]*r,e[2]=n[2]*r,e[3]=0,e[4]=n[4]*i,e[5]=n[5]*i,e[6]=n[6]*i,e[7]=0,e[8]=n[8]*s,e[9]=n[9]*s,e[10]=n[10]*s,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromEuler(t){const e=this.elements,n=t.x,r=t.y,i=t.z,s=Math.cos(n),o=Math.sin(n),a=Math.cos(r),l=Math.sin(r),u=Math.cos(i),c=Math.sin(i);if("XYZ"===t.order){const t=s*u,n=s*c,r=o*u,i=o*c;e[0]=a*u,e[4]=-a*c,e[8]=l,e[1]=n+r*l,e[5]=t-i*l,e[9]=-o*a,e[2]=i-t*l,e[6]=r+n*l,e[10]=s*a}else if("YXZ"===t.order){const t=a*u,n=a*c,r=l*u,i=l*c;e[0]=t+i*o,e[4]=r*o-n,e[8]=s*l,e[1]=s*c,e[5]=s*u,e[9]=-o,e[2]=n*o-r,e[6]=i+t*o,e[10]=s*a}else if("ZXY"===t.order){const t=a*u,n=a*c,r=l*u,i=l*c;e[0]=t-i*o,e[4]=-s*c,e[8]=r+n*o,e[1]=n+r*o,e[5]=s*u,e[9]=i-t*o,e[2]=-s*l,e[6]=o,e[10]=s*a}else if("ZYX"===t.order){const t=s*u,n=s*c,r=o*u,i=o*c;e[0]=a*u,e[4]=r*l-n,e[8]=t*l+i,e[1]=a*c,e[5]=i*l+t,e[9]=n*l-r,e[2]=-l,e[6]=o*a,e[10]=s*a}else if("YZX"===t.order){const t=s*a,n=s*l,r=o*a,i=o*l;e[0]=a*u,e[4]=i-t*c,e[8]=r*c+n,e[1]=c,e[5]=s*u,e[9]=-o*u,e[2]=-l*u,e[6]=n*c+r,e[10]=t-i*c}else if("XZY"===t.order){const t=s*a,n=s*l,r=o*a,i=o*l;e[0]=a*u,e[4]=-c,e[8]=l*u,e[1]=t*c+i,e[5]=s*u,e[9]=n*c-r,e[2]=r*c-n,e[6]=o*u,e[10]=i*c+t}return e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromQuaternion(t){return this.compose(cd,t,hd)}lookAt(t,e,n){const r=this.elements;return fd.subVectors(t,e),0===fd.lengthSq()&&(fd.z=1),fd.normalize(),dd.crossVectors(n,fd),0===dd.lengthSq()&&(1===Math.abs(n.z)?fd.x+=1e-4:fd.z+=1e-4,fd.normalize(),dd.crossVectors(n,fd)),dd.normalize(),pd.crossVectors(fd,dd),r[0]=dd.x,r[4]=pd.x,r[8]=fd.x,r[1]=dd.y,r[5]=pd.y,r[9]=fd.y,r[2]=dd.z,r[6]=pd.z,r[10]=fd.z,this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const n=t.elements,r=e.elements,i=this.elements,s=n[0],o=n[4],a=n[8],l=n[12],u=n[1],c=n[5],h=n[9],d=n[13],p=n[2],f=n[6],m=n[10],g=n[14],v=n[3],y=n[7],_=n[11],x=n[15],b=r[0],w=r[4],S=r[8],M=r[12],E=r[1],T=r[5],A=r[9],C=r[13],R=r[2],N=r[6],P=r[10],I=r[14],O=r[3],D=r[7],L=r[11],U=r[15];return i[0]=s*b+o*E+a*R+l*O,i[4]=s*w+o*T+a*N+l*D,i[8]=s*S+o*A+a*P+l*L,i[12]=s*M+o*C+a*I+l*U,i[1]=u*b+c*E+h*R+d*O,i[5]=u*w+c*T+h*N+d*D,i[9]=u*S+c*A+h*P+d*L,i[13]=u*M+c*C+h*I+d*U,i[2]=p*b+f*E+m*R+g*O,i[6]=p*w+f*T+m*N+g*D,i[10]=p*S+f*A+m*P+g*L,i[14]=p*M+f*C+m*I+g*U,i[3]=v*b+y*E+_*R+x*O,i[7]=v*w+y*T+_*N+x*D,i[11]=v*S+y*A+_*P+x*L,i[15]=v*M+y*C+_*I+x*U,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[4]*=t,e[8]*=t,e[12]*=t,e[1]*=t,e[5]*=t,e[9]*=t,e[13]*=t,e[2]*=t,e[6]*=t,e[10]*=t,e[14]*=t,e[3]*=t,e[7]*=t,e[11]*=t,e[15]*=t,this}determinant(){const t=this.elements,e=t[0],n=t[4],r=t[8],i=t[12],s=t[1],o=t[5],a=t[9],l=t[13],u=t[2],c=t[6],h=t[10],d=t[14];return t[3]*(+i*a*c-r*l*c-i*o*h+n*l*h+r*o*d-n*a*d)+t[7]*(+e*a*d-e*l*h+i*s*h-r*s*d+r*l*u-i*a*u)+t[11]*(+e*l*c-e*o*d-i*s*c+n*s*d+i*o*u-n*l*u)+t[15]*(-r*o*u-e*a*c+e*o*h+r*s*c-n*s*h+n*a*u)}transpose(){const t=this.elements;let e;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this}setPosition(t,e,n){const r=this.elements;return t.isVector3?(r[12]=t.x,r[13]=t.y,r[14]=t.z):(r[12]=t,r[13]=e,r[14]=n),this}invert(){const t=this.elements,e=t[0],n=t[1],r=t[2],i=t[3],s=t[4],o=t[5],a=t[6],l=t[7],u=t[8],c=t[9],h=t[10],d=t[11],p=t[12],f=t[13],m=t[14],g=t[15],v=c*m*l-f*h*l+f*a*d-o*m*d-c*a*g+o*h*g,y=p*h*l-u*m*l-p*a*d+s*m*d+u*a*g-s*h*g,_=u*f*l-p*c*l+p*o*d-s*f*d-u*o*g+s*c*g,x=p*c*a-u*f*a-p*o*h+s*f*h+u*o*m-s*c*m,b=e*v+n*y+r*_+i*x;if(0===b)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const w=1/b;return t[0]=v*w,t[1]=(f*h*i-c*m*i-f*r*d+n*m*d+c*r*g-n*h*g)*w,t[2]=(o*m*i-f*a*i+f*r*l-n*m*l-o*r*g+n*a*g)*w,t[3]=(c*a*i-o*h*i-c*r*l+n*h*l+o*r*d-n*a*d)*w,t[4]=y*w,t[5]=(u*m*i-p*h*i+p*r*d-e*m*d-u*r*g+e*h*g)*w,t[6]=(p*a*i-s*m*i-p*r*l+e*m*l+s*r*g-e*a*g)*w,t[7]=(s*h*i-u*a*i+u*r*l-e*h*l-s*r*d+e*a*d)*w,t[8]=_*w,t[9]=(p*c*i-u*f*i-p*n*d+e*f*d+u*n*g-e*c*g)*w,t[10]=(s*f*i-p*o*i+p*n*l-e*f*l-s*n*g+e*o*g)*w,t[11]=(u*o*i-s*c*i-u*n*l+e*c*l+s*n*d-e*o*d)*w,t[12]=x*w,t[13]=(u*f*r-p*c*r+p*n*h-e*f*h-u*n*m+e*c*m)*w,t[14]=(p*o*r-s*f*r-p*n*a+e*f*a+s*n*m-e*o*m)*w,t[15]=(s*c*r-u*o*r+u*n*a-e*c*a-s*n*h+e*o*h)*w,this}scale(t){const e=this.elements,n=t.x,r=t.y,i=t.z;return e[0]*=n,e[4]*=r,e[8]*=i,e[1]*=n,e[5]*=r,e[9]*=i,e[2]*=n,e[6]*=r,e[10]*=i,e[3]*=n,e[7]*=r,e[11]*=i,this}getMaxScaleOnAxis(){const t=this.elements,e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],n=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],r=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(e,n,r))}makeTranslation(t,e,n){return t.isVector3?this.set(1,0,0,t.x,0,1,0,t.y,0,0,1,t.z,0,0,0,1):this.set(1,0,0,t,0,1,0,e,0,0,1,n,0,0,0,1),this}makeRotationX(t){const e=Math.cos(t),n=Math.sin(t);return this.set(1,0,0,0,0,e,-n,0,0,n,e,0,0,0,0,1),this}makeRotationY(t){const e=Math.cos(t),n=Math.sin(t);return this.set(e,0,n,0,0,1,0,0,-n,0,e,0,0,0,0,1),this}makeRotationZ(t){const e=Math.cos(t),n=Math.sin(t);return this.set(e,-n,0,0,n,e,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(t,e){const n=Math.cos(e),r=Math.sin(e),i=1-n,s=t.x,o=t.y,a=t.z,l=i*s,u=i*o;return this.set(l*s+n,l*o-r*a,l*a+r*o,0,l*o+r*a,u*o+n,u*a-r*s,0,l*a-r*o,u*a+r*s,i*a*a+n,0,0,0,0,1),this}makeScale(t,e,n){return this.set(t,0,0,0,0,e,0,0,0,0,n,0,0,0,0,1),this}makeShear(t,e,n,r,i,s){return this.set(1,n,i,0,t,1,s,0,e,r,1,0,0,0,0,1),this}compose(t,e,n){const r=this.elements,i=e._x,s=e._y,o=e._z,a=e._w,l=i+i,u=s+s,c=o+o,h=i*l,d=i*u,p=i*c,f=s*u,m=s*c,g=o*c,v=a*l,y=a*u,_=a*c,x=n.x,b=n.y,w=n.z;return r[0]=(1-(f+g))*x,r[1]=(d+_)*x,r[2]=(p-y)*x,r[3]=0,r[4]=(d-_)*b,r[5]=(1-(h+g))*b,r[6]=(m+v)*b,r[7]=0,r[8]=(p+y)*w,r[9]=(m-v)*w,r[10]=(1-(h+f))*w,r[11]=0,r[12]=t.x,r[13]=t.y,r[14]=t.z,r[15]=1,this}decompose(t,e,n){const r=this.elements;let i=ld.set(r[0],r[1],r[2]).length();const s=ld.set(r[4],r[5],r[6]).length(),o=ld.set(r[8],r[9],r[10]).length();this.determinant()<0&&(i=-i),t.x=r[12],t.y=r[13],t.z=r[14],ud.copy(this);const a=1/i,l=1/s,u=1/o;return ud.elements[0]*=a,ud.elements[1]*=a,ud.elements[2]*=a,ud.elements[4]*=l,ud.elements[5]*=l,ud.elements[6]*=l,ud.elements[8]*=u,ud.elements[9]*=u,ud.elements[10]*=u,e.setFromRotationMatrix(ud),n.x=i,n.y=s,n.z=o,this}makePerspective(t,e,n,r,i,s,o=2e3){const a=this.elements,l=2*i/(e-t),u=2*i/(n-r),c=(e+t)/(e-t),h=(n+r)/(n-r);let d,p;if(o===qc)d=-(s+i)/(s-i),p=-2*s*i/(s-i);else{if(o!==Xc)throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+o);d=-s/(s-i),p=-s*i/(s-i)}return a[0]=l,a[4]=0,a[8]=c,a[12]=0,a[1]=0,a[5]=u,a[9]=h,a[13]=0,a[2]=0,a[6]=0,a[10]=d,a[14]=p,a[3]=0,a[7]=0,a[11]=-1,a[15]=0,this}makeOrthographic(t,e,n,r,i,s,o=2e3){const a=this.elements,l=1/(e-t),u=1/(n-r),c=1/(s-i),h=(e+t)*l,d=(n+r)*u;let p,f;if(o===qc)p=(s+i)*c,f=-2*c;else{if(o!==Xc)throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+o);p=i*c,f=-1*c}return a[0]=2*l,a[4]=0,a[8]=0,a[12]=-h,a[1]=0,a[5]=2*u,a[9]=0,a[13]=-d,a[2]=0,a[6]=0,a[10]=f,a[14]=-p,a[3]=0,a[7]=0,a[11]=0,a[15]=1,this}equals(t){const e=this.elements,n=t.elements;for(let t=0;t<16;t++)if(e[t]!==n[t])return!1;return!0}fromArray(t,e=0){for(let n=0;n<16;n++)this.elements[n]=t[n+e];return this}toArray(t=[],e=0){const n=this.elements;return t[e]=n[0],t[e+1]=n[1],t[e+2]=n[2],t[e+3]=n[3],t[e+4]=n[4],t[e+5]=n[5],t[e+6]=n[6],t[e+7]=n[7],t[e+8]=n[8],t[e+9]=n[9],t[e+10]=n[10],t[e+11]=n[11],t[e+12]=n[12],t[e+13]=n[13],t[e+14]=n[14],t[e+15]=n[15],t}}const ld=new Ph,ud=new ad,cd=new Ph(0,0,0),hd=new Ph(1,1,1),dd=new Ph,pd=new Ph,fd=new Ph,md=new ad,gd=new Nh;class vd{constructor(t=0,e=0,n=0,r=vd.DEFAULT_ORDER){this.isEuler=!0,this._x=t,this._y=e,this._z=n,this._order=r}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get order(){return this._order}set order(t){this._order=t,this._onChangeCallback()}set(t,e,n,r=this._order){return this._x=t,this._y=e,this._z=n,this._order=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this._onChangeCallback(),this}setFromRotationMatrix(t,e=this._order,n=!0){const r=t.elements,i=r[0],s=r[4],o=r[8],a=r[1],l=r[5],u=r[9],c=r[2],h=r[6],d=r[10];switch(e){case"XYZ":this._y=Math.asin(th(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(-u,d),this._z=Math.atan2(-s,i)):(this._x=Math.atan2(h,l),this._z=0);break;case"YXZ":this._x=Math.asin(-th(u,-1,1)),Math.abs(u)<.9999999?(this._y=Math.atan2(o,d),this._z=Math.atan2(a,l)):(this._y=Math.atan2(-c,i),this._z=0);break;case"ZXY":this._x=Math.asin(th(h,-1,1)),Math.abs(h)<.9999999?(this._y=Math.atan2(-c,d),this._z=Math.atan2(-s,l)):(this._y=0,this._z=Math.atan2(a,i));break;case"ZYX":this._y=Math.asin(-th(c,-1,1)),Math.abs(c)<.9999999?(this._x=Math.atan2(h,d),this._z=Math.atan2(a,i)):(this._x=0,this._z=Math.atan2(-s,l));break;case"YZX":this._z=Math.asin(th(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-u,l),this._y=Math.atan2(-c,i)):(this._x=0,this._y=Math.atan2(o,d));break;case"XZY":this._z=Math.asin(-th(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(h,l),this._y=Math.atan2(o,i)):(this._x=Math.atan2(-u,d),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+e)}return this._order=e,!0===n&&this._onChangeCallback(),this}setFromQuaternion(t,e,n){return md.makeRotationFromQuaternion(t),this.setFromRotationMatrix(md,e,n)}setFromVector3(t,e=this._order){return this.set(t.x,t.y,t.z,e)}reorder(t){return gd.setFromEuler(this),this.setFromQuaternion(gd,t)}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order}fromArray(t){return this._x=t[0],this._y=t[1],this._z=t[2],void 0!==t[3]&&(this._order=t[3]),this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._order,t}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}vd.DEFAULT_ORDER="XYZ";class yd{constructor(){this.mask=1}set(t){this.mask=(1<<t|0)>>>0}enable(t){this.mask|=1<<t|0}enableAll(){this.mask=-1}toggle(t){this.mask^=1<<t|0}disable(t){this.mask&=~(1<<t|0)}disableAll(){this.mask=0}test(t){return 0!=(this.mask&t.mask)}isEnabled(t){return 0!=(this.mask&(1<<t|0))}}let _d=0;const xd=new Ph,bd=new Nh,wd=new ad,Sd=new Ph,Md=new Ph,Ed=new Ph,Td=new Nh,Ad=new Ph(1,0,0),Cd=new Ph(0,1,0),Rd=new Ph(0,0,1),Nd={type:"added"},Pd={type:"removed"},Id={type:"childadded",child:null},Od={type:"childremoved",child:null};class Dd extends Zc{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:_d++}),this.uuid=Qc(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Dd.DEFAULT_UP.clone();const t=new Ph,e=new vd,n=new Nh,r=new Ph(1,1,1);e._onChange((function(){n.setFromEuler(e,!1)})),n._onChange((function(){e.setFromQuaternion(n,void 0,!1)})),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:t},rotation:{configurable:!0,enumerable:!0,value:e},quaternion:{configurable:!0,enumerable:!0,value:n},scale:{configurable:!0,enumerable:!0,value:r},modelViewMatrix:{value:new ad},normalMatrix:{value:new ah}}),this.matrix=new ad,this.matrixWorld=new ad,this.matrixAutoUpdate=Dd.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=Dd.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new yd,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(t){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(t),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(t){return this.quaternion.premultiply(t),this}setRotationFromAxisAngle(t,e){this.quaternion.setFromAxisAngle(t,e)}setRotationFromEuler(t){this.quaternion.setFromEuler(t,!0)}setRotationFromMatrix(t){this.quaternion.setFromRotationMatrix(t)}setRotationFromQuaternion(t){this.quaternion.copy(t)}rotateOnAxis(t,e){return bd.setFromAxisAngle(t,e),this.quaternion.multiply(bd),this}rotateOnWorldAxis(t,e){return bd.setFromAxisAngle(t,e),this.quaternion.premultiply(bd),this}rotateX(t){return this.rotateOnAxis(Ad,t)}rotateY(t){return this.rotateOnAxis(Cd,t)}rotateZ(t){return this.rotateOnAxis(Rd,t)}translateOnAxis(t,e){return xd.copy(t).applyQuaternion(this.quaternion),this.position.add(xd.multiplyScalar(e)),this}translateX(t){return this.translateOnAxis(Ad,t)}translateY(t){return this.translateOnAxis(Cd,t)}translateZ(t){return this.translateOnAxis(Rd,t)}localToWorld(t){return this.updateWorldMatrix(!0,!1),t.applyMatrix4(this.matrixWorld)}worldToLocal(t){return this.updateWorldMatrix(!0,!1),t.applyMatrix4(wd.copy(this.matrixWorld).invert())}lookAt(t,e,n){t.isVector3?Sd.copy(t):Sd.set(t,e,n);const r=this.parent;this.updateWorldMatrix(!0,!1),Md.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?wd.lookAt(Md,Sd,this.up):wd.lookAt(Sd,Md,this.up),this.quaternion.setFromRotationMatrix(wd),r&&(wd.extractRotation(r.matrixWorld),bd.setFromRotationMatrix(wd),this.quaternion.premultiply(bd.invert()))}add(t){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return t===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",t),this):(t&&t.isObject3D?(t.removeFromParent(),t.parent=this,this.children.push(t),t.dispatchEvent(Nd),Id.child=t,this.dispatchEvent(Id),Id.child=null):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",t),this)}remove(t){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.remove(arguments[t]);return this}const e=this.children.indexOf(t);return-1!==e&&(t.parent=null,this.children.splice(e,1),t.dispatchEvent(Pd),Od.child=t,this.dispatchEvent(Od),Od.child=null),this}removeFromParent(){const t=this.parent;return null!==t&&t.remove(this),this}clear(){return this.remove(...this.children)}attach(t){return this.updateWorldMatrix(!0,!1),wd.copy(this.matrixWorld).invert(),null!==t.parent&&(t.parent.updateWorldMatrix(!0,!1),wd.multiply(t.parent.matrixWorld)),t.applyMatrix4(wd),t.removeFromParent(),t.parent=this,this.children.push(t),t.updateWorldMatrix(!1,!0),t.dispatchEvent(Nd),Id.child=t,this.dispatchEvent(Id),Id.child=null,this}getObjectById(t){return this.getObjectByProperty("id",t)}getObjectByName(t){return this.getObjectByProperty("name",t)}getObjectByProperty(t,e){if(this[t]===e)return this;for(let n=0,r=this.children.length;n<r;n++){const r=this.children[n].getObjectByProperty(t,e);if(void 0!==r)return r}}getObjectsByProperty(t,e,n=[]){this[t]===e&&n.push(this);const r=this.children;for(let i=0,s=r.length;i<s;i++)r[i].getObjectsByProperty(t,e,n);return n}getWorldPosition(t){return this.updateWorldMatrix(!0,!1),t.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Md,t,Ed),t}getWorldScale(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Md,Td,t),t}getWorldDirection(t){this.updateWorldMatrix(!0,!1);const e=this.matrixWorld.elements;return t.set(e[8],e[9],e[10]).normalize()}raycast(){}traverse(t){t(this);const e=this.children;for(let n=0,r=e.length;n<r;n++)e[n].traverse(t)}traverseVisible(t){if(!1===this.visible)return;t(this);const e=this.children;for(let n=0,r=e.length;n<r;n++)e[n].traverseVisible(t)}traverseAncestors(t){const e=this.parent;null!==e&&(t(e),e.traverseAncestors(t))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(!0===this.matrixWorldAutoUpdate&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),this.matrixWorldNeedsUpdate=!1,t=!0);const e=this.children;for(let n=0,r=e.length;n<r;n++){e[n].updateMatrixWorld(t)}}updateWorldMatrix(t,e){const n=this.parent;if(!0===t&&null!==n&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),!0===this.matrixWorldAutoUpdate&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),!0===e){const t=this.children;for(let e=0,n=t.length;e<n;e++){t[e].updateWorldMatrix(!1,!0)}}}toJSON(t){const e=void 0===t||"string"==typeof t,n={};e&&(t={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},n.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});const r={};function i(e,n){return void 0===e[n.uuid]&&(e[n.uuid]=n.toJSON(t)),n.uuid}if(r.uuid=this.uuid,r.type=this.type,""!==this.name&&(r.name=this.name),!0===this.castShadow&&(r.castShadow=!0),!0===this.receiveShadow&&(r.receiveShadow=!0),!1===this.visible&&(r.visible=!1),!1===this.frustumCulled&&(r.frustumCulled=!1),0!==this.renderOrder&&(r.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(r.userData=this.userData),r.layers=this.layers.mask,r.matrix=this.matrix.toArray(),r.up=this.up.toArray(),!1===this.matrixAutoUpdate&&(r.matrixAutoUpdate=!1),this.isInstancedMesh&&(r.type="InstancedMesh",r.count=this.count,r.instanceMatrix=this.instanceMatrix.toJSON(),null!==this.instanceColor&&(r.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(r.type="BatchedMesh",r.perObjectFrustumCulled=this.perObjectFrustumCulled,r.sortObjects=this.sortObjects,r.drawRanges=this._drawRanges,r.reservedRanges=this._reservedRanges,r.visibility=this._visibility,r.active=this._active,r.bounds=this._bounds.map((t=>({boxInitialized:t.boxInitialized,boxMin:t.box.min.toArray(),boxMax:t.box.max.toArray(),sphereInitialized:t.sphereInitialized,sphereRadius:t.sphere.radius,sphereCenter:t.sphere.center.toArray()}))),r.maxInstanceCount=this._maxInstanceCount,r.maxVertexCount=this._maxVertexCount,r.maxIndexCount=this._maxIndexCount,r.geometryInitialized=this._geometryInitialized,r.geometryCount=this._geometryCount,r.matricesTexture=this._matricesTexture.toJSON(t),null!==this._colorsTexture&&(r.colorsTexture=this._colorsTexture.toJSON(t)),null!==this.boundingSphere&&(r.boundingSphere={center:r.boundingSphere.center.toArray(),radius:r.boundingSphere.radius}),null!==this.boundingBox&&(r.boundingBox={min:r.boundingBox.min.toArray(),max:r.boundingBox.max.toArray()})),this.isScene)this.background&&(this.background.isColor?r.background=this.background.toJSON():this.background.isTexture&&(r.background=this.background.toJSON(t).uuid)),this.environment&&this.environment.isTexture&&!0!==this.environment.isRenderTargetTexture&&(r.environment=this.environment.toJSON(t).uuid);else if(this.isMesh||this.isLine||this.isPoints){r.geometry=i(t.geometries,this.geometry);const e=this.geometry.parameters;if(void 0!==e&&void 0!==e.shapes){const n=e.shapes;if(Array.isArray(n))for(let e=0,r=n.length;e<r;e++){const r=n[e];i(t.shapes,r)}else i(t.shapes,n)}}if(this.isSkinnedMesh&&(r.bindMode=this.bindMode,r.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(i(t.skeletons,this.skeleton),r.skeleton=this.skeleton.uuid)),void 0!==this.material)if(Array.isArray(this.material)){const e=[];for(let n=0,r=this.material.length;n<r;n++)e.push(i(t.materials,this.material[n]));r.material=e}else r.material=i(t.materials,this.material);if(this.children.length>0){r.children=[];for(let e=0;e<this.children.length;e++)r.children.push(this.children[e].toJSON(t).object)}if(this.animations.length>0){r.animations=[];for(let e=0;e<this.animations.length;e++){const n=this.animations[e];r.animations.push(i(t.animations,n))}}if(e){const e=s(t.geometries),r=s(t.materials),i=s(t.textures),o=s(t.images),a=s(t.shapes),l=s(t.skeletons),u=s(t.animations),c=s(t.nodes);e.length>0&&(n.geometries=e),r.length>0&&(n.materials=r),i.length>0&&(n.textures=i),o.length>0&&(n.images=o),a.length>0&&(n.shapes=a),l.length>0&&(n.skeletons=l),u.length>0&&(n.animations=u),c.length>0&&(n.nodes=c)}return n.object=r,n;function s(t){const e=[];for(const n in t){const r=t[n];delete r.metadata,e.push(r)}return e}}clone(t){return(new this.constructor).copy(this,t)}copy(t,e=!0){if(this.name=t.name,this.up.copy(t.up),this.position.copy(t.position),this.rotation.order=t.rotation.order,this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.matrix.copy(t.matrix),this.matrixWorld.copy(t.matrixWorld),this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrixWorldAutoUpdate=t.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate,this.layers.mask=t.layers.mask,this.visible=t.visible,this.castShadow=t.castShadow,this.receiveShadow=t.receiveShadow,this.frustumCulled=t.frustumCulled,this.renderOrder=t.renderOrder,this.animations=t.animations.slice(),this.userData=JSON.parse(JSON.stringify(t.userData)),!0===e)for(let e=0;e<t.children.length;e++){const n=t.children[e];this.add(n.clone())}return this}}Dd.DEFAULT_UP=new Ph(0,1,0),Dd.DEFAULT_MATRIX_AUTO_UPDATE=!0,Dd.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const Ld=new Ph,Ud=new Ph,kd=new Ph,Bd=new Ph,Fd=new Ph,zd=new Ph,Vd=new Ph,Gd=new Ph,jd=new Ph,Hd=new Ph,Wd=new Th,qd=new Th,Xd=new Th;class Zd{constructor(t=new Ph,e=new Ph,n=new Ph){this.a=t,this.b=e,this.c=n}static getNormal(t,e,n,r){r.subVectors(n,e),Ld.subVectors(t,e),r.cross(Ld);const i=r.lengthSq();return i>0?r.multiplyScalar(1/Math.sqrt(i)):r.set(0,0,0)}static getBarycoord(t,e,n,r,i){Ld.subVectors(r,e),Ud.subVectors(n,e),kd.subVectors(t,e);const s=Ld.dot(Ld),o=Ld.dot(Ud),a=Ld.dot(kd),l=Ud.dot(Ud),u=Ud.dot(kd),c=s*l-o*o;if(0===c)return i.set(0,0,0),null;const h=1/c,d=(l*a-o*u)*h,p=(s*u-o*a)*h;return i.set(1-d-p,p,d)}static containsPoint(t,e,n,r){return null!==this.getBarycoord(t,e,n,r,Bd)&&(Bd.x>=0&&Bd.y>=0&&Bd.x+Bd.y<=1)}static getInterpolation(t,e,n,r,i,s,o,a){return null===this.getBarycoord(t,e,n,r,Bd)?(a.x=0,a.y=0,"z"in a&&(a.z=0),"w"in a&&(a.w=0),null):(a.setScalar(0),a.addScaledVector(i,Bd.x),a.addScaledVector(s,Bd.y),a.addScaledVector(o,Bd.z),a)}static getInterpolatedAttribute(t,e,n,r,i,s){return Wd.setScalar(0),qd.setScalar(0),Xd.setScalar(0),Wd.fromBufferAttribute(t,e),qd.fromBufferAttribute(t,n),Xd.fromBufferAttribute(t,r),s.setScalar(0),s.addScaledVector(Wd,i.x),s.addScaledVector(qd,i.y),s.addScaledVector(Xd,i.z),s}static isFrontFacing(t,e,n,r){return Ld.subVectors(n,e),Ud.subVectors(t,e),Ld.cross(Ud).dot(r)<0}set(t,e,n){return this.a.copy(t),this.b.copy(e),this.c.copy(n),this}setFromPointsAndIndices(t,e,n,r){return this.a.copy(t[e]),this.b.copy(t[n]),this.c.copy(t[r]),this}setFromAttributeAndIndices(t,e,n,r){return this.a.fromBufferAttribute(t,e),this.b.fromBufferAttribute(t,n),this.c.fromBufferAttribute(t,r),this}clone(){return(new this.constructor).copy(this)}copy(t){return this.a.copy(t.a),this.b.copy(t.b),this.c.copy(t.c),this}getArea(){return Ld.subVectors(this.c,this.b),Ud.subVectors(this.a,this.b),.5*Ld.cross(Ud).length()}getMidpoint(t){return t.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(t){return Zd.getNormal(this.a,this.b,this.c,t)}getPlane(t){return t.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(t,e){return Zd.getBarycoord(t,this.a,this.b,this.c,e)}getInterpolation(t,e,n,r,i){return Zd.getInterpolation(t,this.a,this.b,this.c,e,n,r,i)}containsPoint(t){return Zd.containsPoint(t,this.a,this.b,this.c)}isFrontFacing(t){return Zd.isFrontFacing(this.a,this.b,this.c,t)}intersectsBox(t){return t.intersectsTriangle(this)}closestPointToPoint(t,e){const n=this.a,r=this.b,i=this.c;let s,o;Fd.subVectors(r,n),zd.subVectors(i,n),Gd.subVectors(t,n);const a=Fd.dot(Gd),l=zd.dot(Gd);if(a<=0&&l<=0)return e.copy(n);jd.subVectors(t,r);const u=Fd.dot(jd),c=zd.dot(jd);if(u>=0&&c<=u)return e.copy(r);const h=a*c-u*l;if(h<=0&&a>=0&&u<=0)return s=a/(a-u),e.copy(n).addScaledVector(Fd,s);Hd.subVectors(t,i);const d=Fd.dot(Hd),p=zd.dot(Hd);if(p>=0&&d<=p)return e.copy(i);const f=d*l-a*p;if(f<=0&&l>=0&&p<=0)return o=l/(l-p),e.copy(n).addScaledVector(zd,o);const m=u*p-d*c;if(m<=0&&c-u>=0&&d-p>=0)return Vd.subVectors(i,r),o=(c-u)/(c-u+(d-p)),e.copy(r).addScaledVector(Vd,o);const g=1/(m+f+h);return s=f*g,o=h*g,e.copy(n).addScaledVector(Fd,s).addScaledVector(zd,o)}equals(t){return t.a.equals(this.a)&&t.b.equals(this.b)&&t.c.equals(this.c)}}const $d={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Yd={h:0,s:0,l:0},Kd={h:0,s:0,l:0};function Jd(t,e,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?t+6*(e-t)*n:n<.5?e:n<2/3?t+6*(e-t)*(2/3-n):t}class Qd{constructor(t,e,n){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(t,e,n)}set(t,e,n){if(void 0===e&&void 0===n){const e=t;e&&e.isColor?this.copy(e):"number"==typeof e?this.setHex(e):"string"==typeof e&&this.setStyle(e)}else this.setRGB(t,e,n);return this}setScalar(t){return this.r=t,this.g=t,this.b=t,this}setHex(t,e=Fc){return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(255&t)/255,hh.toWorkingColorSpace(this,e),this}setRGB(t,e,n,r=hh.workingColorSpace){return this.r=t,this.g=e,this.b=n,hh.toWorkingColorSpace(this,r),this}setHSL(t,e,n,r=hh.workingColorSpace){if(t=eh(t,1),e=th(e,0,1),n=th(n,0,1),0===e)this.r=this.g=this.b=n;else{const r=n<=.5?n*(1+e):n+e-n*e,i=2*n-r;this.r=Jd(i,r,t+1/3),this.g=Jd(i,r,t),this.b=Jd(i,r,t-1/3)}return hh.toWorkingColorSpace(this,r),this}setStyle(t,e=Fc){function n(e){void 0!==e&&parseFloat(e)<1&&console.warn("THREE.Color: Alpha component of "+t+" will be ignored.")}let r;if(r=/^(\w+)\(([^\)]*)\)/.exec(t)){let i;const s=r[1],o=r[2];switch(s){case"rgb":case"rgba":if(i=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return n(i[4]),this.setRGB(Math.min(255,parseInt(i[1],10))/255,Math.min(255,parseInt(i[2],10))/255,Math.min(255,parseInt(i[3],10))/255,e);if(i=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return n(i[4]),this.setRGB(Math.min(100,parseInt(i[1],10))/100,Math.min(100,parseInt(i[2],10))/100,Math.min(100,parseInt(i[3],10))/100,e);break;case"hsl":case"hsla":if(i=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return n(i[4]),this.setHSL(parseFloat(i[1])/360,parseFloat(i[2])/100,parseFloat(i[3])/100,e);break;default:console.warn("THREE.Color: Unknown color model "+t)}}else if(r=/^\#([A-Fa-f\d]+)$/.exec(t)){const n=r[1],i=n.length;if(3===i)return this.setRGB(parseInt(n.charAt(0),16)/15,parseInt(n.charAt(1),16)/15,parseInt(n.charAt(2),16)/15,e);if(6===i)return this.setHex(parseInt(n,16),e);console.warn("THREE.Color: Invalid hex color "+t)}else if(t&&t.length>0)return this.setColorName(t,e);return this}setColorName(t,e=Fc){const n=$d[t.toLowerCase()];return void 0!==n?this.setHex(n,e):console.warn("THREE.Color: Unknown color "+t),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(t){return this.r=t.r,this.g=t.g,this.b=t.b,this}copySRGBToLinear(t){return this.r=dh(t.r),this.g=dh(t.g),this.b=dh(t.b),this}copyLinearToSRGB(t){return this.r=ph(t.r),this.g=ph(t.g),this.b=ph(t.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(t=Fc){return hh.fromWorkingColorSpace(tp.copy(this),t),65536*Math.round(th(255*tp.r,0,255))+256*Math.round(th(255*tp.g,0,255))+Math.round(th(255*tp.b,0,255))}getHexString(t=Fc){return("000000"+this.getHex(t).toString(16)).slice(-6)}getHSL(t,e=hh.workingColorSpace){hh.fromWorkingColorSpace(tp.copy(this),e);const n=tp.r,r=tp.g,i=tp.b,s=Math.max(n,r,i),o=Math.min(n,r,i);let a,l;const u=(o+s)/2;if(o===s)a=0,l=0;else{const t=s-o;switch(l=u<=.5?t/(s+o):t/(2-s-o),s){case n:a=(r-i)/t+(r<i?6:0);break;case r:a=(i-n)/t+2;break;case i:a=(n-r)/t+4}a/=6}return t.h=a,t.s=l,t.l=u,t}getRGB(t,e=hh.workingColorSpace){return hh.fromWorkingColorSpace(tp.copy(this),e),t.r=tp.r,t.g=tp.g,t.b=tp.b,t}getStyle(t=Fc){hh.fromWorkingColorSpace(tp.copy(this),t);const e=tp.r,n=tp.g,r=tp.b;return t!==Fc?`color(${t} ${e.toFixed(3)} ${n.toFixed(3)} ${r.toFixed(3)})`:`rgb(${Math.round(255*e)},${Math.round(255*n)},${Math.round(255*r)})`}offsetHSL(t,e,n){return this.getHSL(Yd),this.setHSL(Yd.h+t,Yd.s+e,Yd.l+n)}add(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this}addColors(t,e){return this.r=t.r+e.r,this.g=t.g+e.g,this.b=t.b+e.b,this}addScalar(t){return this.r+=t,this.g+=t,this.b+=t,this}sub(t){return this.r=Math.max(0,this.r-t.r),this.g=Math.max(0,this.g-t.g),this.b=Math.max(0,this.b-t.b),this}multiply(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this}multiplyScalar(t){return this.r*=t,this.g*=t,this.b*=t,this}lerp(t,e){return this.r+=(t.r-this.r)*e,this.g+=(t.g-this.g)*e,this.b+=(t.b-this.b)*e,this}lerpColors(t,e,n){return this.r=t.r+(e.r-t.r)*n,this.g=t.g+(e.g-t.g)*n,this.b=t.b+(e.b-t.b)*n,this}lerpHSL(t,e){this.getHSL(Yd),t.getHSL(Kd);const n=nh(Yd.h,Kd.h,e),r=nh(Yd.s,Kd.s,e),i=nh(Yd.l,Kd.l,e);return this.setHSL(n,r,i),this}setFromVector3(t){return this.r=t.x,this.g=t.y,this.b=t.z,this}applyMatrix3(t){const e=this.r,n=this.g,r=this.b,i=t.elements;return this.r=i[0]*e+i[3]*n+i[6]*r,this.g=i[1]*e+i[4]*n+i[7]*r,this.b=i[2]*e+i[5]*n+i[8]*r,this}equals(t){return t.r===this.r&&t.g===this.g&&t.b===this.b}fromArray(t,e=0){return this.r=t[e],this.g=t[e+1],this.b=t[e+2],this}toArray(t=[],e=0){return t[e]=this.r,t[e+1]=this.g,t[e+2]=this.b,t}fromBufferAttribute(t,e){return this.r=t.getX(e),this.g=t.getY(e),this.b=t.getZ(e),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const tp=new Qd;Qd.NAMES=$d;let ep=0;class np extends Zc{static get type(){return"Material"}get type(){return this.constructor.type}set type(t){}constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:ep++}),this.uuid=Qc(),this.name="",this.blending=1,this.side=0,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=Nu,this.blendDst=Pu,this.blendEquation=Ru,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new Qd(0,0,0),this.blendAlpha=0,this.depthFunc=3,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=519,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=jc,this.stencilZFail=jc,this.stencilZPass=jc,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(t){this._alphaTest>0!=t>0&&this.version++,this._alphaTest=t}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(t){if(void 0!==t)for(const e in t){const n=t[e];if(void 0===n){console.warn(`THREE.Material: parameter '${e}' has value of undefined.`);continue}const r=this[e];void 0!==r?r&&r.isColor?r.set(n):r&&r.isVector3&&n&&n.isVector3?r.copy(n):this[e]=n:console.warn(`THREE.Material: '${e}' is not a property of THREE.${this.type}.`)}}toJSON(t){const e=void 0===t||"string"==typeof t;e&&(t={textures:{},images:{}});const n={metadata:{version:4.6,type:"Material",generator:"Material.toJSON"}};function r(t){const e=[];for(const n in t){const r=t[n];delete r.metadata,e.push(r)}return e}if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),void 0!==this.roughness&&(n.roughness=this.roughness),void 0!==this.metalness&&(n.metalness=this.metalness),void 0!==this.sheen&&(n.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(n.sheenColor=this.sheenColor.getHex()),void 0!==this.sheenRoughness&&(n.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),void 0!==this.emissiveIntensity&&1!==this.emissiveIntensity&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),void 0!==this.specularIntensity&&(n.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(n.specularColor=this.specularColor.getHex()),void 0!==this.shininess&&(n.shininess=this.shininess),void 0!==this.clearcoat&&(n.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(n.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(n.clearcoatMap=this.clearcoatMap.toJSON(t).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(n.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(t).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(n.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(t).uuid,n.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),void 0!==this.dispersion&&(n.dispersion=this.dispersion),void 0!==this.iridescence&&(n.iridescence=this.iridescence),void 0!==this.iridescenceIOR&&(n.iridescenceIOR=this.iridescenceIOR),void 0!==this.iridescenceThicknessRange&&(n.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(n.iridescenceMap=this.iridescenceMap.toJSON(t).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(n.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(t).uuid),void 0!==this.anisotropy&&(n.anisotropy=this.anisotropy),void 0!==this.anisotropyRotation&&(n.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(n.anisotropyMap=this.anisotropyMap.toJSON(t).uuid),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(t).uuid),this.matcap&&this.matcap.isTexture&&(n.matcap=this.matcap.toJSON(t).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(t).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(t).uuid,n.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(n.aoMap=this.aoMap.toJSON(t).uuid,n.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(t).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(t).uuid,n.normalMapType=this.normalMapType,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(t).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(t).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(t).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(t).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(t).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(n.specularIntensityMap=this.specularIntensityMap.toJSON(t).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(n.specularColorMap=this.specularColorMap.toJSON(t).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(t).uuid,void 0!==this.combine&&(n.combine=this.combine)),void 0!==this.envMapRotation&&(n.envMapRotation=this.envMapRotation.toArray()),void 0!==this.envMapIntensity&&(n.envMapIntensity=this.envMapIntensity),void 0!==this.reflectivity&&(n.reflectivity=this.reflectivity),void 0!==this.refractionRatio&&(n.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(t).uuid),void 0!==this.transmission&&(n.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(n.transmissionMap=this.transmissionMap.toJSON(t).uuid),void 0!==this.thickness&&(n.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(n.thicknessMap=this.thicknessMap.toJSON(t).uuid),void 0!==this.attenuationDistance&&this.attenuationDistance!==1/0&&(n.attenuationDistance=this.attenuationDistance),void 0!==this.attenuationColor&&(n.attenuationColor=this.attenuationColor.getHex()),void 0!==this.size&&(n.size=this.size),null!==this.shadowSide&&(n.shadowSide=this.shadowSide),void 0!==this.sizeAttenuation&&(n.sizeAttenuation=this.sizeAttenuation),1!==this.blending&&(n.blending=this.blending),0!==this.side&&(n.side=this.side),!0===this.vertexColors&&(n.vertexColors=!0),this.opacity<1&&(n.opacity=this.opacity),!0===this.transparent&&(n.transparent=!0),this.blendSrc!==Nu&&(n.blendSrc=this.blendSrc),this.blendDst!==Pu&&(n.blendDst=this.blendDst),this.blendEquation!==Ru&&(n.blendEquation=this.blendEquation),null!==this.blendSrcAlpha&&(n.blendSrcAlpha=this.blendSrcAlpha),null!==this.blendDstAlpha&&(n.blendDstAlpha=this.blendDstAlpha),null!==this.blendEquationAlpha&&(n.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(n.blendColor=this.blendColor.getHex()),0!==this.blendAlpha&&(n.blendAlpha=this.blendAlpha),3!==this.depthFunc&&(n.depthFunc=this.depthFunc),!1===this.depthTest&&(n.depthTest=this.depthTest),!1===this.depthWrite&&(n.depthWrite=this.depthWrite),!1===this.colorWrite&&(n.colorWrite=this.colorWrite),255!==this.stencilWriteMask&&(n.stencilWriteMask=this.stencilWriteMask),519!==this.stencilFunc&&(n.stencilFunc=this.stencilFunc),0!==this.stencilRef&&(n.stencilRef=this.stencilRef),255!==this.stencilFuncMask&&(n.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==jc&&(n.stencilFail=this.stencilFail),this.stencilZFail!==jc&&(n.stencilZFail=this.stencilZFail),this.stencilZPass!==jc&&(n.stencilZPass=this.stencilZPass),!0===this.stencilWrite&&(n.stencilWrite=this.stencilWrite),void 0!==this.rotation&&0!==this.rotation&&(n.rotation=this.rotation),!0===this.polygonOffset&&(n.polygonOffset=!0),0!==this.polygonOffsetFactor&&(n.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(n.polygonOffsetUnits=this.polygonOffsetUnits),void 0!==this.linewidth&&1!==this.linewidth&&(n.linewidth=this.linewidth),void 0!==this.dashSize&&(n.dashSize=this.dashSize),void 0!==this.gapSize&&(n.gapSize=this.gapSize),void 0!==this.scale&&(n.scale=this.scale),!0===this.dithering&&(n.dithering=!0),this.alphaTest>0&&(n.alphaTest=this.alphaTest),!0===this.alphaHash&&(n.alphaHash=!0),!0===this.alphaToCoverage&&(n.alphaToCoverage=!0),!0===this.premultipliedAlpha&&(n.premultipliedAlpha=!0),!0===this.forceSinglePass&&(n.forceSinglePass=!0),!0===this.wireframe&&(n.wireframe=!0),this.wireframeLinewidth>1&&(n.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(n.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(n.wireframeLinejoin=this.wireframeLinejoin),!0===this.flatShading&&(n.flatShading=!0),!1===this.visible&&(n.visible=!1),!1===this.toneMapped&&(n.toneMapped=!1),!1===this.fog&&(n.fog=!1),Object.keys(this.userData).length>0&&(n.userData=this.userData),e){const e=r(t.textures),i=r(t.images);e.length>0&&(n.textures=e),i.length>0&&(n.images=i)}return n}clone(){return(new this.constructor).copy(this)}copy(t){this.name=t.name,this.blending=t.blending,this.side=t.side,this.vertexColors=t.vertexColors,this.opacity=t.opacity,this.transparent=t.transparent,this.blendSrc=t.blendSrc,this.blendDst=t.blendDst,this.blendEquation=t.blendEquation,this.blendSrcAlpha=t.blendSrcAlpha,this.blendDstAlpha=t.blendDstAlpha,this.blendEquationAlpha=t.blendEquationAlpha,this.blendColor.copy(t.blendColor),this.blendAlpha=t.blendAlpha,this.depthFunc=t.depthFunc,this.depthTest=t.depthTest,this.depthWrite=t.depthWrite,this.stencilWriteMask=t.stencilWriteMask,this.stencilFunc=t.stencilFunc,this.stencilRef=t.stencilRef,this.stencilFuncMask=t.stencilFuncMask,this.stencilFail=t.stencilFail,this.stencilZFail=t.stencilZFail,this.stencilZPass=t.stencilZPass,this.stencilWrite=t.stencilWrite;const e=t.clippingPlanes;let n=null;if(null!==e){const t=e.length;n=new Array(t);for(let r=0;r!==t;++r)n[r]=e[r].clone()}return this.clippingPlanes=n,this.clipIntersection=t.clipIntersection,this.clipShadows=t.clipShadows,this.shadowSide=t.shadowSide,this.colorWrite=t.colorWrite,this.precision=t.precision,this.polygonOffset=t.polygonOffset,this.polygonOffsetFactor=t.polygonOffsetFactor,this.polygonOffsetUnits=t.polygonOffsetUnits,this.dithering=t.dithering,this.alphaTest=t.alphaTest,this.alphaHash=t.alphaHash,this.alphaToCoverage=t.alphaToCoverage,this.premultipliedAlpha=t.premultipliedAlpha,this.forceSinglePass=t.forceSinglePass,this.visible=t.visible,this.toneMapped=t.toneMapped,this.userData=JSON.parse(JSON.stringify(t.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(t){!0===t&&this.version++}onBuild(){console.warn("Material: onBuild() has been removed.")}}class rp extends np{static get type(){return"MeshBasicMaterial"}constructor(t){super(),this.isMeshBasicMaterial=!0,this.color=new Qd(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new vd,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapRotation.copy(t.envMapRotation),this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.fog=t.fog,this}}const ip=sp();function sp(){const t=new ArrayBuffer(4),e=new Float32Array(t),n=new Uint32Array(t),r=new Uint32Array(512),i=new Uint32Array(512);for(let t=0;t<256;++t){const e=t-127;e<-27?(r[t]=0,r[256|t]=32768,i[t]=24,i[256|t]=24):e<-14?(r[t]=1024>>-e-14,r[256|t]=1024>>-e-14|32768,i[t]=-e-1,i[256|t]=-e-1):e<=15?(r[t]=e+15<<10,r[256|t]=e+15<<10|32768,i[t]=13,i[256|t]=13):e<128?(r[t]=31744,r[256|t]=64512,i[t]=24,i[256|t]=24):(r[t]=31744,r[256|t]=64512,i[t]=13,i[256|t]=13)}const s=new Uint32Array(2048),o=new Uint32Array(64),a=new Uint32Array(64);for(let t=1;t<1024;++t){let e=t<<13,n=0;for(;0==(8388608&e);)e<<=1,n-=8388608;e&=-8388609,n+=947912704,s[t]=e|n}for(let t=1024;t<2048;++t)s[t]=939524096+(t-1024<<13);for(let t=1;t<31;++t)o[t]=t<<23;o[31]=1199570944,o[32]=2147483648;for(let t=33;t<63;++t)o[t]=2147483648+(t-32<<23);o[63]=3347054592;for(let t=1;t<64;++t)32!==t&&(a[t]=1024);return{floatView:e,uint32View:n,baseTable:r,shiftTable:i,mantissaTable:s,exponentTable:o,offsetTable:a}}function op(t){Math.abs(t)>65504&&console.warn("THREE.DataUtils.toHalfFloat(): Value out of range."),t=th(t,-65504,65504),ip.floatView[0]=t;const e=ip.uint32View[0],n=e>>23&511;return ip.baseTable[n]+((8388607&e)>>ip.shiftTable[n])}function ap(t){const e=t>>10;return ip.uint32View[0]=ip.mantissaTable[ip.offsetTable[e]+(1023&t)]+ip.exponentTable[e],ip.floatView[0]}const lp=new Ph,up=new oh;class cp{constructor(t,e,n=!1){if(Array.isArray(t))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=t,this.itemSize=e,this.count=void 0!==t?t.length/e:0,this.normalized=n,this.usage=Hc,this.updateRanges=[],this.gpuType=Qu,this.version=0}onUploadCallback(){}set needsUpdate(t){!0===t&&this.version++}setUsage(t){return this.usage=t,this}addUpdateRange(t,e){this.updateRanges.push({start:t,count:e})}clearUpdateRanges(){this.updateRanges.length=0}copy(t){return this.name=t.name,this.array=new t.array.constructor(t.array),this.itemSize=t.itemSize,this.count=t.count,this.normalized=t.normalized,this.usage=t.usage,this.gpuType=t.gpuType,this}copyAt(t,e,n){t*=this.itemSize,n*=e.itemSize;for(let r=0,i=this.itemSize;r<i;r++)this.array[t+r]=e.array[n+r];return this}copyArray(t){return this.array.set(t),this}applyMatrix3(t){if(2===this.itemSize)for(let e=0,n=this.count;e<n;e++)up.fromBufferAttribute(this,e),up.applyMatrix3(t),this.setXY(e,up.x,up.y);else if(3===this.itemSize)for(let e=0,n=this.count;e<n;e++)lp.fromBufferAttribute(this,e),lp.applyMatrix3(t),this.setXYZ(e,lp.x,lp.y,lp.z);return this}applyMatrix4(t){for(let e=0,n=this.count;e<n;e++)lp.fromBufferAttribute(this,e),lp.applyMatrix4(t),this.setXYZ(e,lp.x,lp.y,lp.z);return this}applyNormalMatrix(t){for(let e=0,n=this.count;e<n;e++)lp.fromBufferAttribute(this,e),lp.applyNormalMatrix(t),this.setXYZ(e,lp.x,lp.y,lp.z);return this}transformDirection(t){for(let e=0,n=this.count;e<n;e++)lp.fromBufferAttribute(this,e),lp.transformDirection(t),this.setXYZ(e,lp.x,lp.y,lp.z);return this}set(t,e=0){return this.array.set(t,e),this}getComponent(t,e){let n=this.array[t*this.itemSize+e];return this.normalized&&(n=rh(n,this.array)),n}setComponent(t,e,n){return this.normalized&&(n=ih(n,this.array)),this.array[t*this.itemSize+e]=n,this}getX(t){let e=this.array[t*this.itemSize];return this.normalized&&(e=rh(e,this.array)),e}setX(t,e){return this.normalized&&(e=ih(e,this.array)),this.array[t*this.itemSize]=e,this}getY(t){let e=this.array[t*this.itemSize+1];return this.normalized&&(e=rh(e,this.array)),e}setY(t,e){return this.normalized&&(e=ih(e,this.array)),this.array[t*this.itemSize+1]=e,this}getZ(t){let e=this.array[t*this.itemSize+2];return this.normalized&&(e=rh(e,this.array)),e}setZ(t,e){return this.normalized&&(e=ih(e,this.array)),this.array[t*this.itemSize+2]=e,this}getW(t){let e=this.array[t*this.itemSize+3];return this.normalized&&(e=rh(e,this.array)),e}setW(t,e){return this.normalized&&(e=ih(e,this.array)),this.array[t*this.itemSize+3]=e,this}setXY(t,e,n){return t*=this.itemSize,this.normalized&&(e=ih(e,this.array),n=ih(n,this.array)),this.array[t+0]=e,this.array[t+1]=n,this}setXYZ(t,e,n,r){return t*=this.itemSize,this.normalized&&(e=ih(e,this.array),n=ih(n,this.array),r=ih(r,this.array)),this.array[t+0]=e,this.array[t+1]=n,this.array[t+2]=r,this}setXYZW(t,e,n,r,i){return t*=this.itemSize,this.normalized&&(e=ih(e,this.array),n=ih(n,this.array),r=ih(r,this.array),i=ih(i,this.array)),this.array[t+0]=e,this.array[t+1]=n,this.array[t+2]=r,this.array[t+3]=i,this}onUpload(t){return this.onUploadCallback=t,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const t={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return""!==this.name&&(t.name=this.name),this.usage!==Hc&&(t.usage=this.usage),t}}class hp extends cp{constructor(t,e,n){super(new Uint16Array(t),e,n)}}class dp extends cp{constructor(t,e,n){super(new Uint32Array(t),e,n)}}class pp extends cp{constructor(t,e,n){super(new Uint16Array(t),e,n),this.isFloat16BufferAttribute=!0}getX(t){let e=ap(this.array[t*this.itemSize]);return this.normalized&&(e=rh(e,this.array)),e}setX(t,e){return this.normalized&&(e=ih(e,this.array)),this.array[t*this.itemSize]=op(e),this}getY(t){let e=ap(this.array[t*this.itemSize+1]);return this.normalized&&(e=rh(e,this.array)),e}setY(t,e){return this.normalized&&(e=ih(e,this.array)),this.array[t*this.itemSize+1]=op(e),this}getZ(t){let e=ap(this.array[t*this.itemSize+2]);return this.normalized&&(e=rh(e,this.array)),e}setZ(t,e){return this.normalized&&(e=ih(e,this.array)),this.array[t*this.itemSize+2]=op(e),this}getW(t){let e=ap(this.array[t*this.itemSize+3]);return this.normalized&&(e=rh(e,this.array)),e}setW(t,e){return this.normalized&&(e=ih(e,this.array)),this.array[t*this.itemSize+3]=op(e),this}setXY(t,e,n){return t*=this.itemSize,this.normalized&&(e=ih(e,this.array),n=ih(n,this.array)),this.array[t+0]=op(e),this.array[t+1]=op(n),this}setXYZ(t,e,n,r){return t*=this.itemSize,this.normalized&&(e=ih(e,this.array),n=ih(n,this.array),r=ih(r,this.array)),this.array[t+0]=op(e),this.array[t+1]=op(n),this.array[t+2]=op(r),this}setXYZW(t,e,n,r,i){return t*=this.itemSize,this.normalized&&(e=ih(e,this.array),n=ih(n,this.array),r=ih(r,this.array),i=ih(i,this.array)),this.array[t+0]=op(e),this.array[t+1]=op(n),this.array[t+2]=op(r),this.array[t+3]=op(i),this}}class fp extends cp{constructor(t,e,n){super(new Float32Array(t),e,n)}}let mp=0;const gp=new ad,vp=new Dd,yp=new Ph,_p=new Dh,xp=new Dh,bp=new Ph;class wp extends Zc{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:mp++}),this.uuid=Qc(),this.name="",this.type="BufferGeometry",this.index=null,this.indirect=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(t){return Array.isArray(t)?this.index=new(function(t){for(let e=t.length-1;e>=0;--e)if(t[e]>=65535)return!0;return!1}(t)?dp:hp)(t,1):this.index=t,this}setIndirect(t){return this.indirect=t,this}getIndirect(){return this.indirect}getAttribute(t){return this.attributes[t]}setAttribute(t,e){return this.attributes[t]=e,this}deleteAttribute(t){return delete this.attributes[t],this}hasAttribute(t){return void 0!==this.attributes[t]}addGroup(t,e,n=0){this.groups.push({start:t,count:e,materialIndex:n})}clearGroups(){this.groups=[]}setDrawRange(t,e){this.drawRange.start=t,this.drawRange.count=e}applyMatrix4(t){const e=this.attributes.position;void 0!==e&&(e.applyMatrix4(t),e.needsUpdate=!0);const n=this.attributes.normal;if(void 0!==n){const e=(new ah).getNormalMatrix(t);n.applyNormalMatrix(e),n.needsUpdate=!0}const r=this.attributes.tangent;return void 0!==r&&(r.transformDirection(t),r.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}applyQuaternion(t){return gp.makeRotationFromQuaternion(t),this.applyMatrix4(gp),this}rotateX(t){return gp.makeRotationX(t),this.applyMatrix4(gp),this}rotateY(t){return gp.makeRotationY(t),this.applyMatrix4(gp),this}rotateZ(t){return gp.makeRotationZ(t),this.applyMatrix4(gp),this}translate(t,e,n){return gp.makeTranslation(t,e,n),this.applyMatrix4(gp),this}scale(t,e,n){return gp.makeScale(t,e,n),this.applyMatrix4(gp),this}lookAt(t){return vp.lookAt(t),vp.updateMatrix(),this.applyMatrix4(vp.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(yp).negate(),this.translate(yp.x,yp.y,yp.z),this}setFromPoints(t){const e=this.getAttribute("position");if(void 0===e){const e=[];for(let n=0,r=t.length;n<r;n++){const r=t[n];e.push(r.x,r.y,r.z||0)}this.setAttribute("position",new fp(e,3))}else{for(let n=0,r=e.count;n<r;n++){const r=t[n];e.setXYZ(n,r.x,r.y,r.z||0)}t.length>e.count&&console.warn("THREE.BufferGeometry: Buffer size too small for points data. Use .dispose() and create a new geometry."),e.needsUpdate=!0}return this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new Dh);const t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute)return console.error("THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box.",this),void this.boundingBox.set(new Ph(-1/0,-1/0,-1/0),new Ph(1/0,1/0,1/0));if(void 0!==t){if(this.boundingBox.setFromBufferAttribute(t),e)for(let t=0,n=e.length;t<n;t++){const n=e[t];_p.setFromBufferAttribute(n),this.morphTargetsRelative?(bp.addVectors(this.boundingBox.min,_p.min),this.boundingBox.expandByPoint(bp),bp.addVectors(this.boundingBox.max,_p.max),this.boundingBox.expandByPoint(bp)):(this.boundingBox.expandByPoint(_p.min),this.boundingBox.expandByPoint(_p.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new Jh);const t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute)return console.error("THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere.",this),void this.boundingSphere.set(new Ph,1/0);if(t){const n=this.boundingSphere.center;if(_p.setFromBufferAttribute(t),e)for(let t=0,n=e.length;t<n;t++){const n=e[t];xp.setFromBufferAttribute(n),this.morphTargetsRelative?(bp.addVectors(_p.min,xp.min),_p.expandByPoint(bp),bp.addVectors(_p.max,xp.max),_p.expandByPoint(bp)):(_p.expandByPoint(xp.min),_p.expandByPoint(xp.max))}_p.getCenter(n);let r=0;for(let e=0,i=t.count;e<i;e++)bp.fromBufferAttribute(t,e),r=Math.max(r,n.distanceToSquared(bp));if(e)for(let i=0,s=e.length;i<s;i++){const s=e[i],o=this.morphTargetsRelative;for(let e=0,i=s.count;e<i;e++)bp.fromBufferAttribute(s,e),o&&(yp.fromBufferAttribute(t,e),bp.add(yp)),r=Math.max(r,n.distanceToSquared(bp))}this.boundingSphere.radius=Math.sqrt(r),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const t=this.index,e=this.attributes;if(null===t||void 0===e.position||void 0===e.normal||void 0===e.uv)return void console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");const n=e.position,r=e.normal,i=e.uv;!1===this.hasAttribute("tangent")&&this.setAttribute("tangent",new cp(new Float32Array(4*n.count),4));const s=this.getAttribute("tangent"),o=[],a=[];for(let t=0;t<n.count;t++)o[t]=new Ph,a[t]=new Ph;const l=new Ph,u=new Ph,c=new Ph,h=new oh,d=new oh,p=new oh,f=new Ph,m=new Ph;function g(t,e,r){l.fromBufferAttribute(n,t),u.fromBufferAttribute(n,e),c.fromBufferAttribute(n,r),h.fromBufferAttribute(i,t),d.fromBufferAttribute(i,e),p.fromBufferAttribute(i,r),u.sub(l),c.sub(l),d.sub(h),p.sub(h);const s=1/(d.x*p.y-p.x*d.y);isFinite(s)&&(f.copy(u).multiplyScalar(p.y).addScaledVector(c,-d.y).multiplyScalar(s),m.copy(c).multiplyScalar(d.x).addScaledVector(u,-p.x).multiplyScalar(s),o[t].add(f),o[e].add(f),o[r].add(f),a[t].add(m),a[e].add(m),a[r].add(m))}let v=this.groups;0===v.length&&(v=[{start:0,count:t.count}]);for(let e=0,n=v.length;e<n;++e){const n=v[e],r=n.start;for(let e=r,i=r+n.count;e<i;e+=3)g(t.getX(e+0),t.getX(e+1),t.getX(e+2))}const y=new Ph,_=new Ph,x=new Ph,b=new Ph;function w(t){x.fromBufferAttribute(r,t),b.copy(x);const e=o[t];y.copy(e),y.sub(x.multiplyScalar(x.dot(e))).normalize(),_.crossVectors(b,e);const n=_.dot(a[t])<0?-1:1;s.setXYZW(t,y.x,y.y,y.z,n)}for(let e=0,n=v.length;e<n;++e){const n=v[e],r=n.start;for(let e=r,i=r+n.count;e<i;e+=3)w(t.getX(e+0)),w(t.getX(e+1)),w(t.getX(e+2))}}computeVertexNormals(){const t=this.index,e=this.getAttribute("position");if(void 0!==e){let n=this.getAttribute("normal");if(void 0===n)n=new cp(new Float32Array(3*e.count),3),this.setAttribute("normal",n);else for(let t=0,e=n.count;t<e;t++)n.setXYZ(t,0,0,0);const r=new Ph,i=new Ph,s=new Ph,o=new Ph,a=new Ph,l=new Ph,u=new Ph,c=new Ph;if(t)for(let h=0,d=t.count;h<d;h+=3){const d=t.getX(h+0),p=t.getX(h+1),f=t.getX(h+2);r.fromBufferAttribute(e,d),i.fromBufferAttribute(e,p),s.fromBufferAttribute(e,f),u.subVectors(s,i),c.subVectors(r,i),u.cross(c),o.fromBufferAttribute(n,d),a.fromBufferAttribute(n,p),l.fromBufferAttribute(n,f),o.add(u),a.add(u),l.add(u),n.setXYZ(d,o.x,o.y,o.z),n.setXYZ(p,a.x,a.y,a.z),n.setXYZ(f,l.x,l.y,l.z)}else for(let t=0,o=e.count;t<o;t+=3)r.fromBufferAttribute(e,t+0),i.fromBufferAttribute(e,t+1),s.fromBufferAttribute(e,t+2),u.subVectors(s,i),c.subVectors(r,i),u.cross(c),n.setXYZ(t+0,u.x,u.y,u.z),n.setXYZ(t+1,u.x,u.y,u.z),n.setXYZ(t+2,u.x,u.y,u.z);this.normalizeNormals(),n.needsUpdate=!0}}normalizeNormals(){const t=this.attributes.normal;for(let e=0,n=t.count;e<n;e++)bp.fromBufferAttribute(t,e),bp.normalize(),t.setXYZ(e,bp.x,bp.y,bp.z)}toNonIndexed(){function t(t,e){const n=t.array,r=t.itemSize,i=t.normalized,s=new n.constructor(e.length*r);let o=0,a=0;for(let i=0,l=e.length;i<l;i++){o=t.isInterleavedBufferAttribute?e[i]*t.data.stride+t.offset:e[i]*r;for(let t=0;t<r;t++)s[a++]=n[o++]}return new cp(s,r,i)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const e=new wp,n=this.index.array,r=this.attributes;for(const i in r){const s=t(r[i],n);e.setAttribute(i,s)}const i=this.morphAttributes;for(const r in i){const s=[],o=i[r];for(let e=0,r=o.length;e<r;e++){const r=t(o[e],n);s.push(r)}e.morphAttributes[r]=s}e.morphTargetsRelative=this.morphTargetsRelative;const s=this.groups;for(let t=0,n=s.length;t<n;t++){const n=s[t];e.addGroup(n.start,n.count,n.materialIndex)}return e}toJSON(){const t={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(t.uuid=this.uuid,t.type=this.type,""!==this.name&&(t.name=this.name),Object.keys(this.userData).length>0&&(t.userData=this.userData),void 0!==this.parameters){const e=this.parameters;for(const n in e)void 0!==e[n]&&(t[n]=e[n]);return t}t.data={attributes:{}};const e=this.index;null!==e&&(t.data.index={type:e.array.constructor.name,array:Array.prototype.slice.call(e.array)});const n=this.attributes;for(const e in n){const r=n[e];t.data.attributes[e]=r.toJSON(t.data)}const r={};let i=!1;for(const e in this.morphAttributes){const n=this.morphAttributes[e],s=[];for(let e=0,r=n.length;e<r;e++){const r=n[e];s.push(r.toJSON(t.data))}s.length>0&&(r[e]=s,i=!0)}i&&(t.data.morphAttributes=r,t.data.morphTargetsRelative=this.morphTargetsRelative);const s=this.groups;s.length>0&&(t.data.groups=JSON.parse(JSON.stringify(s)));const o=this.boundingSphere;return null!==o&&(t.data.boundingSphere={center:o.center.toArray(),radius:o.radius}),t}clone(){return(new this.constructor).copy(this)}copy(t){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const e={};this.name=t.name;const n=t.index;null!==n&&this.setIndex(n.clone(e));const r=t.attributes;for(const t in r){const n=r[t];this.setAttribute(t,n.clone(e))}const i=t.morphAttributes;for(const t in i){const n=[],r=i[t];for(let t=0,i=r.length;t<i;t++)n.push(r[t].clone(e));this.morphAttributes[t]=n}this.morphTargetsRelative=t.morphTargetsRelative;const s=t.groups;for(let t=0,e=s.length;t<e;t++){const e=s[t];this.addGroup(e.start,e.count,e.materialIndex)}const o=t.boundingBox;null!==o&&(this.boundingBox=o.clone());const a=t.boundingSphere;return null!==a&&(this.boundingSphere=a.clone()),this.drawRange.start=t.drawRange.start,this.drawRange.count=t.drawRange.count,this.userData=t.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const Sp=new ad,Mp=new od,Ep=new Jh,Tp=new Ph,Ap=new Ph,Cp=new Ph,Rp=new Ph,Np=new Ph,Pp=new Ph,Ip=new Ph,Op=new Ph;class Dp extends Dd{constructor(t=new wp,e=new rp){super(),this.isMesh=!0,this.type="Mesh",this.geometry=t,this.material=e,this.updateMorphTargets()}copy(t,e){return super.copy(t,e),void 0!==t.morphTargetInfluences&&(this.morphTargetInfluences=t.morphTargetInfluences.slice()),void 0!==t.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},t.morphTargetDictionary)),this.material=Array.isArray(t.material)?t.material.slice():t.material,this.geometry=t.geometry,this}updateMorphTargets(){const t=this.geometry.morphAttributes,e=Object.keys(t);if(e.length>0){const n=t[e[0]];if(void 0!==n){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let t=0,e=n.length;t<e;t++){const e=n[t].name||String(t);this.morphTargetInfluences.push(0),this.morphTargetDictionary[e]=t}}}}getVertexPosition(t,e){const n=this.geometry,r=n.attributes.position,i=n.morphAttributes.position,s=n.morphTargetsRelative;e.fromBufferAttribute(r,t);const o=this.morphTargetInfluences;if(i&&o){Pp.set(0,0,0);for(let n=0,r=i.length;n<r;n++){const r=o[n],a=i[n];0!==r&&(Np.fromBufferAttribute(a,t),s?Pp.addScaledVector(Np,r):Pp.addScaledVector(Np.sub(e),r))}e.add(Pp)}return e}raycast(t,e){const n=this.geometry,r=this.material,i=this.matrixWorld;if(void 0!==r){if(null===n.boundingSphere&&n.computeBoundingSphere(),Ep.copy(n.boundingSphere),Ep.applyMatrix4(i),Mp.copy(t.ray).recast(t.near),!1===Ep.containsPoint(Mp.origin)){if(null===Mp.intersectSphere(Ep,Tp))return;if(Mp.origin.distanceToSquared(Tp)>(t.far-t.near)**2)return}Sp.copy(i).invert(),Mp.copy(t.ray).applyMatrix4(Sp),null!==n.boundingBox&&!1===Mp.intersectsBox(n.boundingBox)||this._computeIntersections(t,e,Mp)}}_computeIntersections(t,e,n){let r;const i=this.geometry,s=this.material,o=i.index,a=i.attributes.position,l=i.attributes.uv,u=i.attributes.uv1,c=i.attributes.normal,h=i.groups,d=i.drawRange;if(null!==o)if(Array.isArray(s))for(let i=0,a=h.length;i<a;i++){const a=h[i],p=s[a.materialIndex];for(let i=Math.max(a.start,d.start),s=Math.min(o.count,Math.min(a.start+a.count,d.start+d.count));i<s;i+=3){r=Lp(this,p,t,n,l,u,c,o.getX(i),o.getX(i+1),o.getX(i+2)),r&&(r.faceIndex=Math.floor(i/3),r.face.materialIndex=a.materialIndex,e.push(r))}}else{for(let i=Math.max(0,d.start),a=Math.min(o.count,d.start+d.count);i<a;i+=3){r=Lp(this,s,t,n,l,u,c,o.getX(i),o.getX(i+1),o.getX(i+2)),r&&(r.faceIndex=Math.floor(i/3),e.push(r))}}else if(void 0!==a)if(Array.isArray(s))for(let i=0,o=h.length;i<o;i++){const o=h[i],p=s[o.materialIndex];for(let i=Math.max(o.start,d.start),s=Math.min(a.count,Math.min(o.start+o.count,d.start+d.count));i<s;i+=3){r=Lp(this,p,t,n,l,u,c,i,i+1,i+2),r&&(r.faceIndex=Math.floor(i/3),r.face.materialIndex=o.materialIndex,e.push(r))}}else{for(let i=Math.max(0,d.start),o=Math.min(a.count,d.start+d.count);i<o;i+=3){r=Lp(this,s,t,n,l,u,c,i,i+1,i+2),r&&(r.faceIndex=Math.floor(i/3),e.push(r))}}}}function Lp(t,e,n,r,i,s,o,a,l,u){t.getVertexPosition(a,Ap),t.getVertexPosition(l,Cp),t.getVertexPosition(u,Rp);const c=function(t,e,n,r,i,s,o,a){let l;if(l=1===e.side?r.intersectTriangle(o,s,i,!0,a):r.intersectTriangle(i,s,o,0===e.side,a),null===l)return null;Op.copy(a),Op.applyMatrix4(t.matrixWorld);const u=n.ray.origin.distanceTo(Op);return u<n.near||u>n.far?null:{distance:u,point:Op.clone(),object:t}}(t,e,n,r,Ap,Cp,Rp,Ip);if(c){const t=new Ph;Zd.getBarycoord(Ip,Ap,Cp,Rp,t),i&&(c.uv=Zd.getInterpolatedAttribute(i,a,l,u,t,new oh)),s&&(c.uv1=Zd.getInterpolatedAttribute(s,a,l,u,t,new oh)),o&&(c.normal=Zd.getInterpolatedAttribute(o,a,l,u,t,new Ph),c.normal.dot(r.direction)>0&&c.normal.multiplyScalar(-1));const e={a:a,b:l,c:u,normal:new Ph,materialIndex:0};Zd.getNormal(Ap,Cp,Rp,e.normal),c.face=e,c.barycoord=t}return c}class Up extends wp{constructor(t=1,e=1,n=1,r=1,i=1,s=1){super(),this.type="BoxGeometry",this.parameters={width:t,height:e,depth:n,widthSegments:r,heightSegments:i,depthSegments:s};const o=this;r=Math.floor(r),i=Math.floor(i),s=Math.floor(s);const a=[],l=[],u=[],c=[];let h=0,d=0;function p(t,e,n,r,i,s,p,f,m,g,v){const y=s/m,_=p/g,x=s/2,b=p/2,w=f/2,S=m+1,M=g+1;let E=0,T=0;const A=new Ph;for(let s=0;s<M;s++){const o=s*_-b;for(let a=0;a<S;a++){const h=a*y-x;A[t]=h*r,A[e]=o*i,A[n]=w,l.push(A.x,A.y,A.z),A[t]=0,A[e]=0,A[n]=f>0?1:-1,u.push(A.x,A.y,A.z),c.push(a/m),c.push(1-s/g),E+=1}}for(let t=0;t<g;t++)for(let e=0;e<m;e++){const n=h+e+S*t,r=h+e+S*(t+1),i=h+(e+1)+S*(t+1),s=h+(e+1)+S*t;a.push(n,r,s),a.push(r,i,s),T+=6}o.addGroup(d,T,v),d+=T,h+=E}p("z","y","x",-1,-1,n,e,t,s,i,0),p("z","y","x",1,-1,n,e,-t,s,i,1),p("x","z","y",1,1,t,n,e,r,s,2),p("x","z","y",1,-1,t,n,-e,r,s,3),p("x","y","z",1,-1,t,e,n,r,i,4),p("x","y","z",-1,-1,t,e,-n,r,i,5),this.setIndex(a),this.setAttribute("position",new fp(l,3)),this.setAttribute("normal",new fp(u,3)),this.setAttribute("uv",new fp(c,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new Up(t.width,t.height,t.depth,t.widthSegments,t.heightSegments,t.depthSegments)}}function kp(t){const e={};for(const n in t){e[n]={};for(const r in t[n]){const i=t[n][r];i&&(i.isColor||i.isMatrix3||i.isMatrix4||i.isVector2||i.isVector3||i.isVector4||i.isTexture||i.isQuaternion)?i.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),e[n][r]=null):e[n][r]=i.clone():Array.isArray(i)?e[n][r]=i.slice():e[n][r]=i}}return e}class Bp extends np{static get type(){return"ShaderMaterial"}constructor(t){super(),this.isShaderMaterial=!0,this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader="\nvoid main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}\n",this.fragmentShader="\nvoid main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}\n",this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={clipCullDistance:!1,multiDraw:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,void 0!==t&&this.setValues(t)}copy(t){return super.copy(t),this.fragmentShader=t.fragmentShader,this.vertexShader=t.vertexShader,this.uniforms=kp(t.uniforms),this.uniformsGroups=function(t){const e=[];for(let n=0;n<t.length;n++)e.push(t[n].clone());return e}(t.uniformsGroups),this.defines=Object.assign({},t.defines),this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.fog=t.fog,this.lights=t.lights,this.clipping=t.clipping,this.extensions=Object.assign({},t.extensions),this.glslVersion=t.glslVersion,this}toJSON(t){const e=super.toJSON(t);e.glslVersion=this.glslVersion,e.uniforms={};for(const n in this.uniforms){const r=this.uniforms[n].value;r&&r.isTexture?e.uniforms[n]={type:"t",value:r.toJSON(t).uuid}:r&&r.isColor?e.uniforms[n]={type:"c",value:r.getHex()}:r&&r.isVector2?e.uniforms[n]={type:"v2",value:r.toArray()}:r&&r.isVector3?e.uniforms[n]={type:"v3",value:r.toArray()}:r&&r.isVector4?e.uniforms[n]={type:"v4",value:r.toArray()}:r&&r.isMatrix3?e.uniforms[n]={type:"m3",value:r.toArray()}:r&&r.isMatrix4?e.uniforms[n]={type:"m4",value:r.toArray()}:e.uniforms[n]={value:r}}Object.keys(this.defines).length>0&&(e.defines=this.defines),e.vertexShader=this.vertexShader,e.fragmentShader=this.fragmentShader,e.lights=this.lights,e.clipping=this.clipping;const n={};for(const t in this.extensions)!0===this.extensions[t]&&(n[t]=!0);return Object.keys(n).length>0&&(e.extensions=n),e}}class Fp extends Dd{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new ad,this.projectionMatrix=new ad,this.projectionMatrixInverse=new ad,this.coordinateSystem=qc}copy(t,e){return super.copy(t,e),this.matrixWorldInverse.copy(t.matrixWorldInverse),this.projectionMatrix.copy(t.projectionMatrix),this.projectionMatrixInverse.copy(t.projectionMatrixInverse),this.coordinateSystem=t.coordinateSystem,this}getWorldDirection(t){return super.getWorldDirection(t).negate()}updateMatrixWorld(t){super.updateMatrixWorld(t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(t,e){super.updateWorldMatrix(t,e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return(new this.constructor).copy(this)}}const zp=new Ph,Vp=new oh,Gp=new oh;class jp extends Fp{constructor(t=50,e=1,n=.1,r=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=t,this.zoom=1,this.near=n,this.far=r,this.focus=10,this.aspect=e,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(t,e){return super.copy(t,e),this.fov=t.fov,this.zoom=t.zoom,this.near=t.near,this.far=t.far,this.focus=t.focus,this.aspect=t.aspect,this.view=null===t.view?null:Object.assign({},t.view),this.filmGauge=t.filmGauge,this.filmOffset=t.filmOffset,this}setFocalLength(t){const e=.5*this.getFilmHeight()/t;this.fov=2*Jc*Math.atan(e),this.updateProjectionMatrix()}getFocalLength(){const t=Math.tan(.5*Kc*this.fov);return.5*this.getFilmHeight()/t}getEffectiveFOV(){return 2*Jc*Math.atan(Math.tan(.5*Kc*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}getViewBounds(t,e,n){zp.set(-1,-1,.5).applyMatrix4(this.projectionMatrixInverse),e.set(zp.x,zp.y).multiplyScalar(-t/zp.z),zp.set(1,1,.5).applyMatrix4(this.projectionMatrixInverse),n.set(zp.x,zp.y).multiplyScalar(-t/zp.z)}getViewSize(t,e){return this.getViewBounds(t,Vp,Gp),e.subVectors(Gp,Vp)}setViewOffset(t,e,n,r,i,s){this.aspect=t/e,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=n,this.view.offsetY=r,this.view.width=i,this.view.height=s,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const t=this.near;let e=t*Math.tan(.5*Kc*this.fov)/this.zoom,n=2*e,r=this.aspect*n,i=-.5*r;const s=this.view;if(null!==this.view&&this.view.enabled){const t=s.fullWidth,o=s.fullHeight;i+=s.offsetX*r/t,e-=s.offsetY*n/o,r*=s.width/t,n*=s.height/o}const o=this.filmOffset;0!==o&&(i+=t*o/this.getFilmWidth()),this.projectionMatrix.makePerspective(i,i+r,e,e-n,t,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(t){const e=super.toJSON(t);return e.object.fov=this.fov,e.object.zoom=this.zoom,e.object.near=this.near,e.object.far=this.far,e.object.focus=this.focus,e.object.aspect=this.aspect,null!==this.view&&(e.object.view=Object.assign({},this.view)),e.object.filmGauge=this.filmGauge,e.object.filmOffset=this.filmOffset,e}}const Hp=-90;class Wp extends Dd{constructor(t,e,n){super(),this.type="CubeCamera",this.renderTarget=n,this.coordinateSystem=null,this.activeMipmapLevel=0;const r=new jp(Hp,1,t,e);r.layers=this.layers,this.add(r);const i=new jp(Hp,1,t,e);i.layers=this.layers,this.add(i);const s=new jp(Hp,1,t,e);s.layers=this.layers,this.add(s);const o=new jp(Hp,1,t,e);o.layers=this.layers,this.add(o);const a=new jp(Hp,1,t,e);a.layers=this.layers,this.add(a);const l=new jp(Hp,1,t,e);l.layers=this.layers,this.add(l)}updateCoordinateSystem(){const t=this.coordinateSystem,e=this.children.concat(),[n,r,i,s,o,a]=e;for(const t of e)this.remove(t);if(t===qc)n.up.set(0,1,0),n.lookAt(1,0,0),r.up.set(0,1,0),r.lookAt(-1,0,0),i.up.set(0,0,-1),i.lookAt(0,1,0),s.up.set(0,0,1),s.lookAt(0,-1,0),o.up.set(0,1,0),o.lookAt(0,0,1),a.up.set(0,1,0),a.lookAt(0,0,-1);else{if(t!==Xc)throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+t);n.up.set(0,-1,0),n.lookAt(-1,0,0),r.up.set(0,-1,0),r.lookAt(1,0,0),i.up.set(0,0,1),i.lookAt(0,1,0),s.up.set(0,0,-1),s.lookAt(0,-1,0),o.up.set(0,-1,0),o.lookAt(0,0,1),a.up.set(0,-1,0),a.lookAt(0,0,-1)}for(const t of e)this.add(t),t.updateMatrixWorld()}update(t,e){null===this.parent&&this.updateMatrixWorld();const{renderTarget:n,activeMipmapLevel:r}=this;this.coordinateSystem!==t.coordinateSystem&&(this.coordinateSystem=t.coordinateSystem,this.updateCoordinateSystem());const[i,s,o,a,l,u]=this.children,c=t.getRenderTarget(),h=t.getActiveCubeFace(),d=t.getActiveMipmapLevel(),p=t.xr.enabled;t.xr.enabled=!1;const f=n.texture.generateMipmaps;n.texture.generateMipmaps=!1,t.setRenderTarget(n,0,r),t.render(e,i),t.setRenderTarget(n,1,r),t.render(e,s),t.setRenderTarget(n,2,r),t.render(e,o),t.setRenderTarget(n,3,r),t.render(e,a),t.setRenderTarget(n,4,r),t.render(e,l),n.texture.generateMipmaps=f,t.setRenderTarget(n,5,r),t.render(e,u),t.setRenderTarget(c,h,d),t.xr.enabled=p,n.texture.needsPMREMUpdate=!0}}class qp extends Eh{constructor(t,e,n,r,i,s,o,a,l,u){super(t=void 0!==t?t:[],e=void 0!==e?e:Ou,n,r,i,s,o,a,l,u),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(t){this.image=t}}class Xp extends Ch{constructor(t=1,e={}){super(t,t,e),this.isWebGLCubeRenderTarget=!0;const n={width:t,height:t,depth:1},r=[n,n,n,n,n,n];this.texture=new qp(r,e.mapping,e.wrapS,e.wrapT,e.magFilter,e.minFilter,e.format,e.type,e.anisotropy,e.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=void 0!==e.generateMipmaps&&e.generateMipmaps,this.texture.minFilter=void 0!==e.minFilter?e.minFilter:Hu}fromEquirectangularTexture(t,e){this.texture.type=e.type,this.texture.colorSpace=e.colorSpace,this.texture.generateMipmaps=e.generateMipmaps,this.texture.minFilter=e.minFilter,this.texture.magFilter=e.magFilter;const n={uniforms:{tEquirect:{value:null}},vertexShader:"\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\tvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\n\t\t\t\t\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t\t#include <project_vertex>\n\n\t\t\t\t}\n\t\t\t",fragmentShader:"\n\n\t\t\t\tuniform sampler2D tEquirect;\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\t#include <common>\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvec3 direction = normalize( vWorldDirection );\n\n\t\t\t\t\tvec2 sampleUV = equirectUv( direction );\n\n\t\t\t\t\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\n\t\t\t\t}\n\t\t\t"},r=new Up(5,5,5),i=new Bp({name:"CubemapFromEquirect",uniforms:kp(n.uniforms),vertexShader:n.vertexShader,fragmentShader:n.fragmentShader,side:1,blending:0});i.uniforms.tEquirect.value=e;const s=new Dp(r,i),o=e.minFilter;e.minFilter===qu&&(e.minFilter=Hu);return new Wp(1,10,this).update(t,s),e.minFilter=o,s.geometry.dispose(),s.material.dispose(),this}clear(t,e,n,r){const i=t.getRenderTarget();for(let i=0;i<6;i++)t.setRenderTarget(this,i),t.clear(e,n,r);t.setRenderTarget(i)}}class Zp extends Dd{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.backgroundRotation=new vd,this.environmentIntensity=1,this.environmentRotation=new vd,this.overrideMaterial=null,"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(t,e){return super.copy(t,e),null!==t.background&&(this.background=t.background.clone()),null!==t.environment&&(this.environment=t.environment.clone()),null!==t.fog&&(this.fog=t.fog.clone()),this.backgroundBlurriness=t.backgroundBlurriness,this.backgroundIntensity=t.backgroundIntensity,this.backgroundRotation.copy(t.backgroundRotation),this.environmentIntensity=t.environmentIntensity,this.environmentRotation.copy(t.environmentRotation),null!==t.overrideMaterial&&(this.overrideMaterial=t.overrideMaterial.clone()),this.matrixAutoUpdate=t.matrixAutoUpdate,this}toJSON(t){const e=super.toJSON(t);return null!==this.fog&&(e.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(e.object.backgroundBlurriness=this.backgroundBlurriness),1!==this.backgroundIntensity&&(e.object.backgroundIntensity=this.backgroundIntensity),e.object.backgroundRotation=this.backgroundRotation.toArray(),1!==this.environmentIntensity&&(e.object.environmentIntensity=this.environmentIntensity),e.object.environmentRotation=this.environmentRotation.toArray(),e}}class $p{constructor(t,e){this.isInterleavedBuffer=!0,this.array=t,this.stride=e,this.count=void 0!==t?t.length/e:0,this.usage=Hc,this.updateRanges=[],this.version=0,this.uuid=Qc()}onUploadCallback(){}set needsUpdate(t){!0===t&&this.version++}setUsage(t){return this.usage=t,this}addUpdateRange(t,e){this.updateRanges.push({start:t,count:e})}clearUpdateRanges(){this.updateRanges.length=0}copy(t){return this.array=new t.array.constructor(t.array),this.count=t.count,this.stride=t.stride,this.usage=t.usage,this}copyAt(t,e,n){t*=this.stride,n*=e.stride;for(let r=0,i=this.stride;r<i;r++)this.array[t+r]=e.array[n+r];return this}set(t,e=0){return this.array.set(t,e),this}clone(t){void 0===t.arrayBuffers&&(t.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=Qc()),void 0===t.arrayBuffers[this.array.buffer._uuid]&&(t.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const e=new this.array.constructor(t.arrayBuffers[this.array.buffer._uuid]),n=new this.constructor(e,this.stride);return n.setUsage(this.usage),n}onUpload(t){return this.onUploadCallback=t,this}toJSON(t){return void 0===t.arrayBuffers&&(t.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=Qc()),void 0===t.arrayBuffers[this.array.buffer._uuid]&&(t.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}const Yp=new Ph;class Kp{constructor(t,e,n,r=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=t,this.itemSize=e,this.offset=n,this.normalized=r}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(t){this.data.needsUpdate=t}applyMatrix4(t){for(let e=0,n=this.data.count;e<n;e++)Yp.fromBufferAttribute(this,e),Yp.applyMatrix4(t),this.setXYZ(e,Yp.x,Yp.y,Yp.z);return this}applyNormalMatrix(t){for(let e=0,n=this.count;e<n;e++)Yp.fromBufferAttribute(this,e),Yp.applyNormalMatrix(t),this.setXYZ(e,Yp.x,Yp.y,Yp.z);return this}transformDirection(t){for(let e=0,n=this.count;e<n;e++)Yp.fromBufferAttribute(this,e),Yp.transformDirection(t),this.setXYZ(e,Yp.x,Yp.y,Yp.z);return this}getComponent(t,e){let n=this.array[t*this.data.stride+this.offset+e];return this.normalized&&(n=rh(n,this.array)),n}setComponent(t,e,n){return this.normalized&&(n=ih(n,this.array)),this.data.array[t*this.data.stride+this.offset+e]=n,this}setX(t,e){return this.normalized&&(e=ih(e,this.array)),this.data.array[t*this.data.stride+this.offset]=e,this}setY(t,e){return this.normalized&&(e=ih(e,this.array)),this.data.array[t*this.data.stride+this.offset+1]=e,this}setZ(t,e){return this.normalized&&(e=ih(e,this.array)),this.data.array[t*this.data.stride+this.offset+2]=e,this}setW(t,e){return this.normalized&&(e=ih(e,this.array)),this.data.array[t*this.data.stride+this.offset+3]=e,this}getX(t){let e=this.data.array[t*this.data.stride+this.offset];return this.normalized&&(e=rh(e,this.array)),e}getY(t){let e=this.data.array[t*this.data.stride+this.offset+1];return this.normalized&&(e=rh(e,this.array)),e}getZ(t){let e=this.data.array[t*this.data.stride+this.offset+2];return this.normalized&&(e=rh(e,this.array)),e}getW(t){let e=this.data.array[t*this.data.stride+this.offset+3];return this.normalized&&(e=rh(e,this.array)),e}setXY(t,e,n){return t=t*this.data.stride+this.offset,this.normalized&&(e=ih(e,this.array),n=ih(n,this.array)),this.data.array[t+0]=e,this.data.array[t+1]=n,this}setXYZ(t,e,n,r){return t=t*this.data.stride+this.offset,this.normalized&&(e=ih(e,this.array),n=ih(n,this.array),r=ih(r,this.array)),this.data.array[t+0]=e,this.data.array[t+1]=n,this.data.array[t+2]=r,this}setXYZW(t,e,n,r,i){return t=t*this.data.stride+this.offset,this.normalized&&(e=ih(e,this.array),n=ih(n,this.array),r=ih(r,this.array),i=ih(i,this.array)),this.data.array[t+0]=e,this.data.array[t+1]=n,this.data.array[t+2]=r,this.data.array[t+3]=i,this}clone(t){if(void 0===t){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");const t=[];for(let e=0;e<this.count;e++){const n=e*this.data.stride+this.offset;for(let e=0;e<this.itemSize;e++)t.push(this.data.array[n+e])}return new cp(new this.array.constructor(t),this.itemSize,this.normalized)}return void 0===t.interleavedBuffers&&(t.interleavedBuffers={}),void 0===t.interleavedBuffers[this.data.uuid]&&(t.interleavedBuffers[this.data.uuid]=this.data.clone(t)),new Kp(t.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(t){if(void 0===t){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");const t=[];for(let e=0;e<this.count;e++){const n=e*this.data.stride+this.offset;for(let e=0;e<this.itemSize;e++)t.push(this.data.array[n+e])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:t,normalized:this.normalized}}return void 0===t.interleavedBuffers&&(t.interleavedBuffers={}),void 0===t.interleavedBuffers[this.data.uuid]&&(t.interleavedBuffers[this.data.uuid]=this.data.toJSON(t)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}class Jp extends np{static get type(){return"SpriteMaterial"}constructor(t){super(),this.isSpriteMaterial=!0,this.color=new Qd(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.rotation=t.rotation,this.sizeAttenuation=t.sizeAttenuation,this.fog=t.fog,this}}class Qp extends Eh{constructor(t=null,e=1,n=1,r,i,s,o,a,l=1003,u=1003,c,h){super(null,s,o,a,l,u,r,i,c,h),this.isDataTexture=!0,this.image={data:t,width:e,height:n},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class tf extends cp{constructor(t,e,n,r=1){super(t,e,n),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=r}copy(t){return super.copy(t),this.meshPerAttribute=t.meshPerAttribute,this}toJSON(){const t=super.toJSON();return t.meshPerAttribute=this.meshPerAttribute,t.isInstancedBufferAttribute=!0,t}}const ef=new Ph,nf=new Ph,rf=new ah;class sf{constructor(t=new Ph(1,0,0),e=0){this.isPlane=!0,this.normal=t,this.constant=e}set(t,e){return this.normal.copy(t),this.constant=e,this}setComponents(t,e,n,r){return this.normal.set(t,e,n),this.constant=r,this}setFromNormalAndCoplanarPoint(t,e){return this.normal.copy(t),this.constant=-e.dot(this.normal),this}setFromCoplanarPoints(t,e,n){const r=ef.subVectors(n,e).cross(nf.subVectors(t,e)).normalize();return this.setFromNormalAndCoplanarPoint(r,t),this}copy(t){return this.normal.copy(t.normal),this.constant=t.constant,this}normalize(){const t=1/this.normal.length();return this.normal.multiplyScalar(t),this.constant*=t,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(t){return this.normal.dot(t)+this.constant}distanceToSphere(t){return this.distanceToPoint(t.center)-t.radius}projectPoint(t,e){return e.copy(t).addScaledVector(this.normal,-this.distanceToPoint(t))}intersectLine(t,e){const n=t.delta(ef),r=this.normal.dot(n);if(0===r)return 0===this.distanceToPoint(t.start)?e.copy(t.start):null;const i=-(t.start.dot(this.normal)+this.constant)/r;return i<0||i>1?null:e.copy(t.start).addScaledVector(n,i)}intersectsLine(t){const e=this.distanceToPoint(t.start),n=this.distanceToPoint(t.end);return e<0&&n>0||n<0&&e>0}intersectsBox(t){return t.intersectsPlane(this)}intersectsSphere(t){return t.intersectsPlane(this)}coplanarPoint(t){return t.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(t,e){const n=e||rf.getNormalMatrix(t),r=this.coplanarPoint(ef).applyMatrix4(t),i=this.normal.applyMatrix3(n).normalize();return this.constant=-r.dot(i),this}translate(t){return this.constant-=t.dot(this.normal),this}equals(t){return t.normal.equals(this.normal)&&t.constant===this.constant}clone(){return(new this.constructor).copy(this)}}const of=new Jh,af=new Ph;class lf{constructor(t=new sf,e=new sf,n=new sf,r=new sf,i=new sf,s=new sf){this.planes=[t,e,n,r,i,s]}set(t,e,n,r,i,s){const o=this.planes;return o[0].copy(t),o[1].copy(e),o[2].copy(n),o[3].copy(r),o[4].copy(i),o[5].copy(s),this}copy(t){const e=this.planes;for(let n=0;n<6;n++)e[n].copy(t.planes[n]);return this}setFromProjectionMatrix(t,e=2e3){const n=this.planes,r=t.elements,i=r[0],s=r[1],o=r[2],a=r[3],l=r[4],u=r[5],c=r[6],h=r[7],d=r[8],p=r[9],f=r[10],m=r[11],g=r[12],v=r[13],y=r[14],_=r[15];if(n[0].setComponents(a-i,h-l,m-d,_-g).normalize(),n[1].setComponents(a+i,h+l,m+d,_+g).normalize(),n[2].setComponents(a+s,h+u,m+p,_+v).normalize(),n[3].setComponents(a-s,h-u,m-p,_-v).normalize(),n[4].setComponents(a-o,h-c,m-f,_-y).normalize(),e===qc)n[5].setComponents(a+o,h+c,m+f,_+y).normalize();else{if(e!==Xc)throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+e);n[5].setComponents(o,c,f,y).normalize()}return this}intersectsObject(t){if(void 0!==t.boundingSphere)null===t.boundingSphere&&t.computeBoundingSphere(),of.copy(t.boundingSphere).applyMatrix4(t.matrixWorld);else{const e=t.geometry;null===e.boundingSphere&&e.computeBoundingSphere(),of.copy(e.boundingSphere).applyMatrix4(t.matrixWorld)}return this.intersectsSphere(of)}intersectsSprite(t){return of.center.set(0,0,0),of.radius=.7071067811865476,of.applyMatrix4(t.matrixWorld),this.intersectsSphere(of)}intersectsSphere(t){const e=this.planes,n=t.center,r=-t.radius;for(let t=0;t<6;t++){if(e[t].distanceToPoint(n)<r)return!1}return!0}intersectsBox(t){const e=this.planes;for(let n=0;n<6;n++){const r=e[n];if(af.x=r.normal.x>0?t.max.x:t.min.x,af.y=r.normal.y>0?t.max.y:t.min.y,af.z=r.normal.z>0?t.max.z:t.min.z,r.distanceToPoint(af)<0)return!1}return!0}containsPoint(t){const e=this.planes;for(let n=0;n<6;n++)if(e[n].distanceToPoint(t)<0)return!1;return!0}clone(){return(new this.constructor).copy(this)}}class uf extends np{static get type(){return"LineBasicMaterial"}constructor(t){super(),this.isLineBasicMaterial=!0,this.color=new Qd(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.linewidth=t.linewidth,this.linecap=t.linecap,this.linejoin=t.linejoin,this.fog=t.fog,this}}class cf extends np{static get type(){return"PointsMaterial"}constructor(t){super(),this.isPointsMaterial=!0,this.color=new Qd(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.size=t.size,this.sizeAttenuation=t.sizeAttenuation,this.fog=t.fog,this}}class hf extends Eh{constructor(t,e){super({width:t,height:e}),this.isFramebufferTexture=!0,this.magFilter=Vu,this.minFilter=Vu,this.generateMipmaps=!1,this.needsUpdate=!0}}class df extends Eh{constructor(t,e,n,r,i,s,o,a,l,u=1026){if(u!==ic&&u!==sc)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===n&&u===ic&&(n=Ju),void 0===n&&u===sc&&(n=ec),super(null,r,i,s,o,a,u,n,l),this.isDepthTexture=!0,this.image={width:t,height:e},this.magFilter=void 0!==o?o:Vu,this.minFilter=void 0!==a?a:Vu,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(t){return super.copy(t),this.compareFunction=t.compareFunction,this}toJSON(t){const e=super.toJSON(t);return null!==this.compareFunction&&(e.compareFunction=this.compareFunction),e}}class pf extends wp{constructor(t=1,e=32,n=16,r=0,i=2*Math.PI,s=0,o=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:t,widthSegments:e,heightSegments:n,phiStart:r,phiLength:i,thetaStart:s,thetaLength:o},e=Math.max(3,Math.floor(e)),n=Math.max(2,Math.floor(n));const a=Math.min(s+o,Math.PI);let l=0;const u=[],c=new Ph,h=new Ph,d=[],p=[],f=[],m=[];for(let d=0;d<=n;d++){const g=[],v=d/n;let y=0;0===d&&0===s?y=.5/e:d===n&&a===Math.PI&&(y=-.5/e);for(let n=0;n<=e;n++){const a=n/e;c.x=-t*Math.cos(r+a*i)*Math.sin(s+v*o),c.y=t*Math.cos(s+v*o),c.z=t*Math.sin(r+a*i)*Math.sin(s+v*o),p.push(c.x,c.y,c.z),h.copy(c).normalize(),f.push(h.x,h.y,h.z),m.push(a+y,1-v),g.push(l++)}u.push(g)}for(let t=0;t<n;t++)for(let r=0;r<e;r++){const e=u[t][r+1],i=u[t][r],o=u[t+1][r],l=u[t+1][r+1];(0!==t||s>0)&&d.push(e,i,l),(t!==n-1||a<Math.PI)&&d.push(i,o,l)}this.setIndex(d),this.setAttribute("position",new fp(p,3)),this.setAttribute("normal",new fp(f,3)),this.setAttribute("uv",new fp(m,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new pf(t.radius,t.widthSegments,t.heightSegments,t.phiStart,t.phiLength,t.thetaStart,t.thetaLength)}}class ff extends np{static get type(){return"ShadowMaterial"}constructor(t){super(),this.isShadowMaterial=!0,this.color=new Qd(0),this.transparent=!0,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.fog=t.fog,this}}class mf extends np{static get type(){return"MeshStandardMaterial"}constructor(t){super(),this.isMeshStandardMaterial=!0,this.defines={STANDARD:""},this.color=new Qd(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Qd(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new oh(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new vd,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.defines={STANDARD:""},this.color.copy(t.color),this.roughness=t.roughness,this.metalness=t.metalness,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.roughnessMap=t.roughnessMap,this.metalnessMap=t.metalnessMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapRotation.copy(t.envMapRotation),this.envMapIntensity=t.envMapIntensity,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.flatShading=t.flatShading,this.fog=t.fog,this}}class gf extends mf{static get type(){return"MeshPhysicalMaterial"}constructor(t){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.anisotropyRotation=0,this.anisotropyMap=null,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new oh(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return th(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(t){this.ior=(1+.4*t)/(1-.4*t)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new Qd(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=1/0,this.attenuationColor=new Qd(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new Qd(1,1,1),this.specularColorMap=null,this._anisotropy=0,this._clearcoat=0,this._dispersion=0,this._iridescence=0,this._sheen=0,this._transmission=0,this.setValues(t)}get anisotropy(){return this._anisotropy}set anisotropy(t){this._anisotropy>0!=t>0&&this.version++,this._anisotropy=t}get clearcoat(){return this._clearcoat}set clearcoat(t){this._clearcoat>0!=t>0&&this.version++,this._clearcoat=t}get iridescence(){return this._iridescence}set iridescence(t){this._iridescence>0!=t>0&&this.version++,this._iridescence=t}get dispersion(){return this._dispersion}set dispersion(t){this._dispersion>0!=t>0&&this.version++,this._dispersion=t}get sheen(){return this._sheen}set sheen(t){this._sheen>0!=t>0&&this.version++,this._sheen=t}get transmission(){return this._transmission}set transmission(t){this._transmission>0!=t>0&&this.version++,this._transmission=t}copy(t){return super.copy(t),this.defines={STANDARD:"",PHYSICAL:""},this.anisotropy=t.anisotropy,this.anisotropyRotation=t.anisotropyRotation,this.anisotropyMap=t.anisotropyMap,this.clearcoat=t.clearcoat,this.clearcoatMap=t.clearcoatMap,this.clearcoatRoughness=t.clearcoatRoughness,this.clearcoatRoughnessMap=t.clearcoatRoughnessMap,this.clearcoatNormalMap=t.clearcoatNormalMap,this.clearcoatNormalScale.copy(t.clearcoatNormalScale),this.dispersion=t.dispersion,this.ior=t.ior,this.iridescence=t.iridescence,this.iridescenceMap=t.iridescenceMap,this.iridescenceIOR=t.iridescenceIOR,this.iridescenceThicknessRange=[...t.iridescenceThicknessRange],this.iridescenceThicknessMap=t.iridescenceThicknessMap,this.sheen=t.sheen,this.sheenColor.copy(t.sheenColor),this.sheenColorMap=t.sheenColorMap,this.sheenRoughness=t.sheenRoughness,this.sheenRoughnessMap=t.sheenRoughnessMap,this.transmission=t.transmission,this.transmissionMap=t.transmissionMap,this.thickness=t.thickness,this.thicknessMap=t.thicknessMap,this.attenuationDistance=t.attenuationDistance,this.attenuationColor.copy(t.attenuationColor),this.specularIntensity=t.specularIntensity,this.specularIntensityMap=t.specularIntensityMap,this.specularColor.copy(t.specularColor),this.specularColorMap=t.specularColorMap,this}}class vf extends np{static get type(){return"MeshPhongMaterial"}constructor(t){super(),this.isMeshPhongMaterial=!0,this.color=new Qd(16777215),this.specular=new Qd(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Qd(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new oh(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new vd,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.specular.copy(t.specular),this.shininess=t.shininess,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapRotation.copy(t.envMapRotation),this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.flatShading=t.flatShading,this.fog=t.fog,this}}class yf extends np{static get type(){return"MeshToonMaterial"}constructor(t){super(),this.isMeshToonMaterial=!0,this.defines={TOON:""},this.color=new Qd(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Qd(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new oh(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.gradientMap=t.gradientMap,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.alphaMap=t.alphaMap,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.fog=t.fog,this}}class _f extends np{static get type(){return"MeshNormalMaterial"}constructor(t){super(),this.isMeshNormalMaterial=!0,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new oh(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.setValues(t)}copy(t){return super.copy(t),this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.flatShading=t.flatShading,this}}class xf extends np{static get type(){return"MeshLambertMaterial"}constructor(t){super(),this.isMeshLambertMaterial=!0,this.color=new Qd(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Qd(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new oh(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new vd,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapRotation.copy(t.envMapRotation),this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.flatShading=t.flatShading,this.fog=t.fog,this}}class bf extends np{static get type(){return"MeshMatcapMaterial"}constructor(t){super(),this.isMeshMatcapMaterial=!0,this.defines={MATCAP:""},this.color=new Qd(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new oh(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.defines={MATCAP:""},this.color.copy(t.color),this.matcap=t.matcap,this.map=t.map,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.alphaMap=t.alphaMap,this.flatShading=t.flatShading,this.fog=t.fog,this}}class wf extends uf{static get type(){return"LineDashedMaterial"}constructor(t){super(),this.isLineDashedMaterial=!0,this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(t)}copy(t){return super.copy(t),this.scale=t.scale,this.dashSize=t.dashSize,this.gapSize=t.gapSize,this}}function Sf(t,e,n){return!t||!n&&t.constructor===e?t:"number"==typeof e.BYTES_PER_ELEMENT?new e(t):Array.prototype.slice.call(t)}function Mf(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}class Ef{constructor(t,e,n,r){this.parameterPositions=t,this._cachedIndex=0,this.resultBuffer=void 0!==r?r:new e.constructor(n),this.sampleValues=e,this.valueSize=n,this.settings=null,this.DefaultSettings_={}}evaluate(t){const e=this.parameterPositions;let n=this._cachedIndex,r=e[n],i=e[n-1];t:{e:{let s;n:{r:if(!(t<r)){for(let s=n+2;;){if(void 0===r){if(t<i)break r;return n=e.length,this._cachedIndex=n,this.copySampleValue_(n-1)}if(n===s)break;if(i=r,r=e[++n],t<r)break e}s=e.length;break n}if(t>=i)break t;{const o=e[1];t<o&&(n=2,i=o);for(let s=n-2;;){if(void 0===i)return this._cachedIndex=0,this.copySampleValue_(0);if(n===s)break;if(r=i,i=e[--n-1],t>=i)break e}s=n,n=0}}for(;n<s;){const r=n+s>>>1;t<e[r]?s=r:n=r+1}if(r=e[n],i=e[n-1],void 0===i)return this._cachedIndex=0,this.copySampleValue_(0);if(void 0===r)return n=e.length,this._cachedIndex=n,this.copySampleValue_(n-1)}this._cachedIndex=n,this.intervalChanged_(n,i,r)}return this.interpolate_(n,i,t,r)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(t){const e=this.resultBuffer,n=this.sampleValues,r=this.valueSize,i=t*r;for(let t=0;t!==r;++t)e[t]=n[i+t];return e}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}class Tf extends Ef{constructor(t,e,n,r){super(t,e,n,r),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:Lc,endingEnd:Lc}}intervalChanged_(t,e,n){const r=this.parameterPositions;let i=t-2,s=t+1,o=r[i],a=r[s];if(void 0===o)switch(this.getSettings_().endingStart){case Uc:i=t,o=2*e-n;break;case kc:i=r.length-2,o=e+r[i]-r[i+1];break;default:i=t,o=n}if(void 0===a)switch(this.getSettings_().endingEnd){case Uc:s=t,a=2*n-e;break;case kc:s=1,a=n+r[1]-r[0];break;default:s=t-1,a=e}const l=.5*(n-e),u=this.valueSize;this._weightPrev=l/(e-o),this._weightNext=l/(a-n),this._offsetPrev=i*u,this._offsetNext=s*u}interpolate_(t,e,n,r){const i=this.resultBuffer,s=this.sampleValues,o=this.valueSize,a=t*o,l=a-o,u=this._offsetPrev,c=this._offsetNext,h=this._weightPrev,d=this._weightNext,p=(n-e)/(r-e),f=p*p,m=f*p,g=-h*m+2*h*f-h*p,v=(1+h)*m+(-1.5-2*h)*f+(-.5+h)*p+1,y=(-1-d)*m+(1.5+d)*f+.5*p,_=d*m-d*f;for(let t=0;t!==o;++t)i[t]=g*s[u+t]+v*s[l+t]+y*s[a+t]+_*s[c+t];return i}}class Af extends Ef{constructor(t,e,n,r){super(t,e,n,r)}interpolate_(t,e,n,r){const i=this.resultBuffer,s=this.sampleValues,o=this.valueSize,a=t*o,l=a-o,u=(n-e)/(r-e),c=1-u;for(let t=0;t!==o;++t)i[t]=s[l+t]*c+s[a+t]*u;return i}}class Cf extends Ef{constructor(t,e,n,r){super(t,e,n,r)}interpolate_(t){return this.copySampleValue_(t-1)}}class Rf{constructor(t,e,n,r){if(void 0===t)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===e||0===e.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+t);this.name=t,this.times=Sf(e,this.TimeBufferType),this.values=Sf(n,this.ValueBufferType),this.setInterpolation(r||this.DefaultInterpolation)}static toJSON(t){const e=t.constructor;let n;if(e.toJSON!==this.toJSON)n=e.toJSON(t);else{n={name:t.name,times:Sf(t.times,Array),values:Sf(t.values,Array)};const e=t.getInterpolation();e!==t.DefaultInterpolation&&(n.interpolation=e)}return n.type=t.ValueTypeName,n}InterpolantFactoryMethodDiscrete(t){return new Cf(this.times,this.values,this.getValueSize(),t)}InterpolantFactoryMethodLinear(t){return new Af(this.times,this.values,this.getValueSize(),t)}InterpolantFactoryMethodSmooth(t){return new Tf(this.times,this.values,this.getValueSize(),t)}setInterpolation(t){let e;switch(t){case Ic:e=this.InterpolantFactoryMethodDiscrete;break;case Oc:e=this.InterpolantFactoryMethodLinear;break;case Dc:e=this.InterpolantFactoryMethodSmooth}if(void 0===e){const e="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(t===this.DefaultInterpolation)throw new Error(e);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",e),this}return this.createInterpolant=e,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return Ic;case this.InterpolantFactoryMethodLinear:return Oc;case this.InterpolantFactoryMethodSmooth:return Dc}}getValueSize(){return this.values.length/this.times.length}shift(t){if(0!==t){const e=this.times;for(let n=0,r=e.length;n!==r;++n)e[n]+=t}return this}scale(t){if(1!==t){const e=this.times;for(let n=0,r=e.length;n!==r;++n)e[n]*=t}return this}trim(t,e){const n=this.times,r=n.length;let i=0,s=r-1;for(;i!==r&&n[i]<t;)++i;for(;-1!==s&&n[s]>e;)--s;if(++s,0!==i||s!==r){i>=s&&(s=Math.max(s,1),i=s-1);const t=this.getValueSize();this.times=n.slice(i,s),this.values=this.values.slice(i*t,s*t)}return this}validate(){let t=!0;const e=this.getValueSize();e-Math.floor(e)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),t=!1);const n=this.times,r=this.values,i=n.length;0===i&&(console.error("THREE.KeyframeTrack: Track is empty.",this),t=!1);let s=null;for(let e=0;e!==i;e++){const r=n[e];if("number"==typeof r&&isNaN(r)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,e,r),t=!1;break}if(null!==s&&s>r){console.error("THREE.KeyframeTrack: Out of order keys.",this,e,r,s),t=!1;break}s=r}if(void 0!==r&&Mf(r))for(let e=0,n=r.length;e!==n;++e){const n=r[e];if(isNaN(n)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,e,n),t=!1;break}}return t}optimize(){const t=this.times.slice(),e=this.values.slice(),n=this.getValueSize(),r=this.getInterpolation()===Dc,i=t.length-1;let s=1;for(let o=1;o<i;++o){let i=!1;const a=t[o];if(a!==t[o+1]&&(1!==o||a!==t[0]))if(r)i=!0;else{const t=o*n,r=t-n,s=t+n;for(let o=0;o!==n;++o){const n=e[t+o];if(n!==e[r+o]||n!==e[s+o]){i=!0;break}}}if(i){if(o!==s){t[s]=t[o];const r=o*n,i=s*n;for(let t=0;t!==n;++t)e[i+t]=e[r+t]}++s}}if(i>0){t[s]=t[i];for(let t=i*n,r=s*n,o=0;o!==n;++o)e[r+o]=e[t+o];++s}return s!==t.length?(this.times=t.slice(0,s),this.values=e.slice(0,s*n)):(this.times=t,this.values=e),this}clone(){const t=this.times.slice(),e=this.values.slice(),n=new(0,this.constructor)(this.name,t,e);return n.createInterpolant=this.createInterpolant,n}}Rf.prototype.TimeBufferType=Float32Array,Rf.prototype.ValueBufferType=Float32Array,Rf.prototype.DefaultInterpolation=Oc;class Nf extends Rf{constructor(t,e,n){super(t,e,n)}}Nf.prototype.ValueTypeName="bool",Nf.prototype.ValueBufferType=Array,Nf.prototype.DefaultInterpolation=Ic,Nf.prototype.InterpolantFactoryMethodLinear=void 0,Nf.prototype.InterpolantFactoryMethodSmooth=void 0;class Pf extends Rf{}Pf.prototype.ValueTypeName="color";class If extends Rf{}If.prototype.ValueTypeName="number";class Of extends Ef{constructor(t,e,n,r){super(t,e,n,r)}interpolate_(t,e,n,r){const i=this.resultBuffer,s=this.sampleValues,o=this.valueSize,a=(n-e)/(r-e);let l=t*o;for(let t=l+o;l!==t;l+=4)Nh.slerpFlat(i,0,s,l-o,s,l,a);return i}}class Df extends Rf{InterpolantFactoryMethodLinear(t){return new Of(this.times,this.values,this.getValueSize(),t)}}Df.prototype.ValueTypeName="quaternion",Df.prototype.InterpolantFactoryMethodSmooth=void 0;class Lf extends Rf{constructor(t,e,n){super(t,e,n)}}Lf.prototype.ValueTypeName="string",Lf.prototype.ValueBufferType=Array,Lf.prototype.DefaultInterpolation=Ic,Lf.prototype.InterpolantFactoryMethodLinear=void 0,Lf.prototype.InterpolantFactoryMethodSmooth=void 0;class Uf extends Rf{}Uf.prototype.ValueTypeName="vector";class kf{constructor(t,e,n){const r=this;let i,s=!1,o=0,a=0;const l=[];this.onStart=void 0,this.onLoad=t,this.onProgress=e,this.onError=n,this.itemStart=function(t){a++,!1===s&&void 0!==r.onStart&&r.onStart(t,o,a),s=!0},this.itemEnd=function(t){o++,void 0!==r.onProgress&&r.onProgress(t,o,a),o===a&&(s=!1,void 0!==r.onLoad&&r.onLoad())},this.itemError=function(t){void 0!==r.onError&&r.onError(t)},this.resolveURL=function(t){return i?i(t):t},this.setURLModifier=function(t){return i=t,this},this.addHandler=function(t,e){return l.push(t,e),this},this.removeHandler=function(t){const e=l.indexOf(t);return-1!==e&&l.splice(e,2),this},this.getHandler=function(t){for(let e=0,n=l.length;e<n;e+=2){const n=l[e],r=l[e+1];if(n.global&&(n.lastIndex=0),n.test(t))return r}return null}}}const Bf=new kf;class Ff{constructor(t){this.manager=void 0!==t?t:Bf,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(t,e){const n=this;return new Promise((function(r,i){n.load(t,r,e,i)}))}parse(){}setCrossOrigin(t){return this.crossOrigin=t,this}setWithCredentials(t){return this.withCredentials=t,this}setPath(t){return this.path=t,this}setResourcePath(t){return this.resourcePath=t,this}setRequestHeader(t){return this.requestHeader=t,this}}Ff.DEFAULT_MATERIAL_NAME="__DEFAULT";class zf extends Dd{constructor(t,e=1){super(),this.isLight=!0,this.type="Light",this.color=new Qd(t),this.intensity=e}dispose(){}copy(t,e){return super.copy(t,e),this.color.copy(t.color),this.intensity=t.intensity,this}toJSON(t){const e=super.toJSON(t);return e.object.color=this.color.getHex(),e.object.intensity=this.intensity,void 0!==this.groundColor&&(e.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(e.object.distance=this.distance),void 0!==this.angle&&(e.object.angle=this.angle),void 0!==this.decay&&(e.object.decay=this.decay),void 0!==this.penumbra&&(e.object.penumbra=this.penumbra),void 0!==this.shadow&&(e.object.shadow=this.shadow.toJSON()),void 0!==this.target&&(e.object.target=this.target.uuid),e}}class Vf extends zf{constructor(t,e,n){super(t,n),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(Dd.DEFAULT_UP),this.updateMatrix(),this.groundColor=new Qd(e)}copy(t,e){return super.copy(t,e),this.groundColor.copy(t.groundColor),this}}const Gf=new ad,jf=new Ph,Hf=new Ph;class Wf{constructor(t){this.camera=t,this.intensity=1,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new oh(512,512),this.map=null,this.mapPass=null,this.matrix=new ad,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new lf,this._frameExtents=new oh(1,1),this._viewportCount=1,this._viewports=[new Th(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(t){const e=this.camera,n=this.matrix;jf.setFromMatrixPosition(t.matrixWorld),e.position.copy(jf),Hf.setFromMatrixPosition(t.target.matrixWorld),e.lookAt(Hf),e.updateMatrixWorld(),Gf.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Gf),n.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),n.multiply(Gf)}getViewport(t){return this._viewports[t]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(t){return this.camera=t.camera.clone(),this.intensity=t.intensity,this.bias=t.bias,this.radius=t.radius,this.mapSize.copy(t.mapSize),this}clone(){return(new this.constructor).copy(this)}toJSON(){const t={};return 1!==this.intensity&&(t.intensity=this.intensity),0!==this.bias&&(t.bias=this.bias),0!==this.normalBias&&(t.normalBias=this.normalBias),1!==this.radius&&(t.radius=this.radius),512===this.mapSize.x&&512===this.mapSize.y||(t.mapSize=this.mapSize.toArray()),t.camera=this.camera.toJSON(!1).object,delete t.camera.matrix,t}}class qf extends Wf{constructor(){super(new jp(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(t){const e=this.camera,n=2*Jc*t.angle*this.focus,r=this.mapSize.width/this.mapSize.height,i=t.distance||e.far;n===e.fov&&r===e.aspect&&i===e.far||(e.fov=n,e.aspect=r,e.far=i,e.updateProjectionMatrix()),super.updateMatrices(t)}copy(t){return super.copy(t),this.focus=t.focus,this}}class Xf extends zf{constructor(t,e,n=0,r=Math.PI/3,i=0,s=2){super(t,e),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(Dd.DEFAULT_UP),this.updateMatrix(),this.target=new Dd,this.distance=n,this.angle=r,this.penumbra=i,this.decay=s,this.map=null,this.shadow=new qf}get power(){return this.intensity*Math.PI}set power(t){this.intensity=t/Math.PI}dispose(){this.shadow.dispose()}copy(t,e){return super.copy(t,e),this.distance=t.distance,this.angle=t.angle,this.penumbra=t.penumbra,this.decay=t.decay,this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}const Zf=new ad,$f=new Ph,Yf=new Ph;class Kf extends Wf{constructor(){super(new jp(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new oh(4,2),this._viewportCount=6,this._viewports=[new Th(2,1,1,1),new Th(0,1,1,1),new Th(3,1,1,1),new Th(1,1,1,1),new Th(3,0,1,1),new Th(1,0,1,1)],this._cubeDirections=[new Ph(1,0,0),new Ph(-1,0,0),new Ph(0,0,1),new Ph(0,0,-1),new Ph(0,1,0),new Ph(0,-1,0)],this._cubeUps=[new Ph(0,1,0),new Ph(0,1,0),new Ph(0,1,0),new Ph(0,1,0),new Ph(0,0,1),new Ph(0,0,-1)]}updateMatrices(t,e=0){const n=this.camera,r=this.matrix,i=t.distance||n.far;i!==n.far&&(n.far=i,n.updateProjectionMatrix()),$f.setFromMatrixPosition(t.matrixWorld),n.position.copy($f),Yf.copy(n.position),Yf.add(this._cubeDirections[e]),n.up.copy(this._cubeUps[e]),n.lookAt(Yf),n.updateMatrixWorld(),r.makeTranslation(-$f.x,-$f.y,-$f.z),Zf.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Zf)}}class Jf extends zf{constructor(t,e,n=0,r=2){super(t,e),this.isPointLight=!0,this.type="PointLight",this.distance=n,this.decay=r,this.shadow=new Kf}get power(){return 4*this.intensity*Math.PI}set power(t){this.intensity=t/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(t,e){return super.copy(t,e),this.distance=t.distance,this.decay=t.decay,this.shadow=t.shadow.clone(),this}}class Qf extends Fp{constructor(t=-1,e=1,n=1,r=-1,i=.1,s=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=t,this.right=e,this.top=n,this.bottom=r,this.near=i,this.far=s,this.updateProjectionMatrix()}copy(t,e){return super.copy(t,e),this.left=t.left,this.right=t.right,this.top=t.top,this.bottom=t.bottom,this.near=t.near,this.far=t.far,this.zoom=t.zoom,this.view=null===t.view?null:Object.assign({},t.view),this}setViewOffset(t,e,n,r,i,s){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=n,this.view.offsetY=r,this.view.width=i,this.view.height=s,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const t=(this.right-this.left)/(2*this.zoom),e=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,r=(this.top+this.bottom)/2;let i=n-t,s=n+t,o=r+e,a=r-e;if(null!==this.view&&this.view.enabled){const t=(this.right-this.left)/this.view.fullWidth/this.zoom,e=(this.top-this.bottom)/this.view.fullHeight/this.zoom;i+=t*this.view.offsetX,s=i+t*this.view.width,o-=e*this.view.offsetY,a=o-e*this.view.height}this.projectionMatrix.makeOrthographic(i,s,o,a,this.near,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(t){const e=super.toJSON(t);return e.object.zoom=this.zoom,e.object.left=this.left,e.object.right=this.right,e.object.top=this.top,e.object.bottom=this.bottom,e.object.near=this.near,e.object.far=this.far,null!==this.view&&(e.object.view=Object.assign({},this.view)),e}}class tm extends Wf{constructor(){super(new Qf(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class em extends zf{constructor(t,e){super(t,e),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(Dd.DEFAULT_UP),this.updateMatrix(),this.target=new Dd,this.shadow=new tm}dispose(){this.shadow.dispose()}copy(t){return super.copy(t),this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}class nm extends zf{constructor(t,e){super(t,e),this.isAmbientLight=!0,this.type="AmbientLight"}}class rm extends zf{constructor(t,e,n=10,r=10){super(t,e),this.isRectAreaLight=!0,this.type="RectAreaLight",this.width=n,this.height=r}get power(){return this.intensity*this.width*this.height*Math.PI}set power(t){this.intensity=t/(this.width*this.height*Math.PI)}copy(t){return super.copy(t),this.width=t.width,this.height=t.height,this}toJSON(t){const e=super.toJSON(t);return e.object.width=this.width,e.object.height=this.height,e}}class im{constructor(){this.isSphericalHarmonics3=!0,this.coefficients=[];for(let t=0;t<9;t++)this.coefficients.push(new Ph)}set(t){for(let e=0;e<9;e++)this.coefficients[e].copy(t[e]);return this}zero(){for(let t=0;t<9;t++)this.coefficients[t].set(0,0,0);return this}getAt(t,e){const n=t.x,r=t.y,i=t.z,s=this.coefficients;return e.copy(s[0]).multiplyScalar(.282095),e.addScaledVector(s[1],.488603*r),e.addScaledVector(s[2],.488603*i),e.addScaledVector(s[3],.488603*n),e.addScaledVector(s[4],n*r*1.092548),e.addScaledVector(s[5],r*i*1.092548),e.addScaledVector(s[6],.315392*(3*i*i-1)),e.addScaledVector(s[7],n*i*1.092548),e.addScaledVector(s[8],.546274*(n*n-r*r)),e}getIrradianceAt(t,e){const n=t.x,r=t.y,i=t.z,s=this.coefficients;return e.copy(s[0]).multiplyScalar(.886227),e.addScaledVector(s[1],1.023328*r),e.addScaledVector(s[2],1.023328*i),e.addScaledVector(s[3],1.023328*n),e.addScaledVector(s[4],.858086*n*r),e.addScaledVector(s[5],.858086*r*i),e.addScaledVector(s[6],.743125*i*i-.247708),e.addScaledVector(s[7],.858086*n*i),e.addScaledVector(s[8],.429043*(n*n-r*r)),e}add(t){for(let e=0;e<9;e++)this.coefficients[e].add(t.coefficients[e]);return this}addScaledSH(t,e){for(let n=0;n<9;n++)this.coefficients[n].addScaledVector(t.coefficients[n],e);return this}scale(t){for(let e=0;e<9;e++)this.coefficients[e].multiplyScalar(t);return this}lerp(t,e){for(let n=0;n<9;n++)this.coefficients[n].lerp(t.coefficients[n],e);return this}equals(t){for(let e=0;e<9;e++)if(!this.coefficients[e].equals(t.coefficients[e]))return!1;return!0}copy(t){return this.set(t.coefficients)}clone(){return(new this.constructor).copy(this)}fromArray(t,e=0){const n=this.coefficients;for(let r=0;r<9;r++)n[r].fromArray(t,e+3*r);return this}toArray(t=[],e=0){const n=this.coefficients;for(let r=0;r<9;r++)n[r].toArray(t,e+3*r);return t}static getBasisAt(t,e){const n=t.x,r=t.y,i=t.z;e[0]=.282095,e[1]=.488603*r,e[2]=.488603*i,e[3]=.488603*n,e[4]=1.092548*n*r,e[5]=1.092548*r*i,e[6]=.315392*(3*i*i-1),e[7]=1.092548*n*i,e[8]=.546274*(n*n-r*r)}}class sm extends zf{constructor(t=new im,e=1){super(void 0,e),this.isLightProbe=!0,this.sh=t}copy(t){return super.copy(t),this.sh.copy(t.sh),this}fromJSON(t){return this.intensity=t.intensity,this.sh.fromArray(t.sh),this}toJSON(t){const e=super.toJSON(t);return e.object.sh=this.sh.toArray(),e}}const om="\\[\\]\\.:\\/",am=new RegExp("["+om+"]","g"),lm="[^"+om+"]",um="[^"+om.replace("\\.","")+"]",cm=new RegExp("^"+/((?:WC+[\/:])*)/.source.replace("WC",lm)+/(WCOD+)?/.source.replace("WCOD",um)+/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",lm)+/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",lm)+"$"),hm=["material","materials","bones","map"];class dm{constructor(t,e,n){this.path=e,this.parsedPath=n||dm.parseTrackName(e),this.node=dm.findNode(t,this.parsedPath.nodeName),this.rootNode=t,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(t,e,n){return t&&t.isAnimationObjectGroup?new dm.Composite(t,e,n):new dm(t,e,n)}static sanitizeNodeName(t){return t.replace(/\s/g,"_").replace(am,"")}static parseTrackName(t){const e=cm.exec(t);if(null===e)throw new Error("PropertyBinding: Cannot parse trackName: "+t);const n={nodeName:e[2],objectName:e[3],objectIndex:e[4],propertyName:e[5],propertyIndex:e[6]},r=n.nodeName&&n.nodeName.lastIndexOf(".");if(void 0!==r&&-1!==r){const t=n.nodeName.substring(r+1);-1!==hm.indexOf(t)&&(n.nodeName=n.nodeName.substring(0,r),n.objectName=t)}if(null===n.propertyName||0===n.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+t);return n}static findNode(t,e){if(void 0===e||""===e||"."===e||-1===e||e===t.name||e===t.uuid)return t;if(t.skeleton){const n=t.skeleton.getBoneByName(e);if(void 0!==n)return n}if(t.children){const n=function(t){for(let r=0;r<t.length;r++){const i=t[r];if(i.name===e||i.uuid===e)return i;const s=n(i.children);if(s)return s}return null},r=n(t.children);if(r)return r}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(t,e){t[e]=this.targetObject[this.propertyName]}_getValue_array(t,e){const n=this.resolvedProperty;for(let r=0,i=n.length;r!==i;++r)t[e++]=n[r]}_getValue_arrayElement(t,e){t[e]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(t,e){this.resolvedProperty.toArray(t,e)}_setValue_direct(t,e){this.targetObject[this.propertyName]=t[e]}_setValue_direct_setNeedsUpdate(t,e){this.targetObject[this.propertyName]=t[e],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(t,e){this.targetObject[this.propertyName]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(t,e){const n=this.resolvedProperty;for(let r=0,i=n.length;r!==i;++r)n[r]=t[e++]}_setValue_array_setNeedsUpdate(t,e){const n=this.resolvedProperty;for(let r=0,i=n.length;r!==i;++r)n[r]=t[e++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(t,e){const n=this.resolvedProperty;for(let r=0,i=n.length;r!==i;++r)n[r]=t[e++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(t,e){this.resolvedProperty[this.propertyIndex]=t[e]}_setValue_arrayElement_setNeedsUpdate(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(t,e){this.resolvedProperty.fromArray(t,e)}_setValue_fromArray_setNeedsUpdate(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(t,e){this.bind(),this.getValue(t,e)}_setValue_unbound(t,e){this.bind(),this.setValue(t,e)}bind(){let t=this.node;const e=this.parsedPath,n=e.objectName,r=e.propertyName;let i=e.propertyIndex;if(t||(t=dm.findNode(this.rootNode,e.nodeName),this.node=t),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!t)return void console.warn("THREE.PropertyBinding: No target node found for track: "+this.path+".");if(n){let r=e.objectIndex;switch(n){case"materials":if(!t.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!t.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);t=t.material.materials;break;case"bones":if(!t.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);t=t.skeleton.bones;for(let e=0;e<t.length;e++)if(t[e].name===r){r=e;break}break;case"map":if("map"in t){t=t.map;break}if(!t.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!t.material.map)return void console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);t=t.material.map;break;default:if(void 0===t[n])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);t=t[n]}if(void 0!==r){if(void 0===t[r])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,t);t=t[r]}}const s=t[r];if(void 0===s){const n=e.nodeName;return void console.error("THREE.PropertyBinding: Trying to update property for track: "+n+"."+r+" but it wasn't found.",t)}let o=this.Versioning.None;this.targetObject=t,void 0!==t.needsUpdate?o=this.Versioning.NeedsUpdate:void 0!==t.matrixWorldNeedsUpdate&&(o=this.Versioning.MatrixWorldNeedsUpdate);let a=this.BindingType.Direct;if(void 0!==i){if("morphTargetInfluences"===r){if(!t.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!t.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);void 0!==t.morphTargetDictionary[i]&&(i=t.morphTargetDictionary[i])}a=this.BindingType.ArrayElement,this.resolvedProperty=s,this.propertyIndex=i}else void 0!==s.fromArray&&void 0!==s.toArray?(a=this.BindingType.HasFromToArray,this.resolvedProperty=s):Array.isArray(s)?(a=this.BindingType.EntireArray,this.resolvedProperty=s):this.propertyName=r;this.getValue=this.GetterByBindingType[a],this.setValue=this.SetterByBindingTypeAndVersioning[a][o]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}dm.Composite=class{constructor(t,e,n){const r=n||dm.parseTrackName(e);this._targetGroup=t,this._bindings=t.subscribe_(e,r)}getValue(t,e){this.bind();const n=this._targetGroup.nCachedObjects_,r=this._bindings[n];void 0!==r&&r.getValue(t,e)}setValue(t,e){const n=this._bindings;for(let r=this._targetGroup.nCachedObjects_,i=n.length;r!==i;++r)n[r].setValue(t,e)}bind(){const t=this._bindings;for(let e=this._targetGroup.nCachedObjects_,n=t.length;e!==n;++e)t[e].bind()}unbind(){const t=this._bindings;for(let e=this._targetGroup.nCachedObjects_,n=t.length;e!==n;++e)t[e].unbind()}},dm.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},dm.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},dm.prototype.GetterByBindingType=[dm.prototype._getValue_direct,dm.prototype._getValue_array,dm.prototype._getValue_arrayElement,dm.prototype._getValue_toArray],dm.prototype.SetterByBindingTypeAndVersioning=[[dm.prototype._setValue_direct,dm.prototype._setValue_direct_setNeedsUpdate,dm.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[dm.prototype._setValue_array,dm.prototype._setValue_array_setNeedsUpdate,dm.prototype._setValue_array_setMatrixWorldNeedsUpdate],[dm.prototype._setValue_arrayElement,dm.prototype._setValue_arrayElement_setNeedsUpdate,dm.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[dm.prototype._setValue_fromArray,dm.prototype._setValue_fromArray_setNeedsUpdate,dm.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];new Float32Array(1);class pm extends $p{constructor(t,e,n=1){super(t,e),this.isInstancedInterleavedBuffer=!0,this.meshPerAttribute=n}copy(t){return super.copy(t),this.meshPerAttribute=t.meshPerAttribute,this}clone(t){const e=super.clone(t);return e.meshPerAttribute=this.meshPerAttribute,e}toJSON(t){const e=super.toJSON(t);return e.isInstancedInterleavedBuffer=!0,e.meshPerAttribute=this.meshPerAttribute,e}}const fm=["alphaMap","alphaTest","anisotropy","anisotropyMap","anisotropyRotation","aoMap","attenuationColor","attenuationDistance","bumpMap","clearcoat","clearcoatMap","clearcoatNormalMap","clearcoatNormalScale","clearcoatRoughness","color","dispersion","displacementMap","emissive","emissiveMap","envMap","gradientMap","ior","iridescence","iridescenceIOR","iridescenceMap","iridescenceThicknessMap","lightMap","map","matcap","metalness","metalnessMap","normalMap","normalScale","opacity","roughness","roughnessMap","sheen","sheenColor","sheenColorMap","sheenRoughnessMap","shininess","specular","specularColor","specularColorMap","specularIntensity","specularIntensityMap","specularMap","thickness","transmission","transmissionMap"];class mm{constructor(t){this.renderObjects=new WeakMap,this.hasNode=this.containsNode(t),this.hasAnimation=!0===t.object.isSkinnedMesh,this.refreshUniforms=fm,this.renderId=0}firstInitialization(t){return!1===this.renderObjects.has(t)&&(this.getRenderObjectData(t),!0)}getRenderObjectData(t){let e=this.renderObjects.get(t);if(void 0===e){const{geometry:n,material:r}=t;if(e={material:this.getMaterialData(r),geometry:{attributes:this.getAttributesData(n.attributes),indexVersion:n.index?n.index.version:null,drawRange:{start:n.drawRange.start,count:n.drawRange.count}},worldMatrix:t.object.matrixWorld.clone()},t.object.center&&(e.center=t.object.center.clone()),t.object.morphTargetInfluences&&(e.morphTargetInfluences=t.object.morphTargetInfluences.slice()),null!==t.bundle&&(e.version=t.bundle.version),e.material.transmission>0){const{width:n,height:r}=t.context;e.bufferWidth=n,e.bufferHeight=r}this.renderObjects.set(t,e)}return e}getAttributesData(t){const e={};for(const n in t){const r=t[n];e[n]={version:r.version}}return e}containsNode(t){const e=t.material;for(const t in e)if(e[t]&&e[t].isNode)return!0;return null!==t.renderer.nodes.modelViewMatrix||null!==t.renderer.nodes.modelNormalViewMatrix}getMaterialData(t){const e={};for(const n of this.refreshUniforms){const r=t[n];null!=r&&("object"==typeof r&&void 0!==r.clone?!0===r.isTexture?e[n]={id:r.id,version:r.version}:e[n]=r.clone():e[n]=r)}return e}equals(t){const{object:e,material:n,geometry:r}=t,i=this.getRenderObjectData(t);if(!0!==i.worldMatrix.equals(e.matrixWorld))return i.worldMatrix.copy(e.matrixWorld),!1;const s=i.material;for(const t in s){const e=s[t],r=n[t];if(void 0!==e.equals){if(!1===e.equals(r))return e.copy(r),!1}else if(!0===r.isTexture){if(e.id!==r.id||e.version!==r.version)return e.id=r.id,e.version=r.version,!1}else if(e!==r)return s[t]=r,!1}if(s.transmission>0){const{width:e,height:n}=t.context;if(i.bufferWidth!==e||i.bufferHeight!==n)return i.bufferWidth=e,i.bufferHeight=n,!1}const o=i.geometry,a=r.attributes,l=o.attributes,u=Object.keys(l),c=Object.keys(a);if(u.length!==c.length)return i.geometry.attributes=this.getAttributesData(a),!1;for(const t of u){const e=l[t],n=a[t];if(void 0===n)return delete l[t],!1;if(e.version!==n.version)return e.version=n.version,!1}const h=r.index,d=o.indexVersion,p=h?h.version:null;if(d!==p)return o.indexVersion=p,!1;if(o.drawRange.start!==r.drawRange.start||o.drawRange.count!==r.drawRange.count)return o.drawRange.start=r.drawRange.start,o.drawRange.count=r.drawRange.count,!1;if(i.morphTargetInfluences){let t=!1;for(let n=0;n<i.morphTargetInfluences.length;n++)i.morphTargetInfluences[n]!==e.morphTargetInfluences[n]&&(t=!0);if(t)return!0}return i.center&&!1===i.center.equals(e.center)?(i.center.copy(e.center),!0):(null!==t.bundle&&(i.version=t.bundle.version),!0)}needsRefresh(t,e){if(this.hasNode||this.hasAnimation||this.firstInitialization(t))return!0;const{renderId:n}=e;if(this.renderId!==n)return this.renderId=n,!0;const r=!0===t.object.static,i=null!==t.bundle&&!0===t.bundle.static&&this.getRenderObjectData(t).version===t.bundle.version;if(r||i)return!1;return!0!==this.equals(t)}}function gm(t,e=0){let n=3735928559^e,r=1103547991^e;if(t instanceof Array)for(let e,i=0;i<t.length;i++)e=t[i],n=Math.imul(n^e,2654435761),r=Math.imul(r^e,1597334677);else for(let e,i=0;i<t.length;i++)e=t.charCodeAt(i),n=Math.imul(n^e,2654435761),r=Math.imul(r^e,1597334677);return n=Math.imul(n^n>>>16,2246822507),n^=Math.imul(r^r>>>13,3266489909),r=Math.imul(r^r>>>16,2246822507),r^=Math.imul(n^n>>>13,3266489909),4294967296*(2097151&r)+(n>>>0)}const vm=t=>gm(t),ym=t=>gm(t),_m=(...t)=>gm(t);function xm(t,e=!1){const n=[];!0===t.isNode&&(n.push(t.id),t=t.getSelf());for(const{property:r,childNode:i}of bm(t))n.push(n,gm(r.slice(0,-4)),i.getCacheKey(e));return gm(n)}function*bm(t,e=!1){for(const n in t){if(!0===n.startsWith("_"))continue;const r=t[n];if(!0===Array.isArray(r))for(let t=0;t<r.length;t++){const i=r[t];i&&(!0===i.isNode||e&&"function"==typeof i.toJSON)&&(yield{property:n,index:t,childNode:i})}else if(r&&!0===r.isNode)yield{property:n,childNode:r};else if("object"==typeof r)for(const t in r){const i=r[t];i&&(!0===i.isNode||e&&"function"==typeof i.toJSON)&&(yield{property:n,index:t,childNode:i})}}}function wm(t){if(null==t)return null;const e=typeof t;return!0===t.isNode?"node":"number"===e?"float":"boolean"===e?"bool":"string"===e?"string":"function"===e?"shader":!0===t.isVector2?"vec2":!0===t.isVector3?"vec3":!0===t.isVector4?"vec4":!0===t.isMatrix3?"mat3":!0===t.isMatrix4?"mat4":!0===t.isColor?"color":t instanceof ArrayBuffer?"ArrayBuffer":null}function Sm(t,...e){const n=t?t.slice(-4):void 0;return 1===e.length&&("vec2"===n?e=[e[0],e[0]]:"vec3"===n?e=[e[0],e[0],e[0]]:"vec4"===n&&(e=[e[0],e[0],e[0],e[0]])),"color"===t?new Qd(...e):"vec2"===n?new oh(...e):"vec3"===n?new Ph(...e):"vec4"===n?new Th(...e):"mat3"===n?new ah(...e):"mat4"===n?new ad(...e):"bool"===t?e[0]||!1:"float"===t||"int"===t||"uint"===t?e[0]||0:"string"===t?e[0]||"":"ArrayBuffer"===t?Em(e[0]):null}function Mm(t){let e="";const n=new Uint8Array(t);for(let t=0;t<n.length;t++)e+=String.fromCharCode(n[t]);return btoa(e)}function Em(t){return Uint8Array.from(atob(t),(t=>t.charCodeAt(0))).buffer}const Tm="vertex",Am="none",Cm="frame",Rm="render",Nm="object",Pm=["setup","analyze","generate"],Im=["fragment","vertex","compute"],Om=["x","y","z","w"];let Dm=0;class Lm extends Zc{static get type(){return"Node"}constructor(t=null){super(),this.nodeType=t,this.updateType=Am,this.updateBeforeType=Am,this.updateAfterType=Am,this.uuid=sh.generateUUID(),this.version=0,this._cacheKey=null,this._cacheKeyVersion=0,this.global=!1,this.isNode=!0,Object.defineProperty(this,"id",{value:Dm++})}set needsUpdate(t){!0===t&&this.version++}get type(){return this.constructor.type}onUpdate(t,e){return this.updateType=e,this.update=t.bind(this.getSelf()),this}onFrameUpdate(t){return this.onUpdate(t,Cm)}onRenderUpdate(t){return this.onUpdate(t,Rm)}onObjectUpdate(t){return this.onUpdate(t,Nm)}onReference(t){return this.updateReference=t.bind(this.getSelf()),this}getSelf(){return this.self||this}updateReference(){return this}isGlobal(){return this.global}*getChildren(){for(const{childNode:t}of bm(this))yield t}dispose(){this.dispatchEvent({type:"dispose"})}traverse(t){t(this);for(const e of this.getChildren())e.traverse(t)}getCacheKey(t=!1){return!0!==(t=t||this.version!==this._cacheKeyVersion)&&null!==this._cacheKey||(this._cacheKey=xm(this,t),this._cacheKeyVersion=this.version),this._cacheKey}getScope(){return this}getHash(){return this.uuid}getUpdateType(){return this.updateType}getUpdateBeforeType(){return this.updateBeforeType}getUpdateAfterType(){return this.updateAfterType}getElementType(t){const e=this.getNodeType(t);return t.getElementType(e)}getNodeType(t){const e=t.getNodeProperties(this);return e.outputNode?e.outputNode.getNodeType(t):this.nodeType}getShared(t){const e=this.getHash(t);return t.getNodeFromHash(e)||this}setup(t){const e=t.getNodeProperties(this);let n=0;for(const t of this.getChildren())e["node"+n++]=t;return null}analyze(t){if(1===t.increaseUsage(this)){const e=t.getNodeProperties(this);for(const n of Object.values(e))n&&!0===n.isNode&&n.build(t)}}generate(t,e){const{outputNode:n}=t.getNodeProperties(this);if(n&&!0===n.isNode)return n.build(t,e)}updateBefore(){console.warn("Abstract function.")}updateAfter(){console.warn("Abstract function.")}update(){console.warn("Abstract function.")}build(t,e=null){const n=this.getShared(t);if(this!==n)return n.build(t,e);t.addNode(this),t.addChain(this);let r=null;const i=t.getBuildStage();if("setup"===i){this.updateReference(t);const e=t.getNodeProperties(this);if(!0!==e.initialized){t.stack.nodes.length;e.initialized=!0,e.outputNode=this.setup(t),null!==e.outputNode&&t.stack.nodes.length;for(const n of Object.values(e))n&&!0===n.isNode&&n.build(t)}}else if("analyze"===i)this.analyze(t);else if("generate"===i){if(1===this.generate.length){const n=this.getNodeType(t),i=t.getDataFromNode(this);r=i.snippet,void 0===r?(r=this.generate(t)||"",i.snippet=r):void 0!==i.flowCodes&&void 0!==t.context.nodeBlock&&t.addFlowCodeHierarchy(this,t.context.nodeBlock),r=t.format(r,n,e)}else r=this.generate(t,e)||""}return t.removeChain(this),t.addSequentialNode(this),r}getSerializeChildren(){return bm(this)}serialize(t){const e=this.getSerializeChildren(),n={};for(const{property:r,index:i,childNode:s}of e)void 0!==i?(void 0===n[r]&&(n[r]=Number.isInteger(i)?[]:{}),n[r][i]=s.toJSON(t.meta).uuid):n[r]=s.toJSON(t.meta).uuid;Object.keys(n).length>0&&(t.inputNodes=n)}deserialize(t){if(void 0!==t.inputNodes){const e=t.meta.nodes;for(const n in t.inputNodes)if(Array.isArray(t.inputNodes[n])){const r=[];for(const i of t.inputNodes[n])r.push(e[i]);this[n]=r}else if("object"==typeof t.inputNodes[n]){const r={};for(const i in t.inputNodes[n]){const s=t.inputNodes[n][i];r[i]=e[s]}this[n]=r}else{const r=t.inputNodes[n];this[n]=e[r]}}}toJSON(t){const{uuid:e,type:n}=this,r=void 0===t||"string"==typeof t;r&&(t={textures:{},images:{},nodes:{}});let i=t.nodes[e];function s(t){const e=[];for(const n in t){const r=t[n];delete r.metadata,e.push(r)}return e}if(void 0===i&&(i={uuid:e,type:n,meta:t,metadata:{version:4.6,type:"Node",generator:"Node.toJSON"}},!0!==r&&(t.nodes[i.uuid]=i),this.serialize(i),delete i.meta),r){const e=s(t.textures),n=s(t.images),r=s(t.nodes);e.length>0&&(i.textures=e),n.length>0&&(i.images=n),r.length>0&&(i.nodes=r)}return i}}class Um extends Lm{static get type(){return"ArrayElementNode"}constructor(t,e){super(),this.node=t,this.indexNode=e,this.isArrayElementNode=!0}getNodeType(t){return this.node.getElementType(t)}generate(t){return`${this.node.build(t)}[ ${this.indexNode.build(t,"uint")} ]`}}class km extends Lm{static get type(){return"ConvertNode"}constructor(t,e){super(),this.node=t,this.convertTo=e}getNodeType(t){const e=this.node.getNodeType(t);let n=null;for(const r of this.convertTo.split("|"))null!==n&&t.getTypeLength(e)!==t.getTypeLength(r)||(n=r);return n}serialize(t){super.serialize(t),t.convertTo=this.convertTo}deserialize(t){super.deserialize(t),this.convertTo=t.convertTo}generate(t,e){const n=this.node,r=this.getNodeType(t),i=n.build(t,r);return t.format(i,r,e)}}class Bm extends Lm{static get type(){return"TempNode"}constructor(t){super(t),this.isTempNode=!0}hasDependencies(t){return t.getDataFromNode(this).usageCount>1}build(t,e){if("generate"===t.getBuildStage()){const n=t.getVectorType(this.getNodeType(t,e)),r=t.getDataFromNode(this);if(void 0!==r.propertyName)return t.format(r.propertyName,n,e);if("void"!==n&&"void"!==e&&this.hasDependencies(t)){const i=super.build(t,n),s=t.getVarFromNode(this,null,n),o=t.getPropertyName(s);return t.addLineFlowCode(`${o} = ${i}`,this),r.snippet=i,r.propertyName=o,t.format(r.propertyName,n,e)}}return super.build(t,e)}}class Fm extends Bm{static get type(){return"JoinNode"}constructor(t=[],e=null){super(e),this.nodes=t}getNodeType(t){return null!==this.nodeType?t.getVectorType(this.nodeType):t.getTypeFromLength(this.nodes.reduce(((e,n)=>e+t.getTypeLength(n.getNodeType(t))),0))}generate(t,e){const n=this.getNodeType(t),r=this.nodes,i=t.getComponentType(n),s=[];for(const e of r){let n=e.build(t);const r=t.getComponentType(e.getNodeType(t));r!==i&&(n=t.format(n,r,i)),s.push(n)}const o=`${t.getType(n)}( ${s.join(", ")} )`;return t.format(o,n,e)}}const zm=Om.join("");class Vm extends Lm{static get type(){return"SplitNode"}constructor(t,e="x"){super(),this.node=t,this.components=e,this.isSplitNode=!0}getVectorLength(){let t=this.components.length;for(const e of this.components)t=Math.max(Om.indexOf(e)+1,t);return t}getComponentType(t){return t.getComponentType(this.node.getNodeType(t))}getNodeType(t){return t.getTypeFromLength(this.components.length,this.getComponentType(t))}generate(t,e){const n=this.node,r=t.getTypeLength(n.getNodeType(t));let i=null;if(r>1){let s=null;this.getVectorLength()>=r&&(s=t.getTypeFromLength(this.getVectorLength(),this.getComponentType(t)));const o=n.build(t,s);i=this.components.length===r&&this.components===zm.slice(0,this.components.length)?t.format(o,s,e):t.format(`${o}.${this.components}`,this.getNodeType(t),e)}else i=n.build(t,e);return i}serialize(t){super.serialize(t),t.components=this.components}deserialize(t){super.deserialize(t),this.components=t.components}}class Gm extends Bm{static get type(){return"SetNode"}constructor(t,e,n){super(),this.sourceNode=t,this.components=e,this.targetNode=n}getNodeType(t){return this.sourceNode.getNodeType(t)}generate(t){const{sourceNode:e,components:n,targetNode:r}=this,i=this.getNodeType(t),s=t.getTypeFromLength(n.length,r.getNodeType(t)),o=r.build(t,s),a=e.build(t,i),l=t.getTypeLength(i),u=[];for(let t=0;t<l;t++){const e=Om[t];e===n[0]?(u.push(o),t+=n.length-1):u.push(a+"."+e)}return`${t.getType(i)}( ${u.join(", ")} )`}}class jm extends Bm{static get type(){return"FlipNode"}constructor(t,e){super(),this.sourceNode=t,this.components=e}getNodeType(t){return this.sourceNode.getNodeType(t)}generate(t){const{components:e,sourceNode:n}=this,r=this.getNodeType(t),i=n.build(t),s=t.getVarFromNode(this),o=t.getPropertyName(s);t.addLineFlowCode(o+" = "+i,this);const a=t.getTypeLength(r),l=[];let u=0;for(let t=0;t<a;t++){const n=Om[t];n===e[u]?(l.push("1.0 - "+o+"."+n),u++):l.push(o+"."+n)}return`${t.getType(r)}( ${l.join(", ")} )`}}class Hm extends Lm{static get type(){return"InputNode"}constructor(t,e=null){super(e),this.isInputNode=!0,this.value=t,this.precision=null}getNodeType(){return null===this.nodeType?wm(this.value):this.nodeType}getInputType(t){return this.getNodeType(t)}setPrecision(t){return this.precision=t,this}serialize(t){super.serialize(t),t.value=this.value,this.value&&this.value.toArray&&(t.value=this.value.toArray()),t.valueType=wm(this.value),t.nodeType=this.nodeType,"ArrayBuffer"===t.valueType&&(t.value=Mm(t.value)),t.precision=this.precision}deserialize(t){super.deserialize(t),this.nodeType=t.nodeType,this.value=Array.isArray(t.value)?Sm(t.valueType,...t.value):t.value,this.precision=t.precision||null,this.value&&this.value.fromArray&&(this.value=this.value.fromArray(t.value))}generate(){console.warn("Abstract function.")}}class Wm extends Hm{static get type(){return"ConstNode"}constructor(t,e=null){super(t,e),this.isConstNode=!0}generateConst(t){return t.generateConst(this.getNodeType(t),this.value)}generate(t,e){const n=this.getNodeType(t);return t.format(this.generateConst(t),n,e)}}let qm=null;const Xm=new Map;function Zm(t,e){if(Xm.has(t))console.warn(`Redefinition of method chaining ${t}`);else{if("function"!=typeof e)throw new Error(`Node element ${t} is not a function`);Xm.set(t,e)}}const $m=t=>t.replace(/r|s/g,"x").replace(/g|t/g,"y").replace(/b|p/g,"z").replace(/a|q/g,"w"),Ym=t=>$m(t).split("").sort().join(""),Km={setup(t,e){const n=e.shift();return t(bg(n),...e)},get(t,e,n){if("string"==typeof e&&void 0===t[e]){if(!0!==t.isStackNode&&"assign"===e)return(...t)=>(qm.assign(n,...t),n);if(Xm.has(e)){const r=Xm.get(e);return t.isStackNode?(...t)=>n.add(r(...t)):(...t)=>r(n,...t)}if("self"===e)return t;if(e.endsWith("Assign")&&Xm.has(e.slice(0,e.length-"Assign".length))){const r=Xm.get(e.slice(0,e.length-"Assign".length));return t.isStackNode?(...t)=>n.assign(t[0],r(...t)):(...t)=>n.assign(r(n,...t))}if(!0===/^[xyzwrgbastpq]{1,4}$/.test(e))return e=$m(e),xg(new Vm(n,e));if(!0===/^set[XYZWRGBASTPQ]{1,4}$/.test(e))return e=Ym(e.slice(3).toLowerCase()),n=>xg(new Gm(t,e,n));if(!0===/^flip[XYZWRGBASTPQ]{1,4}$/.test(e))return e=Ym(e.slice(4).toLowerCase()),()=>xg(new jm(xg(t),e));if("width"===e||"height"===e||"depth"===e)return"width"===e?e="x":"height"===e?e="y":"depth"===e&&(e="z"),xg(new Vm(t,e));if(!0===/^\d+$/.test(e))return xg(new Um(n,new Wm(Number(e),"uint")))}return Reflect.get(t,e,n)},set(t,e,n,r){return"string"!=typeof e||void 0!==t[e]||!0!==/^[xyzwrgbastpq]{1,4}$/.test(e)&&"width"!==e&&"height"!==e&&"depth"!==e&&!0!==/^\d+$/.test(e)?Reflect.set(t,e,n,r):(r[e].assign(n),!0)}},Jm=new WeakMap,Qm=new WeakMap,tg=function(t,e=null){for(const n in t)t[n]=xg(t[n],e);return t},eg=function(t,e=null){const n=t.length;for(let r=0;r<n;r++)t[r]=xg(t[r],e);return t},ng=function(t,e=null,n=null,r=null){const i=t=>xg(null!==r?Object.assign(t,r):t);return null===e?(...e)=>i(new t(...wg(e))):null!==n?(n=xg(n),(...r)=>i(new t(e,...wg(r),n))):(...n)=>i(new t(e,...wg(n)))},rg=function(t,...e){return xg(new t(...wg(e)))};class ig extends Lm{constructor(t,e){super(),this.shaderNode=t,this.inputNodes=e}getNodeType(t){return this.shaderNode.nodeType||this.getOutputNode(t).getNodeType(t)}call(t){const{shaderNode:e,inputNodes:n}=this,r=t.getNodeProperties(e);if(r.onceOutput)return r.onceOutput;let i=null;if(e.layout){let r=Qm.get(t.constructor);void 0===r&&(r=new WeakMap,Qm.set(t.constructor,r));let s=r.get(e);void 0===s&&(s=xg(t.buildFunctionNode(e)),r.set(e,s)),null!==t.currentFunctionNode&&t.currentFunctionNode.includes.push(s),i=xg(s.call(n))}else{const r=e.jsFunc,s=null!==n?r(n,t):r(t);i=xg(s)}return e.once&&(r.onceOutput=i),i}getOutputNode(t){const e=t.getNodeProperties(this);return null===e.outputNode&&(e.outputNode=this.setupOutput(t)),e.outputNode}setup(t){return this.getOutputNode(t)}setupOutput(t){return t.addStack(),t.stack.outputNode=this.call(t),t.removeStack()}generate(t,e){return this.getOutputNode(t).build(t,e)}}class sg extends Lm{constructor(t,e){super(e),this.jsFunc=t,this.layout=null,this.global=!0,this.once=!1}setLayout(t){return this.layout=t,this}call(t=null){return bg(t),xg(new ig(this,t))}setup(){return this.call()}}const og=[!1,!0],ag=[0,1,2,3],lg=[-1,-2],ug=[.5,1.5,1/3,1e-6,1e6,Math.PI,2*Math.PI,1/Math.PI,2/Math.PI,1/(2*Math.PI),Math.PI/2],cg=new Map;for(const t of og)cg.set(t,new Wm(t));const hg=new Map;for(const t of ag)hg.set(t,new Wm(t,"uint"));const dg=new Map([...hg].map((t=>new Wm(t.value,"int"))));for(const t of lg)dg.set(t,new Wm(t,"int"));const pg=new Map([...dg].map((t=>new Wm(t.value))));for(const t of ug)pg.set(t,new Wm(t));for(const t of ug)pg.set(-t,new Wm(-t));const fg={bool:cg,uint:hg,ints:dg,float:pg},mg=new Map([...cg,...pg]),gg=(t,e)=>mg.has(t)?mg.get(t):!0===t.isNode?t:new Wm(t,e),vg=function(t,e=null){return(...n)=>{if((0===n.length||!["bool","float","int","uint"].includes(t)&&n.every((t=>"object"!=typeof t)))&&(n=[Sm(t,...n)]),1===n.length&&null!==e&&e.has(n[0]))return xg(e.get(n[0]));if(1===n.length){const e=gg(n[0],t);return(t=>{try{return t.getNodeType()}catch(t){return}})(e)===t?xg(e):xg(new km(e,t))}const r=n.map((t=>gg(t)));return xg(new Fm(r,t))}},yg=t=>"object"==typeof t&&null!==t?t.value:t;function _g(t,e){return new Proxy(new sg(t,e),Km)}const xg=(t,e=null)=>function(t,e=null){const n=wm(t);if("node"===n){let e=Jm.get(t);return void 0===e&&(e=new Proxy(t,Km),Jm.set(t,e),Jm.set(e,e)),e}return null===e&&("float"===n||"boolean"===n)||n&&"shader"!==n&&"string"!==n?xg(gg(t,e)):"shader"===n?Eg(t):t}(t,e),bg=(t,e=null)=>new tg(t,e),wg=(t,e=null)=>new eg(t,e),Sg=(...t)=>new ng(...t),Mg=(...t)=>new rg(...t),Eg=(t,e)=>{const n=new _g(t,e),r=(...t)=>{let e;return bg(t),e=t[0]&&t[0].isNode?[...t]:t[0],n.call(e)};return r.shaderNode=n,r.setLayout=t=>(n.setLayout(t),r),r.once=()=>(n.once=!0,r),r};Zm("toGlobal",(t=>(t.global=!0,t)));const Tg=t=>{qm=t},Ag=()=>qm,Cg=(...t)=>qm.If(...t);Zm("append",(function(t){return qm&&qm.add(t),t}));const Rg=new vg("color"),Ng=new vg("float",fg.float),Pg=new vg("int",fg.ints),Ig=new vg("uint",fg.uint),Og=new vg("bool",fg.bool),Dg=new vg("vec2"),Lg=new vg("ivec2"),Ug=new vg("uvec2"),kg=new vg("bvec2"),Bg=new vg("vec3"),Fg=new vg("ivec3"),zg=new vg("uvec3"),Vg=new vg("bvec3"),Gg=new vg("vec4"),jg=new vg("ivec4"),Hg=new vg("uvec4"),Wg=new vg("bvec4"),qg=new vg("mat2"),Xg=new vg("mat3"),Zg=new vg("mat4");Zm("toColor",Rg),Zm("toFloat",Ng),Zm("toInt",Pg),Zm("toUint",Ig),Zm("toBool",Og),Zm("toVec2",Dg),Zm("toIVec2",Lg),Zm("toUVec2",Ug),Zm("toBVec2",kg),Zm("toVec3",Bg),Zm("toIVec3",Fg),Zm("toUVec3",zg),Zm("toBVec3",Vg),Zm("toVec4",Gg),Zm("toIVec4",jg),Zm("toUVec4",Hg),Zm("toBVec4",Wg),Zm("toMat2",qg),Zm("toMat3",Xg),Zm("toMat4",Zg);Zm("element",Sg(Um)),Zm("convert",((t,e)=>xg(new km(xg(t),e))));class $g extends Lm{static get type(){return"UniformGroupNode"}constructor(t,e=!1,n=1){super("string"),this.name=t,this.version=0,this.shared=e,this.order=n,this.isUniformGroup=!0}set needsUpdate(t){!0===t&&this.version++}serialize(t){super.serialize(t),t.name=this.name,t.version=this.version,t.shared=this.shared}deserialize(t){super.deserialize(t),this.name=t.name,this.version=t.version,this.shared=t.shared}}const Yg=t=>new $g(t),Kg=(t,e=0)=>new $g(t,!0,e),Jg=Kg("frame"),Qg=Kg("render"),tv=Yg("object");class ev extends Hm{static get type(){return"UniformNode"}constructor(t,e=null){super(t,e),this.isUniformNode=!0,this.name="",this.groupNode=tv}label(t){return this.name=t,this}setGroup(t){return this.groupNode=t,this}getGroup(){return this.groupNode}getUniformHash(t){return this.getHash(t)}onUpdate(t,e){const n=this.getSelf();return t=t.bind(n),super.onUpdate((e=>{const r=t(e,n);void 0!==r&&(this.value=r)}),e)}generate(t,e){const n=this.getNodeType(t),r=this.getUniformHash(t);let i=t.getNodeFromHash(r);void 0===i&&(t.setHashNode(this,r),i=this);const s=i.getInputType(t),o=t.getUniformFromNode(i,s,t.shaderStage,this.name||t.context.label),a=t.getPropertyName(o);return void 0!==t.context.label&&delete t.context.label,t.format(a,n,e)}}const nv=(t,e)=>{const n=(t=>null!=t?t.nodeType||t.convertTo||("string"==typeof t?t:null):null)(e||t),r=t&&!0===t.isNode?t.node&&t.node.value||t.value:t;return xg(new ev(r,n))};class rv extends Lm{static get type(){return"PropertyNode"}constructor(t,e=null,n=!1){super(t),this.name=e,this.varying=n,this.isPropertyNode=!0}getHash(t){return this.name||super.getHash(t)}isGlobal(){return!0}generate(t){let e;return!0===this.varying?(e=t.getVaryingFromNode(this,this.name),e.needsInterpolation=!0):e=t.getVarFromNode(this,this.name),t.getPropertyName(e)}}const iv=(t,e)=>xg(new rv(t,e)),sv=(t,e)=>xg(new rv(t,e,!0)),ov=Mg(rv,"vec4","DiffuseColor"),av=Mg(rv,"vec3","EmissiveColor"),lv=Mg(rv,"float","Roughness"),uv=Mg(rv,"float","Metalness"),cv=Mg(rv,"float","Clearcoat"),hv=Mg(rv,"float","ClearcoatRoughness"),dv=Mg(rv,"vec3","Sheen"),pv=Mg(rv,"float","SheenRoughness"),fv=Mg(rv,"float","Iridescence"),mv=Mg(rv,"float","IridescenceIOR"),gv=Mg(rv,"float","IridescenceThickness"),vv=Mg(rv,"float","AlphaT"),yv=Mg(rv,"float","Anisotropy"),_v=Mg(rv,"vec3","AnisotropyT"),xv=Mg(rv,"vec3","AnisotropyB"),bv=Mg(rv,"color","SpecularColor"),wv=Mg(rv,"float","SpecularF90"),Sv=Mg(rv,"float","Shininess"),Mv=Mg(rv,"vec4","Output"),Ev=Mg(rv,"float","dashSize"),Tv=Mg(rv,"float","gapSize"),Av=Mg(rv,"float","IOR"),Cv=Mg(rv,"float","Transmission"),Rv=Mg(rv,"float","Thickness"),Nv=Mg(rv,"float","AttenuationDistance"),Pv=Mg(rv,"color","AttenuationColor"),Iv=Mg(rv,"float","Dispersion");class Ov extends Bm{static get type(){return"AssignNode"}constructor(t,e){super(),this.targetNode=t,this.sourceNode=e}hasDependencies(){return!1}getNodeType(t,e){return"void"!==e?this.targetNode.getNodeType(t):"void"}needsSplitAssign(t){const{targetNode:e}=this;if(!1===t.isAvailable("swizzleAssign")&&e.isSplitNode&&e.components.length>1){const n=t.getTypeLength(e.node.getNodeType(t));return Om.join("").slice(0,n)!==e.components}return!1}generate(t,e){const{targetNode:n,sourceNode:r}=this,i=this.needsSplitAssign(t),s=n.getNodeType(t),o=n.context({assign:!0}).build(t),a=r.build(t,s),l=r.getNodeType(t),u=t.getDataFromNode(this);let c;if(!0===u.initialized)"void"!==e&&(c=o);else if(i){const r=t.getVarFromNode(this,null,s),i=t.getPropertyName(r);t.addLineFlowCode(`${i} = ${a}`,this);const l=n.node.context({assign:!0}).build(t);for(let e=0;e<n.components.length;e++){const r=n.components[e];t.addLineFlowCode(`${l}.${r} = ${i}[ ${e} ]`,this)}"void"!==e&&(c=o)}else c=`${o} = ${a}`,"void"!==e&&"void"!==l||(t.addLineFlowCode(c,this),"void"!==e&&(c=o));return u.initialized=!0,t.format(c,s,e)}}Zm("assign",Sg(Ov));class Dv extends Bm{static get type(){return"FunctionCallNode"}constructor(t=null,e={}){super(),this.functionNode=t,this.parameters=e}setParameters(t){return this.parameters=t,this}getParameters(){return this.parameters}getNodeType(t){return this.functionNode.getNodeType(t)}generate(t){const e=[],n=this.functionNode,r=n.getInputs(t),i=this.parameters,s=(e,n)=>{const r=n.type;let i;return i="pointer"===r?"&"+e.build(t):e.build(t,r),i};if(Array.isArray(i))for(let t=0;t<i.length;t++)e.push(s(i[t],r[t]));else for(const t of r){const n=i[t.name];if(void 0===n)throw new Error(`FunctionCallNode: Input '${t.name}' not found in FunctionNode.`);e.push(s(n,t))}return`${n.build(t,"property")}( ${e.join(", ")} )`}}Zm("call",((t,...e)=>(e=e.length>1||e[0]&&!0===e[0].isNode?wg(e):bg(e[0]),xg(new Dv(xg(t),e)))));class Lv extends Bm{static get type(){return"OperatorNode"}constructor(t,e,n,...r){if(super(),r.length>0){let i=new Lv(t,e,n);for(let e=0;e<r.length-1;e++)i=new Lv(t,i,r[e]);e=i,n=r[r.length-1]}this.op=t,this.aNode=e,this.bNode=n}getNodeType(t,e){const n=this.op,r=this.aNode,i=this.bNode,s=r.getNodeType(t),o=void 0!==i?i.getNodeType(t):null;if("void"===s||"void"===o)return"void";if("%"===n)return s;if("~"===n||"&"===n||"|"===n||"^"===n||">>"===n||"<<"===n)return t.getIntegerType(s);if("!"===n||"=="===n||"&&"===n||"||"===n||"^^"===n)return"bool";if("<"===n||">"===n||"<="===n||">="===n){const n=e?t.getTypeLength(e):Math.max(t.getTypeLength(s),t.getTypeLength(o));return n>1?`bvec${n}`:"bool"}return"float"===s&&t.isMatrix(o)?o:t.isMatrix(s)&&t.isVector(o)?t.getVectorFromMatrix(s):t.isVector(s)&&t.isMatrix(o)?t.getVectorFromMatrix(o):t.getTypeLength(o)>t.getTypeLength(s)?o:s}generate(t,e){const n=this.op,r=this.aNode,i=this.bNode,s=this.getNodeType(t,e);let o=null,a=null;"void"!==s?(o=r.getNodeType(t),a=void 0!==i?i.getNodeType(t):null,"<"===n||">"===n||"<="===n||">="===n||"=="===n?t.isVector(o)?a=o:o!==a&&(o=a="float"):">>"===n||"<<"===n?(o=s,a=t.changeComponentType(a,"uint")):t.isMatrix(o)&&t.isVector(a)?a=t.getVectorFromMatrix(o):o=t.isVector(o)&&t.isMatrix(a)?t.getVectorFromMatrix(a):a=s):o=a=s;const l=r.build(t,o),u=void 0!==i?i.build(t,a):null,c=t.getTypeLength(e),h=t.getFunctionOperator(n);return"void"!==e?"<"===n&&c>1?t.useComparisonMethod?t.format(`${t.getMethod("lessThan",e)}( ${l}, ${u} )`,s,e):t.format(`( ${l} < ${u} )`,s,e):"<="===n&&c>1?t.useComparisonMethod?t.format(`${t.getMethod("lessThanEqual",e)}( ${l}, ${u} )`,s,e):t.format(`( ${l} <= ${u} )`,s,e):">"===n&&c>1?t.useComparisonMethod?t.format(`${t.getMethod("greaterThan",e)}( ${l}, ${u} )`,s,e):t.format(`( ${l} > ${u} )`,s,e):">="===n&&c>1?t.useComparisonMethod?t.format(`${t.getMethod("greaterThanEqual",e)}( ${l}, ${u} )`,s,e):t.format(`( ${l} >= ${u} )`,s,e):"!"===n||"~"===n?t.format(`(${n}${l})`,o,e):h?t.format(`${h}( ${l}, ${u} )`,s,e):t.format(`( ${l} ${n} ${u} )`,s,e):"void"!==o?h?t.format(`${h}( ${l}, ${u} )`,s,e):t.format(`${l} ${n} ${u}`,s,e):void 0}serialize(t){super.serialize(t),t.op=this.op}deserialize(t){super.deserialize(t),this.op=t.op}}const Uv=Sg(Lv,"+"),kv=Sg(Lv,"-"),Bv=Sg(Lv,"*"),Fv=Sg(Lv,"/"),zv=Sg(Lv,"%"),Vv=Sg(Lv,"=="),Gv=Sg(Lv,"!="),jv=Sg(Lv,"<"),Hv=Sg(Lv,">"),Wv=Sg(Lv,"<="),qv=Sg(Lv,">="),Xv=Sg(Lv,"&&"),Zv=Sg(Lv,"||"),$v=Sg(Lv,"!"),Yv=Sg(Lv,"^^"),Kv=Sg(Lv,"&"),Jv=Sg(Lv,"~"),Qv=Sg(Lv,"|"),ty=Sg(Lv,"^"),ey=Sg(Lv,"<<"),ny=Sg(Lv,">>");Zm("add",Uv),Zm("sub",kv),Zm("mul",Bv),Zm("div",Fv),Zm("modInt",zv),Zm("equal",Vv),Zm("notEqual",Gv),Zm("lessThan",jv),Zm("greaterThan",Hv),Zm("lessThanEqual",Wv),Zm("greaterThanEqual",qv),Zm("and",Xv),Zm("or",Zv),Zm("not",$v),Zm("xor",Yv),Zm("bitAnd",Kv),Zm("bitNot",Jv),Zm("bitOr",Qv),Zm("bitXor",ty),Zm("shiftLeft",ey),Zm("shiftRight",ny);Zm("remainder",((...t)=>(console.warn("TSL.OperatorNode: .remainder() has been renamed to .modInt()."),zv(...t))));class ry extends Bm{static get type(){return"MathNode"}constructor(t,e,n=null,r=null){super(),this.method=t,this.aNode=e,this.bNode=n,this.cNode=r}getInputType(t){const e=this.aNode.getNodeType(t),n=this.bNode?this.bNode.getNodeType(t):null,r=this.cNode?this.cNode.getNodeType(t):null,i=t.isMatrix(e)?0:t.getTypeLength(e),s=t.isMatrix(n)?0:t.getTypeLength(n),o=t.isMatrix(r)?0:t.getTypeLength(r);return i>s&&i>o?e:s>o?n:o>i?r:e}getNodeType(t){const e=this.method;return e===ry.LENGTH||e===ry.DISTANCE||e===ry.DOT?"float":e===ry.CROSS?"vec3":e===ry.ALL?"bool":e===ry.EQUALS?t.changeComponentType(this.aNode.getNodeType(t),"bool"):e===ry.MOD?this.aNode.getNodeType(t):this.getInputType(t)}generate(t,e){const n=this.method,r=this.getNodeType(t),i=this.getInputType(t),s=this.aNode,o=this.bNode,a=this.cNode,l=!0===t.renderer.isWebGLRenderer;if(n===ry.TRANSFORM_DIRECTION){let n=s,r=o;t.isMatrix(n.getNodeType(t))?r=Gg(Bg(r),0):n=Gg(Bg(n),0);const i=Bv(n,r).xyz;return _y(i).build(t,e)}if(n===ry.NEGATE)return t.format("( - "+s.build(t,i)+" )",r,e);if(n===ry.ONE_MINUS)return kv(1,s).build(t,e);if(n===ry.RECIPROCAL)return Fv(1,s).build(t,e);if(n===ry.DIFFERENCE)return Ay(kv(s,o)).build(t,e);{const u=[];return n===ry.CROSS||n===ry.MOD?u.push(s.build(t,r),o.build(t,r)):l&&n===ry.STEP?u.push(s.build(t,1===t.getTypeLength(s.getNodeType(t))?"float":i),o.build(t,i)):l&&(n===ry.MIN||n===ry.MAX)||n===ry.MOD?u.push(s.build(t,i),o.build(t,1===t.getTypeLength(o.getNodeType(t))?"float":i)):n===ry.REFRACT?u.push(s.build(t,i),o.build(t,i),a.build(t,"float")):n===ry.MIX?u.push(s.build(t,i),o.build(t,i),a.build(t,1===t.getTypeLength(a.getNodeType(t))?"float":i)):(u.push(s.build(t,i)),null!==o&&u.push(o.build(t,i)),null!==a&&u.push(a.build(t,i))),t.format(`${t.getMethod(n,r)}( ${u.join(", ")} )`,r,e)}}serialize(t){super.serialize(t),t.method=this.method}deserialize(t){super.deserialize(t),this.method=t.method}}ry.ALL="all",ry.ANY="any",ry.EQUALS="equals",ry.RADIANS="radians",ry.DEGREES="degrees",ry.EXP="exp",ry.EXP2="exp2",ry.LOG="log",ry.LOG2="log2",ry.SQRT="sqrt",ry.INVERSE_SQRT="inversesqrt",ry.FLOOR="floor",ry.CEIL="ceil",ry.NORMALIZE="normalize",ry.FRACT="fract",ry.SIN="sin",ry.COS="cos",ry.TAN="tan",ry.ASIN="asin",ry.ACOS="acos",ry.ATAN="atan",ry.ABS="abs",ry.SIGN="sign",ry.LENGTH="length",ry.NEGATE="negate",ry.ONE_MINUS="oneMinus",ry.DFDX="dFdx",ry.DFDY="dFdy",ry.ROUND="round",ry.RECIPROCAL="reciprocal",ry.TRUNC="trunc",ry.FWIDTH="fwidth",ry.BITCAST="bitcast",ry.TRANSPOSE="transpose",ry.ATAN2="atan2",ry.MIN="min",ry.MAX="max",ry.MOD="mod",ry.STEP="step",ry.REFLECT="reflect",ry.DISTANCE="distance",ry.DIFFERENCE="difference",ry.DOT="dot",ry.CROSS="cross",ry.POW="pow",ry.TRANSFORM_DIRECTION="transformDirection",ry.MIX="mix",ry.CLAMP="clamp",ry.REFRACT="refract",ry.SMOOTHSTEP="smoothstep",ry.FACEFORWARD="faceforward";const iy=Ng(1e-6),sy=Ng(Math.PI),oy=(Math.PI,Sg(ry,ry.ALL)),ay=Sg(ry,ry.ANY),ly=Sg(ry,ry.EQUALS),uy=Sg(ry,ry.RADIANS),cy=Sg(ry,ry.DEGREES),hy=Sg(ry,ry.EXP),dy=Sg(ry,ry.EXP2),py=Sg(ry,ry.LOG),fy=Sg(ry,ry.LOG2),my=Sg(ry,ry.SQRT),gy=Sg(ry,ry.INVERSE_SQRT),vy=Sg(ry,ry.FLOOR),yy=Sg(ry,ry.CEIL),_y=Sg(ry,ry.NORMALIZE),xy=Sg(ry,ry.FRACT),by=Sg(ry,ry.SIN),wy=Sg(ry,ry.COS),Sy=Sg(ry,ry.TAN),My=Sg(ry,ry.ASIN),Ey=Sg(ry,ry.ACOS),Ty=Sg(ry,ry.ATAN),Ay=Sg(ry,ry.ABS),Cy=Sg(ry,ry.SIGN),Ry=Sg(ry,ry.LENGTH),Ny=Sg(ry,ry.NEGATE),Py=Sg(ry,ry.ONE_MINUS),Iy=Sg(ry,ry.DFDX),Oy=Sg(ry,ry.DFDY),Dy=Sg(ry,ry.ROUND),Ly=Sg(ry,ry.RECIPROCAL),Uy=Sg(ry,ry.TRUNC),ky=Sg(ry,ry.FWIDTH),By=(ry.BITCAST,Sg(ry,ry.TRANSPOSE)),Fy=Sg(ry,ry.ATAN2),zy=Sg(ry,ry.MIN),Vy=Sg(ry,ry.MAX),Gy=Sg(ry,ry.MOD),jy=Sg(ry,ry.STEP),Hy=Sg(ry,ry.REFLECT),Wy=Sg(ry,ry.DISTANCE),qy=Sg(ry,ry.DIFFERENCE),Xy=Sg(ry,ry.DOT),Zy=Sg(ry,ry.CROSS),$y=Sg(ry,ry.POW),Yy=Sg(ry,ry.POW,2),Ky=Sg(ry,ry.POW,3),Jy=Sg(ry,ry.POW,4),Qy=Sg(ry,ry.TRANSFORM_DIRECTION),t_=t=>Xy(t,t),e_=Sg(ry,ry.MIX),n_=(t,e=0,n=1)=>xg(new ry(ry.CLAMP,xg(t),xg(e),xg(n))),r_=Sg(ry,ry.REFRACT),i_=Sg(ry,ry.SMOOTHSTEP),s_=Sg(ry,ry.FACEFORWARD),o_=Eg((([t])=>{const e=Xy(t.xy,Dg(12.9898,78.233)),n=Gy(e,sy);return xy(by(n).mul(43758.5453))}));Zm("all",oy),Zm("any",ay),Zm("equals",ly),Zm("radians",uy),Zm("degrees",cy),Zm("exp",hy),Zm("exp2",dy),Zm("log",py),Zm("log2",fy),Zm("sqrt",my),Zm("inverseSqrt",gy),Zm("floor",vy),Zm("ceil",yy),Zm("normalize",_y),Zm("fract",xy),Zm("sin",by),Zm("cos",wy),Zm("tan",Sy),Zm("asin",My),Zm("acos",Ey),Zm("atan",Ty),Zm("abs",Ay),Zm("sign",Cy),Zm("length",Ry),Zm("lengthSq",t_),Zm("negate",Ny),Zm("oneMinus",Py),Zm("dFdx",Iy),Zm("dFdy",Oy),Zm("round",Dy),Zm("reciprocal",Ly),Zm("trunc",Uy),Zm("fwidth",ky),Zm("atan2",Fy),Zm("min",zy),Zm("max",Vy),Zm("mod",Gy),Zm("step",jy),Zm("reflect",Hy),Zm("distance",Wy),Zm("dot",Xy),Zm("cross",Zy),Zm("pow",$y),Zm("pow2",Yy),Zm("pow3",Ky),Zm("pow4",Jy),Zm("transformDirection",Qy),Zm("mix",((t,e,n)=>e_(e,n,t))),Zm("clamp",n_),Zm("refract",r_),Zm("smoothstep",((t,e,n)=>i_(e,n,t))),Zm("faceForward",s_),Zm("difference",qy),Zm("saturate",(t=>n_(t))),Zm("cbrt",(t=>Bv(Cy(t),$y(Ay(t),1/3)))),Zm("transpose",By),Zm("rand",o_);class a_ extends Lm{static get type(){return"ConditionalNode"}constructor(t,e,n=null){super(),this.condNode=t,this.ifNode=e,this.elseNode=n}getNodeType(t){const e=this.ifNode.getNodeType(t);if(null!==this.elseNode){const n=this.elseNode.getNodeType(t);if(t.getTypeLength(n)>t.getTypeLength(e))return n}return e}setup(t){const e=this.condNode.cache(),n=this.ifNode.cache(),r=this.elseNode?this.elseNode.cache():null,i=t.context.nodeBlock;t.getDataFromNode(n).parentNodeBlock=i,null!==r&&(t.getDataFromNode(r).parentNodeBlock=i);const s=t.getNodeProperties(this);s.condNode=e,s.ifNode=n.context({nodeBlock:n}),s.elseNode=r?r.context({nodeBlock:r}):null}generate(t,e){const n=this.getNodeType(t),r=t.getDataFromNode(this);if(void 0!==r.nodeProperty)return r.nodeProperty;const{condNode:i,ifNode:s,elseNode:o}=t.getNodeProperties(this),a="void"!==e,l=a?iv(n).build(t):"";r.nodeProperty=l;const u=i.build(t,"bool");t.addFlowCode(`\n${t.tab}if ( ${u} ) {\n\n`).addFlowTab();let c=s.build(t,n);if(c&&(c=a?l+" = "+c+";":"return "+c+";"),t.removeFlowTab().addFlowCode(t.tab+"\t"+c+"\n\n"+t.tab+"}"),null!==o){t.addFlowCode(" else {\n\n").addFlowTab();let e=o.build(t,n);e&&(e=a?l+" = "+e+";":"return "+e+";"),t.removeFlowTab().addFlowCode(t.tab+"\t"+e+"\n\n"+t.tab+"}\n\n")}else t.addFlowCode("\n\n");return t.format(l,n,e)}}const l_=Sg(a_);Zm("select",l_);Zm("cond",((...t)=>(console.warn("TSL.ConditionalNode: cond() has been renamed to select()."),l_(...t))));class u_ extends Lm{static get type(){return"ContextNode"}constructor(t,e={}){super(),this.isContextNode=!0,this.node=t,this.value=e}getScope(){return this.node.getScope()}getNodeType(t){return this.node.getNodeType(t)}analyze(t){this.node.build(t)}setup(t){const e=t.getContext();t.setContext({...t.context,...this.value});const n=this.node.build(t);return t.setContext(e),n}generate(t,e){const n=t.getContext();t.setContext({...t.context,...this.value});const r=this.node.build(t,e);return t.setContext(n),r}}const c_=Sg(u_);Zm("context",c_),Zm("label",((t,e)=>c_(t,{label:e})));class h_ extends Lm{static get type(){return"VarNode"}constructor(t,e=null){super(),this.node=t,this.name=e,this.global=!0,this.isVarNode=!0}getHash(t){return this.name||super.getHash(t)}getNodeType(t){return this.node.getNodeType(t)}generate(t){const{node:e,name:n}=this,r=t.getVarFromNode(this,n,t.getVectorType(this.getNodeType(t))),i=t.getPropertyName(r),s=e.build(t,r.type);return t.addLineFlowCode(`${i} = ${s}`,this),i}}const d_=Sg(h_);Zm("toVar",((...t)=>d_(...t).append()));Zm("temp",(t=>(console.warn('TSL: "temp" is deprecated. Use ".toVar()" instead.'),d_(t))));class p_ extends Lm{static get type(){return"VaryingNode"}constructor(t,e=null){super(),this.node=t,this.name=e,this.isVaryingNode=!0}isGlobal(){return!0}getHash(t){return this.name||super.getHash(t)}getNodeType(t){return this.node.getNodeType(t)}setupVarying(t){const e=t.getNodeProperties(this);let n=e.varying;if(void 0===n){const r=this.name,i=this.getNodeType(t);e.varying=n=t.getVaryingFromNode(this,r,i),e.node=this.node}return n.needsInterpolation||(n.needsInterpolation="fragment"===t.shaderStage),n}setup(t){this.setupVarying(t)}analyze(t){return this.setupVarying(t),this.node.analyze(t)}generate(t){const e=t.getNodeProperties(this),n=this.setupVarying(t);if(void 0===e.propertyName){const r=this.getNodeType(t),i=t.getPropertyName(n,Tm);t.flowNodeFromShaderStage(Tm,this.node,r,i),e.propertyName=i}return t.getPropertyName(n)}}const f_=Sg(p_);Zm("varying",f_);const m_=Eg((([t])=>{const e=t.mul(.9478672986).add(.0521327014).pow(2.4),n=t.mul(.0773993808),r=t.lessThanEqual(.04045);return e_(e,n,r)})).setLayout({name:"sRGBTransferEOTF",type:"vec3",inputs:[{name:"color",type:"vec3"}]}),g_=Eg((([t])=>{const e=t.pow(.41666).mul(1.055).sub(.055),n=t.mul(12.92),r=t.lessThanEqual(.0031308);return e_(e,n,r)})).setLayout({name:"sRGBTransferOETF",type:"vec3",inputs:[{name:"color",type:"vec3"}]}),v_="WorkingColorSpace",y_="OutputColorSpace";class __ extends Bm{static get type(){return"ColorSpaceNode"}constructor(t,e,n){super("vec4"),this.colorNode=t,this.source=e,this.target=n}resolveColorSpace(t,e){return e===v_?hh.workingColorSpace:e===y_?t.context.outputColorSpace||t.renderer.outputColorSpace:e}setup(t){const{colorNode:e}=this,n=this.resolveColorSpace(t,this.source),r=this.resolveColorSpace(t,this.target);let i=e;return!1!==hh.enabled&&n!==r&&n&&r?(hh.getTransfer(n)===Gc&&(i=Gg(m_(i.rgb),i.a)),hh.getPrimaries(n)!==hh.getPrimaries(r)&&(i=Gg(Xg(hh._getMatrix(new ah,n,r)).mul(i.rgb),i.a)),hh.getTransfer(r)===Gc&&(i=Gg(g_(i.rgb),i.a)),i):i}}const x_=(t,e)=>xg(new __(xg(t),e,v_));Zm("toOutputColorSpace",(t=>xg(new __(xg(t),v_,y_)))),Zm("toWorkingColorSpace",(t=>xg(new __(xg(t),y_,v_)))),Zm("workingToColorSpace",((t,e)=>xg(new __(xg(t),v_,e)))),Zm("colorSpaceToWorking",x_);let b_=class extends Um{static get type(){return"ReferenceElementNode"}constructor(t,e){super(t,e),this.referenceNode=t,this.isReferenceElementNode=!0}getNodeType(){return this.referenceNode.uniformType}generate(t){const e=super.generate(t),n=this.referenceNode.getNodeType(),r=this.getNodeType();return t.format(e,n,r)}};class w_ extends Lm{static get type(){return"ReferenceBaseNode"}constructor(t,e,n=null,r=null){super(),this.property=t,this.uniformType=e,this.object=n,this.count=r,this.properties=t.split("."),this.reference=n,this.node=null,this.group=null,this.updateType=Nm}setGroup(t){return this.group=t,this}element(t){return xg(new b_(this,xg(t)))}setNodeType(t){const e=nv(null,t).getSelf();null!==this.group&&e.setGroup(this.group),this.node=e}getNodeType(t){return null===this.node&&(this.updateReference(t),this.updateValue()),this.node.getNodeType(t)}getValueFromReference(t=this.reference){const{properties:e}=this;let n=t[e[0]];for(let t=1;t<e.length;t++)n=n[e[t]];return n}updateReference(t){return this.reference=null!==this.object?this.object:t.object,this.reference}setup(){return this.updateValue(),this.node}update(){this.updateValue()}updateValue(){null===this.node&&this.setNodeType(this.uniformType);const t=this.getValueFromReference();Array.isArray(t)?this.node.array=t:this.node.value=t}}class S_ extends w_{static get type(){return"RendererReferenceNode"}constructor(t,e,n=null){super(t,e,n),this.renderer=n,this.setGroup(Qg)}updateReference(t){return this.reference=null!==this.renderer?this.renderer:t.renderer,this.reference}}const M_=(t,e,n)=>xg(new S_(t,e,n));class E_ extends Bm{static get type(){return"ToneMappingNode"}constructor(t,e=T_,n=null){super("vec3"),this.toneMapping=t,this.exposureNode=e,this.colorNode=n}getCacheKey(){return _m(super.getCacheKey(),this.toneMapping)}setup(t){const e=this.colorNode||t.context.color,n=this.toneMapping;if(0===n)return e;let r=null;const i=t.renderer.library.getToneMappingFunction(n);return null!==i?r=Gg(i(e.rgb,this.exposureNode),e.a):(console.error("ToneMappingNode: Unsupported Tone Mapping configuration.",n),r=e),r}}const T_=M_("toneMappingExposure","float");Zm("toneMapping",((t,e,n)=>((t,e,n)=>xg(new E_(t,xg(e),xg(n))))(e,n,t)));class A_ extends Hm{static get type(){return"BufferAttributeNode"}constructor(t,e=null,n=0,r=0){super(t,e),this.isBufferNode=!0,this.bufferType=e,this.bufferStride=n,this.bufferOffset=r,this.usage=Hc,this.instanced=!1,this.attribute=null,this.global=!0,t&&!0===t.isBufferAttribute&&(this.attribute=t,this.usage=t.usage,this.instanced=t.isInstancedBufferAttribute)}getHash(t){if(0===this.bufferStride&&0===this.bufferOffset){let e=t.globalCache.getData(this.value);return void 0===e&&(e={node:this},t.globalCache.setData(this.value,e)),e.node.uuid}return this.uuid}getNodeType(t){return null===this.bufferType&&(this.bufferType=t.getTypeFromAttribute(this.attribute)),this.bufferType}setup(t){if(null!==this.attribute)return;const e=this.getNodeType(t),n=this.value,r=t.getTypeLength(e),i=this.bufferStride||r,s=this.bufferOffset,o=!0===n.isInterleavedBuffer?n:new $p(n,i),a=new Kp(o,r,s);o.setUsage(this.usage),this.attribute=a,this.attribute.isInstancedBufferAttribute=this.instanced}generate(t){const e=this.getNodeType(t),n=t.getBufferAttributeFromNode(this,e),r=t.getPropertyName(n);let i=null;if("vertex"===t.shaderStage||"compute"===t.shaderStage)this.name=r,i=r;else{i=f_(this).build(t,e)}return i}getInputType(){return"bufferAttribute"}setUsage(t){return this.usage=t,this.attribute&&!0===this.attribute.isBufferAttribute&&(this.attribute.usage=t),this}setInstanced(t){return this.instanced=t,this}}const C_=(t,e,n,r)=>xg(new A_(t,e,n,r)),R_=(t,e,n,r)=>C_(t,e,n,r).setInstanced(!0),N_=(t,e,n,r)=>((t,e,n,r)=>C_(t,e,n,r).setUsage(Wc))(t,e,n,r).setInstanced(!0);Zm("toAttribute",(t=>C_(t.value)));class P_ extends Lm{static get type(){return"ComputeNode"}constructor(t,e,n=[64]){super("void"),this.isComputeNode=!0,this.computeNode=t,this.count=e,this.workgroupSize=n,this.dispatchCount=0,this.version=1,this.updateBeforeType=Nm,this.onInitFunction=null,this.updateDispatchCount()}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(t){!0===t&&this.version++}updateDispatchCount(){const{count:t,workgroupSize:e}=this;let n=e[0];for(let t=1;t<e.length;t++)n*=e[t];this.dispatchCount=Math.ceil(t/n)}onInit(t){return this.onInitFunction=t,this}updateBefore({renderer:t}){t.compute(this)}generate(t){const{shaderStage:e}=t;if("compute"===e){const e=this.computeNode.build(t,"void");""!==e&&t.addLineFlowCode(e,this)}}}Zm("compute",((t,e,n)=>xg(new P_(xg(t),e,n))));class I_ extends Lm{static get type(){return"CacheNode"}constructor(t,e=!0){super(),this.node=t,this.parent=e,this.isCacheNode=!0}getNodeType(t){return this.node.getNodeType(t)}build(t,...e){const n=t.getCache(),r=t.getCacheFromNode(this,this.parent);t.setCache(r);const i=this.node.build(t,...e);return t.setCache(n),i}}const O_=(t,...e)=>xg(new I_(xg(t),...e));Zm("cache",O_);class D_ extends Lm{static get type(){return"BypassNode"}constructor(t,e){super(),this.isBypassNode=!0,this.outputNode=t,this.callNode=e}getNodeType(t){return this.outputNode.getNodeType(t)}generate(t){const e=this.callNode.build(t,"void");return""!==e&&t.addLineFlowCode(e,this),this.outputNode.build(t)}}Zm("bypass",Sg(D_));class L_ extends Lm{static get type(){return"RemapNode"}constructor(t,e,n,r=Ng(0),i=Ng(1)){super(),this.node=t,this.inLowNode=e,this.inHighNode=n,this.outLowNode=r,this.outHighNode=i,this.doClamp=!0}setup(){const{node:t,inLowNode:e,inHighNode:n,outLowNode:r,outHighNode:i,doClamp:s}=this;let o=t.sub(e).div(n.sub(e));return!0===s&&(o=o.clamp()),o.mul(i.sub(r)).add(r)}}const U_=Sg(L_,null,null,{doClamp:!1}),k_=Sg(L_);Zm("remap",U_),Zm("remapClamp",k_);class B_ extends Lm{static get type(){return"ExpressionNode"}constructor(t="",e="void"){super(e),this.snippet=t}generate(t,e){const n=this.getNodeType(t),r=this.snippet;if("void"!==n)return t.format(`( ${r} )`,n,e);t.addLineFlowCode(r,this)}}const F_=Sg(B_);Zm("discard",(t=>(t?l_(t,F_("discard")):F_("discard")).append()));class z_ extends Bm{static get type(){return"RenderOutputNode"}constructor(t,e,n){super("vec4"),this.colorNode=t,this.toneMapping=e,this.outputColorSpace=n,this.isRenderOutput=!0}setup({context:t}){let e=this.colorNode||t.color;const n=(null!==this.toneMapping?this.toneMapping:t.toneMapping)||0,r=(null!==this.outputColorSpace?this.outputColorSpace:t.outputColorSpace)||Bc;return 0!==n&&(e=e.toneMapping(n)),r!==Bc&&r!==hh.workingColorSpace&&(e=e.workingToColorSpace(r)),e}}const V_=(t,e=null,n=null)=>xg(new z_(xg(t),e,n));Zm("renderOutput",V_);class G_ extends Lm{static get type(){return"AttributeNode"}constructor(t,e=null){super(e),this.global=!0,this._attributeName=t}getHash(t){return this.getAttributeName(t)}getNodeType(t){let e=this.nodeType;if(null===e){const n=this.getAttributeName(t);if(t.hasGeometryAttribute(n)){const r=t.geometry.getAttribute(n);e=t.getTypeFromAttribute(r)}else e="float"}return e}setAttributeName(t){return this._attributeName=t,this}getAttributeName(){return this._attributeName}generate(t){const e=this.getAttributeName(t),n=this.getNodeType(t);if(!0===t.hasGeometryAttribute(e)){const r=t.geometry.getAttribute(e),i=t.getTypeFromAttribute(r),s=t.getAttribute(e,i);if("vertex"===t.shaderStage)return t.format(s.name,i,n);return f_(this).build(t,n)}return console.warn(`AttributeNode: Vertex attribute "${e}" not found on geometry.`),t.generateConst(n)}serialize(t){super.serialize(t),t.global=this.global,t._attributeName=this._attributeName}deserialize(t){super.deserialize(t),this.global=t.global,this._attributeName=t._attributeName}}const j_=(t,e)=>xg(new G_(t,e)),H_=t=>j_("uv"+(t>0?t:""),"vec2");class W_ extends Lm{static get type(){return"TextureSizeNode"}constructor(t,e=null){super("uvec2"),this.isTextureSizeNode=!0,this.textureNode=t,this.levelNode=e}generate(t,e){const n=this.textureNode.build(t,"property"),r=null===this.levelNode?"0":this.levelNode.build(t,"int");return t.format(`${t.getMethod("textureDimensions")}( ${n}, ${r} )`,this.getNodeType(t),e)}}const q_=Sg(W_);class X_ extends ev{static get type(){return"MaxMipLevelNode"}constructor(t){super(0),this._textureNode=t,this.updateType=Cm}get textureNode(){return this._textureNode}get texture(){return this._textureNode.value}update(){const t=this.texture,e=t.images,n=e&&e.length>0?e[0]&&e[0].image||e[0]:t.image;if(n&&void 0!==n.width){const{width:t,height:e}=n;this.value=Math.log2(Math.max(t,e))}}}const Z_=Sg(X_);class $_ extends ev{static get type(){return"TextureNode"}constructor(t,e=null,n=null,r=null){super(t),this.isTextureNode=!0,this.uvNode=e,this.levelNode=n,this.biasNode=r,this.compareNode=null,this.depthNode=null,this.gradNode=null,this.sampler=!0,this.updateMatrix=!1,this.updateType=Am,this.referenceNode=null,this._value=t,this._matrixUniform=null,this.setUpdateMatrix(null===e)}set value(t){this.referenceNode?this.referenceNode.value=t:this._value=t}get value(){return this.referenceNode?this.referenceNode.value:this._value}getUniformHash(){return this.value.uuid}getNodeType(){return!0===this.value.isDepthTexture?"float":this.value.type===Ju?"uvec4":this.value.type===Ku?"ivec4":"vec4"}getInputType(){return"texture"}getDefaultUV(){return H_(this.value.channel)}updateReference(){return this.value}getTransformedUV(t){return null===this._matrixUniform&&(this._matrixUniform=nv(this.value.matrix)),this._matrixUniform.mul(Bg(t,1)).xy}setUpdateMatrix(t){return this.updateMatrix=t,this.updateType=t?Cm:Am,this}setupUV(t,e){const n=this.value;return!t.isFlipY()||!0!==n.isRenderTargetTexture&&!0!==n.isFramebufferTexture&&!0!==n.isDepthTexture||(e=this.sampler?e.flipY():e.setY(Pg(q_(this,this.levelNode).y).sub(e.y).sub(1))),e}setup(t){const e=t.getNodeProperties(this);e.referenceNode=this.referenceNode;let n=this.uvNode;null!==n&&!0!==t.context.forceUVContext||!t.context.getUV||(n=t.context.getUV(this)),n||(n=this.getDefaultUV()),!0===this.updateMatrix&&(n=this.getTransformedUV(n)),n=this.setupUV(t,n);let r=this.levelNode;null===r&&t.context.getTextureLevel&&(r=t.context.getTextureLevel(this)),e.uvNode=n,e.levelNode=r,e.biasNode=this.biasNode,e.compareNode=this.compareNode,e.gradNode=this.gradNode,e.depthNode=this.depthNode}generateUV(t,e){return e.build(t,!0===this.sampler?"vec2":"ivec2")}generateSnippet(t,e,n,r,i,s,o,a){const l=this.value;let u;return u=r?t.generateTextureLevel(l,e,n,r,s):i?t.generateTextureBias(l,e,n,i,s):a?t.generateTextureGrad(l,e,n,a,s):o?t.generateTextureCompare(l,e,n,o,s):!1===this.sampler?t.generateTextureLoad(l,e,n,s):t.generateTexture(l,e,n,s),u}generate(t,e){const n=t.getNodeProperties(this),r=this.value;if(!r||!0!==r.isTexture)throw new Error("TextureNode: Need a three.js texture.");const i=super.generate(t,"property");if("sampler"===e)return i+"_sampler";if(t.isReference(e))return i;{const s=t.getDataFromNode(this);let o=s.propertyName;if(void 0===o){const{uvNode:e,levelNode:r,biasNode:a,compareNode:l,depthNode:u,gradNode:c}=n,h=this.generateUV(t,e),d=r?r.build(t,"float"):null,p=a?a.build(t,"float"):null,f=u?u.build(t,"int"):null,m=l?l.build(t,"float"):null,g=c?[c[0].build(t,"vec2"),c[1].build(t,"vec2")]:null,v=t.getVarFromNode(this);o=t.getPropertyName(v);const y=this.generateSnippet(t,i,h,d,p,f,m,g);t.addLineFlowCode(`${o} = ${y}`,this),s.snippet=y,s.propertyName=o}let a=o;const l=this.getNodeType(t);return t.needsToWorkingColorSpace(r)&&(a=x_(F_(a,l),r.colorSpace).setup(t).build(t,l)),t.format(a,l,e)}}setSampler(t){return this.sampler=t,this}getSampler(){return this.sampler}uv(t){const e=this.clone();return e.uvNode=xg(t),e.referenceNode=this.getSelf(),xg(e)}blur(t){const e=this.clone();return e.biasNode=xg(t).mul(Z_(e)),e.referenceNode=this.getSelf(),xg(e)}level(t){const e=this.clone();return e.levelNode=xg(t),e.referenceNode=this.getSelf(),xg(e)}size(t){return q_(this,t)}bias(t){const e=this.clone();return e.biasNode=xg(t),e.referenceNode=this.getSelf(),xg(e)}compare(t){const e=this.clone();return e.compareNode=xg(t),e.referenceNode=this.getSelf(),xg(e)}grad(t,e){const n=this.clone();return n.gradNode=[xg(t),xg(e)],n.referenceNode=this.getSelf(),xg(n)}depth(t){const e=this.clone();return e.depthNode=xg(t),e.referenceNode=this.getSelf(),xg(e)}serialize(t){super.serialize(t),t.value=this.value.toJSON(t.meta).uuid,t.sampler=this.sampler,t.updateMatrix=this.updateMatrix,t.updateType=this.updateType}deserialize(t){super.deserialize(t),this.value=t.meta.textures[t.value],this.sampler=t.sampler,this.updateMatrix=t.updateMatrix,this.updateType=t.updateType}update(){const t=this.value,e=this._matrixUniform;null!==e&&(e.value=t.matrix),!0===t.matrixAutoUpdate&&t.updateMatrix()}clone(){const t=new this.constructor(this.value,this.uvNode,this.levelNode,this.biasNode);return t.sampler=this.sampler,t}}const Y_=Sg($_),K_=(...t)=>Y_(...t).setSampler(!1),J_=nv("float").label("cameraNear").setGroup(Qg).onRenderUpdate((({camera:t})=>t.near)),Q_=nv("float").label("cameraFar").setGroup(Qg).onRenderUpdate((({camera:t})=>t.far)),tx=nv("mat4").label("cameraProjectionMatrix").setGroup(Qg).onRenderUpdate((({camera:t})=>t.projectionMatrix)),ex=nv("mat4").label("cameraViewMatrix").setGroup(Qg).onRenderUpdate((({camera:t})=>t.matrixWorldInverse)),nx=nv(new Ph).label("cameraPosition").setGroup(Qg).onRenderUpdate((({camera:t},e)=>e.value.setFromMatrixPosition(t.matrixWorld)));class rx extends Lm{static get type(){return"Object3DNode"}constructor(t,e=null){super(),this.scope=t,this.object3d=e,this.updateType=Nm,this._uniformNode=new ev(null)}getNodeType(){const t=this.scope;return t===rx.WORLD_MATRIX?"mat4":t===rx.POSITION||t===rx.VIEW_POSITION||t===rx.DIRECTION||t===rx.SCALE?"vec3":void 0}update(t){const e=this.object3d,n=this._uniformNode,r=this.scope;if(r===rx.WORLD_MATRIX)n.value=e.matrixWorld;else if(r===rx.POSITION)n.value=n.value||new Ph,n.value.setFromMatrixPosition(e.matrixWorld);else if(r===rx.SCALE)n.value=n.value||new Ph,n.value.setFromMatrixScale(e.matrixWorld);else if(r===rx.DIRECTION)n.value=n.value||new Ph,e.getWorldDirection(n.value);else if(r===rx.VIEW_POSITION){const r=t.camera;n.value=n.value||new Ph,n.value.setFromMatrixPosition(e.matrixWorld),n.value.applyMatrix4(r.matrixWorldInverse)}}generate(t){const e=this.scope;return e===rx.WORLD_MATRIX?this._uniformNode.nodeType="mat4":e!==rx.POSITION&&e!==rx.VIEW_POSITION&&e!==rx.DIRECTION&&e!==rx.SCALE||(this._uniformNode.nodeType="vec3"),this._uniformNode.build(t)}serialize(t){super.serialize(t),t.scope=this.scope}deserialize(t){super.deserialize(t),this.scope=t.scope}}rx.WORLD_MATRIX="worldMatrix",rx.POSITION="position",rx.SCALE="scale",rx.VIEW_POSITION="viewPosition",rx.DIRECTION="direction";rx.DIRECTION,rx.WORLD_MATRIX,rx.POSITION,rx.SCALE,rx.VIEW_POSITION;class ix extends rx{static get type(){return"ModelNode"}constructor(t){super(t)}update(t){this.object3d=t.object,super.update(t)}}const sx=Mg(ix,ix.WORLD_MATRIX),ox=nv(new ah).onObjectUpdate((({object:t},e)=>e.value.getNormalMatrix(t.matrixWorld))),ax=ex.mul(sx).toVar("modelViewMatrix"),lx=j_("position","vec3"),ux=lx.varying("positionLocal"),cx=lx.varying("positionPrevious"),hx=sx.mul(ux).xyz.varying("v_positionWorld"),dx=ux.transformDirection(sx).varying("v_positionWorldDirection").normalize().toVar("positionWorldDirection"),px=ax.mul(ux).xyz.varying("v_positionView"),fx=px.negate().varying("v_positionViewDirection").normalize().toVar("positionViewDirection");class mx extends Lm{static get type(){return"FrontFacingNode"}constructor(){super("bool"),this.isFrontFacingNode=!0}generate(t){const{renderer:e,material:n}=t;return e.coordinateSystem===qc&&1===n.side?"false":t.getFrontFacing()}}const gx=Ng(Mg(mx)).mul(2).sub(1),vx=j_("normal","vec3"),yx=Eg((t=>!1===t.geometry.hasAttribute("normal")?(console.warn('TSL.NormalNode: Vertex attribute "normal" not found on geometry.'),Bg(0,1,0)):vx),"vec3").once()().toVar("normalLocal"),_x=px.dFdx().cross(px.dFdy()).normalize().toVar("normalFlat"),xx=Eg((t=>{let e;return e=!0===t.material.flatShading?_x:f_(Tx(yx),"v_normalView").normalize(),e}),"vec3").once()().toVar("normalView"),bx=f_(xx.transformDirection(ex),"v_normalWorld").normalize().toVar("normalWorld"),wx=Eg((t=>t.context.setupNormal()),"vec3").once()().mul(gx).toVar("transformedNormalView"),Sx=wx.transformDirection(ex).toVar("transformedNormalWorld"),Mx=Eg((t=>t.context.setupClearcoatNormal()),"vec3").once()().mul(gx).toVar("transformedClearcoatNormalView"),Ex=Eg((([t,e=sx])=>{const n=Xg(e),r=t.div(Bg(n[0].dot(n[0]),n[1].dot(n[1]),n[2].dot(n[2])));return n.mul(r).xyz})),Tx=Eg((([t],e)=>{const n=e.renderer.nodes.modelNormalViewMatrix;if(null!==n)return n.transformDirection(t);const r=ox.mul(t);return ex.transformDirection(r)})),Ax=nv(0).onReference((({material:t})=>t)).onRenderUpdate((({material:t})=>t.refractionRatio)),Cx=fx.negate().reflect(wx),Rx=fx.negate().refract(wx,Ax),Nx=Cx.transformDirection(ex).toVar("reflectVector"),Px=Rx.transformDirection(ex).toVar("reflectVector");class Ix extends $_{static get type(){return"CubeTextureNode"}constructor(t,e=null,n=null,r=null){super(t,e,n,r),this.isCubeTextureNode=!0}getInputType(){return"cubeTexture"}getDefaultUV(){const t=this.value;return t.mapping===Ou?Nx:t.mapping===Du?Px:(console.error('THREE.CubeTextureNode: Mapping "%s" not supported.',t.mapping),Bg(0,0,0))}setUpdateMatrix(){}setupUV(t,e){const n=this.value;return t.renderer.coordinateSystem!==Xc&&n.isRenderTargetTexture?e:Bg(e.x.negate(),e.yz)}generateUV(t,e){return e.build(t,"vec3")}}const Ox=Sg(Ix);class Dx extends ev{static get type(){return"BufferNode"}constructor(t,e,n=0){super(t,e),this.isBufferNode=!0,this.bufferType=e,this.bufferCount=n}getElementType(t){return this.getNodeType(t)}getInputType(){return"buffer"}}const Lx=(t,e,n)=>xg(new Dx(t,e,n));class Ux extends Um{static get type(){return"UniformArrayElementNode"}constructor(t,e){super(t,e),this.isArrayBufferElementNode=!0}generate(t){const e=super.generate(t),n=this.getNodeType();return t.format(e,"vec4",n)}}class kx extends Dx{static get type(){return"UniformArrayNode"}constructor(t,e=null){super(null,"vec4"),this.array=t,this.elementType=e,this._elementType=null,this._elementLength=0,this.updateType=Rm,this.isArrayBufferNode=!0}getElementType(){return this.elementType||this._elementType}getElementLength(){return this._elementLength}update(){const{array:t,value:e}=this,n=this.getElementLength(),r=this.getElementType();if(1===n)for(let n=0;n<t.length;n++){e[4*n]=t[n]}else if("color"===r)for(let n=0;n<t.length;n++){const r=4*n,i=t[n];e[r]=i.r,e[r+1]=i.g,e[r+2]=i.b||0}else for(let n=0;n<t.length;n++){const r=4*n,i=t[n];e[r]=i.x,e[r+1]=i.y,e[r+2]=i.z||0,e[r+3]=i.w||0}}setup(t){const e=this.array.length;this._elementType=null===this.elementType?wm(this.array[0]):this.elementType,this._elementLength=t.getTypeLength(this._elementType);let n=Float32Array;return"i"===this._elementType.charAt(0)?n=Int32Array:"u"===this._elementType.charAt(0)&&(n=Uint32Array),this.value=new n(4*e),this.bufferCount=e,this.bufferType=t.changeComponentType("vec4",t.getComponentType(this._elementType)),super.setup(t)}element(t){return xg(new Ux(this,xg(t)))}}const Bx=(t,e)=>xg(new kx(t,e));class Fx extends Um{static get type(){return"ReferenceElementNode"}constructor(t,e){super(t,e),this.referenceNode=t,this.isReferenceElementNode=!0}getNodeType(){return this.referenceNode.uniformType}generate(t){const e=super.generate(t),n=this.referenceNode.getNodeType(),r=this.getNodeType();return t.format(e,n,r)}}class zx extends Lm{static get type(){return"ReferenceNode"}constructor(t,e,n=null,r=null){super(),this.property=t,this.uniformType=e,this.object=n,this.count=r,this.properties=t.split("."),this.reference=n,this.node=null,this.group=null,this.name=null,this.updateType=Nm}element(t){return xg(new Fx(this,xg(t)))}setGroup(t){return this.group=t,this}label(t){return this.name=t,this}setNodeType(t){let e=null;e=null!==this.count?Lx(null,t,this.count):Array.isArray(this.getValueFromReference())?Bx(null,t):"texture"===t?Y_(null):"cubeTexture"===t?Ox(null):nv(null,t),null!==this.group&&e.setGroup(this.group),null!==this.name&&e.label(this.name),this.node=e.getSelf()}getNodeType(t){return null===this.node&&(this.updateReference(t),this.updateValue()),this.node.getNodeType(t)}getValueFromReference(t=this.reference){const{properties:e}=this;let n=t[e[0]];for(let t=1;t<e.length;t++)n=n[e[t]];return n}updateReference(t){return this.reference=null!==this.object?this.object:t.object,this.reference}setup(){return this.updateValue(),this.node}update(){this.updateValue()}updateValue(){null===this.node&&this.setNodeType(this.uniformType);const t=this.getValueFromReference();Array.isArray(t)?this.node.array=t:this.node.value=t}}const Vx=(t,e,n)=>xg(new zx(t,e,n)),Gx=(t,e,n,r)=>xg(new zx(t,e,r,n));class jx extends zx{static get type(){return"MaterialReferenceNode"}constructor(t,e,n=null){super(t,e,n),this.material=n,this.isMaterialReferenceNode=!0}updateReference(t){return this.reference=null!==this.material?this.material:t.material,this.reference}}const Hx=(t,e,n)=>xg(new jx(t,e,n)),Wx=Eg((t=>(!1===t.geometry.hasAttribute("tangent")&&t.geometry.computeTangents(),j_("tangent","vec4"))))(),qx=Wx.xyz.toVar("tangentLocal"),Xx=ax.mul(Gg(qx,0)).xyz.varying("v_tangentView").normalize().toVar("tangentView"),Zx=t=>t.mul(Wx.w).xyz,$x=Xg(Xx,f_(Zx(xx.cross(Xx)),"v_bitangentView").normalize().toVar("bitangentView"),xx),Yx=(()=>{let t=xv.cross(fx);return t=t.cross(xv).normalize(),t=e_(t,wx,yv.mul(lv.oneMinus()).oneMinus().pow2().pow2()).normalize(),t})(),Kx=Eg((t=>{const{eye_pos:e,surf_norm:n,mapN:r,uv:i}=t,s=e.dFdx(),o=e.dFdy(),a=i.dFdx(),l=i.dFdy(),u=n,c=o.cross(u),h=u.cross(s),d=c.mul(a.x).add(h.mul(l.x)),p=c.mul(a.y).add(h.mul(l.y)),f=d.dot(d).max(p.dot(p)),m=gx.mul(f.inverseSqrt());return Uv(d.mul(r.x,m),p.mul(r.y,m),u.mul(r.z)).normalize()}));class Jx extends Bm{static get type(){return"NormalMapNode"}constructor(t,e=null){super("vec3"),this.node=t,this.scaleNode=e,this.normalMapType=0}setup(t){const{normalMapType:e,scaleNode:n}=this;let r=this.node.mul(2).sub(1);null!==n&&(r=Bg(r.xy.mul(n),r.z));let i=null;if(1===e)i=Tx(r);else if(0===e){i=!0===t.hasGeometryAttribute("tangent")?$x.mul(r).normalize():Kx({eye_pos:px,surf_norm:xx,mapN:r,uv:H_()})}return i}}const Qx=Sg(Jx),tb=Eg((({textureNode:t,bumpScale:e})=>{const n=e=>t.cache().context({getUV:t=>e(t.uvNode||H_()),forceUVContext:!0}),r=Ng(n((t=>t)));return Dg(Ng(n((t=>t.add(t.dFdx())))).sub(r),Ng(n((t=>t.add(t.dFdy())))).sub(r)).mul(e)})),eb=Eg((t=>{const{surf_pos:e,surf_norm:n,dHdxy:r}=t,i=e.dFdx().normalize(),s=n,o=e.dFdy().normalize().cross(s),a=s.cross(i),l=i.dot(o).mul(gx),u=l.sign().mul(r.x.mul(o).add(r.y.mul(a)));return l.abs().mul(n).sub(u).normalize()}));class nb extends Bm{static get type(){return"BumpMapNode"}constructor(t,e=null){super("vec3"),this.textureNode=t,this.scaleNode=e}setup(){const t=null!==this.scaleNode?this.scaleNode:1,e=tb({textureNode:this.textureNode,bumpScale:t});return eb({surf_pos:px,surf_norm:xx,dHdxy:e})}}const rb=Sg(nb),ib=new Map;class sb extends Lm{static get type(){return"MaterialNode"}constructor(t){super(),this.scope=t}getCache(t,e){let n=ib.get(t);return void 0===n&&(n=Hx(t,e),ib.set(t,n)),n}getFloat(t){return this.getCache(t,"float")}getColor(t){return this.getCache(t,"color")}getTexture(t){return this.getCache("map"===t?"map":t+"Map","texture")}setup(t){const e=t.context.material,n=this.scope;let r=null;if(n===sb.COLOR){const t=void 0!==e.color?this.getColor(n):Bg();r=e.map&&!0===e.map.isTexture?t.mul(this.getTexture("map")):t}else if(n===sb.OPACITY){const t=this.getFloat(n);r=e.alphaMap&&!0===e.alphaMap.isTexture?t.mul(this.getTexture("alpha")):t}else if(n===sb.SPECULAR_STRENGTH)r=e.specularMap&&!0===e.specularMap.isTexture?this.getTexture("specular").r:Ng(1);else if(n===sb.SPECULAR_INTENSITY){const t=this.getFloat(n);r=e.specularMap?t.mul(this.getTexture(n).a):t}else if(n===sb.SPECULAR_COLOR){const t=this.getColor(n);r=e.specularColorMap&&!0===e.specularColorMap.isTexture?t.mul(this.getTexture(n).rgb):t}else if(n===sb.ROUGHNESS){const t=this.getFloat(n);r=e.roughnessMap&&!0===e.roughnessMap.isTexture?t.mul(this.getTexture(n).g):t}else if(n===sb.METALNESS){const t=this.getFloat(n);r=e.metalnessMap&&!0===e.metalnessMap.isTexture?t.mul(this.getTexture(n).b):t}else if(n===sb.EMISSIVE){const t=this.getFloat("emissiveIntensity"),i=this.getColor(n).mul(t);r=e.emissiveMap&&!0===e.emissiveMap.isTexture?i.mul(this.getTexture(n)):i}else if(n===sb.NORMAL)e.normalMap?(r=Qx(this.getTexture("normal"),this.getCache("normalScale","vec2")),r.normalMapType=e.normalMapType):r=e.bumpMap?rb(this.getTexture("bump").r,this.getFloat("bumpScale")):xx;else if(n===sb.CLEARCOAT){const t=this.getFloat(n);r=e.clearcoatMap&&!0===e.clearcoatMap.isTexture?t.mul(this.getTexture(n).r):t}else if(n===sb.CLEARCOAT_ROUGHNESS){const t=this.getFloat(n);r=e.clearcoatRoughnessMap&&!0===e.clearcoatRoughnessMap.isTexture?t.mul(this.getTexture(n).r):t}else if(n===sb.CLEARCOAT_NORMAL)r=e.clearcoatNormalMap?Qx(this.getTexture(n),this.getCache(n+"Scale","vec2")):xx;else if(n===sb.SHEEN){const t=this.getColor("sheenColor").mul(this.getFloat("sheen"));r=e.sheenColorMap&&!0===e.sheenColorMap.isTexture?t.mul(this.getTexture("sheenColor").rgb):t}else if(n===sb.SHEEN_ROUGHNESS){const t=this.getFloat(n);r=e.sheenRoughnessMap&&!0===e.sheenRoughnessMap.isTexture?t.mul(this.getTexture(n).a):t,r=r.clamp(.07,1)}else if(n===sb.ANISOTROPY)if(e.anisotropyMap&&!0===e.anisotropyMap.isTexture){const t=this.getTexture(n);r=qg(zb.x,zb.y,zb.y.negate(),zb.x).mul(t.rg.mul(2).sub(Dg(1)).normalize().mul(t.b))}else r=zb;else if(n===sb.IRIDESCENCE_THICKNESS){const t=Vx("1","float",e.iridescenceThicknessRange);if(e.iridescenceThicknessMap){const i=Vx("0","float",e.iridescenceThicknessRange);r=t.sub(i).mul(this.getTexture(n).g).add(i)}else r=t}else if(n===sb.TRANSMISSION){const t=this.getFloat(n);r=e.transmissionMap?t.mul(this.getTexture(n).r):t}else if(n===sb.THICKNESS){const t=this.getFloat(n);r=e.thicknessMap?t.mul(this.getTexture(n).g):t}else if(n===sb.IOR)r=this.getFloat(n);else if(n===sb.LIGHT_MAP)r=this.getTexture(n).rgb.mul(this.getFloat("lightMapIntensity"));else if(n===sb.AO_MAP)r=this.getTexture(n).r.sub(1).mul(this.getFloat("aoMapIntensity")).add(1);else{const e=this.getNodeType(t);r=this.getCache(n,e)}return r}}sb.ALPHA_TEST="alphaTest",sb.COLOR="color",sb.OPACITY="opacity",sb.SHININESS="shininess",sb.SPECULAR="specular",sb.SPECULAR_STRENGTH="specularStrength",sb.SPECULAR_INTENSITY="specularIntensity",sb.SPECULAR_COLOR="specularColor",sb.REFLECTIVITY="reflectivity",sb.ROUGHNESS="roughness",sb.METALNESS="metalness",sb.NORMAL="normal",sb.CLEARCOAT="clearcoat",sb.CLEARCOAT_ROUGHNESS="clearcoatRoughness",sb.CLEARCOAT_NORMAL="clearcoatNormal",sb.EMISSIVE="emissive",sb.ROTATION="rotation",sb.SHEEN="sheen",sb.SHEEN_ROUGHNESS="sheenRoughness",sb.ANISOTROPY="anisotropy",sb.IRIDESCENCE="iridescence",sb.IRIDESCENCE_IOR="iridescenceIOR",sb.IRIDESCENCE_THICKNESS="iridescenceThickness",sb.IOR="ior",sb.TRANSMISSION="transmission",sb.THICKNESS="thickness",sb.ATTENUATION_DISTANCE="attenuationDistance",sb.ATTENUATION_COLOR="attenuationColor",sb.LINE_SCALE="scale",sb.LINE_DASH_SIZE="dashSize",sb.LINE_GAP_SIZE="gapSize",sb.LINE_WIDTH="linewidth",sb.LINE_DASH_OFFSET="dashOffset",sb.POINT_WIDTH="pointWidth",sb.DISPERSION="dispersion",sb.LIGHT_MAP="light",sb.AO_MAP="ao";const ob=Mg(sb,sb.ALPHA_TEST),ab=Mg(sb,sb.COLOR),lb=Mg(sb,sb.SHININESS),ub=Mg(sb,sb.EMISSIVE),cb=Mg(sb,sb.OPACITY),hb=Mg(sb,sb.SPECULAR),db=Mg(sb,sb.SPECULAR_INTENSITY),pb=Mg(sb,sb.SPECULAR_COLOR),fb=Mg(sb,sb.SPECULAR_STRENGTH),mb=Mg(sb,sb.REFLECTIVITY),gb=Mg(sb,sb.ROUGHNESS),vb=Mg(sb,sb.METALNESS),yb=Mg(sb,sb.NORMAL).context({getUV:null}),_b=Mg(sb,sb.CLEARCOAT),xb=Mg(sb,sb.CLEARCOAT_ROUGHNESS),bb=Mg(sb,sb.CLEARCOAT_NORMAL).context({getUV:null}),wb=Mg(sb,sb.ROTATION),Sb=Mg(sb,sb.SHEEN),Mb=Mg(sb,sb.SHEEN_ROUGHNESS),Eb=Mg(sb,sb.ANISOTROPY),Tb=Mg(sb,sb.IRIDESCENCE),Ab=Mg(sb,sb.IRIDESCENCE_IOR),Cb=Mg(sb,sb.IRIDESCENCE_THICKNESS),Rb=Mg(sb,sb.TRANSMISSION),Nb=Mg(sb,sb.THICKNESS),Pb=Mg(sb,sb.IOR),Ib=Mg(sb,sb.ATTENUATION_DISTANCE),Ob=Mg(sb,sb.ATTENUATION_COLOR),Db=Mg(sb,sb.LINE_SCALE),Lb=Mg(sb,sb.LINE_DASH_SIZE),Ub=Mg(sb,sb.LINE_GAP_SIZE),kb=(sb.LINE_WIDTH,sb.LINE_DASH_OFFSET,sb.POINT_WIDTH,Mg(sb,sb.DISPERSION)),Bb=Mg(sb,sb.LIGHT_MAP),Fb=Mg(sb,sb.AO_MAP),zb=nv(new oh).onReference((function(t){return t.material})).onRenderUpdate((function({material:t}){this.value.set(t.anisotropy*Math.cos(t.anisotropyRotation),t.anisotropy*Math.sin(t.anisotropyRotation))}));class Vb extends Bm{static get type(){return"ModelViewProjectionNode"}constructor(t=null){super("vec4"),this.positionNode=t}setup(t){if("fragment"===t.shaderStage)return f_(t.context.mvp);const e=this.positionNode||ux,n=t.renderer.nodes.modelViewMatrix||ax;return tx.mul(n).mul(e)}}const Gb=Sg(Vb);class jb extends Lm{static get type(){return"IndexNode"}constructor(t){super("uint"),this.scope=t,this.isInstanceIndexNode=!0}generate(t){const e=this.getNodeType(t),n=this.scope;let r,i;if(n===jb.VERTEX)r=t.getVertexIndex();else if(n===jb.INSTANCE)r=t.getInstanceIndex();else if(n===jb.DRAW)r=t.getDrawIndex();else if(n===jb.INVOCATION_LOCAL)r=t.getInvocationLocalIndex();else if(n===jb.INVOCATION_SUBGROUP)r=t.getInvocationSubgroupIndex();else{if(n!==jb.SUBGROUP)throw new Error("THREE.IndexNode: Unknown scope: "+n);r=t.getSubgroupIndex()}if("vertex"===t.shaderStage||"compute"===t.shaderStage)i=r;else{i=f_(this).build(t,e)}return i}}jb.VERTEX="vertex",jb.INSTANCE="instance",jb.SUBGROUP="subgroup",jb.INVOCATION_LOCAL="invocationLocal",jb.INVOCATION_SUBGROUP="invocationSubgroup",jb.DRAW="draw";const Hb=Mg(jb,jb.VERTEX),Wb=Mg(jb,jb.INSTANCE),qb=(jb.SUBGROUP,jb.INVOCATION_SUBGROUP,jb.INVOCATION_LOCAL,Mg(jb,jb.DRAW));class Xb extends Lm{static get type(){return"InstanceNode"}constructor(t){super("void"),this.instanceMesh=t,this.instanceMatrixNode=null,this.instanceColorNode=null,this.updateType=Cm,this.buffer=null,this.bufferColor=null}setup(t){let e=this.instanceMatrixNode,n=this.instanceColorNode;const r=this.instanceMesh;if(null===e){const t=r.instanceMatrix;if(r.count<=1e3)e=Lx(t.array,"mat4",Math.max(r.count,1)).element(Wb);else{const n=new pm(t.array,16,1);this.buffer=n;const r=t.usage===Wc?N_:R_,i=[r(n,"vec4",16,0),r(n,"vec4",16,4),r(n,"vec4",16,8),r(n,"vec4",16,12)];e=Zg(...i)}this.instanceMatrixNode=e}const i=r.instanceColor;if(i&&null===n){const t=new tf(i.array,3),e=i.usage===Wc?N_:R_;this.bufferColor=t,n=Bg(e(t,"vec3",3,0)),this.instanceColorNode=n}const s=e.mul(ux).xyz;if(ux.assign(s),t.hasGeometryAttribute("normal")){const t=Ex(yx,e);yx.assign(t)}null!==this.instanceColorNode&&sv("vec3","vInstanceColor").assign(this.instanceColorNode)}update(){this.instanceMesh.instanceMatrix.usage!==Wc&&null!=this.buffer&&this.instanceMesh.instanceMatrix.version!==this.buffer.version&&(this.buffer.version=this.instanceMesh.instanceMatrix.version),this.instanceMesh.instanceColor&&this.instanceMesh.instanceColor.usage!==Wc&&null!=this.bufferColor&&this.instanceMesh.instanceColor.version!==this.bufferColor.version&&(this.bufferColor.version=this.instanceMesh.instanceColor.version)}}const Zb=Sg(Xb);class $b extends Lm{static get type(){return"BatchNode"}constructor(t){super("void"),this.batchMesh=t,this.batchingIdNode=null}setup(t){null===this.batchingIdNode&&(null===t.getDrawIndex()?this.batchingIdNode=Wb:this.batchingIdNode=qb);const e=Eg((([t])=>{const e=q_(K_(this.batchMesh._indirectTexture),0),n=Pg(t).modInt(Pg(e)),r=Pg(t).div(Pg(e));return K_(this.batchMesh._indirectTexture,Lg(n,r)).x})).setLayout({name:"getIndirectIndex",type:"uint",inputs:[{name:"id",type:"int"}]}),n=e(Pg(this.batchingIdNode)),r=this.batchMesh._matricesTexture,i=q_(K_(r),0),s=Ng(n).mul(4).toInt().toVar(),o=s.modInt(i),a=s.div(Pg(i)),l=Zg(K_(r,Lg(o,a)),K_(r,Lg(o.add(1),a)),K_(r,Lg(o.add(2),a)),K_(r,Lg(o.add(3),a))),u=this.batchMesh._colorsTexture;if(null!==u){const t=Eg((([t])=>{const e=q_(K_(u),0).x,n=t,r=n.modInt(e),i=n.div(e);return K_(u,Lg(r,i)).rgb})).setLayout({name:"getBatchingColor",type:"vec3",inputs:[{name:"id",type:"int"}]}),e=t(n);sv("vec3","vBatchColor").assign(e)}const c=Xg(l);ux.assign(l.mul(ux));const h=yx.div(Bg(c[0].dot(c[0]),c[1].dot(c[1]),c[2].dot(c[2]))),d=c.mul(h).xyz;yx.assign(d),t.hasGeometryAttribute("tangent")&&qx.mulAssign(c)}}const Yb=Sg($b),Kb=new WeakMap;class Jb extends Lm{static get type(){return"SkinningNode"}constructor(t,e=!1){let n,r,i;super("void"),this.skinnedMesh=t,this.useReference=e,this.updateType=Nm,this.skinIndexNode=j_("skinIndex","uvec4"),this.skinWeightNode=j_("skinWeight","vec4"),e?(n=Vx("bindMatrix","mat4"),r=Vx("bindMatrixInverse","mat4"),i=Gx("skeleton.boneMatrices","mat4",t.skeleton.bones.length)):(n=nv(t.bindMatrix,"mat4"),r=nv(t.bindMatrixInverse,"mat4"),i=Lx(t.skeleton.boneMatrices,"mat4",t.skeleton.bones.length)),this.bindMatrixNode=n,this.bindMatrixInverseNode=r,this.boneMatricesNode=i,this.previousBoneMatricesNode=null}getSkinnedPosition(t=this.boneMatricesNode,e=ux){const{skinIndexNode:n,skinWeightNode:r,bindMatrixNode:i,bindMatrixInverseNode:s}=this,o=t.element(n.x),a=t.element(n.y),l=t.element(n.z),u=t.element(n.w),c=i.mul(e),h=Uv(o.mul(r.x).mul(c),a.mul(r.y).mul(c),l.mul(r.z).mul(c),u.mul(r.w).mul(c));return s.mul(h).xyz}getSkinnedNormal(t=this.boneMatricesNode,e=yx){const{skinIndexNode:n,skinWeightNode:r,bindMatrixNode:i,bindMatrixInverseNode:s}=this,o=t.element(n.x),a=t.element(n.y),l=t.element(n.z),u=t.element(n.w);let c=Uv(r.x.mul(o),r.y.mul(a),r.z.mul(l),r.w.mul(u));return c=s.mul(c).mul(i),c.transformDirection(e).xyz}getPreviousSkinnedPosition(t){const e=t.object;return null===this.previousBoneMatricesNode&&(e.skeleton.previousBoneMatrices=new Float32Array(e.skeleton.boneMatrices),this.previousBoneMatricesNode=Gx("skeleton.previousBoneMatrices","mat4",e.skeleton.bones.length)),this.getSkinnedPosition(this.previousBoneMatricesNode,cx)}needsPreviousBoneMatrices(t){const e=t.renderer.getMRT();return e&&e.has("velocity")}setup(t){this.needsPreviousBoneMatrices(t)&&cx.assign(this.getPreviousSkinnedPosition(t));const e=this.getSkinnedPosition();if(ux.assign(e),t.hasGeometryAttribute("normal")){const e=this.getSkinnedNormal();yx.assign(e),t.hasGeometryAttribute("tangent")&&qx.assign(e)}}generate(t,e){if("void"!==e)return ux.build(t,e)}update(t){const e=(this.useReference?t.object:this.skinnedMesh).skeleton;Kb.get(e)!==t.frameId&&(Kb.set(e,t.frameId),null!==this.previousBoneMatricesNode&&e.previousBoneMatrices.set(e.boneMatrices),e.update())}}class Qb extends Lm{static get type(){return"LoopNode"}constructor(t=[]){super(),this.params=t}getVarName(t){return String.fromCharCode("i".charCodeAt()+t)}getProperties(t){const e=t.getNodeProperties(this);if(void 0!==e.stackNode)return e;const n={};for(let t=0,e=this.params.length-1;t<e;t++){const e=this.params[t],r=!0!==e.isNode&&e.name||this.getVarName(t),i=!0!==e.isNode&&e.type||"int";n[r]=F_(r,i)}const r=t.addStack();return e.returnsNode=this.params[this.params.length-1](n,r,t),e.stackNode=r,t.removeStack(),e}getNodeType(t){const{returnsNode:e}=this.getProperties(t);return e?e.getNodeType(t):"void"}setup(t){this.getProperties(t)}generate(t){const e=this.getProperties(t),n=this.params,r=e.stackNode;for(let e=0,r=n.length-1;e<r;e++){const r=n[e];let i=null,s=null,o=null,a=null,l=null,u=null;r.isNode?(a="int",o=this.getVarName(e),i="0",s=r.build(t,a),l="<"):(a=r.type||"int",o=r.name||this.getVarName(e),i=r.start,s=r.end,l=r.condition,u=r.update,"number"==typeof i?i=t.generateConst(a,i):i&&i.isNode&&(i=i.build(t,a)),"number"==typeof s?s=t.generateConst(a,s):s&&s.isNode&&(s=s.build(t,a)),void 0!==i&&void 0===s?(i+=" - 1",s="0",l=">="):void 0!==s&&void 0===i&&(i="0",l="<"),void 0===l&&(l=Number(i)>Number(s)?">=":"<"));const c={start:i,end:s,condition:l},h=c.start,d=c.end;let p="",f="",m="";u||(u="int"===a||"uint"===a?l.includes("<")?"++":"--":l.includes("<")?"+= 1.":"-= 1."),p+=t.getVar(a,o)+" = "+h,f+=o+" "+l+" "+d,m+=o+" "+u;const g=`for ( ${p}; ${f}; ${m} )`;t.addFlowCode((0===e?"\n":"")+t.tab+g+" {\n\n").addFlowTab()}const i=r.build(t,"void"),s=e.returnsNode?e.returnsNode.build(t):"";t.removeFlowTab().addFlowCode("\n"+t.tab+i);for(let e=0,n=this.params.length-1;e<n;e++)t.addFlowCode((0===e?"":t.tab)+"}\n\n").removeFlowTab();return t.addFlowTab(),s}}const tw=(...t)=>xg(new Qb(wg(t,"int"))).append(),ew=()=>F_("break").append(),nw=new WeakMap,rw=new Th,iw=Eg((({bufferMap:t,influence:e,stride:n,width:r,depth:i,offset:s})=>{const o=Pg(Hb).mul(n).add(s),a=o.div(r),l=o.sub(a.mul(r));return K_(t,Lg(l,a)).depth(i).mul(e)}));class sw extends Lm{static get type(){return"MorphNode"}constructor(t){super("void"),this.mesh=t,this.morphBaseInfluence=nv(1),this.updateType=Nm}setup(t){const{geometry:e}=t,n=void 0!==e.morphAttributes.position,r=e.hasAttribute("normal")&&void 0!==e.morphAttributes.normal,i=e.morphAttributes.position||e.morphAttributes.normal||e.morphAttributes.color,s=void 0!==i?i.length:0,{texture:o,stride:a,size:l}=function(t){const e=void 0!==t.morphAttributes.position,n=void 0!==t.morphAttributes.normal,r=void 0!==t.morphAttributes.color,i=t.morphAttributes.position||t.morphAttributes.normal||t.morphAttributes.color,s=void 0!==i?i.length:0;let o=nw.get(t);if(void 0===o||o.count!==s){void 0!==o&&o.texture.dispose();const a=t.morphAttributes.position||[],l=t.morphAttributes.normal||[],u=t.morphAttributes.color||[];let c=0;!0===e&&(c=1),!0===n&&(c=2),!0===r&&(c=3);let h=t.attributes.position.count*c,d=1;const p=4096;h>p&&(d=Math.ceil(h/p),h=p);const f=new Float32Array(h*d*4*s),m=new Rh(f,h,d,s);m.type=Qu,m.needsUpdate=!0;const g=4*c;for(let y=0;y<s;y++){const _=a[y],x=l[y],b=u[y],w=h*d*4*y;for(let S=0;S<_.count;S++){const M=S*g;!0===e&&(rw.fromBufferAttribute(_,S),f[w+M+0]=rw.x,f[w+M+1]=rw.y,f[w+M+2]=rw.z,f[w+M+3]=0),!0===n&&(rw.fromBufferAttribute(x,S),f[w+M+4]=rw.x,f[w+M+5]=rw.y,f[w+M+6]=rw.z,f[w+M+7]=0),!0===r&&(rw.fromBufferAttribute(b,S),f[w+M+8]=rw.x,f[w+M+9]=rw.y,f[w+M+10]=rw.z,f[w+M+11]=4===b.itemSize?rw.w:1)}}function v(){m.dispose(),nw.delete(t),t.removeEventListener("dispose",v)}o={count:s,texture:m,stride:c,size:new oh(h,d)},nw.set(t,o),t.addEventListener("dispose",v)}return o}(e);!0===n&&ux.mulAssign(this.morphBaseInfluence),!0===r&&yx.mulAssign(this.morphBaseInfluence);const u=Pg(l.width);tw(s,(({i:t})=>{const e=Ng(0).toVar();this.mesh.count>1&&null!==this.mesh.morphTexture&&void 0!==this.mesh.morphTexture?e.assign(K_(this.mesh.morphTexture,Lg(Pg(t).add(1),Pg(Wb))).r):e.assign(Vx("morphTargetInfluences","float").element(t).toVar()),!0===n&&ux.addAssign(iw({bufferMap:o,influence:e,stride:a,width:u,depth:t,offset:Pg(0)})),!0===r&&yx.addAssign(iw({bufferMap:o,influence:e,stride:a,width:u,depth:t,offset:Pg(1)}))}))}update(){const t=this.morphBaseInfluence;this.mesh.geometry.morphTargetsRelative?t.value=1:t.value=1-this.mesh.morphTargetInfluences.reduce(((t,e)=>t+e),0)}}const ow=Sg(sw);class aw extends Lm{static get type(){return"LightingNode"}constructor(){super("vec3"),this.isLightingNode=!0}generate(){console.warn("Abstract function.")}}class lw extends aw{static get type(){return"AONode"}constructor(t=null){super(),this.aoNode=t}setup(t){t.context.ambientOcclusion.mulAssign(this.aoNode)}}class uw extends u_{static get type(){return"LightingContextNode"}constructor(t,e=null,n=null,r=null){super(t),this.lightingModel=e,this.backdropNode=n,this.backdropAlphaNode=r,this._value=null}getContext(){const{backdropNode:t,backdropAlphaNode:e}=this,n={directDiffuse:Bg().toVar("directDiffuse"),directSpecular:Bg().toVar("directSpecular"),indirectDiffuse:Bg().toVar("indirectDiffuse"),indirectSpecular:Bg().toVar("indirectSpecular")};return{radiance:Bg().toVar("radiance"),irradiance:Bg().toVar("irradiance"),iblIrradiance:Bg().toVar("iblIrradiance"),ambientOcclusion:Ng(1).toVar("ambientOcclusion"),reflectedLight:n,backdrop:t,backdropAlpha:e}}setup(t){return this.value=this._value||(this._value=this.getContext()),this.value.lightingModel=this.lightingModel||t.context.lightingModel,super.setup(t)}}const cw=Sg(uw);class hw extends aw{static get type(){return"IrradianceNode"}constructor(t){super(),this.node=t}setup(t){t.context.irradiance.addAssign(this.node)}}let dw,pw;class fw extends Lm{static get type(){return"ScreenNode"}constructor(t){super(),this.scope=t,this.isViewportNode=!0}getNodeType(){return this.scope===fw.VIEWPORT?"vec4":"vec2"}getUpdateType(){let t=Am;return this.scope!==fw.SIZE&&this.scope!==fw.VIEWPORT||(t=Rm),this.updateType=t,t}update({renderer:t}){const e=t.getRenderTarget();this.scope===fw.VIEWPORT?null!==e?pw.copy(e.viewport):(t.getViewport(pw),pw.multiplyScalar(t.getPixelRatio())):null!==e?(dw.width=e.width,dw.height=e.height):t.getDrawingBufferSize(dw)}setup(){const t=this.scope;let e=null;return e=t===fw.SIZE?nv(dw||(dw=new oh)):t===fw.VIEWPORT?nv(pw||(pw=new Th)):Dg(vw.div(gw)),e}generate(t){if(this.scope===fw.COORDINATE){let e=t.getFragCoord();if(t.isFlipY()){const n=t.getNodeProperties(gw).outputNode.build(t);e=`${t.getType("vec2")}( ${e}.x, ${n}.y - ${e}.y )`}return e}return super.generate(t)}}fw.COORDINATE="coordinate",fw.VIEWPORT="viewport",fw.SIZE="size",fw.UV="uv";const mw=Mg(fw,fw.UV),gw=Mg(fw,fw.SIZE),vw=Mg(fw,fw.COORDINATE),yw=Mg(fw,fw.VIEWPORT),_w=(yw.zw,yw.xy,new oh);class xw extends $_{static get type(){return"ViewportTextureNode"}constructor(t=mw,e=null,n=null){null===n&&((n=new hf).minFilter=qu),super(n,t,e),this.generateMipmaps=!1,this.isOutputTextureNode=!0,this.updateBeforeType=Cm}updateBefore(t){const e=t.renderer;e.getDrawingBufferSize(_w);const n=this.value;n.image.width===_w.width&&n.image.height===_w.height||(n.image.width=_w.width,n.image.height=_w.height,n.needsUpdate=!0);const r=n.generateMipmaps;n.generateMipmaps=this.generateMipmaps,e.copyFramebufferToTexture(n),n.generateMipmaps=r}clone(){const t=new this.constructor(this.uvNode,this.levelNode,this.value);return t.generateMipmaps=this.generateMipmaps,t}}const bw=Sg(xw,null,null,{generateMipmaps:!0});let ww=null;class Sw extends xw{static get type(){return"ViewportDepthTextureNode"}constructor(t=mw,e=null){null===ww&&(ww=new df),super(t,e,ww)}}const Mw=Sg(Sw);class Ew extends Lm{static get type(){return"ViewportDepthNode"}constructor(t,e=null){super("float"),this.scope=t,this.valueNode=e,this.isViewportDepthNode=!0}generate(t){const{scope:e}=this;return e===Ew.DEPTH_BASE?t.getFragDepth():super.generate(t)}setup({camera:t}){const{scope:e}=this,n=this.valueNode;let r=null;if(e===Ew.DEPTH_BASE)null!==n&&(r=Nw().assign(n));else if(e===Ew.DEPTH)r=t.isPerspectiveCamera?Aw(px.z,J_,Q_):Tw(px.z,J_,Q_);else if(e===Ew.LINEAR_DEPTH)if(null!==n)if(t.isPerspectiveCamera){const t=Cw(n,J_,Q_);r=Tw(t,J_,Q_)}else r=n;else r=Tw(px.z,J_,Q_);return r}}Ew.DEPTH_BASE="depthBase",Ew.DEPTH="depth",Ew.LINEAR_DEPTH="linearDepth";const Tw=(t,e,n)=>t.add(e).div(e.sub(n)),Aw=(t,e,n)=>e.add(t).mul(n).div(n.sub(e).mul(t)),Cw=(t,e,n)=>e.mul(n).div(n.sub(e).mul(t).sub(n)),Rw=(t,e,n)=>{e=e.max(1e-6).toVar();const r=fy(t.div(e).add(1)),i=fy(n.div(e).add(1));return r.div(i)},Nw=Sg(Ew,Ew.DEPTH_BASE),Pw=Mg(Ew,Ew.DEPTH),Iw=Sg(Ew,Ew.LINEAR_DEPTH);Mw();Pw.assign=t=>Nw(t);class Ow extends Lm{static get type(){return"ClippingNode"}constructor(t=Ow.DEFAULT){super(),this.scope=t}setup(t){super.setup(t);const e=t.clippingContext,{localClipIntersection:n,localClippingCount:r,globalClippingCount:i}=e,s=i+r,o=n?s-r:s;return this.scope===Ow.ALPHA_TO_COVERAGE?this.setupAlphaToCoverage(e.planes,s,o):this.setupDefault(e.planes,s,o)}setupAlphaToCoverage(t,e,n){return Eg((()=>{const r=Bx(t),i=iv("float","distanceToPlane"),s=iv("float","distanceToGradient"),o=iv("float","clipOpacity");let a;if(o.assign(1),tw(n,(({i:t})=>{a=r.element(t),i.assign(px.dot(a.xyz).negate().add(a.w)),s.assign(i.fwidth().div(2)),o.mulAssign(i_(s.negate(),s,i)),o.equal(0).discard()})),n<e){const t=iv("float","unionclipOpacity");t.assign(1),tw({start:n,end:e},(({i:e})=>{a=r.element(e),i.assign(px.dot(a.xyz).negate().add(a.w)),s.assign(i.fwidth().div(2)),t.mulAssign(i_(s.negate(),s,i).oneMinus())})),o.mulAssign(t.oneMinus())}ov.a.mulAssign(o),ov.a.equal(0).discard()}))()}setupDefault(t,e,n){return Eg((()=>{const r=Bx(t);let i;if(tw(n,(({i:t})=>{i=r.element(t),px.dot(i.xyz).greaterThan(i.w).discard()})),n<e){const t=iv("bool","clipped");t.assign(!0),tw({start:n,end:e},(({i:e})=>{i=r.element(e),t.assign(px.dot(i.xyz).greaterThan(i.w).and(t))})),t.discard()}}))()}}Ow.ALPHA_TO_COVERAGE="alphaToCoverage",Ow.DEFAULT="default";const Dw=Eg((([t])=>xy(Bv(1e4,by(Bv(17,t.x).add(Bv(.1,t.y)))).mul(Uv(.1,Ay(by(Bv(13,t.y).add(t.x)))))))),Lw=Eg((([t])=>Dw(Dg(Dw(t.xy),t.z)))),Uw=Eg((([t])=>{const e=Vy(Ry(Iy(t.xyz)),Ry(Oy(t.xyz))).toVar("maxDeriv"),n=Ng(1).div(Ng(.05).mul(e)).toVar("pixScale"),r=Dg(dy(vy(fy(n))),dy(yy(fy(n)))).toVar("pixScales"),i=Dg(Lw(vy(r.x.mul(t.xyz))),Lw(vy(r.y.mul(t.xyz)))).toVar("alpha"),s=xy(fy(n)).toVar("lerpFactor"),o=Uv(Bv(s.oneMinus(),i.x),Bv(s,i.y)).toVar("x"),a=zy(s,s.oneMinus()).toVar("a"),l=Bg(o.mul(o).div(Bv(2,a).mul(kv(1,a))),o.sub(Bv(.5,a)).div(kv(1,a)),kv(1,kv(1,o).mul(kv(1,o)).div(Bv(2,a).mul(kv(1,a))))).toVar("cases"),u=o.lessThan(a.oneMinus()).select(o.lessThan(a).select(l.x,l.y),l.z);return n_(u,1e-6,1)}));class kw extends np{static get type(){return"NodeMaterial"}constructor(){super(),this.isNodeMaterial=!0,this.type=this.constructor.type,this.forceSinglePass=!1,this.fog=!0,this.lights=!1,this.lightsNode=null,this.envNode=null,this.aoNode=null,this.colorNode=null,this.normalNode=null,this.opacityNode=null,this.backdropNode=null,this.backdropAlphaNode=null,this.alphaTestNode=null,this.positionNode=null,this.geometryNode=null,this.depthNode=null,this.shadowNode=null,this.shadowPositionNode=null,this.outputNode=null,this.mrtNode=null,this.fragmentNode=null,this.vertexNode=null}customProgramCacheKey(){return this.type+xm(this)}build(t){this.setup(t)}setupObserver(t){return new mm(t)}setup(t){let e;t.context.setupNormal=()=>this.setupNormal(t),t.addStack(),t.stack.outputNode=this.vertexNode||this.setupPosition(t),null!==this.geometryNode&&(t.stack.outputNode=t.stack.outputNode.bypass(this.geometryNode)),t.addFlow("vertex",t.removeStack()),t.addStack();const n=this.setupClipping(t);if(!0===this.depthWrite&&this.setupDepth(t),null===this.fragmentNode){this.setupDiffuseColor(t),this.setupVariants(t);const r=this.setupLighting(t);null!==n&&t.stack.add(n);const i=Gg(r,ov.a).max(0);e=this.setupOutput(t,i),Mv.assign(e),null!==this.outputNode&&(e=this.outputNode);if(null!==t.renderer.getRenderTarget()){const n=t.renderer.getMRT(),r=this.mrtNode;null!==n?(e=n,null!==r&&(e=n.merge(r))):null!==r&&(e=r)}}else{let n=this.fragmentNode;!0!==n.isOutputStructNode&&(n=Gg(n)),e=this.setupOutput(t,n)}t.stack.outputNode=e,t.addFlow("fragment",t.removeStack()),t.monitor=this.setupObserver(t)}setupClipping(t){if(null===t.clippingContext)return null;const{globalClippingCount:e,localClippingCount:n}=t.clippingContext;let r=null;if(e||n){const e=t.renderer.samples;this.alphaToCoverage&&e>1?r=xg(new Ow(Ow.ALPHA_TO_COVERAGE)):t.stack.add(xg(new Ow))}return r}setupDepth(t){const{renderer:e,camera:n}=t;let r=this.depthNode;if(null===r){const t=e.getMRT();t&&t.has("depth")?r=t.get("depth"):!0===e.logarithmicDepthBuffer&&(r=n.isPerspectiveCamera?Rw(Gb().w,J_,Q_):Tw(px.z,J_,Q_))}null!==r&&Pw.assign(r).append()}setupPosition(t){const{object:e}=t,n=e.geometry;var r;if(t.addStack(),(n.morphAttributes.position||n.morphAttributes.normal||n.morphAttributes.color)&&ow(e).append(),!0===e.isSkinnedMesh&&(r=e,xg(new Jb(r,!0))).append(),this.displacementMap){const t=Hx("displacementMap","texture"),e=Hx("displacementScale","float"),n=Hx("displacementBias","float");ux.addAssign(yx.normalize().mul(t.x.mul(e).add(n)))}e.isBatchedMesh&&Yb(e).append(),e.instanceMatrix&&!0===e.instanceMatrix.isInstancedBufferAttribute&&Zb(e).append(),null!==this.positionNode&&ux.assign(this.positionNode);const i=Gb();return t.context.vertex=t.removeStack(),t.context.mvp=i,i}setupDiffuseColor({object:t,geometry:e}){let n=this.colorNode?Gg(this.colorNode):ab;if(!0===this.vertexColors&&e.hasAttribute("color")&&(n=Gg(n.xyz.mul(j_("color","vec3")),n.a)),t.instanceColor){n=sv("vec3","vInstanceColor").mul(n)}if(t.isBatchedMesh&&t._colorsTexture){n=sv("vec3","vBatchColor").mul(n)}ov.assign(n);const r=this.opacityNode?Ng(this.opacityNode):cb;if(ov.a.assign(ov.a.mul(r)),null!==this.alphaTestNode||this.alphaTest>0){const t=null!==this.alphaTestNode?Ng(this.alphaTestNode):ob;ov.a.lessThanEqual(t).discard()}!0===this.alphaHash&&ov.a.lessThan(Uw(ux)).discard(),!1===this.transparent&&1===this.blending&&!1===this.alphaToCoverage&&ov.a.assign(1)}setupVariants(){}setupOutgoingLight(){return!0===this.lights?Bg(0):ov.rgb}setupNormal(){return this.normalNode?Bg(this.normalNode):yb}setupEnvironment(){let t=null;return this.envNode?t=this.envNode:this.envMap&&(t=this.envMap.isCubeTexture?Hx("envMap","cubeTexture"):Hx("envMap","texture")),t}setupLightMap(t){let e=null;return t.material.lightMap&&(e=new hw(Bb)),e}setupLights(t){const e=[],n=this.setupEnvironment(t);n&&n.isLightingNode&&e.push(n);const r=this.setupLightMap(t);if(r&&r.isLightingNode&&e.push(r),null!==this.aoNode||t.material.aoMap){const t=null!==this.aoNode?this.aoNode:Fb;e.push(new lw(t))}let i=this.lightsNode||t.lightsNode;return e.length>0&&(i=t.renderer.lighting.createNode([...i.getLights(),...e])),i}setupLightingModel(){}setupLighting(t){const{material:e}=t,{backdropNode:n,backdropAlphaNode:r,emissiveNode:i}=this,s=!0===this.lights||null!==this.lightsNode?this.setupLights(t):null;let o=this.setupOutgoingLight(t);if(s&&s.getScope().hasLights){const e=this.setupLightingModel(t);o=cw(s,e,n,r)}else null!==n&&(o=Bg(null!==r?e_(o,n,r):n));return(i&&!0===i.isNode||e.emissive&&!0===e.emissive.isColor)&&(av.assign(Bg(i||ub)),o=o.add(av)),o}setupOutput(t,e){if(!0===this.fog){const n=t.fogNode;n&&(e=Gg(n.mix(e.rgb,n.colorNode),e.a))}return e}setDefaultValues(t){for(const e in t){const n=t[e];void 0===this[e]&&(this[e]=n,n&&n.clone&&(this[e]=n.clone()))}const e=Object.getOwnPropertyDescriptors(t.constructor.prototype);for(const t in e)void 0===Object.getOwnPropertyDescriptor(this.constructor.prototype,t)&&void 0!==e[t].get&&Object.defineProperty(this.constructor.prototype,t,e[t])}toJSON(t){const e=void 0===t||"string"==typeof t;e&&(t={textures:{},images:{},nodes:{}});const n=np.prototype.toJSON.call(this,t),r=bm(this);n.inputNodes={};for(const{property:e,childNode:i}of r)n.inputNodes[e]=i.toJSON(t).uuid;function i(t){const e=[];for(const n in t){const r=t[n];delete r.metadata,e.push(r)}return e}if(e){const e=i(t.textures),r=i(t.images),s=i(t.nodes);e.length>0&&(n.textures=e),r.length>0&&(n.images=r),s.length>0&&(n.nodes=s)}return n}copy(t){return this.lightsNode=t.lightsNode,this.envNode=t.envNode,this.colorNode=t.colorNode,this.normalNode=t.normalNode,this.opacityNode=t.opacityNode,this.backdropNode=t.backdropNode,this.backdropAlphaNode=t.backdropAlphaNode,this.alphaTestNode=t.alphaTestNode,this.positionNode=t.positionNode,this.geometryNode=t.geometryNode,this.depthNode=t.depthNode,this.shadowNode=t.shadowNode,this.shadowPositionNode=t.shadowPositionNode,this.outputNode=t.outputNode,this.mrtNode=t.mrtNode,this.fragmentNode=t.fragmentNode,this.vertexNode=t.vertexNode,super.copy(t)}}const Bw=new uf;class Fw extends kw{static get type(){return"LineBasicNodeMaterial"}constructor(t){super(),this.isLineBasicNodeMaterial=!0,this.lights=!1,this.setDefaultValues(Bw),this.setValues(t)}}const zw=new wf;class Vw extends kw{static get type(){return"LineDashedNodeMaterial"}constructor(t){super(),this.isLineDashedNodeMaterial=!0,this.lights=!1,this.setDefaultValues(zw),this.offsetNode=null,this.dashScaleNode=null,this.dashSizeNode=null,this.gapSizeNode=null,this.setValues(t)}setupVariants(){const t=this.offsetNode,e=this.dashScaleNode?Ng(this.dashScaleNode):Db,n=this.dashSizeNode?Ng(this.dashSizeNode):Lb,r=this.dashSizeNode?Ng(this.dashGapNode):Ub;Ev.assign(n),Tv.assign(r);const i=f_(j_("lineDistance").mul(e));(t?i.add(t):i).mod(Ev.add(Tv)).greaterThan(Ev).discard()}}const Gw=new _f;class jw extends kw{static get type(){return"MeshNormalNodeMaterial"}constructor(t){super(),this.lights=!1,this.isMeshNormalNodeMaterial=!0,this.setDefaultValues(Gw),this.setValues(t)}setupDiffuseColor(){const t=this.opacityNode?Ng(this.opacityNode):cb;ov.assign(Gg(xg(wx).mul(.5).add(.5),t))}}class Hw extends Bm{static get type(){return"EquirectUVNode"}constructor(t=dx){super("vec2"),this.dirNode=t}setup(){const t=this.dirNode,e=t.z.atan2(t.x).mul(1/(2*Math.PI)).add(.5),n=t.y.clamp(-1,1).asin().mul(1/Math.PI).add(.5);return Dg(e,n)}}const Ww=Sg(Hw);class qw extends Xp{constructor(t=1,e={}){super(t,e),this.isCubeRenderTarget=!0}fromEquirectangularTexture(t,e){const n=e.minFilter,r=e.generateMipmaps;e.generateMipmaps=!0,this.texture.type=e.type,this.texture.colorSpace=e.colorSpace,this.texture.generateMipmaps=e.generateMipmaps,this.texture.minFilter=e.minFilter,this.texture.magFilter=e.magFilter;const i=new Up(5,5,5),s=Ww(dx),o=new kw;o.colorNode=Y_(e,s,0),o.side=1,o.blending=0;const a=new Dp(i,o),l=new Zp;l.add(a),e.minFilter===qu&&(e.minFilter=Hu);const u=new Wp(1,10,this),c=t.getMRT();return t.setMRT(null),u.update(t,l),t.setMRT(c),e.minFilter=n,e.currentGenerateMipmaps=r,a.geometry.dispose(),a.material.dispose(),this}}const Xw=new WeakMap;class Zw extends Bm{static get type(){return"CubeMapNode"}constructor(t){super("vec3"),this.envNode=t,this._cubeTexture=null,this._cubeTextureNode=Ox();const e=new qp;e.isRenderTargetTexture=!0,this._defaultTexture=e,this.updateBeforeType=Rm}updateBefore(t){const{renderer:e,material:n}=t,r=this.envNode;if(r.isTextureNode||r.isMaterialReferenceNode){const t=r.isTextureNode?r.value:n[r.property];if(t&&t.isTexture){const n=t.mapping;if(n===Lu||n===Uu){if(Xw.has(t)){const e=Xw.get(t);Yw(e,t.mapping),this._cubeTexture=e}else{const n=t.image;if(function(t){return null!=t&&t.height>0}(n)){const r=new qw(n.height);r.fromEquirectangularTexture(e,t),Yw(r.texture,t.mapping),this._cubeTexture=r.texture,Xw.set(t,r.texture),t.addEventListener("dispose",$w)}else this._cubeTexture=this._defaultTexture}this._cubeTextureNode.value=this._cubeTexture}else this._cubeTextureNode=this.envNode}}}setup(t){return this.updateBefore(t),this._cubeTextureNode}}function $w(t){const e=t.target;e.removeEventListener("dispose",$w);const n=Xw.get(e);void 0!==n&&(Xw.delete(e),n.dispose())}function Yw(t,e){e===Lu?t.mapping=Ou:e===Uu&&(t.mapping=Du)}const Kw=Sg(Zw);class Jw extends aw{static get type(){return"BasicEnvironmentNode"}constructor(t=null){super(),this.envNode=t}setup(t){t.context.environment=Kw(this.envNode)}}class Qw extends aw{static get type(){return"BasicLightMapNode"}constructor(t=null){super(),this.lightMapNode=t}setup(t){const e=Ng(1/Math.PI);t.context.irradianceLightMap=this.lightMapNode.mul(e)}}class tS{start(){}finish(){}direct(){}directRectArea(){}indirect(){}ambientOcclusion(){}}class eS extends tS{constructor(){super()}indirect(t,e,n){const r=t.ambientOcclusion,i=t.reflectedLight,s=n.context.irradianceLightMap;i.indirectDiffuse.assign(Gg(0)),s?i.indirectDiffuse.addAssign(s):i.indirectDiffuse.addAssign(Gg(1,1,1,0)),i.indirectDiffuse.mulAssign(r),i.indirectDiffuse.mulAssign(ov.rgb)}finish(t,e,n){const r=n.material,i=t.outgoingLight,s=n.context.environment;if(s)switch(r.combine){case 0:i.rgb.assign(e_(i.rgb,i.rgb.mul(s.rgb),fb.mul(mb)));break;case 1:i.rgb.assign(e_(i.rgb,s.rgb,fb.mul(mb)));break;case 2:i.rgb.addAssign(s.rgb.mul(fb.mul(mb)));break;default:console.warn("THREE.BasicLightingModel: Unsupported .combine value:",r.combine)}}}const nS=new rp;class rS extends kw{static get type(){return"MeshBasicNodeMaterial"}constructor(t){super(),this.isMeshBasicNodeMaterial=!0,this.lights=!0,this.setDefaultValues(nS),this.setValues(t)}setupNormal(){return xx}setupEnvironment(t){const e=super.setupEnvironment(t);return e?new Jw(e):null}setupLightMap(t){let e=null;return t.material.lightMap&&(e=new Qw(Bb)),e}setupOutgoingLight(){return ov.rgb}setupLightingModel(){return new eS}}const iS=Eg((({f0:t,f90:e,dotVH:n})=>{const r=n.mul(-5.55473).sub(6.98316).mul(n).exp2();return t.mul(r.oneMinus()).add(e.mul(r))})),sS=Eg((t=>t.diffuseColor.mul(1/Math.PI))),oS=Eg((({dotNH:t})=>Sv.mul(Ng(.5)).add(1).mul(Ng(1/Math.PI)).mul(t.pow(Sv)))),aS=Eg((({lightDirection:t})=>{const e=t.add(fx).normalize(),n=wx.dot(e).clamp(),r=fx.dot(e).clamp(),i=iS({f0:bv,f90:1,dotVH:r}),s=Ng(.25),o=oS({dotNH:n});return i.mul(s).mul(o)}));class lS extends eS{constructor(t=!0){super(),this.specular=t}direct({lightDirection:t,lightColor:e,reflectedLight:n}){const r=wx.dot(t).clamp().mul(e);n.directDiffuse.addAssign(r.mul(sS({diffuseColor:ov.rgb}))),!0===this.specular&&n.directSpecular.addAssign(r.mul(aS({lightDirection:t})).mul(fb))}indirect({ambientOcclusion:t,irradiance:e,reflectedLight:n}){n.indirectDiffuse.addAssign(e.mul(sS({diffuseColor:ov}))),n.indirectDiffuse.mulAssign(t)}}const uS=new xf;class cS extends kw{static get type(){return"MeshLambertNodeMaterial"}constructor(t){super(),this.isMeshLambertNodeMaterial=!0,this.lights=!0,this.setDefaultValues(uS),this.setValues(t)}setupEnvironment(t){const e=super.setupEnvironment(t);return e?new Jw(e):null}setupLightingModel(){return new lS(!1)}}const hS=new vf;class dS extends kw{static get type(){return"MeshPhongNodeMaterial"}constructor(t){super(),this.isMeshPhongNodeMaterial=!0,this.lights=!0,this.shininessNode=null,this.specularNode=null,this.setDefaultValues(hS),this.setValues(t)}setupEnvironment(t){const e=super.setupEnvironment(t);return e?new Jw(e):null}setupLightingModel(){return new lS}setupVariants(){const t=(this.shininessNode?Ng(this.shininessNode):lb).max(1e-4);Sv.assign(t);const e=this.specularNode||hb;bv.assign(e)}copy(t){return this.shininessNode=t.shininessNode,this.specularNode=t.specularNode,super.copy(t)}}const pS=Eg((t=>{if(!1===t.geometry.hasAttribute("normal"))return Ng(0);const e=xx.dFdx().abs().max(xx.dFdy().abs());return e.x.max(e.y).max(e.z)})),fS=Eg((t=>{const{roughness:e}=t,n=pS();let r=e.max(.0525);return r=r.add(n),r=r.min(1),r})),mS=Eg((({alpha:t,dotNL:e,dotNV:n})=>{const r=t.pow2(),i=e.mul(r.add(r.oneMinus().mul(n.pow2())).sqrt()),s=n.mul(r.add(r.oneMinus().mul(e.pow2())).sqrt());return Fv(.5,i.add(s).max(iy))})).setLayout({name:"V_GGX_SmithCorrelated",type:"float",inputs:[{name:"alpha",type:"float"},{name:"dotNL",type:"float"},{name:"dotNV",type:"float"}]}),gS=Eg((({alphaT:t,alphaB:e,dotTV:n,dotBV:r,dotTL:i,dotBL:s,dotNV:o,dotNL:a})=>{const l=a.mul(Bg(t.mul(n),e.mul(r),o).length()),u=o.mul(Bg(t.mul(i),e.mul(s),a).length());return Fv(.5,l.add(u)).saturate()})).setLayout({name:"V_GGX_SmithCorrelated_Anisotropic",type:"float",inputs:[{name:"alphaT",type:"float",qualifier:"in"},{name:"alphaB",type:"float",qualifier:"in"},{name:"dotTV",type:"float",qualifier:"in"},{name:"dotBV",type:"float",qualifier:"in"},{name:"dotTL",type:"float",qualifier:"in"},{name:"dotBL",type:"float",qualifier:"in"},{name:"dotNV",type:"float",qualifier:"in"},{name:"dotNL",type:"float",qualifier:"in"}]}),vS=Eg((({alpha:t,dotNH:e})=>{const n=t.pow2(),r=e.pow2().mul(n.oneMinus()).oneMinus();return n.div(r.pow2()).mul(1/Math.PI)})).setLayout({name:"D_GGX",type:"float",inputs:[{name:"alpha",type:"float"},{name:"dotNH",type:"float"}]}),yS=Ng(1/Math.PI),_S=Eg((({alphaT:t,alphaB:e,dotNH:n,dotTH:r,dotBH:i})=>{const s=t.mul(e),o=Bg(e.mul(r),t.mul(i),s.mul(n)),a=o.dot(o),l=s.div(a);return yS.mul(s.mul(l.pow2()))})).setLayout({name:"D_GGX_Anisotropic",type:"float",inputs:[{name:"alphaT",type:"float",qualifier:"in"},{name:"alphaB",type:"float",qualifier:"in"},{name:"dotNH",type:"float",qualifier:"in"},{name:"dotTH",type:"float",qualifier:"in"},{name:"dotBH",type:"float",qualifier:"in"}]}),xS=Eg((t=>{const{lightDirection:e,f0:n,f90:r,roughness:i,f:s,USE_IRIDESCENCE:o,USE_ANISOTROPY:a}=t,l=t.normalView||wx,u=i.pow2(),c=e.add(fx).normalize(),h=l.dot(e).clamp(),d=l.dot(fx).clamp(),p=l.dot(c).clamp(),f=fx.dot(c).clamp();let m,g,v=iS({f0:n,f90:r,dotVH:f});if(yg(o)&&(v=fv.mix(v,s)),yg(a)){const t=_v.dot(e),n=_v.dot(fx),r=_v.dot(c),i=xv.dot(e),s=xv.dot(fx),o=xv.dot(c);m=gS({alphaT:vv,alphaB:u,dotTV:n,dotBV:s,dotTL:t,dotBL:i,dotNV:d,dotNL:h}),g=_S({alphaT:vv,alphaB:u,dotNH:p,dotTH:r,dotBH:o})}else m=mS({alpha:u,dotNL:h,dotNV:d}),g=vS({alpha:u,dotNH:p});return v.mul(m).mul(g)})),bS=Eg((({roughness:t,dotNV:e})=>{const n=Gg(-1,-.0275,-.572,.022),r=Gg(1,.0425,1.04,-.04),i=t.mul(n).add(r),s=i.x.mul(i.x).min(e.mul(-9.28).exp2()).mul(i.x).add(i.y);return Dg(-1.04,1.04).mul(s).add(i.zw)})).setLayout({name:"DFGApprox",type:"vec2",inputs:[{name:"roughness",type:"float"},{name:"dotNV",type:"vec3"}]}),wS=Eg((t=>{const{dotNV:e,specularColor:n,specularF90:r,roughness:i}=t,s=bS({dotNV:e,roughness:i});return n.mul(s.x).add(r.mul(s.y))})),SS=Eg((({f:t,f90:e,dotVH:n})=>{const r=n.oneMinus().saturate(),i=r.mul(r),s=r.mul(i,i).clamp(0,.9999);return t.sub(Bg(e).mul(s)).div(s.oneMinus())})).setLayout({name:"Schlick_to_F0",type:"vec3",inputs:[{name:"f",type:"vec3"},{name:"f90",type:"float"},{name:"dotVH",type:"float"}]}),MS=Eg((({roughness:t,dotNH:e})=>{const n=t.pow2(),r=Ng(1).div(n),i=e.pow2().oneMinus().max(.0078125);return Ng(2).add(r).mul(i.pow(r.mul(.5))).div(2*Math.PI)})).setLayout({name:"D_Charlie",type:"float",inputs:[{name:"roughness",type:"float"},{name:"dotNH",type:"float"}]}),ES=Eg((({dotNV:t,dotNL:e})=>Ng(1).div(Ng(4).mul(e.add(t).sub(e.mul(t)))))).setLayout({name:"V_Neubelt",type:"float",inputs:[{name:"dotNV",type:"float"},{name:"dotNL",type:"float"}]}),TS=Eg((({lightDirection:t})=>{const e=t.add(fx).normalize(),n=wx.dot(t).clamp(),r=wx.dot(fx).clamp(),i=wx.dot(e).clamp(),s=MS({roughness:pv,dotNH:i}),o=ES({dotNV:r,dotNL:n});return dv.mul(s).mul(o)})),AS=Eg((({N:t,V:e,roughness:n})=>{const r=t.dot(e).saturate(),i=Dg(n,r.oneMinus().sqrt());return i.assign(i.mul(.984375).add(.0078125)),i})).setLayout({name:"LTC_Uv",type:"vec2",inputs:[{name:"N",type:"vec3"},{name:"V",type:"vec3"},{name:"roughness",type:"float"}]}),CS=Eg((({f:t})=>{const e=t.length();return Vy(e.mul(e).add(t.z).div(e.add(1)),0)})).setLayout({name:"LTC_ClippedSphereFormFactor",type:"float",inputs:[{name:"f",type:"vec3"}]}),RS=Eg((({v1:t,v2:e})=>{const n=t.dot(e),r=n.abs().toVar(),i=r.mul(.0145206).add(.4965155).mul(r).add(.8543985).toVar(),s=r.add(4.1616724).mul(r).add(3.417594).toVar(),o=i.div(s),a=n.greaterThan(0).select(o,Vy(n.mul(n).oneMinus(),1e-7).inverseSqrt().mul(.5).sub(o));return t.cross(e).mul(a)})).setLayout({name:"LTC_EdgeVectorFormFactor",type:"vec3",inputs:[{name:"v1",type:"vec3"},{name:"v2",type:"vec3"}]}),NS=Eg((({N:t,V:e,P:n,mInv:r,p0:i,p1:s,p2:o,p3:a})=>{const l=s.sub(i).toVar(),u=a.sub(i).toVar(),c=l.cross(u),h=Bg().toVar();return Cg(c.dot(n.sub(i)).greaterThanEqual(0),(()=>{const l=e.sub(t.mul(e.dot(t))).normalize(),u=t.cross(l).negate(),c=r.mul(Xg(l,u,t).transpose()).toVar(),d=c.mul(i.sub(n)).normalize().toVar(),p=c.mul(s.sub(n)).normalize().toVar(),f=c.mul(o.sub(n)).normalize().toVar(),m=c.mul(a.sub(n)).normalize().toVar(),g=Bg(0).toVar();g.addAssign(RS({v1:d,v2:p})),g.addAssign(RS({v1:p,v2:f})),g.addAssign(RS({v1:f,v2:m})),g.addAssign(RS({v1:m,v2:d})),h.assign(Bg(CS({f:g})))})),h})).setLayout({name:"LTC_Evaluate",type:"vec3",inputs:[{name:"N",type:"vec3"},{name:"V",type:"vec3"},{name:"P",type:"vec3"},{name:"mInv",type:"mat3"},{name:"p0",type:"vec3"},{name:"p1",type:"vec3"},{name:"p2",type:"vec3"},{name:"p3",type:"vec3"}]}),PS=1/6,IS=t=>Bv(PS,Bv(t,Bv(t,t.negate().add(3)).sub(3)).add(1)),OS=t=>Bv(PS,Bv(t,Bv(t,Bv(3,t).sub(6))).add(4)),DS=t=>Bv(PS,Bv(t,Bv(t,Bv(-3,t).add(3)).add(3)).add(1)),LS=t=>Bv(PS,$y(t,3)),US=t=>IS(t).add(OS(t)),kS=t=>DS(t).add(LS(t)),BS=t=>Uv(-1,OS(t).div(IS(t).add(OS(t)))),FS=t=>Uv(1,LS(t).div(DS(t).add(LS(t)))),zS=(t,e,n)=>{const r=t.uvNode,i=Bv(r,e.zw).add(.5),s=vy(i),o=xy(i),a=US(o.x),l=kS(o.x),u=BS(o.x),c=FS(o.x),h=BS(o.y),d=FS(o.y),p=Dg(s.x.add(u),s.y.add(h)).sub(.5).mul(e.xy),f=Dg(s.x.add(c),s.y.add(h)).sub(.5).mul(e.xy),m=Dg(s.x.add(u),s.y.add(d)).sub(.5).mul(e.xy),g=Dg(s.x.add(c),s.y.add(d)).sub(.5).mul(e.xy),v=US(o.y).mul(Uv(a.mul(t.uv(p).level(n)),l.mul(t.uv(f).level(n)))),y=kS(o.y).mul(Uv(a.mul(t.uv(m).level(n)),l.mul(t.uv(g).level(n))));return v.add(y)},VS=Eg((([t,e=Ng(3)])=>{const n=Dg(t.size(Pg(e))),r=Dg(t.size(Pg(e.add(1)))),i=Fv(1,n),s=Fv(1,r),o=zS(t,Gg(i,n),vy(e)),a=zS(t,Gg(s,r),yy(e));return xy(e).mix(o,a)})),GS=Eg((([t,e,n,r,i])=>{const s=Bg(r_(e.negate(),_y(t),Fv(1,r))),o=Bg(Ry(i[0].xyz),Ry(i[1].xyz),Ry(i[2].xyz));return _y(s).mul(n.mul(o))})).setLayout({name:"getVolumeTransmissionRay",type:"vec3",inputs:[{name:"n",type:"vec3"},{name:"v",type:"vec3"},{name:"thickness",type:"float"},{name:"ior",type:"float"},{name:"modelMatrix",type:"mat4"}]}),jS=Eg((([t,e])=>t.mul(n_(e.mul(2).sub(2),0,1)))).setLayout({name:"applyIorToRoughness",type:"float",inputs:[{name:"roughness",type:"float"},{name:"ior",type:"float"}]}),HS=bw(),WS=bw(),qS=Eg((([t,e,n],{material:r})=>{const i=(1==r.side?HS:WS).uv(t),s=fy(gw.x).mul(jS(e,n));return VS(i,s)})),XS=Eg((([t,e,n])=>(Cg(n.notEqual(0),(()=>{const r=py(e).negate().div(n);return hy(r.negate().mul(t))})),Bg(1)))).setLayout({name:"volumeAttenuation",type:"vec3",inputs:[{name:"transmissionDistance",type:"float"},{name:"attenuationColor",type:"vec3"},{name:"attenuationDistance",type:"float"}]}),ZS=Eg((([t,e,n,r,i,s,o,a,l,u,c,h,d,p,f])=>{let m,g;if(f){m=Gg().toVar(),g=Bg().toVar();const i=c.sub(1).mul(f.mul(.025)),s=Bg(c.sub(i),c,c.add(i));tw({start:0,end:3},(({i:i})=>{const c=s.element(i),f=GS(t,e,h,c,a),v=o.add(f),y=u.mul(l.mul(Gg(v,1))),_=Dg(y.xy.div(y.w)).toVar();_.addAssign(1),_.divAssign(2),_.assign(Dg(_.x,_.y.oneMinus()));const x=qS(_,n,c);m.element(i).assign(x.element(i)),m.a.addAssign(x.a),g.element(i).assign(r.element(i).mul(XS(Ry(f),d,p).element(i)))})),m.a.divAssign(3)}else{const i=GS(t,e,h,c,a),s=o.add(i),f=u.mul(l.mul(Gg(s,1))),v=Dg(f.xy.div(f.w)).toVar();v.addAssign(1),v.divAssign(2),v.assign(Dg(v.x,v.y.oneMinus())),m=qS(v,n,c),g=r.mul(XS(Ry(i),d,p))}const v=g.rgb.mul(m.rgb),y=t.dot(e).clamp(),_=Bg(wS({dotNV:y,specularColor:i,specularF90:s,roughness:n})),x=g.r.add(g.g,g.b).div(3);return Gg(_.oneMinus().mul(v),m.a.oneMinus().mul(x).oneMinus())})),$S=Xg(3.2404542,-.969266,.0556434,-1.5371385,1.8760108,-.2040259,-.4985314,.041556,1.0572252),YS=(t,e)=>t.sub(e).div(t.add(e)).pow2(),KS=Eg((({outsideIOR:t,eta2:e,cosTheta1:n,thinFilmThickness:r,baseF0:i})=>{const s=e_(t,e,i_(0,.03,r)),o=t.div(s).pow2().mul(n.pow2().oneMinus()).oneMinus();Cg(o.lessThan(0),(()=>Bg(1)));const a=o.sqrt(),l=YS(s,t),u=iS({f0:l,f90:1,dotVH:n}),c=u.oneMinus(),h=s.lessThan(t).select(Math.PI,0),d=Ng(Math.PI).sub(h),p=(t=>{const e=t.sqrt();return Bg(1).add(e).div(Bg(1).sub(e))})(i.clamp(0,.9999)),f=YS(p,s.toVec3()),m=iS({f0:f,f90:1,dotVH:a}),g=Bg(p.x.lessThan(s).select(Math.PI,0),p.y.lessThan(s).select(Math.PI,0),p.z.lessThan(s).select(Math.PI,0)),v=s.mul(r,a,2),y=Bg(d).add(g),_=u.mul(m).clamp(1e-5,.9999),x=_.sqrt(),b=c.pow2().mul(m).div(Bg(1).sub(_)),w=u.add(b).toVar(),S=b.sub(c).toVar();return tw({start:1,end:2,condition:"<=",name:"m"},(({m:t})=>{S.mulAssign(x);const e=((t,e)=>{const n=t.mul(2*Math.PI*1e-9),r=Bg(54856e-17,44201e-17,52481e-17),i=Bg(1681e3,1795300,2208400),s=Bg(43278e5,93046e5,66121e5),o=Ng(9747e-17*Math.sqrt(2*Math.PI*45282e5)).mul(n.mul(2239900).add(e.x).cos()).mul(n.pow2().mul(-45282e5).exp());let a=r.mul(s.mul(2*Math.PI).sqrt()).mul(i.mul(n).add(e).cos()).mul(n.pow2().negate().mul(s).exp());return a=Bg(a.x.add(o),a.y,a.z).div(1.0685e-7),$S.mul(a)})(Ng(t).mul(v),Ng(t).mul(y)).mul(2);w.addAssign(S.mul(e))})),w.max(Bg(0))})).setLayout({name:"evalIridescence",type:"vec3",inputs:[{name:"outsideIOR",type:"float"},{name:"eta2",type:"float"},{name:"cosTheta1",type:"float"},{name:"thinFilmThickness",type:"float"},{name:"baseF0",type:"vec3"}]}),JS=Eg((({normal:t,viewDir:e,roughness:n})=>{const r=t.dot(e).saturate(),i=n.pow2(),s=l_(n.lessThan(.25),Ng(-339.2).mul(i).add(Ng(161.4).mul(n)).sub(25.9),Ng(-8.48).mul(i).add(Ng(14.3).mul(n)).sub(9.95)),o=l_(n.lessThan(.25),Ng(44).mul(i).sub(Ng(23.7).mul(n)).add(3.26),Ng(1.97).mul(i).sub(Ng(3.27).mul(n)).add(.72));return l_(n.lessThan(.25),0,Ng(.1).mul(n).sub(.025)).add(s.mul(r).add(o).exp()).mul(1/Math.PI).saturate()})),QS=Bg(.04),tM=Ng(1);class eM extends tS{constructor(t=!1,e=!1,n=!1,r=!1,i=!1,s=!1){super(),this.clearcoat=t,this.sheen=e,this.iridescence=n,this.anisotropy=r,this.transmission=i,this.dispersion=s,this.clearcoatRadiance=null,this.clearcoatSpecularDirect=null,this.clearcoatSpecularIndirect=null,this.sheenSpecularDirect=null,this.sheenSpecularIndirect=null,this.iridescenceFresnel=null,this.iridescenceF0=null}start(t){if(!0===this.clearcoat&&(this.clearcoatRadiance=Bg().toVar("clearcoatRadiance"),this.clearcoatSpecularDirect=Bg().toVar("clearcoatSpecularDirect"),this.clearcoatSpecularIndirect=Bg().toVar("clearcoatSpecularIndirect")),!0===this.sheen&&(this.sheenSpecularDirect=Bg().toVar("sheenSpecularDirect"),this.sheenSpecularIndirect=Bg().toVar("sheenSpecularIndirect")),!0===this.iridescence){const t=wx.dot(fx).clamp();this.iridescenceFresnel=KS({outsideIOR:Ng(1),eta2:mv,cosTheta1:t,thinFilmThickness:gv,baseF0:bv}),this.iridescenceF0=SS({f:this.iridescenceFresnel,f90:1,dotVH:t})}if(!0===this.transmission){const e=hx,n=nx.sub(hx).normalize(),r=Sx;t.backdrop=ZS(r,n,lv,ov,bv,wv,e,sx,ex,tx,Av,Rv,Pv,Nv,this.dispersion?Iv:null),t.backdropAlpha=Cv,ov.a.mulAssign(e_(1,t.backdrop.a,Cv))}}computeMultiscattering(t,e,n){const r=wx.dot(fx).clamp(),i=bS({roughness:lv,dotNV:r}),s=(this.iridescenceF0?fv.mix(bv,this.iridescenceF0):bv).mul(i.x).add(n.mul(i.y)),o=i.x.add(i.y).oneMinus(),a=bv.add(bv.oneMinus().mul(.047619)),l=s.mul(a).div(o.mul(a).oneMinus());t.addAssign(s),e.addAssign(l.mul(o))}direct({lightDirection:t,lightColor:e,reflectedLight:n}){const r=wx.dot(t).clamp().mul(e);if(!0===this.sheen&&this.sheenSpecularDirect.addAssign(r.mul(TS({lightDirection:t}))),!0===this.clearcoat){const n=Mx.dot(t).clamp().mul(e);this.clearcoatSpecularDirect.addAssign(n.mul(xS({lightDirection:t,f0:QS,f90:tM,roughness:hv,normalView:Mx})))}n.directDiffuse.addAssign(r.mul(sS({diffuseColor:ov.rgb}))),n.directSpecular.addAssign(r.mul(xS({lightDirection:t,f0:bv,f90:1,roughness:lv,iridescence:this.iridescence,f:this.iridescenceFresnel,USE_IRIDESCENCE:this.iridescence,USE_ANISOTROPY:this.anisotropy})))}directRectArea({lightColor:t,lightPosition:e,halfWidth:n,halfHeight:r,reflectedLight:i,ltc_1:s,ltc_2:o}){const a=e.add(n).sub(r),l=e.sub(n).sub(r),u=e.sub(n).add(r),c=e.add(n).add(r),h=wx,d=fx,p=px.toVar(),f=AS({N:h,V:d,roughness:lv}),m=s.uv(f).toVar(),g=o.uv(f).toVar(),v=Xg(Bg(m.x,0,m.y),Bg(0,1,0),Bg(m.z,0,m.w)).toVar(),y=bv.mul(g.x).add(bv.oneMinus().mul(g.y)).toVar();i.directSpecular.addAssign(t.mul(y).mul(NS({N:h,V:d,P:p,mInv:v,p0:a,p1:l,p2:u,p3:c}))),i.directDiffuse.addAssign(t.mul(ov).mul(NS({N:h,V:d,P:p,mInv:Xg(1,0,0,0,1,0,0,0,1),p0:a,p1:l,p2:u,p3:c})))}indirect(t,e,n){this.indirectDiffuse(t,e,n),this.indirectSpecular(t,e,n),this.ambientOcclusion(t,e,n)}indirectDiffuse({irradiance:t,reflectedLight:e}){e.indirectDiffuse.addAssign(t.mul(sS({diffuseColor:ov})))}indirectSpecular({radiance:t,iblIrradiance:e,reflectedLight:n}){if(!0===this.sheen&&this.sheenSpecularIndirect.addAssign(e.mul(dv,JS({normal:wx,viewDir:fx,roughness:pv}))),!0===this.clearcoat){const t=Mx.dot(fx).clamp(),e=wS({dotNV:t,specularColor:QS,specularF90:tM,roughness:hv});this.clearcoatSpecularIndirect.addAssign(this.clearcoatRadiance.mul(e))}const r=Bg().toVar("singleScattering"),i=Bg().toVar("multiScattering"),s=e.mul(1/Math.PI);this.computeMultiscattering(r,i,wv);const o=r.add(i),a=ov.mul(o.r.max(o.g).max(o.b).oneMinus());n.indirectSpecular.addAssign(t.mul(r)),n.indirectSpecular.addAssign(i.mul(s)),n.indirectDiffuse.addAssign(a.mul(s))}ambientOcclusion({ambientOcclusion:t,reflectedLight:e}){const n=wx.dot(fx).clamp().add(t),r=lv.mul(-16).oneMinus().negate().exp2(),i=t.sub(n.pow(r).oneMinus()).clamp();!0===this.clearcoat&&this.clearcoatSpecularIndirect.mulAssign(t),!0===this.sheen&&this.sheenSpecularIndirect.mulAssign(t),e.indirectDiffuse.mulAssign(t),e.indirectSpecular.mulAssign(i)}finish(t){const{outgoingLight:e}=t;if(!0===this.clearcoat){const t=Mx.dot(fx).clamp(),n=iS({dotVH:t,f0:QS,f90:tM}),r=e.mul(cv.mul(n).oneMinus()).add(this.clearcoatSpecularDirect.add(this.clearcoatSpecularIndirect).mul(cv));e.assign(r)}if(!0===this.sheen){const t=dv.r.max(dv.g).max(dv.b).mul(.157).oneMinus(),n=e.mul(t).add(this.sheenSpecularDirect,this.sheenSpecularIndirect);e.assign(n)}}}const nM=Ng(1),rM=Ng(-2),iM=Ng(.8),sM=Ng(-1),oM=Ng(.4),aM=Ng(2),lM=Ng(.305),uM=Ng(3),cM=Ng(.21),hM=Ng(4),dM=Ng(4),pM=Ng(16),fM=Eg((([t])=>{const e=Bg(Ay(t)).toVar(),n=Ng(-1).toVar();return Cg(e.x.greaterThan(e.z),(()=>{Cg(e.x.greaterThan(e.y),(()=>{n.assign(l_(t.x.greaterThan(0),0,3))})).Else((()=>{n.assign(l_(t.y.greaterThan(0),1,4))}))})).Else((()=>{Cg(e.z.greaterThan(e.y),(()=>{n.assign(l_(t.z.greaterThan(0),2,5))})).Else((()=>{n.assign(l_(t.y.greaterThan(0),1,4))}))})),n})).setLayout({name:"getFace",type:"float",inputs:[{name:"direction",type:"vec3"}]}),mM=Eg((([t,e])=>{const n=Dg().toVar();return Cg(e.equal(0),(()=>{n.assign(Dg(t.z,t.y).div(Ay(t.x)))})).ElseIf(e.equal(1),(()=>{n.assign(Dg(t.x.negate(),t.z.negate()).div(Ay(t.y)))})).ElseIf(e.equal(2),(()=>{n.assign(Dg(t.x.negate(),t.y).div(Ay(t.z)))})).ElseIf(e.equal(3),(()=>{n.assign(Dg(t.z.negate(),t.y).div(Ay(t.x)))})).ElseIf(e.equal(4),(()=>{n.assign(Dg(t.x.negate(),t.z).div(Ay(t.y)))})).Else((()=>{n.assign(Dg(t.x,t.y).div(Ay(t.z)))})),Bv(.5,n.add(1))})).setLayout({name:"getUV",type:"vec2",inputs:[{name:"direction",type:"vec3"},{name:"face",type:"float"}]}),gM=Eg((([t])=>{const e=Ng(0).toVar();return Cg(t.greaterThanEqual(iM),(()=>{e.assign(nM.sub(t).mul(sM.sub(rM)).div(nM.sub(iM)).add(rM))})).ElseIf(t.greaterThanEqual(oM),(()=>{e.assign(iM.sub(t).mul(aM.sub(sM)).div(iM.sub(oM)).add(sM))})).ElseIf(t.greaterThanEqual(lM),(()=>{e.assign(oM.sub(t).mul(uM.sub(aM)).div(oM.sub(lM)).add(aM))})).ElseIf(t.greaterThanEqual(cM),(()=>{e.assign(lM.sub(t).mul(hM.sub(uM)).div(lM.sub(cM)).add(uM))})).Else((()=>{e.assign(Ng(-2).mul(fy(Bv(1.16,t))))})),e})).setLayout({name:"roughnessToMip",type:"float",inputs:[{name:"roughness",type:"float"}]}),vM=Eg((([t,e])=>{const n=t.toVar();n.assign(Bv(2,n).sub(1));const r=Bg(n,1).toVar();return Cg(e.equal(0),(()=>{r.assign(r.zyx)})).ElseIf(e.equal(1),(()=>{r.assign(r.xzy),r.xz.mulAssign(-1)})).ElseIf(e.equal(2),(()=>{r.x.mulAssign(-1)})).ElseIf(e.equal(3),(()=>{r.assign(r.zyx),r.xz.mulAssign(-1)})).ElseIf(e.equal(4),(()=>{r.assign(r.xzy),r.xy.mulAssign(-1)})).ElseIf(e.equal(5),(()=>{r.z.mulAssign(-1)})),r})).setLayout({name:"getDirection",type:"vec3",inputs:[{name:"uv",type:"vec2"},{name:"face",type:"float"}]}),yM=Eg((([t,e,n,r,i,s])=>{const o=Ng(n),a=Bg(e),l=n_(gM(o),rM,s),u=xy(l),c=vy(l),h=Bg(_M(t,a,c,r,i,s)).toVar();return Cg(u.notEqual(0),(()=>{const e=Bg(_M(t,a,c.add(1),r,i,s)).toVar();h.assign(e_(h,e,u))})),h})),_M=Eg((([t,e,n,r,i,s])=>{const o=Ng(n).toVar(),a=Bg(e),l=Ng(fM(a)).toVar(),u=Ng(Vy(dM.sub(o),0)).toVar();o.assign(Vy(o,dM));const c=Ng(dy(o)).toVar(),h=Dg(mM(a,l).mul(c.sub(2)).add(1)).toVar();return Cg(l.greaterThan(2),(()=>{h.y.addAssign(c),l.subAssign(3)})),h.x.addAssign(l.mul(c)),h.x.addAssign(u.mul(Bv(3,pM))),h.y.addAssign(Bv(4,dy(s).sub(c))),h.x.mulAssign(r),h.y.mulAssign(i),t.uv(h).grad(Dg(),Dg())})),xM=Eg((({envMap:t,mipInt:e,outputDirection:n,theta:r,axis:i,CUBEUV_TEXEL_WIDTH:s,CUBEUV_TEXEL_HEIGHT:o,CUBEUV_MAX_MIP:a})=>{const l=wy(r),u=n.mul(l).add(i.cross(n).mul(by(r))).add(i.mul(i.dot(n).mul(l.oneMinus())));return _M(t,u,e,s,o,a)})),bM=Eg((({n:t,latitudinal:e,poleAxis:n,outputDirection:r,weights:i,samples:s,dTheta:o,mipInt:a,envMap:l,CUBEUV_TEXEL_WIDTH:u,CUBEUV_TEXEL_HEIGHT:c,CUBEUV_MAX_MIP:h})=>{const d=Bg(l_(e,n,Zy(n,r))).toVar();Cg(oy(d.equals(Bg(0))),(()=>{d.assign(Bg(r.z,0,r.x.negate()))})),d.assign(_y(d));const p=Bg().toVar();return p.addAssign(i.element(Pg(0)).mul(xM({theta:0,axis:d,outputDirection:r,mipInt:a,envMap:l,CUBEUV_TEXEL_WIDTH:u,CUBEUV_TEXEL_HEIGHT:c,CUBEUV_MAX_MIP:h}))),tw({start:Pg(1),end:t},(({i:t})=>{Cg(t.greaterThanEqual(s),(()=>{ew()}));const e=Ng(o.mul(Ng(t))).toVar();p.addAssign(i.element(t).mul(xM({theta:e.mul(-1),axis:d,outputDirection:r,mipInt:a,envMap:l,CUBEUV_TEXEL_WIDTH:u,CUBEUV_TEXEL_HEIGHT:c,CUBEUV_MAX_MIP:h}))),p.addAssign(i.element(t).mul(xM({theta:e,axis:d,outputDirection:r,mipInt:a,envMap:l,CUBEUV_TEXEL_WIDTH:u,CUBEUV_TEXEL_HEIGHT:c,CUBEUV_MAX_MIP:h})))})),Gg(p,1)}));let wM=null;const SM=new WeakMap;function MM(t){let e=SM.get(t);if((void 0!==e?e.pmremVersion:-1)!==t.pmremVersion){const n=t.image;if(t.isCubeTexture){if(!function(t){if(null==t)return!1;let e=0;const n=6;for(let r=0;r<n;r++)void 0!==t[r]&&e++;return e===n}(n))return null;e=wM.fromCubemap(t,e)}else{if(!function(t){return null!=t&&t.height>0}(n))return null;e=wM.fromEquirectangular(t,e)}e.pmremVersion=t.pmremVersion,SM.set(t,e)}return e.texture}class EM extends Bm{static get type(){return"PMREMNode"}constructor(t,e=null,n=null){super("vec3"),this._value=t,this._pmrem=null,this.uvNode=e,this.levelNode=n,this._generator=null;const r=new Eh;r.isRenderTargetTexture=!0,this._texture=Y_(r),this._width=nv(0),this._height=nv(0),this._maxMip=nv(0),this.updateBeforeType=Rm}set value(t){this._value=t,this._pmrem=null}get value(){return this._value}updateFromTexture(t){const e=function(t){const e=Math.log2(t)-2,n=1/t;return{texelWidth:1/(3*Math.max(Math.pow(2,e),112)),texelHeight:n,maxMip:e}}(t.image.height);this._texture.value=t,this._width.value=e.texelWidth,this._height.value=e.texelHeight,this._maxMip.value=e.maxMip}updateBefore(){let t=this._pmrem;const e=t?t.pmremVersion:-1,n=this._value;e!==n.pmremVersion&&(t=!0===n.isPMREMTexture?n:MM(n),null!==t&&(this._pmrem=t,this.updateFromTexture(t)))}setup(t){null===wM&&(wM=t.createPMREMGenerator()),this.updateBefore(t);let e=this.uvNode;null===e&&t.context.getUV&&(e=t.context.getUV(this));const n=this.value;t.renderer.coordinateSystem===qc&&!0!==n.isPMREMTexture&&!0===n.isRenderTargetTexture&&(e=Bg(e.x.negate(),e.yz));let r=this.levelNode;return null===r&&t.context.getTextureLevel&&(r=t.context.getTextureLevel(this)),yM(this._texture,e,r,this._width,this._height,this._maxMip)}}const TM=Sg(EM),AM=new WeakMap;class CM extends aw{static get type(){return"EnvironmentNode"}constructor(t=null){super(),this.envNode=t}setup(t){const{material:e}=t;let n=this.envNode;if(n.isTextureNode||n.isMaterialReferenceNode){const t=n.isTextureNode?n.value:e[n.property];let r=AM.get(t);void 0===r&&(r=TM(t),AM.set(t,r)),n=r}const r=e.envMap?Vx("envMapIntensity","float",t.material):Vx("environmentIntensity","float",t.scene),i=!0===e.useAnisotropy||e.anisotropy>0?Yx:wx,s=n.context(RM(lv,i)).mul(r),o=n.context(NM(Sx)).mul(Math.PI).mul(r),a=O_(s),l=O_(o);t.context.radiance.addAssign(a),t.context.iblIrradiance.addAssign(l);const u=t.context.lightingModel.clearcoatRadiance;if(u){const t=n.context(RM(hv,Mx)).mul(r),e=O_(t);u.addAssign(e)}}}const RM=(t,e)=>{let n=null;return{getUV:()=>(null===n&&(n=fx.negate().reflect(e),n=t.mul(t).mix(n,e).normalize(),n=n.transformDirection(ex)),n),getTextureLevel:()=>t}},NM=t=>({getUV:()=>t,getTextureLevel:()=>Ng(1)}),PM=new mf;class IM extends kw{static get type(){return"MeshStandardNodeMaterial"}constructor(t){super(),this.isMeshStandardNodeMaterial=!0,this.lights=!0,this.emissiveNode=null,this.metalnessNode=null,this.roughnessNode=null,this.setDefaultValues(PM),this.setValues(t)}setupEnvironment(t){let e=super.setupEnvironment(t);return null===e&&t.environmentNode&&(e=t.environmentNode),e?new CM(e):null}setupLightingModel(){return new eM}setupSpecular(){const t=e_(Bg(.04),ov.rgb,uv);bv.assign(t),wv.assign(1)}setupVariants(){const t=this.metalnessNode?Ng(this.metalnessNode):vb;uv.assign(t);let e=this.roughnessNode?Ng(this.roughnessNode):gb;e=fS({roughness:e}),lv.assign(e),this.setupSpecular(),ov.assign(Gg(ov.rgb.mul(t.oneMinus()),ov.a))}copy(t){return this.emissiveNode=t.emissiveNode,this.metalnessNode=t.metalnessNode,this.roughnessNode=t.roughnessNode,super.copy(t)}}const OM=new gf;class DM extends IM{static get type(){return"MeshPhysicalNodeMaterial"}constructor(t){super(),this.isMeshPhysicalNodeMaterial=!0,this.clearcoatNode=null,this.clearcoatRoughnessNode=null,this.clearcoatNormalNode=null,this.sheenNode=null,this.sheenRoughnessNode=null,this.iridescenceNode=null,this.iridescenceIORNode=null,this.iridescenceThicknessNode=null,this.specularIntensityNode=null,this.specularColorNode=null,this.iorNode=null,this.transmissionNode=null,this.thicknessNode=null,this.attenuationDistanceNode=null,this.attenuationColorNode=null,this.dispersionNode=null,this.anisotropyNode=null,this.setDefaultValues(OM),this.setValues(t)}get useClearcoat(){return this.clearcoat>0||null!==this.clearcoatNode}get useIridescence(){return this.iridescence>0||null!==this.iridescenceNode}get useSheen(){return this.sheen>0||null!==this.sheenNode}get useAnisotropy(){return this.anisotropy>0||null!==this.anisotropyNode}get useTransmission(){return this.transmission>0||null!==this.transmissionNode}get useDispersion(){return this.dispersion>0||null!==this.dispersionNode}setupSpecular(){const t=this.iorNode?Ng(this.iorNode):Pb;Av.assign(t),bv.assign(e_(zy(Yy(Av.sub(1).div(Av.add(1))).mul(pb),Bg(1)).mul(db),ov.rgb,uv)),wv.assign(e_(db,1,uv))}setupLightingModel(){return new eM(this.useClearcoat,this.useSheen,this.useIridescence,this.useAnisotropy,this.useTransmission,this.useDispersion)}setupVariants(t){if(super.setupVariants(t),this.useClearcoat){const t=this.clearcoatNode?Ng(this.clearcoatNode):_b,e=this.clearcoatRoughnessNode?Ng(this.clearcoatRoughnessNode):xb;cv.assign(t),hv.assign(fS({roughness:e}))}if(this.useSheen){const t=this.sheenNode?Bg(this.sheenNode):Sb,e=this.sheenRoughnessNode?Ng(this.sheenRoughnessNode):Mb;dv.assign(t),pv.assign(e)}if(this.useIridescence){const t=this.iridescenceNode?Ng(this.iridescenceNode):Tb,e=this.iridescenceIORNode?Ng(this.iridescenceIORNode):Ab,n=this.iridescenceThicknessNode?Ng(this.iridescenceThicknessNode):Cb;fv.assign(t),mv.assign(e),gv.assign(n)}if(this.useAnisotropy){const t=(this.anisotropyNode?Dg(this.anisotropyNode):Eb).toVar();yv.assign(t.length()),Cg(yv.equal(0),(()=>{t.assign(Dg(1,0))})).Else((()=>{t.divAssign(Dg(yv)),yv.assign(yv.saturate())})),vv.assign(yv.pow2().mix(lv.pow2(),1)),_v.assign($x[0].mul(t.x).add($x[1].mul(t.y))),xv.assign($x[1].mul(t.x).sub($x[0].mul(t.y)))}if(this.useTransmission){const t=this.transmissionNode?Ng(this.transmissionNode):Rb,e=this.thicknessNode?Ng(this.thicknessNode):Nb,n=this.attenuationDistanceNode?Ng(this.attenuationDistanceNode):Ib,r=this.attenuationColorNode?Bg(this.attenuationColorNode):Ob;if(Cv.assign(t),Rv.assign(e),Nv.assign(n),Pv.assign(r),this.useDispersion){const t=this.dispersionNode?Ng(this.dispersionNode):kb;Iv.assign(t)}}}setupClearcoatNormal(){return this.clearcoatNormalNode?Bg(this.clearcoatNormalNode):bb}setup(t){t.context.setupClearcoatNormal=()=>this.setupClearcoatNormal(t),super.setup(t)}copy(t){return this.clearcoatNode=t.clearcoatNode,this.clearcoatRoughnessNode=t.clearcoatRoughnessNode,this.clearcoatNormalNode=t.clearcoatNormalNode,this.sheenNode=t.sheenNode,this.sheenRoughnessNode=t.sheenRoughnessNode,this.iridescenceNode=t.iridescenceNode,this.iridescenceIORNode=t.iridescenceIORNode,this.iridescenceThicknessNode=t.iridescenceThicknessNode,this.specularIntensityNode=t.specularIntensityNode,this.specularColorNode=t.specularColorNode,this.transmissionNode=t.transmissionNode,this.thicknessNode=t.thicknessNode,this.attenuationDistanceNode=t.attenuationDistanceNode,this.attenuationColorNode=t.attenuationColorNode,this.dispersionNode=t.dispersionNode,this.anisotropyNode=t.anisotropyNode,super.copy(t)}}const LM=Eg((({normal:t,lightDirection:e,builder:n})=>{const r=t.dot(e),i=Dg(r.mul(.5).add(.5),0);if(n.material.gradientMap){const t=Hx("gradientMap","texture").context({getUV:()=>i});return Bg(t.r)}{const t=i.fwidth().mul(.5);return e_(Bg(.7),Bg(1),i_(Ng(.7).sub(t.x),Ng(.7).add(t.x),i.x))}}));class UM extends tS{direct({lightDirection:t,lightColor:e,reflectedLight:n},r,i){const s=LM({normal:vx,lightDirection:t,builder:i}).mul(e);n.directDiffuse.addAssign(s.mul(sS({diffuseColor:ov.rgb})))}indirect({ambientOcclusion:t,irradiance:e,reflectedLight:n}){n.indirectDiffuse.addAssign(e.mul(sS({diffuseColor:ov}))),n.indirectDiffuse.mulAssign(t)}}const kM=new yf;class BM extends kw{static get type(){return"MeshToonNodeMaterial"}constructor(t){super(),this.isMeshToonNodeMaterial=!0,this.lights=!0,this.setDefaultValues(kM),this.setValues(t)}setupLightingModel(){return new UM}}class FM extends Bm{static get type(){return"MatcapUVNode"}constructor(){super("vec2")}setup(){const t=Bg(fx.z,0,fx.x.negate()).normalize(),e=fx.cross(t);return Dg(t.dot(wx),e.dot(wx)).mul(.495).add(.5)}}const zM=Mg(FM),VM=new bf;class GM extends kw{static get type(){return"MeshMatcapNodeMaterial"}constructor(t){super(),this.lights=!1,this.isMeshMatcapNodeMaterial=!0,this.setDefaultValues(VM),this.setValues(t)}setupVariants(t){const e=zM;let n;n=t.material.matcap?Hx("matcap","texture").context({getUV:()=>e}):Bg(e_(.2,.8,e.y)),ov.rgb.mulAssign(n.rgb)}}const jM=new cf;class HM extends kw{static get type(){return"PointsNodeMaterial"}constructor(t){super(),this.isPointsNodeMaterial=!0,this.lights=!1,this.transparent=!0,this.sizeNode=null,this.setDefaultValues(jM),this.setValues(t)}copy(t){return this.sizeNode=t.sizeNode,super.copy(t)}}class WM extends Bm{static get type(){return"RotateNode"}constructor(t,e){super(),this.positionNode=t,this.rotationNode=e}getNodeType(t){return this.positionNode.getNodeType(t)}setup(t){const{rotationNode:e,positionNode:n}=this;if("vec2"===this.getNodeType(t)){const t=e.cos(),r=e.sin();return qg(t,r,r.negate(),t).mul(n)}{const t=e,r=Zg(Gg(1,0,0,0),Gg(0,wy(t.x),by(t.x).negate(),0),Gg(0,by(t.x),wy(t.x),0),Gg(0,0,0,1)),i=Zg(Gg(wy(t.y),0,by(t.y),0),Gg(0,1,0,0),Gg(by(t.y).negate(),0,wy(t.y),0),Gg(0,0,0,1)),s=Zg(Gg(wy(t.z),by(t.z).negate(),0,0),Gg(by(t.z),wy(t.z),0,0),Gg(0,0,1,0),Gg(0,0,0,1));return r.mul(i).mul(s).mul(Gg(n,1)).xyz}}}const qM=Sg(WM),XM=new Jp;class ZM extends kw{static get type(){return"SpriteNodeMaterial"}constructor(t){super(),this.isSpriteNodeMaterial=!0,this.lights=!1,this._useSizeAttenuation=!0,this.positionNode=null,this.rotationNode=null,this.scaleNode=null,this.setDefaultValues(XM),this.setValues(t)}setupPosition({object:t,camera:e,context:n}){const r=this.sizeAttenuation,{positionNode:i,rotationNode:s,scaleNode:o}=this,a=ux;let l=ax.mul(Bg(i||0)),u=Dg(sx[0].xyz.length(),sx[1].xyz.length());if(null!==o&&(u=u.mul(o)),!r)if(e.isPerspectiveCamera)u=u.mul(l.z.negate());else{const t=Ng(2).div(tx.element(1).element(1));u=u.mul(t.mul(2))}let c=a.xy;if(t.center&&!0===t.center.isVector2){const t=((t,e,n)=>xg(new w_(t,e,n)))("center","vec2");c=c.sub(t.sub(.5))}c=c.mul(u);const h=Ng(s||wb),d=qM(c,h);l=Gg(l.xy.add(d),l.zw);const p=tx.mul(l);return n.vertex=a,p}copy(t){return this.positionNode=t.positionNode,this.rotationNode=t.rotationNode,this.scaleNode=t.scaleNode,super.copy(t)}get sizeAttenuation(){return this._useSizeAttenuation}set sizeAttenuation(t){this._useSizeAttenuation!==t&&(this._useSizeAttenuation=t,this.needsUpdate=!0)}}class $M extends tS{constructor(){super(),this.shadowNode=Ng(1).toVar("shadowMask")}direct({shadowMask:t}){this.shadowNode.mulAssign(t)}finish(t){ov.a.mulAssign(this.shadowNode.oneMinus()),t.outgoingLight.rgb.assign(ov.rgb)}}const YM=new ff;class KM extends kw{static get type(){return"ShadowNodeMaterial"}constructor(t){super(),this.isShadowNodeMaterial=!0,this.lights=!0,this.setDefaultValues(YM),this.setValues(t)}setupLightingModel(){return new $M}}Eg((({texture:t,uv:e})=>{const n=1e-4,r=Bg().toVar();return Cg(e.x.lessThan(n),(()=>{r.assign(Bg(1,0,0))})).ElseIf(e.y.lessThan(n),(()=>{r.assign(Bg(0,1,0))})).ElseIf(e.z.lessThan(n),(()=>{r.assign(Bg(0,0,1))})).ElseIf(e.x.greaterThan(.9999),(()=>{r.assign(Bg(-1,0,0))})).ElseIf(e.y.greaterThan(.9999),(()=>{r.assign(Bg(0,-1,0))})).ElseIf(e.z.greaterThan(.9999),(()=>{r.assign(Bg(0,0,-1))})).Else((()=>{const n=.01,i=t.uv(e.add(Bg(-.01,0,0))).r.sub(t.uv(e.add(Bg(n,0,0))).r),s=t.uv(e.add(Bg(0,-.01,0))).r.sub(t.uv(e.add(Bg(0,n,0))).r),o=t.uv(e.add(Bg(0,0,-.01))).r.sub(t.uv(e.add(Bg(0,0,n))).r);r.assign(Bg(i,s,o))})),r.normalize()}));class JM{constructor(t,e){this.nodes=t,this.info=e,this.animationLoop=null,this.requestId=null,this._init()}_init(){const t=(e,n)=>{this.requestId=self.requestAnimationFrame(t),!0===this.info.autoReset&&this.info.reset(),this.nodes.nodeFrame.update(),this.info.frame=this.nodes.nodeFrame.frameId,null!==this.animationLoop&&this.animationLoop(e,n)};t()}dispose(){self.cancelAnimationFrame(this.requestId),this.requestId=null}setAnimationLoop(t){this.animationLoop=t}}class QM{constructor(){this.weakMap=new WeakMap}get(t){let e=this.weakMap;for(let n=0;n<t.length;n++)if(e=e.get(t[n]),void 0===e)return;return e.get(t[t.length-1])}set(t,e){let n=this.weakMap;for(let e=0;e<t.length;e++){const r=t[e];!1===n.has(r)&&n.set(r,new WeakMap),n=n.get(r)}return n.set(t[t.length-1],e)}delete(t){let e=this.weakMap;for(let n=0;n<t.length;n++)if(e=e.get(t[n]),void 0===e)return!1;return e.delete(t[t.length-1])}}const tE=new sf;class eE{constructor(){this.version=0,this.globalClippingCount=0,this.localClippingCount=0,this.localClippingEnabled=!1,this.localClipIntersection=!1,this.planes=[],this.parentVersion=0,this.viewNormalMatrix=new ah,this.cacheKey=0}projectPlanes(t,e){const n=t.length,r=this.planes;for(let i=0;i<n;i++){tE.copy(t[i]).applyMatrix4(this.viewMatrix,this.viewNormalMatrix);const n=r[e+i],s=tE.normal;n.x=-s.x,n.y=-s.y,n.z=-s.z,n.w=tE.constant}}updateGlobal(t,e){const n=t.clippingPlanes;this.viewMatrix=e.matrixWorldInverse,this.viewNormalMatrix.getNormalMatrix(this.viewMatrix);let r=!1;if(Array.isArray(n)&&0!==n.length){const t=n.length;if(t!==this.globalClippingCount){const e=[];for(let n=0;n<t;n++)e.push(new Th);this.globalClippingCount=t,this.planes=e,r=!0}this.projectPlanes(n,0)}else 0!==this.globalClippingCount&&(this.globalClippingCount=0,this.planes=[],r=!0);t.localClippingEnabled!==this.localClippingEnabled&&(this.localClippingEnabled=t.localClippingEnabled,r=!0),r&&(this.version++,this.cacheKey=_m(this.globalClippingCount,!0===this.localClippingEnabled?1:0))}update(t,e){let n=!1;if(this!==t&&t.version!==this.parentVersion&&(this.globalClippingCount=e.isShadowNodeMaterial?0:t.globalClippingCount,this.localClippingEnabled=t.localClippingEnabled,this.planes=Array.from(t.planes),this.parentVersion=t.version,this.viewMatrix=t.viewMatrix,this.viewNormalMatrix=t.viewNormalMatrix,n=!0),this.localClippingEnabled){const t=e.clippingPlanes;if(Array.isArray(t)&&0!==t.length){const e=t.length,r=this.planes,i=this.globalClippingCount;if(n||e!==this.localClippingCount){r.length=i+e;for(let t=0;t<e;t++)r[i+t]=new Th;this.localClippingCount=e,n=!0}this.projectPlanes(t,i)}else 0!==this.localClippingCount&&(this.localClippingCount=0,n=!0);this.localClipIntersection!==e.clipIntersection&&(this.localClipIntersection=e.clipIntersection,n=!0)}n&&(this.version+=t.version,this.cacheKey=_m(t.cacheKey,this.localClippingCount,!0===this.localClipIntersection?1:0))}}let nE=0;class rE{constructor(t,e,n,r,i,s,o,a,l){this._nodes=t,this._geometries=e,this.id=nE++,this.renderer=n,this.object=r,this.material=i,this.scene=s,this.camera=o,this.lightsNode=a,this.context=l,this.geometry=r.geometry,this.version=i.version,this.drawRange=null,this.attributes=null,this.pipeline=null,this.vertexBuffers=null,this.drawParams=null,this.bundle=null,this.updateClipping(l.clippingContext),this.clippingContextVersion=this.clippingContext.version,this.initialNodesCacheKey=this.getDynamicCacheKey(),this.initialCacheKey=this.getCacheKey(),this._nodeBuilderState=null,this._bindings=null,this._monitor=null,this.onDispose=null,this.isRenderObject=!0,this.onMaterialDispose=()=>{this.dispose()},this.material.addEventListener("dispose",this.onMaterialDispose)}updateClipping(t){const e=this.material;let n=this.clippingContext;Array.isArray(e.clippingPlanes)?(n!==t&&n||(n=new eE,this.clippingContext=n),n.update(t,e)):this.clippingContext!==t&&(this.clippingContext=t)}get clippingNeedsUpdate(){return this.clippingContext.version!==this.clippingContextVersion&&(this.clippingContextVersion=this.clippingContext.version,!0)}getNodeBuilderState(){return this._nodeBuilderState||(this._nodeBuilderState=this._nodes.getForRender(this))}getMonitor(){return this._monitor||(this._monitor=this.getNodeBuilderState().monitor)}getBindings(){return this._bindings||(this._bindings=this.getNodeBuilderState().createBindings())}getIndex(){return this._geometries.getIndex(this)}getIndirect(){return this._geometries.getIndirect(this)}getChainArray(){return[this.object,this.material,this.context,this.lightsNode]}getAttributes(){if(null!==this.attributes)return this.attributes;const t=this.getNodeBuilderState().nodeAttributes,e=this.geometry,n=[],r=new Set;for(const i of t){const t=i.node&&i.node.attribute?i.node.attribute:e.getAttribute(i.name);if(void 0===t)continue;n.push(t);const s=t.isInterleavedBufferAttribute?t.data:t;r.add(s)}return this.attributes=n,this.vertexBuffers=Array.from(r.values()),n}getVertexBuffers(){return null===this.vertexBuffers&&this.getAttributes(),this.vertexBuffers}getDrawParameters(){const{object:t,material:e,geometry:n,group:r,drawRange:i}=this,s=this.drawParams||(this.drawParams={vertexCount:0,firstVertex:0,instanceCount:0,firstInstance:0}),o=this.getIndex(),a=null!==o,l=n.isInstancedBufferGeometry?n.instanceCount:t.count>1?t.count:1;if(0===l)return null;if(s.instanceCount=l,!0===t.isBatchedMesh)return s;let u=1;!0!==e.wireframe||t.isPoints||t.isLineSegments||t.isLine||t.isLineLoop||(u=2);let c=i.start*u,h=(i.start+i.count)*u;null!==r&&(c=Math.max(c,r.start*u),h=Math.min(h,(r.start+r.count)*u));const d=n.attributes.position;let p=1/0;a?p=o.count:null!=d&&(p=d.count),c=Math.max(c,0),h=Math.min(h,p);const f=h-c;return f<0||f===1/0?null:(s.vertexCount=f,s.firstVertex=c,s)}getGeometryCacheKey(){const{geometry:t}=this;let e="";for(const n of Object.keys(t.attributes).sort()){const r=t.attributes[n];e+=n+",",r.data&&(e+=r.data.stride+","),r.offset&&(e+=r.offset+","),r.itemSize&&(e+=r.itemSize+","),r.normalized&&(e+="n,")}return t.index&&(e+="index,"),e}getMaterialCacheKey(){const{object:t,material:e}=this;let n=e.customProgramCacheKey();for(const t of function(t){const e=Object.keys(t);let n=Object.getPrototypeOf(t);for(;n;){const t=Object.getOwnPropertyDescriptors(n);for(const n in t)if(void 0!==t[n]){const r=t[n];r&&"function"==typeof r.get&&e.push(n)}n=Object.getPrototypeOf(n)}return e}(e)){if(/^(is[A-Z]|_)|^(visible|version|uuid|name|opacity|userData)$/.test(t))continue;const r=e[t];let i;if(null!==r){const t=typeof r;"number"===t?i=0!==r?"1":"0":"object"===t?(i="{",r.isTexture&&(i+=r.mapping),i+="}"):i=String(r)}else i=String(r);n+=i+","}return n+=this.clippingContext.cacheKey+",",t.geometry&&(n+=this.getGeometryCacheKey()),t.skeleton&&(n+=t.skeleton.bones.length+","),t.morphTargetInfluences&&(n+=t.morphTargetInfluences.length+","),t.isBatchedMesh&&(n+=t._matricesTexture.uuid+",",null!==t._colorsTexture&&(n+=t._colorsTexture.uuid+",")),t.count>1&&(n+=t.uuid+","),vm(n)}get needsUpdate(){return this.initialNodesCacheKey!==this.getDynamicCacheKey()||this.clippingNeedsUpdate}getDynamicCacheKey(){let t=this._nodes.getCacheKey(this.scene,this.lightsNode);return this.object.receiveShadow&&(t+=1),t}getCacheKey(){return this.getMaterialCacheKey()+this.getDynamicCacheKey()}dispose(){this.material.removeEventListener("dispose",this.onMaterialDispose),this.onDispose()}}const iE=[];class sE{constructor(t,e,n,r,i,s){this.renderer=t,this.nodes=e,this.geometries=n,this.pipelines=r,this.bindings=i,this.info=s,this.chainMaps={}}get(t,e,n,r,i,s,o){const a=this.getChainMap(o);iE[0]=t,iE[1]=e,iE[2]=s,iE[3]=i;let l=a.get(iE);return void 0===l?(l=this.createRenderObject(this.nodes,this.geometries,this.renderer,t,e,n,r,i,s,o),a.set(iE,l)):(l.updateClipping(s.clippingContext),(l.version!==e.version||l.needsUpdate)&&(l.initialCacheKey!==l.getCacheKey()?(l.dispose(),l=this.get(t,e,n,r,i,s,o)):l.version=e.version)),l}getChainMap(t="default"){return this.chainMaps[t]||(this.chainMaps[t]=new QM)}dispose(){this.chainMaps={}}createRenderObject(t,e,n,r,i,s,o,a,l,u){const c=this.getChainMap(u),h=new rE(t,e,n,r,i,s,o,a,l);return h.onDispose=()=>{this.pipelines.delete(h),this.bindings.delete(h),this.nodes.delete(h),c.delete(h.getChainArray())},h}}class oE{constructor(){this.data=new WeakMap}get(t){let e=this.data.get(t);return void 0===e&&(e={},this.data.set(t,e)),e}delete(t){let e;return this.data.has(t)&&(e=this.data.get(t),this.data.delete(t)),e}has(t){return this.data.has(t)}dispose(){this.data=new WeakMap}}const aE=1,lE=2,uE=3,cE=4,hE=16;class dE extends oE{constructor(t){super(),this.backend=t}delete(t){const e=super.delete(t);return void 0!==e&&this.backend.destroyAttribute(t),e}update(t,e){const n=this.get(t);if(void 0===n.version)e===aE?this.backend.createAttribute(t):e===lE?this.backend.createIndexAttribute(t):e===uE?this.backend.createStorageAttribute(t):e===cE&&this.backend.createIndirectStorageAttribute(t),n.version=this._getBufferAttribute(t).version;else{const e=this._getBufferAttribute(t);(n.version<e.version||e.usage===Wc)&&(this.backend.updateAttribute(t),n.version=e.version)}}_getBufferAttribute(t){return t.isInterleavedBufferAttribute&&(t=t.data),t}}function pE(t){return null!==t.index?t.index.version:t.attributes.position.version}function fE(t){const e=[],n=t.index,r=t.attributes.position;if(null!==n){const t=n.array;for(let n=0,r=t.length;n<r;n+=3){const r=t[n+0],i=t[n+1],s=t[n+2];e.push(r,i,i,s,s,r)}}else{for(let t=0,n=r.array.length/3-1;t<n;t+=3){const n=t+0,r=t+1,i=t+2;e.push(n,r,r,i,i,n)}}const i=new(function(t){for(let e=t.length-1;e>=0;--e)if(t[e]>=65535)return!0;return!1}(e)?dp:hp)(e,1);return i.version=pE(t),i}class mE extends oE{constructor(t,e){super(),this.attributes=t,this.info=e,this.wireframes=new WeakMap,this.attributeCall=new WeakMap}has(t){const e=t.geometry;return super.has(e)&&!0===this.get(e).initialized}updateForRender(t){!1===this.has(t)&&this.initGeometry(t),this.updateAttributes(t)}initGeometry(t){const e=t.geometry;this.get(e).initialized=!0,this.info.memory.geometries++;const n=()=>{this.info.memory.geometries--;const r=e.index,i=t.getAttributes();null!==r&&this.attributes.delete(r);for(const t of i)this.attributes.delete(t);const s=this.wireframes.get(e);void 0!==s&&this.attributes.delete(s),e.removeEventListener("dispose",n)};e.addEventListener("dispose",n)}updateAttributes(t){const e=t.getAttributes();for(const t of e)t.isStorageBufferAttribute||t.isStorageInstancedBufferAttribute?this.updateAttribute(t,uE):this.updateAttribute(t,aE);const n=this.getIndex(t);null!==n&&this.updateAttribute(n,lE);const r=t.geometry.indirect;null!==r&&this.updateAttribute(r,cE)}updateAttribute(t,e){const n=this.info.render.calls;t.isInterleavedBufferAttribute?void 0===this.attributeCall.get(t)?(this.attributes.update(t,e),this.attributeCall.set(t,n)):this.attributeCall.get(t.data)!==n&&(this.attributes.update(t,e),this.attributeCall.set(t.data,n),this.attributeCall.set(t,n)):this.attributeCall.get(t)!==n&&(this.attributes.update(t,e),this.attributeCall.set(t,n))}getIndirect(t){return t.geometry.indirect}getIndex(t){const{geometry:e,material:n}=t;let r=e.index;if(!0===n.wireframe){const t=this.wireframes;let n=t.get(e);void 0===n?(n=fE(e),t.set(e,n)):n.version!==pE(e)&&(this.attributes.delete(n),n=fE(e),t.set(e,n)),r=n}return r}}class gE{constructor(){this.autoReset=!0,this.frame=0,this.calls=0,this.render={calls:0,frameCalls:0,drawCalls:0,triangles:0,points:0,lines:0,timestamp:0,previousFrameCalls:0,timestampCalls:0},this.compute={calls:0,frameCalls:0,timestamp:0,previousFrameCalls:0,timestampCalls:0},this.memory={geometries:0,textures:0}}update(t,e,n){this.render.drawCalls++,t.isMesh||t.isSprite?this.render.triangles+=n*(e/3):t.isPoints?this.render.points+=n*e:t.isLineSegments?this.render.lines+=n*(e/2):t.isLine?this.render.lines+=n*(e-1):console.error("THREE.WebGPUInfo: Unknown object type.")}updateTimestamp(t,e){0===this[t].timestampCalls&&(this[t].timestamp=0),this[t].timestamp+=e,this[t].timestampCalls++,this[t].timestampCalls>=this[t].previousFrameCalls&&(this[t].timestampCalls=0)}reset(){const t=this.render.frameCalls;this.render.previousFrameCalls=t;const e=this.compute.frameCalls;this.compute.previousFrameCalls=e,this.render.drawCalls=0,this.render.frameCalls=0,this.compute.frameCalls=0,this.render.triangles=0,this.render.points=0,this.render.lines=0}dispose(){this.reset(),this.calls=0,this.render.calls=0,this.compute.calls=0,this.render.timestamp=0,this.compute.timestamp=0,this.memory.geometries=0,this.memory.textures=0}}class vE{constructor(t){this.cacheKey=t,this.usedTimes=0}}class yE extends vE{constructor(t,e,n){super(t),this.vertexProgram=e,this.fragmentProgram=n}}class _E extends vE{constructor(t,e){super(t),this.computeProgram=e,this.isComputePipeline=!0}}let xE=0;class bE{constructor(t,e,n=null,r=null){this.id=xE++,this.code=t,this.stage=e,this.transforms=n,this.attributes=r,this.usedTimes=0}}class wE extends oE{constructor(t,e){super(),this.backend=t,this.nodes=e,this.bindings=null,this.caches=new Map,this.programs={vertex:new Map,fragment:new Map,compute:new Map}}getForCompute(t,e){const{backend:n}=this,r=this.get(t);if(this._needsComputeUpdate(t)){const i=r.pipeline;i&&(i.usedTimes--,i.computeProgram.usedTimes--);const s=this.nodes.getForCompute(t);let o=this.programs.compute.get(s.computeShader);void 0===o&&(i&&0===i.computeProgram.usedTimes&&this._releaseProgram(i.computeProgram),o=new bE(s.computeShader,"compute",s.transforms,s.nodeAttributes),this.programs.compute.set(s.computeShader,o),n.createProgram(o));const a=this._getComputeCacheKey(t,o);let l=this.caches.get(a);void 0===l&&(i&&0===i.usedTimes&&this._releasePipeline(i),l=this._getComputePipeline(t,o,a,e)),l.usedTimes++,o.usedTimes++,r.version=t.version,r.pipeline=l}return r.pipeline}getForRender(t,e=null){const{backend:n}=this,r=this.get(t);if(this._needsRenderUpdate(t)){const i=r.pipeline;i&&(i.usedTimes--,i.vertexProgram.usedTimes--,i.fragmentProgram.usedTimes--);const s=t.getNodeBuilderState();let o=this.programs.vertex.get(s.vertexShader);void 0===o&&(i&&0===i.vertexProgram.usedTimes&&this._releaseProgram(i.vertexProgram),o=new bE(s.vertexShader,"vertex"),this.programs.vertex.set(s.vertexShader,o),n.createProgram(o));let a=this.programs.fragment.get(s.fragmentShader);void 0===a&&(i&&0===i.fragmentProgram.usedTimes&&this._releaseProgram(i.fragmentProgram),a=new bE(s.fragmentShader,"fragment"),this.programs.fragment.set(s.fragmentShader,a),n.createProgram(a));const l=this._getRenderCacheKey(t,o,a);let u=this.caches.get(l);void 0===u?(i&&0===i.usedTimes&&this._releasePipeline(i),u=this._getRenderPipeline(t,o,a,l,e)):t.pipeline=u,u.usedTimes++,o.usedTimes++,a.usedTimes++,r.pipeline=u}return r.pipeline}delete(t){const e=this.get(t).pipeline;return e&&(e.usedTimes--,0===e.usedTimes&&this._releasePipeline(e),e.isComputePipeline?(e.computeProgram.usedTimes--,0===e.computeProgram.usedTimes&&this._releaseProgram(e.computeProgram)):(e.fragmentProgram.usedTimes--,e.vertexProgram.usedTimes--,0===e.vertexProgram.usedTimes&&this._releaseProgram(e.vertexProgram),0===e.fragmentProgram.usedTimes&&this._releaseProgram(e.fragmentProgram))),super.delete(t)}dispose(){super.dispose(),this.caches=new Map,this.programs={vertex:new Map,fragment:new Map,compute:new Map}}updateForRender(t){this.getForRender(t)}_getComputePipeline(t,e,n,r){n=n||this._getComputeCacheKey(t,e);let i=this.caches.get(n);return void 0===i&&(i=new _E(n,e),this.caches.set(n,i),this.backend.createComputePipeline(i,r)),i}_getRenderPipeline(t,e,n,r,i){r=r||this._getRenderCacheKey(t,e,n);let s=this.caches.get(r);return void 0===s&&(s=new yE(r,e,n),this.caches.set(r,s),t.pipeline=s,this.backend.createRenderPipeline(t,i)),s}_getComputeCacheKey(t,e){return t.id+","+e.id}_getRenderCacheKey(t,e,n){return e.id+","+n.id+","+this.backend.getRenderCacheKey(t)}_releasePipeline(t){this.caches.delete(t.cacheKey)}_releaseProgram(t){const e=t.code,n=t.stage;this.programs[n].delete(e)}_needsComputeUpdate(t){const e=this.get(t);return void 0===e.pipeline||e.version!==t.version}_needsRenderUpdate(t){return void 0===this.get(t).pipeline||this.backend.needsRenderUpdate(t)}}class SE extends oE{constructor(t,e,n,r,i,s){super(),this.backend=t,this.textures=n,this.pipelines=i,this.attributes=r,this.nodes=e,this.info=s,this.pipelines.bindings=this}getForRender(t){const e=t.getBindings();for(const t of e){const n=this.get(t);void 0===n.bindGroup&&(this._init(t),this.backend.createBindings(t,e),n.bindGroup=t)}return e}getForCompute(t){const e=this.nodes.getForCompute(t).bindings;for(const t of e){const n=this.get(t);void 0===n.bindGroup&&(this._init(t),this.backend.createBindings(t,e),n.bindGroup=t)}return e}updateForCompute(t){this._updateBindings(this.getForCompute(t))}updateForRender(t){this._updateBindings(this.getForRender(t))}_updateBindings(t){for(const e of t)this._update(e,t)}_init(t){for(const e of t.bindings)if(e.isSampledTexture)this.textures.updateTexture(e.texture);else if(e.isStorageBuffer){const t=e.attribute,n=t.isIndirectStorageBufferAttribute?cE:uE;this.attributes.update(t,n)}}_update(t,e){const{backend:n}=this;let r=!1;for(const e of t.bindings){if(e.isNodeUniformsGroup){if(!this.nodes.updateGroup(e))continue}if(e.isUniformBuffer){e.update()&&n.updateBinding(e)}else if(e.isSampler)e.update();else if(e.isSampledTexture){e.needsBindingsUpdate(this.textures.get(e.texture).generation)&&(r=!0);const t=e.update(),i=e.texture;t&&this.textures.updateTexture(i);const s=n.get(i);if(!0===n.isWebGPUBackend&&void 0===s.texture&&void 0===s.externalTexture&&(console.error("Bindings._update: binding should be available:",e,t,i,e.textureNode.value,r),this.textures.updateTexture(i),r=!0),!0===i.isStorageTexture){const t=this.get(i);!0===e.store?t.needsMipmap=!0:this.textures.needsMipmaps(i)&&!0===t.needsMipmap&&(this.backend.generateMipmaps(i),t.needsMipmap=!1)}}}!0===r&&this.backend.updateBindings(t,e)}}function ME(t,e){return t.groupOrder!==e.groupOrder?t.groupOrder-e.groupOrder:t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.material.id!==e.material.id?t.material.id-e.material.id:t.z!==e.z?t.z-e.z:t.id-e.id}function EE(t,e){return t.groupOrder!==e.groupOrder?t.groupOrder-e.groupOrder:t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.z!==e.z?e.z-t.z:t.id-e.id}function TE(t){return(t.transmission>0||t.transmissionNode)&&2===t.side&&!1===t.forceSinglePass}class AE{constructor(t,e,n){this.renderItems=[],this.renderItemsIndex=0,this.opaque=[],this.transparentDoublePass=[],this.transparent=[],this.bundles=[],this.lightsNode=t.getNode(e,n),this.lightsArray=[],this.scene=e,this.camera=n,this.occlusionQueryCount=0}begin(){return this.renderItemsIndex=0,this.opaque.length=0,this.transparentDoublePass.length=0,this.transparent.length=0,this.bundles.length=0,this.lightsArray.length=0,this.occlusionQueryCount=0,this}getNextRenderItem(t,e,n,r,i,s){let o=this.renderItems[this.renderItemsIndex];return void 0===o?(o={id:t.id,object:t,geometry:e,material:n,groupOrder:r,renderOrder:t.renderOrder,z:i,group:s},this.renderItems[this.renderItemsIndex]=o):(o.id=t.id,o.object=t,o.geometry=e,o.material=n,o.groupOrder=r,o.renderOrder=t.renderOrder,o.z=i,o.group=s),this.renderItemsIndex++,o}push(t,e,n,r,i,s){const o=this.getNextRenderItem(t,e,n,r,i,s);!0===t.occlusionTest&&this.occlusionQueryCount++,!0===n.transparent||n.transmission>0?(TE(n)&&this.transparentDoublePass.push(o),this.transparent.push(o)):this.opaque.push(o)}unshift(t,e,n,r,i,s){const o=this.getNextRenderItem(t,e,n,r,i,s);!0===n.transparent||n.transmission>0?(TE(n)&&this.transparentDoublePass.unshift(o),this.transparent.unshift(o)):this.opaque.unshift(o)}pushBundle(t){this.bundles.push(t)}pushLight(t){this.lightsArray.push(t)}sort(t,e){this.opaque.length>1&&this.opaque.sort(t||ME),this.transparentDoublePass.length>1&&this.transparentDoublePass.sort(e||EE),this.transparent.length>1&&this.transparent.sort(e||EE)}finish(){this.lightsNode.setLights(this.lightsArray);for(let t=this.renderItemsIndex,e=this.renderItems.length;t<e;t++){const e=this.renderItems[t];if(null===e.id)break;e.id=null,e.object=null,e.geometry=null,e.material=null,e.groupOrder=null,e.renderOrder=null,e.z=null,e.group=null}}}class CE{constructor(t){this.lighting=t,this.lists=new QM}get(t,e){const n=this.lists,r=[t,e];let i=n.get(r);return void 0===i&&(i=new AE(this.lighting,t,e),n.set(r,i)),i}dispose(){this.lists=new QM}}let RE=0;class NE{constructor(){this.id=RE++,this.color=!0,this.clearColor=!0,this.clearColorValue={r:0,g:0,b:0,a:1},this.depth=!0,this.clearDepth=!0,this.clearDepthValue=1,this.stencil=!1,this.clearStencil=!0,this.clearStencilValue=1,this.viewport=!1,this.viewportValue=new Th,this.scissor=!1,this.scissorValue=new Th,this.textures=null,this.depthTexture=null,this.activeCubeFace=0,this.sampleCount=1,this.width=0,this.height=0,this.isRenderContext=!0}getCacheKey(){return PE(this)}}function PE(t){const{textures:e,activeCubeFace:n}=t,r=[n];for(const t of e)r.push(t.id);return ym(r)}class IE{constructor(){this.chainMaps={}}get(t,e,n=null){const r=[t,e];let i;if(null===n)i="default";else{const t=n.texture.format;i=`${n.textures.length}:${t}:${n.samples}:${n.depthBuffer}:${n.stencilBuffer}`}const s=this.getChainMap(i);let o=s.get(r);return void 0===o&&(o=new NE,s.set(r,o)),null!==n&&(o.sampleCount=0===n.samples?1:n.samples),o}getChainMap(t){return this.chainMaps[t]||(this.chainMaps[t]=new QM)}dispose(){this.chainMaps={}}}const OE=new Ph;class DE extends oE{constructor(t,e,n){super(),this.renderer=t,this.backend=e,this.info=n}updateRenderTarget(t,e=0){const n=this.get(t),r=0===t.samples?1:t.samples,i=n.depthTextureMips||(n.depthTextureMips={}),s=t.textures,o=this.getSize(s[0]),a=o.width>>e,l=o.height>>e;let u=t.depthTexture||i[e];const c=!0===t.depthBuffer||!0===t.stencilBuffer;let h=!1;void 0===u&&c&&(u=new df,u.format=t.stencilBuffer?sc:ic,u.type=t.stencilBuffer?ec:Ju,u.image.width=a,u.image.height=l,i[e]=u),n.width===o.width&&o.height===n.height||(h=!0,u&&(u.needsUpdate=!0,u.image.width=a,u.image.height=l)),n.width=o.width,n.height=o.height,n.textures=s,n.depthTexture=u||null,n.depth=t.depthBuffer,n.stencil=t.stencilBuffer,n.renderTarget=t,n.sampleCount!==r&&(h=!0,u&&(u.needsUpdate=!0),n.sampleCount=r);const d={sampleCount:r};for(let t=0;t<s.length;t++){const e=s[t];h&&(e.needsUpdate=!0),this.updateTexture(e,d)}if(u&&this.updateTexture(u,d),!0!==n.initialized){n.initialized=!0;const e=()=>{t.removeEventListener("dispose",e);for(let t=0;t<s.length;t++)this._destroyTexture(s[t]);u&&this._destroyTexture(u),this.delete(t)};t.addEventListener("dispose",e)}}updateTexture(t,e={}){const n=this.get(t);if(!0===n.initialized&&n.version===t.version)return;const r=t.isRenderTargetTexture||t.isDepthTexture||t.isFramebufferTexture,i=this.backend;if(r&&!0===n.initialized&&(i.destroySampler(t),i.destroyTexture(t)),t.isFramebufferTexture){const e=this.renderer.getRenderTarget();t.type=e?e.texture.type:Xu}const{width:s,height:o,depth:a}=this.getSize(t);if(e.width=s,e.height=o,e.depth=a,e.needsMipmaps=this.needsMipmaps(t),e.levels=e.needsMipmaps?this.getMipLevels(t,s,o):1,r||!0===t.isStorageTexture)i.createSampler(t),i.createTexture(t,e),n.generation=t.version;else{if(!0!==n.initialized&&i.createSampler(t),t.version>0){const r=t.image;if(void 0===r)console.warn("THREE.Renderer: Texture marked for update but image is undefined.");else if(!1===r.complete)console.warn("THREE.Renderer: Texture marked for update but image is incomplete.");else{if(t.images){const n=[];for(const e of t.images)n.push(e);e.images=n}else e.image=r;void 0!==n.isDefaultTexture&&!0!==n.isDefaultTexture||(i.createTexture(t,e),n.isDefaultTexture=!1,n.generation=t.version),!0===t.source.dataReady&&i.updateTexture(t,e),e.needsMipmaps&&0===t.mipmaps.length&&i.generateMipmaps(t)}}else i.createDefaultTexture(t),n.isDefaultTexture=!0,n.generation=t.version}if(!0!==n.initialized){n.initialized=!0,n.generation=t.version,this.info.memory.textures++;const e=()=>{t.removeEventListener("dispose",e),this._destroyTexture(t),this.info.memory.textures--};t.addEventListener("dispose",e)}n.version=t.version}getSize(t,e=OE){let n=t.images?t.images[0]:t.image;return n?(void 0!==n.image&&(n=n.image),e.width=n.width,e.height=n.height,e.depth=t.isCubeTexture?6:n.depth||1):e.width=e.height=e.depth=1,e}getMipLevels(t,e,n){let r;return r=t.isCompressedTexture?t.mipmaps.length:Math.floor(Math.log2(Math.max(e,n)))+1,r}needsMipmaps(t){return this.isEnvironmentTexture(t)||!0===t.isCompressedTexture||t.generateMipmaps}isEnvironmentTexture(t){const e=t.mapping;return e===Lu||e===Uu||e===Ou||e===Du}_destroyTexture(t){this.backend.destroySampler(t),this.backend.destroyTexture(t),this.delete(t)}}class LE extends Qd{constructor(t,e,n,r=1){super(t,e,n),this.a=r}set(t,e,n,r=1){return this.a=r,super.set(t,e,n)}copy(t){return void 0!==t.a&&(this.a=t.a),super.copy(t)}clone(){return new this.constructor(this.r,this.g,this.b,this.a)}}class UE extends rv{static get type(){return"ParameterNode"}constructor(t,e=null){super(t,e),this.isParameterNode=!0}getHash(){return this.uuid}generate(){return this.name}}class kE extends Lm{static get type(){return"StackNode"}constructor(t=null){super(),this.nodes=[],this.outputNode=null,this.parent=t,this._currentCond=null,this.isStackNode=!0}getNodeType(t){return this.outputNode?this.outputNode.getNodeType(t):"void"}add(t){return this.nodes.push(t),this}If(t,e){const n=new _g(e);return this._currentCond=l_(t,n),this.add(this._currentCond)}ElseIf(t,e){const n=new _g(e),r=l_(t,n);return this._currentCond.elseNode=r,this._currentCond=r,this}Else(t){return this._currentCond.elseNode=new _g(t),this}build(t,...e){const n=Ag();Tg(this);for(const e of this.nodes)e.build(t,"void");return Tg(n),this.outputNode?this.outputNode.build(t,...e):super.build(t,...e)}else(...t){return console.warn("TSL.StackNode: .else() has been renamed to .Else()."),this.Else(...t)}elseif(...t){return console.warn("TSL.StackNode: .elseif() has been renamed to .ElseIf()."),this.ElseIf(...t)}}const BE=Sg(kE);new sf,new Ph,new Ph,new Ph,new ad,new Ph(0,0,-1),new Th,new Ph,new Ph,new Th,new oh;const FE=new Ah;mw.flipX();FE.depthTexture=new df(1,1);const zE=new Qf(-1,1,1,-1,0,1);class VE extends wp{constructor(t=!1){super();const e=!1===t?[0,-1,0,1,2,1]:[0,2,0,0,2,0];this.setAttribute("position",new fp([-1,3,0,-1,-1,0,3,-1,0],3)),this.setAttribute("uv",new fp(e,2))}}const GE=new VE;class jE extends Dp{constructor(t=null){super(GE,t),this.camera=zE,this.isQuadMesh=!0}renderAsync(t){return t.renderAsync(this,zE)}render(t){t.render(this,zE)}}const HE=new vd,WE=new ad;class qE extends Lm{static get type(){return"SceneNode"}constructor(t=qE.BACKGROUND_BLURRINESS,e=null){super(),this.scope=t,this.scene=e}setup(t){const e=this.scope,n=null!==this.scene?this.scene:t.scene;let r;return e===qE.BACKGROUND_BLURRINESS?r=Vx("backgroundBlurriness","float",n):e===qE.BACKGROUND_INTENSITY?r=Vx("backgroundIntensity","float",n):e===qE.BACKGROUND_ROTATION?r=nv("mat4").label("backgroundRotation").setGroup(Qg).onRenderUpdate((()=>{const t=n.background;return null!==t&&t.isTexture&&t.mapping!==Iu?(HE.copy(n.backgroundRotation),HE.x*=-1,HE.y*=-1,HE.z*=-1,WE.makeRotationFromEuler(HE)):WE.identity(),WE})):console.error("THREE.SceneNode: Unknown scope:",e),r}}qE.BACKGROUND_BLURRINESS="backgroundBlurriness",qE.BACKGROUND_INTENSITY="backgroundIntensity",qE.BACKGROUND_ROTATION="backgroundRotation";const XE=Mg(qE,qE.BACKGROUND_BLURRINESS),ZE=Mg(qE,qE.BACKGROUND_INTENSITY),$E=Mg(qE,qE.BACKGROUND_ROTATION);const YE="point-list",KE="line-list",JE="line-strip",QE="triangle-list",tT="triangle-strip",eT="never",nT="less",rT="equal",iT="less-equal",sT="greater",oT="not-equal",aT="greater-equal",lT="always",uT="store",cT="load",hT="clear",dT="ccw",pT="none",fT="front",mT="back",gT="uint16",vT="uint32",yT={R8Unorm:"r8unorm",R8Snorm:"r8snorm",R8Uint:"r8uint",R8Sint:"r8sint",R16Uint:"r16uint",R16Sint:"r16sint",R16Float:"r16float",RG8Unorm:"rg8unorm",RG8Snorm:"rg8snorm",RG8Uint:"rg8uint",RG8Sint:"rg8sint",R32Uint:"r32uint",R32Sint:"r32sint",R32Float:"r32float",RG16Uint:"rg16uint",RG16Sint:"rg16sint",RG16Float:"rg16float",RGBA8Unorm:"rgba8unorm",RGBA8UnormSRGB:"rgba8unorm-srgb",RGBA8Snorm:"rgba8snorm",RGBA8Uint:"rgba8uint",RGBA8Sint:"rgba8sint",BGRA8Unorm:"bgra8unorm",BGRA8UnormSRGB:"bgra8unorm-srgb",RGB9E5UFloat:"rgb9e5ufloat",RGB10A2Unorm:"rgb10a2unorm",RG11B10uFloat:"rgb10a2unorm",RG32Uint:"rg32uint",RG32Sint:"rg32sint",RG32Float:"rg32float",RGBA16Uint:"rgba16uint",RGBA16Sint:"rgba16sint",RGBA16Float:"rgba16float",RGBA32Uint:"rgba32uint",RGBA32Sint:"rgba32sint",RGBA32Float:"rgba32float",Stencil8:"stencil8",Depth16Unorm:"depth16unorm",Depth24Plus:"depth24plus",Depth24PlusStencil8:"depth24plus-stencil8",Depth32Float:"depth32float",Depth32FloatStencil8:"depth32float-stencil8",BC1RGBAUnorm:"bc1-rgba-unorm",BC1RGBAUnormSRGB:"bc1-rgba-unorm-srgb",BC2RGBAUnorm:"bc2-rgba-unorm",BC2RGBAUnormSRGB:"bc2-rgba-unorm-srgb",BC3RGBAUnorm:"bc3-rgba-unorm",BC3RGBAUnormSRGB:"bc3-rgba-unorm-srgb",BC4RUnorm:"bc4-r-unorm",BC4RSnorm:"bc4-r-snorm",BC5RGUnorm:"bc5-rg-unorm",BC5RGSnorm:"bc5-rg-snorm",BC6HRGBUFloat:"bc6h-rgb-ufloat",BC6HRGBFloat:"bc6h-rgb-float",BC7RGBAUnorm:"bc7-rgba-unorm",BC7RGBAUnormSRGB:"bc7-rgba-srgb",ETC2RGB8Unorm:"etc2-rgb8unorm",ETC2RGB8UnormSRGB:"etc2-rgb8unorm-srgb",ETC2RGB8A1Unorm:"etc2-rgb8a1unorm",ETC2RGB8A1UnormSRGB:"etc2-rgb8a1unorm-srgb",ETC2RGBA8Unorm:"etc2-rgba8unorm",ETC2RGBA8UnormSRGB:"etc2-rgba8unorm-srgb",EACR11Unorm:"eac-r11unorm",EACR11Snorm:"eac-r11snorm",EACRG11Unorm:"eac-rg11unorm",EACRG11Snorm:"eac-rg11snorm",ASTC4x4Unorm:"astc-4x4-unorm",ASTC4x4UnormSRGB:"astc-4x4-unorm-srgb",ASTC5x4Unorm:"astc-5x4-unorm",ASTC5x4UnormSRGB:"astc-5x4-unorm-srgb",ASTC5x5Unorm:"astc-5x5-unorm",ASTC5x5UnormSRGB:"astc-5x5-unorm-srgb",ASTC6x5Unorm:"astc-6x5-unorm",ASTC6x5UnormSRGB:"astc-6x5-unorm-srgb",ASTC6x6Unorm:"astc-6x6-unorm",ASTC6x6UnormSRGB:"astc-6x6-unorm-srgb",ASTC8x5Unorm:"astc-8x5-unorm",ASTC8x5UnormSRGB:"astc-8x5-unorm-srgb",ASTC8x6Unorm:"astc-8x6-unorm",ASTC8x6UnormSRGB:"astc-8x6-unorm-srgb",ASTC8x8Unorm:"astc-8x8-unorm",ASTC8x8UnormSRGB:"astc-8x8-unorm-srgb",ASTC10x5Unorm:"astc-10x5-unorm",ASTC10x5UnormSRGB:"astc-10x5-unorm-srgb",ASTC10x6Unorm:"astc-10x6-unorm",ASTC10x6UnormSRGB:"astc-10x6-unorm-srgb",ASTC10x8Unorm:"astc-10x8-unorm",ASTC10x8UnormSRGB:"astc-10x8-unorm-srgb",ASTC10x10Unorm:"astc-10x10-unorm",ASTC10x10UnormSRGB:"astc-10x10-unorm-srgb",ASTC12x10Unorm:"astc-12x10-unorm",ASTC12x10UnormSRGB:"astc-12x10-unorm-srgb",ASTC12x12Unorm:"astc-12x12-unorm",ASTC12x12UnormSRGB:"astc-12x12-unorm-srgb"},_T="clamp-to-edge",xT="repeat",bT="mirror-repeat",wT="linear",ST="nearest",MT="zero",ET="one",TT="src",AT="one-minus-src",CT="src-alpha",RT="one-minus-src-alpha",NT="dst",PT="one-minus-dst",IT="dst-alpha",OT="one-minus-dst-alpha",DT="src-alpha-saturated",LT="constant",UT="one-minus-constant",kT="add",BT="subtract",FT="reverse-subtract",zT="min",VT="max",GT=0,jT=15,HT="keep",WT="zero",qT="replace",XT="invert",ZT="increment-clamp",$T="decrement-clamp",YT="increment-wrap",KT="decrement-wrap",JT="storage",QT="read-only-storage",tA="write-only",eA="read-only",nA="float",rA="unfilterable-float",iA="depth",sA="sint",oA="uint",aA="2d",lA="3d",uA="2d",cA="2d-array",hA="cube",dA="3d",pA="all",fA="vertex",mA="instance",gA={DepthClipControl:"depth-clip-control",Depth32FloatStencil8:"depth32float-stencil8",TextureCompressionBC:"texture-compression-bc",TextureCompressionETC2:"texture-compression-etc2",TextureCompressionASTC:"texture-compression-astc",TimestampQuery:"timestamp-query",IndirectFirstInstance:"indirect-first-instance",ShaderF16:"shader-f16",RG11B10UFloat:"rg11b10ufloat-renderable",BGRA8UNormStorage:"bgra8unorm-storage",Float32Filterable:"float32-filterable",ClipDistances:"clip-distances",DualSourceBlending:"dual-source-blending",Subgroups:"subgroups"};new WeakMap;const vA=new oh;class yA extends $_{static get type(){return"PassTextureNode"}constructor(t,e){super(e),this.passNode=t,this.setUpdateMatrix(!1)}setup(t){return t.object.isQuadMesh&&this.passNode.build(t),super.setup(t)}clone(){return new this.constructor(this.passNode,this.value)}}class _A extends yA{static get type(){return"PassMultipleTextureNode"}constructor(t,e,n=!1){super(t,null),this.textureName=e,this.previousTexture=n}updateTexture(){this.value=this.previousTexture?this.passNode.getPreviousTexture(this.textureName):this.passNode.getTexture(this.textureName)}setup(t){return this.updateTexture(),super.setup(t)}clone(){return new this.constructor(this.passNode,this.textureName,this.previousTexture)}}class xA extends Bm{static get type(){return"PassNode"}constructor(t,e,n,r={}){super("vec4"),this.scope=t,this.scene=e,this.camera=n,this.options=r,this._pixelRatio=1,this._width=1,this._height=1;const i=new df;i.isRenderTargetTexture=!0,i.name="depth";const s=new Ah(this._width*this._pixelRatio,this._height*this._pixelRatio,{type:tc,...r});s.texture.name="output",s.depthTexture=i,this.renderTarget=s,this.updateBeforeType=Cm,this._textures={output:s.texture,depth:i},this._textureNodes={},this._linearDepthNodes={},this._viewZNodes={},this._previousTextures={},this._previousTextureNodes={},this._cameraNear=nv(0),this._cameraFar=nv(0),this._mrt=null,this.isPassNode=!0}setMRT(t){return this._mrt=t,this}getMRT(){return this._mrt}isGlobal(){return!0}getTexture(t){let e=this._textures[t];if(void 0===e){e=this.renderTarget.texture.clone(),e.isRenderTargetTexture=!0,e.name=t,this._textures[t]=e,this.renderTarget.textures.push(e)}return e}getPreviousTexture(t){let e=this._previousTextures[t];return void 0===e&&(e=this.getTexture(t).clone(),e.isRenderTargetTexture=!0,this._previousTextures[t]=e),e}toggleTexture(t){const e=this._previousTextures[t];if(void 0!==e){const n=this._textures[t],r=this.renderTarget.textures.indexOf(n);this.renderTarget.textures[r]=e,this._textures[t]=e,this._previousTextures[t]=n,this._textureNodes[t].updateTexture(),this._previousTextureNodes[t].updateTexture()}}getTextureNode(t="output"){let e=this._textureNodes[t];return void 0===e&&(e=xg(new _A(this,t)),e.updateTexture(),this._textureNodes[t]=e),e}getPreviousTextureNode(t="output"){let e=this._previousTextureNodes[t];return void 0===e&&(void 0===this._textureNodes[t]&&this.getTextureNode(t),e=xg(new _A(this,t,!0)),e.updateTexture(),this._previousTextureNodes[t]=e),e}getViewZNode(t="depth"){let e=this._viewZNodes[t];if(void 0===e){const n=this._cameraNear,r=this._cameraFar;this._viewZNodes[t]=e=Cw(this.getTextureNode(t),n,r)}return e}getLinearDepthNode(t="depth"){let e=this._linearDepthNodes[t];if(void 0===e){const n=this._cameraNear,r=this._cameraFar,i=this.getViewZNode(t);this._linearDepthNodes[t]=e=Tw(i,n,r)}return e}setup({renderer:t}){return this.renderTarget.samples=void 0===this.options.samples?t.samples:this.options.samples,!0===t.backend.isWebGLBackend&&(this.renderTarget.samples=0),this.renderTarget.depthTexture.isMultisampleRenderTargetTexture=this.renderTarget.samples>1,this.scope===xA.COLOR?this.getTextureNode():this.getLinearDepthNode()}updateBefore(t){const{renderer:e}=t,{scene:n,camera:r}=this;this._pixelRatio=e.getPixelRatio();const i=e.getSize(vA);this.setSize(i.width,i.height);const s=e.getRenderTarget(),o=e.getMRT();this._cameraNear.value=r.near,this._cameraFar.value=r.far;for(const t in this._previousTextures)this.toggleTexture(t);e.setRenderTarget(this.renderTarget),e.setMRT(this._mrt),e.render(n,r),e.setRenderTarget(s),e.setMRT(o)}setSize(t,e){this._width=t,this._height=e;const n=this._width*this._pixelRatio,r=this._height*this._pixelRatio;this.renderTarget.setSize(n,r)}setPixelRatio(t){this._pixelRatio=t,this.setSize(this._width,this._height)}dispose(){this.renderTarget.dispose()}}xA.COLOR="color",xA.DEPTH="depth";const bA=Eg((([t,e])=>t.mul(e).clamp())).setLayout({name:"linearToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),wA=Eg((([t,e])=>(t=t.mul(e)).div(t.add(1)).clamp())).setLayout({name:"reinhardToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),SA=Eg((([t,e])=>{const n=(t=(t=t.mul(e)).sub(.004).max(0)).mul(t.mul(6.2).add(.5)),r=t.mul(t.mul(6.2).add(1.7)).add(.06);return n.div(r).pow(2.2)})).setLayout({name:"cineonToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),MA=Eg((([t])=>{const e=t.mul(t.add(.0245786)).sub(90537e-9),n=t.mul(t.add(.432951).mul(.983729)).add(.238081);return e.div(n)})),EA=Eg((([t,e])=>{const n=Xg(.59719,.35458,.04823,.076,.90834,.01566,.0284,.13383,.83777),r=Xg(1.60475,-.53108,-.07367,-.10208,1.10813,-.00605,-.00327,-.07276,1.07602);return t=t.mul(e).div(.6),t=n.mul(t),t=MA(t),(t=r.mul(t)).clamp()})).setLayout({name:"acesFilmicToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),TA=Xg(Bg(1.6605,-.1246,-.0182),Bg(-.5876,1.1329,-.1006),Bg(-.0728,-.0083,1.1187)),AA=Xg(Bg(.6274,.0691,.0164),Bg(.3293,.9195,.088),Bg(.0433,.0113,.8956)),CA=Eg((([t])=>{const e=Bg(t).toVar(),n=Bg(e.mul(e)).toVar(),r=Bg(n.mul(n)).toVar();return Ng(15.5).mul(r.mul(n)).sub(Bv(40.14,r.mul(e))).add(Bv(31.96,r).sub(Bv(6.868,n.mul(e))).add(Bv(.4298,n).add(Bv(.1191,e).sub(.00232))))})),RA=Eg((([t,e])=>{const n=Bg(t).toVar(),r=Xg(Bg(.856627153315983,.137318972929847,.11189821299995),Bg(.0951212405381588,.761241990602591,.0767994186031903),Bg(.0482516061458583,.101439036467562,.811302368396859)),i=Xg(Bg(1.1271005818144368,-.1413297634984383,-.14132976349843826),Bg(-.11060664309660323,1.157823702216272,-.11060664309660294),Bg(-.016493938717834573,-.016493938717834257,1.2519364065950405)),s=Ng(-12.47393),o=Ng(4.026069);return n.mulAssign(e),n.assign(AA.mul(n)),n.assign(r.mul(n)),n.assign(Vy(n,1e-10)),n.assign(fy(n)),n.assign(n.sub(s).div(o.sub(s))),n.assign(n_(n,0,1)),n.assign(CA(n)),n.assign(i.mul(n)),n.assign($y(Vy(Bg(0),n),Bg(2.2))),n.assign(TA.mul(n)),n.assign(n_(n,0,1)),n})).setLayout({name:"agxToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),NA=Eg((([t,e])=>{const n=Ng(.76),r=Ng(.15);t=t.mul(e);const i=zy(t.r,zy(t.g,t.b)),s=l_(i.lessThan(.08),i.sub(Bv(6.25,i.mul(i))),.04);t.subAssign(s);const o=Vy(t.r,Vy(t.g,t.b));Cg(o.lessThan(n),(()=>t));const a=kv(1,n),l=kv(1,a.mul(a).div(o.add(a.sub(n))));t.mulAssign(l.div(o));const u=kv(1,Fv(1,r.mul(o.sub(l)).add(1)));return e_(t,Bg(l),u)})).setLayout({name:"neutralToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]});class PA extends Lm{static get type(){return"CodeNode"}constructor(t="",e=[],n=""){super("code"),this.isCodeNode=!0,this.code=t,this.language=n,this.includes=e}isGlobal(){return!0}setIncludes(t){return this.includes=t,this}getIncludes(){return this.includes}generate(t){const e=this.getIncludes(t);for(const n of e)n.build(t);const n=t.getCodeFromNode(this,this.getNodeType(t));return n.code=this.code,n.code}serialize(t){super.serialize(t),t.code=this.code,t.language=this.language}deserialize(t){super.deserialize(t),this.code=t.code,this.language=t.language}}class IA extends PA{static get type(){return"FunctionNode"}constructor(t="",e=[],n=""){super(t,e,n)}getNodeType(t){return this.getNodeFunction(t).type}getInputs(t){return this.getNodeFunction(t).inputs}getNodeFunction(t){const e=t.getDataFromNode(this);let n=e.nodeFunction;return void 0===n&&(n=t.parser.parseFunction(this.code),e.nodeFunction=n),n}generate(t,e){super.generate(t);const n=this.getNodeFunction(t),r=n.name,i=n.type,s=t.getCodeFromNode(this,i);""!==r&&(s.name=r);const o=t.getPropertyName(s),a=this.getNodeFunction(t).getCode(o);return s.code=a+"\n","property"===e?o:t.format(`${o}()`,i,e)}}class OA extends Map{get(t,e=null,...n){if(this.has(t))return super.get(t);if(null!==e){const r=e(...n);return this.set(t,r),r}}}new OA;class DA extends Lm{static get type(){return"FogNode"}constructor(t,e){super("float"),this.isFogNode=!0,this.colorNode=t,this.factorNode=e}getViewZNode(t){let e;const n=t.context.getViewZ;return void 0!==n&&(e=n(this)),(e||px.z).negate()}setup(){return this.factorNode}}class LA extends DA{static get type(){return"FogRangeNode"}constructor(t,e,n){super(t),this.isFogRangeNode=!0,this.nearNode=e,this.farNode=n}setup(t){const e=this.getViewZNode(t);return i_(this.nearNode,this.farNode,e)}}const UA=Sg(LA);class kA extends DA{static get type(){return"FogExp2Node"}constructor(t,e){super(t),this.isFogExp2Node=!0,this.densityNode=e}setup(t){const e=this.getViewZNode(t),n=this.densityNode;return n.mul(n,e,e).negate().exp().oneMinus()}}const BA=Sg(kA);Sg(class extends Lm{constructor(t){super(),this.scope=t}generate(t){const{scope:e}=this,{renderer:n}=t;!0===n.backend.isWebGLBackend?t.addFlowCode(`\t// ${e}Barrier \n`):t.addLineFlowCode(`${e}Barrier()`,this)}});class FA extends Bm{static get type(){return"AtomicFunctionNode"}constructor(t,e,n,r=null){super("uint"),this.method=t,this.pointerNode=e,this.valueNode=n,this.storeNode=r}getInputType(t){return this.pointerNode.getNodeType(t)}getNodeType(t){return this.getInputType(t)}generate(t){const e=this.method,n=this.getNodeType(t),r=this.getInputType(t),i=this.pointerNode,s=this.valueNode,o=[];o.push(`&${i.build(t,r)}`),o.push(s.build(t,r));const a=`${t.getMethod(e,n)}( ${o.join(", ")} )`;if(null!==this.storeNode){const e=this.storeNode.build(t,r);t.addLineFlowCode(`${e} = ${a}`,this)}else t.addLineFlowCode(a,this)}}FA.ATOMIC_LOAD="atomicLoad",FA.ATOMIC_STORE="atomicStore",FA.ATOMIC_ADD="atomicAdd",FA.ATOMIC_SUB="atomicSub",FA.ATOMIC_MAX="atomicMax",FA.ATOMIC_MIN="atomicMin",FA.ATOMIC_AND="atomicAnd",FA.ATOMIC_OR="atomicOr",FA.ATOMIC_XOR="atomicXor";Sg(FA);let zA;function VA(t){zA=zA||new WeakMap;let e=zA.get(t);return void 0===e&&zA.set(t,e={}),e}function GA(t){const e=VA(t);return e.position||(e.position=nv(new Ph).setGroup(Qg).onRenderUpdate(((e,n)=>n.value.setFromMatrixPosition(t.matrixWorld))))}function jA(t){const e=VA(t);return e.viewPosition||(e.viewPosition=nv(new Ph).setGroup(Qg).onRenderUpdate((({camera:e},n)=>{n.value=n.value||new Ph,n.value.setFromMatrixPosition(t.matrixWorld),n.value.applyMatrix4(e.matrixWorldInverse)})))}const HA=t=>ex.transformDirection(GA(t).sub(function(t){const e=VA(t);return e.targetPosition||(e.targetPosition=nv(new Ph).setGroup(Qg).onRenderUpdate(((e,n)=>n.value.setFromMatrixPosition(t.target.matrixWorld))))}(t))),WA=(t,e)=>{for(const n of e)if(n.isAnalyticLightNode&&n.light.id===t)return n;return null},qA=new WeakMap;class XA extends Lm{static get type(){return"LightsNode"}constructor(){super("vec3"),this.totalDiffuseNode=Bg().toVar("totalDiffuse"),this.totalSpecularNode=Bg().toVar("totalSpecular"),this.outgoingLightNode=Bg().toVar("outgoingLight"),this._lights=[],this._lightNodes=null,this._lightNodesHash=null,this.global=!0}getHash(t){if(null===this._lightNodesHash){null===this._lightNodes&&this.setupLightsNode(t);const e=[];for(const t of this._lightNodes)e.push(t.getSelf().getHash());this._lightNodesHash="lights-"+e.join(",")}return this._lightNodesHash}analyze(t){const e=t.getDataFromNode(this);for(const n of e.nodes)n.build(t)}setupLightsNode(t){const e=[],n=this._lightNodes,r=(t=>t.sort(((t,e)=>t.id-e.id)))(this._lights),i=t.renderer.library;for(const t of r)if(t.isNode)e.push(xg(t));else{let r=null;if(null!==n&&(r=WA(t.id,n)),null===r){const n=i.getLightNodeClass(t.constructor);if(null===n){console.warn(`LightsNode.setupNodeLights: Light node not found for ${t.constructor.name}`);continue}let r=null;qA.has(t)?r=qA.get(t):(r=xg(new n(t)),qA.set(t,r)),e.push(r)}}this._lightNodes=e}setupLights(t,e){for(const n of e)n.build(t)}setup(t){null===this._lightNodes&&this.setupLightsNode(t);const e=t.context,n=e.lightingModel;let r=this.outgoingLightNode;if(n){const{_lightNodes:i,totalDiffuseNode:s,totalSpecularNode:o}=this;e.outgoingLight=r;const a=t.addStack();t.getDataFromNode(this).nodes=a.nodes,n.start(e,a,t),this.setupLights(t,i),n.indirect(e,a,t);const{backdrop:l,backdropAlpha:u}=e,{directDiffuse:c,directSpecular:h,indirectDiffuse:d,indirectSpecular:p}=e.reflectedLight;let f=c.add(d);null!==l&&(f=Bg(null!==u?u.mix(f,l):l),e.material.transparent=!0),s.assign(f),o.assign(h.add(p)),r.assign(s.add(o)),n.finish(e,a,t),r=r.bypass(t.removeStack())}return r}setLights(t){return this._lights=t,this._lightNodes=null,this._lightNodesHash=null,this}getLights(){return this._lights}get hasLights(){return this._lights.length>0}}const ZA=Eg((({depthTexture:t,shadowCoord:e})=>Y_(t,e.xy).compare(e.z))),$A=Eg((({depthTexture:t,shadowCoord:e,shadow:n})=>{const r=(e,n)=>Y_(t,e).compare(n),i=Vx("mapSize","vec2",n).setGroup(Qg),s=Vx("radius","float",n).setGroup(Qg),o=Dg(1).div(i),a=o.x.negate().mul(s),l=o.y.negate().mul(s),u=o.x.mul(s),c=o.y.mul(s),h=a.div(2),d=l.div(2),p=u.div(2),f=c.div(2);return Uv(r(e.xy.add(Dg(a,l)),e.z),r(e.xy.add(Dg(0,l)),e.z),r(e.xy.add(Dg(u,l)),e.z),r(e.xy.add(Dg(h,d)),e.z),r(e.xy.add(Dg(0,d)),e.z),r(e.xy.add(Dg(p,d)),e.z),r(e.xy.add(Dg(a,0)),e.z),r(e.xy.add(Dg(h,0)),e.z),r(e.xy,e.z),r(e.xy.add(Dg(p,0)),e.z),r(e.xy.add(Dg(u,0)),e.z),r(e.xy.add(Dg(h,f)),e.z),r(e.xy.add(Dg(0,f)),e.z),r(e.xy.add(Dg(p,f)),e.z),r(e.xy.add(Dg(a,c)),e.z),r(e.xy.add(Dg(0,c)),e.z),r(e.xy.add(Dg(u,c)),e.z)).mul(1/17)})),YA=Eg((({depthTexture:t,shadowCoord:e,shadow:n})=>{const r=(e,n)=>Y_(t,e).compare(n),i=Vx("mapSize","vec2",n).setGroup(Qg),s=Dg(1).div(i),o=s.x,a=s.y,l=e.xy,u=xy(l.mul(i).add(.5));return l.subAssign(u.mul(s)),Uv(r(l,e.z),r(l.add(Dg(o,0)),e.z),r(l.add(Dg(0,a)),e.z),r(l.add(s),e.z),e_(r(l.add(Dg(o.negate(),0)),e.z),r(l.add(Dg(o.mul(2),0)),e.z),u.x),e_(r(l.add(Dg(o.negate(),a)),e.z),r(l.add(Dg(o.mul(2),a)),e.z),u.x),e_(r(l.add(Dg(0,a.negate())),e.z),r(l.add(Dg(0,a.mul(2))),e.z),u.y),e_(r(l.add(Dg(o,a.negate())),e.z),r(l.add(Dg(o,a.mul(2))),e.z),u.y),e_(e_(r(l.add(Dg(o.negate(),a.negate())),e.z),r(l.add(Dg(o.mul(2),a.negate())),e.z),u.x),e_(r(l.add(Dg(o.negate(),a.mul(2))),e.z),r(l.add(Dg(o.mul(2),a.mul(2))),e.z),u.x),u.y)).mul(1/9)})),KA=Eg((({depthTexture:t,shadowCoord:e})=>{const n=Ng(1).toVar(),r=Y_(t).uv(e.xy).rg,i=jy(e.z,r.x);return Cg(i.notEqual(Ng(1)),(()=>{const t=e.z.sub(r.x),s=Vy(0,r.y.mul(r.y));let o=s.div(s.add(t.mul(t)));o=n_(kv(o,.3).div(.95-.3)),n.assign(n_(Vy(i,o)))})),n})),JA=Eg((({samples:t,radius:e,size:n,shadowPass:r})=>{const i=Ng(0).toVar(),s=Ng(0).toVar(),o=t.lessThanEqual(Ng(1)).select(Ng(0),Ng(2).div(t.sub(1))),a=t.lessThanEqual(Ng(1)).select(Ng(0),Ng(-1));tw({start:Pg(0),end:Pg(t),type:"int",condition:"<"},(({i:t})=>{const l=a.add(Ng(t).mul(o)),u=r.uv(Uv(vw.xy,Dg(0,l).mul(e)).div(n)).x;i.addAssign(u),s.addAssign(u.mul(u))})),i.divAssign(t),s.divAssign(t);const l=my(s.sub(i.mul(i)));return Dg(i,l)})),QA=Eg((({samples:t,radius:e,size:n,shadowPass:r})=>{const i=Ng(0).toVar(),s=Ng(0).toVar(),o=t.lessThanEqual(Ng(1)).select(Ng(0),Ng(2).div(t.sub(1))),a=t.lessThanEqual(Ng(1)).select(Ng(0),Ng(-1));tw({start:Pg(0),end:Pg(t),type:"int",condition:"<"},(({i:t})=>{const l=a.add(Ng(t).mul(o)),u=r.uv(Uv(vw.xy,Dg(l,0).mul(e)).div(n));i.addAssign(u.x),s.addAssign(Uv(u.y.mul(u.y),u.x.mul(u.x)))})),i.divAssign(t),s.divAssign(t);const l=my(s.sub(i.mul(i)));return Dg(i,l)})),tC=[ZA,$A,YA,KA];let eC=null;const nC=new jE;class rC extends Lm{static get type(){return"ShadowNode"}constructor(t,e=null){super(),this.light=t,this.shadow=e||t.shadow,this.shadowMap=null,this.vsmShadowMapVertical=null,this.vsmShadowMapHorizontal=null,this.vsmMaterialVertical=null,this.vsmMaterialHorizontal=null,this.updateBeforeType=Rm,this._node=null,this.isShadowNode=!0}setupShadow(t){const{object:e,renderer:n}=t;null===eC&&(eC=new kw,eC.fragmentNode=Gg(0,0,0,1),eC.isShadowNodeMaterial=!0,eC.name="ShadowMaterial");const r=this.shadow,i=n.shadowMap.type,s=new df(r.mapSize.width,r.mapSize.height);s.compareFunction=513;const o=t.createRenderTarget(r.mapSize.width,r.mapSize.height);if(o.depthTexture=s,r.camera.updateProjectionMatrix(),3===i){s.compareFunction=null,this.vsmShadowMapVertical=t.createRenderTarget(r.mapSize.width,r.mapSize.height,{format:lc,type:tc}),this.vsmShadowMapHorizontal=t.createRenderTarget(r.mapSize.width,r.mapSize.height,{format:lc,type:tc});const e=Y_(s),n=Y_(this.vsmShadowMapVertical.texture),i=Vx("blurSamples","float",r).setGroup(Qg),o=Vx("radius","float",r).setGroup(Qg),a=Vx("mapSize","vec2",r).setGroup(Qg);let l=this.vsmMaterialVertical||(this.vsmMaterialVertical=new kw);l.fragmentNode=JA({samples:i,radius:o,size:a,shadowPass:e}).context(t.getSharedContext()),l.name="VSMVertical",l=this.vsmMaterialHorizontal||(this.vsmMaterialHorizontal=new kw),l.fragmentNode=QA({samples:i,radius:o,size:a,shadowPass:n}).context(t.getSharedContext()),l.name="VSMHorizontal"}const a=Vx("intensity","float",r).setGroup(Qg),l=Vx("bias","float",r).setGroup(Qg),u=Vx("normalBias","float",r).setGroup(Qg),c=e.material.shadowPositionNode||hx;let h,d=nv(r.matrix).setGroup(Qg).mul(c.add(Sx.mul(u)));if(r.camera.isOrthographicCamera||!0!==n.logarithmicDepthBuffer)d=d.xyz.div(d.w),h=d.z,n.coordinateSystem===Xc&&(h=h.mul(2).sub(1));else{const t=d.w;d=d.xy.div(t);const e=nv("float").onRenderUpdate((()=>r.camera.near)),n=nv("float").onRenderUpdate((()=>r.camera.far));h=Rw(t,e,n)}d=Bg(d.x,d.y.oneMinus(),h.add(l));const p=d.x.greaterThanEqual(0).and(d.x.lessThanEqual(1)).and(d.y.greaterThanEqual(0)).and(d.y.lessThanEqual(1)).and(d.z.lessThanEqual(1)),f=r.filterNode||tC[n.shadowMap.type]||null;if(null===f)throw new Error("THREE.WebGPURenderer: Shadow map type not supported yet.");const m=Y_(o.texture,d),g=p.select(f({depthTexture:3===i?this.vsmShadowMapHorizontal.texture:s,shadowCoord:d,shadow:r}),Ng(1));return this.shadowMap=o,this.shadow.map=o,e_(1,g.rgb.mix(m,1),a.mul(m.a))}setup(t){if(!1!==t.renderer.shadowMap.enabled)return null!==this._node?this._node:this._node=this.setupShadow(t)}updateShadow(t){const{shadowMap:e,light:n,shadow:r}=this,{renderer:i,scene:s,camera:o}=t,a=i.shadowMap.type,l=e.depthTexture.version;this._depthVersionCached=l;const u=s.overrideMaterial;s.overrideMaterial=eC,e.setSize(r.mapSize.width,r.mapSize.height),r.updateMatrices(n),r.camera.layers.mask=o.layers.mask;const c=i.getRenderTarget(),h=i.getRenderObjectFunction();i.setRenderObjectFunction(((t,...e)=>{(!0===t.castShadow||t.receiveShadow&&3===a)&&i.renderObject(t,...e)})),i.setRenderTarget(e),i.render(s,r.camera),i.setRenderObjectFunction(h),!0!==n.isPointLight&&3===a&&this.vsmPass(i),i.setRenderTarget(c),s.overrideMaterial=u}vsmPass(t){const{shadow:e}=this;this.vsmShadowMapVertical.setSize(e.mapSize.width,e.mapSize.height),this.vsmShadowMapHorizontal.setSize(e.mapSize.width,e.mapSize.height),t.setRenderTarget(this.vsmShadowMapVertical),nC.material=this.vsmMaterialVertical,nC.render(t),t.setRenderTarget(this.vsmShadowMapHorizontal),nC.material=this.vsmMaterialHorizontal,nC.render(t)}dispose(){this.shadowMap.dispose(),this.shadowMap=null,null!==this.vsmShadowMapVertical&&(this.vsmShadowMapVertical.dispose(),this.vsmShadowMapVertical=null,this.vsmMaterialVertical.dispose(),this.vsmMaterialVertical=null),null!==this.vsmShadowMapHorizontal&&(this.vsmShadowMapHorizontal.dispose(),this.vsmShadowMapHorizontal=null,this.vsmMaterialHorizontal.dispose(),this.vsmMaterialHorizontal=null),this.updateBeforeType=Am}updateBefore(t){const{shadow:e}=this;(e.needsUpdate||e.autoUpdate)&&(this.updateShadow(t),this.shadowMap.depthTexture.version===this._depthVersionCached&&(e.needsUpdate=!1))}}class iC extends aw{static get type(){return"AnalyticLightNode"}constructor(t=null){super(),this.updateType=Cm,this.light=t,this.color=new Qd,this.colorNode=nv(this.color).setGroup(Qg),this.baseColorNode=null,this.shadowNode=null,this.shadowColorNode=null,this.isAnalyticLightNode=!0}getCacheKey(){return _m(super.getCacheKey(),this.light.id,this.light.castShadow?1:0)}getHash(){return this.light.uuid}setupShadow(t){const{renderer:e}=t;if(!1===e.shadowMap.enabled)return;let n=this.shadowColorNode;if(null===n){const t=this.light.shadow.shadowNode;let e;e=void 0!==t?xg(t):((t,e)=>xg(new rC(t,e)))(this.light),this.shadowNode=e,this.shadowColorNode=n=this.colorNode.mul(e),this.baseColorNode=this.colorNode}this.colorNode=n}setup(t){this.colorNode=this.baseColorNode||this.colorNode,this.light.castShadow?t.object.receiveShadow&&this.setupShadow(t):null!==this.shadowNode&&this.shadowNode.dispose()}update(){const{light:t}=this;this.color.copy(t.color).multiplyScalar(t.intensity)}}const sC=Eg((t=>{const{lightDistance:e,cutoffDistance:n,decayExponent:r}=t,i=e.pow(r).max(.01).reciprocal();return n.greaterThan(0).select(i.mul(e.div(n).pow4().oneMinus().clamp().pow2()),i)})),oC=Eg((({color:t,lightViewPosition:e,cutoffDistance:n,decayExponent:r},i)=>{const s=i.context.lightingModel,o=e.sub(px),a=o.normalize(),l=o.length(),u=sC({lightDistance:l,cutoffDistance:n,decayExponent:r}),c=t.mul(u),h=i.context.reflectedLight;s.direct({lightDirection:a,lightColor:c,reflectedLight:h},i.stack,i)}));class aC extends iC{static get type(){return"PointLightNode"}constructor(t=null){super(t),this.cutoffDistanceNode=nv(0).setGroup(Qg),this.decayExponentNode=nv(0).setGroup(Qg)}update(t){const{light:e}=this;super.update(t),this.cutoffDistanceNode.value=e.distance,this.decayExponentNode.value=e.decay}setup(){oC({color:this.colorNode,lightViewPosition:jA(this.light),cutoffDistance:this.cutoffDistanceNode,decayExponent:this.decayExponentNode}).append()}}const lC=Eg((([t,e])=>{const n=t.x,r=t.y,i=t.z;let s=e.element(0).mul(.886227);return s=s.add(e.element(1).mul(1.023328).mul(r)),s=s.add(e.element(2).mul(1.023328).mul(i)),s=s.add(e.element(3).mul(1.023328).mul(n)),s=s.add(e.element(4).mul(.858086).mul(n).mul(r)),s=s.add(e.element(5).mul(.858086).mul(r).mul(i)),s=s.add(e.element(6).mul(i.mul(i).mul(.743125).sub(.247708))),s=s.add(e.element(7).mul(.858086).mul(n).mul(i)),s=s.add(e.element(8).mul(.429043).mul(Bv(n,n).sub(Bv(r,r)))),s})),uC=new LE;class cC extends oE{constructor(t,e){super(),this.renderer=t,this.nodes=e}update(t,e,n){const r=this.renderer,i=this.nodes.getBackgroundNode(t)||t.background;let s=!1;if(null===i)r._clearColor.getRGB(uC,zc),uC.a=r._clearColor.a;else if(!0===i.isColor)i.getRGB(uC,zc),uC.a=1,s=!0;else if(!0===i.isNode){const n=this.get(t),s=i;uC.copy(r._clearColor);let o=n.backgroundMesh;if(void 0===o){const t=c_(Gg(s).mul(ZE),{getUV:()=>$E.mul(bx),getTextureLevel:()=>XE});let e=Gb();e=e.setZ(e.w);const r=new kw;r.name="Background.material",r.side=1,r.depthTest=!1,r.depthWrite=!1,r.fog=!1,r.lights=!1,r.vertexNode=e,r.colorNode=t,n.backgroundMeshNode=t,n.backgroundMesh=o=new Dp(new pf(1,32,32),r),o.frustumCulled=!1,o.name="Background.mesh",o.onBeforeRender=function(t,e,n){this.matrixWorld.copyPosition(n.matrixWorld)}}const a=s.getCacheKey();n.backgroundCacheKey!==a&&(n.backgroundMeshNode.node=Gg(s).mul(ZE),n.backgroundMeshNode.needsUpdate=!0,o.material.needsUpdate=!0,n.backgroundCacheKey=a),e.unshift(o,o.geometry,o.material,0,0,null)}else console.error("THREE.Renderer: Unsupported background configuration.",i);if(!0===r.autoClear||!0===s){const t=n.clearColorValue;t.r=uC.r,t.g=uC.g,t.b=uC.b,t.a=uC.a,!0!==r.backend.isWebGLBackend&&!0!==r.alpha||(t.r*=t.a,t.g*=t.a,t.b*=t.a),n.depthClearValue=r._clearDepth,n.stencilClearValue=r._clearStencil,n.clearColor=!0===r.autoClearColor,n.clearDepth=!0===r.autoClearDepth,n.clearStencil=!0===r.autoClearStencil}else n.clearColor=!1,n.clearDepth=!1,n.clearStencil=!1}}let hC=0;class dC{constructor(t="",e=[],n=0,r=[]){this.name=t,this.bindings=e,this.index=n,this.bindingsReference=r,this.id=hC++}}class pC{constructor(t,e,n,r,i,s,o,a,l,u=[]){this.vertexShader=t,this.fragmentShader=e,this.computeShader=n,this.transforms=u,this.nodeAttributes=r,this.bindings=i,this.updateNodes=s,this.updateBeforeNodes=o,this.updateAfterNodes=a,this.monitor=l,this.usedTimes=0}createBindings(){const t=[];for(const e of this.bindings){if(!0!==e.bindings[0].groupNode.shared){const n=new dC(e.name,[],e.index,e);t.push(n);for(const t of e.bindings)n.bindings.push(t.clone())}else t.push(e)}return t}}class fC{constructor(t,e,n=null){this.isNodeAttribute=!0,this.name=t,this.type=e,this.node=n}}class mC{constructor(t,e,n){this.isNodeUniform=!0,this.name=t,this.type=e,this.node=n.getSelf()}get value(){return this.node.value}set value(t){this.node.value=t}get id(){return this.node.id}get groupNode(){return this.node.groupNode}}class gC{constructor(t,e){this.isNodeVar=!0,this.name=t,this.type=e}}class vC extends gC{constructor(t,e){super(t,e),this.needsInterpolation=!1,this.isNodeVarying=!0}}class yC{constructor(t,e,n=""){this.name=t,this.type=e,this.code=n,Object.defineProperty(this,"isNodeCode",{value:!0})}}let _C=0;class xC{constructor(t=null){this.id=_C++,this.nodesData=new WeakMap,this.parent=t}getData(t){let e=this.nodesData.get(t);return void 0===e&&null!==this.parent&&(e=this.parent.getData(t)),e}setData(t,e){this.nodesData.set(t,e)}}class bC{constructor(t,e){this.name=t,this.value=e,this.boundary=0,this.itemSize=0,this.offset=0}setValue(t){this.value=t}getValue(){return this.value}}class wC extends bC{constructor(t,e=0){super(t,e),this.isNumberUniform=!0,this.boundary=4,this.itemSize=1}}class SC extends bC{constructor(t,e=new oh){super(t,e),this.isVector2Uniform=!0,this.boundary=8,this.itemSize=2}}class MC extends bC{constructor(t,e=new Ph){super(t,e),this.isVector3Uniform=!0,this.boundary=16,this.itemSize=3}}class EC extends bC{constructor(t,e=new Th){super(t,e),this.isVector4Uniform=!0,this.boundary=16,this.itemSize=4}}class TC extends bC{constructor(t,e=new Qd){super(t,e),this.isColorUniform=!0,this.boundary=16,this.itemSize=3}}class AC extends bC{constructor(t,e=new ah){super(t,e),this.isMatrix3Uniform=!0,this.boundary=48,this.itemSize=12}}class CC extends bC{constructor(t,e=new ad){super(t,e),this.isMatrix4Uniform=!0,this.boundary=64,this.itemSize=16}}class RC extends wC{constructor(t){super(t.name,t.value),this.nodeUniform=t}getValue(){return this.nodeUniform.value}}class NC extends SC{constructor(t){super(t.name,t.value),this.nodeUniform=t}getValue(){return this.nodeUniform.value}}class PC extends MC{constructor(t){super(t.name,t.value),this.nodeUniform=t}getValue(){return this.nodeUniform.value}}class IC extends EC{constructor(t){super(t.name,t.value),this.nodeUniform=t}getValue(){return this.nodeUniform.value}}class OC extends TC{constructor(t){super(t.name,t.value),this.nodeUniform=t}getValue(){return this.nodeUniform.value}}class DC extends AC{constructor(t){super(t.name,t.value),this.nodeUniform=t}getValue(){return this.nodeUniform.value}}class LC extends CC{constructor(t){super(t.name,t.value),this.nodeUniform=t}getValue(){return this.nodeUniform.value}}const UC=[.125,.215,.35,.446,.526,.582],kC=20,BC=new Qf(-1,1,1,-1,0,1),FC=new jp(90,1),zC=new Qd;let VC=null,GC=0,jC=0;const HC=(1+Math.sqrt(5))/2,WC=1/HC,qC=[new Ph(-HC,WC,0),new Ph(HC,WC,0),new Ph(-WC,0,HC),new Ph(WC,0,HC),new Ph(0,HC,-WC),new Ph(0,HC,WC),new Ph(-1,1,-1),new Ph(1,1,-1),new Ph(-1,1,1),new Ph(1,1,1)],XC=[3,1,5,0,4,2],ZC=vM(H_(),j_("faceIndex")).normalize(),$C=Bg(ZC.x,ZC.y.negate(),ZC.z);class YC{constructor(t){this._renderer=t,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._lodMeshes=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._backgroundBox=null}fromScene(t,e=0,n=.1,r=100){VC=this._renderer.getRenderTarget(),GC=this._renderer.getActiveCubeFace(),jC=this._renderer.getActiveMipmapLevel(),this._setSize(256);const i=this._allocateTargets();return i.depthBuffer=!0,this._sceneToCubeUV(t,n,r,i),e>0&&this._blur(i,0,0,e),this._applyPMREM(i),this._cleanup(i),i}fromEquirectangular(t,e=null){return this._fromTexture(t,e)}fromCubemap(t,e=null){return this._fromTexture(t,e)}async compileCubemapShader(){null===this._cubemapMaterial&&(this._cubemapMaterial=tR(),await this._compileMaterial(this._cubemapMaterial))}async compileEquirectangularShader(){null===this._equirectMaterial&&(this._equirectMaterial=eR(),await this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),null!==this._cubemapMaterial&&this._cubemapMaterial.dispose(),null!==this._equirectMaterial&&this._equirectMaterial.dispose(),null!==this._backgroundBox&&(this._backgroundBox.geometry.dispose(),this._backgroundBox.material.dispose())}_setSize(t){this._lodMax=Math.floor(Math.log2(t)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){null!==this._blurMaterial&&this._blurMaterial.dispose(),null!==this._pingPongRenderTarget&&this._pingPongRenderTarget.dispose();for(let t=0;t<this._lodPlanes.length;t++)this._lodPlanes[t].dispose()}_cleanup(t){this._renderer.setRenderTarget(VC,GC,jC),t.scissorTest=!1,JC(t,0,0,t.width,t.height)}_fromTexture(t,e){t.mapping===Ou||t.mapping===Du?this._setSize(0===t.image.length?16:t.image[0].width||t.image[0].image.width):this._setSize(t.image.width/4),VC=this._renderer.getRenderTarget(),GC=this._renderer.getActiveCubeFace(),jC=this._renderer.getActiveMipmapLevel();const n=e||this._allocateTargets();return this._textureToCubeUV(t,n),this._applyPMREM(n),this._cleanup(n),n}_allocateTargets(){const t=3*Math.max(this._cubeSize,112),e=4*this._cubeSize,n={magFilter:Hu,minFilter:Hu,generateMipmaps:!1,type:tc,format:rc,colorSpace:zc},r=KC(t,e,n);if(null===this._pingPongRenderTarget||this._pingPongRenderTarget.width!==t||this._pingPongRenderTarget.height!==e){null!==this._pingPongRenderTarget&&this._dispose(),this._pingPongRenderTarget=KC(t,e,n);const{_lodMax:r}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas,lodMeshes:this._lodMeshes}=function(t){const e=[],n=[],r=[],i=[];let s=t;const o=t-4+1+UC.length;for(let a=0;a<o;a++){const o=Math.pow(2,s);n.push(o);let l=1/o;a>t-4?l=UC[a-t+4-1]:0===a&&(l=0),r.push(l);const u=1/(o-2),c=-u,h=1+u,d=[c,c,h,c,h,h,c,c,h,h,c,h],p=6,f=6,m=3,g=2,v=1,y=new Float32Array(m*f*p),_=new Float32Array(g*f*p),x=new Float32Array(v*f*p);for(let t=0;t<p;t++){const e=t%3*2/3-1,n=t>2?0:-1,r=[e,n,0,e+2/3,n,0,e+2/3,n+1,0,e,n,0,e+2/3,n+1,0,e,n+1,0],i=XC[t];y.set(r,m*f*i),_.set(d,g*f*i);const s=[i,i,i,i,i,i];x.set(s,v*f*i)}const b=new wp;b.setAttribute("position",new cp(y,m)),b.setAttribute("uv",new cp(_,g)),b.setAttribute("faceIndex",new cp(x,v)),e.push(b),i.push(new Dp(b,null)),s>4&&s--}return{lodPlanes:e,sizeLods:n,sigmas:r,lodMeshes:i}}(r)),this._blurMaterial=function(t,e,n){const r=Bx(new Array(kC).fill(0)),i=nv(new Ph(0,1,0)),s=nv(0),o=Ng(kC),a=nv(0),l=nv(1),u=Y_(null),c=nv(0),h=Ng(1/e),d=Ng(1/n),p=Ng(t),f={n:o,latitudinal:a,weights:r,poleAxis:i,outputDirection:$C,dTheta:s,samples:l,envMap:u,mipInt:c,CUBEUV_TEXEL_WIDTH:h,CUBEUV_TEXEL_HEIGHT:d,CUBEUV_MAX_MIP:p},m=QC("blur");return m.uniforms=f,m.fragmentNode=bM({...f,latitudinal:a.equal(1)}),m}(r,t,e)}return r}async _compileMaterial(t){const e=new Dp(this._lodPlanes[0],t);await this._renderer.compile(e,BC)}_sceneToCubeUV(t,e,n,r){const i=FC;i.near=e,i.far=n;const s=[-1,1,-1,-1,-1,-1],o=[1,1,1,-1,-1,-1],a=this._renderer,l=a.autoClear;a.getClearColor(zC),a.autoClear=!1;let u=this._backgroundBox;if(null===u){const t=new rp({name:"PMREM.Background",side:1,depthWrite:!1,depthTest:!1});u=new Dp(new Up,t)}let c=!1;const h=t.background;h?h.isColor&&(u.material.color.copy(h),t.background=null,c=!0):(u.material.color.copy(zC),c=!0),a.setRenderTarget(r),a.clear(),c&&a.render(u,i);for(let e=0;e<6;e++){const n=e%3;0===n?(i.up.set(0,s[e],0),i.lookAt(o[e],0,0)):1===n?(i.up.set(0,0,s[e]),i.lookAt(0,o[e],0)):(i.up.set(0,s[e],0),i.lookAt(0,0,o[e]));const l=this._cubeSize;JC(r,n*l,e>2?l:0,l,l),a.render(t,i)}a.autoClear=l,t.background=h}_textureToCubeUV(t,e){const n=this._renderer,r=t.mapping===Ou||t.mapping===Du;r?null===this._cubemapMaterial&&(this._cubemapMaterial=tR(t)):null===this._equirectMaterial&&(this._equirectMaterial=eR(t));const i=r?this._cubemapMaterial:this._equirectMaterial;i.fragmentNode.value=t;const s=this._lodMeshes[0];s.material=i;const o=this._cubeSize;JC(e,0,0,3*o,2*o),n.setRenderTarget(e),n.render(s,BC)}_applyPMREM(t){const e=this._renderer,n=e.autoClear;e.autoClear=!1;const r=this._lodPlanes.length;for(let e=1;e<r;e++){const n=Math.sqrt(this._sigmas[e]*this._sigmas[e]-this._sigmas[e-1]*this._sigmas[e-1]),i=qC[(r-e-1)%qC.length];this._blur(t,e-1,e,n,i)}e.autoClear=n}_blur(t,e,n,r,i){const s=this._pingPongRenderTarget;this._halfBlur(t,s,e,n,r,"latitudinal",i),this._halfBlur(s,t,n,n,r,"longitudinal",i)}_halfBlur(t,e,n,r,i,s,o){const a=this._renderer,l=this._blurMaterial;"latitudinal"!==s&&"longitudinal"!==s&&console.error("blur direction must be either latitudinal or longitudinal!");const u=this._lodMeshes[r];u.material=l;const c=l.uniforms,h=this._sizeLods[n]-1,d=isFinite(i)?Math.PI/(2*h):2*Math.PI/39,p=i/d,f=isFinite(i)?1+Math.floor(3*p):kC;f>kC&&console.warn(`sigmaRadians, ${i}, is too large and will clip, as it requested ${f} samples when the maximum is set to 20`);const m=[];let g=0;for(let t=0;t<kC;++t){const e=t/p,n=Math.exp(-e*e/2);m.push(n),0===t?g+=n:t<f&&(g+=2*n)}for(let t=0;t<m.length;t++)m[t]=m[t]/g;t.texture.frame=(t.texture.frame||0)+1,c.envMap.value=t.texture,c.samples.value=f,c.weights.array=m,c.latitudinal.value="latitudinal"===s?1:0,o&&(c.poleAxis.value=o);const{_lodMax:v}=this;c.dTheta.value=d,c.mipInt.value=v-n;const y=this._sizeLods[r];JC(e,3*y*(r>v-4?r-v+4:0),4*(this._cubeSize-y),3*y,2*y),a.setRenderTarget(e),a.render(u,BC)}}function KC(t,e,n){const r=new Ah(t,e,n);return r.texture.mapping=ku,r.texture.name="PMREM.cubeUv",r.texture.isPMREMTexture=!0,r.scissorTest=!0,r}function JC(t,e,n,r,i){t.viewport.set(e,n,r,i),t.scissor.set(e,n,r,i)}function QC(t){const e=new kw;return e.depthTest=!1,e.depthWrite=!1,e.blending=0,e.name=`PMREM_${t}`,e}function tR(t){const e=QC("cubemap");return e.fragmentNode=Ox(t,$C),e}function eR(t){const e=QC("equirect");return e.fragmentNode=Y_(t,Ww($C),0),e}const nR=new WeakMap,rR=new Map([[2,"vec2"],[3,"vec3"],[4,"vec4"],[9,"mat3"],[16,"mat4"]]),iR=new Map([[Int8Array,"int"],[Int16Array,"int"],[Int32Array,"int"],[Uint8Array,"uint"],[Uint16Array,"uint"],[Uint32Array,"uint"],[Float32Array,"float"]]),sR=t=>/e/g.test(t)?String(t).replace(/\+/g,""):(t=Number(t))+(t%1?"":".0");class oR{constructor(t,e,n){this.object=t,this.material=t&&t.material||null,this.geometry=t&&t.geometry||null,this.renderer=e,this.parser=n,this.scene=null,this.camera=null,this.nodes=[],this.sequentialNodes=[],this.updateNodes=[],this.updateBeforeNodes=[],this.updateAfterNodes=[],this.hashNodes={},this.monitor=null,this.lightsNode=null,this.environmentNode=null,this.fogNode=null,this.clippingContext=null,this.vertexShader=null,this.fragmentShader=null,this.computeShader=null,this.flowNodes={vertex:[],fragment:[],compute:[]},this.flowCode={vertex:"",fragment:"",compute:""},this.uniforms={vertex:[],fragment:[],compute:[],index:0},this.structs={vertex:[],fragment:[],compute:[],index:0},this.bindings={vertex:{},fragment:{},compute:{}},this.bindingsIndexes={},this.bindGroups=null,this.attributes=[],this.bufferAttributes=[],this.varyings=[],this.codes={},this.vars={},this.flow={code:""},this.chaining=[],this.stack=BE(),this.stacks=[],this.tab="\t",this.currentFunctionNode=null,this.context={material:this.material},this.cache=new xC,this.globalCache=this.cache,this.flowsData=new WeakMap,this.shaderStage=null,this.buildStage=null,this.useComparisonMethod=!1}getBindGroupsCache(){let t=nR.get(this.renderer);return void 0===t&&(t=new QM,nR.set(this.renderer,t)),t}createRenderTarget(t,e,n){return new Ah(t,e,n)}createCubeRenderTarget(t,e){return new qw(t,e)}createPMREMGenerator(){return new YC(this.renderer)}includes(t){return this.nodes.includes(t)}_getBindGroup(t,e){const n=this.getBindGroupsCache(),r=[];let i,s=!0;for(const t of e)r.push(t),s=s&&!0!==t.groupNode.shared;return s?(i=n.get(r),void 0===i&&(i=new dC(t,r,this.bindingsIndexes[t].group,r),n.set(r,i))):i=new dC(t,r,this.bindingsIndexes[t].group,r),i}getBindGroupArray(t,e){const n=this.bindings[e];let r=n[t];return void 0===r&&(void 0===this.bindingsIndexes[t]&&(this.bindingsIndexes[t]={binding:0,group:Object.keys(this.bindingsIndexes).length}),n[t]=r=[]),r}getBindings(){let t=this.bindGroups;if(null===t){const e={},n=this.bindings;for(const t of Im)for(const r in n[t]){const i=n[t][r];(e[r]||(e[r]=[])).push(...i)}t=[];for(const n in e){const r=e[n],i=this._getBindGroup(n,r);t.push(i)}this.bindGroups=t}return t}sortBindingGroups(){const t=this.getBindings();t.sort(((t,e)=>t.bindings[0].groupNode.order-e.bindings[0].groupNode.order));for(let e=0;e<t.length;e++){const n=t[e];this.bindingsIndexes[n.name].group=e,n.index=e}}setHashNode(t,e){this.hashNodes[e]=t}addNode(t){!1===this.nodes.includes(t)&&(this.nodes.push(t),this.setHashNode(t,t.getHash(this)))}addSequentialNode(t){!1===this.sequentialNodes.includes(t)&&this.sequentialNodes.push(t)}buildUpdateNodes(){for(const t of this.nodes){t.getUpdateType()!==Am&&this.updateNodes.push(t.getSelf())}for(const t of this.sequentialNodes){const e=t.getUpdateBeforeType(),n=t.getUpdateAfterType();e!==Am&&this.updateBeforeNodes.push(t.getSelf()),n!==Am&&this.updateAfterNodes.push(t.getSelf())}}get currentNode(){return this.chaining[this.chaining.length-1]}isFilteredTexture(t){return t.magFilter===Hu||t.magFilter===Wu||t.magFilter===ju||t.magFilter===qu||t.minFilter===Hu||t.minFilter===Wu||t.minFilter===ju||t.minFilter===qu}addChain(t){this.chaining.push(t)}removeChain(t){if(this.chaining.pop()!==t)throw new Error("NodeBuilder: Invalid node chaining!")}getMethod(t){return t}getNodeFromHash(t){return this.hashNodes[t]}addFlow(t,e){return this.flowNodes[t].push(e),e}setContext(t){this.context=t}getContext(){return this.context}getSharedContext(){return this.context,this.context}setCache(t){this.cache=t}getCache(){return this.cache}getCacheFromNode(t,e=!0){const n=this.getDataFromNode(t);return void 0===n.cache&&(n.cache=new xC(e?this.getCache():null)),n.cache}isAvailable(){return!1}getVertexIndex(){console.warn("Abstract function.")}getInstanceIndex(){console.warn("Abstract function.")}getDrawIndex(){console.warn("Abstract function.")}getFrontFacing(){console.warn("Abstract function.")}getFragCoord(){console.warn("Abstract function.")}isFlipY(){return!1}increaseUsage(t){const e=this.getDataFromNode(t);return e.usageCount=void 0===e.usageCount?1:e.usageCount+1,e.usageCount}generateTexture(){console.warn("Abstract function.")}generateTextureLod(){console.warn("Abstract function.")}generateConst(t,e=null){if(null===e&&("float"===t||"int"===t||"uint"===t?e=0:"bool"===t?e=!1:"color"===t?e=new Qd:"vec2"===t?e=new oh:"vec3"===t?e=new Ph:"vec4"===t&&(e=new Th)),"float"===t)return sR(e);if("int"===t)return`${Math.round(e)}`;if("uint"===t)return e>=0?`${Math.round(e)}u`:"0u";if("bool"===t)return e?"true":"false";if("color"===t)return`${this.getType("vec3")}( ${sR(e.r)}, ${sR(e.g)}, ${sR(e.b)} )`;const n=this.getTypeLength(t),r=this.getComponentType(t),i=t=>this.generateConst(r,t);if(2===n)return`${this.getType(t)}( ${i(e.x)}, ${i(e.y)} )`;if(3===n)return`${this.getType(t)}( ${i(e.x)}, ${i(e.y)}, ${i(e.z)} )`;if(4===n)return`${this.getType(t)}( ${i(e.x)}, ${i(e.y)}, ${i(e.z)}, ${i(e.w)} )`;if(n>4&&e&&(e.isMatrix3||e.isMatrix4))return`${this.getType(t)}( ${e.elements.map(i).join(", ")} )`;if(n>4)return`${this.getType(t)}()`;throw new Error(`NodeBuilder: Type '${t}' not found in generate constant attempt.`)}getType(t){return"color"===t?"vec3":t}hasGeometryAttribute(t){return this.geometry&&void 0!==this.geometry.getAttribute(t)}getAttribute(t,e){const n=this.attributes;for(const e of n)if(e.name===t)return e;const r=new fC(t,e);return n.push(r),r}getPropertyName(t){return t.name}isVector(t){return/vec\d/.test(t)}isMatrix(t){return/mat\d/.test(t)}isReference(t){return"void"===t||"property"===t||"sampler"===t||"texture"===t||"cubeTexture"===t||"storageTexture"===t||"depthTexture"===t||"texture3D"===t}needsToWorkingColorSpace(){return!1}getComponentTypeFromTexture(t){const e=t.type;if(t.isDataTexture){if(e===Ku)return"int";if(e===Ju)return"uint"}return"float"}getElementType(t){return"mat2"===t?"vec2":"mat3"===t?"vec3":"mat4"===t?"vec4":this.getComponentType(t)}getComponentType(t){if("float"===(t=this.getVectorType(t))||"bool"===t||"int"===t||"uint"===t)return t;const e=/(b|i|u|)(vec|mat)([2-4])/.exec(t);return null===e?null:"b"===e[1]?"bool":"i"===e[1]?"int":"u"===e[1]?"uint":"float"}getVectorType(t){return"color"===t?"vec3":"texture"===t||"cubeTexture"===t||"storageTexture"===t||"texture3D"===t?"vec4":t}getTypeFromLength(t,e="float"){if(1===t)return e;const n=rR.get(t);return("float"===e?"":e[0])+n}getTypeFromArray(t){return iR.get(t.constructor)}getTypeFromAttribute(t){let e=t;t.isInterleavedBufferAttribute&&(e=t.data);const n=e.array,r=t.itemSize,i=t.normalized;let s;return t instanceof pp||!0===i||(s=this.getTypeFromArray(n)),this.getTypeFromLength(r,s)}getTypeLength(t){const e=this.getVectorType(t),n=/vec([2-4])/.exec(e);return null!==n?Number(n[1]):"float"===e||"bool"===e||"int"===e||"uint"===e?1:!0===/mat2/.test(t)?4:!0===/mat3/.test(t)?9:!0===/mat4/.test(t)?16:0}getVectorFromMatrix(t){return t.replace("mat","vec")}changeComponentType(t,e){return this.getTypeFromLength(this.getTypeLength(t),e)}getIntegerType(t){const e=this.getComponentType(t);return"int"===e||"uint"===e?t:this.changeComponentType(t,"int")}addStack(){return this.stack=BE(this.stack),this.stacks.push(Ag()||this.stack),Tg(this.stack),this.stack}removeStack(){const t=this.stack;return this.stack=t.parent,Tg(this.stacks.pop()),t}getDataFromNode(t,e=this.shaderStage,n=null){let r=(n=null===n?t.isGlobal(this)?this.globalCache:this.cache:n).getData(t);return void 0===r&&(r={},n.setData(t,r)),void 0===r[e]&&(r[e]={}),r[e]}getNodeProperties(t,e="any"){const n=this.getDataFromNode(t,e);return n.properties||(n.properties={outputNode:null})}getBufferAttributeFromNode(t,e){const n=this.getDataFromNode(t);let r=n.bufferAttribute;if(void 0===r){const i=this.uniforms.index++;r=new fC("nodeAttribute"+i,e,t),this.bufferAttributes.push(r),n.bufferAttribute=r}return r}getStructTypeFromNode(t,e=this.shaderStage){const n=this.getDataFromNode(t,e);if(void 0===n.structType){const r=this.structs.index++;t.name=`StructType${r}`,this.structs[e].push(t),n.structType=t}return t}getUniformFromNode(t,e,n=this.shaderStage,r=null){const i=this.getDataFromNode(t,n,this.globalCache);let s=i.uniform;if(void 0===s){const o=this.uniforms.index++;s=new mC(r||"nodeUniform"+o,e,t),this.uniforms[n].push(s),i.uniform=s}return s}getVarFromNode(t,e=null,n=t.getNodeType(this),r=this.shaderStage){const i=this.getDataFromNode(t,r);let s=i.variable;if(void 0===s){const t=this.vars[r]||(this.vars[r]=[]);null===e&&(e="nodeVar"+t.length),s=new gC(e,n),t.push(s),i.variable=s}return s}getVaryingFromNode(t,e=null,n=t.getNodeType(this)){const r=this.getDataFromNode(t,"any");let i=r.varying;if(void 0===i){const t=this.varyings,s=t.length;null===e&&(e="nodeVarying"+s),i=new vC(e,n),t.push(i),r.varying=i}return i}getCodeFromNode(t,e,n=this.shaderStage){const r=this.getDataFromNode(t);let i=r.code;if(void 0===i){const t=this.codes[n]||(this.codes[n]=[]),s=t.length;i=new yC("nodeCode"+s,e),t.push(i),r.code=i}return i}addFlowCodeHierarchy(t,e){const{flowCodes:n,flowCodeBlock:r}=this.getDataFromNode(t);let i=!0,s=e;for(;s;){if(!0===r.get(s)){i=!1;break}s=this.getDataFromNode(s).parentNodeBlock}if(i)for(const t of n)this.addLineFlowCode(t)}addLineFlowCodeBlock(t,e,n){const r=this.getDataFromNode(t),i=r.flowCodes||(r.flowCodes=[]),s=r.flowCodeBlock||(r.flowCodeBlock=new WeakMap);i.push(e),s.set(n,!0)}addLineFlowCode(t,e=null){return""===t||(null!==e&&this.context.nodeBlock&&this.addLineFlowCodeBlock(e,t,this.context.nodeBlock),t=this.tab+t,/;\s*$/.test(t)||(t+=";\n"),this.flow.code+=t),this}addFlowCode(t){return this.flow.code+=t,this}addFlowTab(){return this.tab+="\t",this}removeFlowTab(){return this.tab=this.tab.slice(0,-1),this}getFlowData(t){return this.flowsData.get(t)}flowNode(t){const e=t.getNodeType(this),n=this.flowChildNode(t,e);return this.flowsData.set(t,n),n}buildFunctionNode(t){const e=new IA,n=this.currentFunctionNode;return this.currentFunctionNode=e,e.code=this.buildFunctionCode(t),this.currentFunctionNode=n,e}flowShaderNode(t){const e=t.layout,n={[Symbol.iterator](){let t=0;const e=Object.values(this);return{next:()=>({value:e[t],done:t++>=e.length})}}};for(const t of e.inputs)n[t.name]=new UE(t.type,t.name);t.layout=null;const r=t.call(n),i=this.flowStagesNode(r,e.type);return t.layout=e,i}flowStagesNode(t,e=null){const n=this.flow,r=this.vars,i=this.cache,s=this.buildStage,o=this.stack,a={code:""};this.flow=a,this.vars={},this.cache=new xC,this.stack=BE();for(const n of Pm)this.setBuildStage(n),a.result=t.build(this,e);return a.vars=this.getVars(this.shaderStage),this.flow=n,this.vars=r,this.cache=i,this.stack=o,this.setBuildStage(s),a}getFunctionOperator(){return null}flowChildNode(t,e=null){const n=this.flow,r={code:""};return this.flow=r,r.result=t.build(this,e),this.flow=n,r}flowNodeFromShaderStage(t,e,n=null,r=null){const i=this.shaderStage;this.setShaderStage(t);const s=this.flowChildNode(e,n);return null!==r&&(s.code+=`${this.tab+r} = ${s.result};\n`),this.flowCode[t]=this.flowCode[t]+s.code,this.setShaderStage(i),s}getAttributesArray(){return this.attributes.concat(this.bufferAttributes)}getAttributes(){console.warn("Abstract function.")}getVaryings(){console.warn("Abstract function.")}getVar(t,e){return`${this.getType(t)} ${e}`}getVars(t){let e="";const n=this.vars[t];if(void 0!==n)for(const t of n)e+=`${this.getVar(t.type,t.name)}; `;return e}getUniforms(){console.warn("Abstract function.")}getCodes(t){const e=this.codes[t];let n="";if(void 0!==e)for(const t of e)n+=t.code+"\n";return n}getHash(){return this.vertexShader+this.fragmentShader+this.computeShader}setShaderStage(t){this.shaderStage=t}getShaderStage(){return this.shaderStage}setBuildStage(t){this.buildStage=t}getBuildStage(){return this.buildStage}buildCode(){console.warn("Abstract function.")}build(){const{object:t,material:e,renderer:n}=this;if(null!==e){let t=n.library.fromMaterial(e);null===t&&(console.error(`NodeMaterial: Material "${e.type}" is not compatible.`),t=new kw),t.build(this)}else this.addFlow("compute",t);for(const t of Pm){this.setBuildStage(t),this.context.vertex&&this.context.vertex.isNode&&this.flowNodeFromShaderStage("vertex",this.context.vertex);for(const e of Im){this.setShaderStage(e);const n=this.flowNodes[e];for(const e of n)"generate"===t?this.flowNode(e):e.build(this)}}return this.setBuildStage(null),this.setShaderStage(null),this.buildCode(),this.buildUpdateNodes(),this}getNodeUniform(t,e){if("float"===e||"int"===e||"uint"===e)return new RC(t);if("vec2"===e||"ivec2"===e||"uvec2"===e)return new NC(t);if("vec3"===e||"ivec3"===e||"uvec3"===e)return new PC(t);if("vec4"===e||"ivec4"===e||"uvec4"===e)return new IC(t);if("color"===e)return new OC(t);if("mat3"===e)return new DC(t);if("mat4"===e)return new LC(t);throw new Error(`Uniform "${e}" not declared.`)}createNodeMaterial(t="NodeMaterial"){throw new Error(`THREE.NodeBuilder: createNodeMaterial() was deprecated. Use new ${t}() instead.`)}format(t,e,n){if((e=this.getVectorType(e))===(n=this.getVectorType(n))||null===n||this.isReference(n))return t;const r=this.getTypeLength(e),i=this.getTypeLength(n);return 16===r&&9===i?`${this.getType(n)}(${t}[0].xyz, ${t}[1].xyz, ${t}[2].xyz)`:9===r&&4===i?`${this.getType(n)}(${t}[0].xy, ${t}[1].xy)`:r>4||i>4||0===i?t:r===i?`${this.getType(n)}( ${t} )`:r>i?this.format(`${t}.${"xyz".slice(0,i)}`,this.getTypeFromLength(i,this.getComponentType(e)),n):4===i&&r>1?`${this.getType(n)}( ${this.format(t,e,"vec3")}, 1.0 )`:2===r?`${this.getType(n)}( ${this.format(t,e,"vec2")}, 0.0 )`:(1===r&&i>1&&e!==this.getComponentType(n)&&(t=`${this.getType(this.getComponentType(n))}( ${t} )`),`${this.getType(n)}( ${t} )`)}getSignature(){return`// Three.js r${Cu} - Node System\n`}}class aR{constructor(){this.time=0,this.deltaTime=0,this.frameId=0,this.renderId=0,this.startTime=null,this.updateMap=new WeakMap,this.updateBeforeMap=new WeakMap,this.updateAfterMap=new WeakMap,this.renderer=null,this.material=null,this.camera=null,this.object=null,this.scene=null}_getMaps(t,e){let n=t.get(e);return void 0===n&&(n={renderMap:new WeakMap,frameMap:new WeakMap},t.set(e,n)),n}updateBeforeNode(t){const e=t.getUpdateBeforeType(),n=t.updateReference(this);if(e===Cm){const{frameMap:e}=this._getMaps(this.updateBeforeMap,n);e.get(n)!==this.frameId&&!1!==t.updateBefore(this)&&e.set(n,this.frameId)}else if(e===Rm){const{renderMap:e}=this._getMaps(this.updateBeforeMap,n);e.get(n)!==this.renderId&&!1!==t.updateBefore(this)&&e.set(n,this.renderId)}else e===Nm&&t.updateBefore(this)}updateAfterNode(t){const e=t.getUpdateAfterType(),n=t.updateReference(this);if(e===Cm){const{frameMap:e}=this._getMaps(this.updateAfterMap,n);e.get(n)!==this.frameId&&!1!==t.updateAfter(this)&&e.set(n,this.frameId)}else if(e===Rm){const{renderMap:e}=this._getMaps(this.updateAfterMap,n);e.get(n)!==this.renderId&&!1!==t.updateAfter(this)&&e.set(n,this.renderId)}else e===Nm&&t.updateAfter(this)}updateNode(t){const e=t.getUpdateType(),n=t.updateReference(this);if(e===Cm){const{frameMap:e}=this._getMaps(this.updateMap,n);e.get(n)!==this.frameId&&!1!==t.update(this)&&e.set(n,this.frameId)}else if(e===Rm){const{renderMap:e}=this._getMaps(this.updateMap,n);e.get(n)!==this.renderId&&!1!==t.update(this)&&e.set(n,this.renderId)}else e===Nm&&t.update(this)}update(){this.frameId++,void 0===this.lastTime&&(this.lastTime=performance.now()),this.deltaTime=(performance.now()-this.lastTime)/1e3,this.lastTime=performance.now(),this.time+=this.deltaTime}}class lR{constructor(t,e,n=null,r="",i=!1){this.type=t,this.name=e,this.count=n,this.qualifier=r,this.isConst=i}}lR.isNodeFunctionInput=!0;class uR extends iC{static get type(){return"DirectionalLightNode"}constructor(t=null){super(t)}setup(t){super.setup(t);const e=t.context.lightingModel,n=this.colorNode,r=HA(this.light),i=t.context.reflectedLight;e.direct({lightDirection:r,lightColor:n,reflectedLight:i},t.stack,t)}}const cR=new ad,hR=new ad;let dR=null;class pR extends iC{static get type(){return"RectAreaLightNode"}constructor(t=null){super(t),this.halfHeight=nv(new Ph).setGroup(Qg),this.halfWidth=nv(new Ph).setGroup(Qg),this.updateType=Rm}update(t){super.update(t);const{light:e}=this,n=t.camera.matrixWorldInverse;hR.identity(),cR.copy(e.matrixWorld),cR.premultiply(n),hR.extractRotation(cR),this.halfWidth.value.set(.5*e.width,0,0),this.halfHeight.value.set(0,.5*e.height,0),this.halfWidth.value.applyMatrix4(hR),this.halfHeight.value.applyMatrix4(hR)}setup(t){let e,n;super.setup(t),t.isAvailable("float32Filterable")?(e=Y_(dR.LTC_FLOAT_1),n=Y_(dR.LTC_FLOAT_2)):(e=Y_(dR.LTC_HALF_1),n=Y_(dR.LTC_HALF_2));const{colorNode:r,light:i}=this,s=t.context.lightingModel,o=jA(i),a=t.context.reflectedLight;s.directRectArea({lightColor:r,lightPosition:o,halfWidth:this.halfWidth,halfHeight:this.halfHeight,reflectedLight:a,ltc_1:e,ltc_2:n},t.stack,t)}static setLTC(t){dR=t}}class fR extends iC{static get type(){return"SpotLightNode"}constructor(t=null){super(t),this.coneCosNode=nv(0).setGroup(Qg),this.penumbraCosNode=nv(0).setGroup(Qg),this.cutoffDistanceNode=nv(0).setGroup(Qg),this.decayExponentNode=nv(0).setGroup(Qg)}update(t){super.update(t);const{light:e}=this;this.coneCosNode.value=Math.cos(e.angle),this.penumbraCosNode.value=Math.cos(e.angle*(1-e.penumbra)),this.cutoffDistanceNode.value=e.distance,this.decayExponentNode.value=e.decay}getSpotAttenuation(t){const{coneCosNode:e,penumbraCosNode:n}=this;return i_(e,n,t)}setup(t){super.setup(t);const e=t.context.lightingModel,{colorNode:n,cutoffDistanceNode:r,decayExponentNode:i,light:s}=this,o=jA(s).sub(px),a=o.normalize(),l=a.dot(HA(s)),u=this.getSpotAttenuation(l),c=o.length(),h=sC({lightDistance:c,cutoffDistance:r,decayExponent:i}),d=n.mul(u).mul(h),p=t.context.reflectedLight;e.direct({lightDirection:a,lightColor:d,reflectedLight:p},t.stack,t)}}class mR extends fR{static get type(){return"IESSpotLightNode"}getSpotAttenuation(t){const e=this.light.iesMap;let n=null;if(e&&!0===e.isTexture){const r=t.acos().mul(1/Math.PI);n=Y_(e,Dg(r,0),0).r}else n=super.getSpotAttenuation(t);return n}}class gR extends iC{static get type(){return"AmbientLightNode"}constructor(t=null){super(t)}setup({context:t}){t.irradiance.addAssign(this.colorNode)}}class vR extends iC{static get type(){return"HemisphereLightNode"}constructor(t=null){super(t),this.lightPositionNode=GA(t),this.lightDirectionNode=this.lightPositionNode.normalize(),this.groundColorNode=nv(new Qd).setGroup(Qg)}update(t){const{light:e}=this;super.update(t),this.lightPositionNode.object3d=e,this.groundColorNode.value.copy(e.groundColor).multiplyScalar(e.intensity)}setup(t){const{colorNode:e,groundColorNode:n,lightDirectionNode:r}=this,i=xx.dot(r).mul(.5).add(.5),s=e_(n,e,i);t.context.irradiance.addAssign(s)}}class yR extends iC{static get type(){return"LightProbeNode"}constructor(t=null){super(t);const e=[];for(let t=0;t<9;t++)e.push(new Ph);this.lightProbe=Bx(e)}update(t){const{light:e}=this;super.update(t);for(let t=0;t<9;t++)this.lightProbe.array[t].copy(e.sh.coefficients[t]).multiplyScalar(e.intensity)}setup(t){const e=lC(bx,this.lightProbe);t.context.irradiance.addAssign(e)}}class _R{parseFunction(){console.warn("Abstract function.")}}class xR{constructor(t,e,n="",r=""){this.type=t,this.inputs=e,this.name=n,this.precision=r}getCode(){console.warn("Abstract function.")}}xR.isNodeFunction=!0;const bR=/^\s*(highp|mediump|lowp)?\s*([a-z_0-9]+)\s*([a-z_0-9]+)?\s*\(([\s\S]*?)\)/i,wR=/[a-z_0-9]+/gi,SR="#pragma main";class MR extends xR{constructor(t){const{type:e,inputs:n,name:r,precision:i,inputsCode:s,blockCode:o,headerCode:a}=(t=>{const e=(t=t.trim()).indexOf(SR),n=-1!==e?t.slice(e+SR.length):t,r=n.match(bR);if(null!==r&&5===r.length){const i=r[4],s=[];let o=null;for(;null!==(o=wR.exec(i));)s.push(o);const a=[];let l=0;for(;l<s.length;){const t="const"===s[l][0];!0===t&&l++;let e=s[l][0];"in"===e||"out"===e||"inout"===e?l++:e="";const n=s[l++][0];let r=Number.parseInt(s[l][0]);!1===Number.isNaN(r)?l++:r=null;const i=s[l++][0];a.push(new lR(n,i,r,e,t))}const u=n.substring(r[0].length),c=void 0!==r[3]?r[3]:"";return{type:r[2],inputs:a,name:c,precision:void 0!==r[1]?r[1]:"",inputsCode:i,blockCode:u,headerCode:-1!==e?t.slice(0,e):""}}throw new Error("FunctionNode: Function is not a GLSL code.")})(t);super(e,n,r,i),this.inputsCode=s,this.blockCode=o,this.headerCode=a}getCode(t=this.name){let e;const n=this.blockCode;if(""!==n){const{type:r,inputsCode:i,headerCode:s,precision:o}=this;let a=`${r} ${t} ( ${i.trim()} )`;""!==o&&(a=`${o} ${a}`),e=s+a+n}else e="";return e}}class ER extends _R{parseFunction(t){return new MR(t)}}const TR=new WeakMap;class AR extends oE{constructor(t,e){super(),this.renderer=t,this.backend=e,this.nodeFrame=new aR,this.nodeBuilderCache=new Map,this.callHashCache=new QM,this.groupsData=new QM}updateGroup(t){const e=t.groupNode,n=e.name;if(n===tv.name)return!0;if(n===Qg.name){const e=this.get(t),n=this.nodeFrame.renderId;return e.renderId!==n&&(e.renderId=n,!0)}if(n===Jg.name){const e=this.get(t),n=this.nodeFrame.frameId;return e.frameId!==n&&(e.frameId=n,!0)}const r=[e,t];let i=this.groupsData.get(r);return void 0===i&&this.groupsData.set(r,i={}),i.version!==e.version&&(i.version=e.version,!0)}getForRenderCacheKey(t){return t.initialCacheKey}getForRender(t){const e=this.get(t);let n=e.nodeBuilderState;if(void 0===n){const{nodeBuilderCache:r}=this,i=this.getForRenderCacheKey(t);if(n=r.get(i),void 0===n){const e=this.backend.createNodeBuilder(t.object,this.renderer);e.scene=t.scene,e.material=t.material,e.camera=t.camera,e.context.material=t.material,e.lightsNode=t.lightsNode,e.environmentNode=this.getEnvironmentNode(t.scene),e.fogNode=this.getFogNode(t.scene),e.clippingContext=t.clippingContext,e.build(),n=this._createNodeBuilderState(e),r.set(i,n)}n.usedTimes++,e.nodeBuilderState=n}return n}delete(t){if(t.isRenderObject){const e=this.get(t).nodeBuilderState;e.usedTimes--,0===e.usedTimes&&this.nodeBuilderCache.delete(this.getForRenderCacheKey(t))}return super.delete(t)}getForCompute(t){const e=this.get(t);let n=e.nodeBuilderState;if(void 0===n){const r=this.backend.createNodeBuilder(t,this.renderer);r.build(),n=this._createNodeBuilderState(r),e.nodeBuilderState=n}return n}_createNodeBuilderState(t){return new pC(t.vertexShader,t.fragmentShader,t.computeShader,t.getAttributesArray(),t.getBindings(),t.updateNodes,t.updateBeforeNodes,t.updateAfterNodes,t.monitor,t.transforms)}getEnvironmentNode(t){return t.environmentNode||this.get(t).environmentNode||null}getBackgroundNode(t){return t.backgroundNode||this.get(t).backgroundNode||null}getFogNode(t){return t.fogNode||this.get(t).fogNode||null}getCacheKey(t,e){const n=[t,e],r=this.renderer.info.calls;let i=this.callHashCache.get(n);if(void 0===i||i.callId!==r){const s=this.getEnvironmentNode(t),o=this.getFogNode(t),a=[];e&&a.push(e.getCacheKey(!0)),s&&a.push(s.getCacheKey()),o&&a.push(o.getCacheKey()),a.push(this.renderer.shadowMap.enabled?1:0),i={callId:r,cacheKey:ym(a)},this.callHashCache.set(n,i)}return i.cacheKey}updateScene(t){this.updateEnvironment(t),this.updateFog(t),this.updateBackground(t)}get isToneMappingState(){return!this.renderer.getRenderTarget()}updateBackground(t){const e=this.get(t),n=t.background;if(n){const r=0===t.backgroundBlurriness&&e.backgroundBlurriness>0||t.backgroundBlurriness>0&&0===e.backgroundBlurriness;if(e.background!==n||r){let r=null;if(!0===n.isCubeTexture||n.mapping===Lu||n.mapping===Uu||n.mapping===ku)if(t.backgroundBlurriness>0||n.mapping===ku)r=TM(n);else{let t;t=!0===n.isCubeTexture?Ox(n):Y_(n),r=Kw(t)}else!0===n.isTexture?r=Y_(n,mw.flipY()).setUpdateMatrix(!0):!0!==n.isColor&&console.error("WebGPUNodes: Unsupported background configuration.",n);e.backgroundNode=r,e.background=n,e.backgroundBlurriness=t.backgroundBlurriness}}else e.backgroundNode&&(delete e.backgroundNode,delete e.background)}updateFog(t){const e=this.get(t),n=t.fog;if(n){if(e.fog!==n){let t=null;if(n.isFogExp2){const e=Vx("color","color",n).setGroup(Qg),r=Vx("density","float",n).setGroup(Qg);t=BA(e,r)}else if(n.isFog){const e=Vx("color","color",n).setGroup(Qg),r=Vx("near","float",n).setGroup(Qg),i=Vx("far","float",n).setGroup(Qg);t=UA(e,r,i)}else console.error("WebGPUNodes: Unsupported fog configuration.",n);e.fogNode=t,e.fog=n}}else delete e.fogNode,delete e.fog}updateEnvironment(t){const e=this.get(t),n=t.environment;if(n){if(e.environment!==n){let t=null;!0===n.isCubeTexture?t=Ox(n):!0===n.isTexture?t=Y_(n):console.error("Nodes: Unsupported environment configuration.",n),e.environmentNode=t,e.environment=n}}else e.environmentNode&&(delete e.environmentNode,delete e.environment)}getNodeFrame(t=this.renderer,e=null,n=null,r=null,i=null){const s=this.nodeFrame;return s.renderer=t,s.scene=e,s.object=n,s.camera=r,s.material=i,s}getNodeFrameForRender(t){return this.getNodeFrame(t.renderer,t.scene,t.object,t.camera,t.material)}getOutputCacheKey(){const t=this.renderer;return t.toneMapping+","+t.currentColorSpace}hasOutputChange(t){return TR.get(t)!==this.getOutputCacheKey()}getOutputNode(t){const e=this.renderer,n=this.getOutputCacheKey(),r=Y_(t,mw).renderOutput(e.toneMapping,e.currentColorSpace);return TR.set(t,n),r}updateBefore(t){const e=t.getNodeBuilderState();for(const n of e.updateBeforeNodes)this.getNodeFrameForRender(t).updateBeforeNode(n)}updateAfter(t){const e=t.getNodeBuilderState();for(const n of e.updateAfterNodes)this.getNodeFrameForRender(t).updateAfterNode(n)}updateForCompute(t){const e=this.getNodeFrame(),n=this.getForCompute(t);for(const t of n.updateNodes)e.updateNode(t)}updateForRender(t){const e=this.getNodeFrameForRender(t),n=t.getNodeBuilderState();for(const t of n.updateNodes)e.updateNode(t)}needsRefresh(t){const e=this.getNodeFrameForRender(t);return t.getMonitor().needsRefresh(t,e)}dispose(){super.dispose(),this.nodeFrame=new aR,this.nodeBuilderCache=new Map}}class CR{constructor(t,e){this.scene=t,this.camera=e}clone(){return Object.assign(new this.constructor,this)}}class RR{constructor(){this.lists=new QM}get(t,e){const n=this.lists,r=[t,e];let i=n.get(r);return void 0===i&&(i=new CR(t,e),n.set(r,i)),i}dispose(){this.lists=new QM}}class NR{constructor(){this.lightNodes=new WeakMap,this.materialNodes=new Map,this.toneMappingNodes=new Map}fromMaterial(t){if(t.isNodeMaterial)return t;let e=null;const n=this.getMaterialNodeClass(t.type);if(null!==n){e=new n;for(const n in t)e[n]=t[n]}return e}addToneMapping(t,e){this.addType(t,e,this.toneMappingNodes)}getToneMappingFunction(t){return this.toneMappingNodes.get(t)||null}getMaterialNodeClass(t){return this.materialNodes.get(t)||null}addMaterial(t,e){this.addType(t,e.type,this.materialNodes)}getLightNodeClass(t){return this.lightNodes.get(t)||null}addLight(t,e){this.addClass(t,e,this.lightNodes)}addType(t,e,n){if(n.has(e))console.warn(`Redefinition of node ${e}`);else{if("function"!=typeof t)throw new Error(`Node class ${t.name} is not a class.`);if("function"==typeof e||"object"==typeof e)throw new Error(`Base class ${e} is not a class.`);n.set(e,t)}}addClass(t,e,n){if(n.has(e))console.warn(`Redefinition of node ${e.name}`);else{if("function"!=typeof t)throw new Error(`Node class ${t.name} is not a class.`);if("function"!=typeof e)throw new Error(`Base class ${e.name} is not a class.`);n.set(e,t)}}}const PR=new XA;class IR extends QM{constructor(){super()}createNode(t=[]){return(new XA).setLights(t)}getNode(t,e){if(t.isQuadMesh)return PR;const n=[t,e];let r=this.get(n);return void 0===r&&(r=this.createNode(),this.set(n,r)),r}}const OR=new Zp,DR=new oh,LR=new Th,UR=new lf,kR=new ad,BR=new Th;class FR{constructor(t,e={}){this.isRenderer=!0;const{logarithmicDepthBuffer:n=!1,alpha:r=!0,depth:i=!0,stencil:s=!1,antialias:o=!1,samples:a=0,getFallback:l=null}=e;this.domElement=t.getDomElement(),this.backend=t,this.samples=a||!0===o?4:0,this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.alpha=r,this.logarithmicDepthBuffer=n,this.outputColorSpace=Fc,this.toneMapping=0,this.toneMappingExposure=1,this.sortObjects=!0,this.depth=i,this.stencil=s,this.clippingPlanes=[],this.info=new gE,this.nodes={modelViewMatrix:null,modelNormalViewMatrix:null},this.library=new NR,this.lighting=new IR,this._getFallback=l,this._pixelRatio=1,this._width=this.domElement.width,this._height=this.domElement.height,this._viewport=new Th(0,0,this._width,this._height),this._scissor=new Th(0,0,this._width,this._height),this._scissorTest=!1,this._attributes=null,this._geometries=null,this._nodes=null,this._animation=null,this._bindings=null,this._objects=null,this._pipelines=null,this._bundles=null,this._renderLists=null,this._renderContexts=null,this._textures=null,this._background=null,this._quad=new jE(new kw),this._quad.material.type="Renderer_output",this._currentRenderContext=null,this._opaqueSort=null,this._transparentSort=null,this._frameBufferTarget=null;const u=!0===this.alpha?0:1;this._clearColor=new LE(0,0,0,u),this._clearDepth=1,this._clearStencil=0,this._renderTarget=null,this._activeCubeFace=0,this._activeMipmapLevel=0,this._mrt=null,this._renderObjectFunction=null,this._currentRenderObjectFunction=null,this._currentRenderBundle=null,this._handleObjectFunction=this._renderObjectDirect,this._isDeviceLost=!1,this.onDeviceLost=this._onDeviceLost,this._initialized=!1,this._initPromise=null,this._compilationPromises=null,this.transparent=!0,this.opaque=!0,this.shadowMap={enabled:!1,type:1},this.xr={enabled:!1},this.debug={checkShaderErrors:!0,onShaderError:null,getShaderAsync:async(t,e,n)=>{await this.compileAsync(t,e);const r=this._renderLists.get(t,e),i=this._renderContexts.get(t,e,this._renderTarget),s=t.overrideMaterial||n.material,o=this._objects.get(n,s,t,e,r.lightsNode,i),{fragmentShader:a,vertexShader:l}=o.getNodeBuilderState();return{fragmentShader:a,vertexShader:l}}}}async init(){if(this._initialized)throw new Error("Renderer: Backend has already been initialized.");return null!==this._initPromise||(this._initPromise=new Promise((async(t,e)=>{let n=this.backend;try{await n.init(this)}catch(t){if(null===this._getFallback)return void e(t);try{this.backend=n=this._getFallback(t),await n.init(this)}catch(t){return void e(t)}}this._nodes=new AR(this,n),this._animation=new JM(this._nodes,this.info),this._attributes=new dE(n),this._background=new cC(this,this._nodes),this._geometries=new mE(this._attributes,this.info),this._textures=new DE(this,n,this.info),this._pipelines=new wE(n,this._nodes),this._bindings=new SE(n,this._nodes,this._textures,this._attributes,this._pipelines,this.info),this._objects=new sE(this,this._nodes,this._geometries,this._pipelines,this._bindings,this.info),this._renderLists=new CE(this.lighting),this._bundles=new RR,this._renderContexts=new IE,this._initialized=!0,t()}))),this._initPromise}get coordinateSystem(){return this.backend.coordinateSystem}async compileAsync(t,e,n=null){if(!0===this._isDeviceLost)return;!1===this._initialized&&await this.init();const r=this._nodes.nodeFrame,i=r.renderId,s=this._currentRenderContext,o=this._currentRenderObjectFunction,a=this._compilationPromises,l=!0===t.isScene?t:OR;null===n&&(n=t);const u=this._renderTarget,c=this._renderContexts.get(n,e,u),h=this._activeMipmapLevel,d=[];this._currentRenderContext=c,this._currentRenderObjectFunction=this.renderObject,this._handleObjectFunction=this._createObjectPipeline,this._compilationPromises=d,r.renderId++,r.update(),c.depth=this.depth,c.stencil=this.stencil,c.clippingContext||(c.clippingContext=new eE),c.clippingContext.updateGlobal(this,e),l.onBeforeRender(this,t,e,u);const p=this._renderLists.get(t,e);if(p.begin(),this._projectObject(t,e,0,p),n!==t&&n.traverseVisible((function(t){t.isLight&&t.layers.test(e.layers)&&p.pushLight(t)})),p.finish(),null!==u){this._textures.updateRenderTarget(u,h);const t=this._textures.get(u);c.textures=t.textures,c.depthTexture=t.depthTexture}else c.textures=null,c.depthTexture=null;this._nodes.updateScene(l),this._background.update(l,p,c);const f=p.opaque,m=p.transparent,g=p.lightsNode;!0===this.opaque&&f.length>0&&this._renderObjects(f,e,l,g),!0===this.transparent&&m.length>0&&this._renderTransparents(m,e,l,g),r.renderId=i,this._currentRenderContext=s,this._currentRenderObjectFunction=o,this._compilationPromises=a,this._handleObjectFunction=this._renderObjectDirect,await Promise.all(d)}async renderAsync(t,e){!1===this._initialized&&await this.init();const n=this._renderScene(t,e);await this.backend.resolveTimestampAsync(n,"render")}async waitForGPU(){await this.backend.waitForGPU()}setMRT(t){return this._mrt=t,this}getMRT(){return this._mrt}_onDeviceLost(t){let e=`THREE.WebGPURenderer: ${t.api} Device Lost:\n\nMessage: ${t.message}`;t.reason&&(e+=`\nReason: ${t.reason}`),console.error(e),this._isDeviceLost=!0}_renderBundle(t,e,n){const{bundleGroup:r,camera:i,renderList:s}=t,o=this._currentRenderContext,a=this._bundles.get(r,i),l=this.backend.get(a);void 0===l.renderContexts&&(l.renderContexts=new Set);const u=r.version!==l.version,c=!1===l.renderContexts.has(o)||u;if(l.renderContexts.add(o),c){this.backend.beginBundle(o),(void 0===l.renderObjects||u)&&(l.renderObjects=[]),this._currentRenderBundle=a;const t=s.opaque;!0===this.opaque&&t.length>0&&this._renderObjects(t,i,e,n),this._currentRenderBundle=null,this.backend.finishBundle(o,a),l.version=r.version}else{const{renderObjects:t}=l;for(let e=0,n=t.length;e<n;e++){const n=t[e];this._nodes.needsRefresh(n)&&(this._nodes.updateBefore(n),this._nodes.updateForRender(n),this._bindings.updateForRender(n),this._nodes.updateAfter(n))}}this.backend.addBundle(o,a)}render(t,e){if(!1===this._initialized)return console.warn("THREE.Renderer: .render() called before the backend is initialized. Try using .renderAsync() instead."),this.renderAsync(t,e);this._renderScene(t,e)}_getFrameBufferTarget(){const{currentToneMapping:t,currentColorSpace:e}=this;if(!1===(0!==t)&&!1===(e!==zc))return null;const{width:n,height:r}=this.getDrawingBufferSize(DR),{depth:i,stencil:s}=this;let o=this._frameBufferTarget;return null===o&&(o=new Ah(n,r,{depthBuffer:i,stencilBuffer:s,type:tc,format:rc,colorSpace:zc,generateMipmaps:!1,minFilter:Hu,magFilter:Hu,samples:this.samples}),o.isPostProcessingRenderTarget=!0,this._frameBufferTarget=o),o.depthBuffer=i,o.stencilBuffer=s,o.setSize(n,r),o.viewport.copy(this._viewport),o.scissor.copy(this._scissor),o.viewport.multiplyScalar(this._pixelRatio),o.scissor.multiplyScalar(this._pixelRatio),o.scissorTest=this._scissorTest,o}_renderScene(t,e,n=!0){if(!0===this._isDeviceLost)return;const r=n?this._getFrameBufferTarget():null,i=this._nodes.nodeFrame,s=i.renderId,o=this._currentRenderContext,a=this._currentRenderObjectFunction,l=!0===t.isScene?t:OR,u=this._renderTarget,c=this._activeCubeFace,h=this._activeMipmapLevel;let d;null!==r?(d=r,this.setRenderTarget(d)):d=u;const p=this._renderContexts.get(t,e,d);this._currentRenderContext=p,this._currentRenderObjectFunction=this._renderObjectFunction||this.renderObject,this.info.calls++,this.info.render.calls++,this.info.render.frameCalls++,i.renderId=this.info.calls;const f=this.coordinateSystem;e.coordinateSystem!==f&&(e.coordinateSystem=f,e.updateProjectionMatrix()),!0===t.matrixWorldAutoUpdate&&t.updateMatrixWorld(),null===e.parent&&!0===e.matrixWorldAutoUpdate&&e.updateMatrixWorld();let m=this._viewport,g=this._scissor,v=this._pixelRatio;null!==d&&(m=d.viewport,g=d.scissor,v=1),this.getDrawingBufferSize(DR),LR.set(0,0,DR.width,DR.height);const y=void 0===m.minDepth?0:m.minDepth,_=void 0===m.maxDepth?1:m.maxDepth;p.viewportValue.copy(m).multiplyScalar(v).floor(),p.viewportValue.width>>=h,p.viewportValue.height>>=h,p.viewportValue.minDepth=y,p.viewportValue.maxDepth=_,p.viewport=!1===p.viewportValue.equals(LR),p.scissorValue.copy(g).multiplyScalar(v).floor(),p.scissor=this._scissorTest&&!1===p.scissorValue.equals(LR),p.scissorValue.width>>=h,p.scissorValue.height>>=h,p.clippingContext||(p.clippingContext=new eE),p.clippingContext.updateGlobal(this,e),l.onBeforeRender(this,t,e,d),kR.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),UR.setFromProjectionMatrix(kR,f);const x=this._renderLists.get(t,e);if(x.begin(),this._projectObject(t,e,0,x),x.finish(),!0===this.sortObjects&&x.sort(this._opaqueSort,this._transparentSort),null!==d){this._textures.updateRenderTarget(d,h);const t=this._textures.get(d);p.textures=t.textures,p.depthTexture=t.depthTexture,p.width=t.width,p.height=t.height,p.renderTarget=d,p.depth=d.depthBuffer,p.stencil=d.stencilBuffer}else p.textures=null,p.depthTexture=null,p.width=this.domElement.width,p.height=this.domElement.height,p.depth=this.depth,p.stencil=this.stencil;p.width>>=h,p.height>>=h,p.activeCubeFace=c,p.activeMipmapLevel=h,p.occlusionQueryCount=x.occlusionQueryCount,this._nodes.updateScene(l),this._background.update(l,x,p),this.backend.beginRender(p);const{bundles:b,lightsNode:w,transparentDoublePass:S,transparent:M,opaque:E}=x;if(b.length>0&&this._renderBundles(b,l,w),!0===this.opaque&&E.length>0&&this._renderObjects(E,e,l,w),!0===this.transparent&&M.length>0&&this._renderTransparents(M,S,e,l,w),this.backend.finishRender(p),i.renderId=s,this._currentRenderContext=o,this._currentRenderObjectFunction=a,null!==r){this.setRenderTarget(u,c,h);const t=this._quad;this._nodes.hasOutputChange(d.texture)&&(t.material.fragmentNode=this._nodes.getOutputNode(d.texture),t.material.needsUpdate=!0),this._renderScene(t,t.camera,!1)}return l.onAfterRender(this,t,e,d),p}getMaxAnisotropy(){return this.backend.getMaxAnisotropy()}getActiveCubeFace(){return this._activeCubeFace}getActiveMipmapLevel(){return this._activeMipmapLevel}async setAnimationLoop(t){!1===this._initialized&&await this.init(),this._animation.setAnimationLoop(t)}async getArrayBufferAsync(t){return await this.backend.getArrayBufferAsync(t)}getContext(){return this.backend.getContext()}getPixelRatio(){return this._pixelRatio}getDrawingBufferSize(t){return t.set(this._width*this._pixelRatio,this._height*this._pixelRatio).floor()}getSize(t){return t.set(this._width,this._height)}setPixelRatio(t=1){this._pixelRatio!==t&&(this._pixelRatio=t,this.setSize(this._width,this._height,!1))}setDrawingBufferSize(t,e,n){this._width=t,this._height=e,this._pixelRatio=n,this.domElement.width=Math.floor(t*n),this.domElement.height=Math.floor(e*n),this.setViewport(0,0,t,e),this._initialized&&this.backend.updateSize()}setSize(t,e,n=!0){this._width=t,this._height=e,this.domElement.width=Math.floor(t*this._pixelRatio),this.domElement.height=Math.floor(e*this._pixelRatio),!0===n&&(this.domElement.style.width=t+"px",this.domElement.style.height=e+"px"),this.setViewport(0,0,t,e),this._initialized&&this.backend.updateSize()}setOpaqueSort(t){this._opaqueSort=t}setTransparentSort(t){this._transparentSort=t}getScissor(t){const e=this._scissor;return t.x=e.x,t.y=e.y,t.width=e.width,t.height=e.height,t}setScissor(t,e,n,r){const i=this._scissor;t.isVector4?i.copy(t):i.set(t,e,n,r)}getScissorTest(){return this._scissorTest}setScissorTest(t){this._scissorTest=t,this.backend.setScissorTest(t)}getViewport(t){return t.copy(this._viewport)}setViewport(t,e,n,r,i=0,s=1){const o=this._viewport;t.isVector4?o.copy(t):o.set(t,e,n,r),o.minDepth=i,o.maxDepth=s}getClearColor(t){return t.copy(this._clearColor)}setClearColor(t,e=1){this._clearColor.set(t),this._clearColor.a=e}getClearAlpha(){return this._clearColor.a}setClearAlpha(t){this._clearColor.a=t}getClearDepth(){return this._clearDepth}setClearDepth(t){this._clearDepth=t}getClearStencil(){return this._clearStencil}setClearStencil(t){this._clearStencil=t}isOccluded(t){const e=this._currentRenderContext;return e&&this.backend.isOccluded(e,t)}clear(t=!0,e=!0,n=!0){if(!1===this._initialized)return console.warn("THREE.Renderer: .clear() called before the backend is initialized. Try using .clearAsync() instead."),this.clearAsync(t,e,n);const r=this._renderTarget||this._getFrameBufferTarget();let i=null;if(null!==r&&(this._textures.updateRenderTarget(r),i=this._textures.get(r)),this.backend.clear(t,e,n,i),null!==r&&null===this._renderTarget){const t=this._quad;this._nodes.hasOutputChange(r.texture)&&(t.material.fragmentNode=this._nodes.getOutputNode(r.texture),t.material.needsUpdate=!0),this._renderScene(t,t.camera,!1)}}clearColor(){return this.clear(!0,!1,!1)}clearDepth(){return this.clear(!1,!0,!1)}clearStencil(){return this.clear(!1,!1,!0)}async clearAsync(t=!0,e=!0,n=!0){!1===this._initialized&&await this.init(),this.clear(t,e,n)}clearColorAsync(){return this.clearAsync(!0,!1,!1)}clearDepthAsync(){return this.clearAsync(!1,!0,!1)}clearStencilAsync(){return this.clearAsync(!1,!1,!0)}get currentToneMapping(){return null!==this._renderTarget?0:this.toneMapping}get currentColorSpace(){return null!==this._renderTarget?zc:this.outputColorSpace}dispose(){this.info.dispose(),this.backend.dispose(),this._animation.dispose(),this._objects.dispose(),this._pipelines.dispose(),this._nodes.dispose(),this._bindings.dispose(),this._renderLists.dispose(),this._renderContexts.dispose(),this._textures.dispose(),this.setRenderTarget(null),this.setAnimationLoop(null)}setRenderTarget(t,e=0,n=0){this._renderTarget=t,this._activeCubeFace=e,this._activeMipmapLevel=n}getRenderTarget(){return this._renderTarget}setRenderObjectFunction(t){this._renderObjectFunction=t}getRenderObjectFunction(){return this._renderObjectFunction}compute(t){if(!0===this.isDeviceLost)return;if(!1===this._initialized)return console.warn("THREE.Renderer: .compute() called before the backend is initialized. Try using .computeAsync() instead."),this.computeAsync(t);const e=this._nodes.nodeFrame,n=e.renderId;this.info.calls++,this.info.compute.calls++,this.info.compute.frameCalls++,e.renderId=this.info.calls;const r=this.backend,i=this._pipelines,s=this._bindings,o=this._nodes,a=Array.isArray(t)?t:[t];if(void 0===a[0]||!0!==a[0].isComputeNode)throw new Error("THREE.Renderer: .compute() expects a ComputeNode.");r.beginCompute(t);for(const e of a){if(!1===i.has(e)){const t=()=>{e.removeEventListener("dispose",t),i.delete(e),s.delete(e),o.delete(e)};e.addEventListener("dispose",t);const n=e.onInitFunction;null!==n&&n.call(e,{renderer:this})}o.updateForCompute(e),s.updateForCompute(e);const n=s.getForCompute(e),a=i.getForCompute(e,n);r.compute(t,e,n,a)}r.finishCompute(t),e.renderId=n}async computeAsync(t){!1===this._initialized&&await this.init(),this.compute(t),await this.backend.resolveTimestampAsync(t,"compute")}async hasFeatureAsync(t){return!1===this._initialized&&await this.init(),this.backend.hasFeature(t)}hasFeature(t){return!1===this._initialized?(console.warn("THREE.Renderer: .hasFeature() called before the backend is initialized. Try using .hasFeatureAsync() instead."),!1):this.backend.hasFeature(t)}copyFramebufferToTexture(t,e=null){if(null!==e)if(e.isVector2)e=BR.set(e.x,e.y,t.image.width,t.image.height).floor();else{if(!e.isVector4)return void console.error("THREE.Renderer.copyFramebufferToTexture: Invalid rectangle.");e=BR.copy(e).floor()}else e=BR.set(0,0,t.image.width,t.image.height);let n,r=this._currentRenderContext;null!==r?n=r.renderTarget:(n=this._renderTarget||this._getFrameBufferTarget(),null!==n&&(this._textures.updateRenderTarget(n),r=this._textures.get(n))),this._textures.updateTexture(t,{renderTarget:n}),this.backend.copyFramebufferToTexture(t,r,e)}copyTextureToTexture(t,e,n=null,r=null,i=0){this._textures.updateTexture(t),this._textures.updateTexture(e),this.backend.copyTextureToTexture(t,e,n,r,i)}readRenderTargetPixelsAsync(t,e,n,r,i,s=0,o=0){return this.backend.copyTextureToBuffer(t.textures[s],e,n,r,i,o)}_projectObject(t,e,n,r){if(!1===t.visible)return;if(t.layers.test(e.layers))if(t.isGroup)n=t.renderOrder;else if(t.isLOD)!0===t.autoUpdate&&t.update(e);else if(t.isLight)r.pushLight(t);else if(t.isSprite){if(!t.frustumCulled||UR.intersectsSprite(t)){!0===this.sortObjects&&BR.setFromMatrixPosition(t.matrixWorld).applyMatrix4(kR);const{geometry:e,material:i}=t;i.visible&&r.push(t,e,i,n,BR.z,null)}}else if(t.isLineLoop)console.error("THREE.Renderer: Objects of type THREE.LineLoop are not supported. Please use THREE.Line or THREE.LineSegments.");else if((t.isMesh||t.isLine||t.isPoints)&&(!t.frustumCulled||UR.intersectsObject(t))){const{geometry:e,material:i}=t;if(!0===this.sortObjects&&(null===e.boundingSphere&&e.computeBoundingSphere(),BR.copy(e.boundingSphere.center).applyMatrix4(t.matrixWorld).applyMatrix4(kR)),Array.isArray(i)){const s=e.groups;for(let o=0,a=s.length;o<a;o++){const a=s[o],l=i[a.materialIndex];l&&l.visible&&r.push(t,e,l,n,BR.z,a)}}else i.visible&&r.push(t,e,i,n,BR.z,null)}if(!0===t.isBundleGroup&&void 0!==this.backend.beginBundle){const n=r;(r=this._renderLists.get(t,e)).begin(),n.pushBundle({bundleGroup:t,camera:e,renderList:r}),r.finish()}const i=t.children;for(let t=0,s=i.length;t<s;t++)this._projectObject(i[t],e,n,r)}_renderBundles(t,e,n){for(const r of t)this._renderBundle(r,e,n)}_renderTransparents(t,e,n,r,i){if(e.length>0){for(const{material:t}of e)t.side=1;this._renderObjects(e,n,r,i,"backSide");for(const{material:t}of e)t.side=0;this._renderObjects(t,n,r,i);for(const{material:t}of e)t.side=2}else this._renderObjects(t,n,r,i)}_renderObjects(t,e,n,r,i=null){for(let s=0,o=t.length;s<o;s++){const o=t[s],{object:a,geometry:l,material:u,group:c}=o;if(e.isArrayCamera){const t=e.cameras;for(let e=0,s=t.length;e<s;e++){const s=t[e];if(a.layers.test(s.layers)){const t=s.viewport,e=void 0===t.minDepth?0:t.minDepth,o=void 0===t.maxDepth?1:t.maxDepth,h=this._currentRenderContext.viewportValue;h.copy(t).multiplyScalar(this._pixelRatio).floor(),h.minDepth=e,h.maxDepth=o,this.backend.updateViewport(this._currentRenderContext),this._currentRenderObjectFunction(a,n,s,l,u,c,r,i)}}}else this._currentRenderObjectFunction(a,n,e,l,u,c,r,i)}}renderObject(t,e,n,r,i,s,o,a=null){let l,u,c;if(t.onBeforeRender(this,e,n,r,i,s),null!==e.overrideMaterial){const t=e.overrideMaterial;i.positionNode&&i.positionNode.isNode&&(l=t.positionNode,t.positionNode=i.positionNode),t.isShadowNodeMaterial&&(t.side=null===i.shadowSide?i.side:i.shadowSide,i.depthNode&&i.depthNode.isNode&&(c=t.depthNode,t.depthNode=i.depthNode),i.shadowNode&&i.shadowNode.isNode&&(u=t.fragmentNode,t.fragmentNode=i.shadowNode),this.localClippingEnabled&&(i.clipShadows?(t.clippingPlanes!==i.clippingPlanes&&(t.clippingPlanes=i.clippingPlanes,t.needsUpdate=!0),t.clipIntersection!==i.clipIntersection&&(t.clipIntersection=i.clipIntersection)):Array.isArray(t.clippingPlanes)&&(t.clippingPlanes=null,t.needsUpdate=!0))),i=t}!0===i.transparent&&2===i.side&&!1===i.forceSinglePass?(i.side=1,this._handleObjectFunction(t,i,e,n,o,s,"backSide"),i.side=0,this._handleObjectFunction(t,i,e,n,o,s,a),i.side=2):this._handleObjectFunction(t,i,e,n,o,s,a),void 0!==l&&(e.overrideMaterial.positionNode=l),void 0!==c&&(e.overrideMaterial.depthNode=c),void 0!==u&&(e.overrideMaterial.fragmentNode=u),t.onAfterRender(this,e,n,r,i,s)}_renderObjectDirect(t,e,n,r,i,s,o){const a=this._objects.get(t,e,n,r,i,this._currentRenderContext,o);a.drawRange=t.geometry.drawRange,a.group=s;const l=this._nodes.needsRefresh(a);if(l&&(this._nodes.updateBefore(a),this._geometries.updateForRender(a),this._nodes.updateForRender(a),this._bindings.updateForRender(a)),this._pipelines.updateForRender(a),null!==this._currentRenderBundle){this.backend.get(this._currentRenderBundle).renderObjects.push(a),a.bundle=this._currentRenderBundle.scene}this.backend.draw(a,this.info),l&&this._nodes.updateAfter(a)}_createObjectPipeline(t,e,n,r,i,s){const o=this._objects.get(t,e,n,r,i,this._currentRenderContext,s);this._nodes.updateBefore(o),this._geometries.updateForRender(o),this._nodes.updateForRender(o),this._bindings.updateForRender(o),this._pipelines.getForRender(o,this._compilationPromises),this._nodes.updateAfter(o)}get compile(){return this.compileAsync}}class zR{constructor(t=""){this.name=t,this.visibility=0}setVisibility(t){this.visibility|=t}clone(){return Object.assign(new this.constructor,this)}}class VR extends zR{constructor(t,e=null){super(t),this.isBuffer=!0,this.bytesPerElement=Float32Array.BYTES_PER_ELEMENT,this._buffer=e}get byteLength(){return(t=this._buffer.byteLength)+(hE-t%hE)%hE;var t}get buffer(){return this._buffer}update(){return!0}}class GR extends VR{constructor(t,e=null){super(t,e),this.isUniformBuffer=!0}}let jR=0;class HR extends GR{constructor(t,e){super("UniformBuffer_"+jR++,t?t.value:null),this.nodeUniform=t,this.groupNode=e}get buffer(){return this.nodeUniform.value}}class WR extends GR{constructor(t){super(t),this.isUniformsGroup=!0,this._values=null,this.uniforms=[]}addUniform(t){return this.uniforms.push(t),this}removeUniform(t){const e=this.uniforms.indexOf(t);return-1!==e&&this.uniforms.splice(e,1),this}get values(){return null===this._values&&(this._values=Array.from(this.buffer)),this._values}get buffer(){let t=this._buffer;if(null===t){const e=this.byteLength;t=new Float32Array(new ArrayBuffer(e)),this._buffer=t}return t}get byteLength(){let t=0;for(let e=0,n=this.uniforms.length;e<n;e++){const n=this.uniforms[e],{boundary:r,itemSize:i}=n,s=t%hE;0!==s&&hE-s-r<0?t+=hE-s:s%r!=0&&(t+=s%r),n.offset=t/this.bytesPerElement,t+=i*this.bytesPerElement}return Math.ceil(t/hE)*hE}update(){let t=!1;for(const e of this.uniforms)!0===this.updateByType(e)&&(t=!0);return t}updateByType(t){return t.isNumberUniform?this.updateNumber(t):t.isVector2Uniform?this.updateVector2(t):t.isVector3Uniform?this.updateVector3(t):t.isVector4Uniform?this.updateVector4(t):t.isColorUniform?this.updateColor(t):t.isMatrix3Uniform?this.updateMatrix3(t):t.isMatrix4Uniform?this.updateMatrix4(t):void console.error("THREE.WebGPUUniformsGroup: Unsupported uniform type.",t)}updateNumber(t){let e=!1;const n=this.values,r=t.getValue(),i=t.offset;if(n[i]!==r){this.buffer[i]=n[i]=r,e=!0}return e}updateVector2(t){let e=!1;const n=this.values,r=t.getValue(),i=t.offset;if(n[i+0]!==r.x||n[i+1]!==r.y){const t=this.buffer;t[i+0]=n[i+0]=r.x,t[i+1]=n[i+1]=r.y,e=!0}return e}updateVector3(t){let e=!1;const n=this.values,r=t.getValue(),i=t.offset;if(n[i+0]!==r.x||n[i+1]!==r.y||n[i+2]!==r.z){const t=this.buffer;t[i+0]=n[i+0]=r.x,t[i+1]=n[i+1]=r.y,t[i+2]=n[i+2]=r.z,e=!0}return e}updateVector4(t){let e=!1;const n=this.values,r=t.getValue(),i=t.offset;if(n[i+0]!==r.x||n[i+1]!==r.y||n[i+2]!==r.z||n[i+4]!==r.w){const t=this.buffer;t[i+0]=n[i+0]=r.x,t[i+1]=n[i+1]=r.y,t[i+2]=n[i+2]=r.z,t[i+3]=n[i+3]=r.w,e=!0}return e}updateColor(t){let e=!1;const n=this.values,r=t.getValue(),i=t.offset;if(n[i+0]!==r.r||n[i+1]!==r.g||n[i+2]!==r.b){const t=this.buffer;t[i+0]=n[i+0]=r.r,t[i+1]=n[i+1]=r.g,t[i+2]=n[i+2]=r.b,e=!0}return e}updateMatrix3(t){let e=!1;const n=this.values,r=t.getValue().elements,i=t.offset;if(n[i+0]!==r[0]||n[i+1]!==r[1]||n[i+2]!==r[2]||n[i+4]!==r[3]||n[i+5]!==r[4]||n[i+6]!==r[5]||n[i+8]!==r[6]||n[i+9]!==r[7]||n[i+10]!==r[8]){const t=this.buffer;t[i+0]=n[i+0]=r[0],t[i+1]=n[i+1]=r[1],t[i+2]=n[i+2]=r[2],t[i+4]=n[i+4]=r[3],t[i+5]=n[i+5]=r[4],t[i+6]=n[i+6]=r[5],t[i+8]=n[i+8]=r[6],t[i+9]=n[i+9]=r[7],t[i+10]=n[i+10]=r[8],e=!0}return e}updateMatrix4(t){let e=!1;const n=this.values,r=t.getValue().elements,i=t.offset;if(!1===function(t,e,n){for(let r=0,i=e.length;r<i;r++)if(t[n+r]!==e[r])return!1;return!0}(n,r,i)){this.buffer.set(r,i),function(t,e,n){for(let r=0,i=e.length;r<i;r++)t[n+r]=e[r]}(n,r,i),e=!0}return e}}let qR=0;class XR extends WR{constructor(t,e){super(t),this.id=qR++,this.groupNode=e,this.isNodeUniformsGroup=!0}getNodes(){const t=[];for(const e of this.uniforms){const n=e.nodeUniform.node;if(!n)throw new Error("NodeUniformsGroup: Uniform has no node.");t.push(n)}return t}}let ZR=0;class $R extends zR{constructor(t,e){super(t),this.id=ZR++,this.texture=e,this.version=e?e.version:0,this.store=!1,this.generation=null,this.isSampledTexture=!0}needsBindingsUpdate(t){const{texture:e}=this;return t!==this.generation?(this.generation=t,!0):e.isVideoTexture}update(){const{texture:t,version:e}=this;return e!==t.version&&(this.version=t.version,!0)}}class YR extends $R{constructor(t,e,n,r=null){super(t,e?e.value:null),this.textureNode=e,this.groupNode=n,this.access=r}needsBindingsUpdate(t){return this.textureNode.value!==this.texture||super.needsBindingsUpdate(t)}update(){const{textureNode:t}=this;return this.texture!==t.value?(this.texture=t.value,!0):super.update()}}class KR extends YR{constructor(t,e,n,r){super(t,e,n,r),this.isSampledCubeTexture=!0}}class JR extends YR{constructor(t,e,n,r){super(t,e,n,r),this.isSampledTexture3D=!0}}const QR={atan2:"atan",textureDimensions:"textureSize",equals:"equal"},tN={low:"lowp",medium:"mediump",high:"highp"},eN={swizzleAssign:!0,storageBuffer:!1},nN="\nprecision highp float;\nprecision highp int;\nprecision highp sampler2D;\nprecision highp sampler3D;\nprecision highp samplerCube;\nprecision highp sampler2DArray;\n\nprecision highp usampler2D;\nprecision highp usampler3D;\nprecision highp usamplerCube;\nprecision highp usampler2DArray;\n\nprecision highp isampler2D;\nprecision highp isampler3D;\nprecision highp isamplerCube;\nprecision highp isampler2DArray;\n\nprecision lowp sampler2DShadow;\n";class rN extends oR{constructor(t,e){super(t,e,new ER),this.uniformGroups={},this.transforms=[],this.extensions={},this.useComparisonMethod=!0}needsColorSpaceToLinearSRGB(t){return!0===t.isVideoTexture&&t.colorSpace!==Bc}getMethod(t){return QR[t]||t}getOutputStructName(){return""}buildFunctionCode(t){const e=t.layout,n=this.flowShaderNode(t),r=[];for(const t of e.inputs)r.push(this.getType(t.type)+" "+t.name);return`${this.getType(e.type)} ${e.name}( ${r.join(", ")} ) {\n\n\t${n.vars}\n\n${n.code}\n\treturn ${n.result};\n\n}`}setupPBO(t){const e=t.value;if(void 0===e.pbo){const t=e.array,n=e.count*e.itemSize,{itemSize:r}=e,i=e.array.constructor.name.toLowerCase().includes("int");let s=i?ac:oc;2===r?s=i?uc:lc:3===r?s=i?1032:nc:4===r&&(s=i?cc:rc);const o={Float32Array:Qu,Uint8Array:Xu,Uint16Array:Yu,Uint32Array:Ju,Int8Array:Zu,Int16Array:$u,Int32Array:Ku,Uint8ClampedArray:Xu},a=Math.pow(2,Math.ceil(Math.log2(Math.sqrt(n/r))));let l=Math.ceil(n/r/a);a*l*r<n&&l++;const u=a*l*r,c=new t.constructor(u);c.set(t,0),e.array=c;const h=new Qp(e.array,a,l,s,o[e.array.constructor.name]||Qu);h.needsUpdate=!0,h.isPBOTexture=!0;const d=new $_(h,null,null);d.setPrecision("high"),e.pboNode=d,e.pbo=d.value,this.getUniformFromNode(e.pboNode,"texture",this.shaderStage,this.context.label)}}getPropertyName(t,e=this.shaderStage){return t.isNodeUniform&&!0!==t.node.isTextureNode&&!0!==t.node.isBufferNode?e.charAt(0)+"_"+t.name:super.getPropertyName(t,e)}generatePBO(t){const{node:e,indexNode:n}=t,r=e.value;if(this.renderer.backend.has(r)){this.renderer.backend.get(r).pbo=r.pbo}const i=this.getUniformFromNode(r.pboNode,"texture",this.shaderStage,this.context.label),s=this.getPropertyName(i);this.increaseUsage(n);const o=n.build(this,"uint"),a=this.getDataFromNode(t);let l=a.propertyName;if(void 0===l){const n=this.getVarFromNode(t);l=this.getPropertyName(n);const i=this.getDataFromNode(e);let u=i.propertySizeName;void 0===u&&(u=l+"Size",this.getVarFromNode(e,u,"uint"),this.addLineFlowCode(`${u} = uint( textureSize( ${s}, 0 ).x )`,t),i.propertySizeName=u);const{itemSize:c}=r,h="."+Om.join("").slice(0,c),d=`ivec2(${o} % ${u}, ${o} / ${u})`,p=this.generateTextureLoad(null,s,d,null,"0");let f="vec4";r.pbo.type===Ju?f="uvec4":r.pbo.type===Ku&&(f="ivec4"),this.addLineFlowCode(`${l} = ${f}(${p})${h}`,t),a.propertyName=l}return l}generateTextureLoad(t,e,n,r,i="0"){return r?`texelFetch( ${e}, ivec3( ${n}, ${r} ), ${i} )`:`texelFetch( ${e}, ${n}, ${i} )`}generateTexture(t,e,n,r){return t.isDepthTexture?`texture( ${e}, ${n} ).x`:(r&&(n=`vec3( ${n}, ${r} )`),`texture( ${e}, ${n} )`)}generateTextureLevel(t,e,n,r){return`textureLod( ${e}, ${n}, ${r} )`}generateTextureBias(t,e,n,r){return`texture( ${e}, ${n}, ${r} )`}generateTextureGrad(t,e,n,r){return`textureGrad( ${e}, ${n}, ${r[0]}, ${r[1]} )`}generateTextureCompare(t,e,n,r,i,s=this.shaderStage){if("fragment"===s)return`texture( ${e}, vec3( ${n}, ${r} ) )`;console.error(`WebGPURenderer: THREE.DepthTexture.compareFunction() does not support ${s} shader.`)}getVars(t){const e=[],n=this.vars[t];if(void 0!==n)for(const t of n)e.push(`${this.getVar(t.type,t.name)};`);return e.join("\n\t")}getUniforms(t){const e=this.uniforms[t],n=[],r={};for(const i of e){let e=null,s=!1;if("texture"===i.type){const t=i.node.value;let n="";!0===t.isDataTexture&&(t.type===Ju?n="u":t.type===Ku&&(n="i")),e=t.compareFunction?`sampler2DShadow ${i.name};`:!0===t.isDataArrayTexture||!0===t.isCompressedArrayTexture?`${n}sampler2DArray ${i.name};`:`${n}sampler2D ${i.name};`}else if("cubeTexture"===i.type)e=`samplerCube ${i.name};`;else if("texture3D"===i.type)e=`sampler3D ${i.name};`;else if("buffer"===i.type){const t=i.node,n=this.getType(t.bufferType),r=t.bufferCount,s=r>0?r:"";e=`${t.name} {\n\t${n} ${i.name}[${s}];\n};\n`}else{e=`${this.getVectorType(i.type)} ${this.getPropertyName(i,t)};`,s=!0}const o=i.node.precision;if(null!==o&&(e=tN[o]+" "+e),s){e="\t"+e;const t=i.groupNode.name;(r[t]||(r[t]=[])).push(e)}else e="uniform "+e,n.push(e)}let i="";for(const e in r){const n=r[e];i+=this._getGLSLUniformStruct(t+"_"+e,n.join("\n"))+"\n"}return i+=n.join("\n"),i}getTypeFromAttribute(t){let e=super.getTypeFromAttribute(t);if(/^[iu]/.test(e)&&t.gpuType!==Ku){let n=t;t.isInterleavedBufferAttribute&&(n=t.data);const r=n.array;!1==(r instanceof Uint32Array||r instanceof Int32Array)&&(e=e.slice(1))}return e}getAttributes(t){let e="";if("vertex"===t||"compute"===t){const t=this.getAttributesArray();let n=0;for(const r of t)e+=`layout( location = ${n++} ) in ${r.type} ${r.name};\n`}return e}getStructMembers(t){const e=[],n=t.getMemberTypes();for(let t=0;t<n.length;t++){const r=n[t];e.push(`layout( location = ${t} ) out ${r} m${t};`)}return e.join("\n")}getStructs(t){const e=[],n=this.structs[t];if(0===n.length)return"layout( location = 0 ) out vec4 fragColor;\n";for(let t=0,r=n.length;t<r;t++){const r=n[t];let i="\n";i+=this.getStructMembers(r),i+="\n",e.push(i)}return e.join("\n\n")}getVaryings(t){let e="";const n=this.varyings;if("vertex"===t||"compute"===t)for(const r of n){"compute"===t&&(r.needsInterpolation=!0);const n=r.type;e+=`${n.includes("int")||n.includes("uv")||n.includes("iv")?"flat ":""}${r.needsInterpolation?"out":"/*out*/"} ${n} ${r.name};\n`}else if("fragment"===t)for(const t of n)if(t.needsInterpolation){const n=t.type;e+=`${n.includes("int")||n.includes("uv")||n.includes("iv")?"flat ":""}in ${n} ${t.name};\n`}return e}getVertexIndex(){return"uint( gl_VertexID )"}getInstanceIndex(){return"uint( gl_InstanceID )"}getInvocationLocalIndex(){return`uint( gl_InstanceID ) % ${this.object.workgroupSize.reduce(((t,e)=>t*e),1)}u`}getDrawIndex(){return this.renderer.backend.extensions.has("WEBGL_multi_draw")?"uint( gl_DrawID )":null}getFrontFacing(){return"gl_FrontFacing"}getFragCoord(){return"gl_FragCoord.xy"}getFragDepth(){return"gl_FragDepth"}enableExtension(t,e,n=this.shaderStage){const r=this.extensions[n]||(this.extensions[n]=new Map);!1===r.has(t)&&r.set(t,{name:t,behavior:e})}getExtensions(t){const e=[];if("vertex"===t){const e=this.renderer.backend.extensions;this.object.isBatchedMesh&&e.has("WEBGL_multi_draw")&&this.enableExtension("GL_ANGLE_multi_draw","require",t)}const n=this.extensions[t];if(void 0!==n)for(const{name:t,behavior:r}of n.values())e.push(`#extension ${t} : ${r}`);return e.join("\n")}isAvailable(t){let e=eN[t];if(void 0===e){if("float32Filterable"===t){const t=this.renderer.backend.extensions;t.has("OES_texture_float_linear")?(t.get("OES_texture_float_linear"),e=!0):e=!1}eN[t]=e}return e}isFlipY(){return!0}registerTransform(t,e){this.transforms.push({varyingName:t,attributeNode:e})}getTransforms(){const t=this.transforms;let e="";for(let n=0;n<t.length;n++){const r=t[n],i=this.getPropertyName(r.attributeNode);e+=`${r.varyingName} = ${i};\n\t`}return e}_getGLSLUniformStruct(t,e){return`\nlayout( std140 ) uniform ${t} {\n${e}\n};`}_getGLSLVertexCode(t){return`#version 300 es\n\n${this.getSignature()}\n\n// extensions \n${t.extensions}\n\n// precision\n${nN}\n\n// uniforms\n${t.uniforms}\n\n// varyings\n${t.varyings}\n\n// attributes\n${t.attributes}\n\n// codes\n${t.codes}\n\nvoid main() {\n\n\t// vars\n\t${t.vars}\n\n\t// transforms\n\t${t.transforms}\n\n\t// flow\n\t${t.flow}\n\n\tgl_PointSize = 1.0;\n\n}\n`}_getGLSLFragmentCode(t){return`#version 300 es\n\n${this.getSignature()}\n\n// precision\n${nN}\n\n// uniforms\n${t.uniforms}\n\n// varyings\n${t.varyings}\n\n// codes\n${t.codes}\n\n${t.structs}\n\nvoid main() {\n\n\t// vars\n\t${t.vars}\n\n\t// flow\n\t${t.flow}\n\n}\n`}buildCode(){const t=null!==this.material?{fragment:{},vertex:{}}:{compute:{}};this.sortBindingGroups();for(const e in t){let n="// code\n\n";n+=this.flowCode[e];const r=this.flowNodes[e],i=r[r.length-1];for(const t of r){const r=this.getFlowData(t),s=t.name;s&&(n.length>0&&(n+="\n"),n+=`\t// flow -> ${s}\n\t`),n+=`${r.code}\n\t`,t===i&&"compute"!==e&&(n+="// result\n\t","vertex"===e?(n+="gl_Position = ",n+=`${r.result};`):"fragment"===e&&(t.outputNode.isOutputStructNode||(n+="fragColor = ",n+=`${r.result};`)))}const s=t[e];s.extensions=this.getExtensions(e),s.uniforms=this.getUniforms(e),s.attributes=this.getAttributes(e),s.varyings=this.getVaryings(e),s.vars=this.getVars(e),s.structs=this.getStructs(e),s.codes=this.getCodes(e),s.transforms=this.getTransforms(e),s.flow=n}null!==this.material?(this.vertexShader=this._getGLSLVertexCode(t.vertex),this.fragmentShader=this._getGLSLFragmentCode(t.fragment)):this.computeShader=this._getGLSLVertexCode(t.compute)}getUniformFromNode(t,e,n,r=null){const i=super.getUniformFromNode(t,e,n,r),s=this.getDataFromNode(t,n,this.globalCache);let o=s.uniformGPU;if(void 0===o){const r=t.groupNode,a=r.name,l=this.getBindGroupArray(a,n);if("texture"===e)o=new YR(i.name,i.node,r),l.push(o);else if("cubeTexture"===e)o=new KR(i.name,i.node,r),l.push(o);else if("texture3D"===e)o=new JR(i.name,i.node,r),l.push(o);else if("buffer"===e){t.name=`NodeBuffer_${t.id}`,i.name=`buffer${t.id}`;const e=new HR(t,r);e.name=t.name,l.push(e),o=e}else{const t=this.uniformGroups[n]||(this.uniformGroups[n]={});let s=t[a];void 0===s&&(s=new XR(n+"_"+a,r),t[a]=s,l.push(s)),o=this.getNodeUniform(i,e),s.addUniform(o)}s.uniformGPU=o}return i}}let iN=null,sN=null,oN=null;class aN{constructor(t={}){this.parameters=Object.assign({},t),this.data=new WeakMap,this.renderer=null,this.domElement=null}async init(t){this.renderer=t}begin(){}finish(){}draw(){}createProgram(){}destroyProgram(){}createBindings(){}updateBindings(){}createRenderPipeline(){}createComputePipeline(){}destroyPipeline(){}needsRenderUpdate(){}getRenderCacheKey(){}createNodeBuilder(){}createSampler(){}createDefaultTexture(){}createTexture(){}copyTextureToBuffer(){}createAttribute(){}createIndexAttribute(){}updateAttribute(){}destroyAttribute(){}getContext(){}updateSize(){}resolveTimestampAsync(){}hasFeatureAsync(){}hasFeature(){}getInstanceCount(t){const{object:e,geometry:n}=t;return n.isInstancedBufferGeometry?n.instanceCount:e.count>1?e.count:1}getDrawingBufferSize(){return iN=iN||new oh,this.renderer.getDrawingBufferSize(iN)}getScissor(){return sN=sN||new Th,this.renderer.getScissor(sN)}setScissorTest(){}getClearColor(){const t=this.renderer;return oN=oN||new LE,t.getClearColor(oN),oN.getRGB(oN,this.renderer.currentColorSpace),oN}getDomElement(){let t=this.domElement;return null===t&&(t=void 0!==this.parameters.canvas?this.parameters.canvas:function(){const t=uh("canvas");return t.style.display="block",t}(),"setAttribute"in t&&t.setAttribute("data-engine",`three.js r${Cu} webgpu`),this.domElement=t),t}set(t,e){this.data.set(t,e)}get(t){let e=this.data.get(t);return void 0===e&&(e={},this.data.set(t,e)),e}has(t){return this.data.has(t)}delete(t){this.data.delete(t)}dispose(){}}let lN=0;class uN{constructor(t,e){this.buffers=[t.bufferGPU,e],this.type=t.type,this.bufferType=t.bufferType,this.pbo=t.pbo,this.byteLength=t.byteLength,this.bytesPerElement=t.BYTES_PER_ELEMENT,this.version=t.version,this.isInteger=t.isInteger,this.activeBufferIndex=0,this.baseId=t.id}get id(){return`${this.baseId}|${this.activeBufferIndex}`}get bufferGPU(){return this.buffers[this.activeBufferIndex]}get transformBuffer(){return this.buffers[1^this.activeBufferIndex]}switchBuffers(){this.activeBufferIndex^=1}}class cN{constructor(t){this.backend=t}createAttribute(t,e){const n=this.backend,{gl:r}=n,i=t.array,s=t.usage||r.STATIC_DRAW,o=t.isInterleavedBufferAttribute?t.data:t,a=n.get(o);let l,u=a.bufferGPU;if(void 0===u&&(u=this._createBuffer(r,e,i,s),a.bufferGPU=u,a.bufferType=e,a.version=o.version),i instanceof Float32Array)l=r.FLOAT;else if(i instanceof Uint16Array)l=t.isFloat16BufferAttribute?r.HALF_FLOAT:r.UNSIGNED_SHORT;else if(i instanceof Int16Array)l=r.SHORT;else if(i instanceof Uint32Array)l=r.UNSIGNED_INT;else if(i instanceof Int32Array)l=r.INT;else if(i instanceof Int8Array)l=r.BYTE;else if(i instanceof Uint8Array)l=r.UNSIGNED_BYTE;else{if(!(i instanceof Uint8ClampedArray))throw new Error("THREE.WebGLBackend: Unsupported buffer data format: "+i);l=r.UNSIGNED_BYTE}let c={bufferGPU:u,bufferType:e,type:l,byteLength:i.byteLength,bytesPerElement:i.BYTES_PER_ELEMENT,version:t.version,pbo:t.pbo,isInteger:l===r.INT||l===r.UNSIGNED_INT||t.gpuType===Ku,id:lN++};if(t.isStorageBufferAttribute||t.isStorageInstancedBufferAttribute){const t=this._createBuffer(r,e,i,s);c=new uN(c,t)}n.set(t,c)}updateAttribute(t){const e=this.backend,{gl:n}=e,r=t.array,i=t.isInterleavedBufferAttribute?t.data:t,s=e.get(i),o=s.bufferType,a=t.isInterleavedBufferAttribute?t.data.updateRanges:t.updateRanges;if(n.bindBuffer(o,s.bufferGPU),0===a.length)n.bufferSubData(o,0,r);else{for(let t=0,e=a.length;t<e;t++){const e=a[t];n.bufferSubData(o,e.start*r.BYTES_PER_ELEMENT,r,e.start,e.count)}i.clearUpdateRanges()}n.bindBuffer(o,null),s.version=i.version}destroyAttribute(t){const e=this.backend,{gl:n}=e;t.isInterleavedBufferAttribute&&e.delete(t.data);const r=e.get(t);n.deleteBuffer(r.bufferGPU),e.delete(t)}async getArrayBufferAsync(t){const e=this.backend,{gl:n}=e,r=t.isInterleavedBufferAttribute?t.data:t,{bufferGPU:i}=e.get(r),s=t.array,o=s.byteLength;n.bindBuffer(n.COPY_READ_BUFFER,i);const a=n.createBuffer();n.bindBuffer(n.COPY_WRITE_BUFFER,a),n.bufferData(n.COPY_WRITE_BUFFER,o,n.STREAM_READ),n.copyBufferSubData(n.COPY_READ_BUFFER,n.COPY_WRITE_BUFFER,0,0,o),await e.utils._clientWaitAsync();const l=new t.array.constructor(s.length);return n.bindBuffer(n.COPY_WRITE_BUFFER,a),n.getBufferSubData(n.COPY_WRITE_BUFFER,0,l),n.deleteBuffer(a),n.bindBuffer(n.COPY_READ_BUFFER,null),n.bindBuffer(n.COPY_WRITE_BUFFER,null),l.buffer}_createBuffer(t,e,n,r){const i=t.createBuffer();return t.bindBuffer(e,i),t.bufferData(e,n,r),t.bindBuffer(e,null),i}}let hN,dN,pN=!1;class fN{constructor(t){this.backend=t,this.gl=this.backend.gl,this.enabled={},this.currentFlipSided=null,this.currentCullFace=null,this.currentProgram=null,this.currentBlendingEnabled=!1,this.currentBlending=null,this.currentBlendSrc=null,this.currentBlendDst=null,this.currentBlendSrcAlpha=null,this.currentBlendDstAlpha=null,this.currentPremultipledAlpha=null,this.currentPolygonOffsetFactor=null,this.currentPolygonOffsetUnits=null,this.currentColorMask=null,this.currentDepthFunc=null,this.currentDepthMask=null,this.currentStencilFunc=null,this.currentStencilRef=null,this.currentStencilFuncMask=null,this.currentStencilFail=null,this.currentStencilZFail=null,this.currentStencilZPass=null,this.currentStencilMask=null,this.currentLineWidth=null,this.currentBoundFramebuffers={},this.currentDrawbuffers=new WeakMap,this.maxTextures=this.gl.getParameter(this.gl.MAX_TEXTURE_IMAGE_UNITS),this.currentTextureSlot=null,this.currentBoundTextures={},this.currentBoundBufferBases={},!1===pN&&(this._init(this.gl),pN=!0)}_init(t){hN={[Ru]:t.FUNC_ADD,101:t.FUNC_SUBTRACT,102:t.FUNC_REVERSE_SUBTRACT},dN={200:t.ZERO,201:t.ONE,202:t.SRC_COLOR,[Nu]:t.SRC_ALPHA,210:t.SRC_ALPHA_SATURATE,208:t.DST_COLOR,206:t.DST_ALPHA,203:t.ONE_MINUS_SRC_COLOR,[Pu]:t.ONE_MINUS_SRC_ALPHA,209:t.ONE_MINUS_DST_COLOR,207:t.ONE_MINUS_DST_ALPHA}}enable(t){const{enabled:e}=this;!0!==e[t]&&(this.gl.enable(t),e[t]=!0)}disable(t){const{enabled:e}=this;!1!==e[t]&&(this.gl.disable(t),e[t]=!1)}setFlipSided(t){if(this.currentFlipSided!==t){const{gl:e}=this;t?e.frontFace(e.CW):e.frontFace(e.CCW),this.currentFlipSided=t}}setCullFace(t){const{gl:e}=this;0!==t?(this.enable(e.CULL_FACE),t!==this.currentCullFace&&(1===t?e.cullFace(e.BACK):2===t?e.cullFace(e.FRONT):e.cullFace(e.FRONT_AND_BACK))):this.disable(e.CULL_FACE),this.currentCullFace=t}setLineWidth(t){const{currentLineWidth:e,gl:n}=this;t!==e&&(n.lineWidth(t),this.currentLineWidth=t)}setBlending(t,e,n,r,i,s,o,a){const{gl:l}=this;if(0!==t){if(!1===this.currentBlendingEnabled&&(this.enable(l.BLEND),this.currentBlendingEnabled=!0),5===t)i=i||e,s=s||n,o=o||r,e===this.currentBlendEquation&&i===this.currentBlendEquationAlpha||(l.blendEquationSeparate(hN[e],hN[i]),this.currentBlendEquation=e,this.currentBlendEquationAlpha=i),n===this.currentBlendSrc&&r===this.currentBlendDst&&s===this.currentBlendSrcAlpha&&o===this.currentBlendDstAlpha||(l.blendFuncSeparate(dN[n],dN[r],dN[s],dN[o]),this.currentBlendSrc=n,this.currentBlendDst=r,this.currentBlendSrcAlpha=s,this.currentBlendDstAlpha=o),this.currentBlending=t,this.currentPremultipledAlpha=!1;else if(t!==this.currentBlending||a!==this.currentPremultipledAlpha){if(this.currentBlendEquation===Ru&&this.currentBlendEquationAlpha===Ru||(l.blendEquation(l.FUNC_ADD),this.currentBlendEquation=Ru,this.currentBlendEquationAlpha=Ru),a)switch(t){case 1:l.blendFuncSeparate(l.ONE,l.ONE_MINUS_SRC_ALPHA,l.ONE,l.ONE_MINUS_SRC_ALPHA);break;case 2:l.blendFunc(l.ONE,l.ONE);break;case 3:l.blendFuncSeparate(l.ZERO,l.ONE_MINUS_SRC_COLOR,l.ZERO,l.ONE);break;case 4:l.blendFuncSeparate(l.ZERO,l.SRC_COLOR,l.ZERO,l.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}else switch(t){case 1:l.blendFuncSeparate(l.SRC_ALPHA,l.ONE_MINUS_SRC_ALPHA,l.ONE,l.ONE_MINUS_SRC_ALPHA);break;case 2:l.blendFunc(l.SRC_ALPHA,l.ONE);break;case 3:l.blendFuncSeparate(l.ZERO,l.ONE_MINUS_SRC_COLOR,l.ZERO,l.ONE);break;case 4:l.blendFunc(l.ZERO,l.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}this.currentBlendSrc=null,this.currentBlendDst=null,this.currentBlendSrcAlpha=null,this.currentBlendDstAlpha=null,this.currentBlending=t,this.currentPremultipledAlpha=a}}else!0===this.currentBlendingEnabled&&(this.disable(l.BLEND),this.currentBlendingEnabled=!1)}setColorMask(t){this.currentColorMask!==t&&(this.gl.colorMask(t,t,t,t),this.currentColorMask=t)}setDepthTest(t){const{gl:e}=this;t?this.enable(e.DEPTH_TEST):this.disable(e.DEPTH_TEST)}setDepthMask(t){this.currentDepthMask!==t&&(this.gl.depthMask(t),this.currentDepthMask=t)}setDepthFunc(t){if(this.currentDepthFunc!==t){const{gl:e}=this;switch(t){case 0:e.depthFunc(e.NEVER);break;case 1:e.depthFunc(e.ALWAYS);break;case 2:e.depthFunc(e.LESS);break;case 3:default:e.depthFunc(e.LEQUAL);break;case 4:e.depthFunc(e.EQUAL);break;case 5:e.depthFunc(e.GEQUAL);break;case 6:e.depthFunc(e.GREATER);break;case 7:e.depthFunc(e.NOTEQUAL)}this.currentDepthFunc=t}}setStencilTest(t){const{gl:e}=this;t?this.enable(e.STENCIL_TEST):this.disable(e.STENCIL_TEST)}setStencilMask(t){this.currentStencilMask!==t&&(this.gl.stencilMask(t),this.currentStencilMask=t)}setStencilFunc(t,e,n){this.currentStencilFunc===t&&this.currentStencilRef===e&&this.currentStencilFuncMask===n||(this.gl.stencilFunc(t,e,n),this.currentStencilFunc=t,this.currentStencilRef=e,this.currentStencilFuncMask=n)}setStencilOp(t,e,n){this.currentStencilFail===t&&this.currentStencilZFail===e&&this.currentStencilZPass===n||(this.gl.stencilOp(t,e,n),this.currentStencilFail=t,this.currentStencilZFail=e,this.currentStencilZPass=n)}setMaterial(t,e){const{gl:n}=this;2===t.side?this.disable(n.CULL_FACE):this.enable(n.CULL_FACE);let r=1===t.side;e&&(r=!r),this.setFlipSided(r),1===t.blending&&!1===t.transparent?this.setBlending(0):this.setBlending(t.blending,t.blendEquation,t.blendSrc,t.blendDst,t.blendEquationAlpha,t.blendSrcAlpha,t.blendDstAlpha,t.premultipliedAlpha),this.setDepthFunc(t.depthFunc),this.setDepthTest(t.depthTest),this.setDepthMask(t.depthWrite),this.setColorMask(t.colorWrite);const i=t.stencilWrite;this.setStencilTest(i),i&&(this.setStencilMask(t.stencilWriteMask),this.setStencilFunc(t.stencilFunc,t.stencilRef,t.stencilFuncMask),this.setStencilOp(t.stencilFail,t.stencilZFail,t.stencilZPass)),this.setPolygonOffset(t.polygonOffset,t.polygonOffsetFactor,t.polygonOffsetUnits),!0===t.alphaToCoverage&&this.backend.renderer.samples>1?this.enable(n.SAMPLE_ALPHA_TO_COVERAGE):this.disable(n.SAMPLE_ALPHA_TO_COVERAGE)}setPolygonOffset(t,e,n){const{gl:r}=this;t?(this.enable(r.POLYGON_OFFSET_FILL),this.currentPolygonOffsetFactor===e&&this.currentPolygonOffsetUnits===n||(r.polygonOffset(e,n),this.currentPolygonOffsetFactor=e,this.currentPolygonOffsetUnits=n)):this.disable(r.POLYGON_OFFSET_FILL)}useProgram(t){return this.currentProgram!==t&&(this.gl.useProgram(t),this.currentProgram=t,!0)}bindFramebuffer(t,e){const{gl:n,currentBoundFramebuffers:r}=this;return r[t]!==e&&(n.bindFramebuffer(t,e),r[t]=e,t===n.DRAW_FRAMEBUFFER&&(r[n.FRAMEBUFFER]=e),t===n.FRAMEBUFFER&&(r[n.DRAW_FRAMEBUFFER]=e),!0)}drawBuffers(t,e){const{gl:n}=this;let r=[],i=!1;if(null!==t.textures){r=this.currentDrawbuffers.get(e),void 0===r&&(r=[],this.currentDrawbuffers.set(e,r));const s=t.textures;if(r.length!==s.length||r[0]!==n.COLOR_ATTACHMENT0){for(let t=0,e=s.length;t<e;t++)r[t]=n.COLOR_ATTACHMENT0+t;r.length=s.length,i=!0}}else r[0]!==n.BACK&&(r[0]=n.BACK,i=!0);i&&n.drawBuffers(r)}activeTexture(t){const{gl:e,currentTextureSlot:n,maxTextures:r}=this;void 0===t&&(t=e.TEXTURE0+r-1),n!==t&&(e.activeTexture(t),this.currentTextureSlot=t)}bindTexture(t,e,n){const{gl:r,currentTextureSlot:i,currentBoundTextures:s,maxTextures:o}=this;void 0===n&&(n=null===i?r.TEXTURE0+o-1:i);let a=s[n];void 0===a&&(a={type:void 0,texture:void 0},s[n]=a),a.type===t&&a.texture===e||(i!==n&&(r.activeTexture(n),this.currentTextureSlot=n),r.bindTexture(t,e),a.type=t,a.texture=e)}bindBufferBase(t,e,n){const{gl:r}=this,i=`${t}-${e}`;return this.currentBoundBufferBases[i]!==n&&(r.bindBufferBase(t,e,n),this.currentBoundBufferBases[i]=n,!0)}unbindTexture(){const{gl:t,currentTextureSlot:e,currentBoundTextures:n}=this,r=n[e];void 0!==r&&void 0!==r.type&&(t.bindTexture(r.type,null),r.type=void 0,r.texture=void 0)}}class mN{constructor(t){this.backend=t,this.gl=this.backend.gl,this.extensions=t.extensions}convert(t,e=""){const{gl:n,extensions:r}=this;let i;if(t===Xu)return n.UNSIGNED_BYTE;if(1017===t)return n.UNSIGNED_SHORT_4_4_4_4;if(1018===t)return n.UNSIGNED_SHORT_5_5_5_1;if(35902===t)return n.UNSIGNED_INT_5_9_9_9_REV;if(t===Zu)return n.BYTE;if(t===$u)return n.SHORT;if(t===Yu)return n.UNSIGNED_SHORT;if(t===Ku)return n.INT;if(t===Ju)return n.UNSIGNED_INT;if(t===Qu)return n.FLOAT;if(t===tc)return n.HALF_FLOAT;if(1021===t)return n.ALPHA;if(t===nc)return n.RGB;if(t===rc)return n.RGBA;if(1024===t)return n.LUMINANCE;if(1025===t)return n.LUMINANCE_ALPHA;if(t===ic)return n.DEPTH_COMPONENT;if(t===sc)return n.DEPTH_STENCIL;if(t===oc)return n.RED;if(t===ac)return n.RED_INTEGER;if(t===lc)return n.RG;if(t===uc)return n.RG_INTEGER;if(t===cc)return n.RGBA_INTEGER;if(t===hc||t===dc||t===pc||t===fc)if(e===Fc){if(i=r.get("WEBGL_compressed_texture_s3tc_srgb"),null===i)return null;if(t===hc)return i.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(t===dc)return i.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(t===pc)return i.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(t===fc)return i.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else{if(i=r.get("WEBGL_compressed_texture_s3tc"),null===i)return null;if(t===hc)return i.COMPRESSED_RGB_S3TC_DXT1_EXT;if(t===dc)return i.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(t===pc)return i.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(t===fc)return i.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(35840===t||35841===t||35842===t||35843===t){if(i=r.get("WEBGL_compressed_texture_pvrtc"),null===i)return null;if(35840===t)return i.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(35841===t)return i.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(35842===t)return i.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(35843===t)return i.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(36196===t||t===mc||t===gc){if(i=r.get("WEBGL_compressed_texture_etc"),null===i)return null;if(36196===t||t===mc)return e===Fc?i.COMPRESSED_SRGB8_ETC2:i.COMPRESSED_RGB8_ETC2;if(t===gc)return e===Fc?i.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:i.COMPRESSED_RGBA8_ETC2_EAC}if(t===vc||t===yc||t===_c||t===xc||t===bc||t===wc||t===Sc||t===Mc||t===Ec||t===Tc||t===Ac||t===Cc||t===Rc||t===Nc){if(i=r.get("WEBGL_compressed_texture_astc"),null===i)return null;if(t===vc)return e===Fc?i.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:i.COMPRESSED_RGBA_ASTC_4x4_KHR;if(t===yc)return e===Fc?i.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:i.COMPRESSED_RGBA_ASTC_5x4_KHR;if(t===_c)return e===Fc?i.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:i.COMPRESSED_RGBA_ASTC_5x5_KHR;if(t===xc)return e===Fc?i.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:i.COMPRESSED_RGBA_ASTC_6x5_KHR;if(t===bc)return e===Fc?i.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:i.COMPRESSED_RGBA_ASTC_6x6_KHR;if(t===wc)return e===Fc?i.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:i.COMPRESSED_RGBA_ASTC_8x5_KHR;if(t===Sc)return e===Fc?i.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:i.COMPRESSED_RGBA_ASTC_8x6_KHR;if(t===Mc)return e===Fc?i.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:i.COMPRESSED_RGBA_ASTC_8x8_KHR;if(t===Ec)return e===Fc?i.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:i.COMPRESSED_RGBA_ASTC_10x5_KHR;if(t===Tc)return e===Fc?i.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:i.COMPRESSED_RGBA_ASTC_10x6_KHR;if(t===Ac)return e===Fc?i.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:i.COMPRESSED_RGBA_ASTC_10x8_KHR;if(t===Cc)return e===Fc?i.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:i.COMPRESSED_RGBA_ASTC_10x10_KHR;if(t===Rc)return e===Fc?i.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:i.COMPRESSED_RGBA_ASTC_12x10_KHR;if(t===Nc)return e===Fc?i.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:i.COMPRESSED_RGBA_ASTC_12x12_KHR}if(t===Pc){if(i=r.get("EXT_texture_compression_bptc"),null===i)return null;if(t===Pc)return e===Fc?i.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:i.COMPRESSED_RGBA_BPTC_UNORM_EXT}if(36283===t||36284===t||36285===t||36286===t){if(i=r.get("EXT_texture_compression_rgtc"),null===i)return null;if(t===Pc)return i.COMPRESSED_RED_RGTC1_EXT;if(36284===t)return i.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(36285===t)return i.COMPRESSED_RED_GREEN_RGTC2_EXT;if(36286===t)return i.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}return t===ec?n.UNSIGNED_INT_24_8:void 0!==n[t]?n[t]:null}_clientWaitAsync(){const{gl:t}=this,e=t.fenceSync(t.SYNC_GPU_COMMANDS_COMPLETE,0);return t.flush(),new Promise(((n,r)=>{!function i(){const s=t.clientWaitSync(e,t.SYNC_FLUSH_COMMANDS_BIT,0);if(s===t.WAIT_FAILED)return t.deleteSync(e),void r();s!==t.TIMEOUT_EXPIRED?(t.deleteSync(e),n()):requestAnimationFrame(i)}()}))}}let gN,vN,yN,_N=!1;class xN{constructor(t){this.backend=t,this.gl=t.gl,this.extensions=t.extensions,this.defaultTextures={},!1===_N&&(this._init(this.gl),_N=!0)}_init(t){gN={[Bu]:t.REPEAT,[Fu]:t.CLAMP_TO_EDGE,[zu]:t.MIRRORED_REPEAT},vN={[Vu]:t.NEAREST,[Gu]:t.NEAREST_MIPMAP_NEAREST,[ju]:t.NEAREST_MIPMAP_LINEAR,[Hu]:t.LINEAR,[Wu]:t.LINEAR_MIPMAP_NEAREST,[qu]:t.LINEAR_MIPMAP_LINEAR},yN={512:t.NEVER,519:t.ALWAYS,513:t.LESS,515:t.LEQUAL,514:t.EQUAL,518:t.GEQUAL,516:t.GREATER,517:t.NOTEQUAL}}filterFallback(t){const{gl:e}=this;return t===Vu||t===Gu||t===ju?e.NEAREST:e.LINEAR}getGLTextureType(t){const{gl:e}=this;let n;return n=!0===t.isCubeTexture?e.TEXTURE_CUBE_MAP:!0===t.isDataArrayTexture||!0===t.isCompressedArrayTexture?e.TEXTURE_2D_ARRAY:!0===t.isData3DTexture?e.TEXTURE_3D:e.TEXTURE_2D,n}getInternalFormat(t,e,n,r,i=!1){const{gl:s,extensions:o}=this;if(null!==t){if(void 0!==s[t])return s[t];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+t+"'")}let a=e;return e===s.RED&&(n===s.FLOAT&&(a=s.R32F),n===s.HALF_FLOAT&&(a=s.R16F),n===s.UNSIGNED_BYTE&&(a=s.R8),n===s.UNSIGNED_SHORT&&(a=s.R16),n===s.UNSIGNED_INT&&(a=s.R32UI),n===s.BYTE&&(a=s.R8I),n===s.SHORT&&(a=s.R16I),n===s.INT&&(a=s.R32I)),e===s.RED_INTEGER&&(n===s.UNSIGNED_BYTE&&(a=s.R8UI),n===s.UNSIGNED_SHORT&&(a=s.R16UI),n===s.UNSIGNED_INT&&(a=s.R32UI),n===s.BYTE&&(a=s.R8I),n===s.SHORT&&(a=s.R16I),n===s.INT&&(a=s.R32I)),e===s.RG&&(n===s.FLOAT&&(a=s.RG32F),n===s.HALF_FLOAT&&(a=s.RG16F),n===s.UNSIGNED_BYTE&&(a=s.RG8),n===s.UNSIGNED_SHORT&&(a=s.RG16),n===s.UNSIGNED_INT&&(a=s.RG32UI),n===s.BYTE&&(a=s.RG8I),n===s.SHORT&&(a=s.RG16I),n===s.INT&&(a=s.RG32I)),e===s.RG_INTEGER&&(n===s.UNSIGNED_BYTE&&(a=s.RG8UI),n===s.UNSIGNED_SHORT&&(a=s.RG16UI),n===s.UNSIGNED_INT&&(a=s.RG32UI),n===s.BYTE&&(a=s.RG8I),n===s.SHORT&&(a=s.RG16I),n===s.INT&&(a=s.RG32I)),e===s.RGB&&(n===s.FLOAT&&(a=s.RGB32F),n===s.HALF_FLOAT&&(a=s.RGB16F),n===s.UNSIGNED_BYTE&&(a=s.RGB8),n===s.UNSIGNED_SHORT&&(a=s.RGB16),n===s.UNSIGNED_INT&&(a=s.RGB32UI),n===s.BYTE&&(a=s.RGB8I),n===s.SHORT&&(a=s.RGB16I),n===s.INT&&(a=s.RGB32I),n===s.UNSIGNED_BYTE&&(a=r===Fc&&!1===i?s.SRGB8:s.RGB8),n===s.UNSIGNED_SHORT_5_6_5&&(a=s.RGB565),n===s.UNSIGNED_SHORT_5_5_5_1&&(a=s.RGB5_A1),n===s.UNSIGNED_SHORT_4_4_4_4&&(a=s.RGB4),n===s.UNSIGNED_INT_5_9_9_9_REV&&(a=s.RGB9_E5)),e===s.RGB_INTEGER&&(n===s.UNSIGNED_BYTE&&(a=s.RGB8UI),n===s.UNSIGNED_SHORT&&(a=s.RGB16UI),n===s.UNSIGNED_INT&&(a=s.RGB32UI),n===s.BYTE&&(a=s.RGB8I),n===s.SHORT&&(a=s.RGB16I),n===s.INT&&(a=s.RGB32I)),e===s.RGBA&&(n===s.FLOAT&&(a=s.RGBA32F),n===s.HALF_FLOAT&&(a=s.RGBA16F),n===s.UNSIGNED_BYTE&&(a=s.RGBA8),n===s.UNSIGNED_SHORT&&(a=s.RGBA16),n===s.UNSIGNED_INT&&(a=s.RGBA32UI),n===s.BYTE&&(a=s.RGBA8I),n===s.SHORT&&(a=s.RGBA16I),n===s.INT&&(a=s.RGBA32I),n===s.UNSIGNED_BYTE&&(a=r===Fc&&!1===i?s.SRGB8_ALPHA8:s.RGBA8),n===s.UNSIGNED_SHORT_4_4_4_4&&(a=s.RGBA4),n===s.UNSIGNED_SHORT_5_5_5_1&&(a=s.RGB5_A1)),e===s.RGBA_INTEGER&&(n===s.UNSIGNED_BYTE&&(a=s.RGBA8UI),n===s.UNSIGNED_SHORT&&(a=s.RGBA16UI),n===s.UNSIGNED_INT&&(a=s.RGBA32UI),n===s.BYTE&&(a=s.RGBA8I),n===s.SHORT&&(a=s.RGBA16I),n===s.INT&&(a=s.RGBA32I)),e===s.DEPTH_COMPONENT&&(n===s.UNSIGNED_INT&&(a=s.DEPTH24_STENCIL8),n===s.FLOAT&&(a=s.DEPTH_COMPONENT32F)),e===s.DEPTH_STENCIL&&n===s.UNSIGNED_INT_24_8&&(a=s.DEPTH24_STENCIL8),a!==s.R16F&&a!==s.R32F&&a!==s.RG16F&&a!==s.RG32F&&a!==s.RGBA16F&&a!==s.RGBA32F||o.get("EXT_color_buffer_float"),a}setTextureParameters(t,e){const{gl:n,extensions:r,backend:i}=this;n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,e.flipY),n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.premultiplyAlpha),n.pixelStorei(n.UNPACK_ALIGNMENT,e.unpackAlignment),n.pixelStorei(n.UNPACK_COLORSPACE_CONVERSION_WEBGL,n.NONE),n.texParameteri(t,n.TEXTURE_WRAP_S,gN[e.wrapS]),n.texParameteri(t,n.TEXTURE_WRAP_T,gN[e.wrapT]),t!==n.TEXTURE_3D&&t!==n.TEXTURE_2D_ARRAY||n.texParameteri(t,n.TEXTURE_WRAP_R,gN[e.wrapR]),n.texParameteri(t,n.TEXTURE_MAG_FILTER,vN[e.magFilter]);const s=void 0!==e.mipmaps&&e.mipmaps.length>0,o=e.minFilter===Hu&&s?qu:e.minFilter;if(n.texParameteri(t,n.TEXTURE_MIN_FILTER,vN[o]),e.compareFunction&&(n.texParameteri(t,n.TEXTURE_COMPARE_MODE,n.COMPARE_REF_TO_TEXTURE),n.texParameteri(t,n.TEXTURE_COMPARE_FUNC,yN[e.compareFunction])),!0===r.has("EXT_texture_filter_anisotropic")){if(e.magFilter===Vu)return;if(e.minFilter!==ju&&e.minFilter!==qu)return;if(e.type===Qu&&!1===r.has("OES_texture_float_linear"))return;if(e.anisotropy>1){const s=r.get("EXT_texture_filter_anisotropic");n.texParameterf(t,s.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(e.anisotropy,i.getMaxAnisotropy()))}}}createDefaultTexture(t){const{gl:e,backend:n,defaultTextures:r}=this,i=this.getGLTextureType(t);let s=r[i];void 0===s&&(s=e.createTexture(),n.state.bindTexture(i,s),e.texParameteri(i,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(i,e.TEXTURE_MAG_FILTER,e.NEAREST),r[i]=s),n.set(t,{textureGPU:s,glTextureType:i,isDefault:!0})}createTexture(t,e){const{gl:n,backend:r}=this,{levels:i,width:s,height:o,depth:a}=e,l=r.utils.convert(t.format,t.colorSpace),u=r.utils.convert(t.type),c=this.getInternalFormat(t.internalFormat,l,u,t.colorSpace,t.isVideoTexture),h=n.createTexture(),d=this.getGLTextureType(t);r.state.bindTexture(d,h),this.setTextureParameters(d,t),t.isDataArrayTexture||t.isCompressedArrayTexture?n.texStorage3D(n.TEXTURE_2D_ARRAY,i,c,s,o,a):t.isData3DTexture?n.texStorage3D(n.TEXTURE_3D,i,c,s,o,a):t.isVideoTexture||n.texStorage2D(d,i,c,s,o),r.set(t,{textureGPU:h,glTextureType:d,glFormat:l,glType:u,glInternalFormat:c})}copyBufferToTexture(t,e){const{gl:n,backend:r}=this,{textureGPU:i,glTextureType:s,glFormat:o,glType:a}=r.get(e),{width:l,height:u}=e.source.data;n.bindBuffer(n.PIXEL_UNPACK_BUFFER,t),r.state.bindTexture(s,i),n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,!1),n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),n.texSubImage2D(s,0,0,0,l,u,o,a,0),n.bindBuffer(n.PIXEL_UNPACK_BUFFER,null),r.state.unbindTexture()}updateTexture(t,e){const{gl:n}=this,{width:r,height:i}=e,{textureGPU:s,glTextureType:o,glFormat:a,glType:l,glInternalFormat:u}=this.backend.get(t);if(t.isRenderTargetTexture||void 0===s)return;const c=t=>t.isDataTexture?t.image.data:t instanceof ImageBitmap||t instanceof OffscreenCanvas||t instanceof HTMLImageElement||t instanceof HTMLCanvasElement?t:t.data;if(this.backend.state.bindTexture(o,s),this.setTextureParameters(o,t),t.isCompressedTexture){const r=t.mipmaps,i=e.image;for(let e=0;e<r.length;e++){const s=r[e];t.isCompressedArrayTexture?t.format!==n.RGBA?null!==a?n.compressedTexSubImage3D(n.TEXTURE_2D_ARRAY,e,0,0,0,s.width,s.height,i.depth,a,s.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):n.texSubImage3D(n.TEXTURE_2D_ARRAY,e,0,0,0,s.width,s.height,i.depth,a,l,s.data):null!==a?n.compressedTexSubImage2D(n.TEXTURE_2D,e,0,0,s.width,s.height,a,s.data):console.warn("Unsupported compressed texture format")}}else if(t.isCubeTexture){const t=e.images;for(let e=0;e<6;e++){const s=c(t[e]);n.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+e,0,0,0,r,i,a,l,s)}}else if(t.isDataArrayTexture){const t=e.image;n.texSubImage3D(n.TEXTURE_2D_ARRAY,0,0,0,0,t.width,t.height,t.depth,a,l,t.data)}else if(t.isData3DTexture){const t=e.image;n.texSubImage3D(n.TEXTURE_3D,0,0,0,0,t.width,t.height,t.depth,a,l,t.data)}else if(t.isVideoTexture)t.update(),n.texImage2D(o,0,u,a,l,e.image);else{const t=c(e.image);n.texSubImage2D(o,0,0,0,r,i,a,l,t)}}generateMipmaps(t){const{gl:e,backend:n}=this,{textureGPU:r,glTextureType:i}=n.get(t);n.state.bindTexture(i,r),e.generateMipmap(i)}deallocateRenderBuffers(t){const{gl:e,backend:n}=this;if(t){const r=n.get(t);if(r.renderBufferStorageSetup=void 0,r.framebuffers){for(const t in r.framebuffers)e.deleteFramebuffer(r.framebuffers[t]);delete r.framebuffers}if(r.depthRenderbuffer&&(e.deleteRenderbuffer(r.depthRenderbuffer),delete r.depthRenderbuffer),r.stencilRenderbuffer&&(e.deleteRenderbuffer(r.stencilRenderbuffer),delete r.stencilRenderbuffer),r.msaaFrameBuffer&&(e.deleteFramebuffer(r.msaaFrameBuffer),delete r.msaaFrameBuffer),r.msaaRenderbuffers){for(let t=0;t<r.msaaRenderbuffers.length;t++)e.deleteRenderbuffer(r.msaaRenderbuffers[t]);delete r.msaaRenderbuffers}}}destroyTexture(t){const{gl:e,backend:n}=this,{textureGPU:r,renderTarget:i}=n.get(t);this.deallocateRenderBuffers(i),e.deleteTexture(r),n.delete(t)}copyTextureToTexture(t,e,n=null,r=null,i=0){const{gl:s,backend:o}=this,{state:a}=this.backend,{textureGPU:l,glTextureType:u,glType:c,glFormat:h}=o.get(e);let d,p,f,m,g,v;null!==n?(d=n.max.x-n.min.x,p=n.max.y-n.min.y,f=n.min.x,m=n.min.y):(d=t.image.width,p=t.image.height,f=0,m=0),null!==r?(g=r.x,v=r.y):(g=0,v=0),a.bindTexture(u,l),s.pixelStorei(s.UNPACK_ALIGNMENT,e.unpackAlignment),s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,e.flipY),s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.premultiplyAlpha),s.pixelStorei(s.UNPACK_ALIGNMENT,e.unpackAlignment);const y=s.getParameter(s.UNPACK_ROW_LENGTH),_=s.getParameter(s.UNPACK_IMAGE_HEIGHT),x=s.getParameter(s.UNPACK_SKIP_PIXELS),b=s.getParameter(s.UNPACK_SKIP_ROWS),w=s.getParameter(s.UNPACK_SKIP_IMAGES),S=t.isCompressedTexture?t.mipmaps[i]:t.image;if(s.pixelStorei(s.UNPACK_ROW_LENGTH,S.width),s.pixelStorei(s.UNPACK_IMAGE_HEIGHT,S.height),s.pixelStorei(s.UNPACK_SKIP_PIXELS,f),s.pixelStorei(s.UNPACK_SKIP_ROWS,m),t.isRenderTargetTexture||t.isDepthTexture){const n=o.get(t),r=o.get(e),i=o.get(n.renderTarget),l=o.get(r.renderTarget),u=i.framebuffers[n.cacheKey],c=l.framebuffers[r.cacheKey];a.bindFramebuffer(s.READ_FRAMEBUFFER,u),a.bindFramebuffer(s.DRAW_FRAMEBUFFER,c);let h=s.COLOR_BUFFER_BIT;t.isDepthTexture&&(h=s.DEPTH_BUFFER_BIT),s.blitFramebuffer(f,m,d,p,g,v,d,p,h,s.NEAREST),a.bindFramebuffer(s.READ_FRAMEBUFFER,null),a.bindFramebuffer(s.DRAW_FRAMEBUFFER,null)}else t.isDataTexture?s.texSubImage2D(s.TEXTURE_2D,i,g,v,d,p,h,c,S.data):t.isCompressedTexture?s.compressedTexSubImage2D(s.TEXTURE_2D,i,g,v,S.width,S.height,h,S.data):s.texSubImage2D(s.TEXTURE_2D,i,g,v,d,p,h,c,S);s.pixelStorei(s.UNPACK_ROW_LENGTH,y),s.pixelStorei(s.UNPACK_IMAGE_HEIGHT,_),s.pixelStorei(s.UNPACK_SKIP_PIXELS,x),s.pixelStorei(s.UNPACK_SKIP_ROWS,b),s.pixelStorei(s.UNPACK_SKIP_IMAGES,w),0===i&&e.generateMipmaps&&s.generateMipmap(s.TEXTURE_2D),a.unbindTexture()}copyFramebufferToTexture(t,e,n){const{gl:r}=this,{state:i}=this.backend,{textureGPU:s}=this.backend.get(t),{x:o,y:a,z:l,w:u}=n,c=!0===t.isDepthTexture||e.renderTarget&&e.renderTarget.samples>0,h=e.renderTarget?e.renderTarget.height:this.backend.gerDrawingBufferSize().y;if(c){const n=0!==o||0!==a;let c,d;if(!0===t.isDepthTexture?(c=r.DEPTH_BUFFER_BIT,d=r.DEPTH_ATTACHMENT,e.stencil&&(c|=r.STENCIL_BUFFER_BIT)):(c=r.COLOR_BUFFER_BIT,d=r.COLOR_ATTACHMENT0),n){const t=this.backend.get(e.renderTarget),n=t.framebuffers[e.getCacheKey()],d=t.msaaFrameBuffer;i.bindFramebuffer(r.DRAW_FRAMEBUFFER,n),i.bindFramebuffer(r.READ_FRAMEBUFFER,d);const p=h-a-u;r.blitFramebuffer(o,p,o+l,p+u,o,p,o+l,p+u,c,r.NEAREST),i.bindFramebuffer(r.READ_FRAMEBUFFER,n),i.bindTexture(r.TEXTURE_2D,s),r.copyTexSubImage2D(r.TEXTURE_2D,0,0,0,o,p,l,u),i.unbindTexture()}else{const t=r.createFramebuffer();i.bindFramebuffer(r.DRAW_FRAMEBUFFER,t),r.framebufferTexture2D(r.DRAW_FRAMEBUFFER,d,r.TEXTURE_2D,s,0),r.blitFramebuffer(0,0,l,u,0,0,l,u,c,r.NEAREST),r.deleteFramebuffer(t)}}else i.bindTexture(r.TEXTURE_2D,s),r.copyTexSubImage2D(r.TEXTURE_2D,0,0,0,o,h-u-a,l,u),i.unbindTexture();t.generateMipmaps&&this.generateMipmaps(t),this.backend._setFramebuffer(e)}setupRenderBufferStorage(t,e){const{gl:n}=this,r=e.renderTarget,{samples:i,depthTexture:s,depthBuffer:o,stencilBuffer:a,width:l,height:u}=r;if(n.bindRenderbuffer(n.RENDERBUFFER,t),o&&!a){let e=n.DEPTH_COMPONENT24;i>0?(s&&s.isDepthTexture&&s.type===n.FLOAT&&(e=n.DEPTH_COMPONENT32F),n.renderbufferStorageMultisample(n.RENDERBUFFER,i,e,l,u)):n.renderbufferStorage(n.RENDERBUFFER,e,l,u),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.RENDERBUFFER,t)}else o&&a&&(i>0?n.renderbufferStorageMultisample(n.RENDERBUFFER,i,n.DEPTH24_STENCIL8,l,u):n.renderbufferStorage(n.RENDERBUFFER,n.DEPTH_STENCIL,l,u),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.DEPTH_STENCIL_ATTACHMENT,n.RENDERBUFFER,t))}async copyTextureToBuffer(t,e,n,r,i,s){const{backend:o,gl:a}=this,{textureGPU:l,glFormat:u,glType:c}=this.backend.get(t),h=a.createFramebuffer();a.bindFramebuffer(a.READ_FRAMEBUFFER,h);const d=t.isCubeTexture?a.TEXTURE_CUBE_MAP_POSITIVE_X+s:a.TEXTURE_2D;a.framebufferTexture2D(a.READ_FRAMEBUFFER,a.COLOR_ATTACHMENT0,d,l,0);const p=this._getTypedArrayType(c),f=r*i*this._getBytesPerTexel(c,u),m=a.createBuffer();a.bindBuffer(a.PIXEL_PACK_BUFFER,m),a.bufferData(a.PIXEL_PACK_BUFFER,f,a.STREAM_READ),a.readPixels(e,n,r,i,u,c,0),a.bindBuffer(a.PIXEL_PACK_BUFFER,null),await o.utils._clientWaitAsync();const g=new p(f/p.BYTES_PER_ELEMENT);return a.bindBuffer(a.PIXEL_PACK_BUFFER,m),a.getBufferSubData(a.PIXEL_PACK_BUFFER,0,g),a.bindBuffer(a.PIXEL_PACK_BUFFER,null),a.deleteFramebuffer(h),g}_getTypedArrayType(t){const{gl:e}=this;if(t===e.UNSIGNED_BYTE)return Uint8Array;if(t===e.UNSIGNED_SHORT_4_4_4_4)return Uint16Array;if(t===e.UNSIGNED_SHORT_5_5_5_1)return Uint16Array;if(t===e.UNSIGNED_SHORT_5_6_5)return Uint16Array;if(t===e.UNSIGNED_SHORT)return Uint16Array;if(t===e.UNSIGNED_INT)return Uint32Array;if(t===e.HALF_FLOAT)return Uint16Array;if(t===e.FLOAT)return Float32Array;throw new Error(`Unsupported WebGL type: ${t}`)}_getBytesPerTexel(t,e){const{gl:n}=this;let r=0;return t===n.UNSIGNED_BYTE&&(r=1),t!==n.UNSIGNED_SHORT_4_4_4_4&&t!==n.UNSIGNED_SHORT_5_5_5_1&&t!==n.UNSIGNED_SHORT_5_6_5&&t!==n.UNSIGNED_SHORT&&t!==n.HALF_FLOAT||(r=2),t!==n.UNSIGNED_INT&&t!==n.FLOAT||(r=4),e===n.RGBA?4*r:e===n.RGB?3*r:e===n.ALPHA?r:void 0}}class bN{constructor(t){this.backend=t,this.gl=this.backend.gl,this.availableExtensions=this.gl.getSupportedExtensions(),this.extensions={}}get(t){let e=this.extensions[t];return void 0===e&&(e=this.gl.getExtension(t),this.extensions[t]=e),e}has(t){return this.availableExtensions.includes(t)}}class wN{constructor(t){this.backend=t,this.maxAnisotropy=null}getMaxAnisotropy(){if(null!==this.maxAnisotropy)return this.maxAnisotropy;const t=this.backend.gl,e=this.backend.extensions;if(!0===e.has("EXT_texture_filter_anisotropic")){const n=e.get("EXT_texture_filter_anisotropic");this.maxAnisotropy=t.getParameter(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else this.maxAnisotropy=0;return this.maxAnisotropy}}const SN={WEBGL_multi_draw:"WEBGL_multi_draw",WEBGL_compressed_texture_astc:"texture-compression-astc",WEBGL_compressed_texture_etc:"texture-compression-etc2",WEBGL_compressed_texture_etc1:"texture-compression-etc1",WEBGL_compressed_texture_pvrtc:"texture-compression-pvrtc",WEBKIT_WEBGL_compressed_texture_pvrtc:"texture-compression-pvrtc",WEBGL_compressed_texture_s3tc:"texture-compression-bc",EXT_texture_compression_bptc:"texture-compression-bptc",EXT_disjoint_timer_query_webgl2:"timestamp-query"};class MN{constructor(t){this.gl=t.gl,this.extensions=t.extensions,this.info=t.renderer.info,this.mode=null,this.index=0,this.type=null,this.object=null}render(t,e){const{gl:n,mode:r,object:i,type:s,info:o,index:a}=this;0!==a?n.drawElements(r,e,s,t):n.drawArrays(r,t,e),o.update(i,e,r,1)}renderInstances(t,e,n){const{gl:r,mode:i,type:s,index:o,object:a,info:l}=this;0!==n&&(0!==o?r.drawElementsInstanced(i,e,s,t,n):r.drawArraysInstanced(i,t,e,n),l.update(a,e,i,n))}renderMultiDraw(t,e,n){const{extensions:r,mode:i,object:s,info:o}=this;if(0===n)return;const a=r.get("WEBGL_multi_draw");if(null===a)for(let r=0;r<n;r++)this.render(t[r],e[r]);else{0!==this.index?a.multiDrawElementsWEBGL(i,e,0,this.type,t,0,n):a.multiDrawArraysWEBGL(i,t,0,e,0,n);let r=0;for(let t=0;t<n;t++)r+=e[t];o.update(s,r,i,1)}}renderMultiDrawInstances(t,e,n,r){const{extensions:i,mode:s,object:o,info:a}=this;if(0===n)return;const l=i.get("WEBGL_multi_draw");if(null===l)for(let i=0;i<n;i++)this.renderInstances(t[i],e[i],r[i]);else{0!==this.index?l.multiDrawElementsInstancedWEBGL(s,e,0,this.type,t,0,r,0,n):l.multiDrawArraysInstancedWEBGL(s,t,0,e,0,r,0,n);let i=0;for(let t=0;t<n;t++)i+=e[t]*r[t];a.update(o,i,s,1)}}}class EN extends aN{constructor(t={}){super(t),this.isWebGLBackend=!0}init(t){super.init(t);const e=this.parameters,n=void 0!==e.context?e.context:t.domElement.getContext("webgl2");function r(e){e.preventDefault();const n={api:"WebGL",message:e.statusMessage||"Unknown reason",reason:null,originalEvent:e};t.onDeviceLost(n)}this._onContextLost=r,t.domElement.addEventListener("webglcontextlost",r,!1),this.gl=n,this.extensions=new bN(this),this.capabilities=new wN(this),this.attributeUtils=new cN(this),this.textureUtils=new xN(this),this.bufferRenderer=new MN(this),this.state=new fN(this),this.utils=new mN(this),this.vaoCache={},this.transformFeedbackCache={},this.discard=!1,this.trackTimestamp=!0===e.trackTimestamp,this.extensions.get("EXT_color_buffer_float"),this.extensions.get("WEBGL_clip_cull_distance"),this.extensions.get("OES_texture_float_linear"),this.extensions.get("EXT_color_buffer_half_float"),this.extensions.get("WEBGL_multisampled_render_to_texture"),this.extensions.get("WEBGL_render_shared_exponent"),this.extensions.get("WEBGL_multi_draw"),this.disjoint=this.extensions.get("EXT_disjoint_timer_query_webgl2"),this.parallel=this.extensions.get("KHR_parallel_shader_compile"),this._knownBindings=new WeakSet,this._currentContext=null}get coordinateSystem(){return qc}async getArrayBufferAsync(t){return await this.attributeUtils.getArrayBufferAsync(t)}async waitForGPU(){await this.utils._clientWaitAsync()}initTimestampQuery(t){if(!this.disjoint||!this.trackTimestamp)return;const e=this.get(t);if(this.queryRunning)return e.queryQueue||(e.queryQueue=[]),void e.queryQueue.push(t);e.activeQuery&&(this.gl.endQuery(this.disjoint.TIME_ELAPSED_EXT),e.activeQuery=null),e.activeQuery=this.gl.createQuery(),null!==e.activeQuery&&(this.gl.beginQuery(this.disjoint.TIME_ELAPSED_EXT,e.activeQuery),this.queryRunning=!0)}prepareTimestampBuffer(t){if(!this.disjoint||!this.trackTimestamp)return;const e=this.get(t);if(e.activeQuery&&(this.gl.endQuery(this.disjoint.TIME_ELAPSED_EXT),e.gpuQueries||(e.gpuQueries=[]),e.gpuQueries.push({query:e.activeQuery}),e.activeQuery=null,this.queryRunning=!1,e.queryQueue&&e.queryQueue.length>0)){const t=e.queryQueue.shift();this.initTimestampQuery(t)}}async resolveTimestampAsync(t,e="render"){if(!this.disjoint||!this.trackTimestamp)return;const n=this.get(t);n.gpuQueries||(n.gpuQueries=[]);for(let t=0;t<n.gpuQueries.length;t++){const r=n.gpuQueries[t],i=this.gl.getQueryParameter(r.query,this.gl.QUERY_RESULT_AVAILABLE),s=this.gl.getParameter(this.disjoint.GPU_DISJOINT_EXT);if(i&&!s){const i=this.gl.getQueryParameter(r.query,this.gl.QUERY_RESULT),s=Number(i)/1e6;this.gl.deleteQuery(r.query),n.gpuQueries.splice(t,1),t--,this.renderer.info.updateTimestamp(e,s)}}}getContext(){return this.gl}beginRender(t){const{gl:e}=this,n=this.get(t);if(this.initTimestampQuery(t),n.previousContext=this._currentContext,this._currentContext=t,this._setFramebuffer(t),this.clear(t.clearColor,t.clearDepth,t.clearStencil,t,!1),t.viewport?this.updateViewport(t):e.viewport(0,0,e.drawingBufferWidth,e.drawingBufferHeight),t.scissor){const{x:n,y:r,width:i,height:s}=t.scissorValue;e.scissor(n,t.height-s-r,i,s)}const r=t.occlusionQueryCount;r>0&&(n.currentOcclusionQueries=n.occlusionQueries,n.currentOcclusionQueryObjects=n.occlusionQueryObjects,n.lastOcclusionObject=null,n.occlusionQueries=new Array(r),n.occlusionQueryObjects=new Array(r),n.occlusionQueryIndex=0)}finishRender(t){const{gl:e,state:n}=this,r=this.get(t),i=r.previousContext,s=t.occlusionQueryCount;s>0&&(s>r.occlusionQueryIndex&&e.endQuery(e.ANY_SAMPLES_PASSED),this.resolveOccludedAsync(t));const o=t.textures;if(null!==o)for(let t=0;t<o.length;t++){const e=o[t];e.generateMipmaps&&this.generateMipmaps(e)}if(this._currentContext=i,null!==t.textures&&t.renderTarget){const r=this.get(t.renderTarget),{samples:i}=t.renderTarget;if(i>0){const i=r.framebuffers[t.getCacheKey()],s=e.COLOR_BUFFER_BIT,o=r.msaaFrameBuffer,a=t.textures;n.bindFramebuffer(e.READ_FRAMEBUFFER,o),n.bindFramebuffer(e.DRAW_FRAMEBUFFER,i);for(let n=0;n<a.length;n++)if(t.scissor){const{x:n,y:i,width:o,height:a}=t.scissorValue,l=t.height-a-i;e.blitFramebuffer(n,l,n+o,l+a,n,l,n+o,l+a,s,e.NEAREST),e.invalidateSubFramebuffer(e.READ_FRAMEBUFFER,r.invalidationArray,n,l,o,a)}else e.blitFramebuffer(0,0,t.width,t.height,0,0,t.width,t.height,s,e.NEAREST),e.invalidateFramebuffer(e.READ_FRAMEBUFFER,r.invalidationArray)}}null!==i&&(this._setFramebuffer(i),i.viewport?this.updateViewport(i):e.viewport(0,0,e.drawingBufferWidth,e.drawingBufferHeight)),this.prepareTimestampBuffer(t)}resolveOccludedAsync(t){const e=this.get(t),{currentOcclusionQueries:n,currentOcclusionQueryObjects:r}=e;if(n&&r){const t=new WeakSet,{gl:i}=this;e.currentOcclusionQueryObjects=null,e.currentOcclusionQueries=null;const s=()=>{let o=0;for(let e=0;e<n.length;e++){const s=n[e];null!==s&&(i.getQueryParameter(s,i.QUERY_RESULT_AVAILABLE)&&(i.getQueryParameter(s,i.QUERY_RESULT)>0&&t.add(r[e]),n[e]=null,i.deleteQuery(s),o++))}o<n.length?requestAnimationFrame(s):e.occluded=t};s()}}isOccluded(t,e){const n=this.get(t);return n.occluded&&n.occluded.has(e)}updateViewport(t){const e=this.gl,{x:n,y:r,width:i,height:s}=t.viewportValue;e.viewport(n,t.height-s-r,i,s)}setScissorTest(t){const e=this.gl;t?e.enable(e.SCISSOR_TEST):e.disable(e.SCISSOR_TEST)}clear(t,e,n,r=null,i=!0){const{gl:s}=this;if(null===r){const t=this.getClearColor();t.r*=t.a,t.g*=t.a,t.b*=t.a,r={textures:null,clearColorValue:t}}let o=0;if(t&&(o|=s.COLOR_BUFFER_BIT),e&&(o|=s.DEPTH_BUFFER_BIT),n&&(o|=s.STENCIL_BUFFER_BIT),0!==o){let a;if(r.clearColorValue?a=r.clearColorValue:(a=this.getClearColor(),a.r*=a.a,a.g*=a.a,a.b*=a.a),e&&this.state.setDepthMask(!0),null===r.textures)s.clearColor(a.r,a.g,a.b,a.a),s.clear(o);else{if(i&&this._setFramebuffer(r),t)for(let t=0;t<r.textures.length;t++)s.clearBufferfv(s.COLOR,t,[a.r,a.g,a.b,a.a]);e&&n?s.clearBufferfi(s.DEPTH_STENCIL,0,1,0):e?s.clearBufferfv(s.DEPTH,0,[1]):n&&s.clearBufferiv(s.STENCIL,0,[0])}}}beginCompute(t){const{state:e,gl:n}=this;e.bindFramebuffer(n.FRAMEBUFFER,null),this.initTimestampQuery(t)}compute(t,e,n,r){const{state:i,gl:s}=this;this.discard||(s.enable(s.RASTERIZER_DISCARD),this.discard=!0);const{programGPU:o,transformBuffers:a,attributes:l}=this.get(r),u=this._getVaoKey(null,l),c=this.vaoCache[u];void 0===c?this._createVao(null,l):s.bindVertexArray(c),i.useProgram(o),this._bindUniforms(n);const h=this._getTransformFeedback(a);s.bindTransformFeedback(s.TRANSFORM_FEEDBACK,h),s.beginTransformFeedback(s.POINTS),l[0].isStorageInstancedBufferAttribute?s.drawArraysInstanced(s.POINTS,0,1,e.count):s.drawArrays(s.POINTS,0,e.count),s.endTransformFeedback(),s.bindTransformFeedback(s.TRANSFORM_FEEDBACK,null);for(let t=0;t<a.length;t++){const e=a[t];e.pbo&&this.textureUtils.copyBufferToTexture(e.transformBuffer,e.pbo),e.switchBuffers()}}finishCompute(t){const e=this.gl;this.discard=!1,e.disable(e.RASTERIZER_DISCARD),this.prepareTimestampBuffer(t),this._currentContext&&this._setFramebuffer(this._currentContext)}draw(t){const{object:e,pipeline:n,material:r,context:i}=t,{programGPU:s}=this.get(n),{gl:o,state:a}=this,l=this.get(i),u=t.getDrawParameters();if(null===u)return;this._bindUniforms(t.getBindings());const c=e.isMesh&&e.matrixWorld.determinant()<0;a.setMaterial(r,c),a.useProgram(s);let h=t.staticVao;if(void 0===h){const e=this._getVaoKey(t.getIndex(),t.getAttributes());if(h=this.vaoCache[e],void 0===h){let e;({vaoGPU:h,staticVao:e}=this._createVao(t.getIndex(),t.getAttributes())),e&&(t.staticVao=h)}}o.bindVertexArray(h);const d=t.getIndex(),p=l.lastOcclusionObject;if(p!==e&&void 0!==p){if(null!==p&&!0===p.occlusionTest&&(o.endQuery(o.ANY_SAMPLES_PASSED),l.occlusionQueryIndex++),!0===e.occlusionTest){const t=o.createQuery();o.beginQuery(o.ANY_SAMPLES_PASSED,t),l.occlusionQueries[l.occlusionQueryIndex]=t,l.occlusionQueryObjects[l.occlusionQueryIndex]=e}l.lastOcclusionObject=e}const f=this.bufferRenderer;e.isPoints?f.mode=o.POINTS:e.isLineSegments?f.mode=o.LINES:e.isLine?f.mode=o.LINE_STRIP:e.isLineLoop?f.mode=o.LINE_LOOP:!0===r.wireframe?(a.setLineWidth(r.wireframeLinewidth*this.renderer.getPixelRatio()),f.mode=o.LINES):f.mode=o.TRIANGLES;const{vertexCount:m,instanceCount:g}=u;let{firstVertex:v}=u;if(f.object=e,null!==d){v*=d.array.BYTES_PER_ELEMENT;const t=this.get(d);f.index=d.count,f.type=t.type}else f.index=0;var y;e.isBatchedMesh?null!==e._multiDrawInstances?f.renderMultiDrawInstances(e._multiDrawStarts,e._multiDrawCounts,e._multiDrawCount,e._multiDrawInstances):this.hasFeature("WEBGL_multi_draw")?f.renderMultiDraw(e._multiDrawStarts,e._multiDrawCounts,e._multiDrawCount):(y="THREE.WebGLRenderer: WEBGL_multi_draw not supported.")in ch||(ch[y]=!0,console.warn(y)):g>1?f.renderInstances(v,m,g):f.render(v,m),o.bindVertexArray(null)}needsRenderUpdate(){return!1}getRenderCacheKey(){return""}createDefaultTexture(t){this.textureUtils.createDefaultTexture(t)}createTexture(t,e){this.textureUtils.createTexture(t,e)}updateTexture(t,e){this.textureUtils.updateTexture(t,e)}generateMipmaps(t){this.textureUtils.generateMipmaps(t)}destroyTexture(t){this.textureUtils.destroyTexture(t)}copyTextureToBuffer(t,e,n,r,i,s){return this.textureUtils.copyTextureToBuffer(t,e,n,r,i,s)}createSampler(){}destroySampler(){}createNodeBuilder(t,e){return new rN(t,e)}createProgram(t){const e=this.gl,{stage:n,code:r}=t,i="fragment"===n?e.createShader(e.FRAGMENT_SHADER):e.createShader(e.VERTEX_SHADER);e.shaderSource(i,r),e.compileShader(i),this.set(t,{shaderGPU:i})}destroyProgram(){console.warn("Abstract class.")}createRenderPipeline(t,e){const n=this.gl,r=t.pipeline,{fragmentProgram:i,vertexProgram:s}=r,o=n.createProgram(),a=this.get(i).shaderGPU,l=this.get(s).shaderGPU;if(n.attachShader(o,a),n.attachShader(o,l),n.linkProgram(o),this.set(r,{programGPU:o,fragmentShader:a,vertexShader:l}),null!==e&&this.parallel){const i=new Promise((e=>{const i=this.parallel,s=()=>{n.getProgramParameter(o,i.COMPLETION_STATUS_KHR)?(this._completeCompile(t,r),e()):requestAnimationFrame(s)};s()}));e.push(i)}else this._completeCompile(t,r)}_handleSource(t,e){const n=t.split("\n"),r=[],i=Math.max(e-6,0),s=Math.min(e+6,n.length);for(let t=i;t<s;t++){const i=t+1;r.push(`${i===e?">":" "} ${i}: ${n[t]}`)}return r.join("\n")}_getShaderErrors(t,e,n){const r=t.getShaderParameter(e,t.COMPILE_STATUS),i=t.getShaderInfoLog(e).trim();if(r&&""===i)return"";const s=/ERROR: 0:(\d+)/.exec(i);if(s){const r=parseInt(s[1]);return n.toUpperCase()+"\n\n"+i+"\n\n"+this._handleSource(t.getShaderSource(e),r)}return i}_logProgramError(t,e,n){if(this.renderer.debug.checkShaderErrors){const r=this.gl,i=r.getProgramInfoLog(t).trim();if(!1===r.getProgramParameter(t,r.LINK_STATUS))if("function"==typeof this.renderer.debug.onShaderError)this.renderer.debug.onShaderError(r,t,n,e);else{const s=this._getShaderErrors(r,n,"vertex"),o=this._getShaderErrors(r,e,"fragment");console.error("THREE.WebGLProgram: Shader Error "+r.getError()+" - VALIDATE_STATUS "+r.getProgramParameter(t,r.VALIDATE_STATUS)+"\n\nProgram Info Log: "+i+"\n"+s+"\n"+o)}else""!==i&&console.warn("THREE.WebGLProgram: Program Info Log:",i)}}_completeCompile(t,e){const{state:n,gl:r}=this,i=this.get(e),{programGPU:s,fragmentShader:o,vertexShader:a}=i;!1===r.getProgramParameter(s,r.LINK_STATUS)&&this._logProgramError(s,o,a),n.useProgram(s);const l=t.getBindings();this._setupBindings(l,s),this.set(e,{programGPU:s})}createComputePipeline(t,e){const{state:n,gl:r}=this,i={stage:"fragment",code:"#version 300 es\nprecision highp float;\nvoid main() {}"};this.createProgram(i);const{computeProgram:s}=t,o=r.createProgram(),a=this.get(i).shaderGPU,l=this.get(s).shaderGPU,u=s.transforms,c=[],h=[];for(let t=0;t<u.length;t++){const e=u[t];c.push(e.varyingName),h.push(e.attributeNode)}r.attachShader(o,a),r.attachShader(o,l),r.transformFeedbackVaryings(o,c,r.SEPARATE_ATTRIBS),r.linkProgram(o),!1===r.getProgramParameter(o,r.LINK_STATUS)&&this._logProgramError(o,a,l),n.useProgram(o),this._setupBindings(e,o);const d=s.attributes,p=[],f=[];for(let t=0;t<d.length;t++){const e=d[t].node.attribute;p.push(e),this.has(e)||this.attributeUtils.createAttribute(e,r.ARRAY_BUFFER)}for(let t=0;t<h.length;t++){const e=h[t].attribute;this.has(e)||this.attributeUtils.createAttribute(e,r.ARRAY_BUFFER);const n=this.get(e);f.push(n)}this.set(t,{programGPU:o,transformBuffers:f,attributes:p})}createBindings(t,e){if(!1===this._knownBindings.has(e)){this._knownBindings.add(e);let t=0,n=0;for(const r of e){this.set(r,{textures:n,uniformBuffers:t});for(const e of r.bindings)e.isUniformBuffer&&t++,e.isSampledTexture&&n++}}this.updateBindings(t,e)}updateBindings(t){const{gl:e}=this,n=this.get(t);let r=n.uniformBuffers,i=n.textures;for(const n of t.bindings)if(n.isUniformsGroup||n.isUniformBuffer){const t=n.buffer,i=e.createBuffer();e.bindBuffer(e.UNIFORM_BUFFER,i),e.bufferData(e.UNIFORM_BUFFER,t,e.DYNAMIC_DRAW),this.set(n,{index:r++,bufferGPU:i})}else if(n.isSampledTexture){const{textureGPU:t,glTextureType:e}=this.get(n.texture);this.set(n,{index:i++,textureGPU:t,glTextureType:e})}}updateBinding(t){const e=this.gl;if(t.isUniformsGroup||t.isUniformBuffer){const n=this.get(t).bufferGPU,r=t.buffer;e.bindBuffer(e.UNIFORM_BUFFER,n),e.bufferData(e.UNIFORM_BUFFER,r,e.DYNAMIC_DRAW)}}createIndexAttribute(t){const e=this.gl;this.attributeUtils.createAttribute(t,e.ELEMENT_ARRAY_BUFFER)}createAttribute(t){if(this.has(t))return;const e=this.gl;this.attributeUtils.createAttribute(t,e.ARRAY_BUFFER)}createStorageAttribute(t){if(this.has(t))return;const e=this.gl;this.attributeUtils.createAttribute(t,e.ARRAY_BUFFER)}updateAttribute(t){this.attributeUtils.updateAttribute(t)}destroyAttribute(t){this.attributeUtils.destroyAttribute(t)}updateSize(){}hasFeature(t){const e=Object.keys(SN).filter((e=>SN[e]===t)),n=this.extensions;for(let t=0;t<e.length;t++)if(n.has(e[t]))return!0;return!1}getMaxAnisotropy(){return this.capabilities.getMaxAnisotropy()}copyTextureToTexture(t,e,n,r,i){this.textureUtils.copyTextureToTexture(t,e,n,r,i)}copyFramebufferToTexture(t,e,n){this.textureUtils.copyFramebufferToTexture(t,e,n)}_setFramebuffer(t){const{gl:e,state:n}=this;let r=null;if(null!==t.textures){const i=t.renderTarget,s=this.get(i),{samples:o,depthBuffer:a,stencilBuffer:l}=i,u=!0===i.isWebGLCubeRenderTarget;let c=s.msaaFrameBuffer,h=s.depthRenderbuffer;const d=PE(t);let p;if(u?(s.cubeFramebuffers||(s.cubeFramebuffers={}),p=s.cubeFramebuffers[d]):(s.framebuffers||(s.framebuffers={}),p=s.framebuffers[d]),void 0===p){p=e.createFramebuffer(),n.bindFramebuffer(e.FRAMEBUFFER,p);const r=t.textures;if(u){s.cubeFramebuffers[d]=p;const{textureGPU:t}=this.get(r[0]),n=this.renderer._activeCubeFace;e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_CUBE_MAP_POSITIVE_X+n,t,0)}else{s.framebuffers[d]=p;for(let n=0;n<r.length;n++){const i=r[n],s=this.get(i);s.renderTarget=t.renderTarget,s.cacheKey=d;const o=e.COLOR_ATTACHMENT0+n;e.framebufferTexture2D(e.FRAMEBUFFER,o,e.TEXTURE_2D,s.textureGPU,0)}n.drawBuffers(t,p)}if(null!==t.depthTexture){const n=this.get(t.depthTexture),r=l?e.DEPTH_STENCIL_ATTACHMENT:e.DEPTH_ATTACHMENT;n.renderTarget=t.renderTarget,n.cacheKey=d,e.framebufferTexture2D(e.FRAMEBUFFER,r,e.TEXTURE_2D,n.textureGPU,0)}}if(o>0){if(void 0===c){const r=[];c=e.createFramebuffer(),n.bindFramebuffer(e.FRAMEBUFFER,c);const i=[],u=t.textures;for(let n=0;n<u.length;n++){if(i[n]=e.createRenderbuffer(),e.bindRenderbuffer(e.RENDERBUFFER,i[n]),r.push(e.COLOR_ATTACHMENT0+n),a){const t=l?e.DEPTH_STENCIL_ATTACHMENT:e.DEPTH_ATTACHMENT;r.push(t)}const s=t.textures[n],u=this.get(s);e.renderbufferStorageMultisample(e.RENDERBUFFER,o,u.glInternalFormat,t.width,t.height),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0+n,e.RENDERBUFFER,i[n])}if(s.msaaFrameBuffer=c,s.msaaRenderbuffers=i,void 0===h){h=e.createRenderbuffer(),this.textureUtils.setupRenderBufferStorage(h,t),s.depthRenderbuffer=h;const n=l?e.DEPTH_STENCIL_ATTACHMENT:e.DEPTH_ATTACHMENT;r.push(n)}s.invalidationArray=r}r=s.msaaFrameBuffer}else r=p}n.bindFramebuffer(e.FRAMEBUFFER,r)}_getVaoKey(t,e){let n=[];if(null!==t){n+=":"+this.get(t).id}for(let t=0;t<e.length;t++){n+=":"+this.get(e[t]).id}return n}_createVao(t,e){const{gl:n}=this,r=n.createVertexArray();let i="",s=!0;if(n.bindVertexArray(r),null!==t){const e=this.get(t);n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,e.bufferGPU),i+=":"+e.id}for(let t=0;t<e.length;t++){const r=e[t],o=this.get(r);let a,l;i+=":"+o.id,n.bindBuffer(n.ARRAY_BUFFER,o.bufferGPU),n.enableVertexAttribArray(t),(r.isStorageBufferAttribute||r.isStorageInstancedBufferAttribute)&&(s=!1),!0===r.isInterleavedBufferAttribute?(a=r.data.stride*o.bytesPerElement,l=r.offset*o.bytesPerElement):(a=0,l=0),o.isInteger?n.vertexAttribIPointer(t,r.itemSize,o.type,a,l):n.vertexAttribPointer(t,r.itemSize,o.type,r.normalized,a,l),r.isInstancedBufferAttribute&&!r.isInterleavedBufferAttribute?n.vertexAttribDivisor(t,r.meshPerAttribute):r.isInterleavedBufferAttribute&&r.data.isInstancedInterleavedBuffer&&n.vertexAttribDivisor(t,r.data.meshPerAttribute)}return n.bindBuffer(n.ARRAY_BUFFER,null),this.vaoCache[i]=r,{vaoGPU:r,staticVao:s}}_getTransformFeedback(t){let e="";for(let n=0;n<t.length;n++)e+=":"+t[n].id;let n=this.transformFeedbackCache[e];if(void 0!==n)return n;const{gl:r}=this;n=r.createTransformFeedback(),r.bindTransformFeedback(r.TRANSFORM_FEEDBACK,n);for(let e=0;e<t.length;e++){const n=t[e];r.bindBufferBase(r.TRANSFORM_FEEDBACK_BUFFER,e,n.transformBuffer)}return r.bindTransformFeedback(r.TRANSFORM_FEEDBACK,null),this.transformFeedbackCache[e]=n,n}_setupBindings(t,e){const n=this.gl;for(const r of t)for(const t of r.bindings){const r=this.get(t).index;if(t.isUniformsGroup||t.isUniformBuffer){const i=n.getUniformBlockIndex(e,t.name);n.uniformBlockBinding(e,i,r)}else if(t.isSampledTexture){const i=n.getUniformLocation(e,t.name);n.uniform1i(i,r)}}}_bindUniforms(t){const{gl:e,state:n}=this;for(const r of t)for(const t of r.bindings){const r=this.get(t),i=r.index;t.isUniformsGroup||t.isUniformBuffer?n.bindBufferBase(e.UNIFORM_BUFFER,i,r.bufferGPU):t.isSampledTexture&&n.bindTexture(r.glTextureType,r.textureGPU,e.TEXTURE0+i)}}dispose(){this.renderer.domElement.removeEventListener("webglcontextlost",this._onContextLost)}}class TN extends zR{constructor(t,e){super(t),this.texture=e,this.version=e?e.version:0,this.isSampler=!0}}class AN extends TN{constructor(t,e,n){super(t,e?e.value:null),this.textureNode=e,this.groupNode=n}update(){this.texture=this.textureNode.value}}class CN extends VR{constructor(t,e){super(t,e?e.array:null),this.attribute=e,this.isStorageBuffer=!0}}let RN=0;class NN extends CN{constructor(t,e){super("StorageBuffer_"+RN++,t?t.value:null),this.nodeUniform=t,this.access=t?t.access:JT,this.groupNode=e}get buffer(){return this.nodeUniform.value}}class PN extends oE{constructor(t){super(),this.device=t;this.mipmapSampler=t.createSampler({minFilter:wT}),this.flipYSampler=t.createSampler({minFilter:ST}),this.transferPipelines={},this.flipYPipelines={},this.mipmapVertexShaderModule=t.createShaderModule({label:"mipmapVertex",code:"\nstruct VarysStruct {\n\t@builtin( position ) Position: vec4<f32>,\n\t@location( 0 ) vTex : vec2<f32>\n};\n\n@vertex\nfn main( @builtin( vertex_index ) vertexIndex : u32 ) -> VarysStruct {\n\n\tvar Varys : VarysStruct;\n\n\tvar pos = array< vec2<f32>, 4 >(\n\t\tvec2<f32>( -1.0,  1.0 ),\n\t\tvec2<f32>(  1.0,  1.0 ),\n\t\tvec2<f32>( -1.0, -1.0 ),\n\t\tvec2<f32>(  1.0, -1.0 )\n\t);\n\n\tvar tex = array< vec2<f32>, 4 >(\n\t\tvec2<f32>( 0.0, 0.0 ),\n\t\tvec2<f32>( 1.0, 0.0 ),\n\t\tvec2<f32>( 0.0, 1.0 ),\n\t\tvec2<f32>( 1.0, 1.0 )\n\t);\n\n\tVarys.vTex = tex[ vertexIndex ];\n\tVarys.Position = vec4<f32>( pos[ vertexIndex ], 0.0, 1.0 );\n\n\treturn Varys;\n\n}\n"}),this.mipmapFragmentShaderModule=t.createShaderModule({label:"mipmapFragment",code:"\n@group( 0 ) @binding( 0 )\nvar imgSampler : sampler;\n\n@group( 0 ) @binding( 1 )\nvar img : texture_2d<f32>;\n\n@fragment\nfn main( @location( 0 ) vTex : vec2<f32> ) -> @location( 0 ) vec4<f32> {\n\n\treturn textureSample( img, imgSampler, vTex );\n\n}\n"}),this.flipYFragmentShaderModule=t.createShaderModule({label:"flipYFragment",code:"\n@group( 0 ) @binding( 0 )\nvar imgSampler : sampler;\n\n@group( 0 ) @binding( 1 )\nvar img : texture_2d<f32>;\n\n@fragment\nfn main( @location( 0 ) vTex : vec2<f32> ) -> @location( 0 ) vec4<f32> {\n\n\treturn textureSample( img, imgSampler, vec2( vTex.x, 1.0 - vTex.y ) );\n\n}\n"})}getTransferPipeline(t){let e=this.transferPipelines[t];return void 0===e&&(e=this.device.createRenderPipeline({label:`mipmap-${t}`,vertex:{module:this.mipmapVertexShaderModule,entryPoint:"main"},fragment:{module:this.mipmapFragmentShaderModule,entryPoint:"main",targets:[{format:t}]},primitive:{topology:tT,stripIndexFormat:vT},layout:"auto"}),this.transferPipelines[t]=e),e}getFlipYPipeline(t){let e=this.flipYPipelines[t];return void 0===e&&(e=this.device.createRenderPipeline({label:`flipY-${t}`,vertex:{module:this.mipmapVertexShaderModule,entryPoint:"main"},fragment:{module:this.flipYFragmentShaderModule,entryPoint:"main",targets:[{format:t}]},primitive:{topology:tT,stripIndexFormat:vT},layout:"auto"}),this.flipYPipelines[t]=e),e}flipY(t,e,n=0){const r=e.format,{width:i,height:s}=e.size,o=this.getTransferPipeline(r),a=this.getFlipYPipeline(r),l=this.device.createTexture({size:{width:i,height:s,depthOrArrayLayers:1},format:r,usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.TEXTURE_BINDING}),u=t.createView({baseMipLevel:0,mipLevelCount:1,dimension:uA,baseArrayLayer:n}),c=l.createView({baseMipLevel:0,mipLevelCount:1,dimension:uA,baseArrayLayer:0}),h=this.device.createCommandEncoder({}),d=(t,e,n)=>{const r=t.getBindGroupLayout(0),i=this.device.createBindGroup({layout:r,entries:[{binding:0,resource:this.flipYSampler},{binding:1,resource:e}]}),s=h.beginRenderPass({colorAttachments:[{view:n,loadOp:hT,storeOp:uT,clearValue:[0,0,0,0]}]});s.setPipeline(t),s.setBindGroup(0,i),s.draw(4,1,0,0),s.end()};d(o,u,c),d(a,c,u),this.device.queue.submit([h.finish()]),l.destroy()}generateMipmaps(t,e,n=0){const r=this.get(t);void 0===r.useCount&&(r.useCount=0,r.layers=[]);const i=r.layers[n]||this._mipmapCreateBundles(t,e,n),s=this.device.createCommandEncoder({});this._mipmapRunBundles(s,i),this.device.queue.submit([s.finish()]),0!==r.useCount&&(r.layers[n]=i),r.useCount++}_mipmapCreateBundles(t,e,n){const r=this.getTransferPipeline(e.format),i=r.getBindGroupLayout(0);let s=t.createView({baseMipLevel:0,mipLevelCount:1,dimension:uA,baseArrayLayer:n});const o=[];for(let a=1;a<e.mipLevelCount;a++){const l=this.device.createBindGroup({layout:i,entries:[{binding:0,resource:this.mipmapSampler},{binding:1,resource:s}]}),u=t.createView({baseMipLevel:a,mipLevelCount:1,dimension:uA,baseArrayLayer:n}),c={colorAttachments:[{view:u,loadOp:hT,storeOp:uT,clearValue:[0,0,0,0]}]},h=this.device.createRenderBundleEncoder({colorFormats:[e.format]});h.setPipeline(r),h.setBindGroup(0,l),h.draw(4,1,0,0),o.push({renderBundles:[h.finish()],passDescriptor:c}),s=u}return o}_mipmapRunBundles(t,e){const n=e.length;for(let r=0;r<n;r++){const n=e[r],i=t.beginRenderPass(n.passDescriptor);i.executeBundles(n.renderBundles),i.end()}}}const IN={512:"never",513:"less",514:"equal",515:"less-equal",516:"greater",518:"greater-equal",519:"always",517:"not-equal"},ON=[0,1,3,2,4,5];class DN{constructor(t){this.backend=t,this._passUtils=null,this.defaultTexture={},this.defaultCubeTexture={},this.defaultVideoFrame=null,this.colorBuffer=null,this.depthTexture=new df,this.depthTexture.name="depthBuffer"}createSampler(t){const e=this.backend,n=e.device,r=e.get(t),i={addressModeU:this._convertAddressMode(t.wrapS),addressModeV:this._convertAddressMode(t.wrapT),addressModeW:this._convertAddressMode(t.wrapR),magFilter:this._convertFilterMode(t.magFilter),minFilter:this._convertFilterMode(t.minFilter),mipmapFilter:this._convertFilterMode(t.minFilter),maxAnisotropy:1};i.magFilter===wT&&i.minFilter===wT&&i.mipmapFilter===wT&&(i.maxAnisotropy=t.anisotropy),t.isDepthTexture&&null!==t.compareFunction&&(i.compare=IN[t.compareFunction]),r.sampler=n.createSampler(i)}createDefaultTexture(t){let e;const n=LN(t);t.isCubeTexture?e=this._getDefaultCubeTextureGPU(n):t.isVideoTexture?this.backend.get(t).externalTexture=this._getDefaultVideoFrame():e=this._getDefaultTextureGPU(n),this.backend.get(t).texture=e}createTexture(t,e={}){const n=this.backend,r=n.get(t);if(r.initialized)throw new Error("WebGPUTextureUtils: Texture already initialized.");void 0===e.needsMipmaps&&(e.needsMipmaps=!1),void 0===e.levels&&(e.levels=1),void 0===e.depth&&(e.depth=1);const{width:i,height:s,depth:o,levels:a}=e;t.isFramebufferTexture&&(e.renderTarget?e.format=this.backend.utils.getCurrentColorFormat(e.renderTarget):e.format=this.backend.utils.getPreferredCanvasFormat());const l=this._getDimension(t),u=t.internalFormat||e.format||LN(t,n.device);r.format=u;let c=void 0!==e.sampleCount?e.sampleCount:1;c=n.utils.getSampleCount(c);const h=t.isRenderTargetTexture&&!t.isMultisampleRenderTargetTexture?1:c;let d=GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST|GPUTextureUsage.COPY_SRC;!0===t.isStorageTexture&&(d|=GPUTextureUsage.STORAGE_BINDING),!0!==t.isCompressedTexture&&!0!==t.isCompressedArrayTexture&&(d|=GPUTextureUsage.RENDER_ATTACHMENT);const p={label:t.name,size:{width:i,height:s,depthOrArrayLayers:o},mipLevelCount:a,sampleCount:h,dimension:l,format:u,usage:d};if(t.isVideoTexture){const e=t.source.data,n=new VideoFrame(e);p.size.width=n.displayWidth,p.size.height=n.displayHeight,n.close(),r.externalTexture=e}else{if(void 0===u)return console.warn("WebGPURenderer: Texture format not supported."),this.createDefaultTexture(t);r.texture=n.device.createTexture(p)}if(t.isRenderTargetTexture&&c>1&&!t.isMultisampleRenderTargetTexture){const t=Object.assign({},p);t.label=t.label+"-msaa",t.sampleCount=c,r.msaaTexture=n.device.createTexture(t)}r.initialized=!0,r.textureDescriptorGPU=p}destroyTexture(t){const e=this.backend,n=e.get(t);n.texture.destroy(),void 0!==n.msaaTexture&&n.msaaTexture.destroy(),e.delete(t)}destroySampler(t){delete this.backend.get(t).sampler}generateMipmaps(t){const e=this.backend.get(t);if(t.isCubeTexture)for(let t=0;t<6;t++)this._generateMipmaps(e.texture,e.textureDescriptorGPU,t);else{const n=t.image.depth||1;for(let t=0;t<n;t++)this._generateMipmaps(e.texture,e.textureDescriptorGPU,t)}}getColorBuffer(){this.colorBuffer&&this.colorBuffer.destroy();const t=this.backend,{width:e,height:n}=t.getDrawingBufferSize();return this.colorBuffer=t.device.createTexture({label:"colorBuffer",size:{width:e,height:n,depthOrArrayLayers:1},sampleCount:t.utils.getSampleCount(t.renderer.samples),format:t.utils.getPreferredCanvasFormat(),usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.COPY_SRC}),this.colorBuffer}getDepthBuffer(t=!0,e=!1){const n=this.backend,{width:r,height:i}=n.getDrawingBufferSize(),s=this.depthTexture,o=n.get(s).texture;let a,l;if(e?(a=sc,l=ec):t&&(a=ic,l=Ju),void 0!==o){if(s.image.width===r&&s.image.height===i&&s.format===a&&s.type===l)return o;this.destroyTexture(s)}return s.name="depthBuffer",s.format=a,s.type=l,s.image.width=r,s.image.height=i,this.createTexture(s,{sampleCount:n.utils.getSampleCount(n.renderer.samples),width:r,height:i}),n.get(s).texture}updateTexture(t,e){const n=this.backend.get(t),{textureDescriptorGPU:r}=n;if(!t.isRenderTargetTexture&&void 0!==r){if(t.isDataTexture)this._copyBufferToTexture(e.image,n.texture,r,0,t.flipY);else if(t.isDataArrayTexture||t.isData3DTexture)for(let i=0;i<e.image.depth;i++)this._copyBufferToTexture(e.image,n.texture,r,i,t.flipY,i);else if(t.isCompressedTexture||t.isCompressedArrayTexture)this._copyCompressedBufferToTexture(t.mipmaps,n.texture,r);else if(t.isCubeTexture)this._copyCubeMapToTexture(e.images,n.texture,r,t.flipY);else if(t.isVideoTexture){const e=t.source.data;n.externalTexture=e}else this._copyImageToTexture(e.image,n.texture,r,0,t.flipY);n.version=t.version,t.onUpdate&&t.onUpdate(t)}}async copyTextureToBuffer(t,e,n,r,i,s){const o=this.backend.device,a=this.backend.get(t),l=a.texture,u=a.textureDescriptorGPU.format,c=this._getBytesPerTexel(u);let h=r*c;h=256*Math.ceil(h/256);const d=o.createBuffer({size:r*i*c,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ}),p=o.createCommandEncoder();p.copyTextureToBuffer({texture:l,origin:{x:e,y:n,z:s}},{buffer:d,bytesPerRow:h},{width:r,height:i});const f=this._getTypedArrayType(u);o.queue.submit([p.finish()]),await d.mapAsync(GPUMapMode.READ);return new f(d.getMappedRange())}_isEnvironmentTexture(t){const e=t.mapping;return e===Lu||e===Uu||e===Ou||e===Du}_getDefaultTextureGPU(t){let e=this.defaultTexture[t];if(void 0===e){const n=new Eh;n.minFilter=Vu,n.magFilter=Vu,this.createTexture(n,{width:1,height:1,format:t}),this.defaultTexture[t]=e=n}return this.backend.get(e).texture}_getDefaultCubeTextureGPU(t){let e=this.defaultTexture[t];if(void 0===e){const n=new qp;n.minFilter=Vu,n.magFilter=Vu,this.createTexture(n,{width:1,height:1,depth:6}),this.defaultCubeTexture[t]=e=n}return this.backend.get(e).texture}_getDefaultVideoFrame(){let t=this.defaultVideoFrame;if(null===t){const e={timestamp:0,codedWidth:1,codedHeight:1,format:"RGBA"};this.defaultVideoFrame=t=new VideoFrame(new Uint8Array([0,0,0,255]),e)}return t}_copyCubeMapToTexture(t,e,n,r){for(let i=0;i<6;i++){const s=t[i],o=!0===r?ON[i]:i;s.isDataTexture?this._copyBufferToTexture(s.image,e,n,o,r):this._copyImageToTexture(s,e,n,o,r)}}_copyImageToTexture(t,e,n,r,i){this.backend.device.queue.copyExternalImageToTexture({source:t},{texture:e,mipLevel:0,origin:{x:0,y:0,z:r}},{width:t.width,height:t.height,depthOrArrayLayers:1}),!0===i&&this._flipY(e,n,r)}_getPassUtils(){let t=this._passUtils;return null===t&&(this._passUtils=t=new PN(this.backend.device)),t}_generateMipmaps(t,e,n=0){this._getPassUtils().generateMipmaps(t,e,n)}_flipY(t,e,n=0){this._getPassUtils().flipY(t,e,n)}_copyBufferToTexture(t,e,n,r,i,s=0){const o=this.backend.device,a=t.data,l=this._getBytesPerTexel(n.format),u=t.width*l;o.queue.writeTexture({texture:e,mipLevel:0,origin:{x:0,y:0,z:r}},a,{offset:t.width*t.height*l*s,bytesPerRow:u},{width:t.width,height:t.height,depthOrArrayLayers:1}),!0===i&&this._flipY(e,n,r)}_copyCompressedBufferToTexture(t,e,n){const r=this.backend.device,i=this._getBlockData(n.format),s=n.size.depthOrArrayLayers>1;for(let o=0;o<t.length;o++){const a=t[o],l=a.width,u=a.height,c=s?n.size.depthOrArrayLayers:1,h=Math.ceil(l/i.width)*i.byteLength,d=h*Math.ceil(u/i.height);for(let t=0;t<c;t++)r.queue.writeTexture({texture:e,mipLevel:o,origin:{x:0,y:0,z:t}},a.data,{offset:t*d,bytesPerRow:h,rowsPerImage:Math.ceil(u/i.height)},{width:Math.ceil(l/i.width)*i.width,height:Math.ceil(u/i.height)*i.height,depthOrArrayLayers:1})}}_getBlockData(t){return t===yT.BC1RGBAUnorm||t===yT.BC1RGBAUnormSRGB?{byteLength:8,width:4,height:4}:t===yT.BC2RGBAUnorm||t===yT.BC2RGBAUnormSRGB||t===yT.BC3RGBAUnorm||t===yT.BC3RGBAUnormSRGB?{byteLength:16,width:4,height:4}:t===yT.BC4RUnorm||t===yT.BC4RSNorm?{byteLength:8,width:4,height:4}:t===yT.BC5RGUnorm||t===yT.BC5RGSnorm||t===yT.BC6HRGBUFloat||t===yT.BC6HRGBFloat||t===yT.BC7RGBAUnorm||t===yT.BC7RGBAUnormSRGB?{byteLength:16,width:4,height:4}:t===yT.ETC2RGB8Unorm||t===yT.ETC2RGB8UnormSRGB||t===yT.ETC2RGB8A1Unorm||t===yT.ETC2RGB8A1UnormSRGB?{byteLength:8,width:4,height:4}:t===yT.ETC2RGBA8Unorm||t===yT.ETC2RGBA8UnormSRGB?{byteLength:16,width:4,height:4}:t===yT.EACR11Unorm||t===yT.EACR11Snorm?{byteLength:8,width:4,height:4}:t===yT.EACRG11Unorm||t===yT.EACRG11Snorm||t===yT.ASTC4x4Unorm||t===yT.ASTC4x4UnormSRGB?{byteLength:16,width:4,height:4}:t===yT.ASTC5x4Unorm||t===yT.ASTC5x4UnormSRGB?{byteLength:16,width:5,height:4}:t===yT.ASTC5x5Unorm||t===yT.ASTC5x5UnormSRGB?{byteLength:16,width:5,height:5}:t===yT.ASTC6x5Unorm||t===yT.ASTC6x5UnormSRGB?{byteLength:16,width:6,height:5}:t===yT.ASTC6x6Unorm||t===yT.ASTC6x6UnormSRGB?{byteLength:16,width:6,height:6}:t===yT.ASTC8x5Unorm||t===yT.ASTC8x5UnormSRGB?{byteLength:16,width:8,height:5}:t===yT.ASTC8x6Unorm||t===yT.ASTC8x6UnormSRGB?{byteLength:16,width:8,height:6}:t===yT.ASTC8x8Unorm||t===yT.ASTC8x8UnormSRGB?{byteLength:16,width:8,height:8}:t===yT.ASTC10x5Unorm||t===yT.ASTC10x5UnormSRGB?{byteLength:16,width:10,height:5}:t===yT.ASTC10x6Unorm||t===yT.ASTC10x6UnormSRGB?{byteLength:16,width:10,height:6}:t===yT.ASTC10x8Unorm||t===yT.ASTC10x8UnormSRGB?{byteLength:16,width:10,height:8}:t===yT.ASTC10x10Unorm||t===yT.ASTC10x10UnormSRGB?{byteLength:16,width:10,height:10}:t===yT.ASTC12x10Unorm||t===yT.ASTC12x10UnormSRGB?{byteLength:16,width:12,height:10}:t===yT.ASTC12x12Unorm||t===yT.ASTC12x12UnormSRGB?{byteLength:16,width:12,height:12}:void 0}_convertAddressMode(t){let e=_T;return t===Bu?e=xT:t===zu&&(e=bT),e}_convertFilterMode(t){let e=wT;return t!==Vu&&t!==Gu&&t!==ju||(e=ST),e}_getBytesPerTexel(t){return t===yT.R8Unorm||t===yT.R8Snorm||t===yT.R8Uint||t===yT.R8Sint?1:t===yT.R16Uint||t===yT.R16Sint||t===yT.R16Float||t===yT.RG8Unorm||t===yT.RG8Snorm||t===yT.RG8Uint||t===yT.RG8Sint?2:t===yT.R32Uint||t===yT.R32Sint||t===yT.R32Float||t===yT.RG16Uint||t===yT.RG16Sint||t===yT.RG16Float||t===yT.RGBA8Unorm||t===yT.RGBA8UnormSRGB||t===yT.RGBA8Snorm||t===yT.RGBA8Uint||t===yT.RGBA8Sint||t===yT.BGRA8Unorm||t===yT.BGRA8UnormSRGB||t===yT.RGB9E5UFloat||t===yT.RGB10A2Unorm||t===yT.RG11B10UFloat||t===yT.Depth32Float||t===yT.Depth24Plus||t===yT.Depth24PlusStencil8||t===yT.Depth32FloatStencil8?4:t===yT.RG32Uint||t===yT.RG32Sint||t===yT.RG32Float||t===yT.RGBA16Uint||t===yT.RGBA16Sint||t===yT.RGBA16Float?8:t===yT.RGBA32Uint||t===yT.RGBA32Sint||t===yT.RGBA32Float?16:void 0}_getTypedArrayType(t){return t===yT.R8Uint?Uint8Array:t===yT.R8Sint?Int8Array:t===yT.R8Unorm?Uint8Array:t===yT.R8Snorm?Int8Array:t===yT.RG8Uint?Uint8Array:t===yT.RG8Sint?Int8Array:t===yT.RG8Unorm?Uint8Array:t===yT.RG8Snorm?Int8Array:t===yT.RGBA8Uint?Uint8Array:t===yT.RGBA8Sint?Int8Array:t===yT.RGBA8Unorm?Uint8Array:t===yT.RGBA8Snorm?Int8Array:t===yT.R16Uint?Uint16Array:t===yT.R16Sint?Int16Array:t===yT.RG16Uint?Uint16Array:t===yT.RG16Sint?Int16Array:t===yT.RGBA16Uint?Uint16Array:t===yT.RGBA16Sint?Int16Array:t===yT.R16Float||t===yT.RG16Float||t===yT.RGBA16Float?Uint16Array:t===yT.R32Uint?Uint32Array:t===yT.R32Sint?Int32Array:t===yT.R32Float?Float32Array:t===yT.RG32Uint?Uint32Array:t===yT.RG32Sint?Int32Array:t===yT.RG32Float?Float32Array:t===yT.RGBA32Uint?Uint32Array:t===yT.RGBA32Sint?Int32Array:t===yT.RGBA32Float?Float32Array:t===yT.BGRA8Unorm||t===yT.BGRA8UnormSRGB?Uint8Array:t===yT.RGB10A2Unorm||t===yT.RGB9E5UFloat||t===yT.RG11B10UFloat?Uint32Array:t===yT.Depth32Float?Float32Array:t===yT.Depth24Plus||t===yT.Depth24PlusStencil8?Uint32Array:t===yT.Depth32FloatStencil8?Float32Array:void 0}_getDimension(t){let e;return e=t.isData3DTexture?lA:aA,e}}function LN(t,e=null){const n=t.format,r=t.type,i=t.colorSpace;let s;if(!0===t.isCompressedTexture||!0===t.isCompressedArrayTexture)switch(n){case dc:s=i===Fc?yT.BC1RGBAUnormSRGB:yT.BC1RGBAUnorm;break;case pc:s=i===Fc?yT.BC2RGBAUnormSRGB:yT.BC2RGBAUnorm;break;case fc:s=i===Fc?yT.BC3RGBAUnormSRGB:yT.BC3RGBAUnorm;break;case mc:s=i===Fc?yT.ETC2RGB8UnormSRGB:yT.ETC2RGB8Unorm;break;case gc:s=i===Fc?yT.ETC2RGBA8UnormSRGB:yT.ETC2RGBA8Unorm;break;case vc:s=i===Fc?yT.ASTC4x4UnormSRGB:yT.ASTC4x4Unorm;break;case yc:s=i===Fc?yT.ASTC5x4UnormSRGB:yT.ASTC5x4Unorm;break;case _c:s=i===Fc?yT.ASTC5x5UnormSRGB:yT.ASTC5x5Unorm;break;case xc:s=i===Fc?yT.ASTC6x5UnormSRGB:yT.ASTC6x5Unorm;break;case bc:s=i===Fc?yT.ASTC6x6UnormSRGB:yT.ASTC6x6Unorm;break;case wc:s=i===Fc?yT.ASTC8x5UnormSRGB:yT.ASTC8x5Unorm;break;case Sc:s=i===Fc?yT.ASTC8x6UnormSRGB:yT.ASTC8x6Unorm;break;case Mc:s=i===Fc?yT.ASTC8x8UnormSRGB:yT.ASTC8x8Unorm;break;case Ec:s=i===Fc?yT.ASTC10x5UnormSRGB:yT.ASTC10x5Unorm;break;case Tc:s=i===Fc?yT.ASTC10x6UnormSRGB:yT.ASTC10x6Unorm;break;case Ac:s=i===Fc?yT.ASTC10x8UnormSRGB:yT.ASTC10x8Unorm;break;case Cc:s=i===Fc?yT.ASTC10x10UnormSRGB:yT.ASTC10x10Unorm;break;case Rc:s=i===Fc?yT.ASTC12x10UnormSRGB:yT.ASTC12x10Unorm;break;case Nc:s=i===Fc?yT.ASTC12x12UnormSRGB:yT.ASTC12x12Unorm;break;default:console.error("WebGPURenderer: Unsupported texture format.",n)}else switch(n){case rc:switch(r){case Zu:s=yT.RGBA8Snorm;break;case $u:s=yT.RGBA16Sint;break;case Yu:s=yT.RGBA16Uint;break;case Ju:s=yT.RGBA32Uint;break;case Ku:s=yT.RGBA32Sint;break;case Xu:s=i===Fc?yT.RGBA8UnormSRGB:yT.RGBA8Unorm;break;case tc:s=yT.RGBA16Float;break;case Qu:s=yT.RGBA32Float;break;default:console.error("WebGPURenderer: Unsupported texture type with RGBAFormat.",r)}break;case nc:if(35902===r)s=yT.RGB9E5UFloat;else console.error("WebGPURenderer: Unsupported texture type with RGBFormat.",r);break;case oc:switch(r){case Zu:s=yT.R8Snorm;break;case $u:s=yT.R16Sint;break;case Yu:s=yT.R16Uint;break;case Ju:s=yT.R32Uint;break;case Ku:s=yT.R32Sint;break;case Xu:s=yT.R8Unorm;break;case tc:s=yT.R16Float;break;case Qu:s=yT.R32Float;break;default:console.error("WebGPURenderer: Unsupported texture type with RedFormat.",r)}break;case lc:switch(r){case Zu:s=yT.RG8Snorm;break;case $u:s=yT.RG16Sint;break;case Yu:s=yT.RG16Uint;break;case Ju:s=yT.RG32Uint;break;case Ku:s=yT.RG32Sint;break;case Xu:s=yT.RG8Unorm;break;case tc:s=yT.RG16Float;break;case Qu:s=yT.RG32Float;break;default:console.error("WebGPURenderer: Unsupported texture type with RGFormat.",r)}break;case ic:switch(r){case Yu:s=yT.Depth16Unorm;break;case Ju:s=yT.Depth24Plus;break;case Qu:s=yT.Depth32Float;break;default:console.error("WebGPURenderer: Unsupported texture type with DepthFormat.",r)}break;case sc:switch(r){case ec:s=yT.Depth24PlusStencil8;break;case Qu:e&&!1===e.features.has(gA.Depth32FloatStencil8)&&console.error('WebGPURenderer: Depth textures with DepthStencilFormat + FloatType can only be used with the "depth32float-stencil8" GPU feature.'),s=yT.Depth32FloatStencil8;break;default:console.error("WebGPURenderer: Unsupported texture type with DepthStencilFormat.",r)}break;case ac:switch(r){case Ku:s=yT.R32Sint;break;case Ju:s=yT.R32Uint;break;default:console.error("WebGPURenderer: Unsupported texture type with RedIntegerFormat.",r)}break;case uc:switch(r){case Ku:s=yT.RG32Sint;break;case Ju:s=yT.RG32Uint;break;default:console.error("WebGPURenderer: Unsupported texture type with RGIntegerFormat.",r)}break;case cc:switch(r){case Ku:s=yT.RGBA32Sint;break;case Ju:s=yT.RGBA32Uint;break;default:console.error("WebGPURenderer: Unsupported texture type with RGBAIntegerFormat.",r)}break;default:console.error("WebGPURenderer: Unsupported texture format.",n)}return s}const UN=/^[fn]*\s*([a-z_0-9]+)?\s*\(([\s\S]*?)\)\s*[\-\>]*\s*([a-z_0-9]+(?:<[\s\S]+?>)?)/i,kN=/([a-z_0-9]+)\s*:\s*([a-z_0-9]+(?:<[\s\S]+?>)?)/gi,BN={f32:"float",i32:"int",u32:"uint",bool:"bool","vec2<f32>":"vec2","vec2<i32>":"ivec2","vec2<u32>":"uvec2","vec2<bool>":"bvec2",vec2f:"vec2",vec2i:"ivec2",vec2u:"uvec2",vec2b:"bvec2","vec3<f32>":"vec3","vec3<i32>":"ivec3","vec3<u32>":"uvec3","vec3<bool>":"bvec3",vec3f:"vec3",vec3i:"ivec3",vec3u:"uvec3",vec3b:"bvec3","vec4<f32>":"vec4","vec4<i32>":"ivec4","vec4<u32>":"uvec4","vec4<bool>":"bvec4",vec4f:"vec4",vec4i:"ivec4",vec4u:"uvec4",vec4b:"bvec4","mat2x2<f32>":"mat2",mat2x2f:"mat2","mat3x3<f32>":"mat3",mat3x3f:"mat3","mat4x4<f32>":"mat4",mat4x4f:"mat4",sampler:"sampler",texture_1d:"texture",texture_2d:"texture",texture_2d_array:"texture",texture_multisampled_2d:"cubeTexture",texture_depth_2d:"depthTexture",texture_3d:"texture3D",texture_cube:"cubeTexture",texture_cube_array:"cubeTexture",texture_storage_1d:"storageTexture",texture_storage_2d:"storageTexture",texture_storage_2d_array:"storageTexture",texture_storage_3d:"storageTexture"};class FN extends xR{constructor(t){const{type:e,inputs:n,name:r,inputsCode:i,blockCode:s,outputType:o}=(t=>{const e=(t=t.trim()).match(UN);if(null!==e&&4===e.length){const n=e[2],r=[];let i=null;for(;null!==(i=kN.exec(n));)r.push({name:i[1],type:i[2]});const s=[];for(let t=0;t<r.length;t++){const{name:e,type:n}=r[t];let i=n;i.startsWith("ptr")?i="pointer":(i.startsWith("texture")&&(i=n.split("<")[0]),i=BN[i]),s.push(new lR(i,e))}const o=t.substring(e[0].length),a=e[3]||"void",l=void 0!==e[1]?e[1]:"";return{type:BN[a]||a,inputs:s,name:l,inputsCode:n,blockCode:o,outputType:a}}throw new Error("FunctionNode: Function is not a WGSL code.")})(t);super(e,n,r),this.inputsCode=i,this.blockCode=s,this.outputType=o}getCode(t=this.name){const e="void"!==this.outputType?"-> "+this.outputType:"";return`fn ${t} ( ${this.inputsCode.trim()} ) ${e}`+this.blockCode}}class zN extends _R{parseFunction(t){return new FN(t)}}const VN=self.GPUShaderStage,GN={vertex:VN?VN.VERTEX:1,fragment:VN?VN.FRAGMENT:2,compute:VN?VN.COMPUTE:4},jN={instance:!0,swizzleAssign:!1,storageBuffer:!0},HN={"^^":"tsl_xor"},WN={float:"f32",int:"i32",uint:"u32",bool:"bool",color:"vec3<f32>",vec2:"vec2<f32>",ivec2:"vec2<i32>",uvec2:"vec2<u32>",bvec2:"vec2<bool>",vec3:"vec3<f32>",ivec3:"vec3<i32>",uvec3:"vec3<u32>",bvec3:"vec3<bool>",vec4:"vec4<f32>",ivec4:"vec4<i32>",uvec4:"vec4<u32>",bvec4:"vec4<bool>",mat2:"mat2x2<f32>",mat3:"mat3x3<f32>",mat4:"mat4x4<f32>"},qN={tsl_xor:new PA("fn tsl_xor( a : bool, b : bool ) -> bool { return ( a || b ) && !( a && b ); }"),mod_float:new PA("fn tsl_mod_float( x : f32, y : f32 ) -> f32 { return x - y * floor( x / y ); }"),mod_vec2:new PA("fn tsl_mod_vec2( x : vec2f, y : vec2f ) -> vec2f { return x - y * floor( x / y ); }"),mod_vec3:new PA("fn tsl_mod_vec3( x : vec3f, y : vec3f ) -> vec3f { return x - y * floor( x / y ); }"),mod_vec4:new PA("fn tsl_mod_vec4( x : vec4f, y : vec4f ) -> vec4f { return x - y * floor( x / y ); }"),equals_bool:new PA("fn tsl_equals_bool( a : bool, b : bool ) -> bool { return a == b; }"),equals_bvec2:new PA("fn tsl_equals_bvec2( a : vec2f, b : vec2f ) -> vec2<bool> { return vec2<bool>( a.x == b.x, a.y == b.y ); }"),equals_bvec3:new PA("fn tsl_equals_bvec3( a : vec3f, b : vec3f ) -> vec3<bool> { return vec3<bool>( a.x == b.x, a.y == b.y, a.z == b.z ); }"),equals_bvec4:new PA("fn tsl_equals_bvec4( a : vec4f, b : vec4f ) -> vec4<bool> { return vec4<bool>( a.x == b.x, a.y == b.y, a.z == b.z, a.w == b.w ); }"),repeatWrapping:new PA("\nfn tsl_repeatWrapping( uv : vec2<f32>, dimension : vec2<u32> ) -> vec2<u32> {\n\n\tlet uvScaled = vec2<u32>( uv * vec2<f32>( dimension ) );\n\n\treturn ( ( uvScaled % dimension ) + dimension ) % dimension;\n\n}\n"),biquadraticTexture:new PA("\nfn tsl_biquadraticTexture( map : texture_2d<f32>, coord : vec2f, level : i32 ) -> vec4f {\n\n\tlet iRes = vec2i( textureDimensions( map, level ) );\n\tlet res = vec2f( iRes );\n\n\tlet uvScaled = coord * res;\n\tlet uvWrapping = ( ( uvScaled % res ) + res ) % res;\n\n\t// https://www.shadertoy.com/view/WtyXRy\n\n\tlet uv = uvWrapping - 0.5;\n\tlet iuv = floor( uv );\n\tlet f = fract( uv );\n\n\tlet rg1 = textureLoad( map, vec2i( iuv + vec2( 0.5, 0.5 ) ) % iRes, level );\n\tlet rg2 = textureLoad( map, vec2i( iuv + vec2( 1.5, 0.5 ) ) % iRes, level );\n\tlet rg3 = textureLoad( map, vec2i( iuv + vec2( 0.5, 1.5 ) ) % iRes, level );\n\tlet rg4 = textureLoad( map, vec2i( iuv + vec2( 1.5, 1.5 ) ) % iRes, level );\n\n\treturn mix( mix( rg1, rg2, f.x ), mix( rg3, rg4, f.x ), f.y );\n\n}\n")},XN={dFdx:"dpdx",dFdy:"- dpdy",mod_float:"tsl_mod_float",mod_vec2:"tsl_mod_vec2",mod_vec3:"tsl_mod_vec3",mod_vec4:"tsl_mod_vec4",equals_bool:"tsl_equals_bool",equals_bvec2:"tsl_equals_bvec2",equals_bvec3:"tsl_equals_bvec3",equals_bvec4:"tsl_equals_bvec4",inversesqrt:"inverseSqrt",bitcast:"bitcast<f32>"};/Windows/g.test(navigator.userAgent)&&(qN.pow_float=new PA("fn tsl_pow_float( a : f32, b : f32 ) -> f32 { return select( -pow( -a, b ), pow( a, b ), a > 0.0 ); }"),qN.pow_vec2=new PA("fn tsl_pow_vec2( a : vec2f, b : vec2f ) -> vec2f { return vec2f( tsl_pow_float( a.x, b.x ), tsl_pow_float( a.y, b.y ) ); }",[qN.pow_float]),qN.pow_vec3=new PA("fn tsl_pow_vec3( a : vec3f, b : vec3f ) -> vec3f { return vec3f( tsl_pow_float( a.x, b.x ), tsl_pow_float( a.y, b.y ), tsl_pow_float( a.z, b.z ) ); }",[qN.pow_float]),qN.pow_vec4=new PA("fn tsl_pow_vec4( a : vec4f, b : vec4f ) -> vec4f { return vec4f( tsl_pow_float( a.x, b.x ), tsl_pow_float( a.y, b.y ), tsl_pow_float( a.z, b.z ), tsl_pow_float( a.w, b.w ) ); }",[qN.pow_float]),XN.pow_float="tsl_pow_float",XN.pow_vec2="tsl_pow_vec2",XN.pow_vec3="tsl_pow_vec3",XN.pow_vec4="tsl_pow_vec4");let ZN="";!0!==/Firefox|Deno/g.test(navigator.userAgent)&&(ZN+="diagnostic( off, derivative_uniformity );\n");class $N extends oR{constructor(t,e){super(t,e,new zN),this.uniformGroups={},this.builtins={},this.directives={},this.scopedArrays=new Map}needsToWorkingColorSpace(t){return!0===t.isVideoTexture&&t.colorSpace!==Bc}_generateTextureSample(t,e,n,r,i=this.shaderStage){return"fragment"===i?r?`textureSample( ${e}, ${e}_sampler, ${n}, ${r} )`:`textureSample( ${e}, ${e}_sampler, ${n} )`:this.isFilteredTexture(t)?this.generateFilteredTexture(t,e,n):this.generateTextureLod(t,e,n,"0")}_generateVideoSample(t,e,n=this.shaderStage){if("fragment"===n)return`textureSampleBaseClampToEdge( ${t}, ${t}_sampler, vec2<f32>( ${e}.x, 1.0 - ${e}.y ) )`;console.error(`WebGPURenderer: THREE.VideoTexture does not support ${n} shader.`)}_generateTextureSampleLevel(t,e,n,r,i,s=this.shaderStage){return"fragment"===s&&!1===this.isUnfilterable(t)?`textureSampleLevel( ${e}, ${e}_sampler, ${n}, ${r} )`:this.isFilteredTexture(t)?this.generateFilteredTexture(t,e,n,r):this.generateTextureLod(t,e,n,r)}generateFilteredTexture(t,e,n,r="0"){return this._include("biquadraticTexture"),`tsl_biquadraticTexture( ${e}, ${n}, i32( ${r} ) )`}generateTextureLod(t,e,n,r="0"){this._include("repeatWrapping");return`textureLoad( ${e}, tsl_repeatWrapping( ${n}, ${!0===t.isMultisampleRenderTargetTexture?`textureDimensions( ${e} )`:`textureDimensions( ${e}, 0 )`} ), i32( ${r} ) )`}generateTextureLoad(t,e,n,r,i="0u"){return r?`textureLoad( ${e}, ${n}, ${r}, ${i} )`:`textureLoad( ${e}, ${n}, ${i} )`}generateTextureStore(t,e,n,r){return`textureStore( ${e}, ${n}, ${r} )`}isUnfilterable(t){return"float"!==this.getComponentTypeFromTexture(t)||!this.isAvailable("float32Filterable")&&!0===t.isDataTexture&&t.type===Qu||!0===t.isMultisampleRenderTargetTexture}generateTexture(t,e,n,r,i=this.shaderStage){let s=null;return s=!0===t.isVideoTexture?this._generateVideoSample(e,n,i):this.isUnfilterable(t)?this.generateTextureLod(t,e,n,"0",r,i):this._generateTextureSample(t,e,n,r,i),s}generateTextureGrad(t,e,n,r,i,s=this.shaderStage){if("fragment"===s)return`textureSampleGrad( ${e}, ${e}_sampler, ${n},  ${r[0]}, ${r[1]} )`;console.error(`WebGPURenderer: THREE.TextureNode.gradient() does not support ${s} shader.`)}generateTextureCompare(t,e,n,r,i,s=this.shaderStage){if("fragment"===s)return`textureSampleCompare( ${e}, ${e}_sampler, ${n}, ${r} )`;console.error(`WebGPURenderer: THREE.DepthTexture.compareFunction() does not support ${s} shader.`)}generateTextureLevel(t,e,n,r,i,s=this.shaderStage){let o=null;return o=!0===t.isVideoTexture?this._generateVideoSample(e,n,s):this._generateTextureSampleLevel(t,e,n,r,i,s),o}generateTextureBias(t,e,n,r,i,s=this.shaderStage){if("fragment"===s)return`textureSampleBias( ${e}, ${e}_sampler, ${n}, ${r} )`;console.error(`WebGPURenderer: THREE.TextureNode.biasNode does not support ${s} shader.`)}getPropertyName(t,e=this.shaderStage){if(!0===t.isNodeVarying&&!0===t.needsInterpolation){if("vertex"===e)return`varyings.${t.name}`}else if(!0===t.isNodeUniform){const e=t.name,n=t.type;return"texture"===n||"cubeTexture"===n||"storageTexture"===n||"texture3D"===n?e:"buffer"===n||"storageBuffer"===n||"indirectStorageBuffer"===n?`NodeBuffer_${t.id}.${e}`:t.groupNode.name+"."+e}return super.getPropertyName(t)}getOutputStructName(){return"output"}_getUniformGroupCount(t){return Object.keys(this.uniforms[t]).length}getFunctionOperator(t){const e=HN[t];return void 0!==e?(this._include(e),e):null}getStorageAccess(t){if(t.isStorageTextureNode)switch(t.access){case eA:return"read";case tA:return"write";default:return"read_write"}else switch(t.access){case JT:return"read_write";case QT:return"read";default:return"write"}}getUniformFromNode(t,e,n,r=null){const i=super.getUniformFromNode(t,e,n,r),s=this.getDataFromNode(t,n,this.globalCache);if(void 0===s.uniformGPU){let r;const o=t.groupNode,a=o.name,l=this.getBindGroupArray(a,n);if("texture"===e||"cubeTexture"===e||"storageTexture"===e||"texture3D"===e){let s=null;if("texture"===e||"storageTexture"===e?s=new YR(i.name,i.node,o,t.access?t.access:null):"cubeTexture"===e?s=new KR(i.name,i.node,o,t.access?t.access:null):"texture3D"===e&&(s=new JR(i.name,i.node,o,t.access?t.access:null)),s.store=!0===t.isStorageTextureNode,s.setVisibility(GN[n]),"fragment"===n&&!1===this.isUnfilterable(t.value)&&!1===s.store){const t=new AN(`${i.name}_sampler`,i.node,o);t.setVisibility(GN[n]),l.push(t,s),r=[t,s]}else l.push(s),r=[s]}else if("buffer"===e||"storageBuffer"===e||"indirectStorageBuffer"===e){const i=new("buffer"===e?HR:NN)(t,o);i.setVisibility(GN[n]),l.push(i),r=i}else{const t=this.uniformGroups[n]||(this.uniformGroups[n]={});let s=t[a];void 0===s&&(s=new XR(a,o),s.setVisibility(GN[n]),t[a]=s,l.push(s)),r=this.getNodeUniform(i,e),s.addUniform(r)}s.uniformGPU=r}return i}getBuiltin(t,e,n,r=this.shaderStage){const i=this.builtins[r]||(this.builtins[r]=new Map);return!1===i.has(t)&&i.set(t,{name:t,property:e,type:n}),e}hasBuiltin(t,e=this.shaderStage){return void 0!==this.builtins[e]&&this.builtins[e].has(t)}getVertexIndex(){return"vertex"===this.shaderStage?this.getBuiltin("vertex_index","vertexIndex","u32","attribute"):"vertexIndex"}buildFunctionCode(t){const e=t.layout,n=this.flowShaderNode(t),r=[];for(const t of e.inputs)r.push(t.name+" : "+this.getType(t.type));let i=`fn ${e.name}( ${r.join(", ")} ) -> ${this.getType(e.type)} {\n${n.vars}\n${n.code}\n`;return n.result&&(i+=`\treturn ${n.result};\n`),i+="\n}\n",i}getInstanceIndex(){return"vertex"===this.shaderStage?this.getBuiltin("instance_index","instanceIndex","u32","attribute"):"instanceIndex"}getInvocationLocalIndex(){return this.getBuiltin("local_invocation_index","invocationLocalIndex","u32","attribute")}getSubgroupSize(){return this.enableSubGroups(),this.getBuiltin("subgroup_size","subgroupSize","u32","attribute")}getInvocationSubgroupIndex(){return this.enableSubGroups(),this.getBuiltin("subgroup_invocation_id","invocationSubgroupIndex","u32","attribute")}getSubgroupIndex(){return this.enableSubGroups(),this.getBuiltin("subgroup_id","subgroupIndex","u32","attribute")}getDrawIndex(){return null}getFrontFacing(){return this.getBuiltin("front_facing","isFront","bool")}getFragCoord(){return this.getBuiltin("position","fragCoord","vec4<f32>")+".xy"}getFragDepth(){return"output."+this.getBuiltin("frag_depth","depth","f32","output")}isFlipY(){return!1}enableDirective(t,e=this.shaderStage){(this.directives[e]||(this.directives[e]=new Set)).add(t)}getDirectives(t){const e=[],n=this.directives[t];if(void 0!==n)for(const t of n)e.push(`enable ${t};`);return e.join("\n")}enableSubGroups(){this.enableDirective("subgroups")}enableSubgroupsF16(){this.enableDirective("subgroups-f16")}enableClipDistances(){this.enableDirective("clip_distances")}enableShaderF16(){this.enableDirective("f16")}enableDualSourceBlending(){this.enableDirective("dual_source_blending")}getBuiltins(t){const e=[],n=this.builtins[t];if(void 0!==n)for(const{name:t,property:r,type:i}of n.values())e.push(`@builtin( ${t} ) ${r} : ${i}`);return e.join(",\n\t")}getScopedArray(t,e,n,r){return!1===this.scopedArrays.has(t)&&this.scopedArrays.set(t,{name:t,scope:e,bufferType:n,bufferCount:r}),t}getScopedArrays(t){if("compute"!==t)return;const e=[];for(const{name:t,scope:n,bufferType:r,bufferCount:i}of this.scopedArrays.values()){const s=this.getType(r);e.push(`var<${n}> ${t}: array< ${s}, ${i} >;`)}return e.join("\n")}getAttributes(t){const e=[];if("compute"===t&&(this.getBuiltin("global_invocation_id","id","vec3<u32>","attribute"),this.getBuiltin("workgroup_id","workgroupId","vec3<u32>","attribute"),this.getBuiltin("local_invocation_id","localId","vec3<u32>","attribute"),this.getBuiltin("num_workgroups","numWorkgroups","vec3<u32>","attribute"),this.renderer.hasFeature("subgroups")&&(this.enableDirective("subgroups",t),this.getBuiltin("subgroup_size","subgroupSize","u32","attribute"))),"vertex"===t||"compute"===t){const t=this.getBuiltins("attribute");t&&e.push(t);const n=this.getAttributesArray();for(let t=0,r=n.length;t<r;t++){const r=n[t],i=r.name,s=this.getType(r.type);e.push(`@location( ${t} ) ${i} : ${s}`)}}return e.join(",\n\t")}getStructMembers(t){const e=[],n=t.getMemberTypes();for(let t=0;t<n.length;t++){const r=n[t];e.push(`\t@location( ${t} ) m${t} : ${r}<f32>`)}const r=this.getBuiltins("output");return r&&e.push("\t"+r),e.join(",\n")}getStructs(t){const e=[],n=this.structs[t];for(let t=0,r=n.length;t<r;t++){const r=n[t],i=r.name;let s=`struct ${i} {\n`;s+=this.getStructMembers(r),s+="\n}",e.push(s),e.push(`\nvar<private> output : ${i};\n\n`)}return e.join("\n\n")}getVar(t,e){return`var ${e} : ${this.getType(t)}`}getVars(t){const e=[],n=this.vars[t];if(void 0!==n)for(const t of n)e.push(`\t${this.getVar(t.type,t.name)};`);return`\n${e.join("\n")}\n`}getVaryings(t){const e=[];if("vertex"===t&&this.getBuiltin("position","Vertex","vec4<f32>","vertex"),"vertex"===t||"fragment"===t){const n=this.varyings,r=this.vars[t];for(let i=0;i<n.length;i++){const s=n[i];if(s.needsInterpolation){let t=`@location( ${i} )`;/^(int|uint|ivec|uvec)/.test(s.type)&&(t+=" @interpolate( flat )"),e.push(`${t} ${s.name} : ${this.getType(s.type)}`)}else"vertex"===t&&!1===r.includes(s)&&r.push(s)}}const n=this.getBuiltins(t);n&&e.push(n);const r=e.join(",\n\t");return"vertex"===t?this._getWGSLStruct("VaryingsStruct","\t"+r):r}getUniforms(t){const e=this.uniforms[t],n=[],r=[],i=[],s={};for(const i of e){const e=i.groupNode.name,o=this.bindingsIndexes[e];if("texture"===i.type||"cubeTexture"===i.type||"storageTexture"===i.type||"texture3D"===i.type){const e=i.node.value;let r;"fragment"===t&&!1===this.isUnfilterable(e)&&!0!==i.node.isStorageTextureNode&&(!0===e.isDepthTexture&&null!==e.compareFunction?n.push(`@binding( ${o.binding++} ) @group( ${o.group} ) var ${i.name}_sampler : sampler_comparison;`):n.push(`@binding( ${o.binding++} ) @group( ${o.group} ) var ${i.name}_sampler : sampler;`));let s="";if(!0===e.isMultisampleRenderTargetTexture&&(s="_multisampled"),!0===e.isCubeTexture)r="texture_cube<f32>";else if(!0===e.isDataArrayTexture||!0===e.isCompressedArrayTexture)r="texture_2d_array<f32>";else if(!0===e.isDepthTexture)r=`texture_depth${s}_2d`;else if(!0===e.isVideoTexture)r="texture_external";else if(!0===e.isData3DTexture)r="texture_3d<f32>";else if(!0===i.node.isStorageTextureNode){r=`texture_storage_2d<${LN(e)}, ${this.getStorageAccess(i.node)}>`}else{r=`texture${s}_2d<${this.getComponentTypeFromTexture(e).charAt(0)}32>`}n.push(`@binding( ${o.binding++} ) @group( ${o.group} ) var ${i.name} : ${r};`)}else if("buffer"===i.type||"storageBuffer"===i.type||"indirectStorageBuffer"===i.type){const t=i.node,e=this.getType(t.bufferType),n=t.bufferCount,s=n>0&&"buffer"===i.type?", "+n:"",a=t.isAtomic?`atomic<${e}>`:`${e}`,l=`\t${i.name} : array< ${a}${s} >\n`,u=t.isStorageBufferNode?`storage, ${this.getStorageAccess(t)}`:"uniform";r.push(this._getWGSLStructBinding("NodeBuffer_"+t.id,l,u,o.binding++,o.group))}else{const t=this.getType(this.getVectorType(i.type)),e=i.groupNode.name;(s[e]||(s[e]={index:o.binding++,id:o.group,snippets:[]})).snippets.push(`\t${i.name} : ${t}`)}}for(const t in s){const e=s[t];i.push(this._getWGSLStructBinding(t,e.snippets.join(",\n"),"uniform",e.index,e.id))}let o=n.join("\n");return o+=r.join("\n"),o+=i.join("\n"),o}buildCode(){const t=null!==this.material?{fragment:{},vertex:{}}:{compute:{}};this.sortBindingGroups();for(const e in t){const n=t[e];n.uniforms=this.getUniforms(e),n.attributes=this.getAttributes(e),n.varyings=this.getVaryings(e),n.structs=this.getStructs(e),n.vars=this.getVars(e),n.codes=this.getCodes(e),n.directives=this.getDirectives(e),n.scopedArrays=this.getScopedArrays(e);let r="// code\n\n";r+=this.flowCode[e];const i=this.flowNodes[e],s=i[i.length-1],o=s.outputNode,a=void 0!==o&&!0===o.isOutputStructNode;for(const t of i){const i=this.getFlowData(t),l=t.name;if(l&&(r.length>0&&(r+="\n"),r+=`\t// flow -> ${l}\n\t`),r+=`${i.code}\n\t`,t===s&&"compute"!==e)if(r+="// result\n\n\t","vertex"===e)r+=`varyings.Vertex = ${i.result};`;else if("fragment"===e)if(a)n.returnType=o.nodeType,r+=`return ${i.result};`;else{let t="\t@location(0) color: vec4<f32>";const e=this.getBuiltins("output");e&&(t+=",\n\t"+e),n.returnType="OutputStruct",n.structs+=this._getWGSLStruct("OutputStruct",t),n.structs+="\nvar<private> output : OutputStruct;\n\n",r+=`output.color = ${i.result};\n\n\treturn output;`}}n.flow=r}null!==this.material?(this.vertexShader=this._getWGSLVertexCode(t.vertex),this.fragmentShader=this._getWGSLFragmentCode(t.fragment)):this.computeShader=this._getWGSLComputeCode(t.compute,(this.object.workgroupSize||[64]).join(", "))}getMethod(t,e=null){let n;return null!==e&&(n=this._getWGSLMethod(t+"_"+e)),void 0===n&&(n=this._getWGSLMethod(t)),n||t}getType(t){return WN[t]||t}isAvailable(t){let e=jN[t];return void 0===e&&("float32Filterable"===t&&(e=this.renderer.hasFeature("float32-filterable")),jN[t]=e),e}_getWGSLMethod(t){return void 0!==qN[t]&&this._include(t),XN[t]}_include(t){const e=qN[t];return e.build(this),null!==this.currentFunctionNode&&this.currentFunctionNode.includes.push(e),e}_getWGSLVertexCode(t){return`${this.getSignature()}\n// directives\n${t.directives}\n\n// uniforms\n${t.uniforms}\n\n// varyings\n${t.varyings}\nvar<private> varyings : VaryingsStruct;\n\n// codes\n${t.codes}\n\n@vertex\nfn main( ${t.attributes} ) -> VaryingsStruct {\n\n\t// vars\n\t${t.vars}\n\n\t// flow\n\t${t.flow}\n\n\treturn varyings;\n\n}\n`}_getWGSLFragmentCode(t){return`${this.getSignature()}\n// global\n${ZN}\n\n// uniforms\n${t.uniforms}\n\n// structs\n${t.structs}\n\n// codes\n${t.codes}\n\n@fragment\nfn main( ${t.varyings} ) -> ${t.returnType} {\n\n\t// vars\n\t${t.vars}\n\n\t// flow\n\t${t.flow}\n\n}\n`}_getWGSLComputeCode(t,e){return`${this.getSignature()}\n// directives\n${t.directives}\n\n// system\nvar<private> instanceIndex : u32;\n\n// locals\n${t.scopedArrays}\n\n// uniforms\n${t.uniforms}\n\n// codes\n${t.codes}\n\n@compute @workgroup_size( ${e} )\nfn main( ${t.attributes} ) {\n\n\t// system\n\tinstanceIndex = id.x + id.y * numWorkgroups.x * u32(${e}) + id.z * numWorkgroups.x * numWorkgroups.y * u32(${e});\n\n\t// vars\n\t${t.vars}\n\n\t// flow\n\t${t.flow}\n\n}\n`}_getWGSLStruct(t,e){return`\nstruct ${t} {\n${e}\n};`}_getWGSLStructBinding(t,e,n,r=0,i=0){const s=t+"Struct";return`${this._getWGSLStruct(s,e)}\n@binding( ${r} ) @group( ${i} )\nvar<${n}> ${t} : ${s};`}}class YN{constructor(t){this.backend=t}getCurrentDepthStencilFormat(t){let e;return null!==t.depthTexture?e=this.getTextureFormatGPU(t.depthTexture):t.depth&&t.stencil?e=yT.Depth24PlusStencil8:t.depth&&(e=yT.Depth24Plus),e}getTextureFormatGPU(t){return this.backend.get(t).format}getCurrentColorFormat(t){let e;return e=null!==t.textures?this.getTextureFormatGPU(t.textures[0]):this.getPreferredCanvasFormat(),e}getCurrentColorSpace(t){return null!==t.textures?t.textures[0].colorSpace:this.backend.renderer.outputColorSpace}getPrimitiveTopology(t,e){return t.isPoints?YE:t.isLineSegments||t.isMesh&&!0===e.wireframe?KE:t.isLine?JE:t.isMesh?QE:void 0}getSampleCount(t){let e=1;return t>1&&(e=Math.pow(2,Math.floor(Math.log2(t))),2===e&&(e=4)),e}getSampleCountRenderContext(t){return null!==t.textures?this.getSampleCount(t.sampleCount):this.getSampleCount(this.backend.renderer.samples)}getPreferredCanvasFormat(){return navigator.userAgent.includes("Quest")?yT.BGRA8Unorm:navigator.gpu.getPreferredCanvasFormat()}}const KN=new Map([[Int8Array,["sint8","snorm8"]],[Uint8Array,["uint8","unorm8"]],[Int16Array,["sint16","snorm16"]],[Uint16Array,["uint16","unorm16"]],[Int32Array,["sint32","snorm32"]],[Uint32Array,["uint32","unorm32"]],[Float32Array,["float32"]]]),JN=new Map([[pp,["float16"]]]),QN=new Map([[Int32Array,"sint32"],[Int16Array,"sint32"],[Uint32Array,"uint32"],[Uint16Array,"uint32"],[Float32Array,"float32"]]);class tP{constructor(t){this.backend=t}createAttribute(t,e){const n=this._getBufferAttribute(t),r=this.backend,i=r.get(n);let s=i.buffer;if(void 0===s){const o=r.device;let a=n.array;if(!1===t.normalized&&(a.constructor===Int16Array||a.constructor===Uint16Array)){const t=new Uint32Array(a.length);for(let e=0;e<a.length;e++)t[e]=a[e];a=t}if(n.array=a,(n.isStorageBufferAttribute||n.isStorageInstancedBufferAttribute)&&3===n.itemSize){a=new a.constructor(4*n.count);for(let t=0;t<n.count;t++)a.set(n.array.subarray(3*t,3*t+3),4*t);n.itemSize=4,n.array=a}const l=a.byteLength+(4-a.byteLength%4)%4;s=o.createBuffer({label:n.name,size:l,usage:e,mappedAtCreation:!0}),new a.constructor(s.getMappedRange()).set(a),s.unmap(),i.buffer=s}}updateAttribute(t){const e=this._getBufferAttribute(t),n=this.backend,r=n.device,i=n.get(e).buffer,s=e.array,o=e.updateRanges;if(0===o.length)r.queue.writeBuffer(i,0,s,0);else{for(let t=0,e=o.length;t<e;t++){const e=o[t];r.queue.writeBuffer(i,0,s,e.start*s.BYTES_PER_ELEMENT,e.count*s.BYTES_PER_ELEMENT)}e.clearUpdateRanges()}}createShaderVertexBuffers(t){const e=t.getAttributes(),n=new Map;for(let t=0;t<e.length;t++){const r=e[t],i=r.array.BYTES_PER_ELEMENT,s=this._getBufferAttribute(r);let o=n.get(s);if(void 0===o){let t,e;!0===r.isInterleavedBufferAttribute?(t=r.data.stride*i,e=r.data.isInstancedInterleavedBuffer?mA:fA):(t=r.itemSize*i,e=r.isInstancedBufferAttribute?mA:fA),!1!==r.normalized||r.array.constructor!==Int16Array&&r.array.constructor!==Uint16Array||(t=4),o={arrayStride:t,attributes:[],stepMode:e},n.set(s,o)}const a=this._getVertexFormat(r),l=!0===r.isInterleavedBufferAttribute?r.offset*i:0;o.attributes.push({shaderLocation:t,offset:l,format:a})}return Array.from(n.values())}destroyAttribute(t){const e=this.backend;e.get(this._getBufferAttribute(t)).buffer.destroy(),e.delete(t)}async getArrayBufferAsync(t){const e=this.backend,n=e.device,r=e.get(this._getBufferAttribute(t)).buffer,i=r.size,s=n.createBuffer({label:t.name,size:i,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ}),o=n.createCommandEncoder({});o.copyBufferToBuffer(r,0,s,0,i),s.unmap();const a=o.finish();n.queue.submit([a]),await s.mapAsync(GPUMapMode.READ);return s.getMappedRange()}_getVertexFormat(t){const{itemSize:e,normalized:n}=t,r=t.array.constructor,i=t.constructor;let s;if(1==e)s=QN.get(r);else{const t=(JN.get(i)||KN.get(r))[n?1:0];if(t){const n=r.BYTES_PER_ELEMENT*e,i=4*Math.floor((n+3)/4)/r.BYTES_PER_ELEMENT;if(i%1)throw new Error("THREE.WebGPUAttributeUtils: Bad vertex format item size.");s=`${t}x${i}`}}return s||console.error("THREE.WebGPUAttributeUtils: Vertex format not supported yet."),s}_getBufferAttribute(t){return t.isInterleavedBufferAttribute&&(t=t.data),t}}class eP{constructor(t){this.backend=t,this.bindGroupLayoutCache=new WeakMap}createBindingsLayout(t){const e=this.backend.device,n=[];let r=0;for(const e of t.bindings){const t={binding:r++,visibility:e.visibility};if(e.isUniformBuffer||e.isStorageBuffer){const n={};e.isStorageBuffer&&(n.type=e.access),t.buffer=n}else if(e.isSampler){const n={};e.texture.isDepthTexture&&null!==e.texture.compareFunction&&(n.type="comparison"),t.sampler=n}else if(e.isSampledTexture&&e.texture.isVideoTexture)t.externalTexture={};else if(e.isSampledTexture&&e.store){const n=this.backend.get(e.texture).texture.format,r=e.access;t.storageTexture={format:n,access:r}}else if(e.isSampledTexture){const n={};if(!0===e.texture.isMultisampleRenderTargetTexture&&(n.multisampled=!0),e.texture.isDepthTexture)n.sampleType=iA;else if(e.texture.isDataTexture||e.texture.isDataArrayTexture||e.texture.isData3DTexture){const t=e.texture.type;t===Ku?n.sampleType=sA:t===Ju?n.sampleType=oA:t===Qu&&(this.backend.hasFeature("float32-filterable")?n.sampleType=nA:n.sampleType=rA)}e.isSampledCubeTexture?n.viewDimension=hA:e.texture.isDataArrayTexture||e.texture.isCompressedArrayTexture?n.viewDimension=cA:e.isSampledTexture3D&&(n.viewDimension=dA),t.texture=n}else console.error(`WebGPUBindingUtils: Unsupported binding "${e}".`);n.push(t)}return e.createBindGroupLayout({entries:n})}createBindings(t){const{backend:e,bindGroupLayoutCache:n}=this,r=e.get(t);let i=n.get(t.bindingsReference);void 0===i&&(i=this.createBindingsLayout(t),n.set(t.bindingsReference,i));const s=this.createBindGroup(t,i);r.layout=i,r.group=s}updateBinding(t){const e=this.backend,n=e.device,r=t.buffer,i=e.get(t).buffer;n.queue.writeBuffer(i,0,r,0)}createBindGroup(t,e){const n=this.backend,r=n.device;let i=0;const s=[];for(const e of t.bindings){if(e.isUniformBuffer){const t=n.get(e);if(void 0===t.buffer){const n=e.byteLength,i=GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST,s=r.createBuffer({label:"bindingBuffer_"+e.name,size:n,usage:i});t.buffer=s}s.push({binding:i,resource:{buffer:t.buffer}})}else if(e.isStorageBuffer){const t=n.get(e);if(void 0===t.buffer){const r=e.attribute;t.buffer=n.get(r).buffer}s.push({binding:i,resource:{buffer:t.buffer}})}else if(e.isSampler){const t=n.get(e.texture);s.push({binding:i,resource:t.sampler})}else if(e.isSampledTexture){const t=n.get(e.texture);let o;if(void 0!==t.externalTexture)o=r.importExternalTexture({source:t.externalTexture});else{const n=e.store?1:t.texture.mipLevelCount,r=`view-${t.texture.width}-${t.texture.height}-${n}`;if(o=t[r],void 0===o){const i=pA;let s;s=e.isSampledCubeTexture?hA:e.isSampledTexture3D?dA:e.texture.isDataArrayTexture||e.texture.isCompressedArrayTexture?cA:uA,o=t[r]=t.texture.createView({aspect:i,dimension:s,mipLevelCount:n})}}s.push({binding:i,resource:o})}i++}return r.createBindGroup({label:"bindGroup_"+t.name,layout:e,entries:s})}}class nP{constructor(t){this.backend=t}_getSampleCount(t){return this.backend.utils.getSampleCountRenderContext(t)}createRenderPipeline(t,e){const{object:n,material:r,geometry:i,pipeline:s}=t,{vertexProgram:o,fragmentProgram:a}=s,l=this.backend,u=l.device,c=l.utils,h=l.get(s),d=[];for(const e of t.getBindings()){const t=l.get(e);d.push(t.layout)}const p=l.attributeUtils.createShaderVertexBuffers(t);let f;!0===r.transparent&&0!==r.blending&&(f=this._getBlending(r));let m={};!0===r.stencilWrite&&(m={compare:this._getStencilCompare(r),failOp:this._getStencilOperation(r.stencilFail),depthFailOp:this._getStencilOperation(r.stencilZFail),passOp:this._getStencilOperation(r.stencilZPass)});const g=this._getColorWriteMask(r),v=[];if(null!==t.context.textures){const e=t.context.textures;for(let t=0;t<e.length;t++){const n=c.getTextureFormatGPU(e[t]);v.push({format:n,blend:f,writeMask:g})}}else{const e=c.getCurrentColorFormat(t.context);v.push({format:e,blend:f,writeMask:g})}const y=l.get(o).module,_=l.get(a).module,x=this._getPrimitiveState(n,i,r),b=this._getDepthCompare(r),w=c.getCurrentDepthStencilFormat(t.context),S=this._getSampleCount(t.context),M={label:`renderPipeline_${r.name||r.type}_${r.id}`,vertex:Object.assign({},y,{buffers:p}),fragment:Object.assign({},_,{targets:v}),primitive:x,multisample:{count:S,alphaToCoverageEnabled:r.alphaToCoverage&&S>1},layout:u.createPipelineLayout({bindGroupLayouts:d})},E={},T=t.context.depth,A=t.context.stencil;if(!0!==T&&!0!==A||(!0===T&&(E.format=w,E.depthWriteEnabled=r.depthWrite,E.depthCompare=b),!0===A&&(E.stencilFront=m,E.stencilBack={},E.stencilReadMask=r.stencilFuncMask,E.stencilWriteMask=r.stencilWriteMask),M.depthStencil=E),null===e)h.pipeline=u.createRenderPipeline(M);else{const t=new Promise((t=>{u.createRenderPipelineAsync(M).then((e=>{h.pipeline=e,t()}))}));e.push(t)}}createBundleEncoder(t){const e=this.backend,{utils:n,device:r}=e,i=n.getCurrentDepthStencilFormat(t),s={label:"renderBundleEncoder",colorFormats:[n.getCurrentColorFormat(t)],depthStencilFormat:i,sampleCount:this._getSampleCount(t)};return r.createRenderBundleEncoder(s)}createComputePipeline(t,e){const n=this.backend,r=n.device,i=n.get(t.computeProgram).module,s=n.get(t),o=[];for(const t of e){const e=n.get(t);o.push(e.layout)}s.pipeline=r.createComputePipeline({compute:i,layout:r.createPipelineLayout({bindGroupLayouts:o})})}_getBlending(t){let e,n;const r=t.blending,i=t.blendSrc,s=t.blendDst,o=t.blendEquation;if(5===r){const r=null!==t.blendSrcAlpha?t.blendSrcAlpha:i,a=null!==t.blendDstAlpha?t.blendDstAlpha:s,l=null!==t.blendEquationAlpha?t.blendEquationAlpha:o;e={srcFactor:this._getBlendFactor(i),dstFactor:this._getBlendFactor(s),operation:this._getBlendOperation(o)},n={srcFactor:this._getBlendFactor(r),dstFactor:this._getBlendFactor(a),operation:this._getBlendOperation(l)}}else{const i=(t,r,i,s)=>{e={srcFactor:t,dstFactor:r,operation:kT},n={srcFactor:i,dstFactor:s,operation:kT}};if(t.premultipliedAlpha)switch(r){case 1:i(ET,RT,ET,RT);break;case 2:i(ET,ET,ET,ET);break;case 3:i(MT,AT,MT,ET);break;case 4:i(MT,TT,MT,CT)}else switch(r){case 1:i(CT,RT,ET,RT);break;case 2:i(CT,ET,CT,ET);break;case 3:i(MT,AT,MT,ET);break;case 4:i(MT,TT,MT,TT)}}if(void 0!==e&&void 0!==n)return{color:e,alpha:n};console.error("THREE.WebGPURenderer: Invalid blending: ",r)}_getBlendFactor(t){let e;switch(t){case 200:e=MT;break;case 201:e=ET;break;case 202:e=TT;break;case 203:e=AT;break;case Nu:e=CT;break;case Pu:e=RT;break;case 208:e=NT;break;case 209:e=PT;break;case 206:e=IT;break;case 207:e=OT;break;case 210:e=DT;break;case 211:e=LT;break;case 212:e=UT;break;default:console.error("THREE.WebGPURenderer: Blend factor not supported.",t)}return e}_getStencilCompare(t){let e;const n=t.stencilFunc;switch(n){case 512:e=eT;break;case 519:e=lT;break;case 513:e=nT;break;case 515:e=iT;break;case 514:e=rT;break;case 518:e=aT;break;case 516:e=sT;break;case 517:e=oT;break;default:console.error("THREE.WebGPURenderer: Invalid stencil function.",n)}return e}_getStencilOperation(t){let e;switch(t){case jc:e=HT;break;case 0:e=WT;break;case 7681:e=qT;break;case 5386:e=XT;break;case 7682:e=ZT;break;case 7683:e=$T;break;case 34055:e=YT;break;case 34056:e=KT;break;default:console.error("THREE.WebGPURenderer: Invalid stencil operation.",e)}return e}_getBlendOperation(t){let e;switch(t){case Ru:e=kT;break;case 101:e=BT;break;case 102:e=FT;break;case 103:e=zT;break;case 104:e=VT;break;default:console.error("THREE.WebGPUPipelineUtils: Blend equation not supported.",t)}return e}_getPrimitiveState(t,e,n){const r={},i=this.backend.utils;switch(r.topology=i.getPrimitiveTopology(t,n),null!==e.index&&!0===t.isLine&&!0!==t.isLineSegments&&(r.stripIndexFormat=e.index.array instanceof Uint16Array?gT:vT),n.side){case 0:r.frontFace=dT,r.cullMode=mT;break;case 1:r.frontFace=dT,r.cullMode=fT;break;case 2:r.frontFace=dT,r.cullMode=pT;break;default:console.error("THREE.WebGPUPipelineUtils: Unknown material.side value.",n.side)}return r}_getColorWriteMask(t){return!0===t.colorWrite?jT:GT}_getDepthCompare(t){let e;if(!1===t.depthTest)e=lT;else{const n=t.depthFunc;switch(n){case 0:e=eT;break;case 1:e=lT;break;case 2:e=nT;break;case 3:e=iT;break;case 4:e=rT;break;case 5:e=aT;break;case 6:e=sT;break;case 7:e=oT;break;default:console.error("THREE.WebGPUPipelineUtils: Invalid depth function.",n)}}return e}}class rP extends aN{constructor(t={}){super(t),this.isWebGPUBackend=!0,this.parameters.alpha=void 0===t.alpha||t.alpha,this.parameters.requiredLimits=void 0===t.requiredLimits?{}:t.requiredLimits,this.trackTimestamp=!0===t.trackTimestamp,this.device=null,this.context=null,this.colorBuffer=null,this.defaultRenderPassdescriptor=null,this.utils=new YN(this),this.attributeUtils=new tP(this),this.bindingUtils=new eP(this),this.pipelineUtils=new nP(this),this.textureUtils=new DN(this),this.occludedResolveCache=new Map}async init(t){await super.init(t);const e=this.parameters;let n;if(void 0===e.device){const t={powerPreference:e.powerPreference},r=await navigator.gpu.requestAdapter(t);if(null===r)throw new Error("WebGPUBackend: Unable to create WebGPU adapter.");const i=Object.values(gA),s=[];for(const t of i)r.features.has(t)&&s.push(t);const o={requiredFeatures:s,requiredLimits:e.requiredLimits};n=await r.requestDevice(o)}else n=e.device;n.lost.then((e=>{const n={api:"WebGPU",message:e.message||"Unknown reason",reason:e.reason||null,originalEvent:e};t.onDeviceLost(n)}));const r=void 0!==e.context?e.context:t.domElement.getContext("webgpu");this.device=n,this.context=r;const i=e.alpha?"premultiplied":"opaque";this.trackTimestamp=this.trackTimestamp&&this.hasFeature(gA.TimestampQuery),this.context.configure({device:this.device,format:this.utils.getPreferredCanvasFormat(),usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.COPY_SRC,alphaMode:i}),this.updateSize()}get coordinateSystem(){return Xc}async getArrayBufferAsync(t){return await this.attributeUtils.getArrayBufferAsync(t)}getContext(){return this.context}_getDefaultRenderPassDescriptor(){let t=this.defaultRenderPassdescriptor;if(null===t){const e=this.renderer;t={colorAttachments:[{view:null}]},!0!==this.renderer.depth&&!0!==this.renderer.stencil||(t.depthStencilAttachment={view:this.textureUtils.getDepthBuffer(e.depth,e.stencil).createView()});const n=t.colorAttachments[0];this.renderer.samples>0?n.view=this.colorBuffer.createView():n.resolveTarget=void 0,this.defaultRenderPassdescriptor=t}const e=t.colorAttachments[0];return this.renderer.samples>0?e.resolveTarget=this.context.getCurrentTexture().createView():e.view=this.context.getCurrentTexture().createView(),t}_getRenderPassDescriptor(t){const e=t.renderTarget,n=this.get(e);let r=n.descriptors;if(void 0===r||n.width!==e.width||n.height!==e.height||n.activeMipmapLevel!==e.activeMipmapLevel||n.samples!==e.samples){r={},n.descriptors=r;const t=()=>{e.removeEventListener("dispose",t),this.delete(e)};e.addEventListener("dispose",t)}const i=t.getCacheKey();let s=r[i];if(void 0===s){const o=t.textures,a=[];for(let e=0;e<o.length;e++){const n=this.get(o[e]),r=n.texture.createView({baseMipLevel:t.activeMipmapLevel,mipLevelCount:1,baseArrayLayer:t.activeCubeFace,dimension:uA});let i,s;void 0!==n.msaaTexture?(i=n.msaaTexture.createView(),s=r):(i=r,s=void 0),a.push({view:i,resolveTarget:s,loadOp:cT,storeOp:uT})}if(s={colorAttachments:a},t.depth){const e={view:this.get(t.depthTexture).texture.createView()};s.depthStencilAttachment=e}r[i]=s,n.width=e.width,n.height=e.height,n.samples=e.samples,n.activeMipmapLevel=e.activeMipmapLevel}return s}beginRender(t){const e=this.get(t),n=this.device,r=t.occlusionQueryCount;let i,s;r>0&&(e.currentOcclusionQuerySet&&e.currentOcclusionQuerySet.destroy(),e.currentOcclusionQueryBuffer&&e.currentOcclusionQueryBuffer.destroy(),e.currentOcclusionQuerySet=e.occlusionQuerySet,e.currentOcclusionQueryBuffer=e.occlusionQueryBuffer,e.currentOcclusionQueryObjects=e.occlusionQueryObjects,i=n.createQuerySet({type:"occlusion",count:r}),e.occlusionQuerySet=i,e.occlusionQueryIndex=0,e.occlusionQueryObjects=new Array(r),e.lastOcclusionObject=null),s=null===t.textures?this._getDefaultRenderPassDescriptor():this._getRenderPassDescriptor(t),this.initTimestampQuery(t,s),s.occlusionQuerySet=i;const o=s.depthStencilAttachment;if(null!==t.textures){const e=s.colorAttachments;for(let n=0;n<e.length;n++){const r=e[n];t.clearColor?(r.clearValue=0===n?t.clearColorValue:{r:0,g:0,b:0,a:1},r.loadOp=hT,r.storeOp=uT):(r.loadOp=cT,r.storeOp=uT)}}else{const e=s.colorAttachments[0];t.clearColor?(e.clearValue=t.clearColorValue,e.loadOp=hT,e.storeOp=uT):(e.loadOp=cT,e.storeOp=uT)}t.depth&&(t.clearDepth?(o.depthClearValue=t.clearDepthValue,o.depthLoadOp=hT,o.depthStoreOp=uT):(o.depthLoadOp=cT,o.depthStoreOp=uT)),t.stencil&&(t.clearStencil?(o.stencilClearValue=t.clearStencilValue,o.stencilLoadOp=hT,o.stencilStoreOp=uT):(o.stencilLoadOp=cT,o.stencilStoreOp=uT));const a=n.createCommandEncoder({label:"renderContext_"+t.id}),l=a.beginRenderPass(s);if(e.descriptor=s,e.encoder=a,e.currentPass=l,e.currentSets={attributes:{},bindingGroups:[],pipeline:null,index:null},e.renderBundles=[],t.viewport&&this.updateViewport(t),t.scissor){const{x:e,y:n,width:r,height:i}=t.scissorValue;l.setScissorRect(e,n,r,i)}}finishRender(t){const e=this.get(t),n=t.occlusionQueryCount;if(e.renderBundles.length>0&&e.currentPass.executeBundles(e.renderBundles),n>e.occlusionQueryIndex&&e.currentPass.endOcclusionQuery(),e.currentPass.end(),n>0){const r=8*n;let i=this.occludedResolveCache.get(r);void 0===i&&(i=this.device.createBuffer({size:r,usage:GPUBufferUsage.QUERY_RESOLVE|GPUBufferUsage.COPY_SRC}),this.occludedResolveCache.set(r,i));const s=this.device.createBuffer({size:r,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ});e.encoder.resolveQuerySet(e.occlusionQuerySet,0,n,i,0),e.encoder.copyBufferToBuffer(i,0,s,0,r),e.occlusionQueryBuffer=s,this.resolveOccludedAsync(t)}if(this.prepareTimestampBuffer(t,e.encoder),this.device.queue.submit([e.encoder.finish()]),null!==t.textures){const e=t.textures;for(let t=0;t<e.length;t++){const n=e[t];!0===n.generateMipmaps&&this.textureUtils.generateMipmaps(n)}}}isOccluded(t,e){const n=this.get(t);return n.occluded&&n.occluded.has(e)}async resolveOccludedAsync(t){const e=this.get(t),{currentOcclusionQueryBuffer:n,currentOcclusionQueryObjects:r}=e;if(n&&r){const t=new WeakSet;e.currentOcclusionQueryObjects=null,e.currentOcclusionQueryBuffer=null,await n.mapAsync(GPUMapMode.READ);const i=n.getMappedRange(),s=new BigUint64Array(i);for(let e=0;e<r.length;e++)s[e]!==BigInt(0)&&t.add(r[e]);n.destroy(),e.occluded=t}}updateViewport(t){const{currentPass:e}=this.get(t),{x:n,y:r,width:i,height:s,minDepth:o,maxDepth:a}=t.viewportValue;e.setViewport(n,r,i,s,o,a)}clear(t,e,n,r=null){const i=this.device,s=this.renderer;let o,a,l,u,c=[];if(t){const t=this.getClearColor();if(!0===this.renderer.alpha){const e=t.a;a={r:t.r*e,g:t.g*e,b:t.b*e,a:e}}else a={r:t.r,g:t.g,b:t.b,a:t.a}}if(null===r){l=s.depth,u=s.stencil;const e=this._getDefaultRenderPassDescriptor();if(t){c=e.colorAttachments;const t=c[0];t.clearValue=a,t.loadOp=hT,t.storeOp=uT}(l||u)&&(o=e.depthStencilAttachment)}else{if(l=r.depth,u=r.stencil,t)for(const t of r.textures){const e=this.get(t),n=e.texture.createView();let r,i;void 0!==e.msaaTexture?(r=e.msaaTexture.createView(),i=n):(r=n,i=void 0),c.push({view:r,resolveTarget:i,clearValue:a,loadOp:hT,storeOp:uT})}if(l||u){o={view:this.get(r.depthTexture).texture.createView()}}}l&&(e?(o.depthLoadOp=hT,o.depthClearValue=s.getClearDepth(),o.depthStoreOp=uT):(o.depthLoadOp=cT,o.depthStoreOp=uT)),u&&(n?(o.stencilLoadOp=hT,o.stencilClearValue=s.getClearStencil(),o.stencilStoreOp=uT):(o.stencilLoadOp=cT,o.stencilStoreOp=uT));const h=i.createCommandEncoder({});h.beginRenderPass({colorAttachments:c,depthStencilAttachment:o}).end(),i.queue.submit([h.finish()])}beginCompute(t){const e=this.get(t),n={};this.initTimestampQuery(t,n),e.cmdEncoderGPU=this.device.createCommandEncoder(),e.passEncoderGPU=e.cmdEncoderGPU.beginComputePass(n)}compute(t,e,n,r){const{passEncoderGPU:i}=this.get(t),s=this.get(r).pipeline;i.setPipeline(s);for(let t=0,e=n.length;t<e;t++){const e=n[t],r=this.get(e);i.setBindGroup(t,r.group)}const o=this.device.limits.maxComputeWorkgroupsPerDimension,a=this.get(e);void 0===a.dispatchSize&&(a.dispatchSize={x:0,y:1,z:1});const{dispatchSize:l}=a;e.dispatchCount>o?(l.x=Math.min(e.dispatchCount,o),l.y=Math.ceil(e.dispatchCount/o)):l.x=e.dispatchCount,i.dispatchWorkgroups(l.x,l.y,l.z)}finishCompute(t){const e=this.get(t);e.passEncoderGPU.end(),this.prepareTimestampBuffer(t,e.cmdEncoderGPU),this.device.queue.submit([e.cmdEncoderGPU.finish()])}async waitForGPU(){await this.device.queue.onSubmittedWorkDone()}draw(t,e){const{object:n,context:r,pipeline:i}=t,s=t.getBindings(),o=this.get(r),a=this.get(i).pipeline,l=o.currentSets,u=o.currentPass,c=t.getDrawParameters();if(null===c)return;l.pipeline!==a&&(u.setPipeline(a),l.pipeline=a);const h=l.bindingGroups;for(let t=0,e=s.length;t<e;t++){const e=s[t],n=this.get(e);h[e.index]!==e.id&&(u.setBindGroup(e.index,n.group),h[e.index]=e.id)}const d=t.getIndex(),p=null!==d;if(!0===p&&l.index!==d){const t=this.get(d).buffer,e=d.array instanceof Uint16Array?gT:vT;u.setIndexBuffer(t,e),l.index=d}const f=t.getVertexBuffers();for(let t=0,e=f.length;t<e;t++){const e=f[t];if(l.attributes[t]!==e){const n=this.get(e).buffer;u.setVertexBuffer(t,n),l.attributes[t]=e}}if(void 0!==o.occlusionQuerySet){const t=o.lastOcclusionObject;t!==n&&(null!==t&&!0===t.occlusionTest&&(u.endOcclusionQuery(),o.occlusionQueryIndex++),!0===n.occlusionTest&&(u.beginOcclusionQuery(o.occlusionQueryIndex),o.occlusionQueryObjects[o.occlusionQueryIndex]=n),o.lastOcclusionObject=n)}if(!0===n.isBatchedMesh){const t=n._multiDrawStarts,e=n._multiDrawCounts,r=n._multiDrawCount,i=n._multiDrawInstances,s=p?d.array.BYTES_PER_ELEMENT:1;for(let n=0;n<r;n++){const r=i?i[n]:1,o=r>1?0:n;u.drawIndexed(e[n],r,t[n]/s,0,o)}}else if(!0===p){const{vertexCount:r,instanceCount:i,firstVertex:s}=c,o=t.getIndirect();if(null!==o){const t=this.get(o).buffer;u.drawIndexedIndirect(t,0)}else u.drawIndexed(r,i,s,0,0);e.update(n,r,i)}else{const{vertexCount:r,instanceCount:i,firstVertex:s}=c,o=t.getIndirect();if(null!==o){const t=this.get(o).buffer;u.drawIndirect(t,0)}else u.draw(r,i,s,0);e.update(n,r,i)}}needsRenderUpdate(t){const e=this.get(t),{object:n,material:r}=t,i=this.utils,s=i.getSampleCountRenderContext(t.context),o=i.getCurrentColorSpace(t.context),a=i.getCurrentColorFormat(t.context),l=i.getCurrentDepthStencilFormat(t.context),u=i.getPrimitiveTopology(n,r);let c=!1;return e.material===r&&e.materialVersion===r.version&&e.transparent===r.transparent&&e.blending===r.blending&&e.premultipliedAlpha===r.premultipliedAlpha&&e.blendSrc===r.blendSrc&&e.blendDst===r.blendDst&&e.blendEquation===r.blendEquation&&e.blendSrcAlpha===r.blendSrcAlpha&&e.blendDstAlpha===r.blendDstAlpha&&e.blendEquationAlpha===r.blendEquationAlpha&&e.colorWrite===r.colorWrite&&e.depthWrite===r.depthWrite&&e.depthTest===r.depthTest&&e.depthFunc===r.depthFunc&&e.stencilWrite===r.stencilWrite&&e.stencilFunc===r.stencilFunc&&e.stencilFail===r.stencilFail&&e.stencilZFail===r.stencilZFail&&e.stencilZPass===r.stencilZPass&&e.stencilFuncMask===r.stencilFuncMask&&e.stencilWriteMask===r.stencilWriteMask&&e.side===r.side&&e.alphaToCoverage===r.alphaToCoverage&&e.sampleCount===s&&e.colorSpace===o&&e.colorFormat===a&&e.depthStencilFormat===l&&e.primitiveTopology===u&&e.clippingContextCacheKey===t.clippingContext.cacheKey||(e.material=r,e.materialVersion=r.version,e.transparent=r.transparent,e.blending=r.blending,e.premultipliedAlpha=r.premultipliedAlpha,e.blendSrc=r.blendSrc,e.blendDst=r.blendDst,e.blendEquation=r.blendEquation,e.blendSrcAlpha=r.blendSrcAlpha,e.blendDstAlpha=r.blendDstAlpha,e.blendEquationAlpha=r.blendEquationAlpha,e.colorWrite=r.colorWrite,e.depthWrite=r.depthWrite,e.depthTest=r.depthTest,e.depthFunc=r.depthFunc,e.stencilWrite=r.stencilWrite,e.stencilFunc=r.stencilFunc,e.stencilFail=r.stencilFail,e.stencilZFail=r.stencilZFail,e.stencilZPass=r.stencilZPass,e.stencilFuncMask=r.stencilFuncMask,e.stencilWriteMask=r.stencilWriteMask,e.side=r.side,e.alphaToCoverage=r.alphaToCoverage,e.sampleCount=s,e.colorSpace=o,e.colorFormat=a,e.depthStencilFormat=l,e.primitiveTopology=u,e.clippingContextCacheKey=t.clippingContext.cacheKey,c=!0),c}getRenderCacheKey(t){const{object:e,material:n}=t,r=this.utils,i=t.context;return[n.transparent,n.blending,n.premultipliedAlpha,n.blendSrc,n.blendDst,n.blendEquation,n.blendSrcAlpha,n.blendDstAlpha,n.blendEquationAlpha,n.colorWrite,n.depthWrite,n.depthTest,n.depthFunc,n.stencilWrite,n.stencilFunc,n.stencilFail,n.stencilZFail,n.stencilZPass,n.stencilFuncMask,n.stencilWriteMask,n.side,r.getSampleCountRenderContext(i),r.getCurrentColorSpace(i),r.getCurrentColorFormat(i),r.getCurrentDepthStencilFormat(i),r.getPrimitiveTopology(e,n),t.getGeometryCacheKey(),t.clippingContext.cacheKey].join()}createSampler(t){this.textureUtils.createSampler(t)}destroySampler(t){this.textureUtils.destroySampler(t)}createDefaultTexture(t){this.textureUtils.createDefaultTexture(t)}createTexture(t,e){this.textureUtils.createTexture(t,e)}updateTexture(t,e){this.textureUtils.updateTexture(t,e)}generateMipmaps(t){this.textureUtils.generateMipmaps(t)}destroyTexture(t){this.textureUtils.destroyTexture(t)}copyTextureToBuffer(t,e,n,r,i,s){return this.textureUtils.copyTextureToBuffer(t,e,n,r,i,s)}initTimestampQuery(t,e){if(!this.trackTimestamp)return;const n=this.get(t);if(!n.timeStampQuerySet){const t=this.device.createQuerySet({type:"timestamp",count:2}),r={querySet:t,beginningOfPassWriteIndex:0,endOfPassWriteIndex:1};Object.assign(e,{timestampWrites:r}),n.timeStampQuerySet=t}}prepareTimestampBuffer(t,e){if(!this.trackTimestamp)return;const n=this.get(t),r=2*BigInt64Array.BYTES_PER_ELEMENT;void 0===n.currentTimestampQueryBuffers&&(n.currentTimestampQueryBuffers={resolveBuffer:this.device.createBuffer({label:"timestamp resolve buffer",size:r,usage:GPUBufferUsage.QUERY_RESOLVE|GPUBufferUsage.COPY_SRC}),resultBuffer:this.device.createBuffer({label:"timestamp result buffer",size:r,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ}),isMappingPending:!1});const{resolveBuffer:i,resultBuffer:s,isMappingPending:o}=n.currentTimestampQueryBuffers;!0!==o&&(e.resolveQuerySet(n.timeStampQuerySet,0,2,i,0),e.copyBufferToBuffer(i,0,s,0,r))}async resolveTimestampAsync(t,e="render"){if(!this.trackTimestamp)return;const n=this.get(t);if(void 0===n.currentTimestampQueryBuffers)return;const{resultBuffer:r,isMappingPending:i}=n.currentTimestampQueryBuffers;!0!==i&&(n.currentTimestampQueryBuffers.isMappingPending=!0,r.mapAsync(GPUMapMode.READ).then((()=>{const t=new BigUint64Array(r.getMappedRange()),i=Number(t[1]-t[0])/1e6;this.renderer.info.updateTimestamp(e,i),r.unmap(),n.currentTimestampQueryBuffers.isMappingPending=!1})))}createNodeBuilder(t,e){return new $N(t,e)}createProgram(t){this.get(t).module={module:this.device.createShaderModule({code:t.code,label:t.stage}),entryPoint:"main"}}destroyProgram(t){this.delete(t)}createRenderPipeline(t,e){this.pipelineUtils.createRenderPipeline(t,e)}createComputePipeline(t,e){this.pipelineUtils.createComputePipeline(t,e)}beginBundle(t){const e=this.get(t);e._currentPass=e.currentPass,e._currentSets=e.currentSets,e.currentSets={attributes:{},bindingGroups:[],pipeline:null,index:null},e.currentPass=this.pipelineUtils.createBundleEncoder(t)}finishBundle(t,e){const n=this.get(t),r=n.currentPass.finish();this.get(e).bundleGPU=r,n.currentSets=n._currentSets,n.currentPass=n._currentPass}addBundle(t,e){this.get(t).renderBundles.push(this.get(e).bundleGPU)}createBindings(t){this.bindingUtils.createBindings(t)}updateBindings(t){this.bindingUtils.createBindings(t)}updateBinding(t){this.bindingUtils.updateBinding(t)}createIndexAttribute(t){this.attributeUtils.createAttribute(t,GPUBufferUsage.INDEX|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST)}createAttribute(t){this.attributeUtils.createAttribute(t,GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST)}createStorageAttribute(t){this.attributeUtils.createAttribute(t,GPUBufferUsage.STORAGE|GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST)}createIndirectStorageAttribute(t){this.attributeUtils.createAttribute(t,GPUBufferUsage.STORAGE|GPUBufferUsage.INDIRECT|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST)}updateAttribute(t){this.attributeUtils.updateAttribute(t)}destroyAttribute(t){this.attributeUtils.destroyAttribute(t)}updateSize(){this.colorBuffer=this.textureUtils.getColorBuffer(),this.defaultRenderPassdescriptor=null}getMaxAnisotropy(){return 16}hasFeature(t){return this.device.features.has(t)}copyTextureToTexture(t,e,n=null,r=null,i=0){let s=0,o=0,a=0,l=0,u=0,c=0,h=t.image.width,d=t.image.height;null!==n&&(l=n.x,u=n.y,c=n.z||0,h=n.width,d=n.height),null!==r&&(s=r.x,o=r.y,a=r.z||0);const p=this.device.createCommandEncoder({label:"copyTextureToTexture_"+t.id+"_"+e.id}),f=this.get(t).texture,m=this.get(e).texture;p.copyTextureToTexture({texture:f,mipLevel:i,origin:{x:l,y:u,z:c}},{texture:m,mipLevel:i,origin:{x:s,y:o,z:a}},[h,d,1]),this.device.queue.submit([p.finish()])}copyFramebufferToTexture(t,e,n){const r=this.get(e);let i=null;i=e.renderTarget?t.isDepthTexture?this.get(e.depthTexture).texture:this.get(e.textures[0]).texture:t.isDepthTexture?this.textureUtils.getDepthBuffer(e.depth,e.stencil):this.context.getCurrentTexture();const s=this.get(t).texture;if(i.format!==s.format)return void console.error("WebGPUBackend: copyFramebufferToTexture: Source and destination formats do not match.",i.format,s.format);let o;if(r.currentPass?(r.currentPass.end(),o=r.encoder):o=this.device.createCommandEncoder({label:"copyFramebufferToTexture_"+t.id}),o.copyTextureToTexture({texture:i,origin:{x:n.x,y:n.y,z:0}},{texture:s},[n.z,n.w]),t.generateMipmaps&&this.textureUtils.generateMipmaps(t),r.currentPass){const{descriptor:t}=r;for(let e=0;e<t.colorAttachments.length;e++)t.colorAttachments[e].loadOp=cT;e.depth&&(t.depthStencilAttachment.depthLoadOp=cT),e.stencil&&(t.depthStencilAttachment.stencilLoadOp=cT),r.currentPass=o.beginRenderPass(t),r.currentSets={attributes:{},bindingGroups:[],pipeline:null,index:null}}else this.device.queue.submit([o.finish()])}}class iP extends Xf{constructor(t,e,n,r,i,s){super(t,e,n,r,i,s),this.iesMap=null}copy(t,e){return super.copy(t,e),this.iesMap=t.iesMap,this}}class sP extends NR{constructor(){super(),this.addMaterial(dS,vf),this.addMaterial(IM,mf),this.addMaterial(DM,gf),this.addMaterial(BM,yf),this.addMaterial(rS,rp),this.addMaterial(cS,xf),this.addMaterial(jw,_f),this.addMaterial(GM,bf),this.addMaterial(Fw,uf),this.addMaterial(Vw,wf),this.addMaterial(HM,cf),this.addMaterial(ZM,Jp),this.addMaterial(KM,ff),this.addLight(aC,Jf),this.addLight(uR,em),this.addLight(pR,rm),this.addLight(fR,Xf),this.addLight(gR,nm),this.addLight(vR,Vf),this.addLight(yR,sm),this.addLight(mR,iP),this.addToneMapping(bA,1),this.addToneMapping(wA,2),this.addToneMapping(SA,3),this.addToneMapping(EA,4),this.addToneMapping(RA,6),this.addToneMapping(NA,7)}}class oP extends FR{constructor(t={}){let e;t.forceWebGL?e=EN:(e=rP,t.getFallback=()=>(console.warn("THREE.WebGPURenderer: WebGPU is not available, running under WebGL2 backend."),new EN(t)));super(new e(t),t),this.library=new sP,this.isWebGPURenderer=!0}}"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:Cu}})),"undefined"!=typeof window&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=Cu);const aP={type:"change"},lP={type:"start"},uP={type:"end"},cP=1e-6,hP=-1,dP=0,pP=1,fP=2,mP=3,gP=4,vP=new Xt,yP=new Xt,_P=new we,xP=new we,bP=new we,wP=new be,SP=new we,MP=new we,EP=new we,TP=new we;class AP extends rl{constructor(t,e=null){super(t,e),this.enabled=!0,this.screen={left:0,top:0,width:0,height:0},this.rotateSpeed=1,this.zoomSpeed=1.2,this.panSpeed=.3,this.noRotate=!1,this.noZoom=!1,this.noPan=!1,this.staticMoving=!1,this.dynamicDampingFactor=.2,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.keys=["KeyA","KeyS","KeyD"],this.mouseButtons={LEFT:i.ROTATE,MIDDLE:i.DOLLY,RIGHT:i.PAN},this.state=hP,this.keyState=hP,this.target=new we,this._lastPosition=new we,this._lastZoom=1,this._touchZoomDistanceStart=0,this._touchZoomDistanceEnd=0,this._lastAngle=0,this._eye=new we,this._movePrev=new Xt,this._moveCurr=new Xt,this._lastAxis=new we,this._zoomStart=new Xt,this._zoomEnd=new Xt,this._panStart=new Xt,this._panEnd=new Xt,this._pointers=[],this._pointerPositions={},this._onPointerMove=RP.bind(this),this._onPointerDown=CP.bind(this),this._onPointerUp=NP.bind(this),this._onPointerCancel=PP.bind(this),this._onContextMenu=BP.bind(this),this._onMouseWheel=kP.bind(this),this._onKeyDown=OP.bind(this),this._onKeyUp=IP.bind(this),this._onTouchStart=FP.bind(this),this._onTouchMove=zP.bind(this),this._onTouchEnd=VP.bind(this),this._onMouseDown=DP.bind(this),this._onMouseMove=LP.bind(this),this._onMouseUp=UP.bind(this),this._target0=this.target.clone(),this._position0=this.object.position.clone(),this._up0=this.object.up.clone(),this._zoom0=this.object.zoom,null!==e&&(this.connect(),this.handleResize()),this.update()}connect(){window.addEventListener("keydown",this._onKeyDown),window.addEventListener("keyup",this._onKeyUp),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointercancel",this._onPointerCancel),this.domElement.addEventListener("wheel",this._onMouseWheel,{passive:!1}),this.domElement.addEventListener("contextmenu",this._onContextMenu),this.domElement.style.touchAction="none"}disconnect(){window.removeEventListener("keydown",this._onKeyDown),window.removeEventListener("keyup",this._onKeyUp),this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.domElement.removeEventListener("pointercancel",this._onPointerCancel),this.domElement.removeEventListener("wheel",this._onMouseWheel),this.domElement.removeEventListener("contextmenu",this._onContextMenu),this.domElement.style.touchAction="auto"}dispose(){this.disconnect()}handleResize(){const t=this.domElement.getBoundingClientRect(),e=this.domElement.ownerDocument.documentElement;this.screen.left=t.left+window.pageXOffset-e.clientLeft,this.screen.top=t.top+window.pageYOffset-e.clientTop,this.screen.width=t.width,this.screen.height=t.height}update(){this._eye.subVectors(this.object.position,this.target),this.noRotate||this._rotateCamera(),this.noZoom||this._zoomCamera(),this.noPan||this._panCamera(),this.object.position.addVectors(this.target,this._eye),this.object.isPerspectiveCamera?(this._checkDistances(),this.object.lookAt(this.target),this._lastPosition.distanceToSquared(this.object.position)>cP&&(this.dispatchEvent(aP),this._lastPosition.copy(this.object.position))):this.object.isOrthographicCamera?(this.object.lookAt(this.target),(this._lastPosition.distanceToSquared(this.object.position)>cP||this._lastZoom!==this.object.zoom)&&(this.dispatchEvent(aP),this._lastPosition.copy(this.object.position),this._lastZoom=this.object.zoom)):console.warn("THREE.TrackballControls: Unsupported camera type.")}reset(){this.state=hP,this.keyState=hP,this.target.copy(this._target0),this.object.position.copy(this._position0),this.object.up.copy(this._up0),this.object.zoom=this._zoom0,this.object.updateProjectionMatrix(),this._eye.subVectors(this.object.position,this.target),this.object.lookAt(this.target),this.dispatchEvent(aP),this._lastPosition.copy(this.object.position),this._lastZoom=this.object.zoom}_panCamera(){if(yP.copy(this._panEnd).sub(this._panStart),yP.lengthSq()){if(this.object.isOrthographicCamera){const t=(this.object.right-this.object.left)/this.object.zoom/this.domElement.clientWidth,e=(this.object.top-this.object.bottom)/this.object.zoom/this.domElement.clientWidth;yP.x*=t,yP.y*=e}yP.multiplyScalar(this._eye.length()*this.panSpeed),xP.copy(this._eye).cross(this.object.up).setLength(yP.x),xP.add(_P.copy(this.object.up).setLength(yP.y)),this.object.position.add(xP),this.target.add(xP),this.staticMoving?this._panStart.copy(this._panEnd):this._panStart.add(yP.subVectors(this._panEnd,this._panStart).multiplyScalar(this.dynamicDampingFactor))}}_rotateCamera(){TP.set(this._moveCurr.x-this._movePrev.x,this._moveCurr.y-this._movePrev.y,0);let t=TP.length();t?(this._eye.copy(this.object.position).sub(this.target),SP.copy(this._eye).normalize(),MP.copy(this.object.up).normalize(),EP.crossVectors(MP,SP).normalize(),MP.setLength(this._moveCurr.y-this._movePrev.y),EP.setLength(this._moveCurr.x-this._movePrev.x),TP.copy(MP.add(EP)),bP.crossVectors(TP,this._eye).normalize(),t*=this.rotateSpeed,wP.setFromAxisAngle(bP,t),this._eye.applyQuaternion(wP),this.object.up.applyQuaternion(wP),this._lastAxis.copy(bP),this._lastAngle=t):!this.staticMoving&&this._lastAngle&&(this._lastAngle*=Math.sqrt(1-this.dynamicDampingFactor),this._eye.copy(this.object.position).sub(this.target),wP.setFromAxisAngle(this._lastAxis,this._lastAngle),this._eye.applyQuaternion(wP),this.object.up.applyQuaternion(wP)),this._movePrev.copy(this._moveCurr)}_zoomCamera(){let t;this.state===gP?(t=this._touchZoomDistanceStart/this._touchZoomDistanceEnd,this._touchZoomDistanceStart=this._touchZoomDistanceEnd,this.object.isPerspectiveCamera?this._eye.multiplyScalar(t):this.object.isOrthographicCamera?(this.object.zoom=qt.clamp(this.object.zoom/t,this.minZoom,this.maxZoom),this._lastZoom!==this.object.zoom&&this.object.updateProjectionMatrix()):console.warn("THREE.TrackballControls: Unsupported camera type")):(t=1+(this._zoomEnd.y-this._zoomStart.y)*this.zoomSpeed,1!==t&&t>0&&(this.object.isPerspectiveCamera?this._eye.multiplyScalar(t):this.object.isOrthographicCamera?(this.object.zoom=qt.clamp(this.object.zoom/t,this.minZoom,this.maxZoom),this._lastZoom!==this.object.zoom&&this.object.updateProjectionMatrix()):console.warn("THREE.TrackballControls: Unsupported camera type")),this.staticMoving?this._zoomStart.copy(this._zoomEnd):this._zoomStart.y+=(this._zoomEnd.y-this._zoomStart.y)*this.dynamicDampingFactor)}_getMouseOnScreen(t,e){return vP.set((t-this.screen.left)/this.screen.width,(e-this.screen.top)/this.screen.height),vP}_getMouseOnCircle(t,e){return vP.set((t-.5*this.screen.width-this.screen.left)/(.5*this.screen.width),(this.screen.height+2*(this.screen.top-e))/this.screen.width),vP}_addPointer(t){this._pointers.push(t)}_removePointer(t){delete this._pointerPositions[t.pointerId];for(let e=0;e<this._pointers.length;e++)if(this._pointers[e].pointerId==t.pointerId)return void this._pointers.splice(e,1)}_trackPointer(t){let e=this._pointerPositions[t.pointerId];void 0===e&&(e=new Xt,this._pointerPositions[t.pointerId]=e),e.set(t.pageX,t.pageY)}_getSecondPointerPosition(t){const e=t.pointerId===this._pointers[0].pointerId?this._pointers[1]:this._pointers[0];return this._pointerPositions[e.pointerId]}_checkDistances(){this.noZoom&&this.noPan||(this._eye.lengthSq()>this.maxDistance*this.maxDistance&&(this.object.position.addVectors(this.target,this._eye.setLength(this.maxDistance)),this._zoomStart.copy(this._zoomEnd)),this._eye.lengthSq()<this.minDistance*this.minDistance&&(this.object.position.addVectors(this.target,this._eye.setLength(this.minDistance)),this._zoomStart.copy(this._zoomEnd)))}}function CP(t){!1!==this.enabled&&(0===this._pointers.length&&(this.domElement.setPointerCapture(t.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),this.domElement.addEventListener("pointerup",this._onPointerUp)),this._addPointer(t),"touch"===t.pointerType?this._onTouchStart(t):this._onMouseDown(t))}function RP(t){!1!==this.enabled&&("touch"===t.pointerType?this._onTouchMove(t):this._onMouseMove(t))}function NP(t){!1!==this.enabled&&("touch"===t.pointerType?this._onTouchEnd(t):this._onMouseUp(),this._removePointer(t),0===this._pointers.length&&(this.domElement.releasePointerCapture(t.pointerId),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp)))}function PP(t){this._removePointer(t)}function IP(){!1!==this.enabled&&(this.keyState=hP,window.addEventListener("keydown",this._onKeyDown))}function OP(t){!1!==this.enabled&&(window.removeEventListener("keydown",this._onKeyDown),this.keyState===hP&&(t.code!==this.keys[dP]||this.noRotate?t.code!==this.keys[pP]||this.noZoom?t.code!==this.keys[fP]||this.noPan||(this.keyState=fP):this.keyState=pP:this.keyState=dP))}function DP(t){let e;switch(t.button){case 0:e=this.mouseButtons.LEFT;break;case 1:e=this.mouseButtons.MIDDLE;break;case 2:e=this.mouseButtons.RIGHT;break;default:e=-1}switch(e){case i.DOLLY:this.state=pP;break;case i.ROTATE:this.state=dP;break;case i.PAN:this.state=fP;break;default:this.state=hP}const n=this.keyState!==hP?this.keyState:this.state;n!==dP||this.noRotate?n!==pP||this.noZoom?n!==fP||this.noPan||(this._panStart.copy(this._getMouseOnScreen(t.pageX,t.pageY)),this._panEnd.copy(this._panStart)):(this._zoomStart.copy(this._getMouseOnScreen(t.pageX,t.pageY)),this._zoomEnd.copy(this._zoomStart)):(this._moveCurr.copy(this._getMouseOnCircle(t.pageX,t.pageY)),this._movePrev.copy(this._moveCurr)),this.dispatchEvent(lP)}function LP(t){const e=this.keyState!==hP?this.keyState:this.state;e!==dP||this.noRotate?e!==pP||this.noZoom?e!==fP||this.noPan||this._panEnd.copy(this._getMouseOnScreen(t.pageX,t.pageY)):this._zoomEnd.copy(this._getMouseOnScreen(t.pageX,t.pageY)):(this._movePrev.copy(this._moveCurr),this._moveCurr.copy(this._getMouseOnCircle(t.pageX,t.pageY)))}function UP(){this.state=hP,this.dispatchEvent(uP)}function kP(t){if(!1!==this.enabled&&!0!==this.noZoom){switch(t.preventDefault(),t.deltaMode){case 2:this._zoomStart.y-=.025*t.deltaY;break;case 1:this._zoomStart.y-=.01*t.deltaY;break;default:this._zoomStart.y-=25e-5*t.deltaY}this.dispatchEvent(lP),this.dispatchEvent(uP)}}function BP(t){!1!==this.enabled&&t.preventDefault()}function FP(t){if(this._trackPointer(t),1===this._pointers.length)this.state=mP,this._moveCurr.copy(this._getMouseOnCircle(this._pointers[0].pageX,this._pointers[0].pageY)),this._movePrev.copy(this._moveCurr);else{this.state=gP;const t=this._pointers[0].pageX-this._pointers[1].pageX,e=this._pointers[0].pageY-this._pointers[1].pageY;this._touchZoomDistanceEnd=this._touchZoomDistanceStart=Math.sqrt(t*t+e*e);const n=(this._pointers[0].pageX+this._pointers[1].pageX)/2,r=(this._pointers[0].pageY+this._pointers[1].pageY)/2;this._panStart.copy(this._getMouseOnScreen(n,r)),this._panEnd.copy(this._panStart)}this.dispatchEvent(lP)}function zP(t){if(this._trackPointer(t),1===this._pointers.length)this._movePrev.copy(this._moveCurr),this._moveCurr.copy(this._getMouseOnCircle(t.pageX,t.pageY));else{const e=this._getSecondPointerPosition(t),n=t.pageX-e.x,r=t.pageY-e.y;this._touchZoomDistanceEnd=Math.sqrt(n*n+r*r);const i=(t.pageX+e.x)/2,s=(t.pageY+e.y)/2;this._panEnd.copy(this._getMouseOnScreen(i,s))}}function VP(t){switch(this._pointers.length){case 0:this.state=hP;break;case 1:this.state=mP,this._moveCurr.copy(this._getMouseOnCircle(t.pageX,t.pageY)),this._movePrev.copy(this._moveCurr);break;case 2:this.state=gP;for(let e=0;e<this._pointers.length;e++)if(this._pointers[e].pointerId!==t.pointerId){const t=this._pointerPositions[this._pointers[e].pointerId];this._moveCurr.copy(this._getMouseOnCircle(t.x,t.y)),this._movePrev.copy(this._moveCurr);break}}this.dispatchEvent(uP)}const GP={type:"change"},jP={type:"start"},HP={type:"end"},WP=new Ke,qP=new Vr,XP=Math.cos(70*qt.DEG2RAD),ZP=new we,$P=2*Math.PI,YP=-1,KP=0,JP=1,QP=2,tI=3,eI=4,nI=5,rI=6,iI=1e-6;class sI extends rl{constructor(t,e=null){super(t,e),this.state=YP,this.enabled=!0,this.target=new we,this.cursor=new we,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minTargetRadius=0,this.maxTargetRadius=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.zoomToCursor=!1,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:i.ROTATE,MIDDLE:i.DOLLY,RIGHT:i.PAN},this.touches={ONE:s,TWO:a},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this._lastPosition=new we,this._lastQuaternion=new be,this._lastTargetPosition=new we,this._quat=(new be).setFromUnitVectors(t.up,new we(0,1,0)),this._quatInverse=this._quat.clone().invert(),this._spherical=new nl,this._sphericalDelta=new nl,this._scale=1,this._panOffset=new we,this._rotateStart=new Xt,this._rotateEnd=new Xt,this._rotateDelta=new Xt,this._panStart=new Xt,this._panEnd=new Xt,this._panDelta=new Xt,this._dollyStart=new Xt,this._dollyEnd=new Xt,this._dollyDelta=new Xt,this._dollyDirection=new we,this._mouse=new Xt,this._performCursorZoom=!1,this._pointers=[],this._pointerPositions={},this._controlActive=!1,this._onPointerMove=aI.bind(this),this._onPointerDown=oI.bind(this),this._onPointerUp=lI.bind(this),this._onContextMenu=mI.bind(this),this._onMouseWheel=hI.bind(this),this._onKeyDown=dI.bind(this),this._onTouchStart=pI.bind(this),this._onTouchMove=fI.bind(this),this._onMouseDown=uI.bind(this),this._onMouseMove=cI.bind(this),this._interceptControlDown=gI.bind(this),this._interceptControlUp=vI.bind(this),null!==this.domElement&&this.connect(),this.update()}connect(){this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointercancel",this._onPointerUp),this.domElement.addEventListener("contextmenu",this._onContextMenu),this.domElement.addEventListener("wheel",this._onMouseWheel,{passive:!1});this.domElement.getRootNode().addEventListener("keydown",this._interceptControlDown,{passive:!0,capture:!0}),this.domElement.style.touchAction="none"}disconnect(){this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.domElement.removeEventListener("pointercancel",this._onPointerUp),this.domElement.removeEventListener("wheel",this._onMouseWheel),this.domElement.removeEventListener("contextmenu",this._onContextMenu),this.stopListenToKeyEvents();this.domElement.getRootNode().removeEventListener("keydown",this._interceptControlDown,{capture:!0}),this.domElement.style.touchAction="auto"}dispose(){this.disconnect()}getPolarAngle(){return this._spherical.phi}getAzimuthalAngle(){return this._spherical.theta}getDistance(){return this.object.position.distanceTo(this.target)}listenToKeyEvents(t){t.addEventListener("keydown",this._onKeyDown),this._domElementKeyEvents=t}stopListenToKeyEvents(){null!==this._domElementKeyEvents&&(this._domElementKeyEvents.removeEventListener("keydown",this._onKeyDown),this._domElementKeyEvents=null)}saveState(){this.target0.copy(this.target),this.position0.copy(this.object.position),this.zoom0=this.object.zoom}reset(){this.target.copy(this.target0),this.object.position.copy(this.position0),this.object.zoom=this.zoom0,this.object.updateProjectionMatrix(),this.dispatchEvent(GP),this.update(),this.state=YP}update(t=null){const e=this.object.position;ZP.copy(e).sub(this.target),ZP.applyQuaternion(this._quat),this._spherical.setFromVector3(ZP),this.autoRotate&&this.state===YP&&this._rotateLeft(this._getAutoRotationAngle(t)),this.enableDamping?(this._spherical.theta+=this._sphericalDelta.theta*this.dampingFactor,this._spherical.phi+=this._sphericalDelta.phi*this.dampingFactor):(this._spherical.theta+=this._sphericalDelta.theta,this._spherical.phi+=this._sphericalDelta.phi);let n=this.minAzimuthAngle,r=this.maxAzimuthAngle;isFinite(n)&&isFinite(r)&&(n<-Math.PI?n+=$P:n>Math.PI&&(n-=$P),r<-Math.PI?r+=$P:r>Math.PI&&(r-=$P),this._spherical.theta=n<=r?Math.max(n,Math.min(r,this._spherical.theta)):this._spherical.theta>(n+r)/2?Math.max(n,this._spherical.theta):Math.min(r,this._spherical.theta)),this._spherical.phi=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,this._spherical.phi)),this._spherical.makeSafe(),!0===this.enableDamping?this.target.addScaledVector(this._panOffset,this.dampingFactor):this.target.add(this._panOffset),this.target.sub(this.cursor),this.target.clampLength(this.minTargetRadius,this.maxTargetRadius),this.target.add(this.cursor);let i=!1;if(this.zoomToCursor&&this._performCursorZoom||this.object.isOrthographicCamera)this._spherical.radius=this._clampDistance(this._spherical.radius);else{const t=this._spherical.radius;this._spherical.radius=this._clampDistance(this._spherical.radius*this._scale),i=t!=this._spherical.radius}if(ZP.setFromSpherical(this._spherical),ZP.applyQuaternion(this._quatInverse),e.copy(this.target).add(ZP),this.object.lookAt(this.target),!0===this.enableDamping?(this._sphericalDelta.theta*=1-this.dampingFactor,this._sphericalDelta.phi*=1-this.dampingFactor,this._panOffset.multiplyScalar(1-this.dampingFactor)):(this._sphericalDelta.set(0,0,0),this._panOffset.set(0,0,0)),this.zoomToCursor&&this._performCursorZoom){let t=null;if(this.object.isPerspectiveCamera){const e=ZP.length();t=this._clampDistance(e*this._scale);const n=e-t;this.object.position.addScaledVector(this._dollyDirection,n),this.object.updateMatrixWorld(),i=!!n}else if(this.object.isOrthographicCamera){const e=new we(this._mouse.x,this._mouse.y,0);e.unproject(this.object);const n=this.object.zoom;this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/this._scale)),this.object.updateProjectionMatrix(),i=n!==this.object.zoom;const r=new we(this._mouse.x,this._mouse.y,0);r.unproject(this.object),this.object.position.sub(r).add(e),this.object.updateMatrixWorld(),t=ZP.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),this.zoomToCursor=!1;null!==t&&(this.screenSpacePanning?this.target.set(0,0,-1).transformDirection(this.object.matrix).multiplyScalar(t).add(this.object.position):(WP.origin.copy(this.object.position),WP.direction.set(0,0,-1).transformDirection(this.object.matrix),Math.abs(this.object.up.dot(WP.direction))<XP?this.object.lookAt(this.target):(qP.setFromNormalAndCoplanarPoint(this.object.up,this.target),WP.intersectPlane(qP,this.target))))}else if(this.object.isOrthographicCamera){const t=this.object.zoom;this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/this._scale)),t!==this.object.zoom&&(this.object.updateProjectionMatrix(),i=!0)}return this._scale=1,this._performCursorZoom=!1,!!(i||this._lastPosition.distanceToSquared(this.object.position)>iI||8*(1-this._lastQuaternion.dot(this.object.quaternion))>iI||this._lastTargetPosition.distanceToSquared(this.target)>iI)&&(this.dispatchEvent(GP),this._lastPosition.copy(this.object.position),this._lastQuaternion.copy(this.object.quaternion),this._lastTargetPosition.copy(this.target),!0)}_getAutoRotationAngle(t){return null!==t?$P/60*this.autoRotateSpeed*t:$P/60/60*this.autoRotateSpeed}_getZoomScale(t){const e=Math.abs(.01*t);return Math.pow(.95,this.zoomSpeed*e)}_rotateLeft(t){this._sphericalDelta.theta-=t}_rotateUp(t){this._sphericalDelta.phi-=t}_panLeft(t,e){ZP.setFromMatrixColumn(e,0),ZP.multiplyScalar(-t),this._panOffset.add(ZP)}_panUp(t,e){!0===this.screenSpacePanning?ZP.setFromMatrixColumn(e,1):(ZP.setFromMatrixColumn(e,0),ZP.crossVectors(this.object.up,ZP)),ZP.multiplyScalar(t),this._panOffset.add(ZP)}_pan(t,e){const n=this.domElement;if(this.object.isPerspectiveCamera){const r=this.object.position;ZP.copy(r).sub(this.target);let i=ZP.length();i*=Math.tan(this.object.fov/2*Math.PI/180),this._panLeft(2*t*i/n.clientHeight,this.object.matrix),this._panUp(2*e*i/n.clientHeight,this.object.matrix)}else this.object.isOrthographicCamera?(this._panLeft(t*(this.object.right-this.object.left)/this.object.zoom/n.clientWidth,this.object.matrix),this._panUp(e*(this.object.top-this.object.bottom)/this.object.zoom/n.clientHeight,this.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),this.enablePan=!1)}_dollyOut(t){this.object.isPerspectiveCamera||this.object.isOrthographicCamera?this._scale/=t:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),this.enableZoom=!1)}_dollyIn(t){this.object.isPerspectiveCamera||this.object.isOrthographicCamera?this._scale*=t:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),this.enableZoom=!1)}_updateZoomParameters(t,e){if(!this.zoomToCursor)return;this._performCursorZoom=!0;const n=this.domElement.getBoundingClientRect(),r=t-n.left,i=e-n.top,s=n.width,o=n.height;this._mouse.x=r/s*2-1,this._mouse.y=-i/o*2+1,this._dollyDirection.set(this._mouse.x,this._mouse.y,1).unproject(this.object).sub(this.object.position).normalize()}_clampDistance(t){return Math.max(this.minDistance,Math.min(this.maxDistance,t))}_handleMouseDownRotate(t){this._rotateStart.set(t.clientX,t.clientY)}_handleMouseDownDolly(t){this._updateZoomParameters(t.clientX,t.clientX),this._dollyStart.set(t.clientX,t.clientY)}_handleMouseDownPan(t){this._panStart.set(t.clientX,t.clientY)}_handleMouseMoveRotate(t){this._rotateEnd.set(t.clientX,t.clientY),this._rotateDelta.subVectors(this._rotateEnd,this._rotateStart).multiplyScalar(this.rotateSpeed);const e=this.domElement;this._rotateLeft($P*this._rotateDelta.x/e.clientHeight),this._rotateUp($P*this._rotateDelta.y/e.clientHeight),this._rotateStart.copy(this._rotateEnd),this.update()}_handleMouseMoveDolly(t){this._dollyEnd.set(t.clientX,t.clientY),this._dollyDelta.subVectors(this._dollyEnd,this._dollyStart),this._dollyDelta.y>0?this._dollyOut(this._getZoomScale(this._dollyDelta.y)):this._dollyDelta.y<0&&this._dollyIn(this._getZoomScale(this._dollyDelta.y)),this._dollyStart.copy(this._dollyEnd),this.update()}_handleMouseMovePan(t){this._panEnd.set(t.clientX,t.clientY),this._panDelta.subVectors(this._panEnd,this._panStart).multiplyScalar(this.panSpeed),this._pan(this._panDelta.x,this._panDelta.y),this._panStart.copy(this._panEnd),this.update()}_handleMouseWheel(t){this._updateZoomParameters(t.clientX,t.clientY),t.deltaY<0?this._dollyIn(this._getZoomScale(t.deltaY)):t.deltaY>0&&this._dollyOut(this._getZoomScale(t.deltaY)),this.update()}_handleKeyDown(t){let e=!1;switch(t.code){case this.keys.UP:t.ctrlKey||t.metaKey||t.shiftKey?this._rotateUp($P*this.rotateSpeed/this.domElement.clientHeight):this._pan(0,this.keyPanSpeed),e=!0;break;case this.keys.BOTTOM:t.ctrlKey||t.metaKey||t.shiftKey?this._rotateUp(-$P*this.rotateSpeed/this.domElement.clientHeight):this._pan(0,-this.keyPanSpeed),e=!0;break;case this.keys.LEFT:t.ctrlKey||t.metaKey||t.shiftKey?this._rotateLeft($P*this.rotateSpeed/this.domElement.clientHeight):this._pan(this.keyPanSpeed,0),e=!0;break;case this.keys.RIGHT:t.ctrlKey||t.metaKey||t.shiftKey?this._rotateLeft(-$P*this.rotateSpeed/this.domElement.clientHeight):this._pan(-this.keyPanSpeed,0),e=!0}e&&(t.preventDefault(),this.update())}_handleTouchStartRotate(t){if(1===this._pointers.length)this._rotateStart.set(t.pageX,t.pageY);else{const e=this._getSecondPointerPosition(t),n=.5*(t.pageX+e.x),r=.5*(t.pageY+e.y);this._rotateStart.set(n,r)}}_handleTouchStartPan(t){if(1===this._pointers.length)this._panStart.set(t.pageX,t.pageY);else{const e=this._getSecondPointerPosition(t),n=.5*(t.pageX+e.x),r=.5*(t.pageY+e.y);this._panStart.set(n,r)}}_handleTouchStartDolly(t){const e=this._getSecondPointerPosition(t),n=t.pageX-e.x,r=t.pageY-e.y,i=Math.sqrt(n*n+r*r);this._dollyStart.set(0,i)}_handleTouchStartDollyPan(t){this.enableZoom&&this._handleTouchStartDolly(t),this.enablePan&&this._handleTouchStartPan(t)}_handleTouchStartDollyRotate(t){this.enableZoom&&this._handleTouchStartDolly(t),this.enableRotate&&this._handleTouchStartRotate(t)}_handleTouchMoveRotate(t){if(1==this._pointers.length)this._rotateEnd.set(t.pageX,t.pageY);else{const e=this._getSecondPointerPosition(t),n=.5*(t.pageX+e.x),r=.5*(t.pageY+e.y);this._rotateEnd.set(n,r)}this._rotateDelta.subVectors(this._rotateEnd,this._rotateStart).multiplyScalar(this.rotateSpeed);const e=this.domElement;this._rotateLeft($P*this._rotateDelta.x/e.clientHeight),this._rotateUp($P*this._rotateDelta.y/e.clientHeight),this._rotateStart.copy(this._rotateEnd)}_handleTouchMovePan(t){if(1===this._pointers.length)this._panEnd.set(t.pageX,t.pageY);else{const e=this._getSecondPointerPosition(t),n=.5*(t.pageX+e.x),r=.5*(t.pageY+e.y);this._panEnd.set(n,r)}this._panDelta.subVectors(this._panEnd,this._panStart).multiplyScalar(this.panSpeed),this._pan(this._panDelta.x,this._panDelta.y),this._panStart.copy(this._panEnd)}_handleTouchMoveDolly(t){const e=this._getSecondPointerPosition(t),n=t.pageX-e.x,r=t.pageY-e.y,i=Math.sqrt(n*n+r*r);this._dollyEnd.set(0,i),this._dollyDelta.set(0,Math.pow(this._dollyEnd.y/this._dollyStart.y,this.zoomSpeed)),this._dollyOut(this._dollyDelta.y),this._dollyStart.copy(this._dollyEnd);const s=.5*(t.pageX+e.x),o=.5*(t.pageY+e.y);this._updateZoomParameters(s,o)}_handleTouchMoveDollyPan(t){this.enableZoom&&this._handleTouchMoveDolly(t),this.enablePan&&this._handleTouchMovePan(t)}_handleTouchMoveDollyRotate(t){this.enableZoom&&this._handleTouchMoveDolly(t),this.enableRotate&&this._handleTouchMoveRotate(t)}_addPointer(t){this._pointers.push(t.pointerId)}_removePointer(t){delete this._pointerPositions[t.pointerId];for(let e=0;e<this._pointers.length;e++)if(this._pointers[e]==t.pointerId)return void this._pointers.splice(e,1)}_isTrackingPointer(t){for(let e=0;e<this._pointers.length;e++)if(this._pointers[e]==t.pointerId)return!0;return!1}_trackPointer(t){let e=this._pointerPositions[t.pointerId];void 0===e&&(e=new Xt,this._pointerPositions[t.pointerId]=e),e.set(t.pageX,t.pageY)}_getSecondPointerPosition(t){const e=t.pointerId===this._pointers[0]?this._pointers[1]:this._pointers[0];return this._pointerPositions[e]}_customWheelEvent(t){const e=t.deltaMode,n={clientX:t.clientX,clientY:t.clientY,deltaY:t.deltaY};switch(e){case 1:n.deltaY*=16;break;case 2:n.deltaY*=100}return t.ctrlKey&&!this._controlActive&&(n.deltaY*=10),n}}function oI(t){!1!==this.enabled&&(0===this._pointers.length&&(this.domElement.setPointerCapture(t.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),this.domElement.addEventListener("pointerup",this._onPointerUp)),this._isTrackingPointer(t)||(this._addPointer(t),"touch"===t.pointerType?this._onTouchStart(t):this._onMouseDown(t)))}function aI(t){!1!==this.enabled&&("touch"===t.pointerType?this._onTouchMove(t):this._onMouseMove(t))}function lI(t){switch(this._removePointer(t),this._pointers.length){case 0:this.domElement.releasePointerCapture(t.pointerId),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.dispatchEvent(HP),this.state=YP;break;case 1:const e=this._pointers[0],n=this._pointerPositions[e];this._onTouchStart({pointerId:e,pageX:n.x,pageY:n.y})}}function uI(t){let e;switch(t.button){case 0:e=this.mouseButtons.LEFT;break;case 1:e=this.mouseButtons.MIDDLE;break;case 2:e=this.mouseButtons.RIGHT;break;default:e=-1}switch(e){case i.DOLLY:if(!1===this.enableZoom)return;this._handleMouseDownDolly(t),this.state=JP;break;case i.ROTATE:if(t.ctrlKey||t.metaKey||t.shiftKey){if(!1===this.enablePan)return;this._handleMouseDownPan(t),this.state=QP}else{if(!1===this.enableRotate)return;this._handleMouseDownRotate(t),this.state=KP}break;case i.PAN:if(t.ctrlKey||t.metaKey||t.shiftKey){if(!1===this.enableRotate)return;this._handleMouseDownRotate(t),this.state=KP}else{if(!1===this.enablePan)return;this._handleMouseDownPan(t),this.state=QP}break;default:this.state=YP}this.state!==YP&&this.dispatchEvent(jP)}function cI(t){switch(this.state){case KP:if(!1===this.enableRotate)return;this._handleMouseMoveRotate(t);break;case JP:if(!1===this.enableZoom)return;this._handleMouseMoveDolly(t);break;case QP:if(!1===this.enablePan)return;this._handleMouseMovePan(t)}}function hI(t){!1!==this.enabled&&!1!==this.enableZoom&&this.state===YP&&(t.preventDefault(),this.dispatchEvent(jP),this._handleMouseWheel(this._customWheelEvent(t)),this.dispatchEvent(HP))}function dI(t){!1!==this.enabled&&!1!==this.enablePan&&this._handleKeyDown(t)}function pI(t){switch(this._trackPointer(t),this._pointers.length){case 1:switch(this.touches.ONE){case s:if(!1===this.enableRotate)return;this._handleTouchStartRotate(t),this.state=tI;break;case o:if(!1===this.enablePan)return;this._handleTouchStartPan(t),this.state=eI;break;default:this.state=YP}break;case 2:switch(this.touches.TWO){case a:if(!1===this.enableZoom&&!1===this.enablePan)return;this._handleTouchStartDollyPan(t),this.state=nI;break;case l:if(!1===this.enableZoom&&!1===this.enableRotate)return;this._handleTouchStartDollyRotate(t),this.state=rI;break;default:this.state=YP}break;default:this.state=YP}this.state!==YP&&this.dispatchEvent(jP)}function fI(t){switch(this._trackPointer(t),this.state){case tI:if(!1===this.enableRotate)return;this._handleTouchMoveRotate(t),this.update();break;case eI:if(!1===this.enablePan)return;this._handleTouchMovePan(t),this.update();break;case nI:if(!1===this.enableZoom&&!1===this.enablePan)return;this._handleTouchMoveDollyPan(t),this.update();break;case rI:if(!1===this.enableZoom&&!1===this.enableRotate)return;this._handleTouchMoveDollyRotate(t),this.update();break;default:this.state=YP}}function mI(t){!1!==this.enabled&&t.preventDefault()}function gI(t){if("Control"===t.key){this._controlActive=!0;this.domElement.getRootNode().addEventListener("keyup",this._interceptControlUp,{passive:!0,capture:!0})}}function vI(t){if("Control"===t.key){this._controlActive=!1;this.domElement.getRootNode().removeEventListener("keyup",this._interceptControlUp,{passive:!0,capture:!0})}}const yI={type:"change"},_I=1e-6,xI=new be;class bI extends rl{constructor(t,e=null){super(t,e),this.movementSpeed=1,this.rollSpeed=.005,this.dragToLook=!1,this.autoForward=!1,this._moveState={up:0,down:0,left:0,right:0,forward:0,back:0,pitchUp:0,pitchDown:0,yawLeft:0,yawRight:0,rollLeft:0,rollRight:0},this._moveVector=new we(0,0,0),this._rotationVector=new we(0,0,0),this._lastQuaternion=new be,this._lastPosition=new we,this._status=0,this._onKeyDown=wI.bind(this),this._onKeyUp=SI.bind(this),this._onPointerMove=EI.bind(this),this._onPointerDown=MI.bind(this),this._onPointerUp=TI.bind(this),this._onPointerCancel=AI.bind(this),this._onContextMenu=CI.bind(this),null!==e&&this.connect()}connect(){window.addEventListener("keydown",this._onKeyDown),window.addEventListener("keyup",this._onKeyUp),this.domElement.addEventListener("pointermove",this._onPointerMove),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointerup",this._onPointerUp),this.domElement.addEventListener("pointercancel",this._onPointerCancel),this.domElement.addEventListener("contextmenu",this._onContextMenu)}disconnect(){window.removeEventListener("keydown",this._onKeyDown),window.removeEventListener("keyup",this._onKeyUp),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.domElement.removeEventListener("pointercancel",this._onPointerCancel),this.domElement.removeEventListener("contextmenu",this._onContextMenu)}dispose(){this.disconnect()}update(t){if(!1===this.enabled)return;const e=this.object,n=t*this.movementSpeed,r=t*this.rollSpeed;e.translateX(this._moveVector.x*n),e.translateY(this._moveVector.y*n),e.translateZ(this._moveVector.z*n),xI.set(this._rotationVector.x*r,this._rotationVector.y*r,this._rotationVector.z*r,1).normalize(),e.quaternion.multiply(xI),(this._lastPosition.distanceToSquared(e.position)>_I||8*(1-this._lastQuaternion.dot(e.quaternion))>_I)&&(this.dispatchEvent(yI),this._lastQuaternion.copy(e.quaternion),this._lastPosition.copy(e.position))}_updateMovementVector(){const t=this._moveState.forward||this.autoForward&&!this._moveState.back?1:0;this._moveVector.x=-this._moveState.left+this._moveState.right,this._moveVector.y=-this._moveState.down+this._moveState.up,this._moveVector.z=-t+this._moveState.back}_updateRotationVector(){this._rotationVector.x=-this._moveState.pitchDown+this._moveState.pitchUp,this._rotationVector.y=-this._moveState.yawRight+this._moveState.yawLeft,this._rotationVector.z=-this._moveState.rollRight+this._moveState.rollLeft}_getContainerDimensions(){return this.domElement!=document?{size:[this.domElement.offsetWidth,this.domElement.offsetHeight],offset:[this.domElement.offsetLeft,this.domElement.offsetTop]}:{size:[window.innerWidth,window.innerHeight],offset:[0,0]}}}function wI(t){if(!t.altKey&&!1!==this.enabled){switch(t.code){case"ShiftLeft":case"ShiftRight":this.movementSpeedMultiplier=.1;break;case"KeyW":this._moveState.forward=1;break;case"KeyS":this._moveState.back=1;break;case"KeyA":this._moveState.left=1;break;case"KeyD":this._moveState.right=1;break;case"KeyR":this._moveState.up=1;break;case"KeyF":this._moveState.down=1;break;case"ArrowUp":this._moveState.pitchUp=1;break;case"ArrowDown":this._moveState.pitchDown=1;break;case"ArrowLeft":this._moveState.yawLeft=1;break;case"ArrowRight":this._moveState.yawRight=1;break;case"KeyQ":this._moveState.rollLeft=1;break;case"KeyE":this._moveState.rollRight=1}this._updateMovementVector(),this._updateRotationVector()}}function SI(t){if(!1!==this.enabled){switch(t.code){case"ShiftLeft":case"ShiftRight":this.movementSpeedMultiplier=1;break;case"KeyW":this._moveState.forward=0;break;case"KeyS":this._moveState.back=0;break;case"KeyA":this._moveState.left=0;break;case"KeyD":this._moveState.right=0;break;case"KeyR":this._moveState.up=0;break;case"KeyF":this._moveState.down=0;break;case"ArrowUp":this._moveState.pitchUp=0;break;case"ArrowDown":this._moveState.pitchDown=0;break;case"ArrowLeft":this._moveState.yawLeft=0;break;case"ArrowRight":this._moveState.yawRight=0;break;case"KeyQ":this._moveState.rollLeft=0;break;case"KeyE":this._moveState.rollRight=0}this._updateMovementVector(),this._updateRotationVector()}}function MI(t){if(!1!==this.enabled)if(this.dragToLook)this._status++;else{switch(t.button){case 0:this._moveState.forward=1;break;case 2:this._moveState.back=1}this._updateMovementVector()}}function EI(t){if(!1!==this.enabled&&(!this.dragToLook||this._status>0)){const e=this._getContainerDimensions(),n=e.size[0]/2,r=e.size[1]/2;this._moveState.yawLeft=-(t.pageX-e.offset[0]-n)/n,this._moveState.pitchDown=(t.pageY-e.offset[1]-r)/r,this._updateRotationVector()}}function TI(t){if(!1!==this.enabled){if(this.dragToLook)this._status--,this._moveState.yawLeft=this._moveState.pitchDown=0;else{switch(t.button){case 0:this._moveState.forward=0;break;case 2:this._moveState.back=0}this._updateMovementVector()}this._updateRotationVector()}}function AI(){!1!==this.enabled&&(this.dragToLook?(this._status=0,this._moveState.yawLeft=this._moveState.pitchDown=0):(this._moveState.forward=0,this._moveState.back=0,this._updateMovementVector()),this._updateRotationVector())}function CI(t){!1!==this.enabled&&t.preventDefault()}const RI={name:"CopyShader",uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:"\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}",fragmentShader:"\n\n\t\tuniform float opacity;\n\n\t\tuniform sampler2D tDiffuse;\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvec4 texel = texture2D( tDiffuse, vUv );\n\t\t\tgl_FragColor = opacity * texel;\n\n\n\t\t}"};class NI{constructor(){this.isPass=!0,this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.renderToScreen=!1}setSize(){}render(){console.error("THREE.Pass: .render() must be implemented in derived pass.")}dispose(){}}const PI=new oi(-1,1,1,-1,0,1);const II=new class extends ur{constructor(){super(),this.setAttribute("position",new er([-1,3,0,-1,-1,0,3,-1,0],3)),this.setAttribute("uv",new er([0,2,0,0,2,0],2))}};class OI{constructor(t){this._mesh=new br(II,t)}dispose(){this._mesh.geometry.dispose()}render(t){t.render(this._mesh,PI)}get material(){return this._mesh.material}set material(t){this._mesh.material=t}}class DI extends NI{constructor(t,e){super(),this.textureID=void 0!==e?e:"tDiffuse",t instanceof Cr?(this.uniforms=t.uniforms,this.material=t):t&&(this.uniforms=Ar.clone(t.uniforms),this.material=new Cr({name:void 0!==t.name?t.name:"unspecified",defines:Object.assign({},t.defines),uniforms:this.uniforms,vertexShader:t.vertexShader,fragmentShader:t.fragmentShader})),this.fsQuad=new OI(this.material)}render(t,e,n){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=n.texture),this.fsQuad.material=this.material,this.renderToScreen?(t.setRenderTarget(null),this.fsQuad.render(t)):(t.setRenderTarget(e),this.clear&&t.clear(t.autoClearColor,t.autoClearDepth,t.autoClearStencil),this.fsQuad.render(t))}dispose(){this.material.dispose(),this.fsQuad.dispose()}}class LI extends NI{constructor(t,e){super(),this.scene=t,this.camera=e,this.clear=!0,this.needsSwap=!1,this.inverse=!1}render(t,e,n){const r=t.getContext(),i=t.state;let s,o;i.buffers.color.setMask(!1),i.buffers.depth.setMask(!1),i.buffers.color.setLocked(!0),i.buffers.depth.setLocked(!0),this.inverse?(s=0,o=1):(s=1,o=0),i.buffers.stencil.setTest(!0),i.buffers.stencil.setOp(r.REPLACE,r.REPLACE,r.REPLACE),i.buffers.stencil.setFunc(r.ALWAYS,s,4294967295),i.buffers.stencil.setClear(o),i.buffers.stencil.setLocked(!0),t.setRenderTarget(n),this.clear&&t.clear(),t.render(this.scene,this.camera),t.setRenderTarget(e),this.clear&&t.clear(),t.render(this.scene,this.camera),i.buffers.color.setLocked(!1),i.buffers.depth.setLocked(!1),i.buffers.color.setMask(!0),i.buffers.depth.setMask(!0),i.buffers.stencil.setLocked(!1),i.buffers.stencil.setFunc(r.EQUAL,1,4294967295),i.buffers.stencil.setOp(r.KEEP,r.KEEP,r.KEEP),i.buffers.stencil.setLocked(!0)}}class UI extends NI{constructor(){super(),this.needsSwap=!1}render(t){t.state.buffers.stencil.setLocked(!1),t.state.buffers.stencil.setTest(!1)}}class kI{constructor(t,e){if(this.renderer=t,this._pixelRatio=t.getPixelRatio(),void 0===e){const n=t.getSize(new Xt);this._width=n.width,this._height=n.height,(e=new ye(this._width*this._pixelRatio,this._height*this._pixelRatio,{type:N})).texture.name="EffectComposer.rt1"}else this._width=e.width,this._height=e.height;this.renderTarget1=e,this.renderTarget2=e.clone(),this.renderTarget2.texture.name="EffectComposer.rt2",this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2,this.renderToScreen=!0,this.passes=[],this.copyPass=new DI(RI),this.copyPass.material.blending=0,this.clock=new ja}swapBuffers(){const t=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=t}addPass(t){this.passes.push(t),t.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}insertPass(t,e){this.passes.splice(e,0,t),t.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}removePass(t){const e=this.passes.indexOf(t);-1!==e&&this.passes.splice(e,1)}isLastEnabledPass(t){for(let e=t+1;e<this.passes.length;e++)if(this.passes[e].enabled)return!1;return!0}render(t){void 0===t&&(t=this.clock.getDelta());const e=this.renderer.getRenderTarget();let n=!1;for(let e=0,r=this.passes.length;e<r;e++){const r=this.passes[e];if(!1!==r.enabled){if(r.renderToScreen=this.renderToScreen&&this.isLastEnabledPass(e),r.render(this.renderer,this.writeBuffer,this.readBuffer,t,n),r.needsSwap){if(n){const e=this.renderer.getContext(),n=this.renderer.state.buffers.stencil;n.setFunc(e.NOTEQUAL,1,4294967295),this.copyPass.render(this.renderer,this.writeBuffer,this.readBuffer,t),n.setFunc(e.EQUAL,1,4294967295)}this.swapBuffers()}void 0!==LI&&(r instanceof LI?n=!0:r instanceof UI&&(n=!1))}}this.renderer.setRenderTarget(e)}reset(t){if(void 0===t){const e=this.renderer.getSize(new Xt);this._pixelRatio=this.renderer.getPixelRatio(),this._width=e.width,this._height=e.height,(t=this.renderTarget1.clone()).setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.renderTarget1=t,this.renderTarget2=t.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2}setSize(t,e){this._width=t,this._height=e;const n=this._width*this._pixelRatio,r=this._height*this._pixelRatio;this.renderTarget1.setSize(n,r),this.renderTarget2.setSize(n,r);for(let t=0;t<this.passes.length;t++)this.passes[t].setSize(n,r)}setPixelRatio(t){this._pixelRatio=t,this.setSize(this._width,this._height)}dispose(){this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.copyPass.dispose()}}class BI extends NI{constructor(t,e,n=null,r=null,i=null){super(),this.scene=t,this.camera=e,this.overrideMaterial=n,this.clearColor=r,this.clearAlpha=i,this.clear=!0,this.clearDepth=!1,this.needsSwap=!1,this._oldClearColor=new Wn}render(t,e,n){const r=t.autoClear;let i,s;t.autoClear=!1,null!==this.overrideMaterial&&(s=this.scene.overrideMaterial,this.scene.overrideMaterial=this.overrideMaterial),null!==this.clearColor&&(t.getClearColor(this._oldClearColor),t.setClearColor(this.clearColor,t.getClearAlpha())),null!==this.clearAlpha&&(i=t.getClearAlpha(),t.setClearAlpha(this.clearAlpha)),1==this.clearDepth&&t.clearDepth(),t.setRenderTarget(this.renderToScreen?null:n),!0===this.clear&&t.clear(t.autoClearColor,t.autoClearDepth,t.autoClearStencil),t.render(this.scene,this.camera),null!==this.clearColor&&t.setClearColor(this._oldClearColor),null!==this.clearAlpha&&t.setClearAlpha(i),null!==this.overrideMaterial&&(this.scene.overrideMaterial=s),t.autoClear=r}}var FI=n(2053),zI=n(46468),VI=n(85716);var GI=n(23605);var jI=function(t){function e(e){var n;return n=t.call(this,"An error occurred. See https://github.com/styled-components/polished/blob/main/src/internalHelpers/errors.md#"+e+" for more information.")||this,(0,zI.Z)(n)}return function(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,(0,VI.Z)(t,e)}(e,t),e}((0,GI.Z)(Error));function HI(t,e){return t.substr(-e.length)===e}var WI=/^([+-]?(?:\d+|\d*\.\d+))([a-z]*|%)$/;function qI(t){return"string"!=typeof t?t:t.match(WI)?parseFloat(t):t}var XI=function(t){return function(e,n){void 0===n&&(n="16px");var r=e,i=n;if("string"==typeof e){if(!HI(e,"px"))throw new jI(69,t,e);r=qI(e)}if("string"==typeof n){if(!HI(n,"px"))throw new jI(70,t,n);i=qI(n)}if("string"==typeof r)throw new jI(71,e,t);if("string"==typeof i)throw new jI(72,n,t);return""+r/i+t}};XI("em");XI("rem");function ZI(t){return Math.round(255*t)}function $I(t,e,n){return ZI(t)+","+ZI(e)+","+ZI(n)}function YI(t,e,n,r){if(void 0===r&&(r=$I),0===e)return r(n,n,n);var i=(t%360+360)%360/60,s=(1-Math.abs(2*n-1))*e,o=s*(1-Math.abs(i%2-1)),a=0,l=0,u=0;i>=0&&i<1?(a=s,l=o):i>=1&&i<2?(a=o,l=s):i>=2&&i<3?(l=s,u=o):i>=3&&i<4?(l=o,u=s):i>=4&&i<5?(a=o,u=s):i>=5&&i<6&&(a=s,u=o);var c=n-s/2;return r(a+c,l+c,u+c)}var KI={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"00ffff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000",blanchedalmond:"ffebcd",blue:"0000ff",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"00ffff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkgrey:"a9a9a9",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkslategrey:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dimgrey:"696969",dodgerblue:"1e90ff",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"ff00ff",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",grey:"808080",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgray:"d3d3d3",lightgreen:"90ee90",lightgrey:"d3d3d3",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslategray:"789",lightslategrey:"789",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"0f0",limegreen:"32cd32",linen:"faf0e6",magenta:"f0f",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370db",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"db7093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",rebeccapurple:"639",red:"f00",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",slategrey:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",wheat:"f5deb3",white:"fff",whitesmoke:"f5f5f5",yellow:"ff0",yellowgreen:"9acd32"};var JI=/^#[a-fA-F0-9]{6}$/,QI=/^#[a-fA-F0-9]{8}$/,tO=/^#[a-fA-F0-9]{3}$/,eO=/^#[a-fA-F0-9]{4}$/,nO=/^rgb\(\s*(\d{1,3})\s*(?:,)?\s*(\d{1,3})\s*(?:,)?\s*(\d{1,3})\s*\)$/i,rO=/^rgb(?:a)?\(\s*(\d{1,3})\s*(?:,)?\s*(\d{1,3})\s*(?:,)?\s*(\d{1,3})\s*(?:,|\/)\s*([-+]?\d*[.]?\d+[%]?)\s*\)$/i,iO=/^hsl\(\s*(\d{0,3}[.]?[0-9]+(?:deg)?)\s*(?:,)?\s*(\d{1,3}[.]?[0-9]?)%\s*(?:,)?\s*(\d{1,3}[.]?[0-9]?)%\s*\)$/i,sO=/^hsl(?:a)?\(\s*(\d{0,3}[.]?[0-9]+(?:deg)?)\s*(?:,)?\s*(\d{1,3}[.]?[0-9]?)%\s*(?:,)?\s*(\d{1,3}[.]?[0-9]?)%\s*(?:,|\/)\s*([-+]?\d*[.]?\d+[%]?)\s*\)$/i;function oO(t){if("string"!=typeof t)throw new jI(3);var e=function(t){if("string"!=typeof t)return t;var e=t.toLowerCase();return KI[e]?"#"+KI[e]:t}(t);if(e.match(JI))return{red:parseInt(""+e[1]+e[2],16),green:parseInt(""+e[3]+e[4],16),blue:parseInt(""+e[5]+e[6],16)};if(e.match(QI)){var n=parseFloat((parseInt(""+e[7]+e[8],16)/255).toFixed(2));return{red:parseInt(""+e[1]+e[2],16),green:parseInt(""+e[3]+e[4],16),blue:parseInt(""+e[5]+e[6],16),alpha:n}}if(e.match(tO))return{red:parseInt(""+e[1]+e[1],16),green:parseInt(""+e[2]+e[2],16),blue:parseInt(""+e[3]+e[3],16)};if(e.match(eO)){var r=parseFloat((parseInt(""+e[4]+e[4],16)/255).toFixed(2));return{red:parseInt(""+e[1]+e[1],16),green:parseInt(""+e[2]+e[2],16),blue:parseInt(""+e[3]+e[3],16),alpha:r}}var i=nO.exec(e);if(i)return{red:parseInt(""+i[1],10),green:parseInt(""+i[2],10),blue:parseInt(""+i[3],10)};var s=rO.exec(e.substring(0,50));if(s)return{red:parseInt(""+s[1],10),green:parseInt(""+s[2],10),blue:parseInt(""+s[3],10),alpha:parseFloat(""+s[4])>1?parseFloat(""+s[4])/100:parseFloat(""+s[4])};var o=iO.exec(e);if(o){var a="rgb("+YI(parseInt(""+o[1],10),parseInt(""+o[2],10)/100,parseInt(""+o[3],10)/100)+")",l=nO.exec(a);if(!l)throw new jI(4,e,a);return{red:parseInt(""+l[1],10),green:parseInt(""+l[2],10),blue:parseInt(""+l[3],10)}}var u=sO.exec(e.substring(0,50));if(u){var c="rgb("+YI(parseInt(""+u[1],10),parseInt(""+u[2],10)/100,parseInt(""+u[3],10)/100)+")",h=nO.exec(c);if(!h)throw new jI(4,e,c);return{red:parseInt(""+h[1],10),green:parseInt(""+h[2],10),blue:parseInt(""+h[3],10),alpha:parseFloat(""+u[4])>1?parseFloat(""+u[4])/100:parseFloat(""+u[4])}}throw new jI(5)}function aO(t){return function(t){var e,n=t.red/255,r=t.green/255,i=t.blue/255,s=Math.max(n,r,i),o=Math.min(n,r,i),a=(s+o)/2;if(s===o)return void 0!==t.alpha?{hue:0,saturation:0,lightness:a,alpha:t.alpha}:{hue:0,saturation:0,lightness:a};var l=s-o,u=a>.5?l/(2-s-o):l/(s+o);switch(s){case n:e=(r-i)/l+(r<i?6:0);break;case r:e=(i-n)/l+2;break;default:e=(n-r)/l+4}return e*=60,void 0!==t.alpha?{hue:e,saturation:u,lightness:a,alpha:t.alpha}:{hue:e,saturation:u,lightness:a}}(oO(t))}var lO=function(t){return 7===t.length&&t[1]===t[2]&&t[3]===t[4]&&t[5]===t[6]?"#"+t[1]+t[3]+t[5]:t};function uO(t){var e=t.toString(16);return 1===e.length?"0"+e:e}function cO(t){return uO(Math.round(255*t))}function hO(t,e,n){return lO("#"+cO(t)+cO(e)+cO(n))}function dO(t,e,n){return YI(t,e,n,hO)}function pO(t,e,n){if("number"==typeof t&&"number"==typeof e&&"number"==typeof n)return dO(t,e,n);if("object"==typeof t&&void 0===e&&void 0===n)return dO(t.hue,t.saturation,t.lightness);throw new jI(1)}function fO(t,e,n,r){if("number"==typeof t&&"number"==typeof e&&"number"==typeof n&&"number"==typeof r)return r>=1?dO(t,e,n):"rgba("+YI(t,e,n)+","+r+")";if("object"==typeof t&&void 0===e&&void 0===n&&void 0===r)return t.alpha>=1?dO(t.hue,t.saturation,t.lightness):"rgba("+YI(t.hue,t.saturation,t.lightness)+","+t.alpha+")";throw new jI(2)}function mO(t,e,n){if("number"==typeof t&&"number"==typeof e&&"number"==typeof n)return lO("#"+uO(t)+uO(e)+uO(n));if("object"==typeof t&&void 0===e&&void 0===n)return lO("#"+uO(t.red)+uO(t.green)+uO(t.blue));throw new jI(6)}function gO(t,e,n,r){if("string"==typeof t&&"number"==typeof e){var i=oO(t);return"rgba("+i.red+","+i.green+","+i.blue+","+e+")"}if("number"==typeof t&&"number"==typeof e&&"number"==typeof n&&"number"==typeof r)return r>=1?mO(t,e,n):"rgba("+t+","+e+","+n+","+r+")";if("object"==typeof t&&void 0===e&&void 0===n&&void 0===r)return t.alpha>=1?mO(t.red,t.green,t.blue):"rgba("+t.red+","+t.green+","+t.blue+","+t.alpha+")";throw new jI(7)}function vO(t){if("object"!=typeof t)throw new jI(8);if(function(t){return"number"==typeof t.red&&"number"==typeof t.green&&"number"==typeof t.blue&&"number"==typeof t.alpha}(t))return gO(t);if(function(t){return"number"==typeof t.red&&"number"==typeof t.green&&"number"==typeof t.blue&&("number"!=typeof t.alpha||void 0===t.alpha)}(t))return mO(t);if(function(t){return"number"==typeof t.hue&&"number"==typeof t.saturation&&"number"==typeof t.lightness&&"number"==typeof t.alpha}(t))return fO(t);if(function(t){return"number"==typeof t.hue&&"number"==typeof t.saturation&&"number"==typeof t.lightness&&("number"!=typeof t.alpha||void 0===t.alpha)}(t))return pO(t);throw new jI(8)}function yO(t,e,n){return function(){var r=n.concat(Array.prototype.slice.call(arguments));return r.length>=e?t.apply(this,r):yO(t,e,r)}}function _O(t){return yO(t,t.length,[])}_O((function(t,e){if("transparent"===e)return e;var n=aO(e);return vO((0,FI.Z)({},n,{hue:n.hue+parseFloat(t)}))}));function xO(t,e,n){return Math.max(t,Math.min(e,n))}_O((function(t,e){if("transparent"===e)return e;var n=aO(e);return vO((0,FI.Z)({},n,{lightness:xO(0,1,n.lightness-parseFloat(t))}))}));_O((function(t,e){if("transparent"===e)return e;var n=aO(e);return vO((0,FI.Z)({},n,{saturation:xO(0,1,n.saturation-parseFloat(t))}))}));_O((function(t,e){if("transparent"===e)return e;var n=aO(e);return vO((0,FI.Z)({},n,{lightness:xO(0,1,n.lightness+parseFloat(t))}))}));var bO=_O((function(t,e,n){if("transparent"===e)return n;if("transparent"===n)return e;if(0===t)return n;var r=oO(e),i=(0,FI.Z)({},r,{alpha:"number"==typeof r.alpha?r.alpha:1}),s=oO(n),o=(0,FI.Z)({},s,{alpha:"number"==typeof s.alpha?s.alpha:1}),a=i.alpha-o.alpha,l=2*parseFloat(t)-1,u=((l*a==-1?l:l+a)/(1+l*a)+1)/2,c=1-u;return gO({red:Math.floor(i.red*u+o.red*c),green:Math.floor(i.green*u+o.green*c),blue:Math.floor(i.blue*u+o.blue*c),alpha:i.alpha*parseFloat(t)+o.alpha*(1-parseFloat(t))})})),wO=bO;var SO=_O((function(t,e){if("transparent"===e)return e;var n=oO(e),r="number"==typeof n.alpha?n.alpha:1;return gO((0,FI.Z)({},n,{alpha:xO(0,1,(100*r+100*parseFloat(t))/100)}))})),MO=SO;_O((function(t,e){if("transparent"===e)return e;var n=aO(e);return vO((0,FI.Z)({},n,{saturation:xO(0,1,n.saturation+parseFloat(t))}))}));_O((function(t,e){return"transparent"===e?e:vO((0,FI.Z)({},aO(e),{hue:parseFloat(t)}))}));_O((function(t,e){return"transparent"===e?e:vO((0,FI.Z)({},aO(e),{lightness:parseFloat(t)}))}));_O((function(t,e){return"transparent"===e?e:vO((0,FI.Z)({},aO(e),{saturation:parseFloat(t)}))}));_O((function(t,e){return"transparent"===e?e:wO(parseFloat(t),"rgb(0, 0, 0)",e)}));_O((function(t,e){return"transparent"===e?e:wO(parseFloat(t),"rgb(255, 255, 255)",e)}));_O((function(t,e){if("transparent"===e)return e;var n=oO(e),r="number"==typeof n.alpha?n.alpha:1;return gO((0,FI.Z)({},n,{alpha:xO(0,1,+(100*r-100*parseFloat(t)).toFixed(2)/100)}))}));var EO=n(83109);function TO(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}function AO(t,e,n){return(e=function(t){var e=function(t,e){if("object"!=typeof t||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,e||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:e+""}(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function CO(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,i,s,o,a=[],l=!0,u=!1;try{if(s=(n=n.call(t)).next,0===e);else for(;!(l=(r=s.call(n)).done)&&(a.push(r.value),a.length!==e);l=!0);}catch(t){u=!0,i=t}finally{try{if(!l&&null!=n.return&&(o=n.return(),Object(o)!==o))return}finally{if(u)throw i}}return a}}(t,e)||NO(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function RO(t){return function(t){if(Array.isArray(t))return TO(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||NO(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function NO(t,e){if(t){if("string"==typeof t)return TO(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?TO(t,e):void 0}}!function(t,e){void 0===e&&(e={});var n=e.insertAt;if("undefined"!=typeof document){var r=document.head||document.getElementsByTagName("head")[0],i=document.createElement("style");i.type="text/css","top"===n&&r.firstChild?r.insertBefore(i,r.firstChild):r.appendChild(i),i.styleSheet?i.styleSheet.cssText=t:i.appendChild(document.createTextNode(t))}}(".scene-nav-info {\n  bottom: 5px;\n  width: 100%;\n  text-align: center;\n  color: slategrey;\n  opacity: 0.7;\n  font-size: 10px;\n}\n\n.scene-tooltip {\n  top: 0;\n  color: lavender;\n  font-size: 15px;\n}\n\n.scene-nav-info, .scene-tooltip {\n  position: absolute;\n  font-family: sans-serif;\n  pointer-events: none;\n  user-select: none;\n}\n\n.scene-container canvas:focus {\n  outline: none;\n}");var PO=window.THREE?window.THREE:{WebGLRenderer:class{constructor(t={}){const{canvas:e=Jt(),context:n=null,depth:i=!0,stencil:s=!1,alpha:o=!1,antialias:a=!1,premultipliedAlpha:l=!0,preserveDrawingBuffer:u=!1,powerPreference:c="default",failIfMajorPerformanceCaveat:h=!1,reverseDepthBuffer:d=!1}=t;let p;if(this.isWebGLRenderer=!0,null!==n){if("undefined"!=typeof WebGLRenderingContext&&n instanceof WebGLRenderingContext)throw new Error("THREE.WebGLRenderer: WebGL 1 is not supported since r163.");p=n.getContextAttributes().alpha}else p=o;const f=new Uint32Array(4),m=new Int32Array(4);let g=null,v=null;const y=[],_=[];this.domElement=e,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this._outputColorSpace=Tt,this.toneMapping=0,this.toneMappingExposure=1;const x=this;let b=!1,M=0,E=0,A=null,R=-1,D=null;const L=new ge,U=new ge;let k=null;const B=new Wn(0);let G=0,j=e.width,H=e.height,W=1,q=null,X=null;const Z=new ge(0,0,j,H),$=new ge(0,0,j,H);let Y=!1;const K=new Hr;let J=!1,Q=!1;const tt=new Je,et=new Je,nt=new we,rt=new ge,it={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};let st=!1;function ot(){return null===A?W:1}let at,lt,ut,ct,ht,dt,pt,ft,mt,gt,vt,yt,_t,xt,bt,wt,St,Mt,Et,Ct,Rt,Nt,Pt,It,Ot=n;function Dt(t,n){return e.getContext(t,n)}try{const t={alpha:!0,depth:i,stencil:s,antialias:a,premultipliedAlpha:l,preserveDrawingBuffer:u,powerPreference:c,failIfMajorPerformanceCaveat:h};if("setAttribute"in e&&e.setAttribute("data-engine",`three.js r${r}`),e.addEventListener("webglcontextlost",kt,!1),e.addEventListener("webglcontextrestored",Bt,!1),e.addEventListener("webglcontextcreationerror",Ft,!1),null===Ot){const e="webgl2";if(Ot=Dt(e,t),null===Ot)throw Dt(e)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}}catch(t){throw console.error("THREE.WebGLRenderer: "+t.message),t}function Lt(){at=new Ei(Ot),at.init(),Nt=new To(Ot,at),lt=new ri(Ot,at,t,Nt),ut=new So(Ot,at),lt.reverseDepthBuffer&&d&&ut.buffers.depth.setReversed(!0),ct=new Ci(Ot),ht=new ao,dt=new Eo(Ot,at,ut,ht,lt,Nt,ct),pt=new si(x),ft=new Mi(x),mt=new qr(Ot),Pt=new ei(Ot,mt),gt=new Ti(Ot,mt,ct,Pt),vt=new Ni(Ot,gt,mt,ct),Et=new Ri(Ot,lt,dt),wt=new ii(ht),yt=new oo(x,pt,ft,at,lt,Pt,wt),_t=new Lo(x,ht),xt=new ho,bt=new yo(at),Mt=new ti(x,pt,ft,ut,vt,p,l),St=new bo(x,vt,lt),It=new Uo(Ot,ct,lt,ut),Ct=new ni(Ot,at,ct),Rt=new Ai(Ot,at,ct),ct.programs=yt.programs,x.capabilities=lt,x.extensions=at,x.properties=ht,x.renderLists=xt,x.shadowMap=St,x.state=ut,x.info=ct}Lt();const Ut=new Io(x,Ot);function kt(t){t.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),b=!0}function Bt(){console.log("THREE.WebGLRenderer: Context Restored."),b=!1;const t=ct.autoReset,e=St.enabled,n=St.autoUpdate,r=St.needsUpdate,i=St.type;Lt(),ct.autoReset=t,St.enabled=e,St.autoUpdate=n,St.needsUpdate=r,St.type=i}function Ft(t){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",t.statusMessage)}function zt(t){const e=t.target;e.removeEventListener("dispose",zt),function(t){(function(t){const e=ht.get(t).programs;void 0!==e&&(e.forEach((function(t){yt.releaseProgram(t)})),t.isShaderMaterial&&yt.releaseShaderCache(t))})(t),ht.remove(t)}(e)}function Vt(t,e,n){!0===t.transparent&&2===t.side&&!1===t.forceSinglePass?(t.side=1,t.needsUpdate=!0,Kt(t,e,n),t.side=0,t.needsUpdate=!0,Kt(t,e,n),t.side=2):Kt(t,e,n)}this.xr=Ut,this.getContext=function(){return Ot},this.getContextAttributes=function(){return Ot.getContextAttributes()},this.forceContextLoss=function(){const t=at.get("WEBGL_lose_context");t&&t.loseContext()},this.forceContextRestore=function(){const t=at.get("WEBGL_lose_context");t&&t.restoreContext()},this.getPixelRatio=function(){return W},this.setPixelRatio=function(t){void 0!==t&&(W=t,this.setSize(j,H,!1))},this.getSize=function(t){return t.set(j,H)},this.setSize=function(t,n,r=!0){Ut.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(j=t,H=n,e.width=Math.floor(t*W),e.height=Math.floor(n*W),!0===r&&(e.style.width=t+"px",e.style.height=n+"px"),this.setViewport(0,0,t,n))},this.getDrawingBufferSize=function(t){return t.set(j*W,H*W).floor()},this.setDrawingBufferSize=function(t,n,r){j=t,H=n,W=r,e.width=Math.floor(t*r),e.height=Math.floor(n*r),this.setViewport(0,0,t,n)},this.getCurrentViewport=function(t){return t.copy(L)},this.getViewport=function(t){return t.copy(Z)},this.setViewport=function(t,e,n,r){t.isVector4?Z.set(t.x,t.y,t.z,t.w):Z.set(t,e,n,r),ut.viewport(L.copy(Z).multiplyScalar(W).round())},this.getScissor=function(t){return t.copy($)},this.setScissor=function(t,e,n,r){t.isVector4?$.set(t.x,t.y,t.z,t.w):$.set(t,e,n,r),ut.scissor(U.copy($).multiplyScalar(W).round())},this.getScissorTest=function(){return Y},this.setScissorTest=function(t){ut.setScissorTest(Y=t)},this.setOpaqueSort=function(t){q=t},this.setTransparentSort=function(t){X=t},this.getClearColor=function(t){return t.copy(Mt.getClearColor())},this.setClearColor=function(){Mt.setClearColor.apply(Mt,arguments)},this.getClearAlpha=function(){return Mt.getClearAlpha()},this.setClearAlpha=function(){Mt.setClearAlpha.apply(Mt,arguments)},this.clear=function(t=!0,e=!0,n=!0){let r=0;if(t){let t=!1;if(null!==A){const e=A.texture.format;t=e===V||e===z||e===F}if(t){const t=A.texture.type,e=t===S||t===C||t===T||t===O||t===P||t===I,n=Mt.getClearColor(),r=Mt.getClearAlpha(),i=n.r,s=n.g,o=n.b;e?(f[0]=i,f[1]=s,f[2]=o,f[3]=r,Ot.clearBufferuiv(Ot.COLOR,0,f)):(m[0]=i,m[1]=s,m[2]=o,m[3]=r,Ot.clearBufferiv(Ot.COLOR,0,m))}else r|=Ot.COLOR_BUFFER_BIT}e&&(r|=Ot.DEPTH_BUFFER_BIT),n&&(r|=Ot.STENCIL_BUFFER_BIT,this.state.buffers.stencil.setMask(4294967295)),Ot.clear(r)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){e.removeEventListener("webglcontextlost",kt,!1),e.removeEventListener("webglcontextrestored",Bt,!1),e.removeEventListener("webglcontextcreationerror",Ft,!1),xt.dispose(),bt.dispose(),ht.dispose(),pt.dispose(),ft.dispose(),vt.dispose(),Pt.dispose(),It.dispose(),yt.dispose(),Ut.dispose(),Ut.removeEventListener("sessionstart",jt),Ut.removeEventListener("sessionend",Ht),Wt.stop()},this.renderBufferDirect=function(t,e,n,r,i,s){null===e&&(e=it);const o=i.isMesh&&i.matrixWorld.determinant()<0,a=function(t,e,n,r,i){!0!==e.isScene&&(e=it);dt.resetTextureUnits();const s=e.fog,o=r.isMeshStandardMaterial?e.environment:null,a=null===A?x.outputColorSpace:!0===A.isXRRenderTarget?A.texture.colorSpace:At,l=(r.isMeshStandardMaterial?ft:pt).get(r.envMap||o),u=!0===r.vertexColors&&!!n.attributes.color&&4===n.attributes.color.itemSize,c=!!n.attributes.tangent&&(!!r.normalMap||r.anisotropy>0),h=!!n.morphAttributes.position,d=!!n.morphAttributes.normal,p=!!n.morphAttributes.color;let f=0;r.toneMapped&&(null!==A&&!0!==A.isXRRenderTarget||(f=x.toneMapping));const m=n.morphAttributes.position||n.morphAttributes.normal||n.morphAttributes.color,g=void 0!==m?m.length:0,y=ht.get(r),_=v.state.lights;if(!0===J&&(!0===Q||t!==D)){const e=t===D&&r.id===R;wt.setState(r,t,e)}let b=!1;r.version===y.__version?y.needsLights&&y.lightsStateVersion!==_.state.version||y.outputColorSpace!==a||i.isBatchedMesh&&!1===y.batching?b=!0:i.isBatchedMesh||!0!==y.batching?i.isBatchedMesh&&!0===y.batchingColor&&null===i.colorTexture||i.isBatchedMesh&&!1===y.batchingColor&&null!==i.colorTexture||i.isInstancedMesh&&!1===y.instancing?b=!0:i.isInstancedMesh||!0!==y.instancing?i.isSkinnedMesh&&!1===y.skinning?b=!0:i.isSkinnedMesh||!0!==y.skinning?i.isInstancedMesh&&!0===y.instancingColor&&null===i.instanceColor||i.isInstancedMesh&&!1===y.instancingColor&&null!==i.instanceColor||i.isInstancedMesh&&!0===y.instancingMorph&&null===i.morphTexture||i.isInstancedMesh&&!1===y.instancingMorph&&null!==i.morphTexture||y.envMap!==l||!0===r.fog&&y.fog!==s?b=!0:void 0===y.numClippingPlanes||y.numClippingPlanes===wt.numPlanes&&y.numIntersection===wt.numIntersection?(y.vertexAlphas!==u||y.vertexTangents!==c||y.morphTargets!==h||y.morphNormals!==d||y.morphColors!==p||y.toneMapping!==f||y.morphTargetsCount!==g)&&(b=!0):b=!0:b=!0:b=!0:b=!0:(b=!0,y.__version=r.version);let w=y.currentProgram;!0===b&&(w=Kt(r,e,i));let S=!1,M=!1,E=!1;const T=w.getUniforms(),C=y.uniforms;ut.useProgram(w.program)&&(S=!0,M=!0,E=!0);r.id!==R&&(R=r.id,M=!0);if(S||D!==t){ut.buffers.depth.getReversed()?(tt.copy(t.projectionMatrix),function(t){const e=t.elements;e[2]=.5*e[2]+.5*e[3],e[6]=.5*e[6]+.5*e[7],e[10]=.5*e[10]+.5*e[11],e[14]=.5*e[14]+.5*e[15]}(tt),function(t){const e=t.elements;-1===e[11]?(e[10]=-e[10]-1,e[14]=-e[14]):(e[10]=-e[10],e[14]=1-e[14])}(tt),T.setValue(Ot,"projectionMatrix",tt)):T.setValue(Ot,"projectionMatrix",t.projectionMatrix),T.setValue(Ot,"viewMatrix",t.matrixWorldInverse);const e=T.map.cameraPosition;void 0!==e&&e.setValue(Ot,nt.setFromMatrixPosition(t.matrixWorld)),lt.logarithmicDepthBuffer&&T.setValue(Ot,"logDepthBufFC",2/(Math.log(t.far+1)/Math.LN2)),(r.isMeshPhongMaterial||r.isMeshToonMaterial||r.isMeshLambertMaterial||r.isMeshBasicMaterial||r.isMeshStandardMaterial||r.isShaderMaterial)&&T.setValue(Ot,"isOrthographic",!0===t.isOrthographicCamera),D!==t&&(D=t,M=!0,E=!0)}if(i.isSkinnedMesh){T.setOptional(Ot,i,"bindMatrix"),T.setOptional(Ot,i,"bindMatrixInverse");const t=i.skeleton;t&&(null===t.boneTexture&&t.computeBoneTexture(),T.setValue(Ot,"boneTexture",t.boneTexture,dt))}i.isBatchedMesh&&(T.setOptional(Ot,i,"batchingTexture"),T.setValue(Ot,"batchingTexture",i._matricesTexture,dt),T.setOptional(Ot,i,"batchingIdTexture"),T.setValue(Ot,"batchingIdTexture",i._indirectTexture,dt),T.setOptional(Ot,i,"batchingColorTexture"),null!==i._colorsTexture&&T.setValue(Ot,"batchingColorTexture",i._colorsTexture,dt));const N=n.morphAttributes;void 0===N.position&&void 0===N.normal&&void 0===N.color||Et.update(i,n,w);(M||y.receiveShadow!==i.receiveShadow)&&(y.receiveShadow=i.receiveShadow,T.setValue(Ot,"receiveShadow",i.receiveShadow));r.isMeshGouraudMaterial&&null!==r.envMap&&(C.envMap.value=l,C.flipEnvMap.value=l.isCubeTexture&&!1===l.isRenderTargetTexture?-1:1);r.isMeshStandardMaterial&&null===r.envMap&&null!==e.environment&&(C.envMapIntensity.value=e.environmentIntensity);M&&(T.setValue(Ot,"toneMappingExposure",x.toneMappingExposure),y.needsLights&&function(t,e){t.ambientLightColor.needsUpdate=e,t.lightProbe.needsUpdate=e,t.directionalLights.needsUpdate=e,t.directionalLightShadows.needsUpdate=e,t.pointLights.needsUpdate=e,t.pointLightShadows.needsUpdate=e,t.spotLights.needsUpdate=e,t.spotLightShadows.needsUpdate=e,t.rectAreaLights.needsUpdate=e,t.hemisphereLights.needsUpdate=e}(C,E),s&&!0===r.fog&&_t.refreshFogUniforms(C,s),_t.refreshMaterialUniforms(C,r,W,H,v.state.transmissionRenderTarget[t.id]),Us.upload(Ot,Qt(y),C,dt));r.isShaderMaterial&&!0===r.uniformsNeedUpdate&&(Us.upload(Ot,Qt(y),C,dt),r.uniformsNeedUpdate=!1);r.isSpriteMaterial&&T.setValue(Ot,"center",i.center);if(T.setValue(Ot,"modelViewMatrix",i.modelViewMatrix),T.setValue(Ot,"normalMatrix",i.normalMatrix),T.setValue(Ot,"modelMatrix",i.matrixWorld),r.isShaderMaterial||r.isRawShaderMaterial){const t=r.uniformsGroups;for(let e=0,n=t.length;e<n;e++){const n=t[e];It.update(n,w),It.bind(n,w)}}return w}(t,e,n,r,i);ut.setMaterial(r,o);let l=n.index,u=1;if(!0===r.wireframe){if(l=gt.getWireframeAttribute(n),void 0===l)return;u=2}const c=n.drawRange,h=n.attributes.position;let d=c.start*u,p=(c.start+c.count)*u;null!==s&&(d=Math.max(d,s.start*u),p=Math.min(p,(s.start+s.count)*u)),null!==l?(d=Math.max(d,0),p=Math.min(p,l.count)):null!=h&&(d=Math.max(d,0),p=Math.min(p,h.count));const f=p-d;if(f<0||f===1/0)return;let m;Pt.setup(i,r,a,n,l);let g=Ct;if(null!==l&&(m=mt.get(l),g=Rt,g.setIndex(m)),i.isMesh)!0===r.wireframe?(ut.setLineWidth(r.wireframeLinewidth*ot()),g.setMode(Ot.LINES)):g.setMode(Ot.TRIANGLES);else if(i.isLine){let t=r.linewidth;void 0===t&&(t=1),ut.setLineWidth(t*ot()),i.isLineSegments?g.setMode(Ot.LINES):i.isLineLoop?g.setMode(Ot.LINE_LOOP):g.setMode(Ot.LINE_STRIP)}else i.isPoints?g.setMode(Ot.POINTS):i.isSprite&&g.setMode(Ot.TRIANGLES);if(i.isBatchedMesh)if(null!==i._multiDrawInstances)g.renderMultiDrawInstances(i._multiDrawStarts,i._multiDrawCounts,i._multiDrawCount,i._multiDrawInstances);else if(at.get("WEBGL_multi_draw"))g.renderMultiDraw(i._multiDrawStarts,i._multiDrawCounts,i._multiDrawCount);else{const t=i._multiDrawStarts,e=i._multiDrawCounts,n=i._multiDrawCount,s=l?mt.get(l).bytesPerElement:1,o=ht.get(r).currentProgram.getUniforms();for(let r=0;r<n;r++)o.setValue(Ot,"_gl_DrawID",r),g.render(t[r]/s,e[r])}else if(i.isInstancedMesh)g.renderInstances(d,f,i.count);else if(n.isInstancedBufferGeometry){const t=void 0!==n._maxInstanceCount?n._maxInstanceCount:1/0,e=Math.min(n.instanceCount,t);g.renderInstances(d,f,e)}else g.render(d,f)},this.compile=function(t,e,n=null){null===n&&(n=t),v=bt.get(n),v.init(e),_.push(v),n.traverseVisible((function(t){t.isLight&&t.layers.test(e.layers)&&(v.pushLight(t),t.castShadow&&v.pushShadow(t))})),t!==n&&t.traverseVisible((function(t){t.isLight&&t.layers.test(e.layers)&&(v.pushLight(t),t.castShadow&&v.pushShadow(t))})),v.setupLights();const r=new Set;return t.traverse((function(t){if(!(t.isMesh||t.isPoints||t.isLine||t.isSprite))return;const e=t.material;if(e)if(Array.isArray(e))for(let i=0;i<e.length;i++){const s=e[i];Vt(s,n,t),r.add(s)}else Vt(e,n,t),r.add(e)})),_.pop(),v=null,r},this.compileAsync=function(t,e,n=null){const r=this.compile(t,e,n);return new Promise((e=>{function n(){r.forEach((function(t){ht.get(t).currentProgram.isReady()&&r.delete(t)})),0!==r.size?setTimeout(n,10):e(t)}null!==at.get("KHR_parallel_shader_compile")?n():setTimeout(n,10)}))};let Gt=null;function jt(){Wt.stop()}function Ht(){Wt.start()}const Wt=new Wr;function qt(t,e,n,r){if(!1===t.visible)return;if(t.layers.test(e.layers))if(t.isGroup)n=t.renderOrder;else if(t.isLOD)!0===t.autoUpdate&&t.update(e);else if(t.isLight)v.pushLight(t),t.castShadow&&v.pushShadow(t);else if(t.isSprite){if(!t.frustumCulled||K.intersectsSprite(t)){r&&rt.setFromMatrixPosition(t.matrixWorld).applyMatrix4(et);const e=vt.update(t),i=t.material;i.visible&&g.push(t,e,i,n,rt.z,null)}}else if((t.isMesh||t.isLine||t.isPoints)&&(!t.frustumCulled||K.intersectsObject(t))){const e=vt.update(t),i=t.material;if(r&&(void 0!==t.boundingSphere?(null===t.boundingSphere&&t.computeBoundingSphere(),rt.copy(t.boundingSphere.center)):(null===e.boundingSphere&&e.computeBoundingSphere(),rt.copy(e.boundingSphere.center)),rt.applyMatrix4(t.matrixWorld).applyMatrix4(et)),Array.isArray(i)){const r=e.groups;for(let s=0,o=r.length;s<o;s++){const o=r[s],a=i[o.materialIndex];a&&a.visible&&g.push(t,e,a,n,rt.z,o)}}else i.visible&&g.push(t,e,i,n,rt.z,null)}const i=t.children;for(let t=0,s=i.length;t<s;t++)qt(i[t],e,n,r)}function Xt(t,e,n,r){const i=t.opaque,s=t.transmissive,o=t.transparent;v.setupLightsView(n),!0===J&&wt.setGlobalState(x.clippingPlanes,n),r&&ut.viewport(L.copy(r)),i.length>0&&$t(i,e,n),s.length>0&&$t(s,e,n),o.length>0&&$t(o,e,n),ut.buffers.depth.setTest(!0),ut.buffers.depth.setMask(!0),ut.buffers.color.setMask(!0),ut.setPolygonOffset(!1)}function Zt(t,e,n,r){if(null!==(!0===n.isScene?n.overrideMaterial:null))return;void 0===v.state.transmissionRenderTarget[r.id]&&(v.state.transmissionRenderTarget[r.id]=new ye(1,1,{generateMipmaps:!0,type:at.has("EXT_color_buffer_half_float")||at.has("EXT_color_buffer_float")?N:S,minFilter:w,samples:4,stencilBuffer:s,resolveDepthBuffer:!1,resolveStencilBuffer:!1,colorSpace:ee.workingColorSpace}));const i=v.state.transmissionRenderTarget[r.id],o=r.viewport||L;i.setSize(o.z,o.w);const a=x.getRenderTarget();x.setRenderTarget(i),x.getClearColor(B),G=x.getClearAlpha(),G<1&&x.setClearColor(16777215,.5),x.clear(),st&&Mt.render(n);const l=x.toneMapping;x.toneMapping=0;const u=r.viewport;if(void 0!==r.viewport&&(r.viewport=void 0),v.setupLightsView(r),!0===J&&wt.setGlobalState(x.clippingPlanes,r),$t(t,n,r),dt.updateMultisampleRenderTarget(i),dt.updateRenderTargetMipmap(i),!1===at.has("WEBGL_multisampled_render_to_texture")){let t=!1;for(let i=0,s=e.length;i<s;i++){const s=e[i],o=s.object,a=s.geometry,l=s.material,u=s.group;if(2===l.side&&o.layers.test(r.layers)){const e=l.side;l.side=1,l.needsUpdate=!0,Yt(o,n,r,a,l,u),l.side=e,l.needsUpdate=!0,t=!0}}!0===t&&(dt.updateMultisampleRenderTarget(i),dt.updateRenderTargetMipmap(i))}x.setRenderTarget(a),x.setClearColor(B,G),void 0!==u&&(r.viewport=u),x.toneMapping=l}function $t(t,e,n){const r=!0===e.isScene?e.overrideMaterial:null;for(let i=0,s=t.length;i<s;i++){const s=t[i],o=s.object,a=s.geometry,l=null===r?s.material:r,u=s.group;o.layers.test(n.layers)&&Yt(o,e,n,a,l,u)}}function Yt(t,e,n,r,i,s){t.onBeforeRender(x,e,n,r,i,s),t.modelViewMatrix.multiplyMatrices(n.matrixWorldInverse,t.matrixWorld),t.normalMatrix.getNormalMatrix(t.modelViewMatrix),i.onBeforeRender(x,e,n,r,t,s),!0===i.transparent&&2===i.side&&!1===i.forceSinglePass?(i.side=1,i.needsUpdate=!0,x.renderBufferDirect(n,e,r,i,t,s),i.side=0,i.needsUpdate=!0,x.renderBufferDirect(n,e,r,i,t,s),i.side=2):x.renderBufferDirect(n,e,r,i,t,s),t.onAfterRender(x,e,n,r,i,s)}function Kt(t,e,n){!0!==e.isScene&&(e=it);const r=ht.get(t),i=v.state.lights,s=v.state.shadowsArray,o=i.state.version,a=yt.getParameters(t,i.state,s,e,n),l=yt.getProgramCacheKey(a);let u=r.programs;r.environment=t.isMeshStandardMaterial?e.environment:null,r.fog=e.fog,r.envMap=(t.isMeshStandardMaterial?ft:pt).get(t.envMap||r.environment),r.envMapRotation=null!==r.environment&&null===t.envMap?e.environmentRotation:t.envMapRotation,void 0===u&&(t.addEventListener("dispose",zt),u=new Map,r.programs=u);let c=u.get(l);if(void 0!==c){if(r.currentProgram===c&&r.lightsStateVersion===o)return ne(t,a),c}else a.uniforms=yt.getUniforms(t),t.onBeforeCompile(a,x),c=yt.acquireProgram(a,l),u.set(l,c),r.uniforms=a.uniforms;const h=r.uniforms;return(t.isShaderMaterial||t.isRawShaderMaterial)&&!0!==t.clipping||(h.clippingPlanes=wt.uniform),ne(t,a),r.needsLights=function(t){return t.isMeshLambertMaterial||t.isMeshToonMaterial||t.isMeshPhongMaterial||t.isMeshStandardMaterial||t.isShadowMaterial||t.isShaderMaterial&&!0===t.lights}(t),r.lightsStateVersion=o,r.needsLights&&(h.ambientLightColor.value=i.state.ambient,h.lightProbe.value=i.state.probe,h.directionalLights.value=i.state.directional,h.directionalLightShadows.value=i.state.directionalShadow,h.spotLights.value=i.state.spot,h.spotLightShadows.value=i.state.spotShadow,h.rectAreaLights.value=i.state.rectArea,h.ltc_1.value=i.state.rectAreaLTC1,h.ltc_2.value=i.state.rectAreaLTC2,h.pointLights.value=i.state.point,h.pointLightShadows.value=i.state.pointShadow,h.hemisphereLights.value=i.state.hemi,h.directionalShadowMap.value=i.state.directionalShadowMap,h.directionalShadowMatrix.value=i.state.directionalShadowMatrix,h.spotShadowMap.value=i.state.spotShadowMap,h.spotLightMatrix.value=i.state.spotLightMatrix,h.spotLightMap.value=i.state.spotLightMap,h.pointShadowMap.value=i.state.pointShadowMap,h.pointShadowMatrix.value=i.state.pointShadowMatrix),r.currentProgram=c,r.uniformsList=null,c}function Qt(t){if(null===t.uniformsList){const e=t.currentProgram.getUniforms();t.uniformsList=Us.seqWithValue(e.seq,t.uniforms)}return t.uniformsList}function ne(t,e){const n=ht.get(t);n.outputColorSpace=e.outputColorSpace,n.batching=e.batching,n.batchingColor=e.batchingColor,n.instancing=e.instancing,n.instancingColor=e.instancingColor,n.instancingMorph=e.instancingMorph,n.skinning=e.skinning,n.morphTargets=e.morphTargets,n.morphNormals=e.morphNormals,n.morphColors=e.morphColors,n.morphTargetsCount=e.morphTargetsCount,n.numClippingPlanes=e.numClippingPlanes,n.numIntersection=e.numClipIntersection,n.vertexAlphas=e.vertexAlphas,n.vertexTangents=e.vertexTangents,n.toneMapping=e.toneMapping}Wt.setAnimationLoop((function(t){Gt&&Gt(t)})),"undefined"!=typeof self&&Wt.setContext(self),this.setAnimationLoop=function(t){Gt=t,Ut.setAnimationLoop(t),null===t?Wt.stop():Wt.start()},Ut.addEventListener("sessionstart",jt),Ut.addEventListener("sessionend",Ht),this.render=function(t,e){if(void 0!==e&&!0!==e.isCamera)return void console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");if(!0===b)return;if(!0===t.matrixWorldAutoUpdate&&t.updateMatrixWorld(),null===e.parent&&!0===e.matrixWorldAutoUpdate&&e.updateMatrixWorld(),!0===Ut.enabled&&!0===Ut.isPresenting&&(!0===Ut.cameraAutoUpdate&&Ut.updateCamera(e),e=Ut.getCamera()),!0===t.isScene&&t.onBeforeRender(x,t,e,A),v=bt.get(t,_.length),v.init(e),_.push(v),et.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),K.setFromProjectionMatrix(et),Q=this.localClippingEnabled,J=wt.init(this.clippingPlanes,Q),g=xt.get(t,y.length),g.init(),y.push(g),!0===Ut.enabled&&!0===Ut.isPresenting){const t=x.xr.getDepthSensingMesh();null!==t&&qt(t,e,-1/0,x.sortObjects)}qt(t,e,0,x.sortObjects),g.finish(),!0===x.sortObjects&&g.sort(q,X),st=!1===Ut.enabled||!1===Ut.isPresenting||!1===Ut.hasDepthSensing(),st&&Mt.addToRenderList(g,t),this.info.render.frame++,!0===J&&wt.beginShadows();const n=v.state.shadowsArray;St.render(n,t,e),!0===J&&wt.endShadows(),!0===this.info.autoReset&&this.info.reset();const r=g.opaque,i=g.transmissive;if(v.setupLights(),e.isArrayCamera){const n=e.cameras;if(i.length>0)for(let e=0,s=n.length;e<s;e++){Zt(r,i,t,n[e])}st&&Mt.render(t);for(let e=0,r=n.length;e<r;e++){const r=n[e];Xt(g,t,r,r.viewport)}}else i.length>0&&Zt(r,i,t,e),st&&Mt.render(t),Xt(g,t,e);null!==A&&(dt.updateMultisampleRenderTarget(A),dt.updateRenderTargetMipmap(A)),!0===t.isScene&&t.onAfterRender(x,t,e),Pt.resetDefaultState(),R=-1,D=null,_.pop(),_.length>0?(v=_[_.length-1],!0===J&&wt.setGlobalState(x.clippingPlanes,v.state.camera)):v=null,y.pop(),g=y.length>0?y[y.length-1]:null},this.getActiveCubeFace=function(){return M},this.getActiveMipmapLevel=function(){return E},this.getRenderTarget=function(){return A},this.setRenderTargetTextures=function(t,e,n){ht.get(t.texture).__webglTexture=e,ht.get(t.depthTexture).__webglTexture=n;const r=ht.get(t);r.__hasExternalTextures=!0,r.__autoAllocateDepthBuffer=void 0===n,r.__autoAllocateDepthBuffer||!0===at.has("WEBGL_multisampled_render_to_texture")&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),r.__useRenderToTexture=!1)},this.setRenderTargetFramebuffer=function(t,e){const n=ht.get(t);n.__webglFramebuffer=e,n.__useDefaultFramebuffer=void 0===e},this.setRenderTarget=function(t,e=0,n=0){A=t,M=e,E=n;let r=!0,i=null,s=!1,o=!1;if(t){const a=ht.get(t);if(void 0!==a.__useDefaultFramebuffer)ut.bindFramebuffer(Ot.FRAMEBUFFER,null),r=!1;else if(void 0===a.__webglFramebuffer)dt.setupRenderTarget(t);else if(a.__hasExternalTextures)dt.rebindTextures(t,ht.get(t.texture).__webglTexture,ht.get(t.depthTexture).__webglTexture);else if(t.depthBuffer){const e=t.depthTexture;if(a.__boundDepthTexture!==e){if(null!==e&&ht.has(e)&&(t.width!==e.image.width||t.height!==e.image.height))throw new Error("WebGLRenderTarget: Attached DepthTexture is initialized to the incorrect size.");dt.setupDepthRenderbuffer(t)}}const l=t.texture;(l.isData3DTexture||l.isDataArrayTexture||l.isCompressedArrayTexture)&&(o=!0);const u=ht.get(t).__webglFramebuffer;t.isWebGLCubeRenderTarget?(i=Array.isArray(u[e])?u[e][n]:u[e],s=!0):i=t.samples>0&&!1===dt.useMultisampledRTT(t)?ht.get(t).__webglMultisampledFramebuffer:Array.isArray(u)?u[n]:u,L.copy(t.viewport),U.copy(t.scissor),k=t.scissorTest}else L.copy(Z).multiplyScalar(W).floor(),U.copy($).multiplyScalar(W).floor(),k=Y;if(ut.bindFramebuffer(Ot.FRAMEBUFFER,i)&&r&&ut.drawBuffers(t,i),ut.viewport(L),ut.scissor(U),ut.setScissorTest(k),s){const r=ht.get(t.texture);Ot.framebufferTexture2D(Ot.FRAMEBUFFER,Ot.COLOR_ATTACHMENT0,Ot.TEXTURE_CUBE_MAP_POSITIVE_X+e,r.__webglTexture,n)}else if(o){const r=ht.get(t.texture),i=e||0;Ot.framebufferTextureLayer(Ot.FRAMEBUFFER,Ot.COLOR_ATTACHMENT0,r.__webglTexture,n||0,i)}R=-1},this.readRenderTargetPixels=function(t,e,n,r,i,s,o){if(!t||!t.isWebGLRenderTarget)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let a=ht.get(t).__webglFramebuffer;if(t.isWebGLCubeRenderTarget&&void 0!==o&&(a=a[o]),a){ut.bindFramebuffer(Ot.FRAMEBUFFER,a);try{const o=t.texture,a=o.format,l=o.type;if(!lt.textureFormatReadable(a))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");if(!lt.textureTypeReadable(l))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");e>=0&&e<=t.width-r&&n>=0&&n<=t.height-i&&Ot.readPixels(e,n,r,i,Nt.convert(a),Nt.convert(l),s)}finally{const t=null!==A?ht.get(A).__webglFramebuffer:null;ut.bindFramebuffer(Ot.FRAMEBUFFER,t)}}},this.readRenderTargetPixelsAsync=async function(t,e,n,r,i,s,o){if(!t||!t.isWebGLRenderTarget)throw new Error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let a=ht.get(t).__webglFramebuffer;if(t.isWebGLCubeRenderTarget&&void 0!==o&&(a=a[o]),a){const o=t.texture,l=o.format,u=o.type;if(!lt.textureFormatReadable(l))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in RGBA or implementation defined format.");if(!lt.textureTypeReadable(u))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in UnsignedByteType or implementation defined type.");if(e>=0&&e<=t.width-r&&n>=0&&n<=t.height-i){ut.bindFramebuffer(Ot.FRAMEBUFFER,a);const t=Ot.createBuffer();Ot.bindBuffer(Ot.PIXEL_PACK_BUFFER,t),Ot.bufferData(Ot.PIXEL_PACK_BUFFER,s.byteLength,Ot.STREAM_READ),Ot.readPixels(e,n,r,i,Nt.convert(l),Nt.convert(u),0);const o=null!==A?ht.get(A).__webglFramebuffer:null;ut.bindFramebuffer(Ot.FRAMEBUFFER,o);const c=Ot.fenceSync(Ot.SYNC_GPU_COMMANDS_COMPLETE,0);return Ot.flush(),await function(t,e,n){return new Promise((function(r,i){setTimeout((function s(){switch(t.clientWaitSync(e,t.SYNC_FLUSH_COMMANDS_BIT,0)){case t.WAIT_FAILED:i();break;case t.TIMEOUT_EXPIRED:setTimeout(s,n);break;default:r()}}),n)}))}(Ot,c,4),Ot.bindBuffer(Ot.PIXEL_PACK_BUFFER,t),Ot.getBufferSubData(Ot.PIXEL_PACK_BUFFER,0,s),Ot.deleteBuffer(t),Ot.deleteSync(c),s}throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: requested read bounds are out of range.")}},this.copyFramebufferToTexture=function(t,e=null,n=0){!0!==t.isTexture&&(te("WebGLRenderer: copyFramebufferToTexture function signature has changed."),e=arguments[0]||null,t=arguments[1]);const r=Math.pow(2,-n),i=Math.floor(t.image.width*r),s=Math.floor(t.image.height*r),o=null!==e?e.x:0,a=null!==e?e.y:0;dt.setTexture2D(t,0),Ot.copyTexSubImage2D(Ot.TEXTURE_2D,n,0,0,o,a,i,s),ut.unbindTexture()},this.copyTextureToTexture=function(t,e,n=null,r=null,i=0){let s,o,a,l,u,c,h,d,p;!0!==t.isTexture&&(te("WebGLRenderer: copyTextureToTexture function signature has changed."),r=arguments[0]||null,t=arguments[1],e=arguments[2],i=arguments[3]||0,n=null);const f=t.isCompressedTexture?t.mipmaps[i]:t.image;null!==n?(s=n.max.x-n.min.x,o=n.max.y-n.min.y,a=n.isBox3?n.max.z-n.min.z:1,l=n.min.x,u=n.min.y,c=n.isBox3?n.min.z:0):(s=f.width,o=f.height,a=f.depth||1,l=0,u=0,c=0),null!==r?(h=r.x,d=r.y,p=r.z):(h=0,d=0,p=0);const m=Nt.convert(e.format),g=Nt.convert(e.type);let v;e.isData3DTexture?(dt.setTexture3D(e,0),v=Ot.TEXTURE_3D):e.isDataArrayTexture||e.isCompressedArrayTexture?(dt.setTexture2DArray(e,0),v=Ot.TEXTURE_2D_ARRAY):(dt.setTexture2D(e,0),v=Ot.TEXTURE_2D),Ot.pixelStorei(Ot.UNPACK_FLIP_Y_WEBGL,e.flipY),Ot.pixelStorei(Ot.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.premultiplyAlpha),Ot.pixelStorei(Ot.UNPACK_ALIGNMENT,e.unpackAlignment);const y=Ot.getParameter(Ot.UNPACK_ROW_LENGTH),_=Ot.getParameter(Ot.UNPACK_IMAGE_HEIGHT),x=Ot.getParameter(Ot.UNPACK_SKIP_PIXELS),b=Ot.getParameter(Ot.UNPACK_SKIP_ROWS),w=Ot.getParameter(Ot.UNPACK_SKIP_IMAGES);Ot.pixelStorei(Ot.UNPACK_ROW_LENGTH,f.width),Ot.pixelStorei(Ot.UNPACK_IMAGE_HEIGHT,f.height),Ot.pixelStorei(Ot.UNPACK_SKIP_PIXELS,l),Ot.pixelStorei(Ot.UNPACK_SKIP_ROWS,u),Ot.pixelStorei(Ot.UNPACK_SKIP_IMAGES,c);const S=t.isDataArrayTexture||t.isData3DTexture,M=e.isDataArrayTexture||e.isData3DTexture;if(t.isRenderTargetTexture||t.isDepthTexture){const n=ht.get(t),r=ht.get(e),f=ht.get(n.__renderTarget),m=ht.get(r.__renderTarget);ut.bindFramebuffer(Ot.READ_FRAMEBUFFER,f.__webglFramebuffer),ut.bindFramebuffer(Ot.DRAW_FRAMEBUFFER,m.__webglFramebuffer);for(let n=0;n<a;n++)S&&Ot.framebufferTextureLayer(Ot.READ_FRAMEBUFFER,Ot.COLOR_ATTACHMENT0,ht.get(t).__webglTexture,i,c+n),t.isDepthTexture?(M&&Ot.framebufferTextureLayer(Ot.DRAW_FRAMEBUFFER,Ot.COLOR_ATTACHMENT0,ht.get(e).__webglTexture,i,p+n),Ot.blitFramebuffer(l,u,s,o,h,d,s,o,Ot.DEPTH_BUFFER_BIT,Ot.NEAREST)):M?Ot.copyTexSubImage3D(v,i,h,d,p+n,l,u,s,o):Ot.copyTexSubImage2D(v,i,h,d,p+n,l,u,s,o);ut.bindFramebuffer(Ot.READ_FRAMEBUFFER,null),ut.bindFramebuffer(Ot.DRAW_FRAMEBUFFER,null)}else M?t.isDataTexture||t.isData3DTexture?Ot.texSubImage3D(v,i,h,d,p,s,o,a,m,g,f.data):e.isCompressedArrayTexture?Ot.compressedTexSubImage3D(v,i,h,d,p,s,o,a,m,f.data):Ot.texSubImage3D(v,i,h,d,p,s,o,a,m,g,f):t.isDataTexture?Ot.texSubImage2D(Ot.TEXTURE_2D,i,h,d,s,o,m,g,f.data):t.isCompressedTexture?Ot.compressedTexSubImage2D(Ot.TEXTURE_2D,i,h,d,f.width,f.height,m,f.data):Ot.texSubImage2D(Ot.TEXTURE_2D,i,h,d,s,o,m,g,f);Ot.pixelStorei(Ot.UNPACK_ROW_LENGTH,y),Ot.pixelStorei(Ot.UNPACK_IMAGE_HEIGHT,_),Ot.pixelStorei(Ot.UNPACK_SKIP_PIXELS,x),Ot.pixelStorei(Ot.UNPACK_SKIP_ROWS,b),Ot.pixelStorei(Ot.UNPACK_SKIP_IMAGES,w),0===i&&e.generateMipmaps&&Ot.generateMipmap(v),ut.unbindTexture()},this.copyTextureToTexture3D=function(t,e,n=null,r=null,i=0){return!0!==t.isTexture&&(te("WebGLRenderer: copyTextureToTexture3D function signature has changed."),n=arguments[0]||null,r=arguments[1]||null,t=arguments[2],e=arguments[3],i=arguments[4]||0),te('WebGLRenderer: copyTextureToTexture3D function has been deprecated. Use "copyTextureToTexture" instead.'),this.copyTextureToTexture(t,e,n,r,i)},this.initRenderTarget=function(t){void 0===ht.get(t).__webglFramebuffer&&dt.setupRenderTarget(t)},this.initTexture=function(t){t.isCubeTexture?dt.setTextureCube(t,0):t.isData3DTexture?dt.setTexture3D(t,0):t.isDataArrayTexture||t.isCompressedArrayTexture?dt.setTexture2DArray(t,0):dt.setTexture2D(t,0),ut.unbindTexture()},this.resetState=function(){M=0,E=0,A=null,ut.reset(),Pt.reset()},"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get coordinateSystem(){return Ot}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(t){this._outputColorSpace=t;const e=this.getContext();e.drawingBufferColorspace=ee._getDrawingBufferColorSpace(t),e.unpackColorSpace=ee._getUnpackColorSpace()}},Scene:ko,PerspectiveCamera:Or,Raycaster:Qa,SRGBColorSpace:Tt,TextureLoader:class extends Oa{constructor(t){super(t)}load(t,e,n,r){const i=new me,s=new Da(this.manager);return s.setCrossOrigin(this.crossOrigin),s.setPath(this.path),s.load(t,(function(t){i.image=t,i.needsUpdate=!0,void 0!==e&&e(i)}),n,r),i}},Vector2:Xt,Vector3:we,Box3:Ee,Color:Wn,Mesh:br,SphereGeometry:pa,MeshBasicMaterial:$n,BackSide:1,EventDispatcher:Lt,MOUSE:i,Quaternion:be,Spherical:nl,Clock:ja},IO=(0,Ol.Z)({props:{width:{default:window.innerWidth,onChange:function(t,e,n){isNaN(t)&&(e.width=n)}},height:{default:window.innerHeight,onChange:function(t,e,n){isNaN(t)&&(e.height=n)}},backgroundColor:{default:"#000011"},backgroundImageUrl:{},onBackgroundImageLoaded:{},showNavInfo:{default:!0},skyRadius:{default:5e4},objects:{default:[]},lights:{default:[]},enablePointerInteraction:{default:!0,onChange:function(t,e){e.hoverObj=null,e.toolTipElem&&(e.toolTipElem.innerHTML="")},triggerUpdate:!1},lineHoverPrecision:{default:1,triggerUpdate:!1},hoverOrderComparator:{default:function(){return-1},triggerUpdate:!1},hoverFilter:{default:function(){return!0},triggerUpdate:!1},tooltipContent:{triggerUpdate:!1},hoverDuringDrag:{default:!1,triggerUpdate:!1},clickAfterDrag:{default:!1,triggerUpdate:!1},onHover:{default:function(){},triggerUpdate:!1},onClick:{default:function(){},triggerUpdate:!1},onRightClick:{triggerUpdate:!1}},methods:{tick:function(t){if(t.initialised){if(t.controls.update&&t.controls.update(Math.min(1,t.clock.getDelta())),t.postProcessingComposer?t.postProcessingComposer.render():t.renderer.render(t.scene,t.camera),t.extraRenderers.forEach((function(e){return e.render(t.scene,t.camera)})),t.enablePointerInteraction){var e=null;if(t.hoverDuringDrag||!t.isPointerDragging){var n=this.intersectingObjects(t.pointerPos.x,t.pointerPos.y).filter((function(e){return t.hoverFilter(e.object)})).sort((function(e,n){return t.hoverOrderComparator(e.object,n.object)})),r=n.length?n[0]:null;e=r?r.object:null,t.intersectionPoint=r?r.point:null}e!==t.hoverObj&&(t.onHover(e,t.hoverObj),t.toolTipElem.innerHTML=e&&(0,Dl.Z)(t.tooltipContent)(e)||"",t.hoverObj=e)}t.tweenGroup.update()}return this},getPointerPos:function(t){var e=t.pointerPos;return{x:e.x,y:e.y}},cameraPosition:function(t,e,n,r){var i=t.camera;if(e&&t.initialised){var s=e,o=n||{x:0,y:0,z:0};if(r){var a=Object.assign({},i.position),l=h();t.tweenGroup.add(new EO.kX(a).to(s,r).easing(EO.oY.Quadratic.Out).onUpdate(u).start()),t.tweenGroup.add(new EO.kX(l).to(o,r/3).easing(EO.oY.Quadratic.Out).onUpdate(c).start())}else u(s),c(o);return this}return Object.assign({},i.position,{lookAt:h()});function u(t){var e=t.x,n=t.y,r=t.z;void 0!==e&&(i.position.x=e),void 0!==n&&(i.position.y=n),void 0!==r&&(i.position.z=r)}function c(e){var n=new PO.Vector3(e.x,e.y,e.z);t.controls.target?t.controls.target=n:i.lookAt(n)}function h(){return Object.assign(new PO.Vector3(0,0,-1e3).applyQuaternion(i.quaternion).add(i.position))}},zoomToFit:function(t){for(var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10,r=arguments.length,i=new Array(r>3?r-3:0),s=3;s<r;s++)i[s-3]=arguments[s];return this.fitToBbox(this.getBbox.apply(this,i),e,n)},fitToBbox:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10,i=t.camera;if(e){var s=new PO.Vector3(0,0,0),o=2*Math.max.apply(Math,RO(Object.entries(e).map((function(t){var e=CO(t,2),n=e[0],r=e[1];return Math.max.apply(Math,RO(r.map((function(t){return Math.abs(s[n]-t)}))))})))),a=(1-2*r/t.height)*i.fov,l=o/Math.atan(a*Math.PI/180),u=l/i.aspect,c=Math.max(l,u);if(c>0){var h=s.clone().sub(i.position).normalize().multiplyScalar(-c);this.cameraPosition(h,s,n)}}return this},getBbox:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){return!0},n=new PO.Box3(new PO.Vector3(0,0,0),new PO.Vector3(0,0,0)),r=t.objects.filter(e);return r.length?(r.forEach((function(t){return n.expandByObject(t)})),Object.assign.apply(Object,RO(["x","y","z"].map((function(t){return AO({},t,[n.min[t],n.max[t]])}))))):null},getScreenCoords:function(t,e,n,r){var i=new PO.Vector3(e,n,r);return i.project(this.camera()),{x:(i.x+1)*t.width/2,y:-(i.y-1)*t.height/2}},getSceneCoords:function(t,e,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=new PO.Vector2(e/t.width*2-1,-n/t.height*2+1),s=new PO.Raycaster;return s.setFromCamera(i,t.camera),Object.assign({},s.ray.at(r,new PO.Vector3))},intersectingObjects:function(t,e,n){var r=new PO.Vector2(e/t.width*2-1,-n/t.height*2+1),i=new PO.Raycaster;return i.params.Line.threshold=t.lineHoverPrecision,i.setFromCamera(r,t.camera),i.intersectObjects(t.objects,!0)},renderer:function(t){return t.renderer},scene:function(t){return t.scene},camera:function(t){return t.camera},postProcessingComposer:function(t){return t.postProcessingComposer},controls:function(t){return t.controls},tbControls:function(t){return t.controls}},stateInit:function(){return{scene:new PO.Scene,camera:new PO.PerspectiveCamera,clock:new PO.Clock,tweenGroup:new EO.ZA}},init:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=n.controlType,i=void 0===r?"trackball":r,s=n.useWebGPU,o=void 0!==s&&s,a=n.rendererConfig,l=void 0===a?{}:a,u=n.extraRenderers,c=void 0===u?[]:u,h=n.waitForLoadComplete,d=void 0===h||h;t.innerHTML="",t.appendChild(e.container=document.createElement("div")),e.container.className="scene-container",e.container.style.position="relative",e.container.appendChild(e.navInfo=document.createElement("div")),e.navInfo.className="scene-nav-info",e.navInfo.textContent={orbit:"Left-click: rotate, Mouse-wheel/middle-click: zoom, Right-click: pan",trackball:"Left-click: rotate, Mouse-wheel/middle-click: zoom, Right-click: pan",fly:"WASD: move, R|F: up | down, Q|E: roll, up|down: pitch, left|right: yaw"}[i]||"",e.navInfo.style.display=e.showNavInfo?null:"none",e.toolTipElem=document.createElement("div"),e.toolTipElem.classList.add("scene-tooltip"),e.container.appendChild(e.toolTipElem),e.pointerPos=new PO.Vector2,e.pointerPos.x=-2,e.pointerPos.y=-2,["pointermove","pointerdown"].forEach((function(t){return e.container.addEventListener(t,(function(n){if("pointerdown"===t&&(e.isPointerPressed=!0),!e.isPointerDragging&&"pointermove"===n.type&&(n.pressure>0||e.isPointerPressed)&&("touch"!==n.pointerType||void 0===n.movementX||[n.movementX,n.movementY].some((function(t){return Math.abs(t)>1})))&&(e.isPointerDragging=!0),e.enablePointerInteraction){var r=(i=e.container,s=i.getBoundingClientRect(),o=window.pageXOffset||document.documentElement.scrollLeft,a=window.pageYOffset||document.documentElement.scrollTop,{top:s.top+a,left:s.left+o});e.pointerPos.x=n.pageX-r.left,e.pointerPos.y=n.pageY-r.top,e.toolTipElem.style.top="".concat(e.pointerPos.y,"px"),e.toolTipElem.style.left="".concat(e.pointerPos.x,"px"),e.toolTipElem.style.transform="translate(-".concat(e.pointerPos.x/e.width*100,"%, ").concat(e.height-e.pointerPos.y<100?"calc(-100% - 8px)":"21px",")")}var i,s,o,a}),{passive:!0})})),e.container.addEventListener("pointerup",(function(t){e.isPointerPressed=!1,e.isPointerDragging&&(e.isPointerDragging=!1,!e.clickAfterDrag)||requestAnimationFrame((function(){0===t.button&&e.onClick(e.hoverObj||null,t,e.intersectionPoint),2===t.button&&e.onRightClick&&e.onRightClick(e.hoverObj||null,t,e.intersectionPoint)}))}),{passive:!0,capture:!0}),e.container.addEventListener("contextmenu",(function(t){e.onRightClick&&t.preventDefault()})),e.renderer=new(o?oP:PO.WebGLRenderer)(Object.assign({antialias:!0,alpha:!0},l)),e.renderer.setPixelRatio(Math.min(2,window.devicePixelRatio)),e.container.appendChild(e.renderer.domElement),e.extraRenderers=c,e.extraRenderers.forEach((function(t){t.domElement.style.position="absolute",t.domElement.style.top="0px",t.domElement.style.pointerEvents="none",e.container.appendChild(t.domElement)})),e.postProcessingComposer=new kI(e.renderer),e.postProcessingComposer.addPass(new BI(e.scene,e.camera)),e.controls=new{trackball:AP,orbit:sI,fly:bI}[i](e.camera,e.renderer.domElement),"fly"===i&&(e.controls.movementSpeed=300,e.controls.rollSpeed=Math.PI/6,e.controls.dragToLook=!0),"trackball"!==i&&"orbit"!==i||(e.controls.minDistance=.1,e.controls.maxDistance=e.skyRadius,e.controls.addEventListener("start",(function(){e.controlsEngaged=!0})),e.controls.addEventListener("change",(function(){e.controlsEngaged&&(e.controlsDragging=!0)})),e.controls.addEventListener("end",(function(){e.controlsEngaged=!1,e.controlsDragging=!1}))),[e.renderer,e.postProcessingComposer].concat(RO(e.extraRenderers)).forEach((function(t){return t.setSize(e.width,e.height)})),e.camera.aspect=e.width/e.height,e.camera.updateProjectionMatrix(),e.camera.position.z=1e3,e.scene.add(e.skysphere=new PO.Mesh),e.skysphere.visible=!1,e.loadComplete=e.scene.visible=!d,window.scene=e.scene},update:function(t,e){if(t.width&&t.height&&(e.hasOwnProperty("width")||e.hasOwnProperty("height"))&&(t.container.style.width="".concat(t.width,"px"),t.container.style.height="".concat(t.height,"px"),[t.renderer,t.postProcessingComposer].concat(RO(t.extraRenderers)).forEach((function(e){return e.setSize(t.width,t.height)})),t.camera.aspect=t.width/t.height,t.camera.updateProjectionMatrix()),e.hasOwnProperty("skyRadius")&&t.skyRadius&&(t.controls.hasOwnProperty("maxDistance")&&e.skyRadius&&(t.controls.maxDistance=Math.min(t.controls.maxDistance,t.skyRadius)),t.camera.far=2.5*t.skyRadius,t.camera.updateProjectionMatrix(),t.skysphere.geometry=new PO.SphereGeometry(t.skyRadius)),e.hasOwnProperty("backgroundColor")){var n=oO(t.backgroundColor).alpha;void 0===n&&(n=1),t.renderer.setClearColor(new PO.Color(MO(1,t.backgroundColor)),n)}function r(){t.loadComplete=t.scene.visible=!0}e.hasOwnProperty("backgroundImageUrl")&&(t.backgroundImageUrl?(new PO.TextureLoader).load(t.backgroundImageUrl,(function(e){e.colorSpace=PO.SRGBColorSpace,t.skysphere.material=new PO.MeshBasicMaterial({map:e,side:PO.BackSide}),t.skysphere.visible=!0,t.onBackgroundImageLoaded&&setTimeout(t.onBackgroundImageLoaded),!t.loadComplete&&r()})):(t.skysphere.visible=!1,t.skysphere.material.map=null,!t.loadComplete&&r())),e.hasOwnProperty("showNavInfo")&&(t.navInfo.style.display=t.showNavInfo?null:"none"),e.hasOwnProperty("lights")&&((e.lights||[]).forEach((function(e){return t.scene.remove(e)})),t.lights.forEach((function(e){return t.scene.add(e)}))),e.hasOwnProperty("objects")&&((e.objects||[]).forEach((function(e){return t.scene.remove(e)})),t.objects.forEach((function(e){return t.scene.add(e)})))}});function OO(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}function DO(t,e,n){return(e=function(t){var e=function(t,e){if("object"!=typeof t||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,e||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:e+""}(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function LO(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function UO(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?LO(Object(n),!0).forEach((function(e){DO(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):LO(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function kO(t){return function(t){if(Array.isArray(t))return OO(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return OO(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?OO(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function BO(t,e){var n=new e;return n._destructor&&n._destructor(),{linkProp:function(e){return{default:n[e](),onChange:function(n,r){r[t][e](n)},triggerUpdate:!1}},linkMethod:function(e){return function(n){for(var r=n[t],i=arguments.length,s=new Array(i>1?i-1:0),o=1;o<i;o++)s[o-1]=arguments[o];var a=r[e].apply(r,s);return a===r?this:a}}}}!function(t,e){void 0===e&&(e={});var n=e.insertAt;if("undefined"!=typeof document){var r=document.head||document.getElementsByTagName("head")[0],i=document.createElement("style");i.type="text/css","top"===n&&r.firstChild?r.insertBefore(i,r.firstChild):r.appendChild(i),i.styleSheet?i.styleSheet.cssText=t:i.appendChild(document.createTextNode(t))}}(".graph-info-msg {\n  top: 50%;\n  width: 100%;\n  text-align: center;\n  color: lavender;\n  opacity: 0.7;\n  font-size: 22px;\n  position: absolute;\n  font-family: Sans-serif;\n}\n\n.scene-container .clickable {\n  cursor: pointer;\n}\n\n.scene-container .grabbable {\n  cursor: move;\n  cursor: grab;\n  cursor: -moz-grab;\n  cursor: -webkit-grab;\n}\n\n.scene-container .grabbable:active {\n  cursor: grabbing;\n  cursor: -moz-grabbing;\n  cursor: -webkit-grabbing;\n}");var FO=window.THREE?window.THREE:{AmbientLight:Ga,DirectionalLight:Va,Vector3:we,REVISION:r},zO=BO("forceGraph",Au),VO=Object.assign.apply(Object,kO(["jsonUrl","graphData","numDimensions","dagMode","dagLevelDistance","dagNodeFilter","onDagError","nodeRelSize","nodeId","nodeVal","nodeResolution","nodeColor","nodeAutoColorBy","nodeOpacity","nodeVisibility","nodeThreeObject","nodeThreeObjectExtend","linkSource","linkTarget","linkVisibility","linkColor","linkAutoColorBy","linkOpacity","linkWidth","linkResolution","linkCurvature","linkCurveRotation","linkMaterial","linkThreeObject","linkThreeObjectExtend","linkPositionUpdate","linkDirectionalArrowLength","linkDirectionalArrowColor","linkDirectionalArrowRelPos","linkDirectionalArrowResolution","linkDirectionalParticles","linkDirectionalParticleSpeed","linkDirectionalParticleWidth","linkDirectionalParticleColor","linkDirectionalParticleResolution","forceEngine","d3AlphaDecay","d3VelocityDecay","d3AlphaMin","ngraphPhysics","warmupTicks","cooldownTicks","cooldownTime","onEngineTick","onEngineStop"].map((function(t){return DO({},t,zO.linkProp(t))})))),GO=Object.assign.apply(Object,kO(["refresh","getGraphBbox","d3Force","d3ReheatSimulation","emitParticle"].map((function(t){return DO({},t,zO.linkMethod(t))})))),jO=BO("renderObjs",IO),HO=Object.assign.apply(Object,kO(["width","height","backgroundColor","showNavInfo","enablePointerInteraction"].map((function(t){return DO({},t,jO.linkProp(t))})))),WO=Object.assign.apply(Object,kO(["lights","cameraPosition","postProcessingComposer"].map((function(t){return DO({},t,jO.linkMethod(t))}))).concat([{graph2ScreenCoords:jO.linkMethod("getScreenCoords"),screen2GraphCoords:jO.linkMethod("getSceneCoords")}])),qO=(0,Ol.Z)({props:UO(UO({nodeLabel:{default:"name",triggerUpdate:!1},linkLabel:{default:"name",triggerUpdate:!1},linkHoverPrecision:{default:1,onChange:function(t,e){return e.renderObjs.lineHoverPrecision(t)},triggerUpdate:!1},enableNavigationControls:{default:!0,onChange:function(t,e){var n=e.renderObjs.controls();n&&(n.enabled=t,t&&n.domElement&&n.domElement.dispatchEvent(new PointerEvent("pointerup")))},triggerUpdate:!1},enableNodeDrag:{default:!0,triggerUpdate:!1},onNodeDrag:{default:function(){},triggerUpdate:!1},onNodeDragEnd:{default:function(){},triggerUpdate:!1},onNodeClick:{triggerUpdate:!1},onNodeRightClick:{triggerUpdate:!1},onNodeHover:{triggerUpdate:!1},onLinkClick:{triggerUpdate:!1},onLinkRightClick:{triggerUpdate:!1},onLinkHover:{triggerUpdate:!1},onBackgroundClick:{triggerUpdate:!1},onBackgroundRightClick:{triggerUpdate:!1}},VO),HO),methods:UO(UO({zoomToFit:function(t,e,n){for(var r,i=arguments.length,s=new Array(i>3?i-3:0),o=3;o<i;o++)s[o-3]=arguments[o];return t.renderObjs.fitToBbox((r=t.forceGraph).getGraphBbox.apply(r,s),e,n),this},pauseAnimation:function(t){return null!==t.animationFrameRequestId&&(cancelAnimationFrame(t.animationFrameRequestId),t.animationFrameRequestId=null),this},resumeAnimation:function(t){return null===t.animationFrameRequestId&&this._animationCycle(),this},_animationCycle:function(t){t.enablePointerInteraction&&(this.renderer().domElement.style.cursor=null),t.forceGraph.tickFrame(),t.renderObjs.tick(),t.animationFrameRequestId=requestAnimationFrame(this._animationCycle)},scene:function(t){return t.renderObjs.scene()},camera:function(t){return t.renderObjs.camera()},renderer:function(t){return t.renderObjs.renderer()},controls:function(t){return t.renderObjs.controls()},tbControls:function(t){return t.renderObjs.tbControls()},_destructor:function(){this.pauseAnimation(),this.graphData({nodes:[],links:[]})}},GO),WO),stateInit:function(t){var e=t.controlType,n=t.rendererConfig,r=t.extraRenderers,i=new Au;return{forceGraph:i,renderObjs:IO({controlType:e,rendererConfig:n,extraRenderers:r}).objects([i]).lights([new FO.AmbientLight(13421772,Math.PI),new FO.DirectionalLight(16777215,.6*Math.PI)])}},init:function(t,e){t.innerHTML="",t.appendChild(e.container=document.createElement("div")),e.container.style.position="relative";var n=document.createElement("div");e.container.appendChild(n),e.renderObjs(n);var r,i=e.renderObjs.camera(),s=e.renderObjs.renderer(),o=e.renderObjs.controls();o.enabled=!!e.enableNavigationControls,e.lastSetCameraZ=i.position.z,e.container.appendChild(r=document.createElement("div")),r.className="graph-info-msg",r.textContent="",e.forceGraph.onLoading((function(){r.textContent="Loading..."})).onFinishLoading((function(){r.textContent=""})).onUpdate((function(){e.graphData=e.forceGraph.graphData(),0===i.position.x&&0===i.position.y&&i.position.z===e.lastSetCameraZ&&e.graphData.nodes.length&&(i.lookAt(e.forceGraph.position),e.lastSetCameraZ=i.position.z=170*Math.cbrt(e.graphData.nodes.length))})).onFinishUpdate((function(){if(e._dragControls){var t=e.graphData.nodes.find((function(t){return t.__initialFixedPos&&!t.__disposeControlsAfterDrag}));t?t.__disposeControlsAfterDrag=!0:e._dragControls.dispose(),e._dragControls=void 0}if(e.enableNodeDrag&&e.enablePointerInteraction&&"d3"===e.forceEngine){var n=e._dragControls=new xl(e.graphData.nodes.map((function(t){return t.__threeObj})).filter((function(t){return t})),i,s.domElement);n.addEventListener("dragstart",(function(t){o.enabled=!1,t.object.__initialPos=t.object.position.clone(),t.object.__prevPos=t.object.position.clone();var e=XO(t.object).__data;!e.__initialFixedPos&&(e.__initialFixedPos={fx:e.fx,fy:e.fy,fz:e.fz}),!e.__initialPos&&(e.__initialPos={x:e.x,y:e.y,z:e.z}),["x","y","z"].forEach((function(t){return e["f".concat(t)]=e[t]})),s.domElement.classList.add("grabbable")})),n.addEventListener("drag",(function(t){var n=XO(t.object);if(!t.object.hasOwnProperty("__graphObjType")){var r=t.object.__initialPos,i=t.object.__prevPos,s=t.object.position;n.position.add(s.clone().sub(i)),i.copy(s),s.copy(r)}var o=n.__data,a=n.position,l={x:a.x-o.x,y:a.y-o.y,z:a.z-o.z};["x","y","z"].forEach((function(t){return o["f".concat(t)]=o[t]=a[t]})),e.forceGraph.d3AlphaTarget(.3).resetCountdown(),o.__dragged=!0,e.onNodeDrag(o,l)})),n.addEventListener("dragend",(function(t){delete t.object.__initialPos,delete t.object.__prevPos;var r=XO(t.object).__data;r.__disposeControlsAfterDrag&&(n.dispose(),delete r.__disposeControlsAfterDrag);var i=r.__initialFixedPos,a=r.__initialPos,l={x:a.x-r.x,y:a.y-r.y,z:a.z-r.z};i&&(["x","y","z"].forEach((function(t){var e="f".concat(t);void 0===i[e]&&delete r[e]})),delete r.__initialFixedPos,delete r.__initialPos,r.__dragged&&(delete r.__dragged,e.onNodeDragEnd(r,l))),e.forceGraph.d3AlphaTarget(0).resetCountdown(),e.enableNavigationControls&&(o.enabled=!0,o.domElement&&o.domElement.ownerDocument&&o.domElement.ownerDocument.dispatchEvent(new PointerEvent("pointerup",{pointerType:"touch"}))),s.domElement.classList.remove("grabbable")}))}})),FO.REVISION<155&&(e.renderObjs.renderer().useLegacyLights=!1),e.renderObjs.hoverOrderComparator((function(t,e){var n=XO(t);if(!n)return 1;var r=XO(e);if(!r)return-1;var i=function(t){return"node"===t.__graphObjType};return i(r)-i(n)})).tooltipContent((function(t){var n=XO(t);return n&&(0,Dl.Z)(e["".concat(n.__graphObjType,"Label")])(n.__data)||""})).hoverDuringDrag(!1).onHover((function(t){var n=XO(t);if(n!==e.hoverObj){var r=e.hoverObj?e.hoverObj.__graphObjType:null,i=e.hoverObj?e.hoverObj.__data:null,o=n?n.__graphObjType:null,a=n?n.__data:null;if(r&&r!==o){var l=e["on".concat("node"===r?"Node":"Link","Hover")];l&&l(null,i)}if(o){var u=e["on".concat("node"===o?"Node":"Link","Hover")];u&&u(a,r===o?i:null)}s.domElement.classList[n&&e["on".concat("node"===o?"Node":"Link","Click")]||!n&&e.onBackgroundClick?"add":"remove"]("clickable"),e.hoverObj=n}})).clickAfterDrag(!1).onClick((function(t,n){var r=XO(t);if(r){var i=e["on".concat("node"===r.__graphObjType?"Node":"Link","Click")];i&&i(r.__data,n)}else e.onBackgroundClick&&e.onBackgroundClick(n)})).onRightClick((function(t,n){var r=XO(t);if(r){var i=e["on".concat("node"===r.__graphObjType?"Node":"Link","RightClick")];i&&i(r.__data,n)}else e.onBackgroundRightClick&&e.onBackgroundRightClick(n)})),this._animationCycle()}});function XO(t){for(var e=t;e&&!e.hasOwnProperty("__graphObjType");)e=e.parent;return e}},10866:function(t,e,n){"use strict";n.d(e,{A:function(){return f}});var r,i=n(50959),s=n(28680),o=n(77320),a=n(53394);function l({color:t,dimensions:e,lineWidth:n}){return i.createElement("path",{stroke:t,strokeWidth:n,d:`M${e[0]/2} 0 V${e[1]} M0 ${e[1]/2} H${e[0]}`})}function u({color:t,radius:e}){return i.createElement("circle",{cx:e,cy:e,r:e,fill:t})}!function(t){t.Lines="lines",t.Dots="dots",t.Cross="cross"}(r||(r={}));const c={[r.Dots]:"#91919a",[r.Lines]:"#eee",[r.Cross]:"#e2e2e2"},h={[r.Dots]:1,[r.Lines]:1,[r.Cross]:6},d=t=>({transform:t.transform,patternId:`pattern-${t.rfId}`});function p({id:t,variant:e=r.Dots,gap:n=20,size:p,lineWidth:f=1,offset:m=2,color:g,style:v,className:y}){const _=(0,i.useRef)(null),{transform:x,patternId:b}=(0,o.oR)(d,a.X),w=g||c[e],S=p||h[e],M=e===r.Dots,E=e===r.Cross,T=Array.isArray(n)?n:[n,n],A=[T[0]*x[2]||1,T[1]*x[2]||1],C=S*x[2],R=E?[C,C]:A,N=M?[C/m,C/m]:[R[0]/m,R[1]/m];return i.createElement("svg",{className:(0,s.Z)(["react-flow__background",y]),style:{...v,position:"absolute",width:"100%",height:"100%",top:0,left:0},ref:_,"data-testid":"rf__background"},i.createElement("pattern",{id:b+t,x:x[0]%A[0],y:x[1]%A[1],width:A[0],height:A[1],patternUnits:"userSpaceOnUse",patternTransform:`translate(-${N[0]},-${N[1]})`},M?i.createElement(u,{color:w,radius:C/m}):i.createElement(l,{dimensions:R,color:w,lineWidth:f})),i.createElement("rect",{x:"0",y:"0",width:"100%",height:"100%",fill:`url(#${b+t})`}))}p.displayName="Background";var f=(0,i.memo)(p)},77320:function(t,e,n){"use strict";n.d(e,{u5:function(){return nt},XQ:function(){return ur},HH:function(){return $t},s_:function(){return O},Ly:function(){return ht},x$:function(){return ar},tV:function(){return Qn},yn:function(){return Xe},Fb:function(){return qe},oI:function(){return q},VP:function(){return It},RX:function(){return Ot},AQ:function(){return hr},_K:function(){return Oe},oR:function(){return N},AC:function(){return P}});var r=n(50959),i=n(28680),s=n(9714),o=n(74914);const{useDebugValue:a}=r,{useSyncExternalStoreWithSelector:l}=s,u=t=>t;function c(t,e=u,n){const r=l(t.subscribe,t.getState,t.getServerState||t.getInitialState,e,n);return a(r),r}const h=(t,e)=>{const n=(0,o.M)(t),r=(t,r=e)=>c(n,t,r);return Object.assign(r,n),r};var d=n(53394),p=n(89888),f=n(41468),m=n(13802),g=n(45452),v=n(10422);const y=(0,r.createContext)(null),_=y.Provider,x=t=>`Node type "${t}" not found. Using fallback type "default".`,b=()=>"The React Flow parent container needs a width and a height to render the graph.",w=()=>"Only child nodes can use a parent extent.",S=()=>"Can't create edge. An edge needs a source and a target.",M=t=>`Marker type "${t}" doesn't exist.`,E=(t,e)=>`Couldn't create edge for ${t?"target":"source"} handle id: "${t?e.targetHandle:e.sourceHandle}", edge id: ${e.id}.`,T=()=>"Handle: No node id found. Make sure to only use a Handle inside a custom Node.",A=t=>`Edge type "${t}" not found. Using fallback type "default".`,C=t=>`Node with id "${t}" does not exist, it may have been removed. This can happen when a node is deleted before the "onNodeClick" handler is called.`,R=(()=>"[React Flow]: Seems like you have not used zustand provider as an ancestor. Help: https://reactflow.dev/error#001")();function N(t,e){const n=(0,r.useContext)(y);if(null===n)throw new Error(R);return c(n,t,e)}const P=()=>{const t=(0,r.useContext)(y);if(null===t)throw new Error(R);return(0,r.useMemo)((()=>({getState:t.getState,setState:t.setState,subscribe:t.subscribe,destroy:t.destroy})),[t])},I=t=>t.userSelectionActive?"none":"all";function O({position:t,children:e,className:n,style:s,...o}){const a=N(I),l=`${t}`.split("-");return r.createElement("div",{className:(0,i.Z)(["react-flow__panel",n,...l]),style:{...s,pointerEvents:a},...o},e)}function D({proOptions:t,position:e="bottom-right"}){return t?.hideAttribution?null:r.createElement(O,{position:e,className:"react-flow__attribution","data-message":"Please only hide this attribution when you are subscribed to React Flow Pro: https://reactflow.dev/pro"},r.createElement("a",{href:"https://reactflow.dev",target:"_blank",rel:"noopener noreferrer","aria-label":"React Flow attribution"},"React Flow"))}var L=(0,r.memo)((({x:t,y:e,label:n,labelStyle:s={},labelShowBg:o=!0,labelBgStyle:a={},labelBgPadding:l=[2,4],labelBgBorderRadius:u=2,children:c,className:h,...d})=>{const p=(0,r.useRef)(null),[f,m]=(0,r.useState)({x:0,y:0,width:0,height:0}),g=(0,i.Z)(["react-flow__edge-textwrapper",h]);return(0,r.useEffect)((()=>{if(p.current){const t=p.current.getBBox();m({x:t.x,y:t.y,width:t.width,height:t.height})}}),[n]),void 0!==n&&n?r.createElement("g",{transform:`translate(${t-f.width/2} ${e-f.height/2})`,className:g,visibility:f.width?"visible":"hidden",...d},o&&r.createElement("rect",{width:f.width+2*l[0],x:-l[0],y:-l[1],height:f.height+2*l[1],className:"react-flow__edge-textbg",style:a,rx:u,ry:u}),r.createElement("text",{className:"react-flow__edge-text",y:f.height/2,dy:"0.3em",ref:p,style:s},n),c):null}));const U=t=>({width:t.offsetWidth,height:t.offsetHeight}),k=(t,e=0,n=1)=>Math.min(Math.max(t,e),n),B=(t={x:0,y:0},e)=>({x:k(t.x,e[0][0],e[1][0]),y:k(t.y,e[0][1],e[1][1])}),F=(t,e,n)=>t<e?k(Math.abs(t-e),1,50)/50:t>n?-k(Math.abs(t-n),1,50)/50:0,z=(t,e)=>[20*F(t.x,35,e.width-35),20*F(t.y,35,e.height-35)],V=t=>t.getRootNode?.()||window?.document,G=(t,e)=>({x:Math.min(t.x,e.x),y:Math.min(t.y,e.y),x2:Math.max(t.x2,e.x2),y2:Math.max(t.y2,e.y2)}),j=({x:t,y:e,width:n,height:r})=>({x:t,y:e,x2:t+n,y2:e+r}),H=({x:t,y:e,x2:n,y2:r})=>({x:t,y:e,width:n-t,height:r-e}),W=t=>({...t.positionAbsolute||{x:0,y:0},width:t.width||0,height:t.height||0}),q=(t,e)=>H(G(j(t),j(e))),X=(t,e)=>{const n=Math.max(0,Math.min(t.x+t.width,e.x+e.width)-Math.max(t.x,e.x)),r=Math.max(0,Math.min(t.y+t.height,e.y+e.height)-Math.max(t.y,e.y));return Math.ceil(n*r)},Z=t=>!isNaN(t)&&isFinite(t),$=Symbol.for("internals"),Y=["Enter"," ","Escape"],K=(t,e)=>{0};function J(t){const e=((t=>"nativeEvent"in t)(t)?t.nativeEvent:t).composedPath?.()?.[0]||t.target;return["INPUT","SELECT","TEXTAREA"].includes(e?.nodeName)||e?.hasAttribute("contenteditable")||!!e?.closest(".nokey")}const Q=t=>"clientX"in t,tt=(t,e)=>{const n=Q(t),r=n?t.clientX:t.touches?.[0].clientX,i=n?t.clientY:t.touches?.[0].clientY;return{x:r-(e?.left??0),y:i-(e?.top??0)}},et=()=>"undefined"!=typeof navigator&&navigator?.userAgent?.indexOf("Mac")>=0,nt=({id:t,path:e,labelX:n,labelY:i,label:s,labelStyle:o,labelShowBg:a,labelBgStyle:l,labelBgPadding:u,labelBgBorderRadius:c,style:h,markerEnd:d,markerStart:p,interactionWidth:f=20})=>r.createElement(r.Fragment,null,r.createElement("path",{id:t,style:h,d:e,fill:"none",className:"react-flow__edge-path",markerEnd:d,markerStart:p}),f&&r.createElement("path",{d:e,fill:"none",strokeOpacity:0,strokeWidth:f,className:"react-flow__edge-interaction"}),s&&Z(n)&&Z(i)?r.createElement(L,{x:n,y:i,label:s,labelStyle:o,labelShowBg:a,labelBgStyle:l,labelBgPadding:u,labelBgBorderRadius:c}):null);nt.displayName="BaseEdge";function rt(t,e,n){return void 0===n?n:r=>{const i=e().edges.find((e=>e.id===t));i&&n(r,{...i})}}function it({sourceX:t,sourceY:e,targetX:n,targetY:r}){const i=Math.abs(n-t)/2,s=n<t?n+i:n-i,o=Math.abs(r-e)/2;return[s,r<e?r+o:r-o,i,o]}function st({sourceX:t,sourceY:e,targetX:n,targetY:r,sourceControlX:i,sourceControlY:s,targetControlX:o,targetControlY:a}){const l=.125*t+.375*i+.375*o+.125*n,u=.125*e+.375*s+.375*a+.125*r;return[l,u,Math.abs(l-t),Math.abs(u-e)]}var ot,at,lt,ut,ct,ht;function dt({pos:t,x1:e,y1:n,x2:r,y2:i}){return t===ht.Left||t===ht.Right?[.5*(e+r),n]:[e,.5*(n+i)]}function pt({sourceX:t,sourceY:e,sourcePosition:n=ht.Bottom,targetX:r,targetY:i,targetPosition:s=ht.Top}){const[o,a]=dt({pos:n,x1:t,y1:e,x2:r,y2:i}),[l,u]=dt({pos:s,x1:r,y1:i,x2:t,y2:e}),[c,h,d,p]=st({sourceX:t,sourceY:e,targetX:r,targetY:i,sourceControlX:o,sourceControlY:a,targetControlX:l,targetControlY:u});return[`M${t},${e} C${o},${a} ${l},${u} ${r},${i}`,c,h,d,p]}!function(t){t.Strict="strict",t.Loose="loose"}(ot||(ot={})),function(t){t.Free="free",t.Vertical="vertical",t.Horizontal="horizontal"}(at||(at={})),function(t){t.Partial="partial",t.Full="full"}(lt||(lt={})),function(t){t.Bezier="default",t.Straight="straight",t.Step="step",t.SmoothStep="smoothstep",t.SimpleBezier="simplebezier"}(ut||(ut={})),function(t){t.Arrow="arrow",t.ArrowClosed="arrowclosed"}(ct||(ct={})),function(t){t.Left="left",t.Top="top",t.Right="right",t.Bottom="bottom"}(ht||(ht={}));const ft=(0,r.memo)((({sourceX:t,sourceY:e,targetX:n,targetY:i,sourcePosition:s=ht.Bottom,targetPosition:o=ht.Top,label:a,labelStyle:l,labelShowBg:u,labelBgStyle:c,labelBgPadding:h,labelBgBorderRadius:d,style:p,markerEnd:f,markerStart:m,interactionWidth:g})=>{const[v,y,_]=pt({sourceX:t,sourceY:e,sourcePosition:s,targetX:n,targetY:i,targetPosition:o});return r.createElement(nt,{path:v,labelX:y,labelY:_,label:a,labelStyle:l,labelShowBg:u,labelBgStyle:c,labelBgPadding:h,labelBgBorderRadius:d,style:p,markerEnd:f,markerStart:m,interactionWidth:g})}));ft.displayName="SimpleBezierEdge";const mt={[ht.Left]:{x:-1,y:0},[ht.Right]:{x:1,y:0},[ht.Top]:{x:0,y:-1},[ht.Bottom]:{x:0,y:1}},gt=(t,e)=>Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2));function vt({source:t,sourcePosition:e=ht.Bottom,target:n,targetPosition:r=ht.Top,center:i,offset:s}){const o=mt[e],a=mt[r],l={x:t.x+o.x*s,y:t.y+o.y*s},u={x:n.x+a.x*s,y:n.y+a.y*s},c=(({source:t,sourcePosition:e=ht.Bottom,target:n})=>e===ht.Left||e===ht.Right?t.x<n.x?{x:1,y:0}:{x:-1,y:0}:t.y<n.y?{x:0,y:1}:{x:0,y:-1})({source:l,sourcePosition:e,target:u}),h=0!==c.x?"x":"y",d=c[h];let p,f,m=[];const g={x:0,y:0},v={x:0,y:0},[y,_,x,b]=it({sourceX:t.x,sourceY:t.y,targetX:n.x,targetY:n.y});if(o[h]*a[h]==-1){p=i.x??y,f=i.y??_;const t=[{x:p,y:l.y},{x:p,y:u.y}],e=[{x:l.x,y:f},{x:u.x,y:f}];m=o[h]===d?"x"===h?t:e:"x"===h?e:t}else{const i=[{x:l.x,y:u.y}],c=[{x:u.x,y:l.y}];if(m="x"===h?o.x===d?c:i:o.y===d?i:c,e===r){const e=Math.abs(t[h]-n[h]);if(e<=s){const r=Math.min(s-1,s-e);o[h]===d?g[h]=(l[h]>t[h]?-1:1)*r:v[h]=(u[h]>n[h]?-1:1)*r}}if(e!==r){const t="x"===h?"y":"x",e=o[h]===a[t],n=l[t]>u[t],r=l[t]<u[t];(1===o[h]&&(!e&&n||e&&r)||1!==o[h]&&(!e&&r||e&&n))&&(m="x"===h?i:c)}const y={x:l.x+g.x,y:l.y+g.y},_={x:u.x+v.x,y:u.y+v.y};Math.max(Math.abs(y.x-m[0].x),Math.abs(_.x-m[0].x))>=Math.max(Math.abs(y.y-m[0].y),Math.abs(_.y-m[0].y))?(p=(y.x+_.x)/2,f=m[0].y):(p=m[0].x,f=(y.y+_.y)/2)}return[[t,{x:l.x+g.x,y:l.y+g.y},...m,{x:u.x+v.x,y:u.y+v.y},n],p,f,x,b]}function yt({sourceX:t,sourceY:e,sourcePosition:n=ht.Bottom,targetX:r,targetY:i,targetPosition:s=ht.Top,borderRadius:o=5,centerX:a,centerY:l,offset:u=20}){const[c,h,d,p,f]=vt({source:{x:t,y:e},sourcePosition:n,target:{x:r,y:i},targetPosition:s,center:{x:a,y:l},offset:u});return[c.reduce(((t,e,n)=>{let r="";return r=n>0&&n<c.length-1?function(t,e,n,r){const i=Math.min(gt(t,e)/2,gt(e,n)/2,r),{x:s,y:o}=e;if(t.x===s&&s===n.x||t.y===o&&o===n.y)return`L${s} ${o}`;if(t.y===o)return`L ${s+i*(t.x<n.x?-1:1)},${o}Q ${s},${o} ${s},${o+i*(t.y<n.y?1:-1)}`;const a=t.x<n.x?1:-1;return`L ${s},${o+i*(t.y<n.y?-1:1)}Q ${s},${o} ${s+i*a},${o}`}(c[n-1],e,c[n+1],o):`${0===n?"M":"L"}${e.x} ${e.y}`,t+=r}),""),h,d,p,f]}const _t=(0,r.memo)((({sourceX:t,sourceY:e,targetX:n,targetY:i,label:s,labelStyle:o,labelShowBg:a,labelBgStyle:l,labelBgPadding:u,labelBgBorderRadius:c,style:h,sourcePosition:d=ht.Bottom,targetPosition:p=ht.Top,markerEnd:f,markerStart:m,pathOptions:g,interactionWidth:v})=>{const[y,_,x]=yt({sourceX:t,sourceY:e,sourcePosition:d,targetX:n,targetY:i,targetPosition:p,borderRadius:g?.borderRadius,offset:g?.offset});return r.createElement(nt,{path:y,labelX:_,labelY:x,label:s,labelStyle:o,labelShowBg:a,labelBgStyle:l,labelBgPadding:u,labelBgBorderRadius:c,style:h,markerEnd:f,markerStart:m,interactionWidth:v})}));_t.displayName="SmoothStepEdge";const xt=(0,r.memo)((t=>r.createElement(_t,{...t,pathOptions:(0,r.useMemo)((()=>({borderRadius:0,offset:t.pathOptions?.offset})),[t.pathOptions?.offset])})));xt.displayName="StepEdge";const bt=(0,r.memo)((({sourceX:t,sourceY:e,targetX:n,targetY:i,label:s,labelStyle:o,labelShowBg:a,labelBgStyle:l,labelBgPadding:u,labelBgBorderRadius:c,style:h,markerEnd:d,markerStart:p,interactionWidth:f})=>{const[m,g,v]=function({sourceX:t,sourceY:e,targetX:n,targetY:r}){const[i,s,o,a]=it({sourceX:t,sourceY:e,targetX:n,targetY:r});return[`M ${t},${e}L ${n},${r}`,i,s,o,a]}({sourceX:t,sourceY:e,targetX:n,targetY:i});return r.createElement(nt,{path:m,labelX:g,labelY:v,label:s,labelStyle:o,labelShowBg:a,labelBgStyle:l,labelBgPadding:u,labelBgBorderRadius:c,style:h,markerEnd:d,markerStart:p,interactionWidth:f})}));function wt(t,e){return t>=0?.5*t:25*e*Math.sqrt(-t)}function St({pos:t,x1:e,y1:n,x2:r,y2:i,c:s}){switch(t){case ht.Left:return[e-wt(e-r,s),n];case ht.Right:return[e+wt(r-e,s),n];case ht.Top:return[e,n-wt(n-i,s)];case ht.Bottom:return[e,n+wt(i-n,s)]}}function Mt({sourceX:t,sourceY:e,sourcePosition:n=ht.Bottom,targetX:r,targetY:i,targetPosition:s=ht.Top,curvature:o=.25}){const[a,l]=St({pos:n,x1:t,y1:e,x2:r,y2:i,c:o}),[u,c]=St({pos:s,x1:r,y1:i,x2:t,y2:e,c:o}),[h,d,p,f]=st({sourceX:t,sourceY:e,targetX:r,targetY:i,sourceControlX:a,sourceControlY:l,targetControlX:u,targetControlY:c});return[`M${t},${e} C${a},${l} ${u},${c} ${r},${i}`,h,d,p,f]}bt.displayName="StraightEdge";const Et=(0,r.memo)((({sourceX:t,sourceY:e,targetX:n,targetY:i,sourcePosition:s=ht.Bottom,targetPosition:o=ht.Top,label:a,labelStyle:l,labelShowBg:u,labelBgStyle:c,labelBgPadding:h,labelBgBorderRadius:d,style:p,markerEnd:f,markerStart:m,pathOptions:g,interactionWidth:v})=>{const[y,_,x]=Mt({sourceX:t,sourceY:e,sourcePosition:s,targetX:n,targetY:i,targetPosition:o,curvature:g?.curvature});return r.createElement(nt,{path:y,labelX:_,labelY:x,label:a,labelStyle:l,labelShowBg:u,labelBgStyle:c,labelBgPadding:h,labelBgBorderRadius:d,style:p,markerEnd:f,markerStart:m,interactionWidth:v})}));Et.displayName="BezierEdge";const Tt=(0,r.createContext)(null),At=Tt.Provider;Tt.Consumer;const Ct=({source:t,sourceHandle:e,target:n,targetHandle:r})=>`reactflow__edge-${t}${e||""}-${n}${r||""}`,Rt=(t,e)=>{if(void 0===t)return"";if("string"==typeof t)return t;return`${e?`${e}__`:""}${Object.keys(t).sort().map((e=>`${e}=${t[e]}`)).join("&")}`},Nt=({x:t,y:e},[n,r,i],s,[o,a])=>{const l={x:(t-n)/i,y:(e-r)/i};return s?{x:o*Math.round(l.x/o),y:a*Math.round(l.y/a)}:l},Pt=({x:t,y:e},[n,r,i])=>({x:t*i+n,y:e*i+r}),It=(t,e=[0,0])=>{if(!t)return{x:0,y:0,positionAbsolute:{x:0,y:0}};const n=(t.width??0)*e[0],r=(t.height??0)*e[1],i={x:t.position.x-n,y:t.position.y-r};return{...i,positionAbsolute:t.positionAbsolute?{x:t.positionAbsolute.x-n,y:t.positionAbsolute.y-r}:i}},Ot=(t,e=[0,0])=>{if(0===t.length)return{x:0,y:0,width:0,height:0};const n=t.reduce(((t,n)=>{const{x:r,y:i}=It(n,e).positionAbsolute;return G(t,j({x:r,y:i,width:n.width||0,height:n.height||0}))}),{x:1/0,y:1/0,x2:-1/0,y2:-1/0});return H(n)},Dt=(t,e,[n,r,i]=[0,0,1],s=!1,o=!1,a=[0,0])=>{const l={x:(e.x-n)/i,y:(e.y-r)/i,width:e.width/i,height:e.height/i},u=[];return t.forEach((t=>{const{width:e,height:n,selectable:r=!0,hidden:i=!1}=t;if(o&&!r||i)return!1;const{positionAbsolute:c}=It(t,a),h={x:c.x,y:c.y,width:e||0,height:n||0},d=X(l,h);(void 0===e||void 0===n||null===e||null===n||s&&d>0||d>=(e||0)*(n||0)||t.dragging)&&u.push(t)})),u},Lt=(t,e)=>{const n=t.map((t=>t.id));return e.filter((t=>n.includes(t.source)||n.includes(t.target)))},Ut=(t,e,n,r,i,s=.1)=>{const o=e/(t.width*(1+s)),a=n/(t.height*(1+s)),l=Math.min(o,a),u=k(l,r,i);return{x:e/2-(t.x+t.width/2)*u,y:n/2-(t.y+t.height/2)*u,zoom:u}},kt=(t,e=0)=>t.transition().duration(e);function Bt(t,e,n,r){return(e[n]||[]).reduce(((e,i)=>(`${t.id}-${i.id}-${n}`!==r&&e.push({id:i.id||null,type:n,nodeId:t.id,x:(t.positionAbsolute?.x??0)+i.x+i.width/2,y:(t.positionAbsolute?.y??0)+i.y+i.height/2}),e)),[])}const Ft={source:null,target:null,sourceHandle:null,targetHandle:null},zt=()=>({handleDomNode:null,isValid:!1,connection:Ft,endHandle:null});function Vt(t,e,n,r,i,s,o){const a="target"===i,l=o.querySelector(`.react-flow__handle[data-id="${t?.nodeId}-${t?.id}-${t?.type}"]`),u={...zt(),handleDomNode:l};if(l){const t=Gt(void 0,l),i=l.getAttribute("data-nodeid"),o=l.getAttribute("data-handleid"),c=l.classList.contains("connectable"),h=l.classList.contains("connectableend"),d={source:a?i:n,sourceHandle:a?o:r,target:a?n:i,targetHandle:a?r:o};u.connection=d;c&&h&&(e===ot.Strict?a&&"source"===t||!a&&"target"===t:i!==n||o!==r)&&(u.endHandle={nodeId:i,handleId:o,type:t},u.isValid=s(d))}return u}function Gt(t,e){return t||(e?.classList.contains("target")?"target":e?.classList.contains("source")?"source":null)}function jt(t){t?.classList.remove("valid","connecting","react-flow__handle-valid","react-flow__handle-connecting")}function Ht(t,e){let n=null;return e?n="valid":t&&!e&&(n="invalid"),n}function Wt({event:t,handleId:e,nodeId:n,onConnect:r,isTarget:i,getState:s,setState:o,isValidConnection:a,edgeUpdaterType:l,onReconnectEnd:u}){const c=V(t.target),{connectionMode:h,domNode:d,autoPanOnConnect:p,connectionRadius:f,onConnectStart:m,panBy:g,getNodes:v,cancelConnection:y}=s();let _,x=0;const{x:b,y:w}=tt(t),S=c?.elementFromPoint(b,w),M=Gt(l,S),E=d?.getBoundingClientRect();if(!E||!M)return;let T,A=tt(t,E),C=!1,R=null,N=!1,P=null;const I=function({nodes:t,nodeId:e,handleId:n,handleType:r}){return t.reduce(((t,i)=>{if(i[$]){const{handleBounds:s}=i[$];let o=[],a=[];s&&(o=Bt(i,s,"source",`${e}-${n}-${r}`),a=Bt(i,s,"target",`${e}-${n}-${r}`)),t.push(...o,...a)}return t}),[])}({nodes:v(),nodeId:n,handleId:e,handleType:M}),O=()=>{if(!p)return;const[t,e]=z(A,E);g({x:t,y:e}),x=requestAnimationFrame(O)};function D(t){const{transform:r}=s();A=tt(t,E);const{handle:l,validHandleResult:u}=function(t,e,n,r,i,s){const{x:o,y:a}=tt(t),l=e.elementsFromPoint(o,a).find((t=>t.classList.contains("react-flow__handle")));if(l){const t=l.getAttribute("data-nodeid");if(t){const e=Gt(void 0,l),r=l.getAttribute("data-handleid"),o=s({nodeId:t,id:r,type:e});if(o){const s=i.find((n=>n.nodeId===t&&n.type===e&&n.id===r));return{handle:{id:r,type:e,nodeId:t,x:s?.x||n.x,y:s?.y||n.y},validHandleResult:o}}}}let u=[],c=1/0;if(i.forEach((t=>{const e=Math.sqrt((t.x-n.x)**2+(t.y-n.y)**2);if(e<=r){const n=s(t);e<=c&&(e<c?u=[{handle:t,validHandleResult:n}]:e===c&&u.push({handle:t,validHandleResult:n}),c=e)}})),!u.length)return{handle:null,validHandleResult:zt()};if(1===u.length)return u[0];const h=u.some((({validHandleResult:t})=>t.isValid)),d=u.some((({handle:t})=>"target"===t.type));return u.find((({handle:t,validHandleResult:e})=>d?"target"===t.type:!h||e.isValid))||u[0]}(t,c,Nt(A,r,!1,[1,1]),f,I,(t=>Vt(t,h,n,e,i?"target":"source",a,c)));if(_=l,C||(O(),C=!0),P=u.handleDomNode,R=u.connection,N=u.isValid,o({connectionPosition:_&&N?Pt({x:_.x,y:_.y},r):A,connectionStatus:Ht(!!_,N),connectionEndHandle:u.endHandle}),!_&&!N&&!P)return jt(T);R.source!==R.target&&P&&(jt(T),T=P,P.classList.add("connecting","react-flow__handle-connecting"),P.classList.toggle("valid",N),P.classList.toggle("react-flow__handle-valid",N))}function L(t){(_||P)&&R&&N&&r?.(R),s().onConnectEnd?.(t),l&&u?.(t),jt(T),y(),cancelAnimationFrame(x),C=!1,N=!1,R=null,P=null,c.removeEventListener("mousemove",D),c.removeEventListener("mouseup",L),c.removeEventListener("touchmove",D),c.removeEventListener("touchend",L)}o({connectionPosition:A,connectionStatus:null,connectionNodeId:n,connectionHandleId:e,connectionHandleType:M,connectionStartHandle:{nodeId:n,handleId:e,type:M},connectionEndHandle:null}),m?.(t,{nodeId:n,handleId:e,handleType:M}),c.addEventListener("mousemove",D),c.addEventListener("mouseup",L),c.addEventListener("touchmove",D),c.addEventListener("touchend",L)}const qt=()=>!0,Xt=t=>({connectionStartHandle:t.connectionStartHandle,connectOnClick:t.connectOnClick,noPanClassName:t.noPanClassName}),Zt=(0,r.forwardRef)((({type:t="source",position:e=ht.Top,isValidConnection:n,isConnectable:s=!0,isConnectableStart:o=!0,isConnectableEnd:a=!0,id:l,onConnect:u,children:c,className:h,onMouseDown:p,onTouchStart:f,...m},g)=>{const v=l||null,y="target"===t,_=P(),x=(0,r.useContext)(Tt),{connectOnClick:b,noPanClassName:w}=N(Xt,d.X),{connecting:M,clickConnecting:E}=N(((t,e,n)=>r=>{const{connectionStartHandle:i,connectionEndHandle:s,connectionClickStartHandle:o}=r;return{connecting:i?.nodeId===t&&i?.handleId===e&&i?.type===n||s?.nodeId===t&&s?.handleId===e&&s?.type===n,clickConnecting:o?.nodeId===t&&o?.handleId===e&&o?.type===n}})(x,v,t),d.X);x||_.getState().onError?.("010",T());const A=t=>{const{defaultEdgeOptions:e,onConnect:n,hasDefaultEdges:r}=_.getState(),i={...e,...t};if(r){const{edges:t,setEdges:e}=_.getState();e(((t,e)=>{if(!t.source||!t.target)return K(0,S()),e;let n;var r;return n="id"in(r=t)&&"source"in r&&"target"in r?{...t}:{...t,id:Ct(t)},((t,e)=>e.some((e=>!(e.source!==t.source||e.target!==t.target||e.sourceHandle!==t.sourceHandle&&(e.sourceHandle||t.sourceHandle)||e.targetHandle!==t.targetHandle&&(e.targetHandle||t.targetHandle)))))(n,e)?e:e.concat(n)})(i,t))}n?.(i),u?.(i)},C=t=>{if(!x)return;const e=Q(t);o&&(e&&0===t.button||!e)&&Wt({event:t,handleId:v,nodeId:x,onConnect:A,isTarget:y,getState:_.getState,setState:_.setState,isValidConnection:n||_.getState().isValidConnection||qt}),e?p?.(t):f?.(t)};return r.createElement("div",{"data-handleid":v,"data-nodeid":x,"data-handlepos":e,"data-id":`${x}-${v}-${t}`,className:(0,i.Z)(["react-flow__handle",`react-flow__handle-${e}`,"nodrag",w,h,{source:!y,target:y,connectable:s,connectablestart:o,connectableend:a,connecting:E,connectionindicator:s&&(o&&!M||a&&M)}]),onMouseDown:C,onTouchStart:C,onClick:b?e=>{const{onClickConnectStart:r,onClickConnectEnd:i,connectionClickStartHandle:s,connectionMode:a,isValidConnection:l}=_.getState();if(!x||!s&&!o)return;if(!s)return r?.(e,{nodeId:x,handleId:v,handleType:t}),void _.setState({connectionClickStartHandle:{nodeId:x,type:t,handleId:v}});const u=V(e.target),c=n||l||qt,{connection:h,isValid:d}=Vt({nodeId:x,id:v,type:t},a,s.nodeId,s.handleId||null,s.type,c,u);d&&A(h),i?.(e),_.setState({connectionClickStartHandle:null})}:void 0,ref:g,...m},c)}));Zt.displayName="Handle";var $t=(0,r.memo)(Zt);const Yt=({data:t,isConnectable:e,targetPosition:n=ht.Top,sourcePosition:i=ht.Bottom})=>r.createElement(r.Fragment,null,r.createElement($t,{type:"target",position:n,isConnectable:e}),t?.label,r.createElement($t,{type:"source",position:i,isConnectable:e}));Yt.displayName="DefaultNode";var Kt=(0,r.memo)(Yt);const Jt=({data:t,isConnectable:e,sourcePosition:n=ht.Bottom})=>r.createElement(r.Fragment,null,t?.label,r.createElement($t,{type:"source",position:n,isConnectable:e}));Jt.displayName="InputNode";var Qt=(0,r.memo)(Jt);const te=({data:t,isConnectable:e,targetPosition:n=ht.Top})=>r.createElement(r.Fragment,null,r.createElement($t,{type:"target",position:n,isConnectable:e}),t?.label);te.displayName="OutputNode";var ee=(0,r.memo)(te);const ne=()=>null;ne.displayName="GroupNode";const re=t=>({selectedNodes:t.getNodes().filter((t=>t.selected)),selectedEdges:t.edges.filter((t=>t.selected)).map((t=>({...t})))}),ie=t=>t.id;function se(t,e){return(0,d.X)(t.selectedNodes.map(ie),e.selectedNodes.map(ie))&&(0,d.X)(t.selectedEdges.map(ie),e.selectedEdges.map(ie))}const oe=(0,r.memo)((({onSelectionChange:t})=>{const e=P(),{selectedNodes:n,selectedEdges:i}=N(re,se);return(0,r.useEffect)((()=>{const r={nodes:n,edges:i};t?.(r),e.getState().onSelectionChange.forEach((t=>t(r)))}),[n,i,t]),null}));oe.displayName="SelectionListener";const ae=t=>!!t.onSelectionChange;function le({onSelectionChange:t}){const e=N(ae);return t||e?r.createElement(oe,{onSelectionChange:t}):null}const ue=t=>({setNodes:t.setNodes,setEdges:t.setEdges,setDefaultNodesAndEdges:t.setDefaultNodesAndEdges,setMinZoom:t.setMinZoom,setMaxZoom:t.setMaxZoom,setTranslateExtent:t.setTranslateExtent,setNodeExtent:t.setNodeExtent,reset:t.reset});function ce(t,e){(0,r.useEffect)((()=>{void 0!==t&&e(t)}),[t])}function he(t,e,n){(0,r.useEffect)((()=>{void 0!==e&&n({[t]:e})}),[e])}const de=({nodes:t,edges:e,defaultNodes:n,defaultEdges:i,onConnect:s,onConnectStart:o,onConnectEnd:a,onClickConnectStart:l,onClickConnectEnd:u,nodesDraggable:c,nodesConnectable:h,nodesFocusable:p,edgesFocusable:f,edgesUpdatable:m,elevateNodesOnSelect:g,minZoom:v,maxZoom:y,nodeExtent:_,onNodesChange:x,onEdgesChange:b,elementsSelectable:w,connectionMode:S,snapGrid:M,snapToGrid:E,translateExtent:T,connectOnClick:A,defaultEdgeOptions:C,fitView:R,fitViewOptions:I,onNodesDelete:O,onEdgesDelete:D,onNodeDrag:L,onNodeDragStart:U,onNodeDragStop:k,onSelectionDrag:B,onSelectionDragStart:F,onSelectionDragStop:z,noPanClassName:V,nodeOrigin:G,rfId:j,autoPanOnConnect:H,autoPanOnNodeDrag:W,onError:q,connectionRadius:X,isValidConnection:Z,nodeDragThreshold:$})=>{const{setNodes:Y,setEdges:K,setDefaultNodesAndEdges:J,setMinZoom:Q,setMaxZoom:tt,setTranslateExtent:et,setNodeExtent:nt,reset:rt}=N(ue,d.X),it=P();return(0,r.useEffect)((()=>{const t=i?.map((t=>({...t,...C})));return J(n,t),()=>{rt()}}),[]),he("defaultEdgeOptions",C,it.setState),he("connectionMode",S,it.setState),he("onConnect",s,it.setState),he("onConnectStart",o,it.setState),he("onConnectEnd",a,it.setState),he("onClickConnectStart",l,it.setState),he("onClickConnectEnd",u,it.setState),he("nodesDraggable",c,it.setState),he("nodesConnectable",h,it.setState),he("nodesFocusable",p,it.setState),he("edgesFocusable",f,it.setState),he("edgesUpdatable",m,it.setState),he("elementsSelectable",w,it.setState),he("elevateNodesOnSelect",g,it.setState),he("snapToGrid",E,it.setState),he("snapGrid",M,it.setState),he("onNodesChange",x,it.setState),he("onEdgesChange",b,it.setState),he("connectOnClick",A,it.setState),he("fitViewOnInit",R,it.setState),he("fitViewOnInitOptions",I,it.setState),he("onNodesDelete",O,it.setState),he("onEdgesDelete",D,it.setState),he("onNodeDrag",L,it.setState),he("onNodeDragStart",U,it.setState),he("onNodeDragStop",k,it.setState),he("onSelectionDrag",B,it.setState),he("onSelectionDragStart",F,it.setState),he("onSelectionDragStop",z,it.setState),he("noPanClassName",V,it.setState),he("nodeOrigin",G,it.setState),he("rfId",j,it.setState),he("autoPanOnConnect",H,it.setState),he("autoPanOnNodeDrag",W,it.setState),he("onError",q,it.setState),he("connectionRadius",X,it.setState),he("isValidConnection",Z,it.setState),he("nodeDragThreshold",$,it.setState),ce(t,Y),ce(e,K),ce(v,Q),ce(y,tt),ce(T,et),ce(_,nt),null},pe={display:"none"},fe={position:"absolute",width:1,height:1,margin:-1,border:0,padding:0,overflow:"hidden",clip:"rect(0px, 0px, 0px, 0px)",clipPath:"inset(100%)"},me="react-flow__node-desc",ge="react-flow__edge-desc",ve=t=>t.ariaLiveMessage;function ye({rfId:t}){const e=N(ve);return r.createElement("div",{id:`react-flow__aria-live-${t}`,"aria-live":"assertive","aria-atomic":"true",style:fe},e)}function _e({rfId:t,disableKeyboardA11y:e}){return r.createElement(r.Fragment,null,r.createElement("div",{id:`${me}-${t}`,style:pe},"Press enter or space to select a node.",!e&&"You can then use the arrow keys to move the node around."," Press delete to remove it and escape to cancel."," "),r.createElement("div",{id:`${ge}-${t}`,style:pe},"Press enter or space to select an edge. You can then press delete to remove it or escape to cancel."),!e&&r.createElement(ye,{rfId:t}))}var xe=(t=null,e={actInsideInputWithModifier:!0})=>{const[n,i]=(0,r.useState)(!1),s=(0,r.useRef)(!1),o=(0,r.useRef)(new Set([])),[a,l]=(0,r.useMemo)((()=>{if(null!==t){const e=(Array.isArray(t)?t:[t]).filter((t=>"string"==typeof t)).map((t=>t.split("+"))),n=e.reduce(((t,e)=>t.concat(...e)),[]);return[e,n]}return[[],[]]}),[t]);return(0,r.useEffect)((()=>{const n="undefined"!=typeof document?document:null,r=e?.target||n;if(null!==t){const t=t=>{s.current=t.ctrlKey||t.metaKey||t.shiftKey;if((!s.current||s.current&&!e.actInsideInputWithModifier)&&J(t))return!1;const n=we(t.code,l);o.current.add(t[n]),be(a,o.current,!1)&&(t.preventDefault(),i(!0))},n=t=>{if((!s.current||s.current&&!e.actInsideInputWithModifier)&&J(t))return!1;const n=we(t.code,l);be(a,o.current,!0)?(i(!1),o.current.clear()):o.current.delete(t[n]),"Meta"===t.key&&o.current.clear(),s.current=!1},u=()=>{o.current.clear(),i(!1)};return r?.addEventListener("keydown",t),r?.addEventListener("keyup",n),window.addEventListener("blur",u),()=>{r?.removeEventListener("keydown",t),r?.removeEventListener("keyup",n),window.removeEventListener("blur",u)}}}),[t,i]),n};function be(t,e,n){return t.filter((t=>n||t.length===e.size)).some((t=>t.every((t=>e.has(t)))))}function we(t,e){return e.includes(t)?"code":"key"}function Se(t,e,n,r){const i=t.parentNode||t.parentId;if(!i)return n;const s=e.get(i),o=It(s,r);return Se(s,e,{x:(n.x??0)+o.x,y:(n.y??0)+o.y,z:(s[$]?.z??0)>(n.z??0)?s[$]?.z??0:n.z??0},r)}function Me(t,e,n){t.forEach((r=>{const i=r.parentNode||r.parentId;if(i&&!t.has(i))throw new Error(`Parent node ${i} not found`);if(i||n?.[r.id]){const{x:i,y:s,z:o}=Se(r,t,{...r.position,z:r[$]?.z??0},e);r.positionAbsolute={x:i,y:s},r[$].z=o,n?.[r.id]&&(r[$].isParent=!0)}}))}function Ee(t,e,n,r){const i=new Map,s={},o=r?1e3:0;return t.forEach((t=>{const n=(Z(t.zIndex)?t.zIndex:0)+(t.selected?o:0),r=e.get(t.id),a={...t,positionAbsolute:{x:t.position.x,y:t.position.y}},l=t.parentNode||t.parentId;l&&(s[l]=!0);const u=r?.type&&r?.type!==t.type;Object.defineProperty(a,$,{enumerable:!1,value:{handleBounds:u?void 0:r?.[$]?.handleBounds,z:n}}),i.set(t.id,a)})),Me(i,n,s),i}function Te(t,e={}){const{getNodes:n,width:r,height:i,minZoom:s,maxZoom:o,d3Zoom:a,d3Selection:l,fitViewOnInitDone:u,fitViewOnInit:c,nodeOrigin:h}=t(),d=e.initial&&!u&&c;if(a&&l&&(d||!e.initial)){const t=n().filter((t=>{const n=e.includeHiddenNodes?t.width&&t.height:!t.hidden;return e.nodes?.length?n&&e.nodes.some((e=>e.id===t.id)):n})),u=t.every((t=>t.width&&t.height));if(t.length>0&&u){const n=Ot(t,h),{x:u,y:c,zoom:d}=Ut(n,r,i,e.minZoom??s,e.maxZoom??o,e.padding??.1),f=p.CR.translate(u,c).scale(d);return"number"==typeof e.duration&&e.duration>0?a.transform(kt(l,e.duration),f):a.transform(l,f),!0}}return!1}function Ae(t,e){return t.forEach((t=>{const n=e.get(t.id);n&&e.set(n.id,{...n,[$]:n[$],selected:t.selected})})),new Map(e)}function Ce(t,e){return e.map((e=>{const n=t.find((t=>t.id===e.id));return n&&(e.selected=n.selected),e}))}function Re({changedNodes:t,changedEdges:e,get:n,set:r}){const{nodeInternals:i,edges:s,onNodesChange:o,onEdgesChange:a,hasDefaultNodes:l,hasDefaultEdges:u}=n();t?.length&&(l&&r({nodeInternals:Ae(t,i)}),o?.(t)),e?.length&&(u&&r({edges:Ce(e,s)}),a?.(e))}const Ne=()=>{},Pe={zoomIn:Ne,zoomOut:Ne,zoomTo:Ne,getZoom:()=>1,setViewport:Ne,getViewport:()=>({x:0,y:0,zoom:1}),fitView:()=>!1,setCenter:Ne,fitBounds:Ne,project:t=>t,screenToFlowPosition:t=>t,flowToScreenPosition:t=>t,viewportInitialized:!1},Ie=t=>({d3Zoom:t.d3Zoom,d3Selection:t.d3Selection});function Oe(){const t=(()=>{const t=P(),{d3Zoom:e,d3Selection:n}=N(Ie,d.X);return(0,r.useMemo)((()=>n&&e?{zoomIn:t=>e.scaleBy(kt(n,t?.duration),1.2),zoomOut:t=>e.scaleBy(kt(n,t?.duration),1/1.2),zoomTo:(t,r)=>e.scaleTo(kt(n,r?.duration),t),getZoom:()=>t.getState().transform[2],setViewport:(r,i)=>{const[s,o,a]=t.getState().transform,l=p.CR.translate(r.x??s,r.y??o).scale(r.zoom??a);e.transform(kt(n,i?.duration),l)},getViewport:()=>{const[e,n,r]=t.getState().transform;return{x:e,y:n,zoom:r}},fitView:e=>Te(t.getState,e),setCenter:(r,i,s)=>{const{width:o,height:a,maxZoom:l}=t.getState(),u=void 0!==s?.zoom?s.zoom:l,c=o/2-r*u,h=a/2-i*u,d=p.CR.translate(c,h).scale(u);e.transform(kt(n,s?.duration),d)},fitBounds:(r,i)=>{const{width:s,height:o,minZoom:a,maxZoom:l}=t.getState(),{x:u,y:c,zoom:h}=Ut(r,s,o,a,l,i?.padding??.1),d=p.CR.translate(u,c).scale(h);e.transform(kt(n,i?.duration),d)},project:e=>{const{transform:n,snapToGrid:r,snapGrid:i}=t.getState();return console.warn("[DEPRECATED] `project` is deprecated. Instead use `screenToFlowPosition`. There is no need to subtract the react flow bounds anymore! https://reactflow.dev/api-reference/types/react-flow-instance#screen-to-flow-position"),Nt(e,n,r,i)},screenToFlowPosition:e=>{const{transform:n,snapToGrid:r,snapGrid:i,domNode:s}=t.getState();if(!s)return e;const{x:o,y:a}=s.getBoundingClientRect(),l={x:e.x-o,y:e.y-a};return Nt(l,n,r,i)},flowToScreenPosition:e=>{const{transform:n,domNode:r}=t.getState();if(!r)return e;const{x:i,y:s}=r.getBoundingClientRect(),o=Pt(e,n);return{x:o.x+i,y:o.y+s}},viewportInitialized:!0}:Pe),[e,n])})(),e=P(),n=(0,r.useCallback)((()=>e.getState().getNodes().map((t=>({...t})))),[]),i=(0,r.useCallback)((t=>e.getState().nodeInternals.get(t)),[]),s=(0,r.useCallback)((()=>{const{edges:t=[]}=e.getState();return t.map((t=>({...t})))}),[]),o=(0,r.useCallback)((t=>{const{edges:n=[]}=e.getState();return n.find((e=>e.id===t))}),[]),a=(0,r.useCallback)((t=>{const{getNodes:n,setNodes:r,hasDefaultNodes:i,onNodesChange:s}=e.getState(),o=n(),a="function"==typeof t?t(o):t;if(i)r(a);else if(s){s(0===a.length?o.map((t=>({type:"remove",id:t.id}))):a.map((t=>({item:t,type:"reset"}))))}}),[]),l=(0,r.useCallback)((t=>{const{edges:n=[],setEdges:r,hasDefaultEdges:i,onEdgesChange:s}=e.getState(),o="function"==typeof t?t(n):t;if(i)r(o);else if(s){s(0===o.length?n.map((t=>({type:"remove",id:t.id}))):o.map((t=>({item:t,type:"reset"}))))}}),[]),u=(0,r.useCallback)((t=>{const n=Array.isArray(t)?t:[t],{getNodes:r,setNodes:i,hasDefaultNodes:s,onNodesChange:o}=e.getState();if(s){i([...r(),...n])}else if(o){o(n.map((t=>({item:t,type:"add"}))))}}),[]),c=(0,r.useCallback)((t=>{const n=Array.isArray(t)?t:[t],{edges:r=[],setEdges:i,hasDefaultEdges:s,onEdgesChange:o}=e.getState();if(s)i([...r,...n]);else if(o){o(n.map((t=>({item:t,type:"add"}))))}}),[]),h=(0,r.useCallback)((()=>{const{getNodes:t,edges:n=[],transform:r}=e.getState(),[i,s,o]=r;return{nodes:t().map((t=>({...t}))),edges:n.map((t=>({...t}))),viewport:{x:i,y:s,zoom:o}}}),[]),f=(0,r.useCallback)((({nodes:t,edges:n})=>{const{nodeInternals:r,getNodes:i,edges:s,hasDefaultNodes:o,hasDefaultEdges:a,onNodesDelete:l,onEdgesDelete:u,onNodesChange:c,onEdgesChange:h}=e.getState(),d=(t||[]).map((t=>t.id)),p=(n||[]).map((t=>t.id)),f=i().reduce(((t,e)=>{const n=e.parentNode||e.parentId,r=!d.includes(e.id)&&n&&t.find((t=>t.id===n));return("boolean"!=typeof e.deletable||e.deletable)&&(d.includes(e.id)||r)&&t.push(e),t}),[]),m=s.filter((t=>"boolean"!=typeof t.deletable||t.deletable)),g=m.filter((t=>p.includes(t.id)));if(f||g){const t=Lt(f,m),n=[...g,...t],i=n.reduce(((t,e)=>(t.includes(e.id)||t.push(e.id),t)),[]);if((a||o)&&(a&&e.setState({edges:s.filter((t=>!i.includes(t.id)))}),o&&(f.forEach((t=>{r.delete(t.id)})),e.setState({nodeInternals:new Map(r)}))),i.length>0&&(u?.(n),h&&h(i.map((t=>({id:t,type:"remove"}))))),f.length>0&&(l?.(f),c)){c(f.map((t=>({id:t.id,type:"remove"}))))}}}),[]),m=(0,r.useCallback)((t=>{const n=Z((r=t).width)&&Z(r.height)&&Z(r.x)&&Z(r.y);var r;const i=n?null:e.getState().nodeInternals.get(t.id);if(!n&&!i)return[null,null,n];return[n?t:W(i),i,n]}),[]),g=(0,r.useCallback)(((t,n=!0,r)=>{const[i,s,o]=m(t);return i?(r||e.getState().getNodes()).filter((t=>{if(!(o||t.id!==s.id&&t.positionAbsolute))return!1;const e=W(t),r=X(e,i);return n&&r>0||r>=i.width*i.height})):[]}),[]),v=(0,r.useCallback)(((t,e,n=!0)=>{const[r]=m(t);if(!r)return!1;const i=X(r,e);return n&&i>0||i>=r.width*r.height}),[]);return(0,r.useMemo)((()=>({...t,getNodes:n,getNode:i,getEdges:s,getEdge:o,setNodes:a,setEdges:l,addNodes:u,addEdges:c,toObject:h,deleteElements:f,getIntersectingNodes:g,isNodeIntersecting:v})),[t,n,i,s,o,a,l,u,c,h,f,g,v])}const De={actInsideInputWithModifier:!1};const Le={position:"absolute",width:"100%",height:"100%",top:0,left:0},Ue=t=>({x:t.x,y:t.y,zoom:t.k}),ke=(t,e)=>t.target.closest(`.${e}`),Be=(t,e)=>2===e&&Array.isArray(t)&&t.includes(2),Fe=t=>{const e=t.ctrlKey&&et()?10:1;return-t.deltaY*(1===t.deltaMode?.05:t.deltaMode?1:.002)*e},ze=t=>({d3Zoom:t.d3Zoom,d3Selection:t.d3Selection,d3ZoomHandler:t.d3ZoomHandler,userSelectionActive:t.userSelectionActive}),Ve=({onMove:t,onMoveStart:e,onMoveEnd:n,onPaneContextMenu:i,zoomOnScroll:s=!0,zoomOnPinch:o=!0,panOnScroll:a=!1,panOnScrollSpeed:l=.5,panOnScrollMode:u=at.Free,zoomOnDoubleClick:c=!0,elementsSelectable:h,panOnDrag:g=!0,defaultViewport:v,translateExtent:y,minZoom:_,maxZoom:x,zoomActivationKeyCode:w,preventScrolling:S=!0,children:M,noWheelClassName:E,noPanClassName:T})=>{const A=(0,r.useRef)(),C=P(),R=(0,r.useRef)(!1),I=(0,r.useRef)(!1),O=(0,r.useRef)(null),D=(0,r.useRef)({x:0,y:0,zoom:0}),{d3Zoom:L,d3Selection:B,d3ZoomHandler:F,userSelectionActive:z}=N(ze,d.X),V=xe(w),G=(0,r.useRef)(0),j=(0,r.useRef)(!1),H=(0,r.useRef)();return function(t){const e=P();(0,r.useEffect)((()=>{let n;const r=()=>{if(!t.current)return;const n=U(t.current);0!==n.height&&0!==n.width||e.getState().onError?.("004",b()),e.setState({width:n.width||500,height:n.height||500})};return r(),window.addEventListener("resize",r),t.current&&(n=new ResizeObserver((()=>r())),n.observe(t.current)),()=>{window.removeEventListener("resize",r),n&&t.current&&n.unobserve(t.current)}}),[])}(O),(0,r.useEffect)((()=>{if(O.current){const t=O.current.getBoundingClientRect(),e=(0,p.sP)().scaleExtent([_,x]).translateExtent(y),n=(0,f.Z)(O.current).call(e),r=p.CR.translate(v.x,v.y).scale(k(v.zoom,_,x)),i=[[0,0],[t.width,t.height]],s=e.constrain()(r,i,y);e.transform(n,s),e.wheelDelta(Fe),C.setState({d3Zoom:e,d3Selection:n,d3ZoomHandler:n.on("wheel.zoom"),transform:[s.x,s.y,s.k],domNode:O.current.closest(".react-flow")})}}),[]),(0,r.useEffect)((()=>{B&&L&&(!a||V||z?void 0!==F&&B.on("wheel.zoom",(function(t,e){if(!S&&"wheel"===t.type&&!t.ctrlKey||ke(t,E))return null;t.preventDefault(),F.call(this,t,e)}),{passive:!1}):B.on("wheel.zoom",(r=>{if(ke(r,E))return!1;r.preventDefault(),r.stopImmediatePropagation();const i=B.property("__zoom").k||1;if(r.ctrlKey&&o){const t=(0,m.Z)(r),e=Fe(r),n=i*Math.pow(2,e);return void L.scaleTo(B,n,t,r)}const s=1===r.deltaMode?20:1;let a=u===at.Vertical?0:r.deltaX*s,c=u===at.Horizontal?0:r.deltaY*s;!et()&&r.shiftKey&&u!==at.Vertical&&(a=r.deltaY*s,c=0),L.translateBy(B,-a/i*l,-c/i*l,{internal:!0});const h=Ue(B.property("__zoom")),{onViewportChangeStart:d,onViewportChange:p,onViewportChangeEnd:f}=C.getState();clearTimeout(H.current),j.current||(j.current=!0,e?.(r,h),d?.(h)),j.current&&(t?.(r,h),p?.(h),H.current=setTimeout((()=>{n?.(r,h),f?.(h),j.current=!1}),150))}),{passive:!1}))}),[z,a,u,B,L,F,V,o,S,E,e,t,n]),(0,r.useEffect)((()=>{L&&L.on("start",(t=>{if(!t.sourceEvent||t.sourceEvent.internal)return null;G.current=t.sourceEvent?.button;const{onViewportChangeStart:n}=C.getState(),r=Ue(t.transform);R.current=!0,D.current=r,"mousedown"===t.sourceEvent?.type&&C.setState({paneDragging:!0}),n?.(r),e?.(t.sourceEvent,r)}))}),[L,e]),(0,r.useEffect)((()=>{L&&(z&&!R.current?L.on("zoom",null):z||L.on("zoom",(e=>{const{onViewportChange:n}=C.getState();if(C.setState({transform:[e.transform.x,e.transform.y,e.transform.k]}),I.current=!(!i||!Be(g,G.current??0)),(t||n)&&!e.sourceEvent?.internal){const r=Ue(e.transform);n?.(r),t?.(e.sourceEvent,r)}})))}),[z,L,t,g,i]),(0,r.useEffect)((()=>{L&&L.on("end",(t=>{if(!t.sourceEvent||t.sourceEvent.internal)return null;const{onViewportChangeEnd:e}=C.getState();if(R.current=!1,C.setState({paneDragging:!1}),i&&Be(g,G.current??0)&&!I.current&&i(t.sourceEvent),I.current=!1,(n||e)&&(r=D.current,s=t.transform,r.x!==s.x||r.y!==s.y||r.zoom!==s.k)){const r=Ue(t.transform);D.current=r,clearTimeout(A.current),A.current=setTimeout((()=>{e?.(r),n?.(t.sourceEvent,r)}),a?150:0)}var r,s}))}),[L,a,g,n,i]),(0,r.useEffect)((()=>{L&&L.filter((t=>{const e=V||s,n=o&&t.ctrlKey;if((!0===g||Array.isArray(g)&&g.includes(1))&&1===t.button&&"mousedown"===t.type&&(ke(t,"react-flow__node")||ke(t,"react-flow__edge")))return!0;if(!(g||e||a||c||o))return!1;if(z)return!1;if(!c&&"dblclick"===t.type)return!1;if(ke(t,E)&&"wheel"===t.type)return!1;if(ke(t,T)&&("wheel"!==t.type||a&&"wheel"===t.type&&!V))return!1;if(!o&&t.ctrlKey&&"wheel"===t.type)return!1;if(!e&&!a&&!n&&"wheel"===t.type)return!1;if(!g&&("mousedown"===t.type||"touchstart"===t.type))return!1;if(Array.isArray(g)&&!g.includes(t.button)&&"mousedown"===t.type)return!1;const r=Array.isArray(g)&&g.includes(t.button)||!t.button||t.button<=1;return(!t.ctrlKey||"wheel"===t.type)&&r}))}),[z,L,s,o,a,c,g,h,V]),r.createElement("div",{className:"react-flow__renderer",ref:O,style:Le},M)},Ge=t=>({userSelectionActive:t.userSelectionActive,userSelectionRect:t.userSelectionRect});function je(){const{userSelectionActive:t,userSelectionRect:e}=N(Ge,d.X);return t&&e?r.createElement("div",{className:"react-flow__selection react-flow__container",style:{width:e.width,height:e.height,transform:`translate(${e.x}px, ${e.y}px)`}}):null}function He(t,e){const n=e.parentNode||e.parentId,r=t.find((t=>t.id===n));if(r){const t=e.position.x+e.width-r.width,n=e.position.y+e.height-r.height;if(t>0||n>0||e.position.x<0||e.position.y<0){if(r.style={...r.style}||{},r.style.width=r.style.width??r.width,r.style.height=r.style.height??r.height,t>0&&(r.style.width+=t),n>0&&(r.style.height+=n),e.position.x<0){const t=Math.abs(e.position.x);r.position.x=r.position.x-t,r.style.width+=t,e.position.x=0}if(e.position.y<0){const t=Math.abs(e.position.y);r.position.y=r.position.y-t,r.style.height+=t,e.position.y=0}r.width=r.style.width,r.height=r.style.height}}}function We(t,e){if(t.some((t=>"reset"===t.type)))return t.filter((t=>"reset"===t.type)).map((t=>t.item));const n=t.filter((t=>"add"===t.type)).map((t=>t.item));return e.reduce(((e,n)=>{const r=t.filter((t=>t.id===n.id));if(0===r.length)return e.push(n),e;const i={...n};for(const t of r)if(t)switch(t.type){case"select":i.selected=t.selected;break;case"position":void 0!==t.position&&(i.position=t.position),void 0!==t.positionAbsolute&&(i.positionAbsolute=t.positionAbsolute),void 0!==t.dragging&&(i.dragging=t.dragging),i.expandParent&&He(e,i);break;case"dimensions":void 0!==t.dimensions&&(i.width=t.dimensions.width,i.height=t.dimensions.height),void 0!==t.updateStyle&&(i.style={...i.style||{},...t.dimensions}),"boolean"==typeof t.resizing&&(i.resizing=t.resizing),i.expandParent&&He(e,i);break;case"remove":return e}return e.push(i),e}),n)}function qe(t,e){return We(t,e)}function Xe(t,e){return We(t,e)}const Ze=(t,e)=>({id:t,type:"select",selected:e});function $e(t,e){return t.reduce(((t,n)=>{const r=e.includes(n.id);return!n.selected&&r?(n.selected=!0,t.push(Ze(n.id,!0))):n.selected&&!r&&(n.selected=!1,t.push(Ze(n.id,!1))),t}),[])}const Ye=(t,e)=>n=>{n.target===e.current&&t?.(n)},Ke=t=>({userSelectionActive:t.userSelectionActive,elementsSelectable:t.elementsSelectable,dragging:t.paneDragging}),Je=(0,r.memo)((({isSelecting:t,selectionMode:e=lt.Full,panOnDrag:n,onSelectionStart:s,onSelectionEnd:o,onPaneClick:a,onPaneContextMenu:l,onPaneScroll:u,onPaneMouseEnter:c,onPaneMouseMove:h,onPaneMouseLeave:p,children:f})=>{const m=(0,r.useRef)(null),g=P(),v=(0,r.useRef)(0),y=(0,r.useRef)(0),_=(0,r.useRef)(),{userSelectionActive:x,elementsSelectable:b,dragging:w}=N(Ke,d.X),S=()=>{g.setState({userSelectionActive:!1,userSelectionRect:null}),v.current=0,y.current=0},M=t=>{a?.(t),g.getState().resetSelectedElements(),g.setState({nodesSelectionActive:!1})},E=u?t=>u(t):void 0,T=b&&(t||x);return r.createElement("div",{className:(0,i.Z)(["react-flow__pane",{dragging:w,selection:t}]),onClick:T?void 0:Ye(M,m),onContextMenu:Ye((t=>{Array.isArray(n)&&n?.includes(2)?t.preventDefault():l?.(t)}),m),onWheel:Ye(E,m),onMouseEnter:T?void 0:c,onMouseDown:T?e=>{const{resetSelectedElements:n,domNode:r}=g.getState();if(_.current=r?.getBoundingClientRect(),!b||!t||0!==e.button||e.target!==m.current||!_.current)return;const{x:i,y:o}=tt(e,_.current);n(),g.setState({userSelectionRect:{width:0,height:0,startX:i,startY:o,x:i,y:o}}),s?.(e)}:void 0,onMouseMove:T?n=>{const{userSelectionRect:r,nodeInternals:i,edges:s,transform:o,onNodesChange:a,onEdgesChange:l,nodeOrigin:u,getNodes:c}=g.getState();if(!t||!_.current||!r)return;g.setState({userSelectionActive:!0,nodesSelectionActive:!1});const h=tt(n,_.current),d=r.startX??0,p=r.startY??0,f={...r,x:h.x<d?h.x:d,y:h.y<p?h.y:p,width:Math.abs(h.x-d),height:Math.abs(h.y-p)},m=c(),x=Dt(i,f,o,e===lt.Partial,!0,u),b=Lt(x,s).map((t=>t.id)),w=x.map((t=>t.id));if(v.current!==w.length){v.current=w.length;const t=$e(m,w);t.length&&a?.(t)}if(y.current!==b.length){y.current=b.length;const t=$e(s,b);t.length&&l?.(t)}g.setState({userSelectionRect:f})}:h,onMouseUp:T?t=>{if(0!==t.button)return;const{userSelectionRect:e}=g.getState();!x&&e&&t.target===m.current&&M?.(t),g.setState({nodesSelectionActive:v.current>0}),S(),o?.(t)}:void 0,onMouseLeave:T?t=>{x&&(g.setState({nodesSelectionActive:v.current>0}),o?.(t)),S()}:p,ref:m,style:Le},f,r.createElement(je,null))}));function Qe(t,e){const n=t.parentNode||t.parentId;if(!n)return!1;const r=e.get(n);return!!r&&(!!r.selected||Qe(r,e))}function tn(t,e,n){let r=t;do{if(r?.matches(e))return!0;if(r===n.current)return!1;r=r.parentElement}while(r);return!1}function en(t,e,n,r){return Array.from(t.values()).filter((n=>(n.selected||n.id===r)&&(!n.parentNode||n.parentId||!Qe(n,t))&&(n.draggable||e&&void 0===n.draggable))).map((t=>({id:t.id,position:t.position||{x:0,y:0},positionAbsolute:t.positionAbsolute||{x:0,y:0},distance:{x:n.x-(t.positionAbsolute?.x??0),y:n.y-(t.positionAbsolute?.y??0)},delta:{x:0,y:0},extent:t.extent,parentNode:t.parentNode||t.parentId,parentId:t.parentNode||t.parentId,width:t.width,height:t.height,expandParent:t.expandParent})))}function nn(t,e,n,r,i=[0,0],s){const o=function(t,e){return e&&"parent"!==e?[e[0],[e[1][0]-(t.width||0),e[1][1]-(t.height||0)]]:e}(t,t.extent||r);let a=o;const l=t.parentNode||t.parentId;if("parent"!==t.extent||t.expandParent){if(t.extent&&l&&"parent"!==t.extent){const e=n.get(l),{x:r,y:s}=It(e,i).positionAbsolute;a=[[t.extent[0][0]+r,t.extent[0][1]+s],[t.extent[1][0]+r,t.extent[1][1]+s]]}}else if(l&&t.width&&t.height){const e=n.get(l),{x:r,y:s}=It(e,i).positionAbsolute;a=e&&Z(r)&&Z(s)&&Z(e.width)&&Z(e.height)?[[r+t.width*i[0],s+t.height*i[1]],[r+e.width-t.width+t.width*i[0],s+e.height-t.height+t.height*i[1]]]:a}else s?.("005",w()),a=o;let u={x:0,y:0};if(l){const t=n.get(l);u=It(t,i).positionAbsolute}const c=a&&"parent"!==a?B(e,a):e;return{position:{x:c.x-u.x,y:c.y-u.y},positionAbsolute:c}}function rn({nodeId:t,dragItems:e,nodeInternals:n}){const r=e.map((t=>({...n.get(t.id),position:t.position,positionAbsolute:t.positionAbsolute})));return[t?r.find((e=>e.id===t)):r[0],r]}Je.displayName="Pane";const sn=(t,e,n,r)=>{const i=e.querySelectorAll(t);if(!i||!i.length)return null;const s=Array.from(i),o=e.getBoundingClientRect(),a=o.width*r[0],l=o.height*r[1];return s.map((t=>{const e=t.getBoundingClientRect();return{id:t.getAttribute("data-handleid"),position:t.getAttribute("data-handlepos"),x:(e.left-o.left-a)/n,y:(e.top-o.top-l)/n,...U(t)}}))};function on(t,e,n){return void 0===n?n:r=>{const i=e().nodeInternals.get(t);i&&n(r,{...i})}}function an({id:t,store:e,unselect:n=!1,nodeRef:r}){const{addSelectedNodes:i,unselectNodesAndEdges:s,multiSelectionActive:o,nodeInternals:a,onError:l}=e.getState(),u=a.get(t);u?(e.setState({nodesSelectionActive:!1}),u.selected?(n||u.selected&&o)&&(s({nodes:[u],edges:[]}),requestAnimationFrame((()=>r?.current?.blur()))):i([t])):l?.("012",C(t))}function ln(t){return(e,n,r)=>t?.(e,r)}function un({nodeRef:t,disabled:e=!1,noDragClassName:n,handleSelector:i,nodeId:s,isSelectable:o,selectNodesOnDrag:a}){const l=P(),[u,c]=(0,r.useState)(!1),h=(0,r.useRef)([]),d=(0,r.useRef)({x:null,y:null}),p=(0,r.useRef)(0),m=(0,r.useRef)(null),v=(0,r.useRef)({x:0,y:0}),y=(0,r.useRef)(null),_=(0,r.useRef)(!1),x=(0,r.useRef)(!1),b=(0,r.useRef)(!1),w=function(){const t=P();return(0,r.useCallback)((({sourceEvent:e})=>{const{transform:n,snapGrid:r,snapToGrid:i}=t.getState(),s=e.touches?e.touches[0].clientX:e.clientX,o=e.touches?e.touches[0].clientY:e.clientY,a={x:(s-n[0])/n[2],y:(o-n[1])/n[2]};return{xSnapped:i?r[0]*Math.round(a.x/r[0]):a.x,ySnapped:i?r[1]*Math.round(a.y/r[1]):a.y,...a}}),[])}();return(0,r.useEffect)((()=>{if(t?.current){const r=(0,f.Z)(t.current),u=({x:t,y:e})=>{const{nodeInternals:n,onNodeDrag:r,onSelectionDrag:i,updateNodePositions:o,nodeExtent:a,snapGrid:u,snapToGrid:p,nodeOrigin:f,onError:m}=l.getState();d.current={x:t,y:e};let g=!1,v={x:0,y:0,x2:0,y2:0};if(h.current.length>1&&a){const t=Ot(h.current,f);v=j(t)}if(h.current=h.current.map((r=>{const i={x:t-r.distance.x,y:e-r.distance.y};p&&(i.x=u[0]*Math.round(i.x/u[0]),i.y=u[1]*Math.round(i.y/u[1]));const s=[[a[0][0],a[0][1]],[a[1][0],a[1][1]]];h.current.length>1&&a&&!r.extent&&(s[0][0]=r.positionAbsolute.x-v.x+a[0][0],s[1][0]=r.positionAbsolute.x+(r.width??0)-v.x2+a[1][0],s[0][1]=r.positionAbsolute.y-v.y+a[0][1],s[1][1]=r.positionAbsolute.y+(r.height??0)-v.y2+a[1][1]);const o=nn(r,i,n,s,f,m);return g=g||r.position.x!==o.position.x||r.position.y!==o.position.y,r.position=o.position,r.positionAbsolute=o.positionAbsolute,r})),!g)return;o(h.current,!0,!0),c(!0);const _=s?r:ln(i);if(_&&y.current){const[t,e]=rn({nodeId:s,dragItems:h.current,nodeInternals:n});_(y.current,t,e)}},S=()=>{if(!m.current)return;const[t,e]=z(v.current,m.current);if(0!==t||0!==e){const{transform:n,panBy:r}=l.getState();d.current.x=(d.current.x??0)-t/n[2],d.current.y=(d.current.y??0)-e/n[2],r({x:t,y:e})&&u(d.current)}p.current=requestAnimationFrame(S)},M=e=>{const{nodeInternals:n,multiSelectionActive:r,nodesDraggable:i,unselectNodesAndEdges:u,onNodeDragStart:c,onSelectionDragStart:p}=l.getState();x.current=!0;const f=s?c:ln(p);a&&o||r||!s||n.get(s)?.selected||u(),s&&o&&a&&an({id:s,store:l,nodeRef:t});const m=w(e);if(d.current=m,h.current=en(n,i,m,s),f&&h.current){const[t,r]=rn({nodeId:s,dragItems:h.current,nodeInternals:n});f(e.sourceEvent,t,r)}};if(!e){const e=(0,g.Z)().on("start",(t=>{const{domNode:e,nodeDragThreshold:n}=l.getState();0===n&&M(t),b.current=!1;const r=w(t);d.current=r,m.current=e?.getBoundingClientRect()||null,v.current=tt(t.sourceEvent,m.current)})).on("drag",(t=>{const e=w(t),{autoPanOnNodeDrag:n,nodeDragThreshold:r}=l.getState();if("touchmove"===t.sourceEvent.type&&t.sourceEvent.touches.length>1&&(b.current=!0),!b.current){if(!_.current&&x.current&&n&&(_.current=!0,S()),!x.current){const n=e.xSnapped-(d?.current?.x??0),i=e.ySnapped-(d?.current?.y??0);Math.sqrt(n*n+i*i)>r&&M(t)}(d.current.x!==e.xSnapped||d.current.y!==e.ySnapped)&&h.current&&x.current&&(y.current=t.sourceEvent,v.current=tt(t.sourceEvent,m.current),u(e))}})).on("end",(t=>{if(x.current&&!b.current&&(c(!1),_.current=!1,x.current=!1,cancelAnimationFrame(p.current),h.current)){const{updateNodePositions:e,nodeInternals:n,onNodeDragStop:r,onSelectionDragStop:i}=l.getState(),o=s?r:ln(i);if(e(h.current,!1,!1),o){const[e,r]=rn({nodeId:s,dragItems:h.current,nodeInternals:n});o(t.sourceEvent,e,r)}}})).filter((e=>{const r=e.target;return!e.button&&(!n||!tn(r,`.${n}`,t))&&(!i||tn(r,i,t))}));return r.call(e),()=>{r.on(".drag",null)}}r.on(".drag",null)}}),[t,e,n,i,o,l,s,a,w]),u}function cn(){const t=P();return(0,r.useCallback)((e=>{const{nodeInternals:n,nodeExtent:r,updateNodePositions:i,getNodes:s,snapToGrid:o,snapGrid:a,onError:l,nodesDraggable:u}=t.getState(),c=s().filter((t=>t.selected&&(t.draggable||u&&void 0===t.draggable))),h=o?a[0]:5,d=o?a[1]:5,p=e.isShiftPressed?4:1,f=e.x*h*p,m=e.y*d*p;i(c.map((t=>{if(t.positionAbsolute){const e={x:t.positionAbsolute.x+f,y:t.positionAbsolute.y+m};o&&(e.x=a[0]*Math.round(e.x/a[0]),e.y=a[1]*Math.round(e.y/a[1]));const{positionAbsolute:i,position:s}=nn(t,e,n,r,void 0,l);t.position=s,t.positionAbsolute=i}return t})),!0,!1)}),[])}const hn={ArrowUp:{x:0,y:-1},ArrowDown:{x:0,y:1},ArrowLeft:{x:-1,y:0},ArrowRight:{x:1,y:0}};var dn=t=>{const e=({id:e,type:n,data:s,xPos:o,yPos:a,xPosOrigin:l,yPosOrigin:u,selected:c,onClick:h,onMouseEnter:d,onMouseMove:p,onMouseLeave:f,onContextMenu:m,onDoubleClick:g,style:v,className:y,isDraggable:_,isSelectable:x,isConnectable:b,isFocusable:w,selectNodesOnDrag:S,sourcePosition:M,targetPosition:E,hidden:T,resizeObserver:A,dragHandle:C,zIndex:R,isParent:N,noDragClassName:I,noPanClassName:O,initialized:D,disableKeyboardA11y:L,ariaLabel:U,rfId:k,hasHandleBounds:B})=>{const F=P(),z=(0,r.useRef)(null),V=(0,r.useRef)(null),G=(0,r.useRef)(M),j=(0,r.useRef)(E),H=(0,r.useRef)(n),W=x||_||h||d||p||f,q=cn(),X=on(e,F.getState,d),Z=on(e,F.getState,p),$=on(e,F.getState,f),K=on(e,F.getState,m),Q=on(e,F.getState,g);(0,r.useEffect)((()=>()=>{V.current&&(A?.unobserve(V.current),V.current=null)}),[]),(0,r.useEffect)((()=>{if(z.current&&!T){const t=z.current;D&&B&&V.current===t||(V.current&&A?.unobserve(V.current),A?.observe(t),V.current=t)}}),[T,D,B]),(0,r.useEffect)((()=>{const t=H.current!==n,r=G.current!==M,i=j.current!==E;z.current&&(t||r||i)&&(t&&(H.current=n),r&&(G.current=M),i&&(j.current=E),F.getState().updateNodeDimensions([{id:e,nodeElement:z.current,forceUpdate:!0}]))}),[e,n,M,E]);const tt=un({nodeRef:z,disabled:T||!_,noDragClassName:I,handleSelector:C,nodeId:e,isSelectable:x,selectNodesOnDrag:S});return T?null:r.createElement("div",{className:(0,i.Z)(["react-flow__node",`react-flow__node-${n}`,{[O]:_},y,{selected:c,selectable:x,parent:N,dragging:tt}]),ref:z,style:{zIndex:R,transform:`translate(${l}px,${u}px)`,pointerEvents:W?"all":"none",visibility:D?"visible":"hidden",...v},"data-id":e,"data-testid":`rf__node-${e}`,onMouseEnter:X,onMouseMove:Z,onMouseLeave:$,onContextMenu:K,onClick:t=>{const{nodeDragThreshold:n}=F.getState();if(x&&(!S||!_||n>0)&&an({id:e,store:F,nodeRef:z}),h){const n=F.getState().nodeInternals.get(e);n&&h(t,{...n})}},onDoubleClick:Q,onKeyDown:w?t=>{if(!J(t)&&!L)if(Y.includes(t.key)&&x){const n="Escape"===t.key;an({id:e,store:F,unselect:n,nodeRef:z})}else _&&c&&Object.prototype.hasOwnProperty.call(hn,t.key)&&(F.setState({ariaLiveMessage:`Moved selected node ${t.key.replace("Arrow","").toLowerCase()}. New position, x: ${~~o}, y: ${~~a}`}),q({x:hn[t.key].x,y:hn[t.key].y,isShiftPressed:t.shiftKey}))}:void 0,tabIndex:w?0:void 0,role:w?"button":void 0,"aria-describedby":L?void 0:`${me}-${k}`,"aria-label":U},r.createElement(At,{value:e},r.createElement(t,{id:e,data:s,type:n,xPos:o,yPos:a,selected:c,isConnectable:b,sourcePosition:M,targetPosition:E,dragging:tt,dragHandle:C,zIndex:R})))};return e.displayName="NodeWrapper",(0,r.memo)(e)};const pn=t=>{const e=t.getNodes().filter((t=>t.selected));return{...Ot(e,t.nodeOrigin),transformString:`translate(${t.transform[0]}px,${t.transform[1]}px) scale(${t.transform[2]})`,userSelectionActive:t.userSelectionActive}};var fn=(0,r.memo)((function({onSelectionContextMenu:t,noPanClassName:e,disableKeyboardA11y:n}){const s=P(),{width:o,height:a,x:l,y:u,transformString:c,userSelectionActive:h}=N(pn,d.X),p=cn(),f=(0,r.useRef)(null);if((0,r.useEffect)((()=>{n||f.current?.focus({preventScroll:!0})}),[n]),un({nodeRef:f}),h||!o||!a)return null;const m=t?e=>{const n=s.getState().getNodes().filter((t=>t.selected));t(e,n)}:void 0;return r.createElement("div",{className:(0,i.Z)(["react-flow__nodesselection","react-flow__container",e]),style:{transform:c}},r.createElement("div",{ref:f,className:"react-flow__nodesselection-rect",onContextMenu:m,tabIndex:n?void 0:-1,onKeyDown:n?void 0:t=>{Object.prototype.hasOwnProperty.call(hn,t.key)&&p({x:hn[t.key].x,y:hn[t.key].y,isShiftPressed:t.shiftKey})},style:{width:o,height:a,top:u,left:l}}))}));const mn=t=>t.nodesSelectionActive,gn=({children:t,onPaneClick:e,onPaneMouseEnter:n,onPaneMouseMove:i,onPaneMouseLeave:s,onPaneContextMenu:o,onPaneScroll:a,deleteKeyCode:l,onMove:u,onMoveStart:c,onMoveEnd:h,selectionKeyCode:d,selectionOnDrag:p,selectionMode:f,onSelectionStart:m,onSelectionEnd:g,multiSelectionKeyCode:v,panActivationKeyCode:y,zoomActivationKeyCode:_,elementsSelectable:x,zoomOnScroll:b,zoomOnPinch:w,panOnScroll:S,panOnScrollSpeed:M,panOnScrollMode:E,zoomOnDoubleClick:T,panOnDrag:A,defaultViewport:C,translateExtent:R,minZoom:I,maxZoom:O,preventScrolling:D,onSelectionContextMenu:L,noWheelClassName:U,noPanClassName:k,disableKeyboardA11y:B})=>{const F=N(mn),z=xe(d),V=xe(y),G=V||A,j=V||S,H=z||p&&!0!==G;return(({deleteKeyCode:t,multiSelectionKeyCode:e})=>{const n=P(),{deleteElements:i}=Oe(),s=xe(t,De),o=xe(e);(0,r.useEffect)((()=>{if(s){const{edges:t,getNodes:e}=n.getState(),r=e().filter((t=>t.selected)),s=t.filter((t=>t.selected));i({nodes:r,edges:s}),n.setState({nodesSelectionActive:!1})}}),[s]),(0,r.useEffect)((()=>{n.setState({multiSelectionActive:o})}),[o])})({deleteKeyCode:l,multiSelectionKeyCode:v}),r.createElement(Ve,{onMove:u,onMoveStart:c,onMoveEnd:h,onPaneContextMenu:o,elementsSelectable:x,zoomOnScroll:b,zoomOnPinch:w,panOnScroll:j,panOnScrollSpeed:M,panOnScrollMode:E,zoomOnDoubleClick:T,panOnDrag:!z&&G,defaultViewport:C,translateExtent:R,minZoom:I,maxZoom:O,zoomActivationKeyCode:_,preventScrolling:D,noWheelClassName:U,noPanClassName:k},r.createElement(Je,{onSelectionStart:m,onSelectionEnd:g,onPaneClick:e,onPaneMouseEnter:n,onPaneMouseMove:i,onPaneMouseLeave:s,onPaneContextMenu:o,onPaneScroll:a,panOnDrag:G,isSelecting:!!H,selectionMode:f},t,F&&r.createElement(fn,{onSelectionContextMenu:L,noPanClassName:k,disableKeyboardA11y:B})))};gn.displayName="FlowRenderer";var vn=(0,r.memo)(gn);function yn(t){return{...{input:dn(t.input||Qt),default:dn(t.default||Kt),output:dn(t.output||ee),group:dn(t.group||ne)},...Object.keys(t).filter((t=>!["input","default","output","group"].includes(t))).reduce(((e,n)=>(e[n]=dn(t[n]||Kt),e)),{})}}const _n=t=>({nodesDraggable:t.nodesDraggable,nodesConnectable:t.nodesConnectable,nodesFocusable:t.nodesFocusable,elementsSelectable:t.elementsSelectable,updateNodeDimensions:t.updateNodeDimensions,onError:t.onError}),xn=t=>{const{nodesDraggable:e,nodesConnectable:n,nodesFocusable:i,elementsSelectable:s,updateNodeDimensions:o,onError:a}=N(_n,d.X),l=(u=t.onlyRenderVisibleElements,N((0,r.useCallback)((t=>u?Dt(t.nodeInternals,{x:0,y:0,width:t.width,height:t.height},t.transform,!0):t.getNodes()),[u])));var u;const c=(0,r.useRef)(),h=(0,r.useMemo)((()=>{if("undefined"==typeof ResizeObserver)return null;const t=new ResizeObserver((t=>{const e=t.map((t=>({id:t.target.getAttribute("data-id"),nodeElement:t.target,forceUpdate:!0})));o(e)}));return c.current=t,t}),[]);return(0,r.useEffect)((()=>()=>{c?.current?.disconnect()}),[]),r.createElement("div",{className:"react-flow__nodes",style:Le},l.map((o=>{let l=o.type||"default";t.nodeTypes[l]||(a?.("003",x(l)),l="default");const u=t.nodeTypes[l]||t.nodeTypes.default,c=!!(o.draggable||e&&void 0===o.draggable),d=!!(o.selectable||s&&void 0===o.selectable),p=!!(o.connectable||n&&void 0===o.connectable),f=!!(o.focusable||i&&void 0===o.focusable),m=t.nodeExtent?B(o.positionAbsolute,t.nodeExtent):o.positionAbsolute,g=m?.x??0,v=m?.y??0,y=(({x:t,y:e,width:n,height:r,origin:i})=>n&&r?i[0]<0||i[1]<0||i[0]>1||i[1]>1?{x:t,y:e}:{x:t-n*i[0],y:e-r*i[1]}:{x:t,y:e})({x:g,y:v,width:o.width??0,height:o.height??0,origin:t.nodeOrigin});return r.createElement(u,{key:o.id,id:o.id,className:o.className,style:o.style,type:l,data:o.data,sourcePosition:o.sourcePosition||ht.Bottom,targetPosition:o.targetPosition||ht.Top,hidden:o.hidden,xPos:g,yPos:v,xPosOrigin:y.x,yPosOrigin:y.y,selectNodesOnDrag:t.selectNodesOnDrag,onClick:t.onNodeClick,onMouseEnter:t.onNodeMouseEnter,onMouseMove:t.onNodeMouseMove,onMouseLeave:t.onNodeMouseLeave,onContextMenu:t.onNodeContextMenu,onDoubleClick:t.onNodeDoubleClick,selected:!!o.selected,isDraggable:c,isSelectable:d,isConnectable:p,isFocusable:f,resizeObserver:h,dragHandle:o.dragHandle,zIndex:o[$]?.z??0,isParent:!!o[$]?.isParent,noDragClassName:t.noDragClassName,noPanClassName:t.noPanClassName,initialized:!!o.width&&!!o.height,rfId:t.rfId,disableKeyboardA11y:t.disableKeyboardA11y,ariaLabel:o.ariaLabel,hasHandleBounds:!!o[$]?.handleBounds})})))};xn.displayName="NodeRenderer";var bn=(0,r.memo)(xn);const wn=(t,e,n)=>n===ht.Left?t-e:n===ht.Right?t+e:t,Sn=(t,e,n)=>n===ht.Top?t-e:n===ht.Bottom?t+e:t,Mn="react-flow__edgeupdater",En=({position:t,centerX:e,centerY:n,radius:s=10,onMouseDown:o,onMouseEnter:a,onMouseOut:l,type:u})=>r.createElement("circle",{onMouseDown:o,onMouseEnter:a,onMouseOut:l,className:(0,i.Z)([Mn,`${Mn}-${u}`]),cx:wn(e,s,t),cy:Sn(n,s,t),r:s,stroke:"transparent",fill:"transparent"}),Tn=()=>!0;var An=t=>{const e=({id:e,className:n,type:s,data:o,onClick:a,onEdgeDoubleClick:l,selected:u,animated:c,label:h,labelStyle:d,labelShowBg:p,labelBgStyle:f,labelBgPadding:m,labelBgBorderRadius:g,style:v,source:y,target:_,sourceX:x,sourceY:b,targetX:w,targetY:S,sourcePosition:M,targetPosition:E,elementsSelectable:T,hidden:A,sourceHandleId:C,targetHandleId:R,onContextMenu:N,onMouseEnter:I,onMouseMove:O,onMouseLeave:D,reconnectRadius:L,onReconnect:U,onReconnectStart:k,onReconnectEnd:B,markerEnd:F,markerStart:z,rfId:V,ariaLabel:G,isFocusable:j,isReconnectable:H,pathOptions:W,interactionWidth:q,disableKeyboardA11y:X})=>{const Z=(0,r.useRef)(null),[$,K]=(0,r.useState)(!1),[J,Q]=(0,r.useState)(!1),tt=P(),et=(0,r.useMemo)((()=>`url('#${Rt(z,V)}')`),[z,V]),nt=(0,r.useMemo)((()=>`url('#${Rt(F,V)}')`),[F,V]);if(A)return null;const it=rt(e,tt.getState,l),st=rt(e,tt.getState,N),ot=rt(e,tt.getState,I),at=rt(e,tt.getState,O),lt=rt(e,tt.getState,D),ut=(t,n)=>{if(0!==t.button)return;const{edges:r,isValidConnection:i}=tt.getState(),s=n?_:y,o=(n?R:C)||null,a=n?"target":"source",l=i||Tn,u=n,c=r.find((t=>t.id===e));Q(!0),k?.(t,c,a);Wt({event:t,handleId:o,nodeId:s,onConnect:t=>U?.(c,t),isTarget:u,getState:tt.getState,setState:tt.setState,isValidConnection:l,edgeUpdaterType:a,onReconnectEnd:t=>{Q(!1),B?.(t,c,a)}})},ct=()=>K(!0),ht=()=>K(!1),dt=!T&&!a;return r.createElement("g",{className:(0,i.Z)(["react-flow__edge",`react-flow__edge-${s}`,n,{selected:u,animated:c,inactive:dt,updating:$}]),onClick:t=>{const{edges:n,addSelectedEdges:r,unselectNodesAndEdges:i,multiSelectionActive:s}=tt.getState(),o=n.find((t=>t.id===e));o&&(T&&(tt.setState({nodesSelectionActive:!1}),o.selected&&s?(i({nodes:[],edges:[o]}),Z.current?.blur()):r([e])),a&&a(t,o))},onDoubleClick:it,onContextMenu:st,onMouseEnter:ot,onMouseMove:at,onMouseLeave:lt,onKeyDown:j?t=>{if(!X&&Y.includes(t.key)&&T){const{unselectNodesAndEdges:n,addSelectedEdges:r,edges:i}=tt.getState();"Escape"===t.key?(Z.current?.blur(),n({edges:[i.find((t=>t.id===e))]})):r([e])}}:void 0,tabIndex:j?0:void 0,role:j?"button":"img","data-testid":`rf__edge-${e}`,"aria-label":null===G?void 0:G||`Edge from ${y} to ${_}`,"aria-describedby":j?`${ge}-${V}`:void 0,ref:Z},!J&&r.createElement(t,{id:e,source:y,target:_,selected:u,animated:c,label:h,labelStyle:d,labelShowBg:p,labelBgStyle:f,labelBgPadding:m,labelBgBorderRadius:g,data:o,style:v,sourceX:x,sourceY:b,targetX:w,targetY:S,sourcePosition:M,targetPosition:E,sourceHandleId:C,targetHandleId:R,markerStart:et,markerEnd:nt,pathOptions:W,interactionWidth:q}),H&&r.createElement(r.Fragment,null,("source"===H||!0===H)&&r.createElement(En,{position:M,centerX:x,centerY:b,radius:L,onMouseDown:t=>ut(t,!0),onMouseEnter:ct,onMouseOut:ht,type:"source"}),("target"===H||!0===H)&&r.createElement(En,{position:E,centerX:w,centerY:S,radius:L,onMouseDown:t=>ut(t,!1),onMouseEnter:ct,onMouseOut:ht,type:"target"})))};return e.displayName="EdgeWrapper",(0,r.memo)(e)};function Cn(t){return{...{default:An(t.default||Et),straight:An(t.bezier||bt),step:An(t.step||xt),smoothstep:An(t.step||_t),simplebezier:An(t.simplebezier||ft)},...Object.keys(t).filter((t=>!["default","bezier"].includes(t))).reduce(((e,n)=>(e[n]=An(t[n]||Et),e)),{})}}function Rn(t,e,n=null){const r=(n?.x||0)+e.x,i=(n?.y||0)+e.y,s=n?.width||e.width,o=n?.height||e.height;switch(t){case ht.Top:return{x:r+s/2,y:i};case ht.Right:return{x:r+s,y:i+o/2};case ht.Bottom:return{x:r+s/2,y:i+o};case ht.Left:return{x:r,y:i+o/2}}}function Nn(t,e){return t?1!==t.length&&e?e&&t.find((t=>t.id===e))||null:t[0]:null}function Pn(t){const e=t?.[$]?.handleBounds||null,n=e&&t?.width&&t?.height&&void 0!==t?.positionAbsolute?.x&&void 0!==t?.positionAbsolute?.y;return[{x:t?.positionAbsolute?.x||0,y:t?.positionAbsolute?.y||0,width:t?.width||0,height:t?.height||0},e,!!n]}const In=[{level:0,isMaxLevel:!0,edges:[]}];function On(t,e,n){return function(t,e,n=!1){let r=-1;const i=t.reduce(((t,i)=>{const s=Z(i.zIndex);let o=s?i.zIndex:0;if(n){const t=e.get(i.target),n=e.get(i.source),r=i.selected||t?.selected||n?.selected,a=Math.max(n?.[$]?.z||0,t?.[$]?.z||0,1e3);o=(s?i.zIndex:0)+(r?a:0)}return t[o]?t[o].push(i):t[o]=[i],r=o>r?o:r,t}),{}),s=Object.entries(i).map((([t,e])=>{const n=+t;return{edges:e,level:n,isMaxLevel:n===r}}));return 0===s.length?In:s}(N((0,r.useCallback)((n=>t?n.edges.filter((t=>{const r=e.get(t.source),i=e.get(t.target);return r?.width&&r?.height&&i?.width&&i?.height&&function({sourcePos:t,targetPos:e,sourceWidth:n,sourceHeight:r,targetWidth:i,targetHeight:s,width:o,height:a,transform:l}){const u={x:Math.min(t.x,e.x),y:Math.min(t.y,e.y),x2:Math.max(t.x+n,e.x+i),y2:Math.max(t.y+r,e.y+s)};u.x===u.x2&&(u.x2+=1),u.y===u.y2&&(u.y2+=1);const c=j({x:(0-l[0])/l[2],y:(0-l[1])/l[2],width:o/l[2],height:a/l[2]}),h=Math.max(0,Math.min(c.x2,u.x2)-Math.max(c.x,u.x)),d=Math.max(0,Math.min(c.y2,u.y2)-Math.max(c.y,u.y));return Math.ceil(h*d)>0}({sourcePos:r.positionAbsolute||{x:0,y:0},targetPos:i.positionAbsolute||{x:0,y:0},sourceWidth:r.width,sourceHeight:r.height,targetWidth:i.width,targetHeight:i.height,width:n.width,height:n.height,transform:n.transform})})):n.edges),[t,e])),e,n)}const Dn={[ct.Arrow]:({color:t="none",strokeWidth:e=1})=>r.createElement("polyline",{style:{stroke:t,strokeWidth:e},strokeLinecap:"round",strokeLinejoin:"round",fill:"none",points:"-5,-4 0,0 -5,4"}),[ct.ArrowClosed]:({color:t="none",strokeWidth:e=1})=>r.createElement("polyline",{style:{stroke:t,fill:t,strokeWidth:e},strokeLinecap:"round",strokeLinejoin:"round",points:"-5,-4 0,0 -5,4 -5,-4"})};const Ln=({id:t,type:e,color:n,width:i=12.5,height:s=12.5,markerUnits:o="strokeWidth",strokeWidth:a,orient:l="auto-start-reverse"})=>{const u=function(t){const e=P();return(0,r.useMemo)((()=>Object.prototype.hasOwnProperty.call(Dn,t)?Dn[t]:(e.getState().onError?.("009",M(t)),null)),[t])}(e);return u?r.createElement("marker",{className:"react-flow__arrowhead",id:t,markerWidth:`${i}`,markerHeight:`${s}`,viewBox:"-10 -10 20 20",markerUnits:o,orient:l,refX:"0",refY:"0"},r.createElement(u,{color:n,strokeWidth:a})):null},Un=({defaultColor:t,rfId:e})=>{const n=N((0,r.useCallback)((({defaultColor:t,rfId:e})=>n=>{const r=[];return n.edges.reduce(((n,i)=>([i.markerStart,i.markerEnd].forEach((i=>{if(i&&"object"==typeof i){const s=Rt(i,e);r.includes(s)||(n.push({id:s,color:i.color||t,...i}),r.push(s))}})),n)),[]).sort(((t,e)=>t.id.localeCompare(e.id)))})({defaultColor:t,rfId:e}),[t,e]),((t,e)=>!(t.length!==e.length||t.some(((t,n)=>t.id!==e[n].id)))));return r.createElement("defs",null,n.map((t=>r.createElement(Ln,{id:t.id,key:t.id,type:t.type,color:t.color,width:t.width,height:t.height,markerUnits:t.markerUnits,strokeWidth:t.strokeWidth,orient:t.orient}))))};Un.displayName="MarkerDefinitions";var kn=(0,r.memo)(Un);const Bn=t=>({nodesConnectable:t.nodesConnectable,edgesFocusable:t.edgesFocusable,edgesUpdatable:t.edgesUpdatable,elementsSelectable:t.elementsSelectable,width:t.width,height:t.height,connectionMode:t.connectionMode,nodeInternals:t.nodeInternals,onError:t.onError}),Fn=({defaultMarkerColor:t,onlyRenderVisibleElements:e,elevateEdgesOnSelect:n,rfId:s,edgeTypes:o,noPanClassName:a,onEdgeContextMenu:l,onEdgeMouseEnter:u,onEdgeMouseMove:c,onEdgeMouseLeave:h,onEdgeClick:p,onEdgeDoubleClick:f,onReconnect:m,onReconnectStart:g,onReconnectEnd:v,reconnectRadius:y,children:_,disableKeyboardA11y:x})=>{const{edgesFocusable:b,edgesUpdatable:w,elementsSelectable:S,width:M,height:T,connectionMode:C,nodeInternals:R,onError:P}=N(Bn,d.X),I=On(e,R,n);return M?r.createElement(r.Fragment,null,I.map((({level:e,edges:n,isMaxLevel:d})=>r.createElement("svg",{key:e,style:{zIndex:e},width:M,height:T,className:"react-flow__edges react-flow__container"},d&&r.createElement(kn,{defaultColor:t,rfId:s}),r.createElement("g",null,n.map((t=>{const[e,n,d]=Pn(R.get(t.source)),[_,M,T]=Pn(R.get(t.target));if(!d||!T)return null;let N=t.type||"default";o[N]||(P?.("011",A(N)),N="default");const I=o[N]||o.default,O=C===ot.Strict?M.target:(M.target??[]).concat(M.source??[]),D=Nn(n.source,t.sourceHandle),L=Nn(O,t.targetHandle),U=D?.position||ht.Bottom,k=L?.position||ht.Top,B=!!(t.focusable||b&&void 0===t.focusable),F=t.reconnectable||t.updatable,z=void 0!==m&&(F||w&&void 0===F);if(!D||!L)return P?.("008",E(D,t)),null;const{sourceX:V,sourceY:G,targetX:j,targetY:H}=((t,e,n,r,i,s)=>{const o=Rn(n,t,e),a=Rn(s,r,i);return{sourceX:o.x,sourceY:o.y,targetX:a.x,targetY:a.y}})(e,D,U,_,L,k);return r.createElement(I,{key:t.id,id:t.id,className:(0,i.Z)([t.className,a]),type:N,data:t.data,selected:!!t.selected,animated:!!t.animated,hidden:!!t.hidden,label:t.label,labelStyle:t.labelStyle,labelShowBg:t.labelShowBg,labelBgStyle:t.labelBgStyle,labelBgPadding:t.labelBgPadding,labelBgBorderRadius:t.labelBgBorderRadius,style:t.style,source:t.source,target:t.target,sourceHandleId:t.sourceHandle,targetHandleId:t.targetHandle,markerEnd:t.markerEnd,markerStart:t.markerStart,sourceX:V,sourceY:G,targetX:j,targetY:H,sourcePosition:U,targetPosition:k,elementsSelectable:S,onContextMenu:l,onMouseEnter:u,onMouseMove:c,onMouseLeave:h,onClick:p,onEdgeDoubleClick:f,onReconnect:m,onReconnectStart:g,onReconnectEnd:v,reconnectRadius:y,rfId:s,ariaLabel:t.ariaLabel,isFocusable:B,isReconnectable:z,pathOptions:"pathOptions"in t?t.pathOptions:void 0,interactionWidth:t.interactionWidth,disableKeyboardA11y:x})})))))),_):null};Fn.displayName="EdgeRenderer";var zn=(0,r.memo)(Fn);const Vn=t=>`translate(${t.transform[0]}px,${t.transform[1]}px) scale(${t.transform[2]})`;function Gn({children:t}){const e=N(Vn);return r.createElement("div",{className:"react-flow__viewport react-flow__container",style:{transform:e}},t)}const jn={[ht.Left]:ht.Right,[ht.Right]:ht.Left,[ht.Top]:ht.Bottom,[ht.Bottom]:ht.Top},Hn=({nodeId:t,handleType:e,style:n,type:i=ut.Bezier,CustomComponent:s,connectionStatus:o})=>{const{fromNode:a,handleId:l,toX:u,toY:c,connectionMode:h}=N((0,r.useCallback)((e=>({fromNode:e.nodeInternals.get(t),handleId:e.connectionHandleId,toX:(e.connectionPosition.x-e.transform[0])/e.transform[2],toY:(e.connectionPosition.y-e.transform[1])/e.transform[2],connectionMode:e.connectionMode})),[t]),d.X),p=a?.[$]?.handleBounds;let f=p?.[e];if(h===ot.Loose&&(f=f||p?.["source"===e?"target":"source"]),!a||!f)return null;const m=l?f.find((t=>t.id===l)):f[0],g=m?m.x+m.width/2:(a.width??0)/2,v=m?m.y+m.height/2:a.height??0,y=(a.positionAbsolute?.x??0)+g,_=(a.positionAbsolute?.y??0)+v,x=m?.position,b=x?jn[x]:null;if(!x||!b)return null;if(s)return r.createElement(s,{connectionLineType:i,connectionLineStyle:n,fromNode:a,fromHandle:m,fromX:y,fromY:_,toX:u,toY:c,fromPosition:x,toPosition:b,connectionStatus:o});let w="";const S={sourceX:y,sourceY:_,sourcePosition:x,targetX:u,targetY:c,targetPosition:b};return i===ut.Bezier?[w]=Mt(S):i===ut.Step?[w]=yt({...S,borderRadius:0}):i===ut.SmoothStep?[w]=yt(S):i===ut.SimpleBezier?[w]=pt(S):w=`M${y},${_} ${u},${c}`,r.createElement("path",{d:w,fill:"none",className:"react-flow__connection-path",style:n})};Hn.displayName="ConnectionLine";const Wn=t=>({nodeId:t.connectionNodeId,handleType:t.connectionHandleType,nodesConnectable:t.nodesConnectable,connectionStatus:t.connectionStatus,width:t.width,height:t.height});function qn({containerStyle:t,style:e,type:n,component:s}){const{nodeId:o,handleType:a,nodesConnectable:l,width:u,height:c,connectionStatus:h}=N(Wn,d.X);return!!(o&&a&&u&&l)?r.createElement("svg",{style:t,width:u,height:c,className:"react-flow__edges react-flow__connectionline react-flow__container"},r.createElement("g",{className:(0,i.Z)(["react-flow__connection",h])},r.createElement(Hn,{nodeId:o,handleType:a,style:e,type:n,CustomComponent:s,connectionStatus:h}))):null}function Xn(t,e){(0,r.useRef)(null),P();return(0,r.useMemo)((()=>e(t)),[t])}const Zn=({nodeTypes:t,edgeTypes:e,onMove:n,onMoveStart:i,onMoveEnd:s,onInit:o,onNodeClick:a,onEdgeClick:l,onNodeDoubleClick:u,onEdgeDoubleClick:c,onNodeMouseEnter:h,onNodeMouseMove:d,onNodeMouseLeave:p,onNodeContextMenu:f,onSelectionContextMenu:m,onSelectionStart:g,onSelectionEnd:v,connectionLineType:y,connectionLineStyle:_,connectionLineComponent:x,connectionLineContainerStyle:b,selectionKeyCode:w,selectionOnDrag:S,selectionMode:M,multiSelectionKeyCode:E,panActivationKeyCode:T,zoomActivationKeyCode:A,deleteKeyCode:C,onlyRenderVisibleElements:R,elementsSelectable:N,selectNodesOnDrag:P,defaultViewport:I,translateExtent:O,minZoom:D,maxZoom:L,preventScrolling:U,defaultMarkerColor:k,zoomOnScroll:B,zoomOnPinch:F,panOnScroll:z,panOnScrollSpeed:V,panOnScrollMode:G,zoomOnDoubleClick:j,panOnDrag:H,onPaneClick:W,onPaneMouseEnter:q,onPaneMouseMove:X,onPaneMouseLeave:Z,onPaneScroll:$,onPaneContextMenu:Y,onEdgeContextMenu:K,onEdgeMouseEnter:J,onEdgeMouseMove:Q,onEdgeMouseLeave:tt,onReconnect:et,onReconnectStart:nt,onReconnectEnd:rt,reconnectRadius:it,noDragClassName:st,noWheelClassName:ot,noPanClassName:at,elevateEdgesOnSelect:lt,disableKeyboardA11y:ut,nodeOrigin:ct,nodeExtent:ht,rfId:dt})=>{const pt=Xn(t,yn),ft=Xn(e,Cn);return function(t){const e=Oe(),n=(0,r.useRef)(!1);(0,r.useEffect)((()=>{!n.current&&e.viewportInitialized&&t&&(setTimeout((()=>t(e)),1),n.current=!0)}),[t,e.viewportInitialized])}(o),r.createElement(vn,{onPaneClick:W,onPaneMouseEnter:q,onPaneMouseMove:X,onPaneMouseLeave:Z,onPaneContextMenu:Y,onPaneScroll:$,deleteKeyCode:C,selectionKeyCode:w,selectionOnDrag:S,selectionMode:M,onSelectionStart:g,onSelectionEnd:v,multiSelectionKeyCode:E,panActivationKeyCode:T,zoomActivationKeyCode:A,elementsSelectable:N,onMove:n,onMoveStart:i,onMoveEnd:s,zoomOnScroll:B,zoomOnPinch:F,zoomOnDoubleClick:j,panOnScroll:z,panOnScrollSpeed:V,panOnScrollMode:G,panOnDrag:H,defaultViewport:I,translateExtent:O,minZoom:D,maxZoom:L,onSelectionContextMenu:m,preventScrolling:U,noDragClassName:st,noWheelClassName:ot,noPanClassName:at,disableKeyboardA11y:ut},r.createElement(Gn,null,r.createElement(zn,{edgeTypes:ft,onEdgeClick:l,onEdgeDoubleClick:c,onlyRenderVisibleElements:R,onEdgeContextMenu:K,onEdgeMouseEnter:J,onEdgeMouseMove:Q,onEdgeMouseLeave:tt,onReconnect:et,onReconnectStart:nt,onReconnectEnd:rt,reconnectRadius:it,defaultMarkerColor:k,noPanClassName:at,elevateEdgesOnSelect:!!lt,disableKeyboardA11y:ut,rfId:dt},r.createElement(qn,{style:_,type:y,component:x,containerStyle:b})),r.createElement("div",{className:"react-flow__edgelabel-renderer"}),r.createElement(bn,{nodeTypes:pt,onNodeClick:a,onNodeDoubleClick:u,onNodeMouseEnter:h,onNodeMouseMove:d,onNodeMouseLeave:p,onNodeContextMenu:f,selectNodesOnDrag:P,onlyRenderVisibleElements:R,noPanClassName:at,noDragClassName:st,disableKeyboardA11y:ut,nodeOrigin:ct,nodeExtent:ht,rfId:dt})))};Zn.displayName="GraphView";var $n=(0,r.memo)(Zn);const Yn=[[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY],[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY]],Kn={rfId:"1",width:0,height:0,transform:[0,0,1],nodeInternals:new Map,edges:[],onNodesChange:null,onEdgesChange:null,hasDefaultNodes:!1,hasDefaultEdges:!1,d3Zoom:null,d3Selection:null,d3ZoomHandler:void 0,minZoom:.5,maxZoom:2,translateExtent:Yn,nodeExtent:Yn,nodesSelectionActive:!1,userSelectionActive:!1,userSelectionRect:null,connectionNodeId:null,connectionHandleId:null,connectionHandleType:"source",connectionPosition:{x:0,y:0},connectionStatus:null,connectionMode:ot.Strict,domNode:null,paneDragging:!1,noPanClassName:"nopan",nodeOrigin:[0,0],nodeDragThreshold:0,snapGrid:[15,15],snapToGrid:!1,nodesDraggable:!0,nodesConnectable:!0,nodesFocusable:!0,edgesFocusable:!0,edgesUpdatable:!0,elementsSelectable:!0,elevateNodesOnSelect:!0,fitViewOnInit:!1,fitViewOnInitDone:!1,fitViewOnInitOptions:void 0,onSelectionChange:[],multiSelectionActive:!1,connectionStartHandle:null,connectionEndHandle:null,connectionClickStartHandle:null,connectOnClick:!0,ariaLiveMessage:"",autoPanOnConnect:!0,autoPanOnNodeDrag:!0,connectionRadius:20,onError:K,isValidConnection:void 0},Jn=()=>{return t=(t,e)=>({...Kn,setNodes:n=>{const{nodeInternals:r,nodeOrigin:i,elevateNodesOnSelect:s}=e();t({nodeInternals:Ee(n,r,i,s)})},getNodes:()=>Array.from(e().nodeInternals.values()),setEdges:n=>{const{defaultEdgeOptions:r={}}=e();t({edges:n.map((t=>({...r,...t})))})},setDefaultNodesAndEdges:(n,r)=>{const i=void 0!==n,s=void 0!==r,o=i?Ee(n,new Map,e().nodeOrigin,e().elevateNodesOnSelect):new Map;t({nodeInternals:o,edges:s?r:[],hasDefaultNodes:i,hasDefaultEdges:s})},updateNodeDimensions:n=>{const{onNodesChange:r,nodeInternals:i,fitViewOnInit:s,fitViewOnInitDone:o,fitViewOnInitOptions:a,domNode:l,nodeOrigin:u}=e(),c=l?.querySelector(".react-flow__viewport");if(!c)return;const h=window.getComputedStyle(c),{m22:d}=new window.DOMMatrixReadOnly(h.transform),p=n.reduce(((t,e)=>{const n=i.get(e.id);if(n?.hidden)i.set(n.id,{...n,[$]:{...n[$],handleBounds:void 0}});else if(n){const r=U(e.nodeElement);r.width&&r.height&&(n.width!==r.width||n.height!==r.height||e.forceUpdate)&&(i.set(n.id,{...n,[$]:{...n[$],handleBounds:{source:sn(".source",e.nodeElement,d,u),target:sn(".target",e.nodeElement,d,u)}},...r}),t.push({id:n.id,type:"dimensions",dimensions:r}))}return t}),[]);Me(i,u);const f=o||s&&!o&&Te(e,{initial:!0,...a});t({nodeInternals:new Map(i),fitViewOnInitDone:f}),p?.length>0&&r?.(p)},updateNodePositions:(t,n=!0,r=!1)=>{const{triggerNodeChanges:i}=e();i(t.map((t=>{const e={id:t.id,type:"position",dragging:r};return n&&(e.positionAbsolute=t.positionAbsolute,e.position=t.position),e})))},triggerNodeChanges:n=>{const{onNodesChange:r,nodeInternals:i,hasDefaultNodes:s,nodeOrigin:o,getNodes:a,elevateNodesOnSelect:l}=e();if(n?.length){if(s){const e=Ee(qe(n,a()),i,o,l);t({nodeInternals:e})}r?.(n)}},addSelectedNodes:n=>{const{multiSelectionActive:r,edges:i,getNodes:s}=e();let o,a=null;r?o=n.map((t=>Ze(t,!0))):(o=$e(s(),n),a=$e(i,[])),Re({changedNodes:o,changedEdges:a,get:e,set:t})},addSelectedEdges:n=>{const{multiSelectionActive:r,edges:i,getNodes:s}=e();let o,a=null;r?o=n.map((t=>Ze(t,!0))):(o=$e(i,n),a=$e(s(),[])),Re({changedNodes:a,changedEdges:o,get:e,set:t})},unselectNodesAndEdges:({nodes:n,edges:r}={})=>{const{edges:i,getNodes:s}=e(),o=r||i;Re({changedNodes:(n||s()).map((t=>(t.selected=!1,Ze(t.id,!1)))),changedEdges:o.map((t=>Ze(t.id,!1))),get:e,set:t})},setMinZoom:n=>{const{d3Zoom:r,maxZoom:i}=e();r?.scaleExtent([n,i]),t({minZoom:n})},setMaxZoom:n=>{const{d3Zoom:r,minZoom:i}=e();r?.scaleExtent([i,n]),t({maxZoom:n})},setTranslateExtent:n=>{e().d3Zoom?.translateExtent(n),t({translateExtent:n})},resetSelectedElements:()=>{const{edges:n,getNodes:r}=e();Re({changedNodes:r().filter((t=>t.selected)).map((t=>Ze(t.id,!1))),changedEdges:n.filter((t=>t.selected)).map((t=>Ze(t.id,!1))),get:e,set:t})},setNodeExtent:n=>{const{nodeInternals:r}=e();r.forEach((t=>{t.positionAbsolute=B(t.position,n)})),t({nodeExtent:n,nodeInternals:new Map(r)})},panBy:t=>{const{transform:n,width:r,height:i,d3Zoom:s,d3Selection:o,translateExtent:a}=e();if(!s||!o||!t.x&&!t.y)return!1;const l=p.CR.translate(n[0]+t.x,n[1]+t.y).scale(n[2]),u=[[0,0],[r,i]],c=s?.constrain()(l,u,a);return s.transform(o,c),n[0]!==c.x||n[1]!==c.y||n[2]!==c.k},cancelConnection:()=>t({connectionNodeId:Kn.connectionNodeId,connectionHandleId:Kn.connectionHandleId,connectionHandleType:Kn.connectionHandleType,connectionStatus:Kn.connectionStatus,connectionStartHandle:Kn.connectionStartHandle,connectionEndHandle:Kn.connectionEndHandle}),reset:()=>t({...Kn})}),e=Object.is,t?h(t,e):h;var t,e},Qn=({children:t})=>{const e=(0,r.useRef)(null);return e.current||(e.current=Jn()),r.createElement(_,{value:e.current},t)};Qn.displayName="ReactFlowProvider";const tr=({children:t})=>(0,r.useContext)(y)?r.createElement(r.Fragment,null,t):r.createElement(Qn,null,t);tr.displayName="ReactFlowWrapper";const er={input:Qt,default:Kt,output:ee,group:ne},nr={default:Et,straight:bt,step:xt,smoothstep:_t,simplebezier:ft},rr=[0,0],ir=[15,15],sr={x:0,y:0,zoom:1},or={width:"100%",height:"100%",overflow:"hidden",position:"relative",zIndex:0},ar=(0,r.forwardRef)((({nodes:t,edges:e,defaultNodes:n,defaultEdges:s,className:o,nodeTypes:a=er,edgeTypes:l=nr,onNodeClick:u,onEdgeClick:c,onInit:h,onMove:d,onMoveStart:p,onMoveEnd:f,onConnect:m,onConnectStart:g,onConnectEnd:v,onClickConnectStart:y,onClickConnectEnd:_,onNodeMouseEnter:x,onNodeMouseMove:b,onNodeMouseLeave:w,onNodeContextMenu:S,onNodeDoubleClick:M,onNodeDragStart:E,onNodeDrag:T,onNodeDragStop:A,onNodesDelete:C,onEdgesDelete:R,onSelectionChange:N,onSelectionDragStart:P,onSelectionDrag:I,onSelectionDragStop:O,onSelectionContextMenu:L,onSelectionStart:U,onSelectionEnd:k,connectionMode:B=ot.Strict,connectionLineType:F=ut.Bezier,connectionLineStyle:z,connectionLineComponent:V,connectionLineContainerStyle:G,deleteKeyCode:j="Backspace",selectionKeyCode:H="Shift",selectionOnDrag:W=!1,selectionMode:q=lt.Full,panActivationKeyCode:X="Space",multiSelectionKeyCode:Z=(et()?"Meta":"Control"),zoomActivationKeyCode:$=(et()?"Meta":"Control"),snapToGrid:Y=!1,snapGrid:K=ir,onlyRenderVisibleElements:J=!1,selectNodesOnDrag:Q=!0,nodesDraggable:tt,nodesConnectable:nt,nodesFocusable:rt,nodeOrigin:it=rr,edgesFocusable:st,edgesUpdatable:ct,elementsSelectable:ht,defaultViewport:dt=sr,minZoom:pt=.5,maxZoom:ft=2,translateExtent:mt=Yn,preventScrolling:gt=!0,nodeExtent:vt,defaultMarkerColor:yt="#b1b1b7",zoomOnScroll:_t=!0,zoomOnPinch:xt=!0,panOnScroll:bt=!1,panOnScrollSpeed:wt=.5,panOnScrollMode:St=at.Free,zoomOnDoubleClick:Mt=!0,panOnDrag:Et=!0,onPaneClick:Tt,onPaneMouseEnter:At,onPaneMouseMove:Ct,onPaneMouseLeave:Rt,onPaneScroll:Nt,onPaneContextMenu:Pt,children:It,onEdgeContextMenu:Ot,onEdgeDoubleClick:Dt,onEdgeMouseEnter:Lt,onEdgeMouseMove:Ut,onEdgeMouseLeave:kt,onEdgeUpdate:Bt,onEdgeUpdateStart:Ft,onEdgeUpdateEnd:zt,onReconnect:Vt,onReconnectStart:Gt,onReconnectEnd:jt,reconnectRadius:Ht=10,edgeUpdaterRadius:Wt=10,onNodesChange:qt,onEdgesChange:Xt,noDragClassName:Zt="nodrag",noWheelClassName:$t="nowheel",noPanClassName:Yt="nopan",fitView:Kt=!1,fitViewOptions:Jt,connectOnClick:Qt=!0,attributionPosition:te,proOptions:ee,defaultEdgeOptions:ne,elevateNodesOnSelect:re=!0,elevateEdgesOnSelect:ie=!1,disableKeyboardA11y:se=!1,autoPanOnConnect:oe=!0,autoPanOnNodeDrag:ae=!0,connectionRadius:ue=20,isValidConnection:ce,onError:he,style:pe,id:fe,nodeDragThreshold:me,...ge},ve)=>{const ye=fe||"1";return r.createElement("div",{...ge,style:{...pe,...or},ref:ve,className:(0,i.Z)(["react-flow",o]),"data-testid":"rf__wrapper",id:fe},r.createElement(tr,null,r.createElement($n,{onInit:h,onMove:d,onMoveStart:p,onMoveEnd:f,onNodeClick:u,onEdgeClick:c,onNodeMouseEnter:x,onNodeMouseMove:b,onNodeMouseLeave:w,onNodeContextMenu:S,onNodeDoubleClick:M,nodeTypes:a,edgeTypes:l,connectionLineType:F,connectionLineStyle:z,connectionLineComponent:V,connectionLineContainerStyle:G,selectionKeyCode:H,selectionOnDrag:W,selectionMode:q,deleteKeyCode:j,multiSelectionKeyCode:Z,panActivationKeyCode:X,zoomActivationKeyCode:$,onlyRenderVisibleElements:J,selectNodesOnDrag:Q,defaultViewport:dt,translateExtent:mt,minZoom:pt,maxZoom:ft,preventScrolling:gt,zoomOnScroll:_t,zoomOnPinch:xt,zoomOnDoubleClick:Mt,panOnScroll:bt,panOnScrollSpeed:wt,panOnScrollMode:St,panOnDrag:Et,onPaneClick:Tt,onPaneMouseEnter:At,onPaneMouseMove:Ct,onPaneMouseLeave:Rt,onPaneScroll:Nt,onPaneContextMenu:Pt,onSelectionContextMenu:L,onSelectionStart:U,onSelectionEnd:k,onEdgeContextMenu:Ot,onEdgeDoubleClick:Dt,onEdgeMouseEnter:Lt,onEdgeMouseMove:Ut,onEdgeMouseLeave:kt,onReconnect:Vt??Bt,onReconnectStart:Gt??Ft,onReconnectEnd:jt??zt,reconnectRadius:Ht??Wt,defaultMarkerColor:yt,noDragClassName:Zt,noWheelClassName:$t,noPanClassName:Yt,elevateEdgesOnSelect:ie,rfId:ye,disableKeyboardA11y:se,nodeOrigin:it,nodeExtent:vt}),r.createElement(de,{nodes:t,edges:e,defaultNodes:n,defaultEdges:s,onConnect:m,onConnectStart:g,onConnectEnd:v,onClickConnectStart:y,onClickConnectEnd:_,nodesDraggable:tt,nodesConnectable:nt,nodesFocusable:rt,edgesFocusable:st,edgesUpdatable:ct,elementsSelectable:ht,elevateNodesOnSelect:re,minZoom:pt,maxZoom:ft,nodeExtent:vt,onNodesChange:qt,onEdgesChange:Xt,snapToGrid:Y,snapGrid:K,connectionMode:B,translateExtent:mt,connectOnClick:Qt,defaultEdgeOptions:ne,fitView:Kt,fitViewOptions:Jt,onNodesDelete:C,onEdgesDelete:R,onNodeDragStart:E,onNodeDrag:T,onNodeDragStop:A,onSelectionDrag:I,onSelectionDragStart:P,onSelectionDragStop:O,noPanClassName:Yt,nodeOrigin:it,rfId:ye,autoPanOnConnect:oe,autoPanOnNodeDrag:ae,onError:he,connectionRadius:ue,isValidConnection:ce,nodeDragThreshold:me}),r.createElement(le,{onSelectionChange:N}),It,r.createElement(D,{proOptions:ee,position:te}),r.createElement(_e,{rfId:ye,disableKeyboardA11y:se})))}));ar.displayName="ReactFlow";const lr=t=>t.domNode?.querySelector(".react-flow__edgelabel-renderer");function ur({children:t}){const e=N(lr);return e?(0,v.createPortal)(t,e):null}function cr(t){return e=>{const[n,i]=(0,r.useState)(e),s=(0,r.useCallback)((e=>i((n=>t(e,n)))),[]);return[n,i,s]}}cr(qe),cr(Xe);function hr({onChange:t}){const e=P();(0,r.useEffect)((()=>{const n=[...e.getState().onSelectionChange,t];return e.setState({onSelectionChange:n}),()=>{const n=e.getState().onSelectionChange.filter((e=>e!==t));e.setState({onSelectionChange:n})}}),[t])}},11029:function(t,e,n){"use strict";n.d(e,{a:function(){return y}});var r=n(50959),i=n(28680),s=n(53394),o=n(89888),a=n(41468),l=n(13802),u=n(77320);const c=({id:t,x:e,y:n,width:s,height:o,style:a,color:l,strokeColor:u,strokeWidth:c,className:h,borderRadius:d,shapeRendering:p,onClick:f,selected:m})=>{const{background:g,backgroundColor:v}=a||{},y=l||g||v;return r.createElement("rect",{className:(0,i.Z)(["react-flow__minimap-node",{selected:m},h]),x:e,y:n,rx:d,ry:d,width:s,height:o,fill:y,stroke:u,strokeWidth:c,shapeRendering:p,onClick:f?e=>f(e,t):void 0})};c.displayName="MiniMapNode";var h=(0,r.memo)(c);const d=t=>t.nodeOrigin,p=t=>t.getNodes().filter((t=>!t.hidden&&t.width&&t.height)),f=t=>t instanceof Function?t:()=>t;var m=(0,r.memo)((function({nodeStrokeColor:t="transparent",nodeColor:e="#e2e2e2",nodeClassName:n="",nodeBorderRadius:i=5,nodeStrokeWidth:o=2,nodeComponent:a=h,onClick:l}){const c=(0,u.oR)(p,s.X),m=(0,u.oR)(d),g=f(e),v=f(t),y=f(n),_="undefined"==typeof window||window.chrome?"crispEdges":"geometricPrecision";return r.createElement(r.Fragment,null,c.map((t=>{const{x:e,y:n}=(0,u.VP)(t,m).positionAbsolute;return r.createElement(a,{key:t.id,x:e,y:n,width:t.width,height:t.height,style:t.style,selected:t.selected,className:y(t),color:g(t),borderRadius:i,strokeColor:v(t),strokeWidth:o,shapeRendering:_,onClick:l,id:t.id})})))}));const g=t=>{const e=t.getNodes(),n={x:-t.transform[0]/t.transform[2],y:-t.transform[1]/t.transform[2],width:t.width/t.transform[2],height:t.height/t.transform[2]};return{viewBB:n,boundingRect:e.length>0?(0,u.oI)((0,u.RX)(e,t.nodeOrigin),n):n,rfId:t.rfId}};function v({style:t,className:e,nodeStrokeColor:n="transparent",nodeColor:c="#e2e2e2",nodeClassName:h="",nodeBorderRadius:d=5,nodeStrokeWidth:p=2,nodeComponent:f,maskColor:v="rgb(240, 240, 240, 0.6)",maskStrokeColor:y="none",maskStrokeWidth:_=1,position:x="bottom-right",onClick:b,onNodeClick:w,pannable:S=!1,zoomable:M=!1,ariaLabel:E="React Flow mini map",inversePan:T=!1,zoomStep:A=10,offsetScale:C=5}){const R=(0,u.AC)(),N=(0,r.useRef)(null),{boundingRect:P,viewBB:I,rfId:O}=(0,u.oR)(g,s.X),D=t?.width??200,L=t?.height??150,U=P.width/D,k=P.height/L,B=Math.max(U,k),F=B*D,z=B*L,V=C*B,G=P.x-(F-P.width)/2-V,j=P.y-(z-P.height)/2-V,H=F+2*V,W=z+2*V,q=`react-flow__minimap-desc-${O}`,X=(0,r.useRef)(0);X.current=B,(0,r.useEffect)((()=>{if(N.current){const t=(0,a.Z)(N.current),e=t=>{const{transform:e,d3Selection:n,d3Zoom:r}=R.getState();if("wheel"!==t.sourceEvent.type||!n||!r)return;const i=-t.sourceEvent.deltaY*(1===t.sourceEvent.deltaMode?.05:t.sourceEvent.deltaMode?1:.002)*A,s=e[2]*Math.pow(2,i);r.scaleTo(n,s)},n=t=>{const{transform:e,d3Selection:n,d3Zoom:r,translateExtent:i,width:s,height:a}=R.getState();if("mousemove"!==t.sourceEvent.type||!n||!r)return;const l=X.current*Math.max(1,e[2])*(T?-1:1),u={x:e[0]-t.sourceEvent.movementX*l,y:e[1]-t.sourceEvent.movementY*l},c=[[0,0],[s,a]],h=o.CR.translate(u.x,u.y).scale(e[2]),d=r.constrain()(h,c,i);r.transform(n,d)},r=(0,o.sP)().on("zoom",S?n:null).on("zoom.wheel",M?e:null);return t.call(r),()=>{t.on("zoom",null)}}}),[S,M,T,A]);const Z=b?t=>{const e=(0,l.Z)(t);b(t,{x:e[0],y:e[1]})}:void 0,$=w?(t,e)=>{const n=R.getState().nodeInternals.get(e);w(t,n)}:void 0;return r.createElement(u.s_,{position:x,style:t,className:(0,i.Z)(["react-flow__minimap",e]),"data-testid":"rf__minimap"},r.createElement("svg",{width:D,height:L,viewBox:`${G} ${j} ${H} ${W}`,role:"img","aria-labelledby":q,ref:N,onClick:Z},E&&r.createElement("title",{id:q},E),r.createElement(m,{onClick:$,nodeColor:c,nodeStrokeColor:n,nodeBorderRadius:d,nodeClassName:h,nodeStrokeWidth:p,nodeComponent:f}),r.createElement("path",{className:"react-flow__minimap-mask",d:`M${G-V},${j-V}h${H+2*V}v${W+2*V}h${-H-2*V}z\n        M${I.x},${I.y}h${I.width}v${I.height}h${-I.width}z`,fill:v,fillRule:"evenodd",stroke:y,strokeWidth:_,pointerEvents:"none"})))}v.displayName="MiniMap";var y=(0,r.memo)(v)},83109:function(t,e,n){"use strict";n.d(e,{ZA:function(){return o},kX:function(){return c},oY:function(){return i}});var r,i=Object.freeze({Linear:Object.freeze({None:function(t){return t},In:function(t){return t},Out:function(t){return t},InOut:function(t){return t}}),Quadratic:Object.freeze({In:function(t){return t*t},Out:function(t){return t*(2-t)},InOut:function(t){return(t*=2)<1?.5*t*t:-.5*(--t*(t-2)-1)}}),Cubic:Object.freeze({In:function(t){return t*t*t},Out:function(t){return--t*t*t+1},InOut:function(t){return(t*=2)<1?.5*t*t*t:.5*((t-=2)*t*t+2)}}),Quartic:Object.freeze({In:function(t){return t*t*t*t},Out:function(t){return 1- --t*t*t*t},InOut:function(t){return(t*=2)<1?.5*t*t*t*t:-.5*((t-=2)*t*t*t-2)}}),Quintic:Object.freeze({In:function(t){return t*t*t*t*t},Out:function(t){return--t*t*t*t*t+1},InOut:function(t){return(t*=2)<1?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2)}}),Sinusoidal:Object.freeze({In:function(t){return 1-Math.sin((1-t)*Math.PI/2)},Out:function(t){return Math.sin(t*Math.PI/2)},InOut:function(t){return.5*(1-Math.sin(Math.PI*(.5-t)))}}),Exponential:Object.freeze({In:function(t){return 0===t?0:Math.pow(1024,t-1)},Out:function(t){return 1===t?1:1-Math.pow(2,-10*t)},InOut:function(t){return 0===t?0:1===t?1:(t*=2)<1?.5*Math.pow(1024,t-1):.5*(2-Math.pow(2,-10*(t-1)))}}),Circular:Object.freeze({In:function(t){return 1-Math.sqrt(1-t*t)},Out:function(t){return Math.sqrt(1- --t*t)},InOut:function(t){return(t*=2)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)}}),Elastic:Object.freeze({In:function(t){return 0===t?0:1===t?1:-Math.pow(2,10*(t-1))*Math.sin(5*(t-1.1)*Math.PI)},Out:function(t){return 0===t?0:1===t?1:Math.pow(2,-10*t)*Math.sin(5*(t-.1)*Math.PI)+1},InOut:function(t){return 0===t?0:1===t?1:(t*=2)<1?-.5*Math.pow(2,10*(t-1))*Math.sin(5*(t-1.1)*Math.PI):.5*Math.pow(2,-10*(t-1))*Math.sin(5*(t-1.1)*Math.PI)+1}}),Back:Object.freeze({In:function(t){var e=1.70158;return 1===t?1:t*t*((e+1)*t-e)},Out:function(t){var e=1.70158;return 0===t?0:--t*t*((e+1)*t+e)+1},InOut:function(t){var e=2.5949095;return(t*=2)<1?t*t*((e+1)*t-e)*.5:.5*((t-=2)*t*((e+1)*t+e)+2)}}),Bounce:Object.freeze({In:function(t){return 1-i.Bounce.Out(1-t)},Out:function(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375},InOut:function(t){return t<.5?.5*i.Bounce.In(2*t):.5*i.Bounce.Out(2*t-1)+.5}}),generatePow:function(t){return void 0===t&&(t=4),t=(t=t<Number.EPSILON?Number.EPSILON:t)>1e4?1e4:t,{In:function(e){return Math.pow(e,t)},Out:function(e){return 1-Math.pow(1-e,t)},InOut:function(e){return e<.5?Math.pow(2*e,t)/2:(1-Math.pow(2-2*e,t))/2+.5}}}}),s=function(){return performance.now()},o=function(){function t(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._tweens={},this._tweensAddedDuringUpdate={},this.add.apply(this,t)}return t.prototype.getAll=function(){var t=this;return Object.keys(this._tweens).map((function(e){return t._tweens[e]}))},t.prototype.removeAll=function(){this._tweens={}},t.prototype.add=function(){for(var t,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];for(var r=0,i=e;r<i.length;r++){var s=i[r];null===(t=s._group)||void 0===t||t.remove(s),s._group=this,this._tweens[s.getId()]=s,this._tweensAddedDuringUpdate[s.getId()]=s}},t.prototype.remove=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=0,r=t;n<r.length;n++){var i=r[n];i._group=void 0,delete this._tweens[i.getId()],delete this._tweensAddedDuringUpdate[i.getId()]}},t.prototype.allStopped=function(){return this.getAll().every((function(t){return!t.isPlaying()}))},t.prototype.update=function(t,e){void 0===t&&(t=s()),void 0===e&&(e=!0);var n=Object.keys(this._tweens);if(0!==n.length)for(;n.length>0;){this._tweensAddedDuringUpdate={};for(var r=0;r<n.length;r++){var i=this._tweens[n[r]],o=!e;i&&!1===i.update(t,o)&&!e&&this.remove(i)}n=Object.keys(this._tweensAddedDuringUpdate)}},t}(),a={Linear:function(t,e){var n=t.length-1,r=n*e,i=Math.floor(r),s=a.Utils.Linear;return e<0?s(t[0],t[1],r):e>1?s(t[n],t[n-1],n-r):s(t[i],t[i+1>n?n:i+1],r-i)},Bezier:function(t,e){for(var n=0,r=t.length-1,i=Math.pow,s=a.Utils.Bernstein,o=0;o<=r;o++)n+=i(1-e,r-o)*i(e,o)*t[o]*s(r,o);return n},CatmullRom:function(t,e){var n=t.length-1,r=n*e,i=Math.floor(r),s=a.Utils.CatmullRom;return t[0]===t[n]?(e<0&&(i=Math.floor(r=n*(1+e))),s(t[(i-1+n)%n],t[i],t[(i+1)%n],t[(i+2)%n],r-i)):e<0?t[0]-(s(t[0],t[0],t[1],t[1],-r)-t[0]):e>1?t[n]-(s(t[n],t[n],t[n-1],t[n-1],r-n)-t[n]):s(t[i?i-1:0],t[i],t[n<i+1?n:i+1],t[n<i+2?n:i+2],r-i)},Utils:{Linear:function(t,e,n){return(e-t)*n+t},Bernstein:function(t,e){var n=a.Utils.Factorial;return n(t)/n(e)/n(t-e)},Factorial:(r=[1],function(t){var e=1;if(r[t])return r[t];for(var n=t;n>1;n--)e*=n;return r[t]=e,e}),CatmullRom:function(t,e,n,r,i){var s=.5*(n-t),o=.5*(r-e),a=i*i;return(2*e-2*n+s+o)*(i*a)+(-3*e+3*n-2*s-o)*a+s*i+e}}},l=function(){function t(){}return t.nextId=function(){return t._nextId++},t._nextId=0,t}(),u=new o,c=function(){function t(t,e){this._isPaused=!1,this._pauseStart=0,this._valuesStart={},this._valuesEnd={},this._valuesStartRepeat={},this._duration=1e3,this._isDynamic=!1,this._initialRepeat=0,this._repeat=0,this._yoyo=!1,this._isPlaying=!1,this._reversed=!1,this._delayTime=0,this._startTime=0,this._easingFunction=i.Linear.None,this._interpolationFunction=a.Linear,this._chainedTweens=[],this._onStartCallbackFired=!1,this._onEveryStartCallbackFired=!1,this._id=l.nextId(),this._isChainStopped=!1,this._propertiesAreSetUp=!1,this._goToEnd=!1,this._object=t,"object"==typeof e?(this._group=e,e.add(this)):!0===e&&(this._group=u,u.add(this))}return t.prototype.getId=function(){return this._id},t.prototype.isPlaying=function(){return this._isPlaying},t.prototype.isPaused=function(){return this._isPaused},t.prototype.getDuration=function(){return this._duration},t.prototype.to=function(t,e){if(void 0===e&&(e=1e3),this._isPlaying)throw new Error("Can not call Tween.to() while Tween is already started or paused. Stop the Tween first.");return this._valuesEnd=t,this._propertiesAreSetUp=!1,this._duration=e<0?0:e,this},t.prototype.duration=function(t){return void 0===t&&(t=1e3),this._duration=t<0?0:t,this},t.prototype.dynamic=function(t){return void 0===t&&(t=!1),this._isDynamic=t,this},t.prototype.start=function(t,e){if(void 0===t&&(t=s()),void 0===e&&(e=!1),this._isPlaying)return this;if(this._repeat=this._initialRepeat,this._reversed)for(var n in this._reversed=!1,this._valuesStartRepeat)this._swapEndStartRepeatValues(n),this._valuesStart[n]=this._valuesStartRepeat[n];if(this._isPlaying=!0,this._isPaused=!1,this._onStartCallbackFired=!1,this._onEveryStartCallbackFired=!1,this._isChainStopped=!1,this._startTime=t,this._startTime+=this._delayTime,!this._propertiesAreSetUp||e){if(this._propertiesAreSetUp=!0,!this._isDynamic){var r={};for(var i in this._valuesEnd)r[i]=this._valuesEnd[i];this._valuesEnd=r}this._setupProperties(this._object,this._valuesStart,this._valuesEnd,this._valuesStartRepeat,e)}return this},t.prototype.startFromCurrentValues=function(t){return this.start(t,!0)},t.prototype._setupProperties=function(t,e,n,r,i){for(var s in n){var o=t[s],a=Array.isArray(o),l=a?"array":typeof o,u=!a&&Array.isArray(n[s]);if("undefined"!==l&&"function"!==l){if(u){if(0===(g=n[s]).length)continue;for(var c=[o],h=0,d=g.length;h<d;h+=1){var p=this._handleRelativeValue(o,g[h]);if(isNaN(p)){u=!1,console.warn("Found invalid interpolation list. Skipping.");break}c.push(p)}u&&(n[s]=c)}if("object"!==l&&!a||!o||u)(void 0===e[s]||i)&&(e[s]=o),a||(e[s]*=1),r[s]=u?n[s].slice().reverse():e[s]||0;else{e[s]=a?[]:{};var f=o;for(var m in f)e[s][m]=f[m];r[s]=a?[]:{};var g=n[s];if(!this._isDynamic){var v={};for(var m in g)v[m]=g[m];n[s]=g=v}this._setupProperties(f,e[s],g,r[s],i)}}}},t.prototype.stop=function(){return this._isChainStopped||(this._isChainStopped=!0,this.stopChainedTweens()),this._isPlaying?(this._isPlaying=!1,this._isPaused=!1,this._onStopCallback&&this._onStopCallback(this._object),this):this},t.prototype.end=function(){return this._goToEnd=!0,this.update(this._startTime+this._duration),this},t.prototype.pause=function(t){return void 0===t&&(t=s()),this._isPaused||!this._isPlaying||(this._isPaused=!0,this._pauseStart=t),this},t.prototype.resume=function(t){return void 0===t&&(t=s()),this._isPaused&&this._isPlaying?(this._isPaused=!1,this._startTime+=t-this._pauseStart,this._pauseStart=0,this):this},t.prototype.stopChainedTweens=function(){for(var t=0,e=this._chainedTweens.length;t<e;t++)this._chainedTweens[t].stop();return this},t.prototype.group=function(t){return t?(t.add(this),this):(console.warn("tween.group() without args has been removed, use group.add(tween) instead."),this)},t.prototype.remove=function(){var t;return null===(t=this._group)||void 0===t||t.remove(this),this},t.prototype.delay=function(t){return void 0===t&&(t=0),this._delayTime=t,this},t.prototype.repeat=function(t){return void 0===t&&(t=0),this._initialRepeat=t,this._repeat=t,this},t.prototype.repeatDelay=function(t){return this._repeatDelayTime=t,this},t.prototype.yoyo=function(t){return void 0===t&&(t=!1),this._yoyo=t,this},t.prototype.easing=function(t){return void 0===t&&(t=i.Linear.None),this._easingFunction=t,this},t.prototype.interpolation=function(t){return void 0===t&&(t=a.Linear),this._interpolationFunction=t,this},t.prototype.chain=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return this._chainedTweens=t,this},t.prototype.onStart=function(t){return this._onStartCallback=t,this},t.prototype.onEveryStart=function(t){return this._onEveryStartCallback=t,this},t.prototype.onUpdate=function(t){return this._onUpdateCallback=t,this},t.prototype.onRepeat=function(t){return this._onRepeatCallback=t,this},t.prototype.onComplete=function(t){return this._onCompleteCallback=t,this},t.prototype.onStop=function(t){return this._onStopCallback=t,this},t.prototype.update=function(e,n){var r,i,o=this;if(void 0===e&&(e=s()),void 0===n&&(n=t.autoStartOnUpdate),this._isPaused)return!0;if(!this._goToEnd&&!this._isPlaying){if(!n)return!1;this.start(e,!0)}if(this._goToEnd=!1,e<this._startTime)return!0;!1===this._onStartCallbackFired&&(this._onStartCallback&&this._onStartCallback(this._object),this._onStartCallbackFired=!0),!1===this._onEveryStartCallbackFired&&(this._onEveryStartCallback&&this._onEveryStartCallback(this._object),this._onEveryStartCallbackFired=!0);var a=e-this._startTime,l=this._duration+(null!==(r=this._repeatDelayTime)&&void 0!==r?r:this._delayTime),u=this._duration+this._repeat*l,c=function(){if(0===o._duration)return 1;if(a>u)return 1;var t=Math.trunc(a/l),e=a-t*l,n=Math.min(e/o._duration,1);return 0===n&&a===o._duration?1:n}(),h=this._easingFunction(c);if(this._updateProperties(this._object,this._valuesStart,this._valuesEnd,h),this._onUpdateCallback&&this._onUpdateCallback(this._object,c),0===this._duration||a>=this._duration){if(this._repeat>0){var d=Math.min(Math.trunc((a-this._duration)/l)+1,this._repeat);for(i in isFinite(this._repeat)&&(this._repeat-=d),this._valuesStartRepeat)this._yoyo||"string"!=typeof this._valuesEnd[i]||(this._valuesStartRepeat[i]=this._valuesStartRepeat[i]+parseFloat(this._valuesEnd[i])),this._yoyo&&this._swapEndStartRepeatValues(i),this._valuesStart[i]=this._valuesStartRepeat[i];return this._yoyo&&(this._reversed=!this._reversed),this._startTime+=l*d,this._onRepeatCallback&&this._onRepeatCallback(this._object),this._onEveryStartCallbackFired=!1,!0}this._onCompleteCallback&&this._onCompleteCallback(this._object);for(var p=0,f=this._chainedTweens.length;p<f;p++)this._chainedTweens[p].start(this._startTime+this._duration,!1);return this._isPlaying=!1,!1}return!0},t.prototype._updateProperties=function(t,e,n,r){for(var i in n)if(void 0!==e[i]){var s=e[i]||0,o=n[i],a=Array.isArray(t[i]),l=Array.isArray(o);!a&&l?t[i]=this._interpolationFunction(o,r):"object"==typeof o&&o?this._updateProperties(t[i],s,o,r):"number"==typeof(o=this._handleRelativeValue(s,o))&&(t[i]=s+(o-s)*r)}},t.prototype._handleRelativeValue=function(t,e){return"string"!=typeof e?e:"+"===e.charAt(0)||"-"===e.charAt(0)?t+parseFloat(e):parseFloat(e)},t.prototype._swapEndStartRepeatValues=function(t){var e=this._valuesStartRepeat[t],n=this._valuesEnd[t];this._valuesStartRepeat[t]="string"==typeof n?this._valuesStartRepeat[t]+parseFloat(n):this._valuesEnd[t],this._valuesEnd[t]=e},t.autoStartOnUpdate=!1,t}(),h=(l.nextId,u);h.getAll.bind(h),h.removeAll.bind(h),h.add.bind(h),h.remove.bind(h),h.update.bind(h)},51029:function(t,e,n){"use strict";n.d(e,{Z:function(){return Xe}});var r={};n.r(r),n.d(r,{hasBrowserEnv:function(){return Et},hasStandardBrowserEnv:function(){return At},hasStandardBrowserWebWorkerEnv:function(){return Ct},navigator:function(){return Tt},origin:function(){return Rt}});var i=n(48305),s=n(31759);function o(t,e){return function(){return t.apply(e,arguments)}}var a,l=n(14224),u=Object.prototype.toString,c=Object.getPrototypeOf,h=(a=Object.create(null),function(t){var e=u.call(t);return a[e]||(a[e]=e.slice(8,-1).toLowerCase())}),d=function(t){return t=t.toLowerCase(),function(e){return h(e)===t}},p=function(t){return function(e){return s(e)===t}},f=Array.isArray,m=p("undefined");var g=d("ArrayBuffer");var v=p("string"),y=p("function"),_=p("number"),x=function(t){return null!==t&&"object"===s(t)},b=function(t){if("object"!==h(t))return!1;var e=c(t);return!(null!==e&&e!==Object.prototype&&null!==Object.getPrototypeOf(e)||Symbol.toStringTag in t||Symbol.iterator in t)},w=d("Date"),S=d("File"),M=d("Blob"),E=d("FileList"),T=d("URLSearchParams"),A=["ReadableStream","Request","Response","Headers"].map(d),C=i(A,4),R=C[0],N=C[1],P=C[2],I=C[3];function O(t,e){var n,r,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=i.allOwnKeys,a=void 0!==o&&o;if(null!=t)if("object"!==s(t)&&(t=[t]),f(t))for(n=0,r=t.length;n<r;n++)e.call(null,t[n],n,t);else{var l,u=a?Object.getOwnPropertyNames(t):Object.keys(t),c=u.length;for(n=0;n<c;n++)l=u[n],e.call(null,t[l],l,t)}}function D(t,e){e=e.toLowerCase();for(var n,r=Object.keys(t),i=r.length;i-- >0;)if(e===(n=r[i]).toLowerCase())return n;return null}var L="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:global,U=function(t){return!m(t)&&t!==L};var k,B,F=(k="undefined"!=typeof Uint8Array&&c(Uint8Array),function(t){return k&&t instanceof k}),z=d("HTMLFormElement"),V=(B=Object.prototype.hasOwnProperty,function(t,e){return B.call(t,e)}),G=d("RegExp"),j=function(t,e){var n=Object.getOwnPropertyDescriptors(t),r={};O(n,(function(n,i){var s;!1!==(s=e(n,i,t))&&(r[i]=s||n)})),Object.defineProperties(t,r)},H="abcdefghijklmnopqrstuvwxyz",W="0123456789",q={DIGIT:W,ALPHA:H,ALPHA_DIGIT:H+H.toUpperCase()+W};var X,Z,$,Y,K=d("AsyncFunction"),J=(X="function"==typeof setImmediate,Z=y(L.postMessage),X?setImmediate:Z?($="axios@".concat(Math.random()),Y=[],L.addEventListener("message",(function(t){var e=t.source,n=t.data;e===L&&n===$&&Y.length&&Y.shift()()}),!1),function(t){Y.push(t),L.postMessage($,"*")}):function(t){return setTimeout(t)}),Q="undefined"!=typeof queueMicrotask?queueMicrotask.bind(L):void 0!==l&&l.nextTick||J,tt={isArray:f,isArrayBuffer:g,isBuffer:function(t){return null!==t&&!m(t)&&null!==t.constructor&&!m(t.constructor)&&y(t.constructor.isBuffer)&&t.constructor.isBuffer(t)},isFormData:function(t){var e;return t&&("function"==typeof FormData&&t instanceof FormData||y(t.append)&&("formdata"===(e=h(t))||"object"===e&&y(t.toString)&&"[object FormData]"===t.toString()))},isArrayBufferView:function(t){return"undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(t):t&&t.buffer&&g(t.buffer)},isString:v,isNumber:_,isBoolean:function(t){return!0===t||!1===t},isObject:x,isPlainObject:b,isReadableStream:R,isRequest:N,isResponse:P,isHeaders:I,isUndefined:m,isDate:w,isFile:S,isBlob:M,isRegExp:G,isFunction:y,isStream:function(t){return x(t)&&y(t.pipe)},isURLSearchParams:T,isTypedArray:F,isFileList:E,forEach:O,merge:function t(){for(var e=U(this)&&this||{},n=e.caseless,r={},i=function(e,i){var s=n&&D(r,i)||i;b(r[s])&&b(e)?r[s]=t(r[s],e):b(e)?r[s]=t({},e):f(e)?r[s]=e.slice():r[s]=e},s=0,o=arguments.length;s<o;s++)arguments[s]&&O(arguments[s],i);return r},extend:function(t,e,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},i=r.allOwnKeys;return O(e,(function(e,r){n&&y(e)?t[r]=o(e,n):t[r]=e}),{allOwnKeys:i}),t},trim:function(t){return t.trim?t.trim():t.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")},stripBOM:function(t){return 65279===t.charCodeAt(0)&&(t=t.slice(1)),t},inherits:function(t,e,n,r){t.prototype=Object.create(e.prototype,r),t.prototype.constructor=t,Object.defineProperty(t,"super",{value:e.prototype}),n&&Object.assign(t.prototype,n)},toFlatObject:function(t,e,n,r){var i,s,o,a={};if(e=e||{},null==t)return e;do{for(s=(i=Object.getOwnPropertyNames(t)).length;s-- >0;)o=i[s],r&&!r(o,t,e)||a[o]||(e[o]=t[o],a[o]=!0);t=!1!==n&&c(t)}while(t&&(!n||n(t,e))&&t!==Object.prototype);return e},kindOf:h,kindOfTest:d,endsWith:function(t,e,n){t=String(t),(void 0===n||n>t.length)&&(n=t.length),n-=e.length;var r=t.indexOf(e,n);return-1!==r&&r===n},toArray:function(t){if(!t)return null;if(f(t))return t;var e=t.length;if(!_(e))return null;for(var n=new Array(e);e-- >0;)n[e]=t[e];return n},forEachEntry:function(t,e){for(var n,r=(t&&t[Symbol.iterator]).call(t);(n=r.next())&&!n.done;){var i=n.value;e.call(t,i[0],i[1])}},matchAll:function(t,e){for(var n,r=[];null!==(n=t.exec(e));)r.push(n);return r},isHTMLForm:z,hasOwnProperty:V,hasOwnProp:V,reduceDescriptors:j,freezeMethods:function(t){j(t,(function(e,n){if(y(t)&&-1!==["arguments","caller","callee"].indexOf(n))return!1;var r=t[n];y(r)&&(e.enumerable=!1,"writable"in e?e.writable=!1:e.set||(e.set=function(){throw Error("Can not rewrite read-only method '"+n+"'")}))}))},toObjectSet:function(t,e){var n={},r=function(t){t.forEach((function(t){n[t]=!0}))};return f(t)?r(t):r(String(t).split(e)),n},toCamelCase:function(t){return t.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,(function(t,e,n){return e.toUpperCase()+n}))},noop:function(){},toFiniteNumber:function(t,e){return null!=t&&Number.isFinite(t=+t)?t:e},findKey:D,global:L,isContextDefined:U,ALPHABET:q,generateString:function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:16,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:q.ALPHA_DIGIT,n="",r=e.length;t--;)n+=e[Math.random()*r|0];return n},isSpecCompliantForm:function(t){return!!(t&&y(t.append)&&"FormData"===t[Symbol.toStringTag]&&t[Symbol.iterator])},toJSONObject:function(t){var e=new Array(10);return function t(n,r){if(x(n)){if(e.indexOf(n)>=0)return;if(!("toJSON"in n)){e[r]=n;var i=f(n)?[]:{};return O(n,(function(e,n){var s=t(e,r+1);!m(s)&&(i[n]=s)})),e[r]=void 0,i}}return n}(t,0)},isAsyncFn:K,isThenable:function(t){return t&&(x(t)||y(t))&&y(t.then)&&y(t.catch)},setImmediate:J,asap:Q},et=n(90228),nt=n(87999),rt=n(25298),it=n(17069);function st(t,e,n,r,i){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=(new Error).stack,this.message=t,this.name="AxiosError",e&&(this.code=e),n&&(this.config=n),r&&(this.request=r),i&&(this.response=i,this.status=i.status?i.status:null)}tt.inherits(st,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:tt.toJSONObject(this.config),code:this.code,status:this.status}}});var ot=st.prototype,at={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach((function(t){at[t]={value:t}})),Object.defineProperties(st,at),Object.defineProperty(ot,"isAxiosError",{value:!0}),st.from=function(t,e,n,r,i,s){var o=Object.create(ot);return tt.toFlatObject(t,o,(function(t){return t!==Error.prototype}),(function(t){return"isAxiosError"!==t})),st.call(o,t.message,e,n,r,i),o.cause=t,o.name=t.name,s&&Object.assign(o,s),o};var lt=st,ut=n(55872).Buffer;function ct(t){return tt.isPlainObject(t)||tt.isArray(t)}function ht(t){return tt.endsWith(t,"[]")?t.slice(0,-2):t}function dt(t,e,n){return t?t.concat(e).map((function(t,e){return t=ht(t),!n&&e?"["+t+"]":t})).join(n?".":""):e}var pt=tt.toFlatObject(tt,{},null,(function(t){return/^is[A-Z]/.test(t)}));var ft=function(t,e,n){if(!tt.isObject(t))throw new TypeError("target must be an object");e=e||new FormData;var r=(n=tt.toFlatObject(n,{metaTokens:!0,dots:!1,indexes:!1},!1,(function(t,e){return!tt.isUndefined(e[t])}))).metaTokens,i=n.visitor||c,o=n.dots,a=n.indexes,l=(n.Blob||"undefined"!=typeof Blob&&Blob)&&tt.isSpecCompliantForm(e);if(!tt.isFunction(i))throw new TypeError("visitor must be a function");function u(t){if(null===t)return"";if(tt.isDate(t))return t.toISOString();if(!l&&tt.isBlob(t))throw new lt("Blob is not supported. Use a Buffer instead.");return tt.isArrayBuffer(t)||tt.isTypedArray(t)?l&&"function"==typeof Blob?new Blob([t]):ut.from(t):t}function c(t,n,i){var l=t;if(t&&!i&&"object"===s(t))if(tt.endsWith(n,"{}"))n=r?n:n.slice(0,-2),t=JSON.stringify(t);else if(tt.isArray(t)&&function(t){return tt.isArray(t)&&!t.some(ct)}(t)||(tt.isFileList(t)||tt.endsWith(n,"[]"))&&(l=tt.toArray(t)))return n=ht(n),l.forEach((function(t,r){!tt.isUndefined(t)&&null!==t&&e.append(!0===a?dt([n],r,o):null===a?n:n+"[]",u(t))})),!1;return!!ct(t)||(e.append(dt(i,n,o),u(t)),!1)}var h=[],d=Object.assign(pt,{defaultVisitor:c,convertValue:u,isVisitable:ct});if(!tt.isObject(t))throw new TypeError("data must be an object");return function t(n,r){if(!tt.isUndefined(n)){if(-1!==h.indexOf(n))throw Error("Circular reference detected in "+r.join("."));h.push(n),tt.forEach(n,(function(n,s){!0===(!(tt.isUndefined(n)||null===n)&&i.call(e,n,tt.isString(s)?s.trim():s,r,d))&&t(n,r?r.concat(s):[s])})),h.pop()}}(t),e};function mt(t){var e={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(t).replace(/[!'()~]|%20|%00/g,(function(t){return e[t]}))}function gt(t,e){this._pairs=[],t&&ft(t,this,e)}var vt=gt.prototype;vt.append=function(t,e){this._pairs.push([t,e])},vt.toString=function(t){var e=t?function(e){return t.call(this,e,mt)}:mt;return this._pairs.map((function(t){return e(t[0])+"="+e(t[1])}),"").join("&")};var yt=gt;function _t(t){return encodeURIComponent(t).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function xt(t,e,n){if(!e)return t;var r,i=n&&n.encode||_t,s=n&&n.serialize;if(r=s?s(e,n):tt.isURLSearchParams(e)?e.toString():new yt(e,n).toString(i)){var o=t.indexOf("#");-1!==o&&(t=t.slice(0,o)),t+=(-1===t.indexOf("?")?"?":"&")+r}return t}var bt=function(){function t(){rt(this,t),this.handlers=[]}return it(t,[{key:"use",value:function(t,e,n){return this.handlers.push({fulfilled:t,rejected:e,synchronous:!!n&&n.synchronous,runWhen:n?n.runWhen:null}),this.handlers.length-1}},{key:"eject",value:function(t){this.handlers[t]&&(this.handlers[t]=null)}},{key:"clear",value:function(){this.handlers&&(this.handlers=[])}},{key:"forEach",value:function(t){tt.forEach(this.handlers,(function(e){null!==e&&t(e)}))}}]),t}(),wt={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},St=n(26068),Mt={isBrowser:!0,classes:{URLSearchParams:"undefined"!=typeof URLSearchParams?URLSearchParams:yt,FormData:"undefined"!=typeof FormData?FormData:null,Blob:"undefined"!=typeof Blob?Blob:null},protocols:["http","https","file","blob","url","data"]},Et="undefined"!=typeof window&&"undefined"!=typeof document,Tt="object"===("undefined"==typeof navigator?"undefined":s(navigator))&&navigator||void 0,At=Et&&(!Tt||["ReactNative","NativeScript","NS"].indexOf(Tt.product)<0),Ct="undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&"function"==typeof self.importScripts,Rt=Et&&window.location.href||"http://localhost",Nt=St(St({},r),Mt);var Pt=function(t){function e(t,n,r,i){var s=t[i++];if("__proto__"===s)return!0;var o=Number.isFinite(+s),a=i>=t.length;return s=!s&&tt.isArray(r)?r.length:s,a?(tt.hasOwnProp(r,s)?r[s]=[r[s],n]:r[s]=n,!o):(r[s]&&tt.isObject(r[s])||(r[s]=[]),e(t,n,r[s],i)&&tt.isArray(r[s])&&(r[s]=function(t){var e,n,r={},i=Object.keys(t),s=i.length;for(e=0;e<s;e++)r[n=i[e]]=t[n];return r}(r[s])),!o)}if(tt.isFormData(t)&&tt.isFunction(t.entries)){var n={};return tt.forEachEntry(t,(function(t,r){e(function(t){return tt.matchAll(/\w+|\[(\w*)]/g,t).map((function(t){return"[]"===t[0]?"":t[1]||t[0]}))}(t),r,n,0)})),n}return null};var It={transitional:wt,adapter:["xhr","http","fetch"],transformRequest:[function(t,e){var n,r=e.getContentType()||"",i=r.indexOf("application/json")>-1,s=tt.isObject(t);if(s&&tt.isHTMLForm(t)&&(t=new FormData(t)),tt.isFormData(t))return i?JSON.stringify(Pt(t)):t;if(tt.isArrayBuffer(t)||tt.isBuffer(t)||tt.isStream(t)||tt.isFile(t)||tt.isBlob(t)||tt.isReadableStream(t))return t;if(tt.isArrayBufferView(t))return t.buffer;if(tt.isURLSearchParams(t))return e.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),t.toString();if(s){if(r.indexOf("application/x-www-form-urlencoded")>-1)return function(t,e){return ft(t,new Nt.classes.URLSearchParams,Object.assign({visitor:function(t,e,n,r){return Nt.isNode&&tt.isBuffer(t)?(this.append(e,t.toString("base64")),!1):r.defaultVisitor.apply(this,arguments)}},e))}(t,this.formSerializer).toString();if((n=tt.isFileList(t))||r.indexOf("multipart/form-data")>-1){var o=this.env&&this.env.FormData;return ft(n?{"files[]":t}:t,o&&new o,this.formSerializer)}}return s||i?(e.setContentType("application/json",!1),function(t,e,n){if(tt.isString(t))try{return(e||JSON.parse)(t),tt.trim(t)}catch(t){if("SyntaxError"!==t.name)throw t}return(n||JSON.stringify)(t)}(t)):t}],transformResponse:[function(t){var e=this.transitional||It.transitional,n=e&&e.forcedJSONParsing,r="json"===this.responseType;if(tt.isResponse(t)||tt.isReadableStream(t))return t;if(t&&tt.isString(t)&&(n&&!this.responseType||r)){var i=!(e&&e.silentJSONParsing)&&r;try{return JSON.parse(t)}catch(t){if(i){if("SyntaxError"===t.name)throw lt.from(t,lt.ERR_BAD_RESPONSE,this,null,this.response);throw t}}}return t}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:Nt.classes.FormData,Blob:Nt.classes.Blob},validateStatus:function(t){return t>=200&&t<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};tt.forEach(["delete","get","head","post","put","patch"],(function(t){It.headers[t]={}}));var Ot=It,Dt=n(335),Lt=tt.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),Ut=Symbol("internals");function kt(t){return t&&String(t).trim().toLowerCase()}function Bt(t){return!1===t||null==t?t:tt.isArray(t)?t.map(Bt):String(t)}function Ft(t,e,n,r,i){return tt.isFunction(r)?r.call(this,e,n):(i&&(e=n),tt.isString(e)?tt.isString(r)?-1!==e.indexOf(r):tt.isRegExp(r)?r.test(e):void 0:void 0)}var zt=function(t,e){function n(t){rt(this,n),t&&this.set(t)}return it(n,[{key:"set",value:function(t,e,n){var r=this;function s(t,e,n){var i=kt(e);if(!i)throw new Error("header name must be a non-empty string");var s=tt.findKey(r,i);(!s||void 0===r[s]||!0===n||void 0===n&&!1!==r[s])&&(r[s||e]=Bt(t))}var o=function(t,e){return tt.forEach(t,(function(t,n){return s(t,n,e)}))};if(tt.isPlainObject(t)||t instanceof this.constructor)o(t,e);else if(tt.isString(t)&&(t=t.trim())&&!/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(t.trim()))o(function(t){var e,n,r,i={};return t&&t.split("\n").forEach((function(t){r=t.indexOf(":"),e=t.substring(0,r).trim().toLowerCase(),n=t.substring(r+1).trim(),!e||i[e]&&Lt[e]||("set-cookie"===e?i[e]?i[e].push(n):i[e]=[n]:i[e]=i[e]?i[e]+", "+n:n)})),i}(t),e);else if(tt.isHeaders(t)){var a,l=Dt(t.entries());try{for(l.s();!(a=l.n()).done;){var u=i(a.value,2),c=u[0];s(u[1],c,n)}}catch(t){l.e(t)}finally{l.f()}}else null!=t&&s(e,t,n);return this}},{key:"get",value:function(t,e){if(t=kt(t)){var n=tt.findKey(this,t);if(n){var r=this[n];if(!e)return r;if(!0===e)return function(t){for(var e,n=Object.create(null),r=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;e=r.exec(t);)n[e[1]]=e[2];return n}(r);if(tt.isFunction(e))return e.call(this,r,n);if(tt.isRegExp(e))return e.exec(r);throw new TypeError("parser must be boolean|regexp|function")}}}},{key:"has",value:function(t,e){if(t=kt(t)){var n=tt.findKey(this,t);return!(!n||void 0===this[n]||e&&!Ft(0,this[n],n,e))}return!1}},{key:"delete",value:function(t,e){var n=this,r=!1;function i(t){if(t=kt(t)){var i=tt.findKey(n,t);!i||e&&!Ft(0,n[i],i,e)||(delete n[i],r=!0)}}return tt.isArray(t)?t.forEach(i):i(t),r}},{key:"clear",value:function(t){for(var e=Object.keys(this),n=e.length,r=!1;n--;){var i=e[n];t&&!Ft(0,this[i],i,t,!0)||(delete this[i],r=!0)}return r}},{key:"normalize",value:function(t){var e=this,n={};return tt.forEach(this,(function(r,i){var s=tt.findKey(n,i);if(s)return e[s]=Bt(r),void delete e[i];var o=t?function(t){return t.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(function(t,e,n){return e.toUpperCase()+n}))}(i):String(i).trim();o!==i&&delete e[i],e[o]=Bt(r),n[o]=!0})),this}},{key:"concat",value:function(){for(var t,e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return(t=this.constructor).concat.apply(t,[this].concat(n))}},{key:"toJSON",value:function(t){var e=Object.create(null);return tt.forEach(this,(function(n,r){null!=n&&!1!==n&&(e[r]=t&&tt.isArray(n)?n.join(", "):n)})),e}},{key:t,value:function(){return Object.entries(this.toJSON())[Symbol.iterator]()}},{key:"toString",value:function(){return Object.entries(this.toJSON()).map((function(t){var e=i(t,2);return e[0]+": "+e[1]})).join("\n")}},{key:e,get:function(){return"AxiosHeaders"}}],[{key:"from",value:function(t){return t instanceof this?t:new this(t)}},{key:"concat",value:function(t){for(var e=new this(t),n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];return r.forEach((function(t){return e.set(t)})),e}},{key:"accessor",value:function(t){var e=(this[Ut]=this[Ut]={accessors:{}}).accessors,n=this.prototype;function r(t){var r=kt(t);e[r]||(!function(t,e){var n=tt.toCamelCase(" "+e);["get","set","has"].forEach((function(r){Object.defineProperty(t,r+n,{value:function(t,n,i){return this[r].call(this,e,t,n,i)},configurable:!0})}))}(n,t),e[r]=!0)}return tt.isArray(t)?t.forEach(r):r(t),this}}]),n}(Symbol.iterator,Symbol.toStringTag);zt.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),tt.reduceDescriptors(zt.prototype,(function(t,e){var n=t.value,r=e[0].toUpperCase()+e.slice(1);return{get:function(){return n},set:function(t){this[r]=t}}})),tt.freezeMethods(zt);var Vt=zt;function Gt(t,e){var n=this||Ot,r=e||n,i=Vt.from(r.headers),s=r.data;return tt.forEach(t,(function(t){s=t.call(n,s,i.normalize(),e?e.status:void 0)})),i.normalize(),s}function jt(t){return!(!t||!t.__CANCEL__)}function Ht(t,e,n){lt.call(this,null==t?"canceled":t,lt.ERR_CANCELED,e,n),this.name="CanceledError"}tt.inherits(Ht,lt,{__CANCEL__:!0});var Wt=Ht;function qt(t,e,n){var r=n.config.validateStatus;n.status&&r&&!r(n.status)?e(new lt("Request failed with status code "+n.status,[lt.ERR_BAD_REQUEST,lt.ERR_BAD_RESPONSE][Math.floor(n.status/100)-4],n.config,n.request,n)):t(n)}var Xt=n(82092);var Zt=function(t,e){t=t||10;var n,r=new Array(t),i=new Array(t),s=0,o=0;return e=void 0!==e?e:1e3,function(a){var l=Date.now(),u=i[o];n||(n=l),r[s]=a,i[s]=l;for(var c=o,h=0;c!==s;)h+=r[c++],c%=t;if((s=(s+1)%t)===o&&(o=(o+1)%t),!(l-n<e)){var d=u&&l-u;return d?Math.round(1e3*h/d):void 0}}};var $t=function(t,e){var n,r,i=0,s=1e3/e,o=function(e){var s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Date.now();i=s,n=null,r&&(clearTimeout(r),r=null),t.apply(null,e)};return[function(){for(var t=Date.now(),e=t-i,a=arguments.length,l=new Array(a),u=0;u<a;u++)l[u]=arguments[u];e>=s?o(l,t):(n=l,r||(r=setTimeout((function(){r=null,o(n)}),s-e)))},function(){return n&&o(n)}]},Yt=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,r=0,i=Zt(50,250);return $t((function(n){var s=n.loaded,o=n.lengthComputable?n.total:void 0,a=s-r,l=i(a);r=s;var u=Xt({loaded:s,total:o,progress:o?s/o:void 0,bytes:a,rate:l||void 0,estimated:l&&o&&s<=o?(o-s)/l:void 0,event:n,lengthComputable:null!=o},e?"download":"upload",!0);t(u)}),n)},Kt=function(t,e){var n=null!=t;return[function(r){return e[0]({lengthComputable:n,total:t,loaded:r})},e[1]]},Jt=function(t){return function(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return tt.asap((function(){return t.apply(void 0,n)}))}},Qt=n(15558),te=n(57724),ee=Nt.hasStandardBrowserEnv?function(){var t,e=Nt.navigator&&/(msie|trident)/i.test(Nt.navigator.userAgent),n=document.createElement("a");function r(t){var r=t;return e&&(n.setAttribute("href",r),r=n.href),n.setAttribute("href",r),{href:n.href,protocol:n.protocol?n.protocol.replace(/:$/,""):"",host:n.host,search:n.search?n.search.replace(/^\?/,""):"",hash:n.hash?n.hash.replace(/^#/,""):"",hostname:n.hostname,port:n.port,pathname:"/"===n.pathname.charAt(0)?n.pathname:"/"+n.pathname}}return t=r(window.location.href),function(e){var n=tt.isString(e)?r(e):e;return n.protocol===t.protocol&&n.host===t.host}}():function(){return!0},ne=Nt.hasStandardBrowserEnv?{write:function(t,e,n,r,i,s){var o=[t+"="+encodeURIComponent(e)];tt.isNumber(n)&&o.push("expires="+new Date(n).toGMTString()),tt.isString(r)&&o.push("path="+r),tt.isString(i)&&o.push("domain="+i),!0===s&&o.push("secure"),document.cookie=o.join("; ")},read:function(t){var e=document.cookie.match(new RegExp("(^|;\\s*)("+t+")=([^;]*)"));return e?decodeURIComponent(e[3]):null},remove:function(t){this.write(t,"",Date.now()-864e5)}}:{write:function(){},read:function(){return null},remove:function(){}};function re(t,e){return t&&!/^([a-z][a-z\d+\-.]*:)?\/\//i.test(e)?function(t,e){return e?t.replace(/\/?\/$/,"")+"/"+e.replace(/^\/+/,""):t}(t,e):e}var ie=function(t){return t instanceof Vt?St({},t):t};function se(t,e){e=e||{};var n={};function r(t,e,n){return tt.isPlainObject(t)&&tt.isPlainObject(e)?tt.merge.call({caseless:n},t,e):tt.isPlainObject(e)?tt.merge({},e):tt.isArray(e)?e.slice():e}function i(t,e,n){return tt.isUndefined(e)?tt.isUndefined(t)?void 0:r(void 0,t,n):r(t,e,n)}function s(t,e){if(!tt.isUndefined(e))return r(void 0,e)}function o(t,e){return tt.isUndefined(e)?tt.isUndefined(t)?void 0:r(void 0,t):r(void 0,e)}function a(n,i,s){return s in e?r(n,i):s in t?r(void 0,n):void 0}var l={url:s,method:s,data:s,baseURL:o,transformRequest:o,transformResponse:o,paramsSerializer:o,timeout:o,timeoutMessage:o,withCredentials:o,withXSRFToken:o,adapter:o,responseType:o,xsrfCookieName:o,xsrfHeaderName:o,onUploadProgress:o,onDownloadProgress:o,decompress:o,maxContentLength:o,maxBodyLength:o,beforeRedirect:o,transport:o,httpAgent:o,httpsAgent:o,cancelToken:o,socketPath:o,responseEncoding:o,validateStatus:a,headers:function(t,e){return i(ie(t),ie(e),!0)}};return tt.forEach(Object.keys(Object.assign({},t,e)),(function(r){var s=l[r]||i,o=s(t[r],e[r],r);tt.isUndefined(o)&&s!==a||(n[r]=o)})),n}var oe,ae,le=function(t){var e,n=se({},t),r=n.data,i=n.withXSRFToken,s=n.xsrfHeaderName,o=n.xsrfCookieName,a=n.headers,l=n.auth;if(n.headers=a=Vt.from(a),n.url=xt(re(n.baseURL,n.url),t.params,t.paramsSerializer),l&&a.set("Authorization","Basic "+btoa((l.username||"")+":"+(l.password?unescape(encodeURIComponent(l.password)):""))),tt.isFormData(r))if(Nt.hasStandardBrowserEnv||Nt.hasStandardBrowserWebWorkerEnv)a.setContentType(void 0);else if(!1!==(e=a.getContentType())){var u=e?e.split(";").map((function(t){return t.trim()})).filter(Boolean):[],c=te(u),h=c[0],d=c.slice(1);a.setContentType([h||"multipart/form-data"].concat(Qt(d)).join("; "))}if(Nt.hasStandardBrowserEnv&&(i&&tt.isFunction(i)&&(i=i(n)),i||!1!==i&&ee(n.url))){var p=s&&o&&ne.read(o);p&&a.set(s,p)}return n},ue="undefined"!=typeof XMLHttpRequest&&function(t){return new Promise((function(e,n){var r,s,o,a,l,u=le(t),c=u.data,h=Vt.from(u.headers).normalize(),d=u.responseType,p=u.onUploadProgress,f=u.onDownloadProgress;function m(){a&&a(),l&&l(),u.cancelToken&&u.cancelToken.unsubscribe(r),u.signal&&u.signal.removeEventListener("abort",r)}var g=new XMLHttpRequest;function v(){if(g){var r=Vt.from("getAllResponseHeaders"in g&&g.getAllResponseHeaders());qt((function(t){e(t),m()}),(function(t){n(t),m()}),{data:d&&"text"!==d&&"json"!==d?g.response:g.responseText,status:g.status,statusText:g.statusText,headers:r,config:t,request:g}),g=null}}if(g.open(u.method.toUpperCase(),u.url,!0),g.timeout=u.timeout,"onloadend"in g?g.onloadend=v:g.onreadystatechange=function(){g&&4===g.readyState&&(0!==g.status||g.responseURL&&0===g.responseURL.indexOf("file:"))&&setTimeout(v)},g.onabort=function(){g&&(n(new lt("Request aborted",lt.ECONNABORTED,t,g)),g=null)},g.onerror=function(){n(new lt("Network Error",lt.ERR_NETWORK,t,g)),g=null},g.ontimeout=function(){var e=u.timeout?"timeout of "+u.timeout+"ms exceeded":"timeout exceeded",r=u.transitional||wt;u.timeoutErrorMessage&&(e=u.timeoutErrorMessage),n(new lt(e,r.clarifyTimeoutError?lt.ETIMEDOUT:lt.ECONNABORTED,t,g)),g=null},void 0===c&&h.setContentType(null),"setRequestHeader"in g&&tt.forEach(h.toJSON(),(function(t,e){g.setRequestHeader(e,t)})),tt.isUndefined(u.withCredentials)||(g.withCredentials=!!u.withCredentials),d&&"json"!==d&&(g.responseType=u.responseType),f){var y=Yt(f,!0),_=i(y,2);o=_[0],l=_[1],g.addEventListener("progress",o)}if(p&&g.upload){var x=Yt(p),b=i(x,2);s=b[0],a=b[1],g.upload.addEventListener("progress",s),g.upload.addEventListener("loadend",a)}(u.cancelToken||u.signal)&&(r=function(e){g&&(n(!e||e.type?new Wt(null,t,g):e),g.abort(),g=null)},u.cancelToken&&u.cancelToken.subscribe(r),u.signal&&(u.signal.aborted?r():u.signal.addEventListener("abort",r)));var w,S,M=(w=u.url,(S=/^([-+\w]{1,25})(:?\/\/|:)/.exec(w))&&S[1]||"");M&&-1===Nt.protocols.indexOf(M)?n(new lt("Unsupported protocol "+M+":",lt.ERR_BAD_REQUEST,t)):g.send(c||null)}))},ce=function(t,e){var n=(t=t?t.filter(Boolean):[]).length;if(e||n){var r,i=new AbortController,s=function(t){if(!r){r=!0,a();var e=t instanceof Error?t:this.reason;i.abort(e instanceof lt?e:new Wt(e instanceof Error?e.message:e))}},o=e&&setTimeout((function(){o=null,s(new lt("timeout ".concat(e," of ms exceeded"),lt.ETIMEDOUT))}),e),a=function(){t&&(o&&clearTimeout(o),o=null,t.forEach((function(t){t.unsubscribe?t.unsubscribe(s):t.removeEventListener("abort",s)})),t=null)};t.forEach((function(t){return t.addEventListener("abort",s)}));var l=i.signal;return l.unsubscribe=function(){return tt.asap(a)},l}},he=n(24661),de=n(34067),pe=n(56751),fe=n(75487),me=et().mark((function t(e,n){var r,i,s;return et().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=e.byteLength,n&&!(r<n)){t.next=5;break}return t.next=4,e;case 4:return t.abrupt("return");case 5:i=0;case 6:if(!(i<r)){t.next=13;break}return s=i+n,t.next=10,e.slice(i,s);case 10:i=s,t.next=6;break;case 13:case"end":return t.stop()}}),t)})),ge=function(){var t=he(et().mark((function t(e,n){var r,i,s,o,a,l;return et().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:r=!1,i=!1,t.prev=2,o=fe(ve(e));case 4:return t.next=6,de(o.next());case 6:if(!(r=!(a=t.sent).done)){t.next=12;break}return l=a.value,t.delegateYield(pe(fe(me(l,n)),de),"t0",9);case 9:r=!1,t.next=4;break;case 12:t.next=18;break;case 14:t.prev=14,t.t1=t.catch(2),i=!0,s=t.t1;case 18:if(t.prev=18,t.prev=19,!r||null==o.return){t.next=23;break}return t.next=23,de(o.return());case 23:if(t.prev=23,!i){t.next=26;break}throw s;case 26:return t.finish(23);case 27:return t.finish(18);case 28:case"end":return t.stop()}}),t,null,[[2,14,18,28],[19,,23,27]])})));return function(e,n){return t.apply(this,arguments)}}(),ve=function(){var t=he(et().mark((function t(e){var n,r,i,s;return et().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e[Symbol.asyncIterator]){t.next=3;break}return t.delegateYield(pe(fe(e),de),"t0",2);case 2:return t.abrupt("return");case 3:n=e.getReader(),t.prev=4;case 5:return t.next=7,de(n.read());case 7:if(r=t.sent,i=r.done,s=r.value,!i){t.next=12;break}return t.abrupt("break",16);case 12:return t.next=14,s;case 14:t.next=5;break;case 16:return t.prev=16,t.next=19,de(n.cancel());case 19:return t.finish(16);case 20:case"end":return t.stop()}}),t,null,[[4,,16,20]])})));return function(e){return t.apply(this,arguments)}}(),ye=function(t,e,n,r){var i,s=ge(t,e),o=0,a=function(t){i||(i=!0,r&&r(t))};return new ReadableStream({pull:function(t){return nt(et().mark((function e(){var r,i,l,u,c;return et().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,s.next();case 3:if(r=e.sent,i=r.done,l=r.value,!i){e.next=10;break}return a(),t.close(),e.abrupt("return");case 10:u=l.byteLength,n&&(c=o+=u,n(c)),t.enqueue(new Uint8Array(l)),e.next=19;break;case 15:throw e.prev=15,e.t0=e.catch(0),a(e.t0),e.t0;case 19:case"end":return e.stop()}}),e,null,[[0,15]])})))()},cancel:function(t){return a(t),s.return()}},{highWaterMark:2})},_e="function"==typeof fetch&&"function"==typeof Request&&"function"==typeof Response,xe=_e&&"function"==typeof ReadableStream,be=_e&&("function"==typeof TextEncoder?(oe=new TextEncoder,function(t){return oe.encode(t)}):function(){var t=nt(et().mark((function t(e){return et().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.t0=Uint8Array,t.next=3,new Response(e).arrayBuffer();case 3:return t.t1=t.sent,t.abrupt("return",new t.t0(t.t1));case 5:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),we=function(t){try{for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];return!!t.apply(void 0,n)}catch(t){return!1}},Se=xe&&we((function(){var t=!1,e=new Request(Nt.origin,{body:new ReadableStream,method:"POST",get duplex(){return t=!0,"half"}}).headers.has("Content-Type");return t&&!e})),Me=xe&&we((function(){return tt.isReadableStream(new Response("").body)})),Ee={stream:Me&&function(t){return t.body}};_e&&(ae=new Response,["text","arrayBuffer","blob","formData","stream"].forEach((function(t){!Ee[t]&&(Ee[t]=tt.isFunction(ae[t])?function(e){return e[t]()}:function(e,n){throw new lt("Response type '".concat(t,"' is not supported"),lt.ERR_NOT_SUPPORT,n)})})));var Te=function(){var t=nt(et().mark((function t(e){var n;return et().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(null!=e){t.next=2;break}return t.abrupt("return",0);case 2:if(!tt.isBlob(e)){t.next=4;break}return t.abrupt("return",e.size);case 4:if(!tt.isSpecCompliantForm(e)){t.next=9;break}return n=new Request(Nt.origin,{method:"POST",body:e}),t.next=8,n.arrayBuffer();case 8:case 15:return t.abrupt("return",t.sent.byteLength);case 9:if(!tt.isArrayBufferView(e)&&!tt.isArrayBuffer(e)){t.next=11;break}return t.abrupt("return",e.byteLength);case 11:if(tt.isURLSearchParams(e)&&(e+=""),!tt.isString(e)){t.next=16;break}return t.next=15,be(e);case 16:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),Ae=function(){var t=nt(et().mark((function t(e,n){var r;return et().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=tt.toFiniteNumber(e.getContentLength()),t.abrupt("return",null==r?Te(n):r);case 2:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}(),Ce=_e&&function(){var t=nt(et().mark((function t(e){var n,r,s,o,a,l,u,c,h,d,p,f,m,g,v,y,_,x,b,w,S,M,E,T,A,C,R,N,P,I,O,D,L,U;return et().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=le(e),r=n.url,s=n.method,o=n.data,a=n.signal,l=n.cancelToken,u=n.timeout,c=n.onDownloadProgress,h=n.onUploadProgress,d=n.responseType,p=n.headers,f=n.withCredentials,m=void 0===f?"same-origin":f,g=n.fetchOptions,d=d?(d+"").toLowerCase():"text",v=ce([a,l&&l.toAbortSignal()],u),_=v&&v.unsubscribe&&function(){v.unsubscribe()},t.prev=4,t.t0=h&&Se&&"get"!==s&&"head"!==s,!t.t0){t.next=11;break}return t.next=9,Ae(p,o);case 9:t.t1=x=t.sent,t.t0=0!==t.t1;case 11:if(!t.t0){t.next=15;break}b=new Request(r,{method:"POST",body:o,duplex:"half"}),tt.isFormData(o)&&(w=b.headers.get("content-type"))&&p.setContentType(w),b.body&&(S=Kt(x,Yt(Jt(h))),M=i(S,2),E=M[0],T=M[1],o=ye(b.body,65536,E,T));case 15:return tt.isString(m)||(m=m?"include":"omit"),A="credentials"in Request.prototype,y=new Request(r,St(St({},g),{},{signal:v,method:s.toUpperCase(),headers:p.normalize().toJSON(),body:o,duplex:"half",credentials:A?m:void 0})),t.next=20,fetch(y);case 20:return C=t.sent,R=Me&&("stream"===d||"response"===d),Me&&(c||R&&_)&&(N={},["status","statusText","headers"].forEach((function(t){N[t]=C[t]})),P=tt.toFiniteNumber(C.headers.get("content-length")),I=c&&Kt(P,Yt(Jt(c),!0))||[],O=i(I,2),D=O[0],L=O[1],C=new Response(ye(C.body,65536,D,(function(){L&&L(),_&&_()})),N)),d=d||"text",t.next=26,Ee[tt.findKey(Ee,d)||"text"](C,e);case 26:return U=t.sent,!R&&_&&_(),t.next=30,new Promise((function(t,n){qt(t,n,{data:U,headers:Vt.from(C.headers),status:C.status,statusText:C.statusText,config:e,request:y})}));case 30:return t.abrupt("return",t.sent);case 33:if(t.prev=33,t.t2=t.catch(4),_&&_(),!t.t2||"TypeError"!==t.t2.name||!/fetch/i.test(t.t2.message)){t.next=38;break}throw Object.assign(new lt("Network Error",lt.ERR_NETWORK,e,y),{cause:t.t2.cause||t.t2});case 38:throw lt.from(t.t2,t.t2&&t.t2.code,e,y);case 39:case"end":return t.stop()}}),t,null,[[4,33]])})));return function(e){return t.apply(this,arguments)}}(),Re={http:null,xhr:ue,fetch:Ce};tt.forEach(Re,(function(t,e){if(t){try{Object.defineProperty(t,"name",{value:e})}catch(t){}Object.defineProperty(t,"adapterName",{value:e})}}));var Ne=function(t){return"- ".concat(t)},Pe=function(t){return tt.isFunction(t)||null===t||!1===t},Ie=function(t){for(var e,n,r=(t=tt.isArray(t)?t:[t]).length,s={},o=0;o<r;o++){var a=void 0;if(n=e=t[o],!Pe(e)&&void 0===(n=Re[(a=String(e)).toLowerCase()]))throw new lt("Unknown adapter '".concat(a,"'"));if(n)break;s[a||"#"+o]=n}if(!n){var l=Object.entries(s).map((function(t){var e=i(t,2),n=e[0],r=e[1];return"adapter ".concat(n," ")+(!1===r?"is not supported by the environment":"is not available in the build")})),u=r?l.length>1?"since :\n"+l.map(Ne).join("\n"):" "+Ne(l[0]):"as no adapter specified";throw new lt("There is no suitable adapter to dispatch the request "+u,"ERR_NOT_SUPPORT")}return n};function Oe(t){if(t.cancelToken&&t.cancelToken.throwIfRequested(),t.signal&&t.signal.aborted)throw new Wt(null,t)}function De(t){return Oe(t),t.headers=Vt.from(t.headers),t.data=Gt.call(t,t.transformRequest),-1!==["post","put","patch"].indexOf(t.method)&&t.headers.setContentType("application/x-www-form-urlencoded",!1),Ie(t.adapter||Ot.adapter)(t).then((function(e){return Oe(t),e.data=Gt.call(t,t.transformResponse,e),e.headers=Vt.from(e.headers),e}),(function(e){return jt(e)||(Oe(t),e&&e.response&&(e.response.data=Gt.call(t,t.transformResponse,e.response),e.response.headers=Vt.from(e.response.headers))),Promise.reject(e)}))}var Le="1.7.7",Ue={};["object","boolean","number","function","string","symbol"].forEach((function(t,e){Ue[t]=function(n){return s(n)===t||"a"+(e<1?"n ":" ")+t}}));var ke={};Ue.transitional=function(t,e,n){function r(t,e){return"[Axios v1.7.7] Transitional option '"+t+"'"+e+(n?". "+n:"")}return function(n,i,s){if(!1===t)throw new lt(r(i," has been removed"+(e?" in "+e:"")),lt.ERR_DEPRECATED);return e&&!ke[i]&&(ke[i]=!0,console.warn(r(i," has been deprecated since v"+e+" and will be removed in the near future"))),!t||t(n,i,s)}};var Be={assertOptions:function(t,e,n){if("object"!==s(t))throw new lt("options must be an object",lt.ERR_BAD_OPTION_VALUE);for(var r=Object.keys(t),i=r.length;i-- >0;){var o=r[i],a=e[o];if(a){var l=t[o],u=void 0===l||a(l,o,t);if(!0!==u)throw new lt("option "+o+" must be "+u,lt.ERR_BAD_OPTION_VALUE)}else if(!0!==n)throw new lt("Unknown option "+o,lt.ERR_BAD_OPTION)}},validators:Ue},Fe=Be.validators,ze=function(){function t(e){rt(this,t),this.defaults=e,this.interceptors={request:new bt,response:new bt}}var e;return it(t,[{key:"request",value:(e=nt(et().mark((function t(e,n){var r,i;return et().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,this._request(e,n);case 3:return t.abrupt("return",t.sent);case 6:if(t.prev=6,t.t0=t.catch(0),t.t0 instanceof Error){Error.captureStackTrace?Error.captureStackTrace(r={}):r=new Error,i=r.stack?r.stack.replace(/^.+\n/,""):"";try{t.t0.stack?i&&!String(t.t0.stack).endsWith(i.replace(/^.+\n.+\n/,""))&&(t.t0.stack+="\n"+i):t.t0.stack=i}catch(t){}}throw t.t0;case 10:case"end":return t.stop()}}),t,this,[[0,6]])}))),function(t,n){return e.apply(this,arguments)})},{key:"_request",value:function(t,e){"string"==typeof t?(e=e||{}).url=t:e=t||{};var n=e=se(this.defaults,e),r=n.transitional,i=n.paramsSerializer,s=n.headers;void 0!==r&&Be.assertOptions(r,{silentJSONParsing:Fe.transitional(Fe.boolean),forcedJSONParsing:Fe.transitional(Fe.boolean),clarifyTimeoutError:Fe.transitional(Fe.boolean)},!1),null!=i&&(tt.isFunction(i)?e.paramsSerializer={serialize:i}:Be.assertOptions(i,{encode:Fe.function,serialize:Fe.function},!0)),e.method=(e.method||this.defaults.method||"get").toLowerCase();var o=s&&tt.merge(s.common,s[e.method]);s&&tt.forEach(["delete","get","head","post","put","patch","common"],(function(t){delete s[t]})),e.headers=Vt.concat(o,s);var a=[],l=!0;this.interceptors.request.forEach((function(t){"function"==typeof t.runWhen&&!1===t.runWhen(e)||(l=l&&t.synchronous,a.unshift(t.fulfilled,t.rejected))}));var u,c=[];this.interceptors.response.forEach((function(t){c.push(t.fulfilled,t.rejected)}));var h,d=0;if(!l){var p=[De.bind(this),void 0];for(p.unshift.apply(p,a),p.push.apply(p,c),h=p.length,u=Promise.resolve(e);d<h;)u=u.then(p[d++],p[d++]);return u}h=a.length;var f=e;for(d=0;d<h;){var m=a[d++],g=a[d++];try{f=m(f)}catch(t){g.call(this,t);break}}try{u=De.call(this,f)}catch(t){return Promise.reject(t)}for(d=0,h=c.length;d<h;)u=u.then(c[d++],c[d++]);return u}},{key:"getUri",value:function(t){return xt(re((t=se(this.defaults,t)).baseURL,t.url),t.params,t.paramsSerializer)}}]),t}();tt.forEach(["delete","get","head","options"],(function(t){ze.prototype[t]=function(e,n){return this.request(se(n||{},{method:t,url:e,data:(n||{}).data}))}})),tt.forEach(["post","put","patch"],(function(t){function e(e){return function(n,r,i){return this.request(se(i||{},{method:t,headers:e?{"Content-Type":"multipart/form-data"}:{},url:n,data:r}))}}ze.prototype[t]=e(),ze.prototype[t+"Form"]=e(!0)}));var Ve=ze,Ge=function(){function t(e){if(rt(this,t),"function"!=typeof e)throw new TypeError("executor must be a function.");var n;this.promise=new Promise((function(t){n=t}));var r=this;this.promise.then((function(t){if(r._listeners){for(var e=r._listeners.length;e-- >0;)r._listeners[e](t);r._listeners=null}})),this.promise.then=function(t){var e,n=new Promise((function(t){r.subscribe(t),e=t})).then(t);return n.cancel=function(){r.unsubscribe(e)},n},e((function(t,e,i){r.reason||(r.reason=new Wt(t,e,i),n(r.reason))}))}return it(t,[{key:"throwIfRequested",value:function(){if(this.reason)throw this.reason}},{key:"subscribe",value:function(t){this.reason?t(this.reason):this._listeners?this._listeners.push(t):this._listeners=[t]}},{key:"unsubscribe",value:function(t){if(this._listeners){var e=this._listeners.indexOf(t);-1!==e&&this._listeners.splice(e,1)}}},{key:"toAbortSignal",value:function(){var t=this,e=new AbortController,n=function(t){e.abort(t)};return this.subscribe(n),e.signal.unsubscribe=function(){return t.unsubscribe(n)},e.signal}}],[{key:"source",value:function(){var e;return{token:new t((function(t){e=t})),cancel:e}}}]),t}(),je=Ge;var He={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(He).forEach((function(t){var e=i(t,2),n=e[0],r=e[1];He[r]=n}));var We=He;var qe=function t(e){var n=new Ve(e),r=o(Ve.prototype.request,n);return tt.extend(r,Ve.prototype,n,{allOwnKeys:!0}),tt.extend(r,n,null,{allOwnKeys:!0}),r.create=function(n){return t(se(e,n))},r}(Ot);qe.Axios=Ve,qe.CanceledError=Wt,qe.CancelToken=je,qe.isCancel=jt,qe.VERSION=Le,qe.toFormData=ft,qe.AxiosError=lt,qe.Cancel=qe.CanceledError,qe.all=function(t){return Promise.all(t)},qe.spread=function(t){return function(e){return t.apply(null,e)}},qe.isAxiosError=function(t){return tt.isObject(t)&&!0===t.isAxiosError},qe.mergeConfig=se,qe.AxiosHeaders=Vt,qe.formToJSON=function(t){return Pt(tt.isHTMLForm(t)?new FormData(t):t)},qe.getAdapter=Ie,qe.HttpStatusCode=We,qe.default=qe;var Xe=qe},88681:function(t,e,n){"use strict";n.d(e,{B8:function(){return M},Il:function(){return i},J5:function(){return o},SU:function(){return S},Ss:function(){return E},ZP:function(){return x},xV:function(){return s}});var r=n(90368);function i(){}var s=.7,o=1/s,a="\\s*([+-]?\\d+)\\s*",l="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",u="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",c=/^#([0-9a-f]{3,8})$/,h=new RegExp("^rgb\\(".concat(a,",").concat(a,",").concat(a,"\\)$")),d=new RegExp("^rgb\\(".concat(u,",").concat(u,",").concat(u,"\\)$")),p=new RegExp("^rgba\\(".concat(a,",").concat(a,",").concat(a,",").concat(l,"\\)$")),f=new RegExp("^rgba\\(".concat(u,",").concat(u,",").concat(u,",").concat(l,"\\)$")),m=new RegExp("^hsl\\(".concat(l,",").concat(u,",").concat(u,"\\)$")),g=new RegExp("^hsla\\(".concat(l,",").concat(u,",").concat(u,",").concat(l,"\\)$")),v={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function y(){return this.rgb().formatHex()}function _(){return this.rgb().formatRgb()}function x(t){var e,n;return t=(t+"").trim().toLowerCase(),(e=c.exec(t))?(n=e[1].length,e=parseInt(e[1],16),6===n?b(e):3===n?new E(e>>8&15|e>>4&240,e>>4&15|240&e,(15&e)<<4|15&e,1):8===n?w(e>>24&255,e>>16&255,e>>8&255,(255&e)/255):4===n?w(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|240&e,((15&e)<<4|15&e)/255):null):(e=h.exec(t))?new E(e[1],e[2],e[3],1):(e=d.exec(t))?new E(255*e[1]/100,255*e[2]/100,255*e[3]/100,1):(e=p.exec(t))?w(e[1],e[2],e[3],e[4]):(e=f.exec(t))?w(255*e[1]/100,255*e[2]/100,255*e[3]/100,e[4]):(e=m.exec(t))?P(e[1],e[2]/100,e[3]/100,1):(e=g.exec(t))?P(e[1],e[2]/100,e[3]/100,e[4]):v.hasOwnProperty(t)?b(v[t]):"transparent"===t?new E(NaN,NaN,NaN,0):null}function b(t){return new E(t>>16&255,t>>8&255,255&t,1)}function w(t,e,n,r){return r<=0&&(t=e=n=NaN),new E(t,e,n,r)}function S(t){return t instanceof i||(t=x(t)),t?new E((t=t.rgb()).r,t.g,t.b,t.opacity):new E}function M(t,e,n,r){return 1===arguments.length?S(t):new E(t,e,n,null==r?1:r)}function E(t,e,n,r){this.r=+t,this.g=+e,this.b=+n,this.opacity=+r}function T(){return"#".concat(N(this.r)).concat(N(this.g)).concat(N(this.b))}function A(){var t=C(this.opacity);return"".concat(1===t?"rgb(":"rgba(").concat(R(this.r),", ").concat(R(this.g),", ").concat(R(this.b)).concat(1===t?")":", ".concat(t,")"))}function C(t){return isNaN(t)?1:Math.max(0,Math.min(1,t))}function R(t){return Math.max(0,Math.min(255,Math.round(t)||0))}function N(t){return((t=R(t))<16?"0":"")+t.toString(16)}function P(t,e,n,r){return r<=0?t=e=n=NaN:n<=0||n>=1?t=e=NaN:e<=0&&(t=NaN),new O(t,e,n,r)}function I(t){if(t instanceof O)return new O(t.h,t.s,t.l,t.opacity);if(t instanceof i||(t=x(t)),!t)return new O;if(t instanceof O)return t;var e=(t=t.rgb()).r/255,n=t.g/255,r=t.b/255,s=Math.min(e,n,r),o=Math.max(e,n,r),a=NaN,l=o-s,u=(o+s)/2;return l?(a=e===o?(n-r)/l+6*(n<r):n===o?(r-e)/l+2:(e-n)/l+4,l/=u<.5?o+s:2-o-s,a*=60):l=u>0&&u<1?0:a,new O(a,l,u,t.opacity)}function O(t,e,n,r){this.h=+t,this.s=+e,this.l=+n,this.opacity=+r}function D(t){return(t=(t||0)%360)<0?t+360:t}function L(t){return Math.max(0,Math.min(1,t||0))}function U(t,e,n){return 255*(t<60?e+(n-e)*t/60:t<180?n:t<240?e+(n-e)*(240-t)/60:e)}(0,r.Z)(i,x,{copy:function(t){return Object.assign(new this.constructor,this,t)},displayable:function(){return this.rgb().displayable()},hex:y,formatHex:y,formatHex8:function(){return this.rgb().formatHex8()},formatHsl:function(){return I(this).formatHsl()},formatRgb:_,toString:_}),(0,r.Z)(E,M,(0,r.l)(i,{brighter:function(t){return t=null==t?o:Math.pow(o,t),new E(this.r*t,this.g*t,this.b*t,this.opacity)},darker:function(t){return t=null==t?s:Math.pow(s,t),new E(this.r*t,this.g*t,this.b*t,this.opacity)},rgb:function(){return this},clamp:function(){return new E(R(this.r),R(this.g),R(this.b),C(this.opacity))},displayable:function(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:T,formatHex:T,formatHex8:function(){return"#".concat(N(this.r)).concat(N(this.g)).concat(N(this.b)).concat(N(255*(isNaN(this.opacity)?1:this.opacity)))},formatRgb:A,toString:A})),(0,r.Z)(O,(function(t,e,n,r){return 1===arguments.length?I(t):new O(t,e,n,null==r?1:r)}),(0,r.l)(i,{brighter:function(t){return t=null==t?o:Math.pow(o,t),new O(this.h,this.s,this.l*t,this.opacity)},darker:function(t){return t=null==t?s:Math.pow(s,t),new O(this.h,this.s,this.l*t,this.opacity)},rgb:function(){var t=this.h%360+360*(this.h<0),e=isNaN(t)||isNaN(this.s)?0:this.s,n=this.l,r=n+(n<.5?n:1-n)*e,i=2*n-r;return new E(U(t>=240?t-240:t+120,i,r),U(t,i,r),U(t<120?t+240:t-120,i,r),this.opacity)},clamp:function(){return new O(D(this.h),L(this.s),L(this.l),C(this.opacity))},displayable:function(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl:function(){var t=C(this.opacity);return"".concat(1===t?"hsl(":"hsla(").concat(D(this.h),", ").concat(100*L(this.s),"%, ").concat(100*L(this.l),"%").concat(1===t?")":", ".concat(t,")"))}}))},90368:function(t,e,n){"use strict";function r(t,e,n){t.prototype=e.prototype=n,n.constructor=t}function i(t,e){var n=Object.create(t.prototype);for(var r in e)n[r]=e[r];return n}n.d(e,{Z:function(){return r},l:function(){return i}})},32436:function(t,e){"use strict";var n={value:function(){}};function r(){for(var t,e=0,n=arguments.length,r={};e<n;++e){if(!(t=arguments[e]+"")||t in r||/[\s.]/.test(t))throw new Error("illegal type: "+t);r[t]=[]}return new i(r)}function i(t){this._=t}function s(t,e){return t.trim().split(/^|\s+/).map((function(t){var n="",r=t.indexOf(".");if(r>=0&&(n=t.slice(r+1),t=t.slice(0,r)),t&&!e.hasOwnProperty(t))throw new Error("unknown type: "+t);return{type:t,name:n}}))}function o(t,e){for(var n,r=0,i=t.length;r<i;++r)if((n=t[r]).name===e)return n.value}function a(t,e,r){for(var i=0,s=t.length;i<s;++i)if(t[i].name===e){t[i]=n,t=t.slice(0,i).concat(t.slice(i+1));break}return null!=r&&t.push({name:e,value:r}),t}i.prototype=r.prototype={constructor:i,on:function(t,e){var n,r=this._,i=s(t+"",r),l=-1,u=i.length;if(!(arguments.length<2)){if(null!=e&&"function"!=typeof e)throw new Error("invalid callback: "+e);for(;++l<u;)if(n=(t=i[l]).type)r[n]=a(r[n],t.name,e);else if(null==e)for(n in r)r[n]=a(r[n],t.name,null);return this}for(;++l<u;)if((n=(t=i[l]).type)&&(n=o(r[n],t.name)))return n},copy:function(){var t={},e=this._;for(var n in e)t[n]=e[n].slice();return new i(t)},call:function(t,e){if((n=arguments.length-2)>0)for(var n,r,i=new Array(n),s=0;s<n;++s)i[s]=arguments[s+2];if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(s=0,n=(r=this._[t]).length;s<n;++s)r[s].value.apply(e,i)},apply:function(t,e,n){if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(var r=this._[t],i=0,s=r.length;i<s;++i)r[i].value.apply(e,n)}},e.Z=r},46015:function(t,e,n){"use strict";function r(t){return null==t?null:i(t)}function i(t){if("function"!=typeof t)throw new Error;return t}n.d(e,{C:function(){return i},j:function(){return r}})},89329:function(t,e,n){"use strict";function r(){return 0}function i(t){return function(){return t}}n.d(e,{G:function(){return r},Z:function(){return i}})},4081:function(t,e,n){"use strict";n.d(e,{NB:function(){return f},le:function(){return p},ZP:function(){return u}});var r=n(82092);function i(t){var e=0,n=t.children,r=n&&n.length;if(r)for(;--r>=0;)e+=n[r].value;else e=1;t.value=e}var s=n(335);var o=n(90228),a=o().mark(l);function l(){var t,e,n,r,i,s;return o().wrap((function(o){for(;;)switch(o.prev=o.next){case 0:n=[t=this];case 1:e=n.reverse(),n=[];case 2:if(!(t=e.pop())){o.next=8;break}return o.next=5,t;case 5:if(r=t.children)for(i=0,s=r.length;i<s;++i)n.push(r[i]);o.next=2;break;case 8:if(n.length){o.next=1;break}case 9:case"end":return o.stop()}}),a,this)}function u(t,e){t instanceof Map?(t=[void 0,t],void 0===e&&(e=h)):void 0===e&&(e=c);for(var n,r,i,s,o,a=new f(t),l=[a];n=l.pop();)if((i=e(n.data))&&(o=(i=Array.from(i)).length))for(n.children=i,s=o-1;s>=0;--s)l.push(r=i[s]=new f(i[s])),r.parent=n,r.depth=n.depth+1;return a.eachBefore(p)}function c(t){return t.children}function h(t){return Array.isArray(t)?t[1]:null}function d(t){void 0!==t.data.value&&(t.value=t.data.value),t.data=t.data.data}function p(t){var e=0;do{t.height=e}while((t=t.parent)&&t.height<++e)}function f(t){this.data=t,this.depth=this.height=0,this.parent=null}f.prototype=u.prototype=r({constructor:f,count:function(){return this.eachAfter(i)},each:function(t,e){var n,r=-1,i=s(this);try{for(i.s();!(n=i.n()).done;){var o=n.value;t.call(e,o,++r,this)}}catch(t){i.e(t)}finally{i.f()}return this},eachAfter:function(t,e){for(var n,r,i,s=this,o=[s],a=[],l=-1;s=o.pop();)if(a.push(s),n=s.children)for(r=0,i=n.length;r<i;++r)o.push(n[r]);for(;s=a.pop();)t.call(e,s,++l,this);return this},eachBefore:function(t,e){for(var n,r,i=this,s=[i],o=-1;i=s.pop();)if(t.call(e,i,++o,this),n=i.children)for(r=n.length-1;r>=0;--r)s.push(n[r]);return this},find:function(t,e){var n,r=-1,i=s(this);try{for(i.s();!(n=i.n()).done;){var o=n.value;if(t.call(e,o,++r,this))return o}}catch(t){i.e(t)}finally{i.f()}},sum:function(t){return this.eachAfter((function(e){for(var n=+t(e.data)||0,r=e.children,i=r&&r.length;--i>=0;)n+=r[i].value;e.value=n}))},sort:function(t){return this.eachBefore((function(e){e.children&&e.children.sort(t)}))},path:function(t){for(var e=this,n=function(t,e){if(t===e)return t;var n=t.ancestors(),r=e.ancestors(),i=null;t=n.pop(),e=r.pop();for(;t===e;)i=t,t=n.pop(),e=r.pop();return i}(e,t),r=[e];e!==n;)e=e.parent,r.push(e);for(var i=r.length;t!==n;)r.splice(i,0,t),t=t.parent;return r},ancestors:function(){for(var t=this,e=[t];t=t.parent;)e.push(t);return e},descendants:function(){return Array.from(this)},leaves:function(){var t=[];return this.eachBefore((function(e){e.children||t.push(e)})),t},links:function(){var t=this,e=[];return t.each((function(n){n!==t&&e.push({source:n.parent,target:n})})),e},copy:function(){return u(this).eachBefore(d)}},Symbol.iterator,l)},62432:function(t,e,n){"use strict";n.d(e,{Z:function(){return b}});var r=n(46015),i=n(89329),s=4294967296;var o=n(31759);function a(t,e){for(var n,r,i=0,s=(t=function(t,e){for(var n,r,i=t.length;i;)r=e()*i--|0,n=t[i],t[i]=t[r],t[r]=n;return t}(Array.from(t),e)).length,o=[];i<s;)n=t[i],r&&c(r,n)?++i:(r=d(o=l(o,n)),i=0);return r}function l(t,e){var n,r;if(h(e,t))return[e];for(n=0;n<t.length;++n)if(u(e,t[n])&&h(p(t[n],e),t))return[t[n],e];for(n=0;n<t.length-1;++n)for(r=n+1;r<t.length;++r)if(u(p(t[n],t[r]),e)&&u(p(t[n],e),t[r])&&u(p(t[r],e),t[n])&&h(f(t[n],t[r],e),t))return[t[n],t[r],e];throw new Error}function u(t,e){var n=t.r-e.r,r=e.x-t.x,i=e.y-t.y;return n<0||n*n<r*r+i*i}function c(t,e){var n=t.r-e.r+1e-9*Math.max(t.r,e.r,1),r=e.x-t.x,i=e.y-t.y;return n>0&&n*n>r*r+i*i}function h(t,e){for(var n=0;n<e.length;++n)if(!c(t,e[n]))return!1;return!0}function d(t){switch(t.length){case 1:return function(t){return{x:t.x,y:t.y,r:t.r}}(t[0]);case 2:return p(t[0],t[1]);case 3:return f(t[0],t[1],t[2])}}function p(t,e){var n=t.x,r=t.y,i=t.r,s=e.x,o=e.y,a=e.r,l=s-n,u=o-r,c=a-i,h=Math.sqrt(l*l+u*u);return{x:(n+s+l/h*c)/2,y:(r+o+u/h*c)/2,r:(h+i+a)/2}}function f(t,e,n){var r=t.x,i=t.y,s=t.r,o=e.x,a=e.y,l=e.r,u=n.x,c=n.y,h=n.r,d=r-o,p=r-u,f=i-a,m=i-c,g=l-s,v=h-s,y=r*r+i*i-s*s,_=y-o*o-a*a+l*l,x=y-u*u-c*c+h*h,b=p*f-d*m,w=(f*x-m*_)/(2*b)-r,S=(m*g-f*v)/b,M=(p*_-d*x)/(2*b)-i,E=(d*v-p*g)/b,T=S*S+E*E-1,A=2*(s+w*S+M*E),C=w*w+M*M-s*s,R=-(Math.abs(T)>1e-6?(A+Math.sqrt(A*A-4*T*C))/(2*T):C/A);return{x:r+w+S*R,y:i+M+E*R,r:R}}function m(t,e,n){var r,i,s,o,a=t.x-e.x,l=t.y-e.y,u=a*a+l*l;u?(i=e.r+n.r,i*=i,o=t.r+n.r,i>(o*=o)?(r=(u+o-i)/(2*u),s=Math.sqrt(Math.max(0,o/u-r*r)),n.x=t.x-r*a-s*l,n.y=t.y-r*l+s*a):(r=(u+i-o)/(2*u),s=Math.sqrt(Math.max(0,i/u-r*r)),n.x=e.x+r*a-s*l,n.y=e.y+r*l+s*a)):(n.x=e.x+n.r,n.y=e.y)}function g(t,e){var n=t.r+e.r-1e-6,r=e.x-t.x,i=e.y-t.y;return n>0&&n*n>r*r+i*i}function v(t){var e=t._,n=t.next._,r=e.r+n.r,i=(e.x*n.r+n.x*e.r)/r,s=(e.y*n.r+n.y*e.r)/r;return i*i+s*s}function y(t){this._=t,this.next=null,this.previous=null}function _(t,e){if(!(l=(n=t,t="object"===o(n)&&"length"in n?n:Array.from(n)).length))return 0;var n,r,i,s,l,u,c,h,d,p,f,_;if((r=t[0]).x=0,r.y=0,!(l>1))return r.r;if(i=t[1],r.x=-i.r,i.x=r.r,i.y=0,!(l>2))return r.r+i.r;m(i,r,s=t[2]),r=new y(r),i=new y(i),s=new y(s),r.next=s.previous=i,i.next=r.previous=s,s.next=i.previous=r;t:for(h=3;h<l;++h){m(r._,i._,s=t[h]),s=new y(s),d=i.next,p=r.previous,f=i._.r,_=r._.r;do{if(f<=_){if(g(d._,s._)){i=d,r.next=i,i.previous=r,--h;continue t}f+=d._.r,d=d.next}else{if(g(p._,s._)){(r=p).next=i,i.previous=r,--h;continue t}_+=p._.r,p=p.previous}}while(d!==p.next);for(s.previous=r,s.next=i,r.next=i.previous=i=s,u=v(r);(s=s.next)!==i;)(c=v(s))<u&&(r=s,u=c);i=r.next}for(r=[i._],s=i;(s=s.next)!==i;)r.push(s._);for(s=a(r,e),h=0;h<l;++h)(r=t[h]).x-=s.x,r.y-=s.y;return s.r}function x(t){return Math.sqrt(t.value)}function b(){var t=null,e=1,n=1,o=i.G;function a(r){var a,l=(a=1,function(){return(a=(1664525*a+1013904223)%s)/s});return r.x=e/2,r.y=n/2,t?r.eachBefore(w(t)).eachAfter(S(o,.5,l)).eachBefore(M(1)):r.eachBefore(w(x)).eachAfter(S(i.G,1,l)).eachAfter(S(o,r.r/Math.min(e,n),l)).eachBefore(M(Math.min(e,n)/(2*r.r))),r}return a.radius=function(e){return arguments.length?(t=(0,r.j)(e),a):t},a.size=function(t){return arguments.length?(e=+t[0],n=+t[1],a):[e,n]},a.padding=function(t){return arguments.length?(o="function"==typeof t?t:(0,i.Z)(+t),a):o},a}function w(t){return function(e){e.children||(e.r=Math.max(0,+t(e)||0))}}function S(t,e,n){return function(r){if(i=r.children){var i,s,o,a=i.length,l=t(r)*e||0;if(l)for(s=0;s<a;++s)i[s].r+=l;if(o=_(i,n),l)for(s=0;s<a;++s)i[s].r-=l;r.r=o+l}}}function M(t){return function(e){var n=e.parent;e.r*=t,n&&(e.x=n.x+t*e.x,e.y=n.y+t*e.y)}}},42558:function(t,e,n){"use strict";n.d(e,{ZP:function(){return a},wx:function(){return s},yi:function(){return o}});var r=n(41042);function i(t,e){return function(n){return t+n*e}}function s(t,e){var n=e-t;return n?i(t,n>180||n<-180?n-360*Math.round(n/360):n):(0,r.Z)(isNaN(t)?e:t)}function o(t){return 1==(t=+t)?a:function(e,n){return n-e?function(t,e,n){return t=Math.pow(t,n),e=Math.pow(e,n)-t,n=1/n,function(r){return Math.pow(t+r*e,n)}}(e,n,t):(0,r.Z)(isNaN(e)?n:e)}}function a(t,e){var n=e-t;return n?i(t,n):(0,r.Z)(isNaN(t)?e:t)}},41042:function(t,e){"use strict";e.Z=function(t){return function(){return t}}},88486:function(t,e,n){"use strict";function r(t,e){return t=+t,e=+e,function(n){return t*(1-n)+e*n}}n.d(e,{Z:function(){return r}})},45106:function(t,e,n){"use strict";n.d(e,{ZP:function(){return o},hD:function(){return l}});var r=n(88681);function i(t,e,n,r,i){var s=t*t,o=s*t;return((1-3*t+3*s-o)*e+(4-6*s+3*o)*n+(1+3*t+3*s-3*o)*r+o*i)/6}var s=n(42558),o=function t(e){var n=(0,s.yi)(e);function i(t,e){var i=n((t=(0,r.B8)(t)).r,(e=(0,r.B8)(e)).r),o=n(t.g,e.g),a=n(t.b,e.b),l=(0,s.ZP)(t.opacity,e.opacity);return function(e){return t.r=i(e),t.g=o(e),t.b=a(e),t.opacity=l(e),t+""}}return i.gamma=t,i}(1);function a(t){return function(e){var n,i,s=e.length,o=new Array(s),a=new Array(s),l=new Array(s);for(n=0;n<s;++n)i=(0,r.B8)(e[n]),o[n]=i.r||0,a[n]=i.g||0,l[n]=i.b||0;return o=t(o),a=t(a),l=t(l),i.opacity=1,function(t){return i.r=o(t),i.g=a(t),i.b=l(t),i+""}}}var l=a((function(t){var e=t.length-1;return function(n){var r=n<=0?n=0:n>=1?(n=1,e-1):Math.floor(n*e),s=t[r],o=t[r+1],a=r>0?t[r-1]:2*s-o,l=r<e-1?t[r+2]:2*o-s;return i((n-r/e)*e,a,s,o,l)}}));a((function(t){var e=t.length;return function(n){var r=Math.floor(((n%=1)<0?++n:n)*e),s=t[(r+e-1)%e],o=t[r%e],a=t[(r+1)%e],l=t[(r+2)%e];return i((n-r/e)*e,s,o,a,l)}}))},28685:function(t,e,n){"use strict";n.d(e,{Z:function(){return o}});var r=n(88486),i=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,s=new RegExp(i.source,"g");function o(t,e){var n,o,a,l=i.lastIndex=s.lastIndex=0,u=-1,c=[],h=[];for(t+="",e+="";(n=i.exec(t))&&(o=s.exec(e));)(a=o.index)>l&&(a=e.slice(l,a),c[u]?c[u]+=a:c[++u]=a),(n=n[0])===(o=o[0])?c[u]?c[u]+=o:c[++u]=o:(c[++u]=null,h.push({i:u,x:(0,r.Z)(n,o)})),l=s.lastIndex;return l<e.length&&(a=e.slice(l),c[u]?c[u]+=a:c[++u]=a),c.length<2?h[0]?function(t){return function(e){return t(e)+""}}(h[0].x):function(t){return function(){return t}}(e):(e=h.length,function(t){for(var n,r=0;r<e;++r)c[(n=h[r]).i]=n.x(t);return c.join("")})}},54400:function(t,e,n){"use strict";n.d(e,{Z:function(){return p}});var r=n(31759),i=n(88681),s=n(45106);function o(t,e){var n,r=e?e.length:0,i=t?Math.min(r,t.length):0,s=new Array(i),o=new Array(r);for(n=0;n<i;++n)s[n]=p(t[n],e[n]);for(;n<r;++n)o[n]=e[n];return function(t){for(n=0;n<i;++n)o[n]=s[n](t);return o}}function a(t,e){var n=new Date;return t=+t,e=+e,function(r){return n.setTime(t*(1-r)+e*r),n}}var l=n(88486);function u(t,e){var n,i={},s={};for(n in null!==t&&"object"===r(t)||(t={}),null!==e&&"object"===r(e)||(e={}),e)n in t?i[n]=p(t[n],e[n]):s[n]=e[n];return function(t){for(n in i)s[n]=i[n](t);return s}}var c=n(28685),h=n(41042);function d(t,e){e||(e=[]);var n,r=t?Math.min(e.length,t.length):0,i=e.slice();return function(s){for(n=0;n<r;++n)i[n]=t[n]*(1-s)+e[n]*s;return i}}function p(t,e){var n,p,f=r(e);return null==e||"boolean"===f?(0,h.Z)(e):("number"===f?l.Z:"string"===f?(n=(0,i.ZP)(e))?(e=n,s.ZP):c.Z:e instanceof i.ZP?s.ZP:e instanceof Date?a:(p=e,!ArrayBuffer.isView(p)||p instanceof DataView?Array.isArray(e)?o:"function"!=typeof e.valueOf&&"function"!=typeof e.toString||isNaN(e)?u:l.Z:d))(t,e)}},66819:function(t,e,n){"use strict";n.d(e,{Z:function(){return r}});var r=function(t){return"function"==typeof t?t:"string"==typeof t?function(e){return e[t]}:function(e){return t}}},28680:function(t,e,n){"use strict";function r(t){if("string"==typeof t||"number"==typeof t)return""+t;let e="";if(Array.isArray(t))for(let n,i=0;i<t.length;i++)""!==(n=r(t[i]))&&(e+=(e&&" ")+n);else for(let n in t)t[n]&&(e+=(e&&" ")+n);return e}n.d(e,{Z:function(){return r}})},64784:function(t,e,n){"use strict";function r(t,e){return null==t||null==e?NaN:t<e?-1:t>e?1:t>=e?0:NaN}n.d(e,{Z:function(){return r}})},44080:function(t,e,n){"use strict";n.d(e,{Nw:function(){return l},ZR:function(){return u}});var r=n(64784),i=n(40139),s=n(51578);const o=(0,i.Z)(r.Z),a=o.right,l=o.left,u=(0,i.Z)(s.Z).center;e.ZP=a},40139:function(t,e,n){"use strict";n.d(e,{Z:function(){return s}});var r=n(64784);function i(t,e){return null==t||null==e?NaN:e<t?-1:e>t?1:e>=t?0:NaN}function s(t){let e,n,s;function a(t,r,i=0,s=t.length){if(i<s){if(0!==e(r,r))return s;do{const e=i+s>>>1;n(t[e],r)<0?i=e+1:s=e}while(i<s)}return i}return 2!==t.length?(e=r.Z,n=(e,n)=>(0,r.Z)(t(e),n),s=(e,n)=>t(e)-n):(e=t===r.Z||t===i?t:o,n=t,s=t),{left:a,center:function(t,e,n=0,r=t.length){const i=a(t,e,n,r-1);return i>n&&s(t[i-1],e)>-s(t[i],e)?i-1:i},right:function(t,r,i=0,s=t.length){if(i<s){if(0!==e(r,r))return s;do{const e=i+s>>>1;n(t[e],r)<=0?i=e+1:s=e}while(i<s)}return i}}}function o(){return 0}},86925:function(t,e,n){"use strict";function r(t,e){let n;if(void 0===e)for(const e of t)null!=e&&(n<e||void 0===n&&e>=e)&&(n=e);else{let r=-1;for(let i of t)null!=(i=e(i,++r,t))&&(n<i||void 0===n&&i>=i)&&(n=i)}return n}n.d(e,{Z:function(){return r}})},49085:function(t,e,n){"use strict";function r(t,e){let n;if(void 0===e)for(const e of t)null!=e&&(n>e||void 0===n&&e>=e)&&(n=e);else{let r=-1;for(let i of t)null!=(i=e(i,++r,t))&&(n>i||void 0===n&&i>=i)&&(n=i)}return n}n.d(e,{Z:function(){return r}})},51578:function(t,e,n){"use strict";function r(t){return null===t?NaN:+t}function*i(t,e){if(void 0===e)for(let e of t)null!=e&&(e=+e)>=e&&(yield e);else{let n=-1;for(let r of t)null!=(r=e(r,++n,t))&&(r=+r)>=r&&(yield r)}}n.d(e,{K:function(){return i},Z:function(){return r}})},77252:function(t,e,n){"use strict";n.d(e,{G9:function(){return l},ZP:function(){return a},ly:function(){return u}});const r=Math.sqrt(50),i=Math.sqrt(10),s=Math.sqrt(2);function o(t,e,n){const a=(e-t)/Math.max(0,n),l=Math.floor(Math.log10(a)),u=a/Math.pow(10,l),c=u>=r?10:u>=i?5:u>=s?2:1;let h,d,p;return l<0?(p=Math.pow(10,-l)/c,h=Math.round(t*p),d=Math.round(e*p),h/p<t&&++h,d/p>e&&--d,p=-p):(p=Math.pow(10,l)*c,h=Math.round(t/p),d=Math.round(e/p),h*p<t&&++h,d*p>e&&--d),d<h&&.5<=n&&n<2?o(t,e,2*n):[h,d,p]}function a(t,e,n){if(!((n=+n)>0))return[];if((t=+t)===(e=+e))return[t];const r=e<t,[i,s,a]=r?o(e,t,n):o(t,e,n);if(!(s>=i))return[];const l=s-i+1,u=new Array(l);if(r)if(a<0)for(let t=0;t<l;++t)u[t]=(s-t)/-a;else for(let t=0;t<l;++t)u[t]=(s-t)*a;else if(a<0)for(let t=0;t<l;++t)u[t]=(i+t)/-a;else for(let t=0;t<l;++t)u[t]=(i+t)*a;return u}function l(t,e,n){return o(t=+t,e=+e,n=+n)[2]}function u(t,e,n){n=+n;const r=(e=+e)<(t=+t),i=r?l(e,t,n):l(t,e,n);return(r?-1:1)*(i<0?1/-i:i)}},19753:function(t,e,n){"use strict";function r(t,e,n){if(isNaN(e))return t;var r,i,s,o,a,l,u=t._root,c={data:n},h=t._x0,d=t._x1;if(!u)return t._root=c,t;for(;u.length;)if((o=e>=(i=(h+d)/2))?h=i:d=i,r=u,!(u=u[a=+o]))return r[a]=c,t;if(e===(s=+t._x.call(null,u.data)))return c.next=u,r?r[a]=c:t._root=c,t;do{r=r?r[a]=new Array(2):t._root=new Array(2),(o=e>=(i=(h+d)/2))?h=i:d=i}while((a=+o)==(l=+(s>=i)));return r[l]=u,r[a]=c,t}function i(t,e,n){this.node=t,this.x0=e,this.x1=n}function s(t){return t[0]}function o(t,e){var n=new a(null==e?s:e,NaN,NaN);return null==t?n:n.addAll(t)}function a(t,e,n){this._x=t,this._x0=e,this._x1=n,this._root=void 0}function l(t){for(var e={data:t.data},n=e;t=t.next;)n=n.next={data:t.data};return e}n.d(e,{Z:function(){return o}});var u=o.prototype=a.prototype;u.copy=function(){var t,e,n=new a(this._x,this._x0,this._x1),r=this._root;if(!r)return n;if(!r.length)return n._root=l(r),n;for(t=[{source:r,target:n._root=new Array(2)}];r=t.pop();)for(var i=0;i<2;++i)(e=r.source[i])&&(e.length?t.push({source:e,target:r.target[i]=new Array(2)}):r.target[i]=l(e));return n},u.add=function(t){const e=+this._x.call(null,t);return r(this.cover(e),e,t)},u.addAll=function(t){Array.isArray(t)||(t=Array.from(t));const e=t.length,n=new Float64Array(e);let i=1/0,s=-1/0;for(let r,o=0;o<e;++o)isNaN(r=+this._x.call(null,t[o]))||(n[o]=r,r<i&&(i=r),r>s&&(s=r));if(i>s)return this;this.cover(i).cover(s);for(let i=0;i<e;++i)r(this,n[i],t[i]);return this},u.cover=function(t){if(isNaN(t=+t))return this;var e=this._x0,n=this._x1;if(isNaN(e))n=(e=Math.floor(t))+1;else{for(var r,i,s=n-e||1,o=this._root;e>t||t>=n;)switch(i=+(t<e),(r=new Array(2))[i]=o,o=r,s*=2,i){case 0:n=e+s;break;case 1:e=n-s}this._root&&this._root.length&&(this._root=o)}return this._x0=e,this._x1=n,this},u.data=function(){var t=[];return this.visit((function(e){if(!e.length)do{t.push(e.data)}while(e=e.next)})),t},u.extent=function(t){return arguments.length?this.cover(+t[0][0]).cover(+t[1][0]):isNaN(this._x0)?void 0:[[this._x0],[this._x1]]},u.find=function(t,e){var n,r,s,o,a,l=this._x0,u=this._x1,c=[],h=this._root;for(h&&c.push(new i(h,l,u)),null==e?e=1/0:(l=t-e,u=t+e);o=c.pop();)if(!(!(h=o.node)||(r=o.x0)>u||(s=o.x1)<l))if(h.length){var d=(r+s)/2;c.push(new i(h[1],d,s),new i(h[0],r,d)),(a=+(t>=d))&&(o=c[c.length-1],c[c.length-1]=c[c.length-1-a],c[c.length-1-a]=o)}else{var p=Math.abs(t-+this._x.call(null,h.data));p<e&&(e=p,l=t-p,u=t+p,n=h.data)}return n},u.remove=function(t){if(isNaN(s=+this._x.call(null,t)))return this;var e,n,r,i,s,o,a,l,u,c=this._root,h=this._x0,d=this._x1;if(!c)return this;if(c.length)for(;;){if((a=s>=(o=(h+d)/2))?h=o:d=o,e=c,!(c=c[l=+a]))return this;if(!c.length)break;e[l+1&1]&&(n=e,u=l)}for(;c.data!==t;)if(r=c,!(c=c.next))return this;return(i=c.next)&&delete c.next,r?(i?r.next=i:delete r.next,this):e?(i?e[l]=i:delete e[l],(c=e[0]||e[1])&&c===(e[1]||e[0])&&!c.length&&(n?n[u]=c:this._root=c),this):(this._root=i,this)},u.removeAll=function(t){for(var e=0,n=t.length;e<n;++e)this.remove(t[e]);return this},u.root=function(){return this._root},u.size=function(){var t=0;return this.visit((function(e){if(!e.length)do{++t}while(e=e.next)})),t},u.visit=function(t){var e,n,r,s,o=[],a=this._root;for(a&&o.push(new i(a,this._x0,this._x1));e=o.pop();)if(!t(a=e.node,r=e.x0,s=e.x1)&&a.length){var l=(r+s)/2;(n=a[1])&&o.push(new i(n,l,s)),(n=a[0])&&o.push(new i(n,r,l))}return this},u.visitAfter=function(t){var e,n=[],r=[];for(this._root&&n.push(new i(this._root,this._x0,this._x1));e=n.pop();){var s=e.node;if(s.length){var o,a=e.x0,l=e.x1,u=(a+l)/2;(o=s[0])&&n.push(new i(o,a,u)),(o=s[1])&&n.push(new i(o,u,l))}r.push(e)}for(;e=r.pop();)t(e.node,e.x0,e.x1);return this},u.x=function(t){return arguments.length?(this._x=t,this):this._x}},2941:function(t,e,n){"use strict";n.d(e,{Dm:function(){return U}});var r=n(32436),i=n(49289),s=n(54400),o=n(41468),a=n(13802),l=n(21063),u=t=>()=>t;function c(t,{sourceEvent:e,target:n,selection:r,mode:i,dispatch:s}){Object.defineProperties(this,{type:{value:t,enumerable:!0,configurable:!0},sourceEvent:{value:e,enumerable:!0,configurable:!0},target:{value:n,enumerable:!0,configurable:!0},selection:{value:r,enumerable:!0,configurable:!0},mode:{value:i,enumerable:!0,configurable:!0},_:{value:s}})}function h(t){t.stopImmediatePropagation()}function d(t){t.preventDefault(),t.stopImmediatePropagation()}var p={name:"drag"},f={name:"space"},m={name:"handle"},g={name:"center"};const{abs:v,max:y,min:_}=Math;function x(t){return[+t[0],+t[1]]}function b(t){return[x(t[0]),x(t[1])]}var w={name:"x",handles:["w","e"].map(N),input:function(t,e){return null==t?null:[[+t[0],e[0][1]],[+t[1],e[1][1]]]},output:function(t){return t&&[t[0][0],t[1][0]]}},S={name:"y",handles:["n","s"].map(N),input:function(t,e){return null==t?null:[[e[0][0],+t[0]],[e[1][0],+t[1]]]},output:function(t){return t&&[t[0][1],t[1][1]]}},M={name:"xy",handles:["n","w","e","s","nw","ne","sw","se"].map(N),input:function(t){return null==t?null:b(t)},output:function(t){return t}},E={overlay:"crosshair",selection:"move",n:"ns-resize",e:"ew-resize",s:"ns-resize",w:"ew-resize",nw:"nwse-resize",ne:"nesw-resize",se:"nwse-resize",sw:"nesw-resize"},T={e:"w",w:"e",nw:"ne",ne:"nw",se:"sw",sw:"se"},A={n:"s",s:"n",nw:"sw",ne:"se",se:"ne",sw:"nw"},C={overlay:1,selection:1,n:null,e:1,s:null,w:-1,nw:-1,ne:1,se:1,sw:-1},R={overlay:1,selection:1,n:-1,e:null,s:1,w:null,nw:-1,ne:-1,se:1,sw:1};function N(t){return{type:t}}function P(t){return!t.ctrlKey&&!t.button}function I(){var t=this.ownerSVGElement||this;return t.hasAttribute("viewBox")?[[(t=t.viewBox.baseVal).x,t.y],[t.x+t.width,t.y+t.height]]:[[0,0],[t.width.baseVal.value,t.height.baseVal.value]]}function O(){return navigator.maxTouchPoints||"ontouchstart"in this}function D(t){for(;!t.__brush;)if(!(t=t.parentNode))return;return t.__brush}function L(t){return t[0][0]===t[1][0]||t[0][1]===t[1][1]}function U(){return k(M)}function k(t){var e,n=I,x=P,M=O,U=!0,k=(0,r.Z)("start","brush","end"),B=6;function F(e){var n=e.property("__brush",q).selectAll(".overlay").data([N("overlay")]);n.enter().append("rect").attr("class","overlay").attr("pointer-events","all").attr("cursor",E.overlay).merge(n).each((function(){var t=D(this).extent;(0,o.Z)(this).attr("x",t[0][0]).attr("y",t[0][1]).attr("width",t[1][0]-t[0][0]).attr("height",t[1][1]-t[0][1])})),e.selectAll(".selection").data([N("selection")]).enter().append("rect").attr("class","selection").attr("cursor",E.selection).attr("fill","#777").attr("fill-opacity",.3).attr("stroke","#fff").attr("shape-rendering","crispEdges");var r=e.selectAll(".handle").data(t.handles,(function(t){return t.type}));r.exit().remove(),r.enter().append("rect").attr("class",(function(t){return"handle handle--"+t.type})).attr("cursor",(function(t){return E[t.type]})),e.each(z).attr("fill","none").attr("pointer-events","all").on("mousedown.brush",j).filter(M).on("touchstart.brush",j).on("touchmove.brush",H).on("touchend.brush touchcancel.brush",W).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function z(){var t=(0,o.Z)(this),e=D(this).selection;e?(t.selectAll(".selection").style("display",null).attr("x",e[0][0]).attr("y",e[0][1]).attr("width",e[1][0]-e[0][0]).attr("height",e[1][1]-e[0][1]),t.selectAll(".handle").style("display",null).attr("x",(function(t){return"e"===t.type[t.type.length-1]?e[1][0]-B/2:e[0][0]-B/2})).attr("y",(function(t){return"s"===t.type[0]?e[1][1]-B/2:e[0][1]-B/2})).attr("width",(function(t){return"n"===t.type||"s"===t.type?e[1][0]-e[0][0]+B:B})).attr("height",(function(t){return"e"===t.type||"w"===t.type?e[1][1]-e[0][1]+B:B}))):t.selectAll(".selection,.handle").style("display","none").attr("x",null).attr("y",null).attr("width",null).attr("height",null)}function V(t,e,n){var r=t.__brush.emitter;return!r||n&&r.clean?new G(t,e,n):r}function G(t,e,n){this.that=t,this.args=e,this.state=t.__brush,this.active=0,this.clean=n}function j(n){if((!e||n.touches)&&x.apply(this,arguments)){var r,s,u,c,b,M,N,P,I,O,k,B=this,F=n.target.__data__.type,G="selection"===(U&&n.metaKey?F="overlay":F)?p:U&&n.altKey?g:m,j=t===S?null:C[F],H=t===w?null:R[F],W=D(B),q=W.extent,X=W.selection,Z=q[0][0],$=q[0][1],Y=q[1][0],K=q[1][1],J=0,Q=0,tt=j&&H&&U&&n.shiftKey,et=Array.from(n.touches||[n],(t=>{const e=t.identifier;return(t=(0,a.Z)(t,B)).point0=t.slice(),t.identifier=e,t}));(0,l.e1)(B);var nt=V(B,arguments,!0).beforestart();if("overlay"===F){X&&(I=!0);const e=[et[0],et[1]||et[0]];W.selection=X=[[r=t===S?Z:_(e[0][0],e[1][0]),u=t===w?$:_(e[0][1],e[1][1])],[b=t===S?Y:y(e[0][0],e[1][0]),N=t===w?K:y(e[0][1],e[1][1])]],et.length>1&&at(n)}else r=X[0][0],u=X[0][1],b=X[1][0],N=X[1][1];s=r,c=u,M=b,P=N;var rt=(0,o.Z)(B).attr("pointer-events","none"),it=rt.selectAll(".overlay").attr("cursor",E[F]);if(n.touches)nt.moved=ot,nt.ended=lt;else{var st=(0,o.Z)(n.view).on("mousemove.brush",ot,!0).on("mouseup.brush",lt,!0);U&&st.on("keydown.brush",ut,!0).on("keyup.brush",ct,!0),(0,i.Z)(n.view)}z.call(B),nt.start(n,G.name)}function ot(t){for(const e of t.changedTouches||[t])for(const t of et)t.identifier===e.identifier&&(t.cur=(0,a.Z)(e,B));if(tt&&!O&&!k&&1===et.length){const t=et[0];v(t.cur[0]-t[0])>v(t.cur[1]-t[1])?k=!0:O=!0}for(const t of et)t.cur&&(t[0]=t.cur[0],t[1]=t.cur[1]);I=!0,d(t),at(t)}function at(t){const e=et[0],n=e.point0;var i;switch(J=e[0]-n[0],Q=e[1]-n[1],G){case f:case p:j&&(J=y(Z-r,_(Y-b,J)),s=r+J,M=b+J),H&&(Q=y($-u,_(K-N,Q)),c=u+Q,P=N+Q);break;case m:et[1]?(j&&(s=y(Z,_(Y,et[0][0])),M=y(Z,_(Y,et[1][0])),j=1),H&&(c=y($,_(K,et[0][1])),P=y($,_(K,et[1][1])),H=1)):(j<0?(J=y(Z-r,_(Y-r,J)),s=r+J,M=b):j>0&&(J=y(Z-b,_(Y-b,J)),s=r,M=b+J),H<0?(Q=y($-u,_(K-u,Q)),c=u+Q,P=N):H>0&&(Q=y($-N,_(K-N,Q)),c=u,P=N+Q));break;case g:j&&(s=y(Z,_(Y,r-J*j)),M=y(Z,_(Y,b+J*j))),H&&(c=y($,_(K,u-Q*H)),P=y($,_(K,N+Q*H)))}M<s&&(j*=-1,i=r,r=b,b=i,i=s,s=M,M=i,F in T&&it.attr("cursor",E[F=T[F]])),P<c&&(H*=-1,i=u,u=N,N=i,i=c,c=P,P=i,F in A&&it.attr("cursor",E[F=A[F]])),W.selection&&(X=W.selection),O&&(s=X[0][0],M=X[1][0]),k&&(c=X[0][1],P=X[1][1]),X[0][0]===s&&X[0][1]===c&&X[1][0]===M&&X[1][1]===P||(W.selection=[[s,c],[M,P]],z.call(B),nt.brush(t,G.name))}function lt(t){if(h(t),t.touches){if(t.touches.length)return;e&&clearTimeout(e),e=setTimeout((function(){e=null}),500)}else(0,i.D)(t.view,I),st.on("keydown.brush keyup.brush mousemove.brush mouseup.brush",null);rt.attr("pointer-events","all"),it.attr("cursor",E.overlay),W.selection&&(X=W.selection),L(X)&&(W.selection=null,z.call(B)),nt.end(t,G.name)}function ut(t){switch(t.keyCode){case 16:tt=j&&H;break;case 18:G===m&&(j&&(b=M-J*j,r=s+J*j),H&&(N=P-Q*H,u=c+Q*H),G=g,at(t));break;case 32:G!==m&&G!==g||(j<0?b=M-J:j>0&&(r=s-J),H<0?N=P-Q:H>0&&(u=c-Q),G=f,it.attr("cursor",E.selection),at(t));break;default:return}d(t)}function ct(t){switch(t.keyCode){case 16:tt&&(O=k=tt=!1,at(t));break;case 18:G===g&&(j<0?b=M:j>0&&(r=s),H<0?N=P:H>0&&(u=c),G=m,at(t));break;case 32:G===f&&(t.altKey?(j&&(b=M-J*j,r=s+J*j),H&&(N=P-Q*H,u=c+Q*H),G=g):(j<0?b=M:j>0&&(r=s),H<0?N=P:H>0&&(u=c),G=m),it.attr("cursor",E[F]),at(t));break;default:return}d(t)}}function H(t){V(this,arguments).moved(t)}function W(t){V(this,arguments).ended(t)}function q(){var e=this.__brush||{selection:null};return e.extent=b(n.apply(this,arguments)),e.dim=t,e}return F.move=function(e,n,r){e.tween?e.on("start.brush",(function(t){V(this,arguments).beforestart().start(t)})).on("interrupt.brush end.brush",(function(t){V(this,arguments).end(t)})).tween("brush",(function(){var e=this,r=e.__brush,i=V(e,arguments),o=r.selection,a=t.input("function"==typeof n?n.apply(this,arguments):n,r.extent),l=(0,s.Z)(o,a);function u(t){r.selection=1===t&&null===a?null:l(t),z.call(e),i.brush()}return null!==o&&null!==a?u:u(1)})):e.each((function(){var e=this,i=arguments,s=e.__brush,o=t.input("function"==typeof n?n.apply(e,i):n,s.extent),a=V(e,i).beforestart();(0,l.e1)(e),s.selection=null===o?null:o,z.call(e),a.start(r).brush(r).end(r)}))},F.clear=function(t,e){F.move(t,null,e)},G.prototype={beforestart:function(){return 1==++this.active&&(this.state.emitter=this,this.starting=!0),this},start:function(t,e){return this.starting?(this.starting=!1,this.emit("start",t,e)):this.emit("brush",t),this},brush:function(t,e){return this.emit("brush",t,e),this},end:function(t,e){return 0==--this.active&&(delete this.state.emitter,this.emit("end",t,e)),this},emit:function(e,n,r){var i=(0,o.Z)(this.that).datum();k.call(e,this.that,new c(e,{sourceEvent:n,target:F,selection:t.output(this.state.selection),mode:r,dispatch:k}),i)}},F.extent=function(t){return arguments.length?(n="function"==typeof t?t:u(b(t)),F):n},F.filter=function(t){return arguments.length?(x="function"==typeof t?t:u(!!t),F):x},F.touchable=function(t){return arguments.length?(M="function"==typeof t?t:u(!!t),F):M},F.handleSize=function(t){return arguments.length?(B=+t,F):B},F.keyModifiers=function(t){return arguments.length?(U=!!t,F):U},F.on=function(){var t=k.on.apply(k,arguments);return t===k?F:t},F}},45452:function(t,e,n){"use strict";n.d(e,{Z:function(){return f}});var r=n(32436),i=n(41468),s=n(13802),o=n(49289),a=n(5873),l=t=>()=>t;function u(t,{sourceEvent:e,subject:n,target:r,identifier:i,active:s,x:o,y:a,dx:l,dy:u,dispatch:c}){Object.defineProperties(this,{type:{value:t,enumerable:!0,configurable:!0},sourceEvent:{value:e,enumerable:!0,configurable:!0},subject:{value:n,enumerable:!0,configurable:!0},target:{value:r,enumerable:!0,configurable:!0},identifier:{value:i,enumerable:!0,configurable:!0},active:{value:s,enumerable:!0,configurable:!0},x:{value:o,enumerable:!0,configurable:!0},y:{value:a,enumerable:!0,configurable:!0},dx:{value:l,enumerable:!0,configurable:!0},dy:{value:u,enumerable:!0,configurable:!0},_:{value:c}})}function c(t){return!t.ctrlKey&&!t.button}function h(){return this.parentNode}function d(t,e){return null==e?{x:t.x,y:t.y}:e}function p(){return navigator.maxTouchPoints||"ontouchstart"in this}function f(){var t,e,n,f,m=c,g=h,v=d,y=p,_={},x=(0,r.Z)("start","drag","end"),b=0,w=0;function S(t){t.on("mousedown.drag",M).filter(y).on("touchstart.drag",A).on("touchmove.drag",C,a.Q7).on("touchend.drag touchcancel.drag",R).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function M(r,s){if(!f&&m.call(this,r,s)){var l=N(this,g.call(this,r,s),r,s,"mouse");l&&((0,i.Z)(r.view).on("mousemove.drag",E,a.Dd).on("mouseup.drag",T,a.Dd),(0,o.Z)(r.view),(0,a.rG)(r),n=!1,t=r.clientX,e=r.clientY,l("start",r))}}function E(r){if((0,a.ZP)(r),!n){var i=r.clientX-t,s=r.clientY-e;n=i*i+s*s>w}_.mouse("drag",r)}function T(t){(0,i.Z)(t.view).on("mousemove.drag mouseup.drag",null),(0,o.D)(t.view,n),(0,a.ZP)(t),_.mouse("end",t)}function A(t,e){if(m.call(this,t,e)){var n,r,i=t.changedTouches,s=g.call(this,t,e),o=i.length;for(n=0;n<o;++n)(r=N(this,s,t,e,i[n].identifier,i[n]))&&((0,a.rG)(t),r("start",t,i[n]))}}function C(t){var e,n,r=t.changedTouches,i=r.length;for(e=0;e<i;++e)(n=_[r[e].identifier])&&((0,a.ZP)(t),n("drag",t,r[e]))}function R(t){var e,n,r=t.changedTouches,i=r.length;for(f&&clearTimeout(f),f=setTimeout((function(){f=null}),500),e=0;e<i;++e)(n=_[r[e].identifier])&&((0,a.rG)(t),n("end",t,r[e]))}function N(t,e,n,r,i,o){var a,l,c,h=x.copy(),d=(0,s.Z)(o||n,e);if(null!=(c=v.call(t,new u("beforestart",{sourceEvent:n,target:S,identifier:i,active:b,x:d[0],y:d[1],dx:0,dy:0,dispatch:h}),r)))return a=c.x-d[0]||0,l=c.y-d[1]||0,function n(o,p,f){var m,g=d;switch(o){case"start":_[i]=n,m=b++;break;case"end":delete _[i],--b;case"drag":d=(0,s.Z)(f||p,e),m=b}h.call(o,t,new u(o,{sourceEvent:p,subject:c,target:S,identifier:i,active:m,x:d[0]+a,y:d[1]+l,dx:d[0]-g[0],dy:d[1]-g[1],dispatch:h}),r)}}return S.filter=function(t){return arguments.length?(m="function"==typeof t?t:l(!!t),S):m},S.container=function(t){return arguments.length?(g="function"==typeof t?t:l(t),S):g},S.subject=function(t){return arguments.length?(v="function"==typeof t?t:l(t),S):v},S.touchable=function(t){return arguments.length?(y="function"==typeof t?t:l(!!t),S):y},S.on=function(){var t=x.on.apply(x,arguments);return t===x?S:t},S.clickDistance=function(t){return arguments.length?(w=(t=+t)*t,S):Math.sqrt(w)},S}u.prototype.on=function(){var t=this._.on.apply(this._,arguments);return t===this._?this:t}},49289:function(t,e,n){"use strict";n.d(e,{D:function(){return o},Z:function(){return s}});var r=n(41468),i=n(5873);function s(t){var e=t.document.documentElement,n=(0,r.Z)(t).on("dragstart.drag",i.ZP,i.Dd);"onselectstart"in e?n.on("selectstart.drag",i.ZP,i.Dd):(e.__noselect=e.style.MozUserSelect,e.style.MozUserSelect="none")}function o(t,e){var n=t.document.documentElement,s=(0,r.Z)(t).on("dragstart.drag",null);e&&(s.on("click.drag",i.ZP,i.Dd),setTimeout((function(){s.on("click.drag",null)}),0)),"onselectstart"in n?s.on("selectstart.drag",null):(n.style.MozUserSelect=n.__noselect,delete n.__noselect)}},5873:function(t,e,n){"use strict";n.d(e,{Dd:function(){return i},Q7:function(){return r},ZP:function(){return o},rG:function(){return s}});const r={passive:!1},i={capture:!0,passive:!1};function s(t){t.stopImmediatePropagation()}function o(t){t.preventDefault(),t.stopImmediatePropagation()}},44200:function(t,e,n){"use strict";function r(t,e,n){var r,i=1;function s(){var s,o,a=r.length,l=0,u=0,c=0;for(s=0;s<a;++s)l+=(o=r[s]).x||0,u+=o.y||0,c+=o.z||0;for(l=(l/a-t)*i,u=(u/a-e)*i,c=(c/a-n)*i,s=0;s<a;++s)o=r[s],l&&(o.x-=l),u&&(o.y-=u),c&&(o.z-=c)}return null==t&&(t=0),null==e&&(e=0),null==n&&(n=0),s.initialize=function(t){r=t},s.x=function(e){return arguments.length?(t=+e,s):t},s.y=function(t){return arguments.length?(e=+t,s):e},s.z=function(t){return arguments.length?(n=+t,s):n},s.strength=function(t){return arguments.length?(i=+t,s):i},s}n.d(e,{Z:function(){return r}})},68490:function(t,e,n){"use strict";n.d(e,{Z:function(){return h}});var r=n(19753),i=n(76265),s=n(68091),o=n(55444),a=n(94219);function l(t){return t.x+t.vx}function u(t){return t.y+t.vy}function c(t){return t.z+t.vz}function h(t){var e,n,h,d,p=1,f=1;function m(){for(var t,o,m,v,y,_,x,b,w=e.length,S=0;S<f;++S)for(o=(1===n?(0,r.Z)(e,l):2===n?(0,i.Z)(e,l,u):3===n?(0,s.Z)(e,l,u,c):null).visitAfter(g),t=0;t<w;++t)m=e[t],x=h[m.index],b=x*x,v=m.x+m.vx,n>1&&(y=m.y+m.vy),n>2&&(_=m.z+m.vz),o.visit(M);function M(t,e,r,i,s,o,l){var u=[e,r,i,s,o,l],c=u[0],h=u[1],f=u[2],g=u[n],w=u[n+1],S=u[n+2],M=t.data,E=t.r,T=x+E;if(!M)return c>v+T||g<v-T||n>1&&(h>y+T||w<y-T)||n>2&&(f>_+T||S<_-T);if(M.index>m.index){var A=v-M.x-M.vx,C=n>1?y-M.y-M.vy:0,R=n>2?_-M.z-M.vz:0,N=A*A+C*C+R*R;N<T*T&&(0===A&&(N+=(A=(0,a.Z)(d))*A),n>1&&0===C&&(N+=(C=(0,a.Z)(d))*C),n>2&&0===R&&(N+=(R=(0,a.Z)(d))*R),N=(T-(N=Math.sqrt(N)))/N*p,m.vx+=(A*=N)*(T=(E*=E)/(b+E)),n>1&&(m.vy+=(C*=N)*T),n>2&&(m.vz+=(R*=N)*T),M.vx-=A*(T=1-T),n>1&&(M.vy-=C*T),n>2&&(M.vz-=R*T))}}}function g(t){if(t.data)return t.r=h[t.data.index];for(var e=t.r=0;e<Math.pow(2,n);++e)t[e]&&t[e].r>t.r&&(t.r=t[e].r)}function v(){if(e){var n,r,i=e.length;for(h=new Array(i),n=0;n<i;++n)r=e[n],h[r.index]=+t(r,n,e)}}return"function"!=typeof t&&(t=(0,o.Z)(null==t?1:+t)),m.initialize=function(t,...r){e=t,d=r.find((t=>"function"==typeof t))||Math.random,n=r.find((t=>[1,2,3].includes(t)))||2,v()},m.iterations=function(t){return arguments.length?(f=+t,m):f},m.strength=function(t){return arguments.length?(p=+t,m):p},m.radius=function(e){return arguments.length?(t="function"==typeof e?e:(0,o.Z)(+e),v(),m):t},m}},55444:function(t,e,n){"use strict";function r(t){return function(){return t}}n.d(e,{Z:function(){return r}})},94219:function(t,e,n){"use strict";function r(t){return 1e-6*(t()-.5)}n.d(e,{Z:function(){return r}})},5271:function(t,e,n){"use strict";n.d(e,{Z:function(){return a}});var r=n(55444),i=n(94219);function s(t){return t.index}function o(t,e){var n=t.get(e);if(!n)throw new Error("node not found: "+e);return n}function a(t){var e,n,a,l,u,c,h,d=s,p=function(t){return 1/Math.min(u[t.source.index],u[t.target.index])},f=(0,r.Z)(30),m=1;function g(r){for(var s=0,o=t.length;s<m;++s)for(var a,u,d,p,f,g=0,v=0,y=0,_=0;g<o;++g)u=(a=t[g]).source,v=(d=a.target).x+d.vx-u.x-u.vx||(0,i.Z)(h),l>1&&(y=d.y+d.vy-u.y-u.vy||(0,i.Z)(h)),l>2&&(_=d.z+d.vz-u.z-u.vz||(0,i.Z)(h)),v*=p=((p=Math.sqrt(v*v+y*y+_*_))-n[g])/p*r*e[g],y*=p,_*=p,d.vx-=v*(f=c[g]),l>1&&(d.vy-=y*f),l>2&&(d.vz-=_*f),u.vx+=v*(f=1-f),l>1&&(u.vy+=y*f),l>2&&(u.vz+=_*f)}function v(){if(a){var r,i,s=a.length,l=t.length,h=new Map(a.map(((t,e)=>[d(t,e,a),t])));for(r=0,u=new Array(s);r<l;++r)(i=t[r]).index=r,"object"!=typeof i.source&&(i.source=o(h,i.source)),"object"!=typeof i.target&&(i.target=o(h,i.target)),u[i.source.index]=(u[i.source.index]||0)+1,u[i.target.index]=(u[i.target.index]||0)+1;for(r=0,c=new Array(l);r<l;++r)i=t[r],c[r]=u[i.source.index]/(u[i.source.index]+u[i.target.index]);e=new Array(l),y(),n=new Array(l),_()}}function y(){if(a)for(var n=0,r=t.length;n<r;++n)e[n]=+p(t[n],n,t)}function _(){if(a)for(var e=0,r=t.length;e<r;++e)n[e]=+f(t[e],e,t)}return null==t&&(t=[]),g.initialize=function(t,...e){a=t,h=e.find((t=>"function"==typeof t))||Math.random,l=e.find((t=>[1,2,3].includes(t)))||2,v()},g.links=function(e){return arguments.length?(t=e,v(),g):t},g.id=function(t){return arguments.length?(d=t,g):d},g.iterations=function(t){return arguments.length?(m=+t,g):m},g.strength=function(t){return arguments.length?(p="function"==typeof t?t:(0,r.Z)(+t),y(),g):p},g.distance=function(t){return arguments.length?(f="function"==typeof t?t:(0,r.Z)(+t),_(),g):f},g}},80621:function(t,e,n){"use strict";n.d(e,{Z:function(){return u}});var r=n(19753),i=n(76265),s=n(68091),o=n(55444),a=n(94219),l=n(13320);function u(){var t,e,n,u,c,h,d=(0,o.Z)(-30),p=1,f=1/0,m=.81;function g(o){var a,u=t.length,h=(1===e?(0,r.Z)(t,l.x):2===e?(0,i.Z)(t,l.x,l.y):3===e?(0,s.Z)(t,l.x,l.y,l.z):null).visitAfter(y);for(c=o,a=0;a<u;++a)n=t[a],h.visit(_)}function v(){if(t){var e,n,r=t.length;for(h=new Array(r),e=0;e<r;++e)n=t[e],h[n.index]=+d(n,e,t)}}function y(t){var n,r,i,s,o,a,l=0,u=0,c=t.length;if(c){for(i=s=o=a=0;a<c;++a)(n=t[a])&&(r=Math.abs(n.value))&&(l+=n.value,u+=r,i+=r*(n.x||0),s+=r*(n.y||0),o+=r*(n.z||0));l*=Math.sqrt(4/c),t.x=i/u,e>1&&(t.y=s/u),e>2&&(t.z=o/u)}else{(n=t).x=n.data.x,e>1&&(n.y=n.data.y),e>2&&(n.z=n.data.z);do{l+=h[n.data.index]}while(n=n.next)}t.value=l}function _(t,r,i,s,o){if(!t.value)return!0;var l=[i,s,o][e-1],d=t.x-n.x,g=e>1?t.y-n.y:0,v=e>2?t.z-n.z:0,y=l-r,_=d*d+g*g+v*v;if(y*y/m<_)return _<f&&(0===d&&(_+=(d=(0,a.Z)(u))*d),e>1&&0===g&&(_+=(g=(0,a.Z)(u))*g),e>2&&0===v&&(_+=(v=(0,a.Z)(u))*v),_<p&&(_=Math.sqrt(p*_)),n.vx+=d*t.value*c/_,e>1&&(n.vy+=g*t.value*c/_),e>2&&(n.vz+=v*t.value*c/_)),!0;if(!(t.length||_>=f)){(t.data!==n||t.next)&&(0===d&&(_+=(d=(0,a.Z)(u))*d),e>1&&0===g&&(_+=(g=(0,a.Z)(u))*g),e>2&&0===v&&(_+=(v=(0,a.Z)(u))*v),_<p&&(_=Math.sqrt(p*_)));do{t.data!==n&&(y=h[t.data.index]*c/_,n.vx+=d*y,e>1&&(n.vy+=g*y),e>2&&(n.vz+=v*y))}while(t=t.next)}}return g.initialize=function(n,...r){t=n,u=r.find((t=>"function"==typeof t))||Math.random,e=r.find((t=>[1,2,3].includes(t)))||2,v()},g.strength=function(t){return arguments.length?(d="function"==typeof t?t:(0,o.Z)(+t),v(),g):d},g.distanceMin=function(t){return arguments.length?(p=t*t,g):Math.sqrt(p)},g.distanceMax=function(t){return arguments.length?(f=t*t,g):Math.sqrt(f)},g.theta=function(t){return arguments.length?(m=t*t,g):Math.sqrt(m)},g}},54476:function(t,e,n){"use strict";n.d(e,{Z:function(){return i}});var r=n(55444);function i(t,e,n,i){var s,o,a,l,u=(0,r.Z)(.1);function c(t){for(var r=0,u=s.length;r<u;++r){var c=s[r],h=c.x-e||1e-6,d=(c.y||0)-n||1e-6,p=(c.z||0)-i||1e-6,f=Math.sqrt(h*h+d*d+p*p),m=(l[r]-f)*a[r]*t/f;c.vx+=h*m,o>1&&(c.vy+=d*m),o>2&&(c.vz+=p*m)}}function h(){if(s){var e,n=s.length;for(a=new Array(n),l=new Array(n),e=0;e<n;++e)l[e]=+t(s[e],e,s),a[e]=isNaN(l[e])?0:+u(s[e],e,s)}}return"function"!=typeof t&&(t=(0,r.Z)(+t)),null==e&&(e=0),null==n&&(n=0),null==i&&(i=0),c.initialize=function(t,...e){s=t,o=e.find((t=>[1,2,3].includes(t)))||2,h()},c.strength=function(t){return arguments.length?(u="function"==typeof t?t:(0,r.Z)(+t),h(),c):u},c.radius=function(e){return arguments.length?(t="function"==typeof e?e:(0,r.Z)(+e),h(),c):t},c.x=function(t){return arguments.length?(e=+t,c):e},c.y=function(t){return arguments.length?(n=+t,c):n},c.z=function(t){return arguments.length?(i=+t,c):i},c}},13320:function(t,e,n){"use strict";n.d(e,{Z:function(){return h},x:function(){return o},y:function(){return a},z:function(){return l}});var r=n(32436),i=n(83249);const s=4294967296;function o(t){return t.x}function a(t){return t.y}function l(t){return t.z}var u=Math.PI*(3-Math.sqrt(5)),c=20*Math.PI/(9+Math.sqrt(221));function h(t,e){e=e||2;var n,o=Math.min(3,Math.max(1,Math.round(e))),a=1,l=.001,h=1-Math.pow(l,1/300),d=0,p=.6,f=new Map,m=(0,i.HT)(y),g=(0,r.Z)("tick","end"),v=function(){let t=1;return()=>(t=(1664525*t+1013904223)%s)/s}();function y(){_(),g.call("tick",n),a<l&&(m.stop(),g.call("end",n))}function _(e){var r,i,s=t.length;void 0===e&&(e=1);for(var l=0;l<e;++l)for(a+=(d-a)*h,f.forEach((function(t){t(a)})),r=0;r<s;++r)null==(i=t[r]).fx?i.x+=i.vx*=p:(i.x=i.fx,i.vx=0),o>1&&(null==i.fy?i.y+=i.vy*=p:(i.y=i.fy,i.vy=0)),o>2&&(null==i.fz?i.z+=i.vz*=p:(i.z=i.fz,i.vz=0));return n}function x(){for(var e,n=0,r=t.length;n<r;++n){if((e=t[n]).index=n,null!=e.fx&&(e.x=e.fx),null!=e.fy&&(e.y=e.fy),null!=e.fz&&(e.z=e.fz),isNaN(e.x)||o>1&&isNaN(e.y)||o>2&&isNaN(e.z)){var i=10*(o>2?Math.cbrt(.5+n):o>1?Math.sqrt(.5+n):n),s=n*u,a=n*c;1===o?e.x=i:2===o?(e.x=i*Math.cos(s),e.y=i*Math.sin(s)):(e.x=i*Math.sin(s)*Math.cos(a),e.y=i*Math.cos(s),e.z=i*Math.sin(s)*Math.sin(a))}(isNaN(e.vx)||o>1&&isNaN(e.vy)||o>2&&isNaN(e.vz))&&(e.vx=0,o>1&&(e.vy=0),o>2&&(e.vz=0))}}function b(e){return e.initialize&&e.initialize(t,v,o),e}return null==t&&(t=[]),x(),n={tick:_,restart:function(){return m.restart(y),n},stop:function(){return m.stop(),n},numDimensions:function(t){return arguments.length?(o=Math.min(3,Math.max(1,Math.round(t))),f.forEach(b),n):o},nodes:function(e){return arguments.length?(t=e,x(),f.forEach(b),n):t},alpha:function(t){return arguments.length?(a=+t,n):a},alphaMin:function(t){return arguments.length?(l=+t,n):l},alphaDecay:function(t){return arguments.length?(h=+t,n):+h},alphaTarget:function(t){return arguments.length?(d=+t,n):d},velocityDecay:function(t){return arguments.length?(p=1-t,n):1-p},randomSource:function(t){return arguments.length?(v=t,f.forEach(b),n):v},force:function(t,e){return arguments.length>1?(null==e?f.delete(t):f.set(t,b(e)),n):f.get(t)},find:function(){var e,n,r,i,s,a,l=Array.prototype.slice.call(arguments),u=l.shift()||0,c=(o>1?l.shift():null)||0,h=(o>2?l.shift():null)||0,d=l.shift()||1/0,p=0,f=t.length;for(d*=d,p=0;p<f;++p)(i=(e=u-(s=t[p]).x)*e+(n=c-(s.y||0))*n+(r=h-(s.z||0))*r)<d&&(a=s,d=i);return a},on:function(t,e){return arguments.length>1?(g.on(t,e),n):g.on(t)}}}},4507:function(t,e,n){"use strict";function r(t,e){var n,r=1;function i(){var i,s,o=n.length,a=0,l=0;for(i=0;i<o;++i)a+=(s=n[i]).x,l+=s.y;for(a=(a/o-t)*r,l=(l/o-e)*r,i=0;i<o;++i)(s=n[i]).x-=a,s.y-=l}return null==t&&(t=0),null==e&&(e=0),i.initialize=function(t){n=t},i.x=function(e){return arguments.length?(t=+e,i):t},i.y=function(t){return arguments.length?(e=+t,i):e},i.strength=function(t){return arguments.length?(r=+t,i):r},i}n.d(e,{Z:function(){return r}})},56617:function(t,e,n){"use strict";n.d(e,{Z:function(){return l}});var r=n(76265),i=n(61722),s=n(24211);function o(t){return t.x+t.vx}function a(t){return t.y+t.vy}function l(t){var e,n,l,u=1,c=1;function h(){for(var t,i,h,p,f,m,g,v=e.length,y=0;y<c;++y)for(i=(0,r.Z)(e,o,a).visitAfter(d),t=0;t<v;++t)h=e[t],m=n[h.index],g=m*m,p=h.x+h.vx,f=h.y+h.vy,i.visit(_);function _(t,e,n,r,i){var o=t.data,a=t.r,c=m+a;if(!o)return e>p+c||r<p-c||n>f+c||i<f-c;if(o.index>h.index){var d=p-o.x-o.vx,v=f-o.y-o.vy,y=d*d+v*v;y<c*c&&(0===d&&(y+=(d=(0,s.Z)(l))*d),0===v&&(y+=(v=(0,s.Z)(l))*v),y=(c-(y=Math.sqrt(y)))/y*u,h.vx+=(d*=y)*(c=(a*=a)/(g+a)),h.vy+=(v*=y)*c,o.vx-=d*(c=1-c),o.vy-=v*c)}}}function d(t){if(t.data)return t.r=n[t.data.index];for(var e=t.r=0;e<4;++e)t[e]&&t[e].r>t.r&&(t.r=t[e].r)}function p(){if(e){var r,i,s=e.length;for(n=new Array(s),r=0;r<s;++r)i=e[r],n[i.index]=+t(i,r,e)}}return"function"!=typeof t&&(t=(0,i.Z)(null==t?1:+t)),h.initialize=function(t,n){e=t,l=n,p()},h.iterations=function(t){return arguments.length?(c=+t,h):c},h.strength=function(t){return arguments.length?(u=+t,h):u},h.radius=function(e){return arguments.length?(t="function"==typeof e?e:(0,i.Z)(+e),p(),h):t},h}},61722:function(t,e,n){"use strict";function r(t){return function(){return t}}n.d(e,{Z:function(){return r}})},24211:function(t,e,n){"use strict";function r(t){return 1e-6*(t()-.5)}n.d(e,{Z:function(){return r}})},44575:function(t,e,n){"use strict";n.d(e,{Z:function(){return a}});var r=n(61722),i=n(24211);function s(t){return t.index}function o(t,e){var n=t.get(e);if(!n)throw new Error("node not found: "+e);return n}function a(t){var e,n,a,l,u,c,h=s,d=function(t){return 1/Math.min(l[t.source.index],l[t.target.index])},p=(0,r.Z)(30),f=1;function m(r){for(var s=0,o=t.length;s<f;++s)for(var a,l,h,d,p,m,g,v=0;v<o;++v)l=(a=t[v]).source,d=(h=a.target).x+h.vx-l.x-l.vx||(0,i.Z)(c),p=h.y+h.vy-l.y-l.vy||(0,i.Z)(c),d*=m=((m=Math.sqrt(d*d+p*p))-n[v])/m*r*e[v],p*=m,h.vx-=d*(g=u[v]),h.vy-=p*g,l.vx+=d*(g=1-g),l.vy+=p*g}function g(){if(a){var r,i,s=a.length,c=t.length,d=new Map(a.map(((t,e)=>[h(t,e,a),t])));for(r=0,l=new Array(s);r<c;++r)(i=t[r]).index=r,"object"!=typeof i.source&&(i.source=o(d,i.source)),"object"!=typeof i.target&&(i.target=o(d,i.target)),l[i.source.index]=(l[i.source.index]||0)+1,l[i.target.index]=(l[i.target.index]||0)+1;for(r=0,u=new Array(c);r<c;++r)i=t[r],u[r]=l[i.source.index]/(l[i.source.index]+l[i.target.index]);e=new Array(c),v(),n=new Array(c),y()}}function v(){if(a)for(var n=0,r=t.length;n<r;++n)e[n]=+d(t[n],n,t)}function y(){if(a)for(var e=0,r=t.length;e<r;++e)n[e]=+p(t[e],e,t)}return null==t&&(t=[]),m.initialize=function(t,e){a=t,c=e,g()},m.links=function(e){return arguments.length?(t=e,g(),m):t},m.id=function(t){return arguments.length?(h=t,m):h},m.iterations=function(t){return arguments.length?(f=+t,m):f},m.strength=function(t){return arguments.length?(d="function"==typeof t?t:(0,r.Z)(+t),v(),m):d},m.distance=function(t){return arguments.length?(p="function"==typeof t?t:(0,r.Z)(+t),y(),m):p},m}},64681:function(t,e,n){"use strict";n.d(e,{Z:function(){return a}});var r=n(76265),i=n(61722),s=n(24211),o=n(42655);function a(){var t,e,n,a,l,u=(0,i.Z)(-30),c=1,h=1/0,d=.81;function p(n){var i,s=t.length,l=(0,r.Z)(t,o.x,o.y).visitAfter(m);for(a=n,i=0;i<s;++i)e=t[i],l.visit(g)}function f(){if(t){var e,n,r=t.length;for(l=new Array(r),e=0;e<r;++e)n=t[e],l[n.index]=+u(n,e,t)}}function m(t){var e,n,r,i,s,o=0,a=0;if(t.length){for(r=i=s=0;s<4;++s)(e=t[s])&&(n=Math.abs(e.value))&&(o+=e.value,a+=n,r+=n*e.x,i+=n*e.y);t.x=r/a,t.y=i/a}else{(e=t).x=e.data.x,e.y=e.data.y;do{o+=l[e.data.index]}while(e=e.next)}t.value=o}function g(t,r,i,o){if(!t.value)return!0;var u=t.x-e.x,p=t.y-e.y,f=o-r,m=u*u+p*p;if(f*f/d<m)return m<h&&(0===u&&(m+=(u=(0,s.Z)(n))*u),0===p&&(m+=(p=(0,s.Z)(n))*p),m<c&&(m=Math.sqrt(c*m)),e.vx+=u*t.value*a/m,e.vy+=p*t.value*a/m),!0;if(!(t.length||m>=h)){(t.data!==e||t.next)&&(0===u&&(m+=(u=(0,s.Z)(n))*u),0===p&&(m+=(p=(0,s.Z)(n))*p),m<c&&(m=Math.sqrt(c*m)));do{t.data!==e&&(f=l[t.data.index]*a/m,e.vx+=u*f,e.vy+=p*f)}while(t=t.next)}}return p.initialize=function(e,r){t=e,n=r,f()},p.strength=function(t){return arguments.length?(u="function"==typeof t?t:(0,i.Z)(+t),f(),p):u},p.distanceMin=function(t){return arguments.length?(c=t*t,p):Math.sqrt(c)},p.distanceMax=function(t){return arguments.length?(h=t*t,p):Math.sqrt(h)},p.theta=function(t){return arguments.length?(d=t*t,p):Math.sqrt(d)},p}},2881:function(t,e,n){"use strict";n.d(e,{Z:function(){return i}});var r=n(61722);function i(t,e,n){var i,s,o,a=(0,r.Z)(.1);function l(t){for(var r=0,a=i.length;r<a;++r){var l=i[r],u=l.x-e||1e-6,c=l.y-n||1e-6,h=Math.sqrt(u*u+c*c),d=(o[r]-h)*s[r]*t/h;l.vx+=u*d,l.vy+=c*d}}function u(){if(i){var e,n=i.length;for(s=new Array(n),o=new Array(n),e=0;e<n;++e)o[e]=+t(i[e],e,i),s[e]=isNaN(o[e])?0:+a(i[e],e,i)}}return"function"!=typeof t&&(t=(0,r.Z)(+t)),null==e&&(e=0),null==n&&(n=0),l.initialize=function(t){i=t,u()},l.strength=function(t){return arguments.length?(a="function"==typeof t?t:(0,r.Z)(+t),u(),l):a},l.radius=function(e){return arguments.length?(t="function"==typeof e?e:(0,r.Z)(+e),u(),l):t},l.x=function(t){return arguments.length?(e=+t,l):e},l.y=function(t){return arguments.length?(n=+t,l):n},l}},42655:function(t,e,n){"use strict";n.d(e,{Z:function(){return u},x:function(){return o},y:function(){return a}});var r=n(32436),i=n(83249);const s=4294967296;function o(t){return t.x}function a(t){return t.y}var l=Math.PI*(3-Math.sqrt(5));function u(t){var e,n=1,o=.001,a=1-Math.pow(o,1/300),u=0,c=.6,h=new Map,d=(0,i.HT)(m),p=(0,r.Z)("tick","end"),f=function(){let t=1;return()=>(t=(1664525*t+1013904223)%s)/s}();function m(){g(),p.call("tick",e),n<o&&(d.stop(),p.call("end",e))}function g(r){var i,s,o=t.length;void 0===r&&(r=1);for(var l=0;l<r;++l)for(n+=(u-n)*a,h.forEach((function(t){t(n)})),i=0;i<o;++i)null==(s=t[i]).fx?s.x+=s.vx*=c:(s.x=s.fx,s.vx=0),null==s.fy?s.y+=s.vy*=c:(s.y=s.fy,s.vy=0);return e}function v(){for(var e,n=0,r=t.length;n<r;++n){if((e=t[n]).index=n,null!=e.fx&&(e.x=e.fx),null!=e.fy&&(e.y=e.fy),isNaN(e.x)||isNaN(e.y)){var i=10*Math.sqrt(.5+n),s=n*l;e.x=i*Math.cos(s),e.y=i*Math.sin(s)}(isNaN(e.vx)||isNaN(e.vy))&&(e.vx=e.vy=0)}}function y(e){return e.initialize&&e.initialize(t,f),e}return null==t&&(t=[]),v(),e={tick:g,restart:function(){return d.restart(m),e},stop:function(){return d.stop(),e},nodes:function(n){return arguments.length?(t=n,v(),h.forEach(y),e):t},alpha:function(t){return arguments.length?(n=+t,e):n},alphaMin:function(t){return arguments.length?(o=+t,e):o},alphaDecay:function(t){return arguments.length?(a=+t,e):+a},alphaTarget:function(t){return arguments.length?(u=+t,e):u},velocityDecay:function(t){return arguments.length?(c=1-t,e):1-c},randomSource:function(t){return arguments.length?(f=t,h.forEach(y),e):f},force:function(t,n){return arguments.length>1?(null==n?h.delete(t):h.set(t,y(n)),e):h.get(t)},find:function(e,n,r){var i,s,o,a,l,u=0,c=t.length;for(null==r?r=1/0:r*=r,u=0;u<c;++u)(o=(i=e-(a=t[u]).x)*i+(s=n-a.y)*s)<r&&(l=a,r=o);return l},on:function(t,n){return arguments.length>1?(p.on(t,n),e):p.on(t)}}}},32458:function(t,e,n){"use strict";n.d(e,{WU:function(){return h},jH:function(){return d}});var r=n(43466);var i=n(41653);var s,o=n(29651);function a(t,e){var n=(0,o.V)(t,e);if(!n)return t+"";var r=n[0],i=n[1];return i<0?"0."+new Array(-i).join("0")+r:r.length>i+1?r.slice(0,i+1)+"."+r.slice(i+1):r+new Array(i-r.length+2).join("0")}var l={"%":(t,e)=>(100*t).toFixed(e),b:t=>Math.round(t).toString(2),c:t=>t+"",d:o.Z,e:(t,e)=>t.toExponential(e),f:(t,e)=>t.toFixed(e),g:(t,e)=>t.toPrecision(e),o:t=>Math.round(t).toString(8),p:(t,e)=>a(100*t,e),r:a,s:function(t,e){var n=(0,o.V)(t,e);if(!n)return t+"";var r=n[0],i=n[1],a=i-(s=3*Math.max(-8,Math.min(8,Math.floor(i/3))))+1,l=r.length;return a===l?r:a>l?r+new Array(a-l+1).join("0"):a>0?r.slice(0,a)+"."+r.slice(a):"0."+new Array(1-a).join("0")+(0,o.V)(t,Math.max(0,e+a-1))[0]},X:t=>Math.round(t).toString(16).toUpperCase(),x:t=>Math.round(t).toString(16)};function u(t){return t}var c,h,d,p=Array.prototype.map,f=["y","z","a","f","p","n","","m","","k","M","G","T","P","E","Z","Y"];function m(t){var e,n,o=void 0===t.grouping||void 0===t.thousands?u:(e=p.call(t.grouping,Number),n=t.thousands+"",function(t,r){for(var i=t.length,s=[],o=0,a=e[0],l=0;i>0&&a>0&&(l+a+1>r&&(a=Math.max(1,r-l)),s.push(t.substring(i-=a,i+a)),!((l+=a+1)>r));)a=e[o=(o+1)%e.length];return s.reverse().join(n)}),a=void 0===t.currency?"":t.currency[0]+"",c=void 0===t.currency?"":t.currency[1]+"",h=void 0===t.decimal?".":t.decimal+"",d=void 0===t.numerals?u:function(t){return function(e){return e.replace(/[0-9]/g,(function(e){return t[+e]}))}}(p.call(t.numerals,String)),m=void 0===t.percent?"%":t.percent+"",g=void 0===t.minus?"":t.minus+"",v=void 0===t.nan?"NaN":t.nan+"";function y(t){var e=(t=(0,i.Z)(t)).fill,n=t.align,r=t.sign,u=t.symbol,p=t.zero,y=t.width,_=t.comma,x=t.precision,b=t.trim,w=t.type;"n"===w?(_=!0,w="g"):l[w]||(void 0===x&&(x=12),b=!0,w="g"),(p||"0"===e&&"="===n)&&(p=!0,e="0",n="=");var S="$"===u?a:"#"===u&&/[boxX]/.test(w)?"0"+w.toLowerCase():"",M="$"===u?c:/[%p]/.test(w)?m:"",E=l[w],T=/[defgprs%]/.test(w);function A(t){var i,a,l,u=S,c=M;if("c"===w)c=E(t)+c,t="";else{var m=(t=+t)<0||1/t<0;if(t=isNaN(t)?v:E(Math.abs(t),x),b&&(t=function(t){t:for(var e,n=t.length,r=1,i=-1;r<n;++r)switch(t[r]){case".":i=e=r;break;case"0":0===i&&(i=r),e=r;break;default:if(!+t[r])break t;i>0&&(i=0)}return i>0?t.slice(0,i)+t.slice(e+1):t}(t)),m&&0==+t&&"+"!==r&&(m=!1),u=(m?"("===r?r:g:"-"===r||"("===r?"":r)+u,c=("s"===w?f[8+s/3]:"")+c+(m&&"("===r?")":""),T)for(i=-1,a=t.length;++i<a;)if(48>(l=t.charCodeAt(i))||l>57){c=(46===l?h+t.slice(i+1):t.slice(i))+c,t=t.slice(0,i);break}}_&&!p&&(t=o(t,1/0));var A=u.length+t.length+c.length,C=A<y?new Array(y-A+1).join(e):"";switch(_&&p&&(t=o(C+t,C.length?y-c.length:1/0),C=""),n){case"<":t=u+t+c+C;break;case"=":t=u+C+t+c;break;case"^":t=C.slice(0,A=C.length>>1)+u+t+c+C.slice(A);break;default:t=C+u+t+c}return d(t)}return x=void 0===x?6:/[gprs]/.test(w)?Math.max(1,Math.min(21,x)):Math.max(0,Math.min(20,x)),A.toString=function(){return t+""},A}return{format:y,formatPrefix:function(t,e){var n=y(((t=(0,i.Z)(t)).type="f",t)),s=3*Math.max(-8,Math.min(8,Math.floor((0,r.Z)(e)/3))),o=Math.pow(10,-s),a=f[8+s/3];return function(t){return n(o*t)+a}}}}c=m({thousands:",",grouping:[3],currency:["$",""]}),h=c.format,d=c.formatPrefix},43466:function(t,e,n){"use strict";n.d(e,{Z:function(){return i}});var r=n(29651);function i(t){return(t=(0,r.V)(Math.abs(t)))?t[1]:NaN}},29651:function(t,e,n){"use strict";function r(t){return Math.abs(t=Math.round(t))>=1e21?t.toLocaleString("en").replace(/,/g,""):t.toString(10)}function i(t,e){if((n=(t=e?t.toExponential(e-1):t.toExponential()).indexOf("e"))<0)return null;var n,r=t.slice(0,n);return[r.length>1?r[0]+r.slice(2):r,+t.slice(n+1)]}n.d(e,{V:function(){return i},Z:function(){return r}})},41653:function(t,e,n){"use strict";n.d(e,{Z:function(){return i}});var r=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function i(t){if(!(e=r.exec(t)))throw new Error("invalid format: "+t);var e;return new s({fill:e[1],align:e[2],sign:e[3],symbol:e[4],zero:e[5],width:e[6],comma:e[7],precision:e[8]&&e[8].slice(1),trim:e[9],type:e[10]})}function s(t){this.fill=void 0===t.fill?" ":t.fill+"",this.align=void 0===t.align?">":t.align+"",this.sign=void 0===t.sign?"-":t.sign+"",this.symbol=void 0===t.symbol?"":t.symbol+"",this.zero=!!t.zero,this.width=void 0===t.width?void 0:+t.width,this.comma=!!t.comma,this.precision=void 0===t.precision?void 0:+t.precision,this.trim=!!t.trim,this.type=void 0===t.type?"":t.type+""}i.prototype=s.prototype,s.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(void 0===this.width?"":Math.max(1,0|this.width))+(this.comma?",":"")+(void 0===this.precision?"":"."+Math.max(0,0|this.precision))+(this.trim?"~":"")+this.type}},68091:function(t,e,n){"use strict";function r(t,e,n,r,i){if(isNaN(e)||isNaN(n)||isNaN(r))return t;var s,o,a,l,u,c,h,d,p,f,m,g,v=t._root,y={data:i},_=t._x0,x=t._y0,b=t._z0,w=t._x1,S=t._y1,M=t._z1;if(!v)return t._root=y,t;for(;v.length;)if((d=e>=(o=(_+w)/2))?_=o:w=o,(p=n>=(a=(x+S)/2))?x=a:S=a,(f=r>=(l=(b+M)/2))?b=l:M=l,s=v,!(v=v[m=f<<2|p<<1|d]))return s[m]=y,t;if(u=+t._x.call(null,v.data),c=+t._y.call(null,v.data),h=+t._z.call(null,v.data),e===u&&n===c&&r===h)return y.next=v,s?s[m]=y:t._root=y,t;do{s=s?s[m]=new Array(8):t._root=new Array(8),(d=e>=(o=(_+w)/2))?_=o:w=o,(p=n>=(a=(x+S)/2))?x=a:S=a,(f=r>=(l=(b+M)/2))?b=l:M=l}while((m=f<<2|p<<1|d)==(g=(h>=l)<<2|(c>=a)<<1|u>=o));return s[g]=v,s[m]=y,t}function i(t,e,n,r,i,s,o){this.node=t,this.x0=e,this.y0=n,this.z0=r,this.x1=i,this.y1=s,this.z1=o}function s(t){return t[0]}function o(t){return t[1]}function a(t){return t[2]}function l(t,e,n,r){var i=new u(null==e?s:e,null==n?o:n,null==r?a:r,NaN,NaN,NaN,NaN,NaN,NaN);return null==t?i:i.addAll(t)}function u(t,e,n,r,i,s,o,a,l){this._x=t,this._y=e,this._z=n,this._x0=r,this._y0=i,this._z0=s,this._x1=o,this._y1=a,this._z1=l,this._root=void 0}function c(t){for(var e={data:t.data},n=e;t=t.next;)n=n.next={data:t.data};return e}n.d(e,{Z:function(){return l}});var h=l.prototype=u.prototype;h.copy=function(){var t,e,n=new u(this._x,this._y,this._z,this._x0,this._y0,this._z0,this._x1,this._y1,this._z1),r=this._root;if(!r)return n;if(!r.length)return n._root=c(r),n;for(t=[{source:r,target:n._root=new Array(8)}];r=t.pop();)for(var i=0;i<8;++i)(e=r.source[i])&&(e.length?t.push({source:e,target:r.target[i]=new Array(8)}):r.target[i]=c(e));return n},h.add=function(t){const e=+this._x.call(null,t),n=+this._y.call(null,t),i=+this._z.call(null,t);return r(this.cover(e,n,i),e,n,i,t)},h.addAll=function(t){Array.isArray(t)||(t=Array.from(t));const e=t.length,n=new Float64Array(e),i=new Float64Array(e),s=new Float64Array(e);let o=1/0,a=1/0,l=1/0,u=-1/0,c=-1/0,h=-1/0;for(let r,d,p,f,m=0;m<e;++m)isNaN(d=+this._x.call(null,r=t[m]))||isNaN(p=+this._y.call(null,r))||isNaN(f=+this._z.call(null,r))||(n[m]=d,i[m]=p,s[m]=f,d<o&&(o=d),d>u&&(u=d),p<a&&(a=p),p>c&&(c=p),f<l&&(l=f),f>h&&(h=f));if(o>u||a>c||l>h)return this;this.cover(o,a,l).cover(u,c,h);for(let o=0;o<e;++o)r(this,n[o],i[o],s[o],t[o]);return this},h.cover=function(t,e,n){if(isNaN(t=+t)||isNaN(e=+e)||isNaN(n=+n))return this;var r=this._x0,i=this._y0,s=this._z0,o=this._x1,a=this._y1,l=this._z1;if(isNaN(r))o=(r=Math.floor(t))+1,a=(i=Math.floor(e))+1,l=(s=Math.floor(n))+1;else{for(var u,c,h=o-r||1,d=this._root;r>t||t>=o||i>e||e>=a||s>n||n>=l;)switch(c=(n<s)<<2|(e<i)<<1|t<r,(u=new Array(8))[c]=d,d=u,h*=2,c){case 0:o=r+h,a=i+h,l=s+h;break;case 1:r=o-h,a=i+h,l=s+h;break;case 2:o=r+h,i=a-h,l=s+h;break;case 3:r=o-h,i=a-h,l=s+h;break;case 4:o=r+h,a=i+h,s=l-h;break;case 5:r=o-h,a=i+h,s=l-h;break;case 6:o=r+h,i=a-h,s=l-h;break;case 7:r=o-h,i=a-h,s=l-h}this._root&&this._root.length&&(this._root=d)}return this._x0=r,this._y0=i,this._z0=s,this._x1=o,this._y1=a,this._z1=l,this},h.data=function(){var t=[];return this.visit((function(e){if(!e.length)do{t.push(e.data)}while(e=e.next)})),t},h.extent=function(t){return arguments.length?this.cover(+t[0][0],+t[0][1],+t[0][2]).cover(+t[1][0],+t[1][1],+t[1][2]):isNaN(this._x0)?void 0:[[this._x0,this._y0,this._z0],[this._x1,this._y1,this._z1]]},h.find=function(t,e,n,r){var s,o,a,l,u,c,h,d,p,f=this._x0,m=this._y0,g=this._z0,v=this._x1,y=this._y1,_=this._z1,x=[],b=this._root;for(b&&x.push(new i(b,f,m,g,v,y,_)),null==r?r=1/0:(f=t-r,m=e-r,g=n-r,v=t+r,y=e+r,_=n+r,r*=r);d=x.pop();)if(!(!(b=d.node)||(o=d.x0)>v||(a=d.y0)>y||(l=d.z0)>_||(u=d.x1)<f||(c=d.y1)<m||(h=d.z1)<g))if(b.length){var w=(o+u)/2,S=(a+c)/2,M=(l+h)/2;x.push(new i(b[7],w,S,M,u,c,h),new i(b[6],o,S,M,w,c,h),new i(b[5],w,a,M,u,S,h),new i(b[4],o,a,M,w,S,h),new i(b[3],w,S,l,u,c,M),new i(b[2],o,S,l,w,c,M),new i(b[1],w,a,l,u,S,M),new i(b[0],o,a,l,w,S,M)),(p=(n>=M)<<2|(e>=S)<<1|t>=w)&&(d=x[x.length-1],x[x.length-1]=x[x.length-1-p],x[x.length-1-p]=d)}else{var E=t-+this._x.call(null,b.data),T=e-+this._y.call(null,b.data),A=n-+this._z.call(null,b.data),C=E*E+T*T+A*A;if(C<r){var R=Math.sqrt(r=C);f=t-R,m=e-R,g=n-R,v=t+R,y=e+R,_=n+R,s=b.data}}return s},h.remove=function(t){if(isNaN(s=+this._x.call(null,t))||isNaN(o=+this._y.call(null,t))||isNaN(a=+this._z.call(null,t)))return this;var e,n,r,i,s,o,a,l,u,c,h,d,p,f,m,g=this._root,v=this._x0,y=this._y0,_=this._z0,x=this._x1,b=this._y1,w=this._z1;if(!g)return this;if(g.length)for(;;){if((h=s>=(l=(v+x)/2))?v=l:x=l,(d=o>=(u=(y+b)/2))?y=u:b=u,(p=a>=(c=(_+w)/2))?_=c:w=c,e=g,!(g=g[f=p<<2|d<<1|h]))return this;if(!g.length)break;(e[f+1&7]||e[f+2&7]||e[f+3&7]||e[f+4&7]||e[f+5&7]||e[f+6&7]||e[f+7&7])&&(n=e,m=f)}for(;g.data!==t;)if(r=g,!(g=g.next))return this;return(i=g.next)&&delete g.next,r?(i?r.next=i:delete r.next,this):e?(i?e[f]=i:delete e[f],(g=e[0]||e[1]||e[2]||e[3]||e[4]||e[5]||e[6]||e[7])&&g===(e[7]||e[6]||e[5]||e[4]||e[3]||e[2]||e[1]||e[0])&&!g.length&&(n?n[m]=g:this._root=g),this):(this._root=i,this)},h.removeAll=function(t){for(var e=0,n=t.length;e<n;++e)this.remove(t[e]);return this},h.root=function(){return this._root},h.size=function(){var t=0;return this.visit((function(e){if(!e.length)do{++t}while(e=e.next)})),t},h.visit=function(t){var e,n,r,s,o,a,l,u,c=[],h=this._root;for(h&&c.push(new i(h,this._x0,this._y0,this._z0,this._x1,this._y1,this._z1));e=c.pop();)if(!t(h=e.node,r=e.x0,s=e.y0,o=e.z0,a=e.x1,l=e.y1,u=e.z1)&&h.length){var d=(r+a)/2,p=(s+l)/2,f=(o+u)/2;(n=h[7])&&c.push(new i(n,d,p,f,a,l,u)),(n=h[6])&&c.push(new i(n,r,p,f,d,l,u)),(n=h[5])&&c.push(new i(n,d,s,f,a,p,u)),(n=h[4])&&c.push(new i(n,r,s,f,d,p,u)),(n=h[3])&&c.push(new i(n,d,p,o,a,l,f)),(n=h[2])&&c.push(new i(n,r,p,o,d,l,f)),(n=h[1])&&c.push(new i(n,d,s,o,a,p,f)),(n=h[0])&&c.push(new i(n,r,s,o,d,p,f))}return this},h.visitAfter=function(t){var e,n=[],r=[];for(this._root&&n.push(new i(this._root,this._x0,this._y0,this._z0,this._x1,this._y1,this._z1));e=n.pop();){var s=e.node;if(s.length){var o,a=e.x0,l=e.y0,u=e.z0,c=e.x1,h=e.y1,d=e.z1,p=(a+c)/2,f=(l+h)/2,m=(u+d)/2;(o=s[0])&&n.push(new i(o,a,l,u,p,f,m)),(o=s[1])&&n.push(new i(o,p,l,u,c,f,m)),(o=s[2])&&n.push(new i(o,a,f,u,p,h,m)),(o=s[3])&&n.push(new i(o,p,f,u,c,h,m)),(o=s[4])&&n.push(new i(o,a,l,m,p,f,d)),(o=s[5])&&n.push(new i(o,p,l,m,c,f,d)),(o=s[6])&&n.push(new i(o,a,f,m,p,h,d)),(o=s[7])&&n.push(new i(o,p,f,m,c,h,d))}r.push(e)}for(;e=r.pop();)t(e.node,e.x0,e.y0,e.z0,e.x1,e.y1,e.z1);return this},h.x=function(t){return arguments.length?(this._x=t,this):this._x},h.y=function(t){return arguments.length?(this._y=t,this):this._y},h.z=function(t){return arguments.length?(this._z=t,this):this._z}},76265:function(t,e,n){"use strict";function r(t,e,n,r){if(isNaN(e)||isNaN(n))return t;var i,s,o,a,l,u,c,h,d,p=t._root,f={data:r},m=t._x0,g=t._y0,v=t._x1,y=t._y1;if(!p)return t._root=f,t;for(;p.length;)if((u=e>=(s=(m+v)/2))?m=s:v=s,(c=n>=(o=(g+y)/2))?g=o:y=o,i=p,!(p=p[h=c<<1|u]))return i[h]=f,t;if(a=+t._x.call(null,p.data),l=+t._y.call(null,p.data),e===a&&n===l)return f.next=p,i?i[h]=f:t._root=f,t;do{i=i?i[h]=new Array(4):t._root=new Array(4),(u=e>=(s=(m+v)/2))?m=s:v=s,(c=n>=(o=(g+y)/2))?g=o:y=o}while((h=c<<1|u)==(d=(l>=o)<<1|a>=s));return i[d]=p,i[h]=f,t}function i(t,e,n,r,i){this.node=t,this.x0=e,this.y0=n,this.x1=r,this.y1=i}function s(t){return t[0]}function o(t){return t[1]}function a(t,e,n){var r=new l(null==e?s:e,null==n?o:n,NaN,NaN,NaN,NaN);return null==t?r:r.addAll(t)}function l(t,e,n,r,i,s){this._x=t,this._y=e,this._x0=n,this._y0=r,this._x1=i,this._y1=s,this._root=void 0}function u(t){for(var e={data:t.data},n=e;t=t.next;)n=n.next={data:t.data};return e}n.d(e,{Z:function(){return a}});var c=a.prototype=l.prototype;c.copy=function(){var t,e,n=new l(this._x,this._y,this._x0,this._y0,this._x1,this._y1),r=this._root;if(!r)return n;if(!r.length)return n._root=u(r),n;for(t=[{source:r,target:n._root=new Array(4)}];r=t.pop();)for(var i=0;i<4;++i)(e=r.source[i])&&(e.length?t.push({source:e,target:r.target[i]=new Array(4)}):r.target[i]=u(e));return n},c.add=function(t){const e=+this._x.call(null,t),n=+this._y.call(null,t);return r(this.cover(e,n),e,n,t)},c.addAll=function(t){var e,n,i,s,o=t.length,a=new Array(o),l=new Array(o),u=1/0,c=1/0,h=-1/0,d=-1/0;for(n=0;n<o;++n)isNaN(i=+this._x.call(null,e=t[n]))||isNaN(s=+this._y.call(null,e))||(a[n]=i,l[n]=s,i<u&&(u=i),i>h&&(h=i),s<c&&(c=s),s>d&&(d=s));if(u>h||c>d)return this;for(this.cover(u,c).cover(h,d),n=0;n<o;++n)r(this,a[n],l[n],t[n]);return this},c.cover=function(t,e){if(isNaN(t=+t)||isNaN(e=+e))return this;var n=this._x0,r=this._y0,i=this._x1,s=this._y1;if(isNaN(n))i=(n=Math.floor(t))+1,s=(r=Math.floor(e))+1;else{for(var o,a,l=i-n||1,u=this._root;n>t||t>=i||r>e||e>=s;)switch(a=(e<r)<<1|t<n,(o=new Array(4))[a]=u,u=o,l*=2,a){case 0:i=n+l,s=r+l;break;case 1:n=i-l,s=r+l;break;case 2:i=n+l,r=s-l;break;case 3:n=i-l,r=s-l}this._root&&this._root.length&&(this._root=u)}return this._x0=n,this._y0=r,this._x1=i,this._y1=s,this},c.data=function(){var t=[];return this.visit((function(e){if(!e.length)do{t.push(e.data)}while(e=e.next)})),t},c.extent=function(t){return arguments.length?this.cover(+t[0][0],+t[0][1]).cover(+t[1][0],+t[1][1]):isNaN(this._x0)?void 0:[[this._x0,this._y0],[this._x1,this._y1]]},c.find=function(t,e,n){var r,s,o,a,l,u,c,h=this._x0,d=this._y0,p=this._x1,f=this._y1,m=[],g=this._root;for(g&&m.push(new i(g,h,d,p,f)),null==n?n=1/0:(h=t-n,d=e-n,p=t+n,f=e+n,n*=n);u=m.pop();)if(!(!(g=u.node)||(s=u.x0)>p||(o=u.y0)>f||(a=u.x1)<h||(l=u.y1)<d))if(g.length){var v=(s+a)/2,y=(o+l)/2;m.push(new i(g[3],v,y,a,l),new i(g[2],s,y,v,l),new i(g[1],v,o,a,y),new i(g[0],s,o,v,y)),(c=(e>=y)<<1|t>=v)&&(u=m[m.length-1],m[m.length-1]=m[m.length-1-c],m[m.length-1-c]=u)}else{var _=t-+this._x.call(null,g.data),x=e-+this._y.call(null,g.data),b=_*_+x*x;if(b<n){var w=Math.sqrt(n=b);h=t-w,d=e-w,p=t+w,f=e+w,r=g.data}}return r},c.remove=function(t){if(isNaN(s=+this._x.call(null,t))||isNaN(o=+this._y.call(null,t)))return this;var e,n,r,i,s,o,a,l,u,c,h,d,p=this._root,f=this._x0,m=this._y0,g=this._x1,v=this._y1;if(!p)return this;if(p.length)for(;;){if((u=s>=(a=(f+g)/2))?f=a:g=a,(c=o>=(l=(m+v)/2))?m=l:v=l,e=p,!(p=p[h=c<<1|u]))return this;if(!p.length)break;(e[h+1&3]||e[h+2&3]||e[h+3&3])&&(n=e,d=h)}for(;p.data!==t;)if(r=p,!(p=p.next))return this;return(i=p.next)&&delete p.next,r?(i?r.next=i:delete r.next,this):e?(i?e[h]=i:delete e[h],(p=e[0]||e[1]||e[2]||e[3])&&p===(e[3]||e[2]||e[1]||e[0])&&!p.length&&(n?n[d]=p:this._root=p),this):(this._root=i,this)},c.removeAll=function(t){for(var e=0,n=t.length;e<n;++e)this.remove(t[e]);return this},c.root=function(){return this._root},c.size=function(){var t=0;return this.visit((function(e){if(!e.length)do{++t}while(e=e.next)})),t},c.visit=function(t){var e,n,r,s,o,a,l=[],u=this._root;for(u&&l.push(new i(u,this._x0,this._y0,this._x1,this._y1));e=l.pop();)if(!t(u=e.node,r=e.x0,s=e.y0,o=e.x1,a=e.y1)&&u.length){var c=(r+o)/2,h=(s+a)/2;(n=u[3])&&l.push(new i(n,c,h,o,a)),(n=u[2])&&l.push(new i(n,r,h,c,a)),(n=u[1])&&l.push(new i(n,c,s,o,h)),(n=u[0])&&l.push(new i(n,r,s,c,h))}return this},c.visitAfter=function(t){var e,n=[],r=[];for(this._root&&n.push(new i(this._root,this._x0,this._y0,this._x1,this._y1));e=n.pop();){var s=e.node;if(s.length){var o,a=e.x0,l=e.y0,u=e.x1,c=e.y1,h=(a+u)/2,d=(l+c)/2;(o=s[0])&&n.push(new i(o,a,l,h,d)),(o=s[1])&&n.push(new i(o,h,l,u,d)),(o=s[2])&&n.push(new i(o,a,d,h,c)),(o=s[3])&&n.push(new i(o,h,d,u,c))}r.push(e)}for(;e=r.pop();)t(e.node,e.x0,e.y0,e.x1,e.y1);return this},c.x=function(t){return arguments.length?(this._x=t,this):this._x},c.y=function(t){return arguments.length?(this._y=t,this):this._y}},22059:function(t,e,n){"use strict";var r=n(92972);e.Z=(0,r.Z)("a6cee31f78b4b2df8a33a02cfb9a99e31a1cfdbf6fff7f00cab2d66a3d9affff99b15928")},92972:function(t,e,n){"use strict";function r(t){for(var e=t.length/6|0,n=new Array(e),r=0;r<e;)n[r]="#"+t.slice(6*r,6*++r);return n}n.d(e,{Z:function(){return r}})},40220:function(t,e,n){"use strict";n.d(e,{JG:function(){return p},ZP:function(){return m},yR:function(){return u},l4:function(){return f}});var r=n(44080),i=n(54400),s=n(88486);function o(t,e){return t=+t,e=+e,function(n){return Math.round(t*(1-n)+e*n)}}function a(t){return+t}var l=[0,1];function u(t){return t}function c(t,e){return(e-=t=+t)?function(n){return(n-t)/e}:(n=isNaN(e)?NaN:.5,function(){return n});var n}function h(t,e,n){var r=t[0],i=t[1],s=e[0],o=e[1];return i<r?(r=c(i,r),s=n(o,s)):(r=c(r,i),s=n(s,o)),function(t){return s(r(t))}}function d(t,e,n){var i=Math.min(t.length,e.length)-1,s=new Array(i),o=new Array(i),a=-1;for(t[i]<t[0]&&(t=t.slice().reverse(),e=e.slice().reverse());++a<i;)s[a]=c(t[a],t[a+1]),o[a]=n(e[a],e[a+1]);return function(e){var n=(0,r.ZP)(t,e,1,i)-1;return o[n](s[n](e))}}function p(t,e){return e.domain(t.domain()).range(t.range()).interpolate(t.interpolate()).clamp(t.clamp()).unknown(t.unknown())}function f(){var t,e,n,r,c,p,f=l,m=l,g=i.Z,v=u;function y(){var t=Math.min(f.length,m.length);return v!==u&&(v=function(t,e){var n;return t>e&&(n=t,t=e,e=n),function(n){return Math.max(t,Math.min(e,n))}}(f[0],f[t-1])),r=t>2?d:h,c=p=null,_}function _(e){return null==e||isNaN(e=+e)?n:(c||(c=r(f.map(t),m,g)))(t(v(e)))}return _.invert=function(n){return v(e((p||(p=r(m,f.map(t),s.Z)))(n)))},_.domain=function(t){return arguments.length?(f=Array.from(t,a),y()):f.slice()},_.range=function(t){return arguments.length?(m=Array.from(t),y()):m.slice()},_.rangeRound=function(t){return m=Array.from(t),g=o,y()},_.clamp=function(t){return arguments.length?(v=!!t||u,y()):v!==u},_.interpolate=function(t){return arguments.length?(g=t,y()):g},_.unknown=function(t){return arguments.length?(n=t,_):n},function(n,r){return t=n,e=r,y()}}function m(){return f()(u,u)}},33235:function(t,e,n){"use strict";function r(t,e){switch(arguments.length){case 0:break;case 1:this.range(t);break;default:this.range(e).domain(t)}return this}n.d(e,{o:function(){return r}})},31105:function(t,e,n){"use strict";n.d(e,{Z:function(){return h},Q:function(){return c}});var r=n(77252),i=n(40220),s=n(33235),o=n(41653),a=n(43466);var l=n(32458);function u(t,e,n,i){var s,u=(0,r.ly)(t,e,n);switch((i=(0,o.Z)(null==i?",f":i)).type){case"s":var c=Math.max(Math.abs(t),Math.abs(e));return null!=i.precision||isNaN(s=function(t,e){return Math.max(0,3*Math.max(-8,Math.min(8,Math.floor((0,a.Z)(e)/3)))-(0,a.Z)(Math.abs(t)))}(u,c))||(i.precision=s),(0,l.jH)(i,c);case"":case"e":case"g":case"p":case"r":null!=i.precision||isNaN(s=function(t,e){return t=Math.abs(t),e=Math.abs(e)-t,Math.max(0,(0,a.Z)(e)-(0,a.Z)(t))+1}(u,Math.max(Math.abs(t),Math.abs(e))))||(i.precision=s-("e"===i.type));break;case"f":case"%":null!=i.precision||isNaN(s=function(t){return Math.max(0,-(0,a.Z)(Math.abs(t)))}(u))||(i.precision=s-2*("%"===i.type))}return(0,l.WU)(i)}function c(t){var e=t.domain;return t.ticks=function(t){var n=e();return(0,r.ZP)(n[0],n[n.length-1],null==t?10:t)},t.tickFormat=function(t,n){var r=e();return u(r[0],r[r.length-1],null==t?10:t,n)},t.nice=function(n){null==n&&(n=10);var i,s,o=e(),a=0,l=o.length-1,u=o[a],c=o[l],h=10;for(c<u&&(s=u,u=c,c=s,s=a,a=l,l=s);h-- >0;){if((s=(0,r.G9)(u,c,n))===i)return o[a]=u,o[l]=c,e(o);if(s>0)u=Math.floor(u/s)*s,c=Math.ceil(c/s)*s;else{if(!(s<0))break;u=Math.ceil(u*s)/s,c=Math.floor(c*s)/s}i=s}return t},t}function h(){var t=(0,i.ZP)();return t.copy=function(){return(0,i.JG)(t,h())},s.o.apply(t,arguments),c(t)}},7706:function(t,e,n){"use strict";n.d(e,{Z:function(){return m}});var r=n(77252),i=n(41653),s=n(32458);var o=n(40220),a=n(33235);function l(t){return Math.log(t)}function u(t){return Math.exp(t)}function c(t){return-Math.log(-t)}function h(t){return-Math.exp(-t)}function d(t){return isFinite(t)?+("1e"+t):t<0?0:t}function p(t){return(e,n)=>-t(-e,n)}function f(t){const e=t(l,u),n=e.domain;let o,a,f=10;function m(){return o=function(t){return t===Math.E?Math.log:10===t&&Math.log10||2===t&&Math.log2||(t=Math.log(t),e=>Math.log(e)/t)}(f),a=function(t){return 10===t?d:t===Math.E?Math.exp:e=>Math.pow(t,e)}(f),n()[0]<0?(o=p(o),a=p(a),t(c,h)):t(l,u),e}return e.base=function(t){return arguments.length?(f=+t,m()):f},e.domain=function(t){return arguments.length?(n(t),m()):n()},e.ticks=t=>{const e=n();let i=e[0],s=e[e.length-1];const l=s<i;l&&([i,s]=[s,i]);let u,c,h=o(i),d=o(s);const p=null==t?10:+t;let m=[];if(!(f%1)&&d-h<p){if(h=Math.floor(h),d=Math.ceil(d),i>0){for(;h<=d;++h)for(u=1;u<f;++u)if(c=h<0?u/a(-h):u*a(h),!(c<i)){if(c>s)break;m.push(c)}}else for(;h<=d;++h)for(u=f-1;u>=1;--u)if(c=h>0?u/a(-h):u*a(h),!(c<i)){if(c>s)break;m.push(c)}2*m.length<p&&(m=(0,r.ZP)(i,s,p))}else m=(0,r.ZP)(h,d,Math.min(d-h,p)).map(a);return l?m.reverse():m},e.tickFormat=(t,n)=>{if(null==t&&(t=10),null==n&&(n=10===f?"s":","),"function"!=typeof n&&(f%1||null!=(n=(0,i.Z)(n)).precision||(n.trim=!0),n=(0,s.WU)(n)),t===1/0)return n;const r=Math.max(1,f*t/e.ticks().length);return t=>{let e=t/a(Math.round(o(t)));return e*f<f-.5&&(e*=f),e<=r?n(t):""}},e.nice=()=>n(function(t,e){var n,r=0,i=(t=t.slice()).length-1,s=t[r],o=t[i];return o<s&&(n=r,r=i,i=n,n=s,s=o,o=n),t[r]=e.floor(s),t[i]=e.ceil(o),t}(n(),{floor:t=>a(Math.floor(o(t))),ceil:t=>a(Math.ceil(o(t)))})),e}function m(){const t=f((0,o.l4)()).domain([1,10]);return t.copy=()=>(0,o.JG)(t,m()).base(t.base()),a.o.apply(t,arguments),t}},9771:function(t,e,n){"use strict";n.d(e,{Z:function(){return o}});var r=n(14131),i=n(33235);const s=Symbol("implicit");function o(){var t=new r.L,e=[],n=[],a=s;function l(r){let i=t.get(r);if(void 0===i){if(a!==s)return a;t.set(r,i=e.push(r)-1)}return n[i%n.length]}return l.domain=function(n){if(!arguments.length)return e.slice();e=[],t=new r.L;for(const r of n)t.has(r)||t.set(r,e.push(r)-1);return l},l.range=function(t){return arguments.length?(n=Array.from(t),l):n.slice()},l.unknown=function(t){return arguments.length?(a=t,l):a},l.copy=function(){return o(e,n).unknown(a)},i.o.apply(l,arguments),l}},78620:function(t,e,n){"use strict";n.d(e,{ZP:function(){return c}});var r=n(31105),i=n(40220),s=n(33235);function o(t){return function(e){return e<0?-Math.pow(-e,t):Math.pow(e,t)}}function a(t){return t<0?-Math.sqrt(-t):Math.sqrt(t)}function l(t){return t<0?-t*t:t*t}function u(t){var e=t(i.yR,i.yR),n=1;function s(){return 1===n?t(i.yR,i.yR):.5===n?t(a,l):t(o(n),o(1/n))}return e.exponent=function(t){return arguments.length?(n=+t,s()):n},(0,r.Q)(e)}function c(){var t=u((0,i.l4)());return t.copy=function(){return(0,i.JG)(t,c()).exponent(t.exponent())},s.o.apply(t,arguments),t}},73409:function(t,e,n){"use strict";function r(t){return function(){return this.matches(t)}}function i(t){return function(e){return e.matches(t)}}n.d(e,{P:function(){return i},Z:function(){return r}})},60021:function(t,e,n){"use strict";n.d(e,{Z:function(){return i}});var r=n(17110);function i(t){var e=t+="",n=e.indexOf(":");return n>=0&&"xmlns"!==(e=t.slice(0,n))&&(t=t.slice(n+1)),r.Z.hasOwnProperty(e)?{space:r.Z[e],local:t}:t}},17110:function(t,e,n){"use strict";n.d(e,{P:function(){return r}});var r="http://www.w3.org/1999/xhtml";e.Z={svg:"http://www.w3.org/2000/svg",xhtml:r,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"}},13802:function(t,e,n){"use strict";function r(t,e){if(t=function(t){let e;for(;e=t.sourceEvent;)t=e;return t}(t),void 0===e&&(e=t.currentTarget),e){var n=e.ownerSVGElement||e;if(n.createSVGPoint){var r=n.createSVGPoint();return r.x=t.clientX,r.y=t.clientY,[(r=r.matrixTransform(e.getScreenCTM().inverse())).x,r.y]}if(e.getBoundingClientRect){var i=e.getBoundingClientRect();return[t.clientX-i.left-e.clientLeft,t.clientY-i.top-e.clientTop]}}return[t.pageX,t.pageY]}n.d(e,{Z:function(){return r}})},41468:function(t,e,n){"use strict";n.d(e,{Z:function(){return i}});var r=n(1776);function i(t){return"string"==typeof t?new r.Y1([[document.querySelector(t)]],[document.documentElement]):new r.Y1([[t]],r.Jz)}},1776:function(t,e,n){"use strict";n.d(e,{Y1:function(){return lt},ZP:function(){return ct},Jz:function(){return at}});var r=n(66456);function i(t){return null==t?[]:Array.isArray(t)?t:Array.from(t)}var s=n(16851);var o=n(73409),a=Array.prototype.find;function l(){return this.firstElementChild}var u=Array.prototype.filter;function c(){return Array.from(this.children)}function h(t){return new Array(t.length)}function d(t,e){this.ownerDocument=t.ownerDocument,this.namespaceURI=t.namespaceURI,this._next=null,this._parent=t,this.__data__=e}function p(t){return function(){return t}}function f(t,e,n,r,i,s){for(var o,a=0,l=e.length,u=s.length;a<u;++a)(o=e[a])?(o.__data__=s[a],r[a]=o):n[a]=new d(t,s[a]);for(;a<l;++a)(o=e[a])&&(i[a]=o)}function m(t,e,n,r,i,s,o){var a,l,u,c=new Map,h=e.length,p=s.length,f=new Array(h);for(a=0;a<h;++a)(l=e[a])&&(f[a]=u=o.call(l,l.__data__,a,e)+"",c.has(u)?i[a]=l:c.set(u,l));for(a=0;a<p;++a)u=o.call(t,s[a],a,s)+"",(l=c.get(u))?(r[a]=l,l.__data__=s[a],c.delete(u)):n[a]=new d(t,s[a]);for(a=0;a<h;++a)(l=e[a])&&c.get(f[a])===l&&(i[a]=l)}function g(t){return t.__data__}function v(t){return"object"==typeof t&&"length"in t?t:Array.from(t)}function y(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}d.prototype={constructor:d,appendChild:function(t){return this._parent.insertBefore(t,this._next)},insertBefore:function(t,e){return this._parent.insertBefore(t,e)},querySelector:function(t){return this._parent.querySelector(t)},querySelectorAll:function(t){return this._parent.querySelectorAll(t)}};var _=n(60021);function x(t){return function(){this.removeAttribute(t)}}function b(t){return function(){this.removeAttributeNS(t.space,t.local)}}function w(t,e){return function(){this.setAttribute(t,e)}}function S(t,e){return function(){this.setAttributeNS(t.space,t.local,e)}}function M(t,e){return function(){var n=e.apply(this,arguments);null==n?this.removeAttribute(t):this.setAttribute(t,n)}}function E(t,e){return function(){var n=e.apply(this,arguments);null==n?this.removeAttributeNS(t.space,t.local):this.setAttributeNS(t.space,t.local,n)}}var T=n(77932);function A(t){return function(){delete this[t]}}function C(t,e){return function(){this[t]=e}}function R(t,e){return function(){var n=e.apply(this,arguments);null==n?delete this[t]:this[t]=n}}function N(t){return t.trim().split(/^|\s+/)}function P(t){return t.classList||new I(t)}function I(t){this._node=t,this._names=N(t.getAttribute("class")||"")}function O(t,e){for(var n=P(t),r=-1,i=e.length;++r<i;)n.add(e[r])}function D(t,e){for(var n=P(t),r=-1,i=e.length;++r<i;)n.remove(e[r])}function L(t){return function(){O(this,t)}}function U(t){return function(){D(this,t)}}function k(t,e){return function(){(e.apply(this,arguments)?O:D)(this,t)}}function B(){this.textContent=""}function F(t){return function(){this.textContent=t}}function z(t){return function(){var e=t.apply(this,arguments);this.textContent=null==e?"":e}}function V(){this.innerHTML=""}function G(t){return function(){this.innerHTML=t}}function j(t){return function(){var e=t.apply(this,arguments);this.innerHTML=null==e?"":e}}function H(){this.nextSibling&&this.parentNode.appendChild(this)}function W(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}I.prototype={add:function(t){this._names.indexOf(t)<0&&(this._names.push(t),this._node.setAttribute("class",this._names.join(" ")))},remove:function(t){var e=this._names.indexOf(t);e>=0&&(this._names.splice(e,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(t){return this._names.indexOf(t)>=0}};var q=n(17110);function X(t){return function(){var e=this.ownerDocument,n=this.namespaceURI;return n===q.P&&e.documentElement.namespaceURI===q.P?e.createElement(t):e.createElementNS(n,t)}}function Z(t){return function(){return this.ownerDocument.createElementNS(t.space,t.local)}}function $(t){var e=(0,_.Z)(t);return(e.local?Z:X)(e)}function Y(){return null}function K(){var t=this.parentNode;t&&t.removeChild(this)}function J(){var t=this.cloneNode(!1),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function Q(){var t=this.cloneNode(!0),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function tt(t){return t.trim().split(/^|\s+/).map((function(t){var e="",n=t.indexOf(".");return n>=0&&(e=t.slice(n+1),t=t.slice(0,n)),{type:t,name:e}}))}function et(t){return function(){var e=this.__on;if(e){for(var n,r=0,i=-1,s=e.length;r<s;++r)n=e[r],t.type&&n.type!==t.type||n.name!==t.name?e[++i]=n:this.removeEventListener(n.type,n.listener,n.options);++i?e.length=i:delete this.__on}}}function nt(t,e,n){return function(){var r,i=this.__on,s=function(t){return function(e){t.call(this,e,this.__data__)}}(e);if(i)for(var o=0,a=i.length;o<a;++o)if((r=i[o]).type===t.type&&r.name===t.name)return this.removeEventListener(r.type,r.listener,r.options),this.addEventListener(r.type,r.listener=s,r.options=n),void(r.value=e);this.addEventListener(t.type,s,n),r={type:t.type,name:t.name,value:e,listener:s,options:n},i?i.push(r):this.__on=[r]}}var rt=n(4010);function it(t,e,n){var r=(0,rt.Z)(t),i=r.CustomEvent;"function"==typeof i?i=new i(e,n):(i=r.document.createEvent("Event"),n?(i.initEvent(e,n.bubbles,n.cancelable),i.detail=n.detail):i.initEvent(e,!1,!1)),t.dispatchEvent(i)}function st(t,e){return function(){return it(this,t,e)}}function ot(t,e){return function(){return it(this,t,e.apply(this,arguments))}}var at=[null];function lt(t,e){this._groups=t,this._parents=e}function ut(){return new lt([[document.documentElement]],at)}lt.prototype=ut.prototype={constructor:lt,select:function(t){"function"!=typeof t&&(t=(0,r.Z)(t));for(var e=this._groups,n=e.length,i=new Array(n),s=0;s<n;++s)for(var o,a,l=e[s],u=l.length,c=i[s]=new Array(u),h=0;h<u;++h)(o=l[h])&&(a=t.call(o,o.__data__,h,l))&&("__data__"in o&&(a.__data__=o.__data__),c[h]=a);return new lt(i,this._parents)},selectAll:function(t){t="function"==typeof t?function(t){return function(){return i(t.apply(this,arguments))}}(t):(0,s.Z)(t);for(var e=this._groups,n=e.length,r=[],o=[],a=0;a<n;++a)for(var l,u=e[a],c=u.length,h=0;h<c;++h)(l=u[h])&&(r.push(t.call(l,l.__data__,h,u)),o.push(l));return new lt(r,o)},selectChild:function(t){return this.select(null==t?l:function(t){return function(){return a.call(this.children,t)}}("function"==typeof t?t:(0,o.P)(t)))},selectChildren:function(t){return this.selectAll(null==t?c:function(t){return function(){return u.call(this.children,t)}}("function"==typeof t?t:(0,o.P)(t)))},filter:function(t){"function"!=typeof t&&(t=(0,o.Z)(t));for(var e=this._groups,n=e.length,r=new Array(n),i=0;i<n;++i)for(var s,a=e[i],l=a.length,u=r[i]=[],c=0;c<l;++c)(s=a[c])&&t.call(s,s.__data__,c,a)&&u.push(s);return new lt(r,this._parents)},data:function(t,e){if(!arguments.length)return Array.from(this,g);var n=e?m:f,r=this._parents,i=this._groups;"function"!=typeof t&&(t=p(t));for(var s=i.length,o=new Array(s),a=new Array(s),l=new Array(s),u=0;u<s;++u){var c=r[u],h=i[u],d=h.length,y=v(t.call(c,c&&c.__data__,u,r)),_=y.length,x=a[u]=new Array(_),b=o[u]=new Array(_),w=l[u]=new Array(d);n(c,h,x,b,w,y,e);for(var S,M,E=0,T=0;E<_;++E)if(S=x[E]){for(E>=T&&(T=E+1);!(M=b[T])&&++T<_;);S._next=M||null}}return(o=new lt(o,r))._enter=a,o._exit=l,o},enter:function(){return new lt(this._enter||this._groups.map(h),this._parents)},exit:function(){return new lt(this._exit||this._groups.map(h),this._parents)},join:function(t,e,n){var r=this.enter(),i=this,s=this.exit();return"function"==typeof t?(r=t(r))&&(r=r.selection()):r=r.append(t+""),null!=e&&(i=e(i))&&(i=i.selection()),null==n?s.remove():n(s),r&&i?r.merge(i).order():i},merge:function(t){for(var e=t.selection?t.selection():t,n=this._groups,r=e._groups,i=n.length,s=r.length,o=Math.min(i,s),a=new Array(i),l=0;l<o;++l)for(var u,c=n[l],h=r[l],d=c.length,p=a[l]=new Array(d),f=0;f<d;++f)(u=c[f]||h[f])&&(p[f]=u);for(;l<i;++l)a[l]=n[l];return new lt(a,this._parents)},selection:function(){return this},order:function(){for(var t=this._groups,e=-1,n=t.length;++e<n;)for(var r,i=t[e],s=i.length-1,o=i[s];--s>=0;)(r=i[s])&&(o&&4^r.compareDocumentPosition(o)&&o.parentNode.insertBefore(r,o),o=r);return this},sort:function(t){function e(e,n){return e&&n?t(e.__data__,n.__data__):!e-!n}t||(t=y);for(var n=this._groups,r=n.length,i=new Array(r),s=0;s<r;++s){for(var o,a=n[s],l=a.length,u=i[s]=new Array(l),c=0;c<l;++c)(o=a[c])&&(u[c]=o);u.sort(e)}return new lt(i,this._parents).order()},call:function(){var t=arguments[0];return arguments[0]=this,t.apply(null,arguments),this},nodes:function(){return Array.from(this)},node:function(){for(var t=this._groups,e=0,n=t.length;e<n;++e)for(var r=t[e],i=0,s=r.length;i<s;++i){var o=r[i];if(o)return o}return null},size:function(){let t=0;for(const e of this)++t;return t},empty:function(){return!this.node()},each:function(t){for(var e=this._groups,n=0,r=e.length;n<r;++n)for(var i,s=e[n],o=0,a=s.length;o<a;++o)(i=s[o])&&t.call(i,i.__data__,o,s);return this},attr:function(t,e){var n=(0,_.Z)(t);if(arguments.length<2){var r=this.node();return n.local?r.getAttributeNS(n.space,n.local):r.getAttribute(n)}return this.each((null==e?n.local?b:x:"function"==typeof e?n.local?E:M:n.local?S:w)(n,e))},style:T.Z,property:function(t,e){return arguments.length>1?this.each((null==e?A:"function"==typeof e?R:C)(t,e)):this.node()[t]},classed:function(t,e){var n=N(t+"");if(arguments.length<2){for(var r=P(this.node()),i=-1,s=n.length;++i<s;)if(!r.contains(n[i]))return!1;return!0}return this.each(("function"==typeof e?k:e?L:U)(n,e))},text:function(t){return arguments.length?this.each(null==t?B:("function"==typeof t?z:F)(t)):this.node().textContent},html:function(t){return arguments.length?this.each(null==t?V:("function"==typeof t?j:G)(t)):this.node().innerHTML},raise:function(){return this.each(H)},lower:function(){return this.each(W)},append:function(t){var e="function"==typeof t?t:$(t);return this.select((function(){return this.appendChild(e.apply(this,arguments))}))},insert:function(t,e){var n="function"==typeof t?t:$(t),i=null==e?Y:"function"==typeof e?e:(0,r.Z)(e);return this.select((function(){return this.insertBefore(n.apply(this,arguments),i.apply(this,arguments)||null)}))},remove:function(){return this.each(K)},clone:function(t){return this.select(t?Q:J)},datum:function(t){return arguments.length?this.property("__data__",t):this.node().__data__},on:function(t,e,n){var r,i,s=tt(t+""),o=s.length;if(!(arguments.length<2)){for(a=e?nt:et,r=0;r<o;++r)this.each(a(s[r],e,n));return this}var a=this.node().__on;if(a)for(var l,u=0,c=a.length;u<c;++u)for(r=0,l=a[u];r<o;++r)if((i=s[r]).type===l.type&&i.name===l.name)return l.value},dispatch:function(t,e){return this.each(("function"==typeof e?ot:st)(t,e))},[Symbol.iterator]:function*(){for(var t=this._groups,e=0,n=t.length;e<n;++e)for(var r,i=t[e],s=0,o=i.length;s<o;++s)(r=i[s])&&(yield r)}};var ct=ut},77932:function(t,e,n){"use strict";n.d(e,{S:function(){return l},Z:function(){return a}});var r=n(4010);function i(t){return function(){this.style.removeProperty(t)}}function s(t,e,n){return function(){this.style.setProperty(t,e,n)}}function o(t,e,n){return function(){var r=e.apply(this,arguments);null==r?this.style.removeProperty(t):this.style.setProperty(t,r,n)}}function a(t,e,n){return arguments.length>1?this.each((null==e?i:"function"==typeof e?o:s)(t,e,null==n?"":n)):l(this.node(),t)}function l(t,e){return t.style.getPropertyValue(e)||(0,r.Z)(t).getComputedStyle(t,null).getPropertyValue(e)}},66456:function(t,e,n){"use strict";function r(){}function i(t){return null==t?r:function(){return this.querySelector(t)}}n.d(e,{Z:function(){return i}})},16851:function(t,e,n){"use strict";function r(){return[]}function i(t){return null==t?r:function(){return this.querySelectorAll(t)}}n.d(e,{Z:function(){return i}})},4010:function(t,e,n){"use strict";function r(t){return t.ownerDocument&&t.ownerDocument.defaultView||t.document&&t||t.defaultView}n.d(e,{Z:function(){return r}})},83249:function(t,e,n){"use strict";n.d(e,{B7:function(){return m},HT:function(){return g},zO:function(){return p}});var r,i,s=0,o=0,a=0,l=0,u=0,c=0,h="object"==typeof performance&&performance.now?performance:Date,d="object"==typeof window&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(t){setTimeout(t,17)};function p(){return u||(d(f),u=h.now()+c)}function f(){u=0}function m(){this._call=this._time=this._next=null}function g(t,e,n){var r=new m;return r.restart(t,e,n),r}function v(){u=(l=h.now())+c,s=o=0;try{!function(){p(),++s;for(var t,e=r;e;)(t=u-e._time)>=0&&e._call.call(void 0,t),e=e._next;--s}()}finally{s=0,function(){var t,e,n=r,s=1/0;for(;n;)n._call?(s>n._time&&(s=n._time),t=n,n=n._next):(e=n._next,n._next=null,n=t?t._next=e:r=e);i=t,_(s)}(),u=0}}function y(){var t=h.now(),e=t-l;e>1e3&&(c-=e,l=t)}function _(t){s||(o&&(o=clearTimeout(o)),t-u>24?(t<1/0&&(o=setTimeout(v,t-h.now()-c)),a&&(a=clearInterval(a))):(a||(l=h.now(),a=setInterval(y,1e3)),s=1,d(v)))}m.prototype=g.prototype={constructor:m,restart:function(t,e,n){if("function"!=typeof t)throw new TypeError("callback is not a function");n=(null==n?p():+n)+(null==e?0:+e),this._next||i===this||(i?i._next=this:r=this,i=this),this._call=t,this._time=n,_()},stop:function(){this._call&&(this._call=null,this._time=1/0,_())}}},21063:function(t,e,n){"use strict";n.d(e,{e1:function(){return p}});var r=n(1776),i=n(32436),s=n(83249);function o(t,e,n){var r=new s.B7;return e=null==e?0:+e,r.restart((n=>{r.stop(),t(n+e)}),e,n),r}var a=(0,i.Z)("start","end","cancel","interrupt"),l=[];function u(t,e,n,r,i,u){var c=t.__transition;if(c){if(n in c)return}else t.__transition={};!function(t,e,n){var r,i=t.__transition;function a(t){n.state=1,n.timer.restart(l,n.delay,n.time),n.delay<=t&&l(t-n.delay)}function l(s){var a,h,d,p;if(1!==n.state)return c();for(a in i)if((p=i[a]).name===n.name){if(3===p.state)return o(l);4===p.state?(p.state=6,p.timer.stop(),p.on.call("interrupt",t,t.__data__,p.index,p.group),delete i[a]):+a<e&&(p.state=6,p.timer.stop(),p.on.call("cancel",t,t.__data__,p.index,p.group),delete i[a])}if(o((function(){3===n.state&&(n.state=4,n.timer.restart(u,n.delay,n.time),u(s))})),n.state=2,n.on.call("start",t,t.__data__,n.index,n.group),2===n.state){for(n.state=3,r=new Array(d=n.tween.length),a=0,h=-1;a<d;++a)(p=n.tween[a].value.call(t,t.__data__,n.index,n.group))&&(r[++h]=p);r.length=h+1}}function u(e){for(var i=e<n.duration?n.ease.call(null,e/n.duration):(n.timer.restart(c),n.state=5,1),s=-1,o=r.length;++s<o;)r[s].call(t,i);5===n.state&&(n.on.call("end",t,t.__data__,n.index,n.group),c())}function c(){for(var r in n.state=6,n.timer.stop(),delete i[e],i)return;delete t.__transition}i[e]=n,n.timer=(0,s.HT)(a,0,n.time)}(t,n,{name:e,index:r,group:i,on:a,tween:l,time:u.time,delay:u.delay,duration:u.duration,ease:u.ease,timer:null,state:0})}function c(t,e){var n=d(t,e);if(n.state>0)throw new Error("too late; already scheduled");return n}function h(t,e){var n=d(t,e);if(n.state>3)throw new Error("too late; already running");return n}function d(t,e){var n=t.__transition;if(!n||!(n=n[e]))throw new Error("transition not found");return n}function p(t,e){var n,r,i,s=t.__transition,o=!0;if(s){for(i in e=null==e?null:e+"",s)(n=s[i]).name===e?(r=n.state>2&&n.state<5,n.state=6,n.timer.stop(),n.on.call(r?"interrupt":"cancel",t,t.__data__,n.index,n.group),delete s[i]):o=!1;o&&delete t.__transition}}var f,m=n(88486),g=180/Math.PI,v={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function y(t,e,n,r,i,s){var o,a,l;return(o=Math.sqrt(t*t+e*e))&&(t/=o,e/=o),(l=t*n+e*r)&&(n-=t*l,r-=e*l),(a=Math.sqrt(n*n+r*r))&&(n/=a,r/=a,l/=a),t*r<e*n&&(t=-t,e=-e,l=-l,o=-o),{translateX:i,translateY:s,rotate:Math.atan2(e,t)*g,skewX:Math.atan(l)*g,scaleX:o,scaleY:a}}function _(t,e,n,r){function i(t){return t.length?t.pop()+" ":""}return function(s,o){var a=[],l=[];return s=t(s),o=t(o),function(t,r,i,s,o,a){if(t!==i||r!==s){var l=o.push("translate(",null,e,null,n);a.push({i:l-4,x:(0,m.Z)(t,i)},{i:l-2,x:(0,m.Z)(r,s)})}else(i||s)&&o.push("translate("+i+e+s+n)}(s.translateX,s.translateY,o.translateX,o.translateY,a,l),function(t,e,n,s){t!==e?(t-e>180?e+=360:e-t>180&&(t+=360),s.push({i:n.push(i(n)+"rotate(",null,r)-2,x:(0,m.Z)(t,e)})):e&&n.push(i(n)+"rotate("+e+r)}(s.rotate,o.rotate,a,l),function(t,e,n,s){t!==e?s.push({i:n.push(i(n)+"skewX(",null,r)-2,x:(0,m.Z)(t,e)}):e&&n.push(i(n)+"skewX("+e+r)}(s.skewX,o.skewX,a,l),function(t,e,n,r,s,o){if(t!==n||e!==r){var a=s.push(i(s)+"scale(",null,",",null,")");o.push({i:a-4,x:(0,m.Z)(t,n)},{i:a-2,x:(0,m.Z)(e,r)})}else 1===n&&1===r||s.push(i(s)+"scale("+n+","+r+")")}(s.scaleX,s.scaleY,o.scaleX,o.scaleY,a,l),s=o=null,function(t){for(var e,n=-1,r=l.length;++n<r;)a[(e=l[n]).i]=e.x(t);return a.join("")}}}var x=_((function(t){var e=new("function"==typeof DOMMatrix?DOMMatrix:WebKitCSSMatrix)(t+"");return e.isIdentity?v:y(e.a,e.b,e.c,e.d,e.e,e.f)}),"px, ","px)","deg)"),b=_((function(t){return null==t?v:(f||(f=document.createElementNS("http://www.w3.org/2000/svg","g")),f.setAttribute("transform",t),(t=f.transform.baseVal.consolidate())?y((t=t.matrix).a,t.b,t.c,t.d,t.e,t.f):v)}),", ",")",")"),w=n(60021);function S(t,e){var n,r;return function(){var i=h(this,t),s=i.tween;if(s!==n)for(var o=0,a=(r=n=s).length;o<a;++o)if(r[o].name===e){(r=r.slice()).splice(o,1);break}i.tween=r}}function M(t,e,n){var r,i;if("function"!=typeof n)throw new Error;return function(){var s=h(this,t),o=s.tween;if(o!==r){i=(r=o).slice();for(var a={name:e,value:n},l=0,u=i.length;l<u;++l)if(i[l].name===e){i[l]=a;break}l===u&&i.push(a)}s.tween=i}}function E(t,e,n){var r=t._id;return t.each((function(){var t=h(this,r);(t.value||(t.value={}))[e]=n.apply(this,arguments)})),function(t){return d(t,r).value[e]}}var T=n(88681),A=n(45106),C=n(28685);function R(t,e){var n;return("number"==typeof e?m.Z:e instanceof T.ZP?A.ZP:(n=(0,T.ZP)(e))?(e=n,A.ZP):C.Z)(t,e)}function N(t){return function(){this.removeAttribute(t)}}function P(t){return function(){this.removeAttributeNS(t.space,t.local)}}function I(t,e,n){var r,i,s=n+"";return function(){var o=this.getAttribute(t);return o===s?null:o===r?i:i=e(r=o,n)}}function O(t,e,n){var r,i,s=n+"";return function(){var o=this.getAttributeNS(t.space,t.local);return o===s?null:o===r?i:i=e(r=o,n)}}function D(t,e,n){var r,i,s;return function(){var o,a,l=n(this);if(null!=l)return(o=this.getAttribute(t))===(a=l+"")?null:o===r&&a===i?s:(i=a,s=e(r=o,l));this.removeAttribute(t)}}function L(t,e,n){var r,i,s;return function(){var o,a,l=n(this);if(null!=l)return(o=this.getAttributeNS(t.space,t.local))===(a=l+"")?null:o===r&&a===i?s:(i=a,s=e(r=o,l));this.removeAttributeNS(t.space,t.local)}}function U(t,e){return function(n){this.setAttribute(t,e.call(this,n))}}function k(t,e){return function(n){this.setAttributeNS(t.space,t.local,e.call(this,n))}}function B(t,e){var n,r;function i(){var i=e.apply(this,arguments);return i!==r&&(n=(r=i)&&k(t,i)),n}return i._value=e,i}function F(t,e){var n,r;function i(){var i=e.apply(this,arguments);return i!==r&&(n=(r=i)&&U(t,i)),n}return i._value=e,i}function z(t,e){return function(){c(this,t).delay=+e.apply(this,arguments)}}function V(t,e){return e=+e,function(){c(this,t).delay=e}}function G(t,e){return function(){h(this,t).duration=+e.apply(this,arguments)}}function j(t,e){return e=+e,function(){h(this,t).duration=e}}function H(t,e){if("function"!=typeof e)throw new Error;return function(){h(this,t).ease=e}}var W=n(73409);function q(t,e,n){var r,i,s=function(t){return(t+"").trim().split(/^|\s+/).every((function(t){var e=t.indexOf(".");return e>=0&&(t=t.slice(0,e)),!t||"start"===t}))}(e)?c:h;return function(){var o=s(this,t),a=o.on;a!==r&&(i=(r=a).copy()).on(e,n),o.on=i}}var X=n(66456);var Z=n(16851);var $=r.ZP.prototype.constructor;var Y=n(77932);function K(t){return function(){this.style.removeProperty(t)}}function J(t,e,n){return function(r){this.style.setProperty(t,e.call(this,r),n)}}function Q(t,e,n){var r,i;function s(){var s=e.apply(this,arguments);return s!==i&&(r=(i=s)&&J(t,s,n)),r}return s._value=e,s}function tt(t){return function(e){this.textContent=t.call(this,e)}}function et(t){var e,n;function r(){var r=t.apply(this,arguments);return r!==n&&(e=(n=r)&&tt(r)),e}return r._value=t,r}var nt=0;function rt(t,e,n,r){this._groups=t,this._parents=e,this._name=n,this._id=r}function it(){return++nt}var st=r.ZP.prototype;rt.prototype=function(t){return(0,r.ZP)().transition(t)}.prototype={constructor:rt,select:function(t){var e=this._name,n=this._id;"function"!=typeof t&&(t=(0,X.Z)(t));for(var r=this._groups,i=r.length,s=new Array(i),o=0;o<i;++o)for(var a,l,c=r[o],h=c.length,p=s[o]=new Array(h),f=0;f<h;++f)(a=c[f])&&(l=t.call(a,a.__data__,f,c))&&("__data__"in a&&(l.__data__=a.__data__),p[f]=l,u(p[f],e,n,f,p,d(a,n)));return new rt(s,this._parents,e,n)},selectAll:function(t){var e=this._name,n=this._id;"function"!=typeof t&&(t=(0,Z.Z)(t));for(var r=this._groups,i=r.length,s=[],o=[],a=0;a<i;++a)for(var l,c=r[a],h=c.length,p=0;p<h;++p)if(l=c[p]){for(var f,m=t.call(l,l.__data__,p,c),g=d(l,n),v=0,y=m.length;v<y;++v)(f=m[v])&&u(f,e,n,v,m,g);s.push(m),o.push(l)}return new rt(s,o,e,n)},selectChild:st.selectChild,selectChildren:st.selectChildren,filter:function(t){"function"!=typeof t&&(t=(0,W.Z)(t));for(var e=this._groups,n=e.length,r=new Array(n),i=0;i<n;++i)for(var s,o=e[i],a=o.length,l=r[i]=[],u=0;u<a;++u)(s=o[u])&&t.call(s,s.__data__,u,o)&&l.push(s);return new rt(r,this._parents,this._name,this._id)},merge:function(t){if(t._id!==this._id)throw new Error;for(var e=this._groups,n=t._groups,r=e.length,i=n.length,s=Math.min(r,i),o=new Array(r),a=0;a<s;++a)for(var l,u=e[a],c=n[a],h=u.length,d=o[a]=new Array(h),p=0;p<h;++p)(l=u[p]||c[p])&&(d[p]=l);for(;a<r;++a)o[a]=e[a];return new rt(o,this._parents,this._name,this._id)},selection:function(){return new $(this._groups,this._parents)},transition:function(){for(var t=this._name,e=this._id,n=it(),r=this._groups,i=r.length,s=0;s<i;++s)for(var o,a=r[s],l=a.length,c=0;c<l;++c)if(o=a[c]){var h=d(o,e);u(o,t,n,c,a,{time:h.time+h.delay+h.duration,delay:0,duration:h.duration,ease:h.ease})}return new rt(r,this._parents,t,n)},call:st.call,nodes:st.nodes,node:st.node,size:st.size,empty:st.empty,each:st.each,on:function(t,e){var n=this._id;return arguments.length<2?d(this.node(),n).on.on(t):this.each(q(n,t,e))},attr:function(t,e){var n=(0,w.Z)(t),r="transform"===n?b:R;return this.attrTween(t,"function"==typeof e?(n.local?L:D)(n,r,E(this,"attr."+t,e)):null==e?(n.local?P:N)(n):(n.local?O:I)(n,r,e))},attrTween:function(t,e){var n="attr."+t;if(arguments.length<2)return(n=this.tween(n))&&n._value;if(null==e)return this.tween(n,null);if("function"!=typeof e)throw new Error;var r=(0,w.Z)(t);return this.tween(n,(r.local?B:F)(r,e))},style:function(t,e,n){var r="transform"==(t+="")?x:R;return null==e?this.styleTween(t,function(t,e){var n,r,i;return function(){var s=(0,Y.S)(this,t),o=(this.style.removeProperty(t),(0,Y.S)(this,t));return s===o?null:s===n&&o===r?i:i=e(n=s,r=o)}}(t,r)).on("end.style."+t,K(t)):"function"==typeof e?this.styleTween(t,function(t,e,n){var r,i,s;return function(){var o=(0,Y.S)(this,t),a=n(this),l=a+"";return null==a&&(this.style.removeProperty(t),l=a=(0,Y.S)(this,t)),o===l?null:o===r&&l===i?s:(i=l,s=e(r=o,a))}}(t,r,E(this,"style."+t,e))).each(function(t,e){var n,r,i,s,o="style."+e,a="end."+o;return function(){var l=h(this,t),u=l.on,c=null==l.value[o]?s||(s=K(e)):void 0;u===n&&i===c||(r=(n=u).copy()).on(a,i=c),l.on=r}}(this._id,t)):this.styleTween(t,function(t,e,n){var r,i,s=n+"";return function(){var o=(0,Y.S)(this,t);return o===s?null:o===r?i:i=e(r=o,n)}}(t,r,e),n).on("end.style."+t,null)},styleTween:function(t,e,n){var r="style."+(t+="");if(arguments.length<2)return(r=this.tween(r))&&r._value;if(null==e)return this.tween(r,null);if("function"!=typeof e)throw new Error;return this.tween(r,Q(t,e,null==n?"":n))},text:function(t){return this.tween("text","function"==typeof t?function(t){return function(){var e=t(this);this.textContent=null==e?"":e}}(E(this,"text",t)):function(t){return function(){this.textContent=t}}(null==t?"":t+""))},textTween:function(t){var e="text";if(arguments.length<1)return(e=this.tween(e))&&e._value;if(null==t)return this.tween(e,null);if("function"!=typeof t)throw new Error;return this.tween(e,et(t))},remove:function(){return this.on("end.remove",function(t){return function(){var e=this.parentNode;for(var n in this.__transition)if(+n!==t)return;e&&e.removeChild(this)}}(this._id))},tween:function(t,e){var n=this._id;if(t+="",arguments.length<2){for(var r,i=d(this.node(),n).tween,s=0,o=i.length;s<o;++s)if((r=i[s]).name===t)return r.value;return null}return this.each((null==e?S:M)(n,t,e))},delay:function(t){var e=this._id;return arguments.length?this.each(("function"==typeof t?z:V)(e,t)):d(this.node(),e).delay},duration:function(t){var e=this._id;return arguments.length?this.each(("function"==typeof t?G:j)(e,t)):d(this.node(),e).duration},ease:function(t){var e=this._id;return arguments.length?this.each(H(e,t)):d(this.node(),e).ease},easeVarying:function(t){if("function"!=typeof t)throw new Error;return this.each(function(t,e){return function(){var n=e.apply(this,arguments);if("function"!=typeof n)throw new Error;h(this,t).ease=n}}(this._id,t))},end:function(){var t,e,n=this,r=n._id,i=n.size();return new Promise((function(s,o){var a={value:o},l={value:function(){0==--i&&s()}};n.each((function(){var n=h(this,r),i=n.on;i!==t&&((e=(t=i).copy())._.cancel.push(a),e._.interrupt.push(a),e._.end.push(l)),n.on=e})),0===i&&s()}))},[Symbol.iterator]:st[Symbol.iterator]};var ot={time:null,delay:0,duration:250,ease:function(t){return((t*=2)<=1?t*t*t:(t-=2)*t*t+2)/2}};function at(t,e){for(var n;!(n=t.__transition)||!(n=n[e]);)if(!(t=t.parentNode))throw new Error(`transition ${e} not found`);return n}r.ZP.prototype.interrupt=function(t){return this.each((function(){p(this,t)}))},r.ZP.prototype.transition=function(t){var e,n;t instanceof rt?(e=t._id,t=t._name):(e=it(),(n=ot).time=(0,s.zO)(),t=null==t?null:t+"");for(var r=this._groups,i=r.length,o=0;o<i;++o)for(var a,l=r[o],c=l.length,h=0;h<c;++h)(a=l[h])&&u(a,t,e,h,l,n||at(a,e));return new rt(r,this._parents,t,e)}},89888:function(t,e,n){"use strict";n.d(e,{sP:function(){return S},CR:function(){return p},P2:function(){return f}});var r=n(32436),i=n(49289);function s(t){return((t=Math.exp(t))+1/t)/2}var o=function t(e,n,r){function i(t,i){var o,a,l=t[0],u=t[1],c=t[2],h=i[0],d=i[1],p=i[2],f=h-l,m=d-u,g=f*f+m*m;if(g<1e-12)a=Math.log(p/c)/e,o=function(t){return[l+t*f,u+t*m,c*Math.exp(e*t*a)]};else{var v=Math.sqrt(g),y=(p*p-c*c+r*g)/(2*c*n*v),_=(p*p-c*c-r*g)/(2*p*n*v),x=Math.log(Math.sqrt(y*y+1)-y),b=Math.log(Math.sqrt(_*_+1)-_);a=(b-x)/e,o=function(t){var r,i=t*a,o=s(x),h=c/(n*v)*(o*(r=e*i+x,((r=Math.exp(2*r))-1)/(r+1))-function(t){return((t=Math.exp(t))-1/t)/2}(x));return[l+h*f,u+h*m,c*o/s(e*i+x)]}}return o.duration=1e3*a*e/Math.SQRT2,o}return i.rho=function(e){var n=Math.max(.001,+e),r=n*n;return t(n,r,r*r)},i}(Math.SQRT2,2,4),a=n(41468),l=n(13802),u=n(21063),c=t=>()=>t;function h(t,{sourceEvent:e,target:n,transform:r,dispatch:i}){Object.defineProperties(this,{type:{value:t,enumerable:!0,configurable:!0},sourceEvent:{value:e,enumerable:!0,configurable:!0},target:{value:n,enumerable:!0,configurable:!0},transform:{value:r,enumerable:!0,configurable:!0},_:{value:i}})}function d(t,e,n){this.k=t,this.x=e,this.y=n}d.prototype={constructor:d,scale:function(t){return 1===t?this:new d(this.k*t,this.x,this.y)},translate:function(t,e){return 0===t&0===e?this:new d(this.k,this.x+this.k*t,this.y+this.k*e)},apply:function(t){return[t[0]*this.k+this.x,t[1]*this.k+this.y]},applyX:function(t){return t*this.k+this.x},applyY:function(t){return t*this.k+this.y},invert:function(t){return[(t[0]-this.x)/this.k,(t[1]-this.y)/this.k]},invertX:function(t){return(t-this.x)/this.k},invertY:function(t){return(t-this.y)/this.k},rescaleX:function(t){return t.copy().domain(t.range().map(this.invertX,this).map(t.invert,t))},rescaleY:function(t){return t.copy().domain(t.range().map(this.invertY,this).map(t.invert,t))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};var p=new d(1,0,0);function f(t){for(;!t.__zoom;)if(!(t=t.parentNode))return p;return t.__zoom}function m(t){t.stopImmediatePropagation()}function g(t){t.preventDefault(),t.stopImmediatePropagation()}function v(t){return!(t.ctrlKey&&"wheel"!==t.type||t.button)}function y(){var t=this;return t instanceof SVGElement?(t=t.ownerSVGElement||t).hasAttribute("viewBox")?[[(t=t.viewBox.baseVal).x,t.y],[t.x+t.width,t.y+t.height]]:[[0,0],[t.width.baseVal.value,t.height.baseVal.value]]:[[0,0],[t.clientWidth,t.clientHeight]]}function _(){return this.__zoom||p}function x(t){return-t.deltaY*(1===t.deltaMode?.05:t.deltaMode?1:.002)*(t.ctrlKey?10:1)}function b(){return navigator.maxTouchPoints||"ontouchstart"in this}function w(t,e,n){var r=t.invertX(e[0][0])-n[0][0],i=t.invertX(e[1][0])-n[1][0],s=t.invertY(e[0][1])-n[0][1],o=t.invertY(e[1][1])-n[1][1];return t.translate(i>r?(r+i)/2:Math.min(0,r)||Math.max(0,i),o>s?(s+o)/2:Math.min(0,s)||Math.max(0,o))}function S(){var t,e,n,s=v,f=y,S=w,M=x,E=b,T=[0,1/0],A=[[-1/0,-1/0],[1/0,1/0]],C=250,R=o,N=(0,r.Z)("start","zoom","end"),P=500,I=0,O=10;function D(t){t.property("__zoom",_).on("wheel.zoom",V,{passive:!1}).on("mousedown.zoom",G).on("dblclick.zoom",j).filter(E).on("touchstart.zoom",H).on("touchmove.zoom",W).on("touchend.zoom touchcancel.zoom",q).style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function L(t,e){return(e=Math.max(T[0],Math.min(T[1],e)))===t.k?t:new d(e,t.x,t.y)}function U(t,e,n){var r=e[0]-n[0]*t.k,i=e[1]-n[1]*t.k;return r===t.x&&i===t.y?t:new d(t.k,r,i)}function k(t){return[(+t[0][0]+ +t[1][0])/2,(+t[0][1]+ +t[1][1])/2]}function B(t,e,n,r){t.on("start.zoom",(function(){F(this,arguments).event(r).start()})).on("interrupt.zoom end.zoom",(function(){F(this,arguments).event(r).end()})).tween("zoom",(function(){var t=this,i=arguments,s=F(t,i).event(r),o=f.apply(t,i),a=null==n?k(o):"function"==typeof n?n.apply(t,i):n,l=Math.max(o[1][0]-o[0][0],o[1][1]-o[0][1]),u=t.__zoom,c="function"==typeof e?e.apply(t,i):e,h=R(u.invert(a).concat(l/u.k),c.invert(a).concat(l/c.k));return function(t){if(1===t)t=c;else{var e=h(t),n=l/e[2];t=new d(n,a[0]-e[0]*n,a[1]-e[1]*n)}s.zoom(null,t)}}))}function F(t,e,n){return!n&&t.__zooming||new z(t,e)}function z(t,e){this.that=t,this.args=e,this.active=0,this.sourceEvent=null,this.extent=f.apply(t,e),this.taps=0}function V(t,...e){if(s.apply(this,arguments)){var n=F(this,e).event(t),r=this.__zoom,i=Math.max(T[0],Math.min(T[1],r.k*Math.pow(2,M.apply(this,arguments)))),o=(0,l.Z)(t);if(n.wheel)n.mouse[0][0]===o[0]&&n.mouse[0][1]===o[1]||(n.mouse[1]=r.invert(n.mouse[0]=o)),clearTimeout(n.wheel);else{if(r.k===i)return;n.mouse=[o,r.invert(o)],(0,u.e1)(this),n.start()}g(t),n.wheel=setTimeout(a,150),n.zoom("mouse",S(U(L(r,i),n.mouse[0],n.mouse[1]),n.extent,A))}function a(){n.wheel=null,n.end()}}function G(t,...e){if(!n&&s.apply(this,arguments)){var r=t.currentTarget,o=F(this,e,!0).event(t),c=(0,a.Z)(t.view).on("mousemove.zoom",f,!0).on("mouseup.zoom",v,!0),h=(0,l.Z)(t,r),d=t.clientX,p=t.clientY;(0,i.Z)(t.view),m(t),o.mouse=[h,this.__zoom.invert(h)],(0,u.e1)(this),o.start()}function f(t){if(g(t),!o.moved){var e=t.clientX-d,n=t.clientY-p;o.moved=e*e+n*n>I}o.event(t).zoom("mouse",S(U(o.that.__zoom,o.mouse[0]=(0,l.Z)(t,r),o.mouse[1]),o.extent,A))}function v(t){c.on("mousemove.zoom mouseup.zoom",null),(0,i.D)(t.view,o.moved),g(t),o.event(t).end()}}function j(t,...e){if(s.apply(this,arguments)){var n=this.__zoom,r=(0,l.Z)(t.changedTouches?t.changedTouches[0]:t,this),i=n.invert(r),o=n.k*(t.shiftKey?.5:2),u=S(U(L(n,o),r,i),f.apply(this,e),A);g(t),C>0?(0,a.Z)(this).transition().duration(C).call(B,u,r,t):(0,a.Z)(this).call(D.transform,u,r,t)}}function H(n,...r){if(s.apply(this,arguments)){var i,o,a,c,h=n.touches,d=h.length,p=F(this,r,n.changedTouches.length===d).event(n);for(m(n),o=0;o<d;++o)a=h[o],c=[c=(0,l.Z)(a,this),this.__zoom.invert(c),a.identifier],p.touch0?p.touch1||p.touch0[2]===c[2]||(p.touch1=c,p.taps=0):(p.touch0=c,i=!0,p.taps=1+!!t);t&&(t=clearTimeout(t)),i&&(p.taps<2&&(e=c[0],t=setTimeout((function(){t=null}),P)),(0,u.e1)(this),p.start())}}function W(t,...e){if(this.__zooming){var n,r,i,s,o=F(this,e).event(t),a=t.changedTouches,u=a.length;for(g(t),n=0;n<u;++n)r=a[n],i=(0,l.Z)(r,this),o.touch0&&o.touch0[2]===r.identifier?o.touch0[0]=i:o.touch1&&o.touch1[2]===r.identifier&&(o.touch1[0]=i);if(r=o.that.__zoom,o.touch1){var c=o.touch0[0],h=o.touch0[1],d=o.touch1[0],p=o.touch1[1],f=(f=d[0]-c[0])*f+(f=d[1]-c[1])*f,m=(m=p[0]-h[0])*m+(m=p[1]-h[1])*m;r=L(r,Math.sqrt(f/m)),i=[(c[0]+d[0])/2,(c[1]+d[1])/2],s=[(h[0]+p[0])/2,(h[1]+p[1])/2]}else{if(!o.touch0)return;i=o.touch0[0],s=o.touch0[1]}o.zoom("touch",S(U(r,i,s),o.extent,A))}}function q(t,...r){if(this.__zooming){var i,s,o=F(this,r).event(t),u=t.changedTouches,c=u.length;for(m(t),n&&clearTimeout(n),n=setTimeout((function(){n=null}),P),i=0;i<c;++i)s=u[i],o.touch0&&o.touch0[2]===s.identifier?delete o.touch0:o.touch1&&o.touch1[2]===s.identifier&&delete o.touch1;if(o.touch1&&!o.touch0&&(o.touch0=o.touch1,delete o.touch1),o.touch0)o.touch0[1]=this.__zoom.invert(o.touch0[0]);else if(o.end(),2===o.taps&&(s=(0,l.Z)(s,this),Math.hypot(e[0]-s[0],e[1]-s[1])<O)){var h=(0,a.Z)(this).on("dblclick.zoom");h&&h.apply(this,arguments)}}}return D.transform=function(t,e,n,r){var i=t.selection?t.selection():t;i.property("__zoom",_),t!==i?B(t,e,n,r):i.interrupt().each((function(){F(this,arguments).event(r).start().zoom(null,"function"==typeof e?e.apply(this,arguments):e).end()}))},D.scaleBy=function(t,e,n,r){D.scaleTo(t,(function(){var t=this.__zoom.k,n="function"==typeof e?e.apply(this,arguments):e;return t*n}),n,r)},D.scaleTo=function(t,e,n,r){D.transform(t,(function(){var t=f.apply(this,arguments),r=this.__zoom,i=null==n?k(t):"function"==typeof n?n.apply(this,arguments):n,s=r.invert(i),o="function"==typeof e?e.apply(this,arguments):e;return S(U(L(r,o),i,s),t,A)}),n,r)},D.translateBy=function(t,e,n,r){D.transform(t,(function(){return S(this.__zoom.translate("function"==typeof e?e.apply(this,arguments):e,"function"==typeof n?n.apply(this,arguments):n),f.apply(this,arguments),A)}),null,r)},D.translateTo=function(t,e,n,r,i){D.transform(t,(function(){var t=f.apply(this,arguments),i=this.__zoom,s=null==r?k(t):"function"==typeof r?r.apply(this,arguments):r;return S(p.translate(s[0],s[1]).scale(i.k).translate("function"==typeof e?-e.apply(this,arguments):-e,"function"==typeof n?-n.apply(this,arguments):-n),t,A)}),r,i)},z.prototype={event:function(t){return t&&(this.sourceEvent=t),this},start:function(){return 1==++this.active&&(this.that.__zooming=this,this.emit("start")),this},zoom:function(t,e){return this.mouse&&"mouse"!==t&&(this.mouse[1]=e.invert(this.mouse[0])),this.touch0&&"touch"!==t&&(this.touch0[1]=e.invert(this.touch0[0])),this.touch1&&"touch"!==t&&(this.touch1[1]=e.invert(this.touch1[0])),this.that.__zoom=e,this.emit("zoom"),this},end:function(){return 0==--this.active&&(delete this.that.__zooming,this.emit("end")),this},emit:function(t){var e=(0,a.Z)(this.that).datum();N.call(t,this.that,new h(t,{sourceEvent:this.sourceEvent,target:D,type:t,transform:this.that.__zoom,dispatch:N}),e)}},D.wheelDelta=function(t){return arguments.length?(M="function"==typeof t?t:c(+t),D):M},D.filter=function(t){return arguments.length?(s="function"==typeof t?t:c(!!t),D):s},D.touchable=function(t){return arguments.length?(E="function"==typeof t?t:c(!!t),D):E},D.extent=function(t){return arguments.length?(f="function"==typeof t?t:c([[+t[0][0],+t[0][1]],[+t[1][0],+t[1][1]]]),D):f},D.scaleExtent=function(t){return arguments.length?(T[0]=+t[0],T[1]=+t[1],D):[T[0],T[1]]},D.translateExtent=function(t){return arguments.length?(A[0][0]=+t[0][0],A[1][0]=+t[1][0],A[0][1]=+t[0][1],A[1][1]=+t[1][1],D):[[A[0][0],A[0][1]],[A[1][0],A[1][1]]]},D.constrain=function(t){return arguments.length?(S=t,D):S},D.duration=function(t){return arguments.length?(C=+t,D):C},D.interpolate=function(t){return arguments.length?(R=t,D):R},D.on=function(){var t=N.on.apply(N,arguments);return t===N?D:t},D.clickDistance=function(t){return arguments.length?(I=(t=+t)*t,D):Math.sqrt(I)},D.tapDistance=function(t){return arguments.length?(O=+t,D):O},D}f.prototype=d.prototype},21896:function(e,n,r){"use strict";r.d(n,{Z:function(){return It}});var i=r(41468),s=r(89888),o=r(45452),a=r(49085),l=r(86925),u=r(32598),c=r(82433);var h=function(t,e,n){var r=!0,i=!0;if("function"!=typeof t)throw new TypeError("Expected a function");return(0,c.Z)(n)&&(r="leading"in n?!!n.leading:r,i="trailing"in n?!!n.trailing:i),(0,u.Z)(t,e,{leading:r,maxWait:e,trailing:i})},d=r(83109),p=r(42358),f=r(66819),m=r(20680);function g(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}function v(t,e,n){if("function"==typeof t?t===e:t.has(e))return arguments.length<3?e:n;throw new TypeError("Private element is not present on this object")}function y(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _(t,e){return t.get(v(t,e))}function x(t,e,n){(function(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")})(t,e),e.set(t,n)}function b(t,e,n){return t.set(v(t,e),n),n}function w(t,e,n){return e&&function(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,M(r.key),r)}}(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t}function S(t){return function(t){if(Array.isArray(t))return g(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return g(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?g(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function M(t){var e=function(t,e){if("object"!=typeof t||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,e);if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t,"string");return"symbol"==typeof e?e:e+""}var E=function(t,e,n){return(t<<16)+(e<<8)+n},T=function(t,e){return 123*t%Math.pow(2,e)},A=new WeakMap,C=new WeakMap,R=function(){return w((function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:6;y(this,t),x(this,A,void 0),x(this,C,void 0),b(C,this,e),this.reset()}),[{key:"reset",value:function(){b(A,this,["__reserved for background__"])}},{key:"register",value:function(t){if(_(A,this).length>=Math.pow(2,24-_(C,this)))return null;var e,n=_(A,this).length,r=T(n,_(C,this)),i=(e=n+(r<<24-_(C,this)),"#".concat(Math.min(e,Math.pow(2,24)).toString(16).padStart(6,"0")));return _(A,this).push(t),i}},{key:"lookup",value:function(t){if(!t)return null;var e,n,r,i,s,o="string"==typeof t?(e=t,n=(0,m.Z)(e).toRgb(),r=n.r,i=n.g,s=n.b,E(r,i,s)):E.apply(void 0,S(t));if(!o)return null;var a=o&Math.pow(2,24-_(C,this))-1,l=o>>24-_(C,this)&Math.pow(2,_(C,this))-1;return T(a,_(C,this))!==l||a>=_(A,this).length?null:_(A,this)[a]}}])}(),N=r(13320),P=r(5271),I=r(80621),O=r(44200),D=r(54476);const{abs:L,cos:U,sin:k,acos:B,atan2:F,sqrt:z,pow:V}=Math;function G(t){return t<0?-V(-t,1/3):V(t,1/3)}const j=Math.PI,H=2*j,W=j/2,q=Number.MAX_SAFE_INTEGER||9007199254740991,X=Number.MIN_SAFE_INTEGER||-9007199254740991,Z={x:0,y:0,z:0},$={Tvalues:[-.06405689286260563,.06405689286260563,-.1911188674736163,.1911188674736163,-.3150426796961634,.3150426796961634,-.4337935076260451,.4337935076260451,-.5454214713888396,.5454214713888396,-.6480936519369755,.6480936519369755,-.7401241915785544,.7401241915785544,-.820001985973903,.820001985973903,-.8864155270044011,.8864155270044011,-.9382745520027328,.9382745520027328,-.9747285559713095,.9747285559713095,-.9951872199970213,.9951872199970213],Cvalues:[.12793819534675216,.12793819534675216,.1258374563468283,.1258374563468283,.12167047292780339,.12167047292780339,.1155056680537256,.1155056680537256,.10744427011596563,.10744427011596563,.09761865210411388,.09761865210411388,.08619016153195327,.08619016153195327,.0733464814110803,.0733464814110803,.05929858491543678,.05929858491543678,.04427743881741981,.04427743881741981,.028531388628933663,.028531388628933663,.0123412297999872,.0123412297999872],arcfn:function(t,e){const n=e(t);let r=n.x*n.x+n.y*n.y;return void 0!==n.z&&(r+=n.z*n.z),z(r)},compute:function(t,e,n){if(0===t)return e[0].t=0,e[0];const r=e.length-1;if(1===t)return e[r].t=1,e[r];const i=1-t;let s=e;if(0===r)return e[0].t=t,e[0];if(1===r){const e={x:i*s[0].x+t*s[1].x,y:i*s[0].y+t*s[1].y,t:t};return n&&(e.z=i*s[0].z+t*s[1].z),e}if(r<4){let e,o,a,l=i*i,u=t*t,c=0;2===r?(s=[s[0],s[1],s[2],Z],e=l,o=i*t*2,a=u):3===r&&(e=l*i,o=l*t*3,a=i*u*3,c=t*u);const h={x:e*s[0].x+o*s[1].x+a*s[2].x+c*s[3].x,y:e*s[0].y+o*s[1].y+a*s[2].y+c*s[3].y,t:t};return n&&(h.z=e*s[0].z+o*s[1].z+a*s[2].z+c*s[3].z),h}const o=JSON.parse(JSON.stringify(e));for(;o.length>1;){for(let e=0;e<o.length-1;e++)o[e]={x:o[e].x+(o[e+1].x-o[e].x)*t,y:o[e].y+(o[e+1].y-o[e].y)*t},void 0!==o[e].z&&(o[e].z=o[e].z+(o[e+1].z-o[e].z)*t);o.splice(o.length-1,1)}return o[0].t=t,o[0]},computeWithRatios:function(t,e,n,r){const i=1-t,s=n,o=e;let a,l=s[0],u=s[1],c=s[2],h=s[3];return l*=i,u*=t,2===o.length?(a=l+u,{x:(l*o[0].x+u*o[1].x)/a,y:(l*o[0].y+u*o[1].y)/a,z:!!r&&(l*o[0].z+u*o[1].z)/a,t:t}):(l*=i,u*=2*i,c*=t*t,3===o.length?(a=l+u+c,{x:(l*o[0].x+u*o[1].x+c*o[2].x)/a,y:(l*o[0].y+u*o[1].y+c*o[2].y)/a,z:!!r&&(l*o[0].z+u*o[1].z+c*o[2].z)/a,t:t}):(l*=i,u*=1.5*i,c*=3*i,h*=t*t*t,4===o.length?(a=l+u+c+h,{x:(l*o[0].x+u*o[1].x+c*o[2].x+h*o[3].x)/a,y:(l*o[0].y+u*o[1].y+c*o[2].y+h*o[3].y)/a,z:!!r&&(l*o[0].z+u*o[1].z+c*o[2].z+h*o[3].z)/a,t:t}):void 0))},derive:function(t,e){const n=[];for(let r=t,i=r.length,s=i-1;i>1;i--,s--){const t=[];for(let n,i=0;i<s;i++)n={x:s*(r[i+1].x-r[i].x),y:s*(r[i+1].y-r[i].y)},e&&(n.z=s*(r[i+1].z-r[i].z)),t.push(n);n.push(t),r=t}return n},between:function(t,e,n){return e<=t&&t<=n||$.approximately(t,e)||$.approximately(t,n)},approximately:function(t,e,n){return L(t-e)<=(n||1e-6)},length:function(t){const e=$.Tvalues.length;let n=0;for(let r,i=0;i<e;i++)r=.5*$.Tvalues[i]+.5,n+=$.Cvalues[i]*$.arcfn(r,t);return.5*n},map:function(t,e,n,r,i){return r+(i-r)*((t-e)/(n-e))},lerp:function(t,e,n){const r={x:e.x+t*(n.x-e.x),y:e.y+t*(n.y-e.y)};return void 0!==e.z&&void 0!==n.z&&(r.z=e.z+t*(n.z-e.z)),r},pointToString:function(t){let e=t.x+"/"+t.y;return void 0!==t.z&&(e+="/"+t.z),e},pointsToString:function(t){return"["+t.map($.pointToString).join(", ")+"]"},copy:function(t){return JSON.parse(JSON.stringify(t))},angle:function(t,e,n){const r=e.x-t.x,i=e.y-t.y,s=n.x-t.x,o=n.y-t.y;return F(r*o-i*s,r*s+i*o)},round:function(t,e){const n=""+t,r=n.indexOf(".");return parseFloat(n.substring(0,r+1+e))},dist:function(t,e){const n=t.x-e.x,r=t.y-e.y;return z(n*n+r*r)},closest:function(t,e){let n,r,i=V(2,63);return t.forEach((function(t,s){r=$.dist(e,t),r<i&&(i=r,n=s)})),{mdist:i,mpos:n}},abcratio:function(t,e){if(2!==e&&3!==e)return!1;if(void 0===t)t=.5;else if(0===t||1===t)return t;const n=V(t,e)+V(1-t,e);return L((n-1)/n)},projectionratio:function(t,e){if(2!==e&&3!==e)return!1;if(void 0===t)t=.5;else if(0===t||1===t)return t;const n=V(1-t,e);return n/(V(t,e)+n)},lli8:function(t,e,n,r,i,s,o,a){const l=(t-n)*(s-a)-(e-r)*(i-o);return 0!=l&&{x:((t*r-e*n)*(i-o)-(t-n)*(i*a-s*o))/l,y:((t*r-e*n)*(s-a)-(e-r)*(i*a-s*o))/l}},lli4:function(t,e,n,r){const i=t.x,s=t.y,o=e.x,a=e.y,l=n.x,u=n.y,c=r.x,h=r.y;return $.lli8(i,s,o,a,l,u,c,h)},lli:function(t,e){return $.lli4(t,t.c,e,e.c)},makeline:function(t,e){return new st(t.x,t.y,(t.x+e.x)/2,(t.y+e.y)/2,e.x,e.y)},findbbox:function(t){let e=q,n=q,r=X,i=X;return t.forEach((function(t){const s=t.bbox();e>s.x.min&&(e=s.x.min),n>s.y.min&&(n=s.y.min),r<s.x.max&&(r=s.x.max),i<s.y.max&&(i=s.y.max)})),{x:{min:e,mid:(e+r)/2,max:r,size:r-e},y:{min:n,mid:(n+i)/2,max:i,size:i-n}}},shapeintersections:function(t,e,n,r,i){if(!$.bboxoverlap(e,r))return[];const s=[],o=[t.startcap,t.forward,t.back,t.endcap],a=[n.startcap,n.forward,n.back,n.endcap];return o.forEach((function(e){e.virtual||a.forEach((function(r){if(r.virtual)return;const o=e.intersects(r,i);o.length>0&&(o.c1=e,o.c2=r,o.s1=t,o.s2=n,s.push(o))}))})),s},makeshape:function(t,e,n){const r=e.points.length,i=t.points.length,s=$.makeline(e.points[r-1],t.points[0]),o=$.makeline(t.points[i-1],e.points[0]),a={startcap:s,forward:t,back:e,endcap:o,bbox:$.findbbox([s,t,e,o]),intersections:function(t){return $.shapeintersections(a,a.bbox,t,t.bbox,n)}};return a},getminmax:function(t,e,n){if(!n)return{min:0,max:0};let r,i,s=q,o=X;-1===n.indexOf(0)&&(n=[0].concat(n)),-1===n.indexOf(1)&&n.push(1);for(let a=0,l=n.length;a<l;a++)r=n[a],i=t.get(r),i[e]<s&&(s=i[e]),i[e]>o&&(o=i[e]);return{min:s,mid:(s+o)/2,max:o,size:o-s}},align:function(t,e){const n=e.p1.x,r=e.p1.y,i=-F(e.p2.y-r,e.p2.x-n);return t.map((function(t){return{x:(t.x-n)*U(i)-(t.y-r)*k(i),y:(t.x-n)*k(i)+(t.y-r)*U(i)}}))},roots:function(t,e){e=e||{p1:{x:0,y:0},p2:{x:1,y:0}};const n=t.length-1,r=$.align(t,e),i=function(t){return 0<=t&&t<=1};if(2===n){const t=r[0].y,e=r[1].y,n=r[2].y,s=t-2*e+n;if(0!==s){const r=-z(e*e-t*n),o=-t+e;return[-(r+o)/s,-(-r+o)/s].filter(i)}return e!==n&&0===s?[(2*e-n)/(2*e-2*n)].filter(i):[]}const s=r[0].y,o=r[1].y,a=r[2].y;let l=3*o-s-3*a+r[3].y,u=3*s-6*o+3*a,c=-3*s+3*o,h=s;if($.approximately(l,0)){if($.approximately(u,0))return $.approximately(c,0)?[]:[-h/c].filter(i);const t=z(c*c-4*u*h),e=2*u;return[(t-c)/e,(-c-t)/e].filter(i)}u/=l,c/=l,h/=l;const d=(3*c-u*u)/3,p=d/3,f=(2*u*u*u-9*u*c+27*h)/27,m=f/2,g=m*m+p*p*p;let v,y,_,x,b;if(g<0){const t=-d/3,e=z(t*t*t),n=-f/(2*e),r=B(n<-1?-1:n>1?1:n),s=2*G(e);return _=s*U(r/3)-u/3,x=s*U((r+H)/3)-u/3,b=s*U((r+2*H)/3)-u/3,[_,x,b].filter(i)}if(0===g)return v=m<0?G(-m):-G(m),_=2*v-u/3,x=-v-u/3,[_,x].filter(i);{const t=z(g);return v=G(-m+t),y=G(m+t),[v-y-u/3].filter(i)}},droots:function(t){if(3===t.length){const e=t[0],n=t[1],r=t[2],i=e-2*n+r;if(0!==i){const t=-z(n*n-e*r),s=-e+n;return[-(t+s)/i,-(-t+s)/i]}return n!==r&&0===i?[(2*n-r)/(2*(n-r))]:[]}if(2===t.length){const e=t[0],n=t[1];return e!==n?[e/(e-n)]:[]}return[]},curvature:function(t,e,n,r,i){let s,o,a,l,u=0,c=0;const h=$.compute(t,e),d=$.compute(t,n),p=h.x*h.x+h.y*h.y;if(r?(s=z(V(h.y*d.z-d.y*h.z,2)+V(h.z*d.x-d.z*h.x,2)+V(h.x*d.y-d.x*h.y,2)),o=V(p+h.z*h.z,1.5)):(s=h.x*d.y-h.y*d.x,o=V(p,1.5)),0===s||0===o)return{k:0,r:0};if(u=s/o,c=o/s,!i){const i=$.curvature(t-.001,e,n,r,!0).k,s=$.curvature(t+.001,e,n,r,!0).k;l=(s-u+(u-i))/2,a=(L(s-u)+L(u-i))/2}return{k:u,r:c,dk:l,adk:a}},inflections:function(t){if(t.length<4)return[];const e=$.align(t,{p1:t[0],p2:t.slice(-1)[0]}),n=e[2].x*e[1].y,r=e[3].x*e[1].y,i=e[1].x*e[2].y,s=18*(-3*n+2*r+3*i-e[3].x*e[2].y),o=18*(3*n-r-3*i),a=18*(i-n);if($.approximately(s,0)){if(!$.approximately(o,0)){let t=-a/o;if(0<=t&&t<=1)return[t]}return[]}const l=2*s;if($.approximately(l,0))return[];const u=o*o-4*s*a;if(u<0)return[];const c=Math.sqrt(u);return[(c-o)/l,-(o+c)/l].filter((function(t){return 0<=t&&t<=1}))},bboxoverlap:function(t,e){const n=["x","y"],r=n.length;for(let i,s,o,a,l=0;l<r;l++)if(i=n[l],s=t[i].mid,o=e[i].mid,a=(t[i].size+e[i].size)/2,L(s-o)>=a)return!1;return!0},expandbox:function(t,e){e.x.min<t.x.min&&(t.x.min=e.x.min),e.y.min<t.y.min&&(t.y.min=e.y.min),e.z&&e.z.min<t.z.min&&(t.z.min=e.z.min),e.x.max>t.x.max&&(t.x.max=e.x.max),e.y.max>t.y.max&&(t.y.max=e.y.max),e.z&&e.z.max>t.z.max&&(t.z.max=e.z.max),t.x.mid=(t.x.min+t.x.max)/2,t.y.mid=(t.y.min+t.y.max)/2,t.z&&(t.z.mid=(t.z.min+t.z.max)/2),t.x.size=t.x.max-t.x.min,t.y.size=t.y.max-t.y.min,t.z&&(t.z.size=t.z.max-t.z.min)},pairiteration:function(t,e,n){const r=t.bbox(),i=e.bbox(),s=1e5,o=n||.5;if(r.x.size+r.y.size<o&&i.x.size+i.y.size<o)return[(s*(t._t1+t._t2)/2|0)/s+"/"+(s*(e._t1+e._t2)/2|0)/s];let a=t.split(.5),l=e.split(.5),u=[{left:a.left,right:l.left},{left:a.left,right:l.right},{left:a.right,right:l.right},{left:a.right,right:l.left}];u=u.filter((function(t){return $.bboxoverlap(t.left.bbox(),t.right.bbox())}));let c=[];return 0===u.length||(u.forEach((function(t){c=c.concat($.pairiteration(t.left,t.right,o))})),c=c.filter((function(t,e){return c.indexOf(t)===e}))),c},getccenter:function(t,e,n){const r=e.x-t.x,i=e.y-t.y,s=n.x-e.x,o=n.y-e.y,a=r*U(W)-i*k(W),l=r*k(W)+i*U(W),u=s*U(W)-o*k(W),c=s*k(W)+o*U(W),h=(t.x+e.x)/2,d=(t.y+e.y)/2,p=(e.x+n.x)/2,f=(e.y+n.y)/2,m=h+a,g=d+l,v=p+u,y=f+c,_=$.lli8(h,d,m,g,p,f,v,y),x=$.dist(_,t);let b,w=F(t.y-_.y,t.x-_.x),S=F(e.y-_.y,e.x-_.x),M=F(n.y-_.y,n.x-_.x);return w<M?((w>S||S>M)&&(w+=H),w>M&&(b=M,M=w,w=b)):M<S&&S<w?(b=M,M=w,w=b):M+=H,_.s=w,_.e=M,_.r=x,_},numberSort:function(t,e){return t-e}};class Y{constructor(t){this.curves=[],this._3d=!1,t&&(this.curves=t,this._3d=this.curves[0]._3d)}valueOf(){return this.toString()}toString(){return"["+this.curves.map((function(t){return $.pointsToString(t.points)})).join(", ")+"]"}addCurve(t){this.curves.push(t),this._3d=this._3d||t._3d}length(){return this.curves.map((function(t){return t.length()})).reduce((function(t,e){return t+e}))}curve(t){return this.curves[t]}bbox(){const t=this.curves;for(var e=t[0].bbox(),n=1;n<t.length;n++)$.expandbox(e,t[n].bbox());return e}offset(t){const e=[];return this.curves.forEach((function(n){e.push(...n.offset(t))})),new Y(e)}}const{abs:K,min:J,max:Q,cos:tt,sin:et,acos:nt,sqrt:rt}=Math,it=Math.PI;class st{constructor(t){let e=t&&t.forEach?t:Array.from(arguments).slice(),n=!1;if("object"==typeof e[0]){n=e.length;const t=[];e.forEach((function(e){["x","y","z"].forEach((function(n){void 0!==e[n]&&t.push(e[n])}))})),e=t}let r=!1;const i=e.length;if(n){if(n>4){if(1!==arguments.length)throw new Error("Only new Bezier(point[]) is accepted for 4th and higher order curves");r=!0}}else if(6!==i&&8!==i&&9!==i&&12!==i&&1!==arguments.length)throw new Error("Only new Bezier(point[]) is accepted for 4th and higher order curves");const s=this._3d=!r&&(9===i||12===i)||t&&t[0]&&void 0!==t[0].z,o=this.points=[];for(let t=0,n=s?3:2;t<i;t+=n){var a={x:e[t],y:e[t+1]};s&&(a.z=e[t+2]),o.push(a)}const l=this.order=o.length-1,u=this.dims=["x","y"];s&&u.push("z"),this.dimlen=u.length;const c=$.align(o,{p1:o[0],p2:o[l]}),h=$.dist(o[0],o[l]);this._linear=c.reduce(((t,e)=>t+K(e.y)),0)<h/50,this._lut=[],this._t1=0,this._t2=1,this.update()}static quadraticFromPoints(t,e,n,r){if(void 0===r&&(r=.5),0===r)return new st(e,e,n);if(1===r)return new st(t,e,e);const i=st.getABC(2,t,e,n,r);return new st(t,i.A,n)}static cubicFromPoints(t,e,n,r,i){void 0===r&&(r=.5);const s=st.getABC(3,t,e,n,r);void 0===i&&(i=$.dist(e,s.C));const o=i*(1-r)/r,a=$.dist(t,n),l=(n.x-t.x)/a,u=(n.y-t.y)/a,c=i*l,h=i*u,d=o*l,p=o*u,f=e.x-c,m=e.y-h,g=e.x+d,v=e.y+p,y=s.A,_=y.x+(f-y.x)/(1-r),x=y.y+(m-y.y)/(1-r),b=y.x+(g-y.x)/r,w=y.y+(v-y.y)/r,S={x:t.x+(_-t.x)/r,y:t.y+(x-t.y)/r},M={x:n.x+(b-n.x)/(1-r),y:n.y+(w-n.y)/(1-r)};return new st(t,S,M,n)}static getUtils(){return $}getUtils(){return st.getUtils()}static get PolyBezier(){return Y}valueOf(){return this.toString()}toString(){return $.pointsToString(this.points)}toSVG(){if(this._3d)return!1;const t=this.points,e=["M",t[0].x,t[0].y,2===this.order?"Q":"C"];for(let n=1,r=t.length;n<r;n++)e.push(t[n].x),e.push(t[n].y);return e.join(" ")}setRatios(t){if(t.length!==this.points.length)throw new Error("incorrect number of ratio values");this.ratios=t,this._lut=[]}verify(){const t=this.coordDigest();t!==this._print&&(this._print=t,this.update())}coordDigest(){return this.points.map((function(t,e){return""+e+t.x+t.y+(t.z?t.z:0)})).join("")}update(){this._lut=[],this.dpoints=$.derive(this.points,this._3d),this.computedirection()}computedirection(){const t=this.points,e=$.angle(t[0],t[this.order],t[1]);this.clockwise=e>0}length(){return $.length(this.derivative.bind(this))}static getABC(t=2,e,n,r,i=.5){const s=$.projectionratio(i,t),o=1-s,a={x:s*e.x+o*r.x,y:s*e.y+o*r.y},l=$.abcratio(i,t);return{A:{x:n.x+(n.x-a.x)/l,y:n.y+(n.y-a.y)/l},B:n,C:a,S:e,E:r}}getABC(t,e){e=e||this.get(t);let n=this.points[0],r=this.points[this.order];return st.getABC(this.order,n,e,r,t)}getLUT(t){if(this.verify(),t=t||100,this._lut.length===t+1)return this._lut;this._lut=[],t++,this._lut=[];for(let e,n,r=0;r<t;r++)n=r/(t-1),e=this.compute(n),e.t=n,this._lut.push(e);return this._lut}on(e,n){n=n||5;const r=this.getLUT(),i=[];for(let t,s=0,o=0;s<r.length;s++)t=r[s],$.dist(t,e)<n&&(i.push(t),o+=s/r.length);return!!i.length&&(t/=i.length)}project(t){const e=this.getLUT(),n=e.length-1,r=$.closest(e,t),i=r.mpos,s=(i-1)/n,o=(i+1)/n,a=.1/n;let l,u,c=r.mdist,h=s,d=h;for(c+=1;h<o+a;h+=a)l=this.compute(h),u=$.dist(t,l),u<c&&(c=u,d=h);return d=d<0?0:d>1?1:d,l=this.compute(d),l.t=d,l.d=c,l}get(t){return this.compute(t)}point(t){return this.points[t]}compute(t){return this.ratios?$.computeWithRatios(t,this.points,this.ratios,this._3d):$.compute(t,this.points,this._3d,this.ratios)}raise(){const t=this.points,e=[t[0]],n=t.length;for(let r,i,s=1;s<n;s++)r=t[s],i=t[s-1],e[s]={x:(n-s)/n*r.x+s/n*i.x,y:(n-s)/n*r.y+s/n*i.y};return e[n]=t[n-1],new st(e)}derivative(t){return $.compute(t,this.dpoints[0],this._3d)}dderivative(t){return $.compute(t,this.dpoints[1],this._3d)}align(){let t=this.points;return new st($.align(t,{p1:t[0],p2:t[t.length-1]}))}curvature(t){return $.curvature(t,this.dpoints[0],this.dpoints[1],this._3d)}inflections(){return $.inflections(this.points)}normal(t){return this._3d?this.__normal3(t):this.__normal2(t)}__normal2(t){const e=this.derivative(t),n=rt(e.x*e.x+e.y*e.y);return{t:t,x:-e.y/n,y:e.x/n}}__normal3(t){const e=this.derivative(t),n=this.derivative(t+.01),r=rt(e.x*e.x+e.y*e.y+e.z*e.z),i=rt(n.x*n.x+n.y*n.y+n.z*n.z);e.x/=r,e.y/=r,e.z/=r,n.x/=i,n.y/=i,n.z/=i;const s={x:n.y*e.z-n.z*e.y,y:n.z*e.x-n.x*e.z,z:n.x*e.y-n.y*e.x},o=rt(s.x*s.x+s.y*s.y+s.z*s.z);s.x/=o,s.y/=o,s.z/=o;const a=[s.x*s.x,s.x*s.y-s.z,s.x*s.z+s.y,s.x*s.y+s.z,s.y*s.y,s.y*s.z-s.x,s.x*s.z-s.y,s.y*s.z+s.x,s.z*s.z];return{t:t,x:a[0]*e.x+a[1]*e.y+a[2]*e.z,y:a[3]*e.x+a[4]*e.y+a[5]*e.z,z:a[6]*e.x+a[7]*e.y+a[8]*e.z}}hull(t){let e=this.points,n=[],r=[],i=0;for(r[i++]=e[0],r[i++]=e[1],r[i++]=e[2],3===this.order&&(r[i++]=e[3]);e.length>1;){n=[];for(let s,o=0,a=e.length-1;o<a;o++)s=$.lerp(t,e[o],e[o+1]),r[i++]=s,n.push(s);e=n}return r}split(t,e){if(0===t&&e)return this.split(e).left;if(1===e)return this.split(t).right;const n=this.hull(t),r={left:2===this.order?new st([n[0],n[3],n[5]]):new st([n[0],n[4],n[7],n[9]]),right:2===this.order?new st([n[5],n[4],n[2]]):new st([n[9],n[8],n[6],n[3]]),span:n};return r.left._t1=$.map(0,0,1,this._t1,this._t2),r.left._t2=$.map(t,0,1,this._t1,this._t2),r.right._t1=$.map(t,0,1,this._t1,this._t2),r.right._t2=$.map(1,0,1,this._t1,this._t2),e?(e=$.map(e,t,1,0,1),r.right.split(e).left):r}extrema(){const t={};let e=[];return this.dims.forEach(function(n){let r=function(t){return t[n]},i=this.dpoints[0].map(r);t[n]=$.droots(i),3===this.order&&(i=this.dpoints[1].map(r),t[n]=t[n].concat($.droots(i))),t[n]=t[n].filter((function(t){return t>=0&&t<=1})),e=e.concat(t[n].sort($.numberSort))}.bind(this)),t.values=e.sort($.numberSort).filter((function(t,n){return e.indexOf(t)===n})),t}bbox(){const t=this.extrema(),e={};return this.dims.forEach(function(n){e[n]=$.getminmax(this,n,t[n])}.bind(this)),e}overlaps(t){const e=this.bbox(),n=t.bbox();return $.bboxoverlap(e,n)}offset(t,e){if(void 0!==e){const n=this.get(t),r=this.normal(t),i={c:n,n:r,x:n.x+r.x*e,y:n.y+r.y*e};return this._3d&&(i.z=n.z+r.z*e),i}if(this._linear){const e=this.normal(0),n=this.points.map((function(n){const r={x:n.x+t*e.x,y:n.y+t*e.y};return n.z&&e.z&&(r.z=n.z+t*e.z),r}));return[new st(n)]}return this.reduce().map((function(e){return e._linear?e.offset(t)[0]:e.scale(t)}))}simple(){if(3===this.order){const t=$.angle(this.points[0],this.points[3],this.points[1]),e=$.angle(this.points[0],this.points[3],this.points[2]);if(t>0&&e<0||t<0&&e>0)return!1}const t=this.normal(0),e=this.normal(1);let n=t.x*e.x+t.y*e.y;return this._3d&&(n+=t.z*e.z),K(nt(n))<it/3}reduce(){let t,e,n=0,r=0,i=.01,s=[],o=[],a=this.extrema().values;for(-1===a.indexOf(0)&&(a=[0].concat(a)),-1===a.indexOf(1)&&a.push(1),n=a[0],t=1;t<a.length;t++)r=a[t],e=this.split(n,r),e._t1=n,e._t2=r,s.push(e),n=r;return s.forEach((function(t){for(n=0,r=0;r<=1;)for(r=n+i;r<=1.01;r+=i)if(e=t.split(n,r),!e.simple()){if(r-=i,K(n-r)<i)return[];e=t.split(n,r),e._t1=$.map(n,0,1,t._t1,t._t2),e._t2=$.map(r,0,1,t._t1,t._t2),o.push(e),n=r;break}n<1&&(e=t.split(n,1),e._t1=$.map(n,0,1,t._t1,t._t2),e._t2=t._t2,o.push(e))})),o}translate(t,e,n){n="number"==typeof n?n:e;const r=this.order;let i=this.points.map(((t,i)=>(1-i/r)*e+i/r*n));return new st(this.points.map(((e,n)=>({x:e.x+t.x*i[n],y:e.y+t.y*i[n]}))))}scale(t){const e=this.order;let n=!1;if("function"==typeof t&&(n=t),n&&2===e)return this.raise().scale(n);const r=this.clockwise,i=this.points;if(this._linear)return this.translate(this.normal(0),n?n(0):t,n?n(1):t);const s=n?n(0):t,o=n?n(1):t,a=[this.offset(0,10),this.offset(1,10)],l=[],u=$.lli4(a[0],a[0].c,a[1],a[1].c);if(!u)throw new Error("cannot scale this curve. Try reducing it first.");return[0,1].forEach((function(t){const n=l[t*e]=$.copy(i[t*e]);n.x+=(t?o:s)*a[t].n.x,n.y+=(t?o:s)*a[t].n.y})),n?([0,1].forEach((function(s){if(2!==e||!s){var o=i[s+1],a={x:o.x-u.x,y:o.y-u.y},c=n?n((s+1)/e):t;n&&!r&&(c=-c);var h=rt(a.x*a.x+a.y*a.y);a.x/=h,a.y/=h,l[s+1]={x:o.x+c*a.x,y:o.y+c*a.y}}})),new st(l)):([0,1].forEach((t=>{if(2===e&&t)return;const n=l[t*e],r=this.derivative(t),s={x:n.x+r.x,y:n.y+r.y};l[t+1]=$.lli4(n,s,u,i[t+1])})),new st(l))}outline(t,e,n,r){if(e=void 0===e?t:e,this._linear){const i=this.normal(0),s=this.points[0],o=this.points[this.points.length-1];let a,l,u;void 0===n&&(n=t,r=e),a={x:s.x+i.x*t,y:s.y+i.y*t},u={x:o.x+i.x*n,y:o.y+i.y*n},l={x:(a.x+u.x)/2,y:(a.y+u.y)/2};const c=[a,l,u];a={x:s.x-i.x*e,y:s.y-i.y*e},u={x:o.x-i.x*r,y:o.y-i.y*r},l={x:(a.x+u.x)/2,y:(a.y+u.y)/2};const h=[u,l,a],d=$.makeline(h[2],c[0]),p=$.makeline(c[2],h[0]),f=[d,new st(c),p,new st(h)];return new Y(f)}const i=this.reduce(),s=i.length,o=[];let a,l=[],u=0,c=this.length();const h=void 0!==n&&void 0!==r;function d(t,e,n,r,i){return function(s){const o=r/n,a=(r+i)/n,l=e-t;return $.map(s,0,1,t+o*l,t+a*l)}}i.forEach((function(i){const s=i.length();h?(o.push(i.scale(d(t,n,c,u,s))),l.push(i.scale(d(-e,-r,c,u,s)))):(o.push(i.scale(t)),l.push(i.scale(-e))),u+=s})),l=l.map((function(t){return a=t.points,a[3]?t.points=[a[3],a[2],a[1],a[0]]:t.points=[a[2],a[1],a[0]],t})).reverse();const p=o[0].points[0],f=o[s-1].points[o[s-1].points.length-1],m=l[s-1].points[l[s-1].points.length-1],g=l[0].points[0],v=$.makeline(m,p),y=$.makeline(f,g),_=[v].concat(o).concat([y]).concat(l);return new Y(_)}outlineshapes(t,e,n){e=e||t;const r=this.outline(t,e).curves,i=[];for(let t=1,e=r.length;t<e/2;t++){const s=$.makeshape(r[t],r[e-t],n);s.startcap.virtual=t>1,s.endcap.virtual=t<e/2-1,i.push(s)}return i}intersects(t,e){return t?t.p1&&t.p2?this.lineIntersects(t):(t instanceof st&&(t=t.reduce()),this.curveintersects(this.reduce(),t,e)):this.selfintersects(e)}lineIntersects(t){const e=J(t.p1.x,t.p2.x),n=J(t.p1.y,t.p2.y),r=Q(t.p1.x,t.p2.x),i=Q(t.p1.y,t.p2.y);return $.roots(this.points,t).filter((t=>{var s=this.get(t);return $.between(s.x,e,r)&&$.between(s.y,n,i)}))}selfintersects(t){const e=this.reduce(),n=e.length-2,r=[];for(let i,s,o,a=0;a<n;a++)s=e.slice(a,a+1),o=e.slice(a+2),i=this.curveintersects(s,o,t),r.push(...i);return r}curveintersects(t,e,n){const r=[];t.forEach((function(t){e.forEach((function(e){t.overlaps(e)&&r.push({left:t,right:e})}))}));let i=[];return r.forEach((function(t){const e=$.pairiteration(t.left,t.right,n);e.length>0&&(i=i.concat(e))})),i}arcs(t){return t=t||.5,this._iterate(t,[])}_error(t,e,n,r){const i=(r-n)/4,s=this.get(n+i),o=this.get(r-i),a=$.dist(t,e),l=$.dist(t,s),u=$.dist(t,o);return K(l-a)+K(u-a)}_iterate(t,e){let n,r=0,i=1;do{n=0,i=1;let s,o,a,l,u,c=this.get(r),h=!1,d=!1,p=i,f=1,m=0;do{if(d=h,l=a,p=(r+i)/2,m++,s=this.get(p),o=this.get(i),a=$.getccenter(c,s,o),a.interval={start:r,end:i},h=this._error(a,c,r,i)<=t,u=d&&!h,u||(f=i),h){if(i>=1){if(a.interval.end=f=1,l=a,i>1){let t={x:a.x+a.r*tt(a.e),y:a.y+a.r*et(a.e)};a.e+=$.angle({x:a.x,y:a.y},t,this.get(1))}break}i+=(i-r)/2}else i=p}while(!u&&n++<100);if(n>=100)break;l=l||a,e.push(l),r=f}while(i<1);return e}}var ot=r(37996),at=r(9771),lt=r(22059);function ut(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}function ct(t,e,n){if(dt())return Reflect.construct.apply(null,arguments);var r=[null];r.push.apply(r,e);var i=new(t.bind.apply(t,r));return i}function ht(t,e,n){return(e=function(t){var e=function(t,e){if("object"!=typeof t||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,e||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:e+""}(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function dt(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(dt=function(){return!!t})()}function pt(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function ft(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?pt(Object(n),!0).forEach((function(e){ht(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):pt(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function mt(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,i,s,o,a=[],l=!0,u=!1;try{if(s=(n=n.call(t)).next,0===e);else for(;!(l=(r=s.call(n)).done)&&(a.push(r.value),a.length!==e);l=!0);}catch(t){u=!0,i=t}finally{try{if(!l&&null!=n.return&&(o=n.return(),Object(o)!==o))return}finally{if(u)throw i}}return a}}(t,e)||yt(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function gt(t){return function(t){if(Array.isArray(t))return ut(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||yt(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function vt(t){return vt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},vt(t)}function yt(t,e){if(t){if("string"==typeof t)return ut(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?ut(t,e):void 0}}!function(t,e){void 0===e&&(e={});var n=e.insertAt;if("undefined"!=typeof document){var r=document.head||document.getElementsByTagName("head")[0],i=document.createElement("style");i.type="text/css","top"===n&&r.firstChild?r.insertBefore(i,r.firstChild):r.appendChild(i),i.styleSheet?i.styleSheet.cssText=t:i.appendChild(document.createTextNode(t))}}(".force-graph-container canvas {\n  display: block;\n  user-select: none;\n  outline: none;\n  -webkit-tap-highlight-color: transparent;\n}\n\n.force-graph-container .graph-tooltip {\n  position: absolute;\n  top: 0;\n  font-family: sans-serif;\n  font-size: 16px;\n  padding: 4px;\n  border-radius: 3px;\n  color: #eee;\n  background: rgba(0,0,0,0.65);\n  visibility: hidden; /* by default */\n}\n\n.force-graph-container .clickable {\n  cursor: pointer;\n}\n\n.force-graph-container .grabbable {\n  cursor: move;\n  cursor: grab;\n  cursor: -moz-grab;\n  cursor: -webkit-grab;\n}\n\n.force-graph-container .grabbable:active {\n  cursor: grabbing;\n  cursor: -moz-grabbing;\n  cursor: -webkit-grabbing;\n}\n");var _t=(0,at.Z)(lt.Z);function xt(t,e,n){e&&"string"==typeof n&&t.filter((function(t){return!t[n]})).forEach((function(t){t[n]=_t(e(t))}))}var bt=function(t,e){return e.onNeedsRedraw&&e.onNeedsRedraw()},wt=function(t,e){if(!e.isShadow){var n=(0,f.Z)(e.linkDirectionalParticles);e.graphData.links.forEach((function(t){var e=Math.round(Math.abs(n(t)));e?t.__photons=gt(Array(e)).map((function(){return{}})):delete t.__photons}))}},St=(0,p.Z)({props:{graphData:{default:{nodes:[],links:[]},onChange:function(t,e){e.engineRunning=!1,wt(0,e)}},dagMode:{onChange:function(t,e){!t&&(e.graphData.nodes||[]).forEach((function(t){return t.fx=t.fy=void 0}))}},dagLevelDistance:{},dagNodeFilter:{default:function(t){return!0}},onDagError:{triggerUpdate:!1},nodeRelSize:{default:4,triggerUpdate:!1,onChange:bt},nodeId:{default:"id"},nodeVal:{default:"val",triggerUpdate:!1,onChange:bt},nodeColor:{default:"color",triggerUpdate:!1,onChange:bt},nodeAutoColorBy:{},nodeCanvasObject:{triggerUpdate:!1,onChange:bt},nodeCanvasObjectMode:{default:function(){return"replace"},triggerUpdate:!1,onChange:bt},nodeVisibility:{default:!0,triggerUpdate:!1,onChange:bt},linkSource:{default:"source"},linkTarget:{default:"target"},linkVisibility:{default:!0,triggerUpdate:!1,onChange:bt},linkColor:{default:"color",triggerUpdate:!1,onChange:bt},linkAutoColorBy:{},linkLineDash:{triggerUpdate:!1,onChange:bt},linkWidth:{default:1,triggerUpdate:!1,onChange:bt},linkCurvature:{default:0,triggerUpdate:!1,onChange:bt},linkCanvasObject:{triggerUpdate:!1,onChange:bt},linkCanvasObjectMode:{default:function(){return"replace"},triggerUpdate:!1,onChange:bt},linkDirectionalArrowLength:{default:0,triggerUpdate:!1,onChange:bt},linkDirectionalArrowColor:{triggerUpdate:!1,onChange:bt},linkDirectionalArrowRelPos:{default:.5,triggerUpdate:!1,onChange:bt},linkDirectionalParticles:{default:0,triggerUpdate:!1,onChange:wt},linkDirectionalParticleSpeed:{default:.01,triggerUpdate:!1},linkDirectionalParticleWidth:{default:4,triggerUpdate:!1},linkDirectionalParticleColor:{triggerUpdate:!1},globalScale:{default:1,triggerUpdate:!1},d3AlphaMin:{default:0,triggerUpdate:!1},d3AlphaDecay:{default:.0228,triggerUpdate:!1,onChange:function(t,e){e.forceLayout.alphaDecay(t)}},d3AlphaTarget:{default:0,triggerUpdate:!1,onChange:function(t,e){e.forceLayout.alphaTarget(t)}},d3VelocityDecay:{default:.4,triggerUpdate:!1,onChange:function(t,e){e.forceLayout.velocityDecay(t)}},warmupTicks:{default:0,triggerUpdate:!1},cooldownTicks:{default:1/0,triggerUpdate:!1},cooldownTime:{default:15e3,triggerUpdate:!1},onUpdate:{default:function(){},triggerUpdate:!1},onFinishUpdate:{default:function(){},triggerUpdate:!1},onEngineTick:{default:function(){},triggerUpdate:!1},onEngineStop:{default:function(){},triggerUpdate:!1},onNeedsRedraw:{triggerUpdate:!1},isShadow:{default:!1,triggerUpdate:!1}},methods:{d3Force:function(t,e,n){return void 0===n?t.forceLayout.force(e):(t.forceLayout.force(e,n),this)},d3ReheatSimulation:function(t){return t.forceLayout.alpha(1),this.resetCountdown(),this},resetCountdown:function(t){return t.cntTicks=0,t.startTickTime=new Date,t.engineRunning=!0,this},isEngineRunning:function(t){return!!t.engineRunning},tickFrame:function(t){var e,n,r,i,s,o;return!t.isShadow&&t.engineRunning&&(++t.cntTicks>t.cooldownTicks||new Date-t.startTickTime>t.cooldownTime||t.d3AlphaMin>0&&t.forceLayout.alpha()<t.d3AlphaMin?(t.engineRunning=!1,t.onEngineStop()):(t.forceLayout.tick(),t.onEngineTick())),function(){var e=(0,f.Z)(t.linkVisibility),n=(0,f.Z)(t.linkColor),r=(0,f.Z)(t.linkWidth),i=(0,f.Z)(t.linkLineDash),s=(0,f.Z)(t.linkCurvature),o=(0,f.Z)(t.linkCanvasObjectMode),a=t.ctx,l=2*t.isShadow,u=t.graphData.links.filter(e);u.forEach((function(t){var e=s(t);if(!e)return void(t.__controlPoints=null);var n=t.source,r=t.target;if(!(n&&r&&n.hasOwnProperty("x")&&r.hasOwnProperty("x")))return;var i=Math.sqrt(Math.pow(r.x-n.x,2)+Math.pow(r.y-n.y,2));if(i>0){var o=Math.atan2(r.y-n.y,r.x-n.x),a=i*e,l={x:(n.x+r.x)/2+a*Math.cos(o-Math.PI/2),y:(n.y+r.y)/2+a*Math.sin(o-Math.PI/2)};t.__controlPoints=[l.x,l.y]}else{var u=70*e;t.__controlPoints=[r.x,r.y-u,r.x+u,r.y]}}));var c=[],h=[],d=u;if(t.linkCanvasObject){var p=[],m=[];u.forEach((function(t){return({before:c,after:h,replace:p}[o(t)]||m).push(t)})),d=[].concat(gt(c),h,m),c=c.concat(p)}a.save(),c.forEach((function(e){return t.linkCanvasObject(e,a,t.globalScale)})),a.restore();var g=(0,ot.Z)(d,[n,r,i]);a.save(),Object.entries(g).forEach((function(e){var n=mt(e,2),r=n[0],s=n[1],o=r&&"undefined"!==r?r:"rgba(0,0,0,0.15)";Object.entries(s).forEach((function(e){var n=mt(e,2),r=n[0],s=n[1],u=(r||1)/t.globalScale+l;Object.entries(s).forEach((function(t){var e=mt(t,2);e[0];var n=e[1],r=i(n[0]);a.beginPath(),n.forEach((function(t){var e=t.source,n=t.target;if(e&&n&&e.hasOwnProperty("x")&&n.hasOwnProperty("x")){a.moveTo(e.x,e.y);var r=t.__controlPoints;r?a[2===r.length?"quadraticCurveTo":"bezierCurveTo"].apply(a,gt(r).concat([n.x,n.y])):a.lineTo(n.x,n.y)}})),a.strokeStyle=o,a.lineWidth=u,a.setLineDash(r||[]),a.stroke()}))}))})),a.restore(),a.save(),h.forEach((function(e){return t.linkCanvasObject(e,a,t.globalScale)})),a.restore()}(),!t.isShadow&&(e=(0,f.Z)(t.linkDirectionalArrowLength),n=(0,f.Z)(t.linkDirectionalArrowRelPos),r=(0,f.Z)(t.linkVisibility),i=(0,f.Z)(t.linkDirectionalArrowColor||t.linkColor),s=(0,f.Z)(t.nodeVal),(o=t.ctx).save(),t.graphData.links.filter(r).forEach((function(r){var a=e(r);if(a&&!(a<0)){var l=r.source,u=r.target;if(l&&u&&l.hasOwnProperty("x")&&u.hasOwnProperty("x")){var c=Math.sqrt(Math.max(0,s(l)||1))*t.nodeRelSize,h=Math.sqrt(Math.max(0,s(u)||1))*t.nodeRelSize,d=Math.min(1,Math.max(0,n(r))),p=i(r)||"rgba(0,0,0,0.28)",f=a/1.6/2,m=r.__controlPoints&&ct(st,[l.x,l.y].concat(gt(r.__controlPoints),[u.x,u.y])),g=m?function(t){return m.get(t)}:function(t){return{x:l.x+(u.x-l.x)*t||0,y:l.y+(u.y-l.y)*t||0}},v=m?m.length():Math.sqrt(Math.pow(u.x-l.x,2)+Math.pow(u.y-l.y,2)),y=c+a+(v-c-h-a)*d,_=g(y/v),x=g((y-a)/v),b=g((y-.8*a)/v),w=Math.atan2(_.y-x.y,_.x-x.x)-Math.PI/2;o.beginPath(),o.moveTo(_.x,_.y),o.lineTo(x.x+f*Math.cos(w),x.y+f*Math.sin(w)),o.lineTo(b.x,b.y),o.lineTo(x.x-f*Math.cos(w),x.y-f*Math.sin(w)),o.fillStyle=p,o.fill()}}})),o.restore()),!t.isShadow&&function(){var e=(0,f.Z)(t.linkDirectionalParticles),n=(0,f.Z)(t.linkDirectionalParticleSpeed),r=(0,f.Z)(t.linkDirectionalParticleWidth),i=(0,f.Z)(t.linkVisibility),s=(0,f.Z)(t.linkDirectionalParticleColor||t.linkColor),o=t.ctx;o.save(),t.graphData.links.filter(i).forEach((function(i){var a=e(i);if(i.hasOwnProperty("__photons")&&i.__photons.length){var l=i.source,u=i.target;if(l&&u&&l.hasOwnProperty("x")&&u.hasOwnProperty("x")){var c=n(i),h=i.__photons||[],d=Math.max(0,r(i)/2)/Math.sqrt(t.globalScale),p=s(i)||"rgba(0,0,0,0.28)";o.fillStyle=p;var f=i.__controlPoints?ct(st,[l.x,l.y].concat(gt(i.__controlPoints),[u.x,u.y])):null,m=0,g=!1;h.forEach((function(t){var e=!!t.__singleHop;if(t.hasOwnProperty("__progressRatio")||(t.__progressRatio=e?0:m/a),!e&&m++,t.__progressRatio+=c,t.__progressRatio>=1){if(e)return void(g=!0);t.__progressRatio=t.__progressRatio%1}var n=t.__progressRatio,r=f?f.get(n):{x:l.x+(u.x-l.x)*n||0,y:l.y+(u.y-l.y)*n||0};o.beginPath(),o.arc(r.x,r.y,d,0,2*Math.PI,!1),o.fill()})),g&&(i.__photons=i.__photons.filter((function(t){return!t.__singleHop||t.__progressRatio<=1})))}}})),o.restore()}(),function(){var e=(0,f.Z)(t.nodeVisibility),n=(0,f.Z)(t.nodeVal),r=(0,f.Z)(t.nodeColor),i=(0,f.Z)(t.nodeCanvasObjectMode),s=t.ctx,o=t.isShadow/t.globalScale,a=t.graphData.nodes.filter(e);s.save(),a.forEach((function(e){var a=i(e);if(!t.nodeCanvasObject||"before"!==a&&"replace"!==a||(t.nodeCanvasObject(e,s,t.globalScale),"replace"!==a)){var l=Math.sqrt(Math.max(0,n(e)||1))*t.nodeRelSize+o;s.beginPath(),s.arc(e.x,e.y,l,0,2*Math.PI,!1),s.fillStyle=r(e)||"rgba(31, 120, 180, 0.92)",s.fill(),t.nodeCanvasObject&&"after"===a&&t.nodeCanvasObject(e,t.ctx,t.globalScale)}else s.restore()})),s.restore()}(),this},emitParticle:function(t,e){return e&&(!e.__photons&&(e.__photons=[]),e.__photons.push({__singleHop:!0})),this}},stateInit:function(){return{forceLayout:(0,N.Z)().force("link",(0,P.Z)()).force("charge",(0,I.Z)()).force("center",(0,O.Z)()).force("dagRadial",null).stop(),engineRunning:!1}},init:function(t,e){e.ctx=t},update:function(t,e){t.engineRunning=!1,t.onUpdate(),null!==t.nodeAutoColorBy&&xt(t.graphData.nodes,(0,f.Z)(t.nodeAutoColorBy),t.nodeColor),null!==t.linkAutoColorBy&&xt(t.graphData.links,(0,f.Z)(t.linkAutoColorBy),t.linkColor),t.graphData.links.forEach((function(e){e.source=e[t.linkSource],e.target=e[t.linkTarget]})),t.forceLayout.stop().alpha(1).nodes(t.graphData.nodes);var n=t.forceLayout.force("link");n&&n.id((function(e){return e[t.nodeId]})).links(t.graphData.links);var r=t.dagMode&&function(t,e){var n=t.nodes,r=t.links,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},s=i.nodeFilter,o=void 0===s?function(){return!0}:s,a=i.onLoopError,l=void 0===a?function(t){throw"Invalid DAG structure! Found cycle in node path: ".concat(t.join(" -> "),".")}:a,u={};n.forEach((function(t){return u[e(t)]={data:t,out:[],depth:-1,skip:!o(t)}})),r.forEach((function(t){var n=t.source,r=t.target,i=l(n),s=l(r);if(!u.hasOwnProperty(i))throw"Missing source node with id: ".concat(i);if(!u.hasOwnProperty(s))throw"Missing target node with id: ".concat(s);var o=u[i],a=u[s];function l(t){return"object"===vt(t)?e(t):t}o.out.push(a)}));var c=[];d(Object.values(u));var h=Object.assign.apply(Object,[{}].concat(gt(Object.entries(u).filter((function(t){return!mt(t,2)[1].skip})).map((function(t){var e=mt(t,2);return ht({},e[0],e[1].depth)})))));return h;function d(t){for(var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=function(){var i=t[s];if(-1!==n.indexOf(i)){var o=[].concat(gt(n.slice(n.indexOf(i))),[i]).map((function(t){return e(t.data)}));return c.some((function(t){return t.length===o.length&&t.every((function(t,e){return t===o[e]}))}))||(c.push(o),l(o)),1}r>i.depth&&(i.depth=r,d(i.out,[].concat(gt(n),[i]),r+(i.skip?0:1)))},s=0,o=t.length;s<o;s++)i()}}(t.graphData,(function(e){return e[t.nodeId]}),{nodeFilter:t.dagNodeFilter,onLoopError:t.onDagError||void 0}),i=Math.max.apply(Math,gt(Object.values(r||[]))),s=t.dagLevelDistance||t.graphData.nodes.length/(i||1)*2*(-1!==["radialin","radialout"].indexOf(t.dagMode)?.7:1);if(["lr","rl","td","bu"].includes(e.dagMode)){var o=["lr","rl"].includes(e.dagMode)?"fx":"fy";t.graphData.nodes.filter(t.dagNodeFilter).forEach((function(t){return delete t[o]}))}if(["lr","rl","td","bu"].includes(t.dagMode)){var a=["rl","bu"].includes(t.dagMode),l=["lr","rl"].includes(t.dagMode)?"fx":"fy";t.graphData.nodes.filter(t.dagNodeFilter).forEach((function(e){return e[l]=function(e){return(r[e[t.nodeId]]-i/2)*s*(a?-1:1)}(e)}))}t.forceLayout.force("dagRadial",-1!==["radialin","radialout"].indexOf(t.dagMode)?(0,D.Z)((function(e){var n=r[e[t.nodeId]]||-1;return("radialin"===t.dagMode?i-n:n)*s})).strength((function(e){return t.dagNodeFilter(e)?1:0})):null);for(var u=0;u<t.warmupTicks&&!(t.d3AlphaMin>0&&t.forceLayout.alpha()<t.d3AlphaMin);u++)t.forceLayout.tick();this.resetCountdown(),t.onFinishUpdate()}});function Mt(t,e){var n=t instanceof Array?t:[t],r=new e;return r._destructor&&r._destructor(),{linkProp:function(t){return{default:r[t](),onChange:function(e,r){n.forEach((function(n){return r[n][t](e)}))},triggerUpdate:!1}},linkMethod:function(t){return function(e){for(var r=arguments.length,i=new Array(r>1?r-1:0),s=1;s<r;s++)i[s-1]=arguments[s];var o=[];return n.forEach((function(n){var r=e[n],s=r[t].apply(r,i);s!==r&&o.push(s)})),o.length?o[0]:this}}}}var Et=Mt("forceGraph",St),Tt=Mt(["forceGraph","shadowGraph"],St),At=Object.assign.apply(Object,gt(["nodeColor","nodeAutoColorBy","nodeCanvasObject","nodeCanvasObjectMode","linkColor","linkAutoColorBy","linkLineDash","linkWidth","linkCanvasObject","linkCanvasObjectMode","linkDirectionalArrowLength","linkDirectionalArrowColor","linkDirectionalArrowRelPos","linkDirectionalParticles","linkDirectionalParticleSpeed","linkDirectionalParticleWidth","linkDirectionalParticleColor","dagMode","dagLevelDistance","dagNodeFilter","onDagError","d3AlphaMin","d3AlphaDecay","d3VelocityDecay","warmupTicks","cooldownTicks","cooldownTime","onEngineTick","onEngineStop"].map((function(t){return ht({},t,Et.linkProp(t))}))).concat(gt(["nodeRelSize","nodeId","nodeVal","nodeVisibility","linkSource","linkTarget","linkVisibility","linkCurvature"].map((function(t){return ht({},t,Tt.linkProp(t))}))))),Ct=Object.assign.apply(Object,gt(["d3Force","d3ReheatSimulation","emitParticle"].map((function(t){return ht({},t,Et.linkMethod(t))}))));function Rt(t){if(t.canvas){var e=t.canvas.width,n=t.canvas.height;300===e&&150===n&&(e=n=0);var r=window.devicePixelRatio;e/=r,n/=r,[t.canvas,t.shadowCanvas].forEach((function(i){i.style.width="".concat(t.width,"px"),i.style.height="".concat(t.height,"px"),i.width=t.width*r,i.height=t.height*r,e||n||i.getContext("2d").scale(r,r)}));var i=(0,s.P2)(t.canvas).k;t.zoom.translateBy(t.zoom.__baseElem,(t.width-e)/2/i,(t.height-n)/2/i),t.needsRedraw=!0}}function Nt(t){var e=window.devicePixelRatio;t.setTransform(e,0,0,e,0,0)}function Pt(t,e,n){t.save(),Nt(t),t.clearRect(0,0,e,n),t.restore()}var It=(0,p.Z)({props:ft({width:{default:window.innerWidth,onChange:function(t,e){return Rt(e)},triggerUpdate:!1},height:{default:window.innerHeight,onChange:function(t,e){return Rt(e)},triggerUpdate:!1},graphData:{default:{nodes:[],links:[]},onChange:function(t,e){[t.nodes,t.links].every((function(t){return(t||[]).every((function(t){return!t.hasOwnProperty("__indexColor")}))}))&&e.colorTracker.reset(),[{type:"Node",objs:t.nodes},{type:"Link",objs:t.links}].forEach((function(t){var n=t.type;t.objs.filter((function(t){if(!t.hasOwnProperty("__indexColor"))return!0;var n=e.colorTracker.lookup(t.__indexColor);return!n||!n.hasOwnProperty("d")||n.d!==t})).forEach((function(t){t.__indexColor=e.colorTracker.register({type:n,d:t})}))})),e.forceGraph.graphData(t),e.shadowGraph.graphData(t)},triggerUpdate:!1},backgroundColor:{onChange:function(t,e){e.canvas&&t&&(e.canvas.style.background=t)},triggerUpdate:!1},nodeLabel:{default:"name",triggerUpdate:!1},nodePointerAreaPaint:{onChange:function(t,e){e.shadowGraph.nodeCanvasObject(t?function(e,n,r){return t(e,e.__indexColor,n,r)}:null),e.flushShadowCanvas&&e.flushShadowCanvas()},triggerUpdate:!1},linkPointerAreaPaint:{onChange:function(t,e){e.shadowGraph.linkCanvasObject(t?function(e,n,r){return t(e,e.__indexColor,n,r)}:null),e.flushShadowCanvas&&e.flushShadowCanvas()},triggerUpdate:!1},linkLabel:{default:"name",triggerUpdate:!1},linkHoverPrecision:{default:4,triggerUpdate:!1},minZoom:{default:.01,onChange:function(t,e){e.zoom.scaleExtent([t,e.zoom.scaleExtent()[1]])},triggerUpdate:!1},maxZoom:{default:1e3,onChange:function(t,e){e.zoom.scaleExtent([e.zoom.scaleExtent()[0],t])},triggerUpdate:!1},enableNodeDrag:{default:!0,triggerUpdate:!1},enableZoomInteraction:{default:!0,triggerUpdate:!1},enablePanInteraction:{default:!0,triggerUpdate:!1},enableZoomPanInteraction:{default:!0,triggerUpdate:!1},enablePointerInteraction:{default:!0,onChange:function(t,e){e.hoverObj=null},triggerUpdate:!1},autoPauseRedraw:{default:!0,triggerUpdate:!1},onNodeDrag:{default:function(){},triggerUpdate:!1},onNodeDragEnd:{default:function(){},triggerUpdate:!1},onNodeClick:{triggerUpdate:!1},onNodeRightClick:{triggerUpdate:!1},onNodeHover:{triggerUpdate:!1},onLinkClick:{triggerUpdate:!1},onLinkRightClick:{triggerUpdate:!1},onLinkHover:{triggerUpdate:!1},onBackgroundClick:{triggerUpdate:!1},onBackgroundRightClick:{triggerUpdate:!1},onZoom:{triggerUpdate:!1},onZoomEnd:{triggerUpdate:!1},onRenderFramePre:{triggerUpdate:!1},onRenderFramePost:{triggerUpdate:!1}},At),aliases:{stopAnimation:"pauseAnimation"},methods:ft({graph2ScreenCoords:function(t,e,n){var r=(0,s.P2)(t.canvas);return{x:e*r.k+r.x,y:n*r.k+r.y}},screen2GraphCoords:function(t,e,n){var r=(0,s.P2)(t.canvas);return{x:(e-r.x)/r.k,y:(n-r.y)/r.k}},centerAt:function(t,e,n,r){if(!t.canvas)return null;if(void 0!==e||void 0!==n){var i=Object.assign({},void 0!==e?{x:e}:{},void 0!==n?{y:n}:{});return r?t.tweenGroup.add(new d.kX(o()).to(i,r).easing(d.oY.Quadratic.Out).onUpdate(a).start()):a(i),this}return o();function o(){var e=(0,s.P2)(t.canvas);return{x:(t.width/2-e.x)/e.k,y:(t.height/2-e.y)/e.k}}function a(e){var n=e.x,r=e.y;t.zoom.translateTo(t.zoom.__baseElem,void 0===n?o().x:n,void 0===r?o().y:r),t.needsRedraw=!0}},zoom:function(t,e,n){return t.canvas?void 0!==e?(n?t.tweenGroup.add(new d.kX({k:r()}).to({k:e},n).easing(d.oY.Quadratic.Out).onUpdate((function(t){return i(t.k)})).start()):i(e),this):r():null;function r(){return(0,s.P2)(t.canvas).k}function i(e){t.zoom.scaleTo(t.zoom.__baseElem,e),t.needsRedraw=!0}},zoomToFit:function(t){for(var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10,r=arguments.length,i=new Array(r>3?r-3:0),s=3;s<r;s++)i[s-3]=arguments[s];var o=this.getGraphBbox.apply(this,i);if(o){var a={x:(o.x[0]+o.x[1])/2,y:(o.y[0]+o.y[1])/2},l=Math.max(1e-12,Math.min(1e12,(t.width-2*n)/(o.x[1]-o.x[0]),(t.height-2*n)/(o.y[1]-o.y[0])));this.centerAt(a.x,a.y,e),this.zoom(l,e)}return this},getGraphBbox:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){return!0},n=(0,f.Z)(t.nodeVal),r=function(e){return Math.sqrt(Math.max(0,n(e)||1))*t.nodeRelSize},i=t.graphData.nodes.filter(e).map((function(t){return{x:t.x,y:t.y,r:r(t)}}));return i.length?{x:[(0,a.Z)(i,(function(t){return t.x-t.r})),(0,l.Z)(i,(function(t){return t.x+t.r}))],y:[(0,a.Z)(i,(function(t){return t.y-t.r})),(0,l.Z)(i,(function(t){return t.y+t.r}))]}:null},pauseAnimation:function(t){return t.animationFrameRequestId&&(cancelAnimationFrame(t.animationFrameRequestId),t.animationFrameRequestId=null),this},resumeAnimation:function(t){return t.animationFrameRequestId||this._animationCycle(),this},_destructor:function(){this.pauseAnimation(),this.graphData({nodes:[],links:[]})}},Ct),stateInit:function(){return{lastSetZoom:1,zoom:(0,s.sP)(),forceGraph:new St,shadowGraph:(new St).cooldownTicks(0).nodeColor("__indexColor").linkColor("__indexColor").isShadow(!0),colorTracker:new R,tweenGroup:new d.ZA}},init:function(t,e){var n=this;t.innerHTML="";var r=document.createElement("div");r.classList.add("force-graph-container"),r.style.position="relative",t.appendChild(r),e.canvas=document.createElement("canvas"),e.backgroundColor&&(e.canvas.style.background=e.backgroundColor),r.appendChild(e.canvas),e.shadowCanvas=document.createElement("canvas");var a=e.canvas.getContext("2d"),l=e.shadowCanvas.getContext("2d",{willReadFrequently:!0}),u={x:-1e12,y:-1e12},c=function(){var t=null,n=window.devicePixelRatio,r=u.x>0&&u.y>0?l.getImageData(u.x*n,u.y*n,1,1):null;return r&&(t=e.colorTracker.lookup(r.data)),t};(0,i.Z)(e.canvas).call((0,o.Z)().subject((function(){if(!e.enableNodeDrag)return null;var t=c();return t&&"Node"===t.type?t.d:null})).on("start",(function(t){var n=t.subject;n.__initialDragPos={x:n.x,y:n.y,fx:n.fx,fy:n.fy},t.active||(n.fx=n.x,n.fy=n.y),e.canvas.classList.add("grabbable")})).on("drag",(function(t){var n=t.subject,r=n.__initialDragPos,i=t,o=(0,s.P2)(e.canvas).k,a={x:r.x+(i.x-r.x)/o-n.x,y:r.y+(i.y-r.y)/o-n.y};["x","y"].forEach((function(t){return n["f".concat(t)]=n[t]=r[t]+(i[t]-r[t])/o})),e.forceGraph.d3AlphaTarget(.3).resetCountdown(),e.isPointerDragging=!0,n.__dragged=!0,e.onNodeDrag(n,a)})).on("end",(function(t){var n=t.subject,r=n.__initialDragPos,i={x:n.x-r.x,y:n.y-r.y};void 0===r.fx&&(n.fx=void 0),void 0===r.fy&&(n.fy=void 0),delete n.__initialDragPos,e.forceGraph.d3AlphaTarget()&&e.forceGraph.d3AlphaTarget(0).resetCountdown(),e.canvas.classList.remove("grabbable"),e.isPointerDragging=!1,n.__dragged&&(delete n.__dragged,e.onNodeDragEnd(n,i))}))),e.zoom(e.zoom.__baseElem=(0,i.Z)(e.canvas)),e.zoom.__baseElem.on("dblclick.zoom",null),e.zoom.filter((function(t){return!t.button&&e.enableZoomPanInteraction&&("wheel"!==t.type||(0,f.Z)(e.enableZoomInteraction)(t))&&("wheel"===t.type||(0,f.Z)(e.enablePanInteraction)(t))})).on("zoom",(function(t){var r=t.transform;[a,l].forEach((function(t){Nt(t),t.translate(r.x,r.y),t.scale(r.k,r.k)})),e.onZoom&&e.onZoom(ft(ft({},r),n.centerAt())),e.needsRedraw=!0})).on("end",(function(t){return e.onZoomEnd&&e.onZoomEnd(ft(ft({},t.transform),n.centerAt()))})),Rt(e),e.forceGraph.onNeedsRedraw((function(){return e.needsRedraw=!0})).onFinishUpdate((function(){(0,s.P2)(e.canvas).k===e.lastSetZoom&&e.graphData.nodes.length&&(e.zoom.scaleTo(e.zoom.__baseElem,e.lastSetZoom=4/Math.cbrt(e.graphData.nodes.length)),e.needsRedraw=!0)}));var d=document.createElement("div");d.classList.add("graph-tooltip"),r.appendChild(d),["pointermove","pointerdown"].forEach((function(t){return r.addEventListener(t,(function(n){"pointerdown"===t&&(e.isPointerPressed=!0,e.pointerDownEvent=n),!e.isPointerDragging&&"pointermove"===n.type&&e.onBackgroundClick&&(n.pressure>0||e.isPointerPressed)&&("touch"!==n.pointerType||void 0===n.movementX||[n.movementX,n.movementY].some((function(t){return Math.abs(t)>1})))&&(e.isPointerDragging=!0);var i,s,o,a=(i=r.getBoundingClientRect(),s=window.pageXOffset||document.documentElement.scrollLeft,o=window.pageYOffset||document.documentElement.scrollTop,{top:i.top+o,left:i.left+s});u.x=n.pageX-a.left,u.y=n.pageY-a.top,d.style.top="".concat(u.y,"px"),d.style.left="".concat(u.x,"px"),d.style.transform="translate(-".concat(u.x/e.width*100,"%, ").concat(e.height-u.y<100?"calc(-100% - 8px)":"21px",")")}),{passive:!0})})),r.addEventListener("pointerup",(function(t){if(e.isPointerPressed=!1,e.isPointerDragging)e.isPointerDragging=!1;else{var n=[t,e.pointerDownEvent];requestAnimationFrame((function(){if(0===t.button)if(e.hoverObj){var r=e["on".concat(e.hoverObj.type,"Click")];r&&r.apply(void 0,[e.hoverObj.d].concat(n))}else e.onBackgroundClick&&e.onBackgroundClick.apply(e,n);if(2===t.button)if(e.hoverObj){var i=e["on".concat(e.hoverObj.type,"RightClick")];i&&i.apply(void 0,[e.hoverObj.d].concat(n))}else e.onBackgroundRightClick&&e.onBackgroundRightClick.apply(e,n)}))}}),{passive:!0}),r.addEventListener("contextmenu",(function(t){return!(e.onBackgroundRightClick||e.onNodeRightClick||e.onLinkRightClick)||(t.preventDefault(),!1)})),e.forceGraph(a),e.shadowGraph(l);var p=h((function(){Pt(l,e.width,e.height),e.shadowGraph.linkWidth((function(t){return(0,f.Z)(e.linkWidth)(t)+e.linkHoverPrecision}));var t=(0,s.P2)(e.canvas);e.shadowGraph.globalScale(t.k).tickFrame()}),800);e.flushShadowCanvas=p.flush,(this._animationCycle=function t(){var n=!e.autoPauseRedraw||!!e.needsRedraw||e.forceGraph.isEngineRunning()||e.graphData.links.some((function(t){return t.__photons&&t.__photons.length}));if(e.needsRedraw=!1,e.enablePointerInteraction){var r=e.isPointerDragging?null:c();if(r!==e.hoverObj){var i=e.hoverObj,o=i?i.type:null,l=r?r.type:null;if(o&&o!==l){var u=e["on".concat(o,"Hover")];u&&u(null,i.d)}if(l){var h=e["on".concat(l,"Hover")];h&&h(r.d,o===l?i.d:null)}var m=r&&(0,f.Z)(e["".concat(r.type.toLowerCase(),"Label")])(r.d)||"";d.style.visibility=m?"visible":"hidden",d.innerHTML=m,e.canvas.classList[r&&e["on".concat(l,"Click")]||!r&&e.onBackgroundClick?"add":"remove"]("clickable"),e.hoverObj=r}n&&p()}if(n){Pt(a,e.width,e.height);var g=(0,s.P2)(e.canvas).k;e.onRenderFramePre&&e.onRenderFramePre(a,g),e.forceGraph.globalScale(g).tickFrame(),e.onRenderFramePost&&e.onRenderFramePost(a,g)}e.tweenGroup.update(),e.animationFrameRequestId=requestAnimationFrame(t)})()},update:function(t){}})},53874:function(t,e,n){"use strict";n.d(e,{Fl:function(){return q},Uy:function(){return W}});var r=Symbol.for("immer-nothing"),i=Symbol.for("immer-draftable"),s=Symbol.for("immer-state");function o(t,...e){throw new Error(`[Immer] minified error nr: ${t}. Full error at: https://bit.ly/3cXEKWf`)}var a=Object.getPrototypeOf;function l(t){return!!t&&!!t[s]}function u(t){return!!t&&(h(t)||Array.isArray(t)||!!t[i]||!!t.constructor?.[i]||g(t)||v(t))}var c=Object.prototype.constructor.toString();function h(t){if(!t||"object"!=typeof t)return!1;const e=a(t);if(null===e)return!0;const n=Object.hasOwnProperty.call(e,"constructor")&&e.constructor;return n===Object||"function"==typeof n&&Function.toString.call(n)===c}function d(t,e){0===p(t)?Reflect.ownKeys(t).forEach((n=>{e(n,t[n],t)})):t.forEach(((n,r)=>e(r,n,t)))}function p(t){const e=t[s];return e?e.type_:Array.isArray(t)?1:g(t)?2:v(t)?3:0}function f(t,e){return 2===p(t)?t.has(e):Object.prototype.hasOwnProperty.call(t,e)}function m(t,e,n){const r=p(t);2===r?t.set(e,n):3===r?t.add(n):t[e]=n}function g(t){return t instanceof Map}function v(t){return t instanceof Set}function y(t){return t.copy_||t.base_}function _(t,e){if(g(t))return new Map(t);if(v(t))return new Set(t);if(Array.isArray(t))return Array.prototype.slice.call(t);const n=h(t);if(!0===e||"class_only"===e&&!n){const e=Object.getOwnPropertyDescriptors(t);delete e[s];let n=Reflect.ownKeys(e);for(let r=0;r<n.length;r++){const i=n[r],s=e[i];!1===s.writable&&(s.writable=!0,s.configurable=!0),(s.get||s.set)&&(e[i]={configurable:!0,writable:!0,enumerable:s.enumerable,value:t[i]})}return Object.create(a(t),e)}{const e=a(t);if(null!==e&&n)return{...t};const r=Object.create(e);return Object.assign(r,t)}}function x(t,e=!1){return w(t)||l(t)||!u(t)||(p(t)>1&&(t.set=t.add=t.clear=t.delete=b),Object.freeze(t),e&&Object.entries(t).forEach((([t,e])=>x(e,!0)))),t}function b(){o(2)}function w(t){return Object.isFrozen(t)}var S,M={};function E(t){const e=M[t];return e||o(0),e}function T(){return S}function A(t,e){e&&(E("Patches"),t.patches_=[],t.inversePatches_=[],t.patchListener_=e)}function C(t){R(t),t.drafts_.forEach(P),t.drafts_=null}function R(t){t===S&&(S=t.parent_)}function N(t){return S={drafts_:[],parent_:S,immer_:t,canAutoFreeze_:!0,unfinalizedDrafts_:0}}function P(t){const e=t[s];0===e.type_||1===e.type_?e.revoke_():e.revoked_=!0}function I(t,e){e.unfinalizedDrafts_=e.drafts_.length;const n=e.drafts_[0];return void 0!==t&&t!==n?(n[s].modified_&&(C(e),o(4)),u(t)&&(t=O(e,t),e.parent_||L(e,t)),e.patches_&&E("Patches").generateReplacementPatches_(n[s].base_,t,e.patches_,e.inversePatches_)):t=O(e,n,[]),C(e),e.patches_&&e.patchListener_(e.patches_,e.inversePatches_),t!==r?t:void 0}function O(t,e,n){if(w(e))return e;const r=e[s];if(!r)return d(e,((i,s)=>D(t,r,e,i,s,n))),e;if(r.scope_!==t)return e;if(!r.modified_)return L(t,r.base_,!0),r.base_;if(!r.finalized_){r.finalized_=!0,r.scope_.unfinalizedDrafts_--;const e=r.copy_;let i=e,s=!1;3===r.type_&&(i=new Set(e),e.clear(),s=!0),d(i,((i,o)=>D(t,r,e,i,o,n,s))),L(t,e,!1),n&&t.patches_&&E("Patches").generatePatches_(r,n,t.patches_,t.inversePatches_)}return r.copy_}function D(t,e,n,r,i,s,o){if(l(i)){const o=O(t,i,s&&e&&3!==e.type_&&!f(e.assigned_,r)?s.concat(r):void 0);if(m(n,r,o),!l(o))return;t.canAutoFreeze_=!1}else o&&n.add(i);if(u(i)&&!w(i)){if(!t.immer_.autoFreeze_&&t.unfinalizedDrafts_<1)return;O(t,i),e&&e.scope_.parent_||"symbol"==typeof r||!Object.prototype.propertyIsEnumerable.call(n,r)||L(t,i)}}function L(t,e,n=!1){!t.parent_&&t.immer_.autoFreeze_&&t.canAutoFreeze_&&x(e,n)}var U={get(t,e){if(e===s)return t;const n=y(t);if(!f(n,e))return function(t,e,n){const r=F(e,n);return r?"value"in r?r.value:r.get?.call(t.draft_):void 0}(t,n,e);const r=n[e];return t.finalized_||!u(r)?r:r===B(t.base_,e)?(V(t),t.copy_[e]=G(r,t)):r},has(t,e){return e in y(t)},ownKeys(t){return Reflect.ownKeys(y(t))},set(t,e,n){const r=F(y(t),e);if(r?.set)return r.set.call(t.draft_,n),!0;if(!t.modified_){const r=B(y(t),e),a=r?.[s];if(a&&a.base_===n)return t.copy_[e]=n,t.assigned_[e]=!1,!0;if(((i=n)===(o=r)?0!==i||1/i==1/o:i!=i&&o!=o)&&(void 0!==n||f(t.base_,e)))return!0;V(t),z(t)}var i,o;return t.copy_[e]===n&&(void 0!==n||e in t.copy_)||Number.isNaN(n)&&Number.isNaN(t.copy_[e])||(t.copy_[e]=n,t.assigned_[e]=!0),!0},deleteProperty(t,e){return void 0!==B(t.base_,e)||e in t.base_?(t.assigned_[e]=!1,V(t),z(t)):delete t.assigned_[e],t.copy_&&delete t.copy_[e],!0},getOwnPropertyDescriptor(t,e){const n=y(t),r=Reflect.getOwnPropertyDescriptor(n,e);return r?{writable:!0,configurable:1!==t.type_||"length"!==e,enumerable:r.enumerable,value:n[e]}:r},defineProperty(){o(11)},getPrototypeOf(t){return a(t.base_)},setPrototypeOf(){o(12)}},k={};function B(t,e){const n=t[s];return(n?y(n):t)[e]}function F(t,e){if(!(e in t))return;let n=a(t);for(;n;){const t=Object.getOwnPropertyDescriptor(n,e);if(t)return t;n=a(n)}}function z(t){t.modified_||(t.modified_=!0,t.parent_&&z(t.parent_))}function V(t){t.copy_||(t.copy_=_(t.base_,t.scope_.immer_.useStrictShallowCopy_))}d(U,((t,e)=>{k[t]=function(){return arguments[0]=arguments[0][0],e.apply(this,arguments)}})),k.deleteProperty=function(t,e){return k.set.call(this,t,e,void 0)},k.set=function(t,e,n){return U.set.call(this,t[0],e,n,t[0])};function G(t,e){const n=g(t)?E("MapSet").proxyMap_(t,e):v(t)?E("MapSet").proxySet_(t,e):function(t,e){const n=Array.isArray(t),r={type_:n?1:0,scope_:e?e.scope_:T(),modified_:!1,finalized_:!1,assigned_:{},parent_:e,base_:t,draft_:null,copy_:null,revoke_:null,isManual_:!1};let i=r,s=U;n&&(i=[r],s=k);const{revoke:o,proxy:a}=Proxy.revocable(i,s);return r.draft_=a,r.revoke_=o,a}(t,e);return(e?e.scope_:T()).drafts_.push(n),n}function j(t){if(!u(t)||w(t))return t;const e=t[s];let n;if(e){if(!e.modified_)return e.base_;e.finalized_=!0,n=_(t,e.scope_.immer_.useStrictShallowCopy_)}else n=_(t,!0);return d(n,((t,e)=>{m(n,t,j(e))})),e&&(e.finalized_=!1),n}var H=new class{constructor(t){this.autoFreeze_=!0,this.useStrictShallowCopy_=!1,this.produce=(t,e,n)=>{if("function"==typeof t&&"function"!=typeof e){const n=e;e=t;const r=this;return function(t=n,...i){return r.produce(t,(t=>e.call(this,t,...i)))}}let i;if("function"!=typeof e&&o(6),void 0!==n&&"function"!=typeof n&&o(7),u(t)){const r=N(this),s=G(t,void 0);let o=!0;try{i=e(s),o=!1}finally{o?C(r):R(r)}return A(r,n),I(i,r)}if(!t||"object"!=typeof t){if(i=e(t),void 0===i&&(i=t),i===r&&(i=void 0),this.autoFreeze_&&x(i,!0),n){const e=[],r=[];E("Patches").generateReplacementPatches_(t,i,e,r),n(e,r)}return i}o(1)},this.produceWithPatches=(t,e)=>{if("function"==typeof t)return(e,...n)=>this.produceWithPatches(e,(e=>t(e,...n)));let n,r;return[this.produce(t,e,((t,e)=>{n=t,r=e})),n,r]},"boolean"==typeof t?.autoFreeze&&this.setAutoFreeze(t.autoFreeze),"boolean"==typeof t?.useStrictShallowCopy&&this.setUseStrictShallowCopy(t.useStrictShallowCopy)}createDraft(t){u(t)||o(8),l(t)&&(t=function(t){l(t)||o(10);return j(t)}(t));const e=N(this),n=G(t,void 0);return n[s].isManual_=!0,R(e),n}finishDraft(t,e){const n=t&&t[s];n&&n.isManual_||o(9);const{scope_:r}=n;return A(r,e),I(void 0,r)}setAutoFreeze(t){this.autoFreeze_=t}setUseStrictShallowCopy(t){this.useStrictShallowCopy_=t}applyPatches(t,e){let n;for(n=e.length-1;n>=0;n--){const r=e[n];if(0===r.path.length&&"replace"===r.op){t=r.value;break}}n>-1&&(e=e.slice(n+1));const r=E("Patches").applyPatches_;return l(t)?r(t,e):this.produce(t,(t=>r(t,e)))}},W=H.produce,q=(H.produceWithPatches.bind(H),H.setAutoFreeze.bind(H));H.setUseStrictShallowCopy.bind(H),H.applyPatches.bind(H),H.createDraft.bind(H),H.finishDraft.bind(H)},37996:function(t,e,n){"use strict";function r(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}function i(t,e){if(null==t)return{};var n,r,i=function(t,e){if(null==t)return{};var n={};for(var r in t)if({}.hasOwnProperty.call(t,r)){if(e.includes(r))continue;n[r]=t[r]}return n}(t,e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);for(r=0;r<s.length;r++)n=s[r],e.includes(n)||{}.propertyIsEnumerable.call(t,n)&&(i[n]=t[n])}return i}function s(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,i,s,o,a=[],l=!0,u=!1;try{if(s=(n=n.call(t)).next,0===e);else for(;!(l=(r=s.call(n)).done)&&(a.push(r.value),a.length!==e);l=!0);}catch(t){u=!0,i=t}finally{try{if(!l&&null!=n.return&&(o=n.return(),Object(o)!==o))return}finally{if(u)throw i}}return a}}(t,e)||l(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function o(t){return function(t){if(Array.isArray(t))return r(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||l(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function a(t){var e=function(t,e){if("object"!=typeof t||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,e);if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t,"string");return"symbol"==typeof e?e:e+""}function l(t,e){if(t){if("string"==typeof t)return r(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?r(t,e):void 0}}n.d(e,{Z:function(){return u}});var u=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],l=(e instanceof Array?e.length?e:[void 0]:[e]).map((function(t){return{keyAccessor:t,isProp:!(t instanceof Function)}})),u=t.reduce((function(t,e){var r=t,s=e;return l.forEach((function(t,e){var o,u=t.keyAccessor;if(t.isProp){var c=s,h=c[u],d=i(c,[u].map(a));o=h,s=d}else o=u(s,e);e+1<l.length?(r.hasOwnProperty(o)||(r[o]={}),r=r[o]):n?(r.hasOwnProperty(o)||(r[o]=[]),r[o].push(s)):r[o]=s})),t}),{});n instanceof Function&&function t(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;r===l.length?Object.keys(e).forEach((function(t){return e[t]=n(e[t])})):Object.values(e).forEach((function(e){return t(e,r+1)}))}(u);var c=u;return r&&(c=[],function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];n.length===l.length?c.push({keys:n,vals:e}):Object.entries(e).forEach((function(e){var r=s(e,2),i=r[0],a=r[1];return t(a,[].concat(o(n),[i]))}))}(u),e instanceof Array&&0===e.length&&1===c.length&&(c[0].keys=[])),c}},14131:function(t,e,n){"use strict";n.d(e,{L:function(){return r}});class r extends Map{constructor(t,e=a){if(super(),Object.defineProperties(this,{_intern:{value:new Map},_key:{value:e}}),null!=t)for(const[e,n]of t)this.set(e,n)}get(t){return super.get(i(this,t))}has(t){return super.has(i(this,t))}set(t,e){return super.set(s(this,t),e)}delete(t){return super.delete(o(this,t))}}function i({_intern:t,_key:e},n){const r=e(n);return t.has(r)?t.get(r):n}function s({_intern:t,_key:e},n){const r=e(n);return t.has(r)?t.get(r):(t.set(r,n),n)}function o({_intern:t,_key:e},n){const r=e(n);return t.has(r)&&(n=t.get(r),t.delete(r)),n}function a(t){return null!==t&&"object"==typeof t?t.valueOf():t}},80487:function(t,e,n){"use strict";function r(t){return null==t}var i={isNothing:r,isObject:function(t){return"object"==typeof t&&null!==t},toArray:function(t){return Array.isArray(t)?t:r(t)?[]:[t]},repeat:function(t,e){var n,r="";for(n=0;n<e;n+=1)r+=t;return r},isNegativeZero:function(t){return 0===t&&Number.NEGATIVE_INFINITY===1/t},extend:function(t,e){var n,r,i,s;if(e)for(n=0,r=(s=Object.keys(e)).length;n<r;n+=1)t[i=s[n]]=e[i];return t}};function s(t,e){var n="",r=t.reason||"(unknown reason)";return t.mark?(t.mark.name&&(n+='in "'+t.mark.name+'" '),n+="("+(t.mark.line+1)+":"+(t.mark.column+1)+")",!e&&t.mark.snippet&&(n+="\n\n"+t.mark.snippet),r+" "+n):r}function o(t,e){Error.call(this),this.name="YAMLException",this.reason=t,this.mark=e,this.message=s(this,!1),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=(new Error).stack||""}o.prototype=Object.create(Error.prototype),o.prototype.constructor=o,o.prototype.toString=function(t){return this.name+": "+s(this,t)};var a=o;function l(t,e,n,r,i){var s="",o="",a=Math.floor(i/2)-1;return r-e>a&&(e=r-a+(s=" ... ").length),n-r>a&&(n=r+a-(o=" ...").length),{str:s+t.slice(e,n).replace(/\t/g,"")+o,pos:r-e+s.length}}function u(t,e){return i.repeat(" ",e-t.length)+t}var c=function(t,e){if(e=Object.create(e||null),!t.buffer)return null;e.maxLength||(e.maxLength=79),"number"!=typeof e.indent&&(e.indent=1),"number"!=typeof e.linesBefore&&(e.linesBefore=3),"number"!=typeof e.linesAfter&&(e.linesAfter=2);for(var n,r=/\r?\n|\r|\0/g,s=[0],o=[],a=-1;n=r.exec(t.buffer);)o.push(n.index),s.push(n.index+n[0].length),t.position<=n.index&&a<0&&(a=s.length-2);a<0&&(a=s.length-1);var c,h,d="",p=Math.min(t.line+e.linesAfter,o.length).toString().length,f=e.maxLength-(e.indent+p+3);for(c=1;c<=e.linesBefore&&!(a-c<0);c++)h=l(t.buffer,s[a-c],o[a-c],t.position-(s[a]-s[a-c]),f),d=i.repeat(" ",e.indent)+u((t.line-c+1).toString(),p)+" | "+h.str+"\n"+d;for(h=l(t.buffer,s[a],o[a],t.position,f),d+=i.repeat(" ",e.indent)+u((t.line+1).toString(),p)+" | "+h.str+"\n",d+=i.repeat("-",e.indent+p+3+h.pos)+"^\n",c=1;c<=e.linesAfter&&!(a+c>=o.length);c++)h=l(t.buffer,s[a+c],o[a+c],t.position-(s[a]-s[a+c]),f),d+=i.repeat(" ",e.indent)+u((t.line+c+1).toString(),p)+" | "+h.str+"\n";return d.replace(/\n$/,"")},h=["kind","multi","resolve","construct","instanceOf","predicate","represent","representName","defaultStyle","styleAliases"],d=["scalar","sequence","mapping"];var p=function(t,e){if(e=e||{},Object.keys(e).forEach((function(e){if(-1===h.indexOf(e))throw new a('Unknown option "'+e+'" is met in definition of "'+t+'" YAML type.')})),this.options=e,this.tag=t,this.kind=e.kind||null,this.resolve=e.resolve||function(){return!0},this.construct=e.construct||function(t){return t},this.instanceOf=e.instanceOf||null,this.predicate=e.predicate||null,this.represent=e.represent||null,this.representName=e.representName||null,this.defaultStyle=e.defaultStyle||null,this.multi=e.multi||!1,this.styleAliases=function(t){var e={};return null!==t&&Object.keys(t).forEach((function(n){t[n].forEach((function(t){e[String(t)]=n}))})),e}(e.styleAliases||null),-1===d.indexOf(this.kind))throw new a('Unknown kind "'+this.kind+'" is specified for "'+t+'" YAML type.')};function f(t,e){var n=[];return t[e].forEach((function(t){var e=n.length;n.forEach((function(n,r){n.tag===t.tag&&n.kind===t.kind&&n.multi===t.multi&&(e=r)})),n[e]=t})),n}function m(t){return this.extend(t)}m.prototype.extend=function(t){var e=[],n=[];if(t instanceof p)n.push(t);else if(Array.isArray(t))n=n.concat(t);else{if(!t||!Array.isArray(t.implicit)&&!Array.isArray(t.explicit))throw new a("Schema.extend argument should be a Type, [ Type ], or a schema definition ({ implicit: [...], explicit: [...] })");t.implicit&&(e=e.concat(t.implicit)),t.explicit&&(n=n.concat(t.explicit))}e.forEach((function(t){if(!(t instanceof p))throw new a("Specified list of YAML types (or a single Type object) contains a non-Type object.");if(t.loadKind&&"scalar"!==t.loadKind)throw new a("There is a non-scalar type in the implicit list of a schema. Implicit resolving of such types is not supported.");if(t.multi)throw new a("There is a multi type in the implicit list of a schema. Multi tags can only be listed as explicit.")})),n.forEach((function(t){if(!(t instanceof p))throw new a("Specified list of YAML types (or a single Type object) contains a non-Type object.")}));var r=Object.create(m.prototype);return r.implicit=(this.implicit||[]).concat(e),r.explicit=(this.explicit||[]).concat(n),r.compiledImplicit=f(r,"implicit"),r.compiledExplicit=f(r,"explicit"),r.compiledTypeMap=function(){var t,e,n={scalar:{},sequence:{},mapping:{},fallback:{},multi:{scalar:[],sequence:[],mapping:[],fallback:[]}};function r(t){t.multi?(n.multi[t.kind].push(t),n.multi.fallback.push(t)):n[t.kind][t.tag]=n.fallback[t.tag]=t}for(t=0,e=arguments.length;t<e;t+=1)arguments[t].forEach(r);return n}(r.compiledImplicit,r.compiledExplicit),r};var g=m,v=new p("tag:yaml.org,2002:str",{kind:"scalar",construct:function(t){return null!==t?t:""}}),y=new p("tag:yaml.org,2002:seq",{kind:"sequence",construct:function(t){return null!==t?t:[]}}),_=new p("tag:yaml.org,2002:map",{kind:"mapping",construct:function(t){return null!==t?t:{}}}),x=new g({explicit:[v,y,_]});var b=new p("tag:yaml.org,2002:null",{kind:"scalar",resolve:function(t){if(null===t)return!0;var e=t.length;return 1===e&&"~"===t||4===e&&("null"===t||"Null"===t||"NULL"===t)},construct:function(){return null},predicate:function(t){return null===t},represent:{canonical:function(){return"~"},lowercase:function(){return"null"},uppercase:function(){return"NULL"},camelcase:function(){return"Null"},empty:function(){return""}},defaultStyle:"lowercase"});var w=new p("tag:yaml.org,2002:bool",{kind:"scalar",resolve:function(t){if(null===t)return!1;var e=t.length;return 4===e&&("true"===t||"True"===t||"TRUE"===t)||5===e&&("false"===t||"False"===t||"FALSE"===t)},construct:function(t){return"true"===t||"True"===t||"TRUE"===t},predicate:function(t){return"[object Boolean]"===Object.prototype.toString.call(t)},represent:{lowercase:function(t){return t?"true":"false"},uppercase:function(t){return t?"TRUE":"FALSE"},camelcase:function(t){return t?"True":"False"}},defaultStyle:"lowercase"});function S(t){return 48<=t&&t<=55}function M(t){return 48<=t&&t<=57}var E=new p("tag:yaml.org,2002:int",{kind:"scalar",resolve:function(t){if(null===t)return!1;var e,n,r=t.length,i=0,s=!1;if(!r)return!1;if("-"!==(e=t[i])&&"+"!==e||(e=t[++i]),"0"===e){if(i+1===r)return!0;if("b"===(e=t[++i])){for(i++;i<r;i++)if("_"!==(e=t[i])){if("0"!==e&&"1"!==e)return!1;s=!0}return s&&"_"!==e}if("x"===e){for(i++;i<r;i++)if("_"!==(e=t[i])){if(!(48<=(n=t.charCodeAt(i))&&n<=57||65<=n&&n<=70||97<=n&&n<=102))return!1;s=!0}return s&&"_"!==e}if("o"===e){for(i++;i<r;i++)if("_"!==(e=t[i])){if(!S(t.charCodeAt(i)))return!1;s=!0}return s&&"_"!==e}}if("_"===e)return!1;for(;i<r;i++)if("_"!==(e=t[i])){if(!M(t.charCodeAt(i)))return!1;s=!0}return!(!s||"_"===e)},construct:function(t){var e,n=t,r=1;if(-1!==n.indexOf("_")&&(n=n.replace(/_/g,"")),"-"!==(e=n[0])&&"+"!==e||("-"===e&&(r=-1),e=(n=n.slice(1))[0]),"0"===n)return 0;if("0"===e){if("b"===n[1])return r*parseInt(n.slice(2),2);if("x"===n[1])return r*parseInt(n.slice(2),16);if("o"===n[1])return r*parseInt(n.slice(2),8)}return r*parseInt(n,10)},predicate:function(t){return"[object Number]"===Object.prototype.toString.call(t)&&t%1==0&&!i.isNegativeZero(t)},represent:{binary:function(t){return t>=0?"0b"+t.toString(2):"-0b"+t.toString(2).slice(1)},octal:function(t){return t>=0?"0o"+t.toString(8):"-0o"+t.toString(8).slice(1)},decimal:function(t){return t.toString(10)},hexadecimal:function(t){return t>=0?"0x"+t.toString(16).toUpperCase():"-0x"+t.toString(16).toUpperCase().slice(1)}},defaultStyle:"decimal",styleAliases:{binary:[2,"bin"],octal:[8,"oct"],decimal:[10,"dec"],hexadecimal:[16,"hex"]}}),T=new RegExp("^(?:[-+]?(?:[0-9][0-9_]*)(?:\\.[0-9_]*)?(?:[eE][-+]?[0-9]+)?|\\.[0-9_]+(?:[eE][-+]?[0-9]+)?|[-+]?\\.(?:inf|Inf|INF)|\\.(?:nan|NaN|NAN))$");var A=/^[-+]?[0-9]+e/;var C=new p("tag:yaml.org,2002:float",{kind:"scalar",resolve:function(t){return null!==t&&!(!T.test(t)||"_"===t[t.length-1])},construct:function(t){var e,n;return n="-"===(e=t.replace(/_/g,"").toLowerCase())[0]?-1:1,"+-".indexOf(e[0])>=0&&(e=e.slice(1)),".inf"===e?1===n?Number.POSITIVE_INFINITY:Number.NEGATIVE_INFINITY:".nan"===e?NaN:n*parseFloat(e,10)},predicate:function(t){return"[object Number]"===Object.prototype.toString.call(t)&&(t%1!=0||i.isNegativeZero(t))},represent:function(t,e){var n;if(isNaN(t))switch(e){case"lowercase":return".nan";case"uppercase":return".NAN";case"camelcase":return".NaN"}else if(Number.POSITIVE_INFINITY===t)switch(e){case"lowercase":return".inf";case"uppercase":return".INF";case"camelcase":return".Inf"}else if(Number.NEGATIVE_INFINITY===t)switch(e){case"lowercase":return"-.inf";case"uppercase":return"-.INF";case"camelcase":return"-.Inf"}else if(i.isNegativeZero(t))return"-0.0";return n=t.toString(10),A.test(n)?n.replace("e",".e"):n},defaultStyle:"lowercase"}),R=x.extend({implicit:[b,w,E,C]}),N=R,P=new RegExp("^([0-9][0-9][0-9][0-9])-([0-9][0-9])-([0-9][0-9])$"),I=new RegExp("^([0-9][0-9][0-9][0-9])-([0-9][0-9]?)-([0-9][0-9]?)(?:[Tt]|[ \\t]+)([0-9][0-9]?):([0-9][0-9]):([0-9][0-9])(?:\\.([0-9]*))?(?:[ \\t]*(Z|([-+])([0-9][0-9]?)(?::([0-9][0-9]))?))?$");var O=new p("tag:yaml.org,2002:timestamp",{kind:"scalar",resolve:function(t){return null!==t&&(null!==P.exec(t)||null!==I.exec(t))},construct:function(t){var e,n,r,i,s,o,a,l,u=0,c=null;if(null===(e=P.exec(t))&&(e=I.exec(t)),null===e)throw new Error("Date resolve error");if(n=+e[1],r=+e[2]-1,i=+e[3],!e[4])return new Date(Date.UTC(n,r,i));if(s=+e[4],o=+e[5],a=+e[6],e[7]){for(u=e[7].slice(0,3);u.length<3;)u+="0";u=+u}return e[9]&&(c=6e4*(60*+e[10]+ +(e[11]||0)),"-"===e[9]&&(c=-c)),l=new Date(Date.UTC(n,r,i,s,o,a,u)),c&&l.setTime(l.getTime()-c),l},instanceOf:Date,represent:function(t){return t.toISOString()}});var D=new p("tag:yaml.org,2002:merge",{kind:"scalar",resolve:function(t){return"<<"===t||null===t}}),L="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=\n\r";var U=new p("tag:yaml.org,2002:binary",{kind:"scalar",resolve:function(t){if(null===t)return!1;var e,n,r=0,i=t.length,s=L;for(n=0;n<i;n++)if(!((e=s.indexOf(t.charAt(n)))>64)){if(e<0)return!1;r+=6}return r%8==0},construct:function(t){var e,n,r=t.replace(/[\r\n=]/g,""),i=r.length,s=L,o=0,a=[];for(e=0;e<i;e++)e%4==0&&e&&(a.push(o>>16&255),a.push(o>>8&255),a.push(255&o)),o=o<<6|s.indexOf(r.charAt(e));return 0===(n=i%4*6)?(a.push(o>>16&255),a.push(o>>8&255),a.push(255&o)):18===n?(a.push(o>>10&255),a.push(o>>2&255)):12===n&&a.push(o>>4&255),new Uint8Array(a)},predicate:function(t){return"[object Uint8Array]"===Object.prototype.toString.call(t)},represent:function(t){var e,n,r="",i=0,s=t.length,o=L;for(e=0;e<s;e++)e%3==0&&e&&(r+=o[i>>18&63],r+=o[i>>12&63],r+=o[i>>6&63],r+=o[63&i]),i=(i<<8)+t[e];return 0===(n=s%3)?(r+=o[i>>18&63],r+=o[i>>12&63],r+=o[i>>6&63],r+=o[63&i]):2===n?(r+=o[i>>10&63],r+=o[i>>4&63],r+=o[i<<2&63],r+=o[64]):1===n&&(r+=o[i>>2&63],r+=o[i<<4&63],r+=o[64],r+=o[64]),r}}),k=Object.prototype.hasOwnProperty,B=Object.prototype.toString;var F=new p("tag:yaml.org,2002:omap",{kind:"sequence",resolve:function(t){if(null===t)return!0;var e,n,r,i,s,o=[],a=t;for(e=0,n=a.length;e<n;e+=1){if(r=a[e],s=!1,"[object Object]"!==B.call(r))return!1;for(i in r)if(k.call(r,i)){if(s)return!1;s=!0}if(!s)return!1;if(-1!==o.indexOf(i))return!1;o.push(i)}return!0},construct:function(t){return null!==t?t:[]}}),z=Object.prototype.toString;var V=new p("tag:yaml.org,2002:pairs",{kind:"sequence",resolve:function(t){if(null===t)return!0;var e,n,r,i,s,o=t;for(s=new Array(o.length),e=0,n=o.length;e<n;e+=1){if(r=o[e],"[object Object]"!==z.call(r))return!1;if(1!==(i=Object.keys(r)).length)return!1;s[e]=[i[0],r[i[0]]]}return!0},construct:function(t){if(null===t)return[];var e,n,r,i,s,o=t;for(s=new Array(o.length),e=0,n=o.length;e<n;e+=1)r=o[e],i=Object.keys(r),s[e]=[i[0],r[i[0]]];return s}}),G=Object.prototype.hasOwnProperty;var j=new p("tag:yaml.org,2002:set",{kind:"mapping",resolve:function(t){if(null===t)return!0;var e,n=t;for(e in n)if(G.call(n,e)&&null!==n[e])return!1;return!0},construct:function(t){return null!==t?t:{}}}),H=N.extend({implicit:[O,D],explicit:[U,F,V,j]}),W=Object.prototype.hasOwnProperty,q=/[\x00-\x08\x0B\x0C\x0E-\x1F\x7F-\x84\x86-\x9F\uFFFE\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]/,X=/[\x85\u2028\u2029]/,Z=/[,\[\]\{\}]/,$=/^(?:!|!!|![a-z\-]+!)$/i,Y=/^(?:!|[^,\[\]\{\}])(?:%[0-9a-f]{2}|[0-9a-z\-#;\/\?:@&=\+\$,_\.!~\*'\(\)\[\]])*$/i;function K(t){return Object.prototype.toString.call(t)}function J(t){return 10===t||13===t}function Q(t){return 9===t||32===t}function tt(t){return 9===t||32===t||10===t||13===t}function et(t){return 44===t||91===t||93===t||123===t||125===t}function nt(t){var e;return 48<=t&&t<=57?t-48:97<=(e=32|t)&&e<=102?e-97+10:-1}function rt(t){return 48===t?"\0":97===t?"":98===t?"\b":116===t||9===t?"\t":110===t?"\n":118===t?"\v":102===t?"\f":114===t?"\r":101===t?"":32===t?" ":34===t?'"':47===t?"/":92===t?"\\":78===t?"":95===t?"":76===t?"\u2028":80===t?"\u2029":""}function it(t){return t<=65535?String.fromCharCode(t):String.fromCharCode(55296+(t-65536>>10),56320+(t-65536&1023))}for(var st=new Array(256),ot=new Array(256),at=0;at<256;at++)st[at]=rt(at)?1:0,ot[at]=rt(at);function lt(t,e){this.input=t,this.filename=e.filename||null,this.schema=e.schema||H,this.onWarning=e.onWarning||null,this.legacy=e.legacy||!1,this.json=e.json||!1,this.listener=e.listener||null,this.implicitTypes=this.schema.compiledImplicit,this.typeMap=this.schema.compiledTypeMap,this.length=t.length,this.position=0,this.line=0,this.lineStart=0,this.lineIndent=0,this.firstTabInLine=-1,this.documents=[]}function ut(t,e){var n={name:t.filename,buffer:t.input.slice(0,-1),position:t.position,line:t.line,column:t.position-t.lineStart};return n.snippet=c(n),new a(e,n)}function ct(t,e){throw ut(t,e)}function ht(t,e){t.onWarning&&t.onWarning.call(null,ut(t,e))}var dt={YAML:function(t,e,n){var r,i,s;null!==t.version&&ct(t,"duplication of %YAML directive"),1!==n.length&&ct(t,"YAML directive accepts exactly one argument"),null===(r=/^([0-9]+)\.([0-9]+)$/.exec(n[0]))&&ct(t,"ill-formed argument of the YAML directive"),i=parseInt(r[1],10),s=parseInt(r[2],10),1!==i&&ct(t,"unacceptable YAML version of the document"),t.version=n[0],t.checkLineBreaks=s<2,1!==s&&2!==s&&ht(t,"unsupported YAML version of the document")},TAG:function(t,e,n){var r,i;2!==n.length&&ct(t,"TAG directive accepts exactly two arguments"),r=n[0],i=n[1],$.test(r)||ct(t,"ill-formed tag handle (first argument) of the TAG directive"),W.call(t.tagMap,r)&&ct(t,'there is a previously declared suffix for "'+r+'" tag handle'),Y.test(i)||ct(t,"ill-formed tag prefix (second argument) of the TAG directive");try{i=decodeURIComponent(i)}catch(e){ct(t,"tag prefix is malformed: "+i)}t.tagMap[r]=i}};function pt(t,e,n,r){var i,s,o,a;if(e<n){if(a=t.input.slice(e,n),r)for(i=0,s=a.length;i<s;i+=1)9===(o=a.charCodeAt(i))||32<=o&&o<=1114111||ct(t,"expected valid JSON character");else q.test(a)&&ct(t,"the stream contains non-printable characters");t.result+=a}}function ft(t,e,n,r){var s,o,a,l;for(i.isObject(n)||ct(t,"cannot merge mappings; the provided source object is unacceptable"),a=0,l=(s=Object.keys(n)).length;a<l;a+=1)o=s[a],W.call(e,o)||(e[o]=n[o],r[o]=!0)}function mt(t,e,n,r,i,s,o,a,l){var u,c;if(Array.isArray(i))for(u=0,c=(i=Array.prototype.slice.call(i)).length;u<c;u+=1)Array.isArray(i[u])&&ct(t,"nested arrays are not supported inside keys"),"object"==typeof i&&"[object Object]"===K(i[u])&&(i[u]="[object Object]");if("object"==typeof i&&"[object Object]"===K(i)&&(i="[object Object]"),i=String(i),null===e&&(e={}),"tag:yaml.org,2002:merge"===r)if(Array.isArray(s))for(u=0,c=s.length;u<c;u+=1)ft(t,e,s[u],n);else ft(t,e,s,n);else t.json||W.call(n,i)||!W.call(e,i)||(t.line=o||t.line,t.lineStart=a||t.lineStart,t.position=l||t.position,ct(t,"duplicated mapping key")),"__proto__"===i?Object.defineProperty(e,i,{configurable:!0,enumerable:!0,writable:!0,value:s}):e[i]=s,delete n[i];return e}function gt(t){var e;10===(e=t.input.charCodeAt(t.position))?t.position++:13===e?(t.position++,10===t.input.charCodeAt(t.position)&&t.position++):ct(t,"a line break is expected"),t.line+=1,t.lineStart=t.position,t.firstTabInLine=-1}function vt(t,e,n){for(var r=0,i=t.input.charCodeAt(t.position);0!==i;){for(;Q(i);)9===i&&-1===t.firstTabInLine&&(t.firstTabInLine=t.position),i=t.input.charCodeAt(++t.position);if(e&&35===i)do{i=t.input.charCodeAt(++t.position)}while(10!==i&&13!==i&&0!==i);if(!J(i))break;for(gt(t),i=t.input.charCodeAt(t.position),r++,t.lineIndent=0;32===i;)t.lineIndent++,i=t.input.charCodeAt(++t.position)}return-1!==n&&0!==r&&t.lineIndent<n&&ht(t,"deficient indentation"),r}function yt(t){var e,n=t.position;return!(45!==(e=t.input.charCodeAt(n))&&46!==e||e!==t.input.charCodeAt(n+1)||e!==t.input.charCodeAt(n+2)||(n+=3,0!==(e=t.input.charCodeAt(n))&&!tt(e)))}function _t(t,e){1===e?t.result+=" ":e>1&&(t.result+=i.repeat("\n",e-1))}function xt(t,e){var n,r,i=t.tag,s=t.anchor,o=[],a=!1;if(-1!==t.firstTabInLine)return!1;for(null!==t.anchor&&(t.anchorMap[t.anchor]=o),r=t.input.charCodeAt(t.position);0!==r&&(-1!==t.firstTabInLine&&(t.position=t.firstTabInLine,ct(t,"tab characters must not be used in indentation")),45===r)&&tt(t.input.charCodeAt(t.position+1));)if(a=!0,t.position++,vt(t,!0,-1)&&t.lineIndent<=e)o.push(null),r=t.input.charCodeAt(t.position);else if(n=t.line,St(t,e,3,!1,!0),o.push(t.result),vt(t,!0,-1),r=t.input.charCodeAt(t.position),(t.line===n||t.lineIndent>e)&&0!==r)ct(t,"bad indentation of a sequence entry");else if(t.lineIndent<e)break;return!!a&&(t.tag=i,t.anchor=s,t.kind="sequence",t.result=o,!0)}function bt(t){var e,n,r,i,s=!1,o=!1;if(33!==(i=t.input.charCodeAt(t.position)))return!1;if(null!==t.tag&&ct(t,"duplication of a tag property"),60===(i=t.input.charCodeAt(++t.position))?(s=!0,i=t.input.charCodeAt(++t.position)):33===i?(o=!0,n="!!",i=t.input.charCodeAt(++t.position)):n="!",e=t.position,s){do{i=t.input.charCodeAt(++t.position)}while(0!==i&&62!==i);t.position<t.length?(r=t.input.slice(e,t.position),i=t.input.charCodeAt(++t.position)):ct(t,"unexpected end of the stream within a verbatim tag")}else{for(;0!==i&&!tt(i);)33===i&&(o?ct(t,"tag suffix cannot contain exclamation marks"):(n=t.input.slice(e-1,t.position+1),$.test(n)||ct(t,"named tag handle cannot contain such characters"),o=!0,e=t.position+1)),i=t.input.charCodeAt(++t.position);r=t.input.slice(e,t.position),Z.test(r)&&ct(t,"tag suffix cannot contain flow indicator characters")}r&&!Y.test(r)&&ct(t,"tag name cannot contain such characters: "+r);try{r=decodeURIComponent(r)}catch(e){ct(t,"tag name is malformed: "+r)}return s?t.tag=r:W.call(t.tagMap,n)?t.tag=t.tagMap[n]+r:"!"===n?t.tag="!"+r:"!!"===n?t.tag="tag:yaml.org,2002:"+r:ct(t,'undeclared tag handle "'+n+'"'),!0}function wt(t){var e,n;if(38!==(n=t.input.charCodeAt(t.position)))return!1;for(null!==t.anchor&&ct(t,"duplication of an anchor property"),n=t.input.charCodeAt(++t.position),e=t.position;0!==n&&!tt(n)&&!et(n);)n=t.input.charCodeAt(++t.position);return t.position===e&&ct(t,"name of an anchor node must contain at least one character"),t.anchor=t.input.slice(e,t.position),!0}function St(t,e,n,r,s){var o,a,l,u,c,h,d,p,f,m=1,g=!1,v=!1;if(null!==t.listener&&t.listener("open",t),t.tag=null,t.anchor=null,t.kind=null,t.result=null,o=a=l=4===n||3===n,r&&vt(t,!0,-1)&&(g=!0,t.lineIndent>e?m=1:t.lineIndent===e?m=0:t.lineIndent<e&&(m=-1)),1===m)for(;bt(t)||wt(t);)vt(t,!0,-1)?(g=!0,l=o,t.lineIndent>e?m=1:t.lineIndent===e?m=0:t.lineIndent<e&&(m=-1)):l=!1;if(l&&(l=g||s),1!==m&&4!==n||(p=1===n||2===n?e:e+1,f=t.position-t.lineStart,1===m?l&&(xt(t,f)||function(t,e,n){var r,i,s,o,a,l,u,c=t.tag,h=t.anchor,d={},p=Object.create(null),f=null,m=null,g=null,v=!1,y=!1;if(-1!==t.firstTabInLine)return!1;for(null!==t.anchor&&(t.anchorMap[t.anchor]=d),u=t.input.charCodeAt(t.position);0!==u;){if(v||-1===t.firstTabInLine||(t.position=t.firstTabInLine,ct(t,"tab characters must not be used in indentation")),r=t.input.charCodeAt(t.position+1),s=t.line,63!==u&&58!==u||!tt(r)){if(o=t.line,a=t.lineStart,l=t.position,!St(t,n,2,!1,!0))break;if(t.line===s){for(u=t.input.charCodeAt(t.position);Q(u);)u=t.input.charCodeAt(++t.position);if(58===u)tt(u=t.input.charCodeAt(++t.position))||ct(t,"a whitespace character is expected after the key-value separator within a block mapping"),v&&(mt(t,d,p,f,m,null,o,a,l),f=m=g=null),y=!0,v=!1,i=!1,f=t.tag,m=t.result;else{if(!y)return t.tag=c,t.anchor=h,!0;ct(t,"can not read an implicit mapping pair; a colon is missed")}}else{if(!y)return t.tag=c,t.anchor=h,!0;ct(t,"can not read a block mapping entry; a multiline key may not be an implicit key")}}else 63===u?(v&&(mt(t,d,p,f,m,null,o,a,l),f=m=g=null),y=!0,v=!0,i=!0):v?(v=!1,i=!0):ct(t,"incomplete explicit mapping pair; a key node is missed; or followed by a non-tabulated empty line"),t.position+=1,u=r;if((t.line===s||t.lineIndent>e)&&(v&&(o=t.line,a=t.lineStart,l=t.position),St(t,e,4,!0,i)&&(v?m=t.result:g=t.result),v||(mt(t,d,p,f,m,g,o,a,l),f=m=g=null),vt(t,!0,-1),u=t.input.charCodeAt(t.position)),(t.line===s||t.lineIndent>e)&&0!==u)ct(t,"bad indentation of a mapping entry");else if(t.lineIndent<e)break}return v&&mt(t,d,p,f,m,null,o,a,l),y&&(t.tag=c,t.anchor=h,t.kind="mapping",t.result=d),y}(t,f,p))||function(t,e){var n,r,i,s,o,a,l,u,c,h,d,p,f=!0,m=t.tag,g=t.anchor,v=Object.create(null);if(91===(p=t.input.charCodeAt(t.position)))o=93,u=!1,s=[];else{if(123!==p)return!1;o=125,u=!0,s={}}for(null!==t.anchor&&(t.anchorMap[t.anchor]=s),p=t.input.charCodeAt(++t.position);0!==p;){if(vt(t,!0,e),(p=t.input.charCodeAt(t.position))===o)return t.position++,t.tag=m,t.anchor=g,t.kind=u?"mapping":"sequence",t.result=s,!0;f?44===p&&ct(t,"expected the node content, but found ','"):ct(t,"missed comma between flow collection entries"),d=null,a=l=!1,63===p&&tt(t.input.charCodeAt(t.position+1))&&(a=l=!0,t.position++,vt(t,!0,e)),n=t.line,r=t.lineStart,i=t.position,St(t,e,1,!1,!0),h=t.tag,c=t.result,vt(t,!0,e),p=t.input.charCodeAt(t.position),!l&&t.line!==n||58!==p||(a=!0,p=t.input.charCodeAt(++t.position),vt(t,!0,e),St(t,e,1,!1,!0),d=t.result),u?mt(t,s,v,h,c,d,n,r,i):a?s.push(mt(t,null,v,h,c,d,n,r,i)):s.push(c),vt(t,!0,e),44===(p=t.input.charCodeAt(t.position))?(f=!0,p=t.input.charCodeAt(++t.position)):f=!1}ct(t,"unexpected end of the stream within a flow collection")}(t,p)?v=!0:(a&&function(t,e){var n,r,s,o,a,l=1,u=!1,c=!1,h=e,d=0,p=!1;if(124===(o=t.input.charCodeAt(t.position)))r=!1;else{if(62!==o)return!1;r=!0}for(t.kind="scalar",t.result="";0!==o;)if(43===(o=t.input.charCodeAt(++t.position))||45===o)1===l?l=43===o?3:2:ct(t,"repeat of a chomping mode identifier");else{if(!((s=48<=(a=o)&&a<=57?a-48:-1)>=0))break;0===s?ct(t,"bad explicit indentation width of a block scalar; it cannot be less than one"):c?ct(t,"repeat of an indentation width identifier"):(h=e+s-1,c=!0)}if(Q(o)){do{o=t.input.charCodeAt(++t.position)}while(Q(o));if(35===o)do{o=t.input.charCodeAt(++t.position)}while(!J(o)&&0!==o)}for(;0!==o;){for(gt(t),t.lineIndent=0,o=t.input.charCodeAt(t.position);(!c||t.lineIndent<h)&&32===o;)t.lineIndent++,o=t.input.charCodeAt(++t.position);if(!c&&t.lineIndent>h&&(h=t.lineIndent),J(o))d++;else{if(t.lineIndent<h){3===l?t.result+=i.repeat("\n",u?1+d:d):1===l&&u&&(t.result+="\n");break}for(r?Q(o)?(p=!0,t.result+=i.repeat("\n",u?1+d:d)):p?(p=!1,t.result+=i.repeat("\n",d+1)):0===d?u&&(t.result+=" "):t.result+=i.repeat("\n",d):t.result+=i.repeat("\n",u?1+d:d),u=!0,c=!0,d=0,n=t.position;!J(o)&&0!==o;)o=t.input.charCodeAt(++t.position);pt(t,n,t.position,!1)}}return!0}(t,p)||function(t,e){var n,r,i;if(39!==(n=t.input.charCodeAt(t.position)))return!1;for(t.kind="scalar",t.result="",t.position++,r=i=t.position;0!==(n=t.input.charCodeAt(t.position));)if(39===n){if(pt(t,r,t.position,!0),39!==(n=t.input.charCodeAt(++t.position)))return!0;r=t.position,t.position++,i=t.position}else J(n)?(pt(t,r,i,!0),_t(t,vt(t,!1,e)),r=i=t.position):t.position===t.lineStart&&yt(t)?ct(t,"unexpected end of the document within a single quoted scalar"):(t.position++,i=t.position);ct(t,"unexpected end of the stream within a single quoted scalar")}(t,p)||function(t,e){var n,r,i,s,o,a,l;if(34!==(a=t.input.charCodeAt(t.position)))return!1;for(t.kind="scalar",t.result="",t.position++,n=r=t.position;0!==(a=t.input.charCodeAt(t.position));){if(34===a)return pt(t,n,t.position,!0),t.position++,!0;if(92===a){if(pt(t,n,t.position,!0),J(a=t.input.charCodeAt(++t.position)))vt(t,!1,e);else if(a<256&&st[a])t.result+=ot[a],t.position++;else if((o=120===(l=a)?2:117===l?4:85===l?8:0)>0){for(i=o,s=0;i>0;i--)(o=nt(a=t.input.charCodeAt(++t.position)))>=0?s=(s<<4)+o:ct(t,"expected hexadecimal character");t.result+=it(s),t.position++}else ct(t,"unknown escape sequence");n=r=t.position}else J(a)?(pt(t,n,r,!0),_t(t,vt(t,!1,e)),n=r=t.position):t.position===t.lineStart&&yt(t)?ct(t,"unexpected end of the document within a double quoted scalar"):(t.position++,r=t.position)}ct(t,"unexpected end of the stream within a double quoted scalar")}(t,p)?v=!0:!function(t){var e,n,r;if(42!==(r=t.input.charCodeAt(t.position)))return!1;for(r=t.input.charCodeAt(++t.position),e=t.position;0!==r&&!tt(r)&&!et(r);)r=t.input.charCodeAt(++t.position);return t.position===e&&ct(t,"name of an alias node must contain at least one character"),n=t.input.slice(e,t.position),W.call(t.anchorMap,n)||ct(t,'unidentified alias "'+n+'"'),t.result=t.anchorMap[n],vt(t,!0,-1),!0}(t)?function(t,e,n){var r,i,s,o,a,l,u,c,h=t.kind,d=t.result;if(tt(c=t.input.charCodeAt(t.position))||et(c)||35===c||38===c||42===c||33===c||124===c||62===c||39===c||34===c||37===c||64===c||96===c)return!1;if((63===c||45===c)&&(tt(r=t.input.charCodeAt(t.position+1))||n&&et(r)))return!1;for(t.kind="scalar",t.result="",i=s=t.position,o=!1;0!==c;){if(58===c){if(tt(r=t.input.charCodeAt(t.position+1))||n&&et(r))break}else if(35===c){if(tt(t.input.charCodeAt(t.position-1)))break}else{if(t.position===t.lineStart&&yt(t)||n&&et(c))break;if(J(c)){if(a=t.line,l=t.lineStart,u=t.lineIndent,vt(t,!1,-1),t.lineIndent>=e){o=!0,c=t.input.charCodeAt(t.position);continue}t.position=s,t.line=a,t.lineStart=l,t.lineIndent=u;break}}o&&(pt(t,i,s,!1),_t(t,t.line-a),i=s=t.position,o=!1),Q(c)||(s=t.position+1),c=t.input.charCodeAt(++t.position)}return pt(t,i,s,!1),!!t.result||(t.kind=h,t.result=d,!1)}(t,p,1===n)&&(v=!0,null===t.tag&&(t.tag="?")):(v=!0,null===t.tag&&null===t.anchor||ct(t,"alias node should not have any properties")),null!==t.anchor&&(t.anchorMap[t.anchor]=t.result)):0===m&&(v=l&&xt(t,f))),null===t.tag)null!==t.anchor&&(t.anchorMap[t.anchor]=t.result);else if("?"===t.tag){for(null!==t.result&&"scalar"!==t.kind&&ct(t,'unacceptable node kind for !<?> tag; it should be "scalar", not "'+t.kind+'"'),u=0,c=t.implicitTypes.length;u<c;u+=1)if((d=t.implicitTypes[u]).resolve(t.result)){t.result=d.construct(t.result),t.tag=d.tag,null!==t.anchor&&(t.anchorMap[t.anchor]=t.result);break}}else if("!"!==t.tag){if(W.call(t.typeMap[t.kind||"fallback"],t.tag))d=t.typeMap[t.kind||"fallback"][t.tag];else for(d=null,u=0,c=(h=t.typeMap.multi[t.kind||"fallback"]).length;u<c;u+=1)if(t.tag.slice(0,h[u].tag.length)===h[u].tag){d=h[u];break}d||ct(t,"unknown tag !<"+t.tag+">"),null!==t.result&&d.kind!==t.kind&&ct(t,"unacceptable node kind for !<"+t.tag+'> tag; it should be "'+d.kind+'", not "'+t.kind+'"'),d.resolve(t.result,t.tag)?(t.result=d.construct(t.result,t.tag),null!==t.anchor&&(t.anchorMap[t.anchor]=t.result)):ct(t,"cannot resolve a node with !<"+t.tag+"> explicit tag")}return null!==t.listener&&t.listener("close",t),null!==t.tag||null!==t.anchor||v}function Mt(t){var e,n,r,i,s=t.position,o=!1;for(t.version=null,t.checkLineBreaks=t.legacy,t.tagMap=Object.create(null),t.anchorMap=Object.create(null);0!==(i=t.input.charCodeAt(t.position))&&(vt(t,!0,-1),i=t.input.charCodeAt(t.position),!(t.lineIndent>0||37!==i));){for(o=!0,i=t.input.charCodeAt(++t.position),e=t.position;0!==i&&!tt(i);)i=t.input.charCodeAt(++t.position);for(r=[],(n=t.input.slice(e,t.position)).length<1&&ct(t,"directive name must not be less than one character in length");0!==i;){for(;Q(i);)i=t.input.charCodeAt(++t.position);if(35===i){do{i=t.input.charCodeAt(++t.position)}while(0!==i&&!J(i));break}if(J(i))break;for(e=t.position;0!==i&&!tt(i);)i=t.input.charCodeAt(++t.position);r.push(t.input.slice(e,t.position))}0!==i&&gt(t),W.call(dt,n)?dt[n](t,n,r):ht(t,'unknown document directive "'+n+'"')}vt(t,!0,-1),0===t.lineIndent&&45===t.input.charCodeAt(t.position)&&45===t.input.charCodeAt(t.position+1)&&45===t.input.charCodeAt(t.position+2)?(t.position+=3,vt(t,!0,-1)):o&&ct(t,"directives end mark is expected"),St(t,t.lineIndent-1,4,!1,!0),vt(t,!0,-1),t.checkLineBreaks&&X.test(t.input.slice(s,t.position))&&ht(t,"non-ASCII line breaks are interpreted as content"),t.documents.push(t.result),t.position===t.lineStart&&yt(t)?46===t.input.charCodeAt(t.position)&&(t.position+=3,vt(t,!0,-1)):t.position<t.length-1&&ct(t,"end of the stream or a document separator is expected")}function Et(t,e){e=e||{},0!==(t=String(t)).length&&(10!==t.charCodeAt(t.length-1)&&13!==t.charCodeAt(t.length-1)&&(t+="\n"),65279===t.charCodeAt(0)&&(t=t.slice(1)));var n=new lt(t,e),r=t.indexOf("\0");for(-1!==r&&(n.position=r,ct(n,"null byte is not allowed in input")),n.input+="\0";32===n.input.charCodeAt(n.position);)n.lineIndent+=1,n.position+=1;for(;n.position<n.length-1;)Mt(n);return n.documents}var Tt={loadAll:function(t,e,n){null!==e&&"object"==typeof e&&void 0===n&&(n=e,e=null);var r=Et(t,n);if("function"!=typeof e)return r;for(var i=0,s=r.length;i<s;i+=1)e(r[i])},load:function(t,e){var n=Et(t,e);if(0!==n.length){if(1===n.length)return n[0];throw new a("expected a single document in the stream, but found more")}}},At=Object.prototype.toString,Ct=Object.prototype.hasOwnProperty,Rt=65279,Nt={0:"\\0",7:"\\a",8:"\\b",9:"\\t",10:"\\n",11:"\\v",12:"\\f",13:"\\r",27:"\\e",34:'\\"',92:"\\\\",133:"\\N",160:"\\_",8232:"\\L",8233:"\\P"},Pt=["y","Y","yes","Yes","YES","on","On","ON","n","N","no","No","NO","off","Off","OFF"],It=/^[-+]?[0-9_]+(?::[0-9_]+)+(?:\.[0-9_]*)?$/;function Ot(t){var e,n,r;if(e=t.toString(16).toUpperCase(),t<=255)n="x",r=2;else if(t<=65535)n="u",r=4;else{if(!(t<=4294967295))throw new a("code point within a string may not be greater than 0xFFFFFFFF");n="U",r=8}return"\\"+n+i.repeat("0",r-e.length)+e}function Dt(t){this.schema=t.schema||H,this.indent=Math.max(1,t.indent||2),this.noArrayIndent=t.noArrayIndent||!1,this.skipInvalid=t.skipInvalid||!1,this.flowLevel=i.isNothing(t.flowLevel)?-1:t.flowLevel,this.styleMap=function(t,e){var n,r,i,s,o,a,l;if(null===e)return{};for(n={},i=0,s=(r=Object.keys(e)).length;i<s;i+=1)o=r[i],a=String(e[o]),"!!"===o.slice(0,2)&&(o="tag:yaml.org,2002:"+o.slice(2)),(l=t.compiledTypeMap.fallback[o])&&Ct.call(l.styleAliases,a)&&(a=l.styleAliases[a]),n[o]=a;return n}(this.schema,t.styles||null),this.sortKeys=t.sortKeys||!1,this.lineWidth=t.lineWidth||80,this.noRefs=t.noRefs||!1,this.noCompatMode=t.noCompatMode||!1,this.condenseFlow=t.condenseFlow||!1,this.quotingType='"'===t.quotingType?2:1,this.forceQuotes=t.forceQuotes||!1,this.replacer="function"==typeof t.replacer?t.replacer:null,this.implicitTypes=this.schema.compiledImplicit,this.explicitTypes=this.schema.compiledExplicit,this.tag=null,this.result="",this.duplicates=[],this.usedDuplicates=null}function Lt(t,e){for(var n,r=i.repeat(" ",e),s=0,o=-1,a="",l=t.length;s<l;)-1===(o=t.indexOf("\n",s))?(n=t.slice(s),s=l):(n=t.slice(s,o+1),s=o+1),n.length&&"\n"!==n&&(a+=r),a+=n;return a}function Ut(t,e){return"\n"+i.repeat(" ",t.indent*e)}function kt(t){return 32===t||9===t}function Bt(t){return 32<=t&&t<=126||161<=t&&t<=55295&&8232!==t&&8233!==t||57344<=t&&t<=65533&&t!==Rt||65536<=t&&t<=1114111}function Ft(t){return Bt(t)&&t!==Rt&&13!==t&&10!==t}function zt(t,e,n){var r=Ft(t),i=r&&!kt(t);return(n?r:r&&44!==t&&91!==t&&93!==t&&123!==t&&125!==t)&&35!==t&&!(58===e&&!i)||Ft(e)&&!kt(e)&&35===t||58===e&&i}function Vt(t,e){var n,r=t.charCodeAt(e);return r>=55296&&r<=56319&&e+1<t.length&&(n=t.charCodeAt(e+1))>=56320&&n<=57343?1024*(r-55296)+n-56320+65536:r}function Gt(t){return/^\n* /.test(t)}function jt(t,e,n,r,i,s,o,a){var l,u,c=0,h=null,d=!1,p=!1,f=-1!==r,m=-1,g=Bt(u=Vt(t,0))&&u!==Rt&&!kt(u)&&45!==u&&63!==u&&58!==u&&44!==u&&91!==u&&93!==u&&123!==u&&125!==u&&35!==u&&38!==u&&42!==u&&33!==u&&124!==u&&61!==u&&62!==u&&39!==u&&34!==u&&37!==u&&64!==u&&96!==u&&function(t){return!kt(t)&&58!==t}(Vt(t,t.length-1));if(e||o)for(l=0;l<t.length;c>=65536?l+=2:l++){if(!Bt(c=Vt(t,l)))return 5;g=g&&zt(c,h,a),h=c}else{for(l=0;l<t.length;c>=65536?l+=2:l++){if(10===(c=Vt(t,l)))d=!0,f&&(p=p||l-m-1>r&&" "!==t[m+1],m=l);else if(!Bt(c))return 5;g=g&&zt(c,h,a),h=c}p=p||f&&l-m-1>r&&" "!==t[m+1]}return d||p?n>9&&Gt(t)?5:o?2===s?5:2:p?4:3:!g||o||i(t)?2===s?5:2:1}function Ht(t,e,n,r,i){t.dump=function(){if(0===e.length)return 2===t.quotingType?'""':"''";if(!t.noCompatMode&&(-1!==Pt.indexOf(e)||It.test(e)))return 2===t.quotingType?'"'+e+'"':"'"+e+"'";var s=t.indent*Math.max(1,n),o=-1===t.lineWidth?-1:Math.max(Math.min(t.lineWidth,40),t.lineWidth-s),l=r||t.flowLevel>-1&&n>=t.flowLevel;switch(jt(e,l,t.indent,o,(function(e){return function(t,e){var n,r;for(n=0,r=t.implicitTypes.length;n<r;n+=1)if(t.implicitTypes[n].resolve(e))return!0;return!1}(t,e)}),t.quotingType,t.forceQuotes&&!r,i)){case 1:return e;case 2:return"'"+e.replace(/'/g,"''")+"'";case 3:return"|"+Wt(e,t.indent)+qt(Lt(e,s));case 4:return">"+Wt(e,t.indent)+qt(Lt(function(t,e){var n,r,i=/(\n+)([^\n]*)/g,s=(a=t.indexOf("\n"),a=-1!==a?a:t.length,i.lastIndex=a,Xt(t.slice(0,a),e)),o="\n"===t[0]||" "===t[0];var a;for(;r=i.exec(t);){var l=r[1],u=r[2];n=" "===u[0],s+=l+(o||n||""===u?"":"\n")+Xt(u,e),o=n}return s}(e,o),s));case 5:return'"'+function(t){for(var e,n="",r=0,i=0;i<t.length;r>=65536?i+=2:i++)r=Vt(t,i),!(e=Nt[r])&&Bt(r)?(n+=t[i],r>=65536&&(n+=t[i+1])):n+=e||Ot(r);return n}(e)+'"';default:throw new a("impossible error: invalid scalar style")}}()}function Wt(t,e){var n=Gt(t)?String(e):"",r="\n"===t[t.length-1];return n+(r&&("\n"===t[t.length-2]||"\n"===t)?"+":r?"":"-")+"\n"}function qt(t){return"\n"===t[t.length-1]?t.slice(0,-1):t}function Xt(t,e){if(""===t||" "===t[0])return t;for(var n,r,i=/ [^ ]/g,s=0,o=0,a=0,l="";n=i.exec(t);)(a=n.index)-s>e&&(r=o>s?o:a,l+="\n"+t.slice(s,r),s=r+1),o=a;return l+="\n",t.length-s>e&&o>s?l+=t.slice(s,o)+"\n"+t.slice(o+1):l+=t.slice(s),l.slice(1)}function Zt(t,e,n,r){var i,s,o,a="",l=t.tag;for(i=0,s=n.length;i<s;i+=1)o=n[i],t.replacer&&(o=t.replacer.call(n,String(i),o)),(Yt(t,e+1,o,!0,!0,!1,!0)||void 0===o&&Yt(t,e+1,null,!0,!0,!1,!0))&&(r&&""===a||(a+=Ut(t,e)),t.dump&&10===t.dump.charCodeAt(0)?a+="-":a+="- ",a+=t.dump);t.tag=l,t.dump=a||"[]"}function $t(t,e,n){var r,i,s,o,l,u;for(s=0,o=(i=n?t.explicitTypes:t.implicitTypes).length;s<o;s+=1)if(((l=i[s]).instanceOf||l.predicate)&&(!l.instanceOf||"object"==typeof e&&e instanceof l.instanceOf)&&(!l.predicate||l.predicate(e))){if(n?l.multi&&l.representName?t.tag=l.representName(e):t.tag=l.tag:t.tag="?",l.represent){if(u=t.styleMap[l.tag]||l.defaultStyle,"[object Function]"===At.call(l.represent))r=l.represent(e,u);else{if(!Ct.call(l.represent,u))throw new a("!<"+l.tag+'> tag resolver accepts not "'+u+'" style');r=l.represent[u](e,u)}t.dump=r}return!0}return!1}function Yt(t,e,n,r,i,s,o){t.tag=null,t.dump=n,$t(t,n,!1)||$t(t,n,!0);var l,u=At.call(t.dump),c=r;r&&(r=t.flowLevel<0||t.flowLevel>e);var h,d,p="[object Object]"===u||"[object Array]"===u;if(p&&(d=-1!==(h=t.duplicates.indexOf(n))),(null!==t.tag&&"?"!==t.tag||d||2!==t.indent&&e>0)&&(i=!1),d&&t.usedDuplicates[h])t.dump="*ref_"+h;else{if(p&&d&&!t.usedDuplicates[h]&&(t.usedDuplicates[h]=!0),"[object Object]"===u)r&&0!==Object.keys(t.dump).length?(!function(t,e,n,r){var i,s,o,l,u,c,h="",d=t.tag,p=Object.keys(n);if(!0===t.sortKeys)p.sort();else if("function"==typeof t.sortKeys)p.sort(t.sortKeys);else if(t.sortKeys)throw new a("sortKeys must be a boolean or a function");for(i=0,s=p.length;i<s;i+=1)c="",r&&""===h||(c+=Ut(t,e)),l=n[o=p[i]],t.replacer&&(l=t.replacer.call(n,o,l)),Yt(t,e+1,o,!0,!0,!0)&&((u=null!==t.tag&&"?"!==t.tag||t.dump&&t.dump.length>1024)&&(t.dump&&10===t.dump.charCodeAt(0)?c+="?":c+="? "),c+=t.dump,u&&(c+=Ut(t,e)),Yt(t,e+1,l,!0,u)&&(t.dump&&10===t.dump.charCodeAt(0)?c+=":":c+=": ",h+=c+=t.dump));t.tag=d,t.dump=h||"{}"}(t,e,t.dump,i),d&&(t.dump="&ref_"+h+t.dump)):(!function(t,e,n){var r,i,s,o,a,l="",u=t.tag,c=Object.keys(n);for(r=0,i=c.length;r<i;r+=1)a="",""!==l&&(a+=", "),t.condenseFlow&&(a+='"'),o=n[s=c[r]],t.replacer&&(o=t.replacer.call(n,s,o)),Yt(t,e,s,!1,!1)&&(t.dump.length>1024&&(a+="? "),a+=t.dump+(t.condenseFlow?'"':"")+":"+(t.condenseFlow?"":" "),Yt(t,e,o,!1,!1)&&(l+=a+=t.dump));t.tag=u,t.dump="{"+l+"}"}(t,e,t.dump),d&&(t.dump="&ref_"+h+" "+t.dump));else if("[object Array]"===u)r&&0!==t.dump.length?(t.noArrayIndent&&!o&&e>0?Zt(t,e-1,t.dump,i):Zt(t,e,t.dump,i),d&&(t.dump="&ref_"+h+t.dump)):(!function(t,e,n){var r,i,s,o="",a=t.tag;for(r=0,i=n.length;r<i;r+=1)s=n[r],t.replacer&&(s=t.replacer.call(n,String(r),s)),(Yt(t,e,s,!1,!1)||void 0===s&&Yt(t,e,null,!1,!1))&&(""!==o&&(o+=","+(t.condenseFlow?"":" ")),o+=t.dump);t.tag=a,t.dump="["+o+"]"}(t,e,t.dump),d&&(t.dump="&ref_"+h+" "+t.dump));else{if("[object String]"!==u){if("[object Undefined]"===u)return!1;if(t.skipInvalid)return!1;throw new a("unacceptable kind of an object to dump "+u)}"?"!==t.tag&&Ht(t,t.dump,e,s,c)}null!==t.tag&&"?"!==t.tag&&(l=encodeURI("!"===t.tag[0]?t.tag.slice(1):t.tag).replace(/!/g,"%21"),l="!"===t.tag[0]?"!"+l:"tag:yaml.org,2002:"===l.slice(0,18)?"!!"+l.slice(18):"!<"+l+">",t.dump=l+" "+t.dump)}return!0}function Kt(t,e){var n,r,i=[],s=[];for(Jt(t,i,s),n=0,r=s.length;n<r;n+=1)e.duplicates.push(i[s[n]]);e.usedDuplicates=new Array(r)}function Jt(t,e,n){var r,i,s;if(null!==t&&"object"==typeof t)if(-1!==(i=e.indexOf(t)))-1===n.indexOf(i)&&n.push(i);else if(e.push(t),Array.isArray(t))for(i=0,s=t.length;i<s;i+=1)Jt(t[i],e,n);else for(i=0,s=(r=Object.keys(t)).length;i<s;i+=1)Jt(t[r[i]],e,n)}function Qt(t,e){return function(){throw new Error("Function yaml."+t+" is removed in js-yaml 4. Use yaml."+e+" instead, which is now safe by default.")}}var te={Type:p,Schema:g,FAILSAFE_SCHEMA:x,JSON_SCHEMA:R,CORE_SCHEMA:N,DEFAULT_SCHEMA:H,load:Tt.load,loadAll:Tt.loadAll,dump:{dump:function(t,e){var n=new Dt(e=e||{});n.noRefs||Kt(t,n);var r=t;return n.replacer&&(r=n.replacer.call({"":r},"",r)),Yt(n,0,r,!0,!0)?n.dump+"\n":""}}.dump,YAMLException:a,types:{binary:U,float:C,map:_,null:b,pairs:V,set:j,timestamp:O,bool:w,int:E,merge:D,omap:F,seq:y,str:v},safeLoad:Qt("safeLoad","load"),safeLoadAll:Qt("safeLoadAll","loadAll"),safeDump:Qt("safeDump","dump")};e.ZP=te},42358:function(t,e,n){"use strict";n.d(e,{Z:function(){return l}});var r=n(32598);function i(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}function s(t,e,n){return Object.defineProperty(t,"prototype",{writable:!1}),t}function o(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,i,s,o,a=[],l=!0,u=!1;try{if(s=(n=n.call(t)).next,0===e);else for(;!(l=(r=s.call(n)).done)&&(a.push(r.value),a.length!==e);l=!0);}catch(t){u=!0,i=t}finally{try{if(!l&&null!=n.return&&(o=n.return(),Object(o)!==o))return}finally{if(u)throw i}}return a}}(t,e)||function(t,e){if(t){if("string"==typeof t)return i(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?i(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var a=s((function t(e,n){var r=n.default,i=void 0===r?null:r,s=n.triggerUpdate,o=void 0===s||s,a=n.onChange,l=void 0===a?function(t,e){}:a;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.name=e,this.defaultVal=i,this.triggerUpdate=o,this.onChange=l}));function l(t){var e=t.stateInit,n=void 0===e?function(){return{}}:e,i=t.props,s=void 0===i?{}:i,l=t.methods,u=void 0===l?{}:l,c=t.aliases,h=void 0===c?{}:c,d=t.init,p=void 0===d?function(){}:d,f=t.update,m=void 0===f?function(){}:f,g=Object.keys(s).map((function(t){return new a(t,s[t])}));return function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=Object.assign({},n instanceof Function?n(t):n,{initialised:!1}),i={};function s(e){return a(e,t),l(),s}var a=function(t,n){p.call(s,t,e,n),e.initialised=!0},l=(0,r.Z)((function(){e.initialised&&(m.call(s,e,i),i={})}),1);return g.forEach((function(t){s[t.name]=function(t){var n=t.name,r=t.triggerUpdate,o=void 0!==r&&r,a=t.onChange,u=void 0===a?function(t,e){}:a,c=t.defaultVal,h=void 0===c?null:c;return function(t){var r=e[n];if(!arguments.length)return r;var a=void 0===t?h:t;return e[n]=a,u.call(s,a,e,r),!i.hasOwnProperty(n)&&(i[n]=r),o&&l(),s}}(t)})),Object.keys(u).forEach((function(t){s[t]=function(){for(var n,r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return(n=u[t]).call.apply(n,[s,e].concat(i))}})),Object.entries(h).forEach((function(t){var e=o(t,2),n=e[0],r=e[1];return s[n]=s[r]})),s.resetProps=function(){return g.forEach((function(t){s[t.name](t.defaultVal)})),s},s.resetProps(),e._rerender=l,s}}},32598:function(t,e,n){"use strict";n.d(e,{Z:function(){return P}});var r=n(82433),i="object"==typeof global&&global&&global.Object===Object&&global,s="object"==typeof self&&self&&self.Object===Object&&self,o=i||s||Function("return this")(),a=function(){return o.Date.now()},l=/\s/;var u=function(t){for(var e=t.length;e--&&l.test(t.charAt(e)););return e},c=/^\s+/;var h=function(t){return t?t.slice(0,u(t)+1).replace(c,""):t},d=o.Symbol,p=Object.prototype,f=p.hasOwnProperty,m=p.toString,g=d?d.toStringTag:void 0;var v=function(t){var e=f.call(t,g),n=t[g];try{t[g]=void 0;var r=!0}catch(t){}var i=m.call(t);return r&&(e?t[g]=n:delete t[g]),i},y=Object.prototype.toString;var _=function(t){return y.call(t)},x=d?d.toStringTag:void 0;var b=function(t){return null==t?void 0===t?"[object Undefined]":"[object Null]":x&&x in Object(t)?v(t):_(t)};var w=function(t){return null!=t&&"object"==typeof t};var S=function(t){return"symbol"==typeof t||w(t)&&"[object Symbol]"==b(t)},M=/^[-+]0x[0-9a-f]+$/i,E=/^0b[01]+$/i,T=/^0o[0-7]+$/i,A=parseInt;var C=function(t){if("number"==typeof t)return t;if(S(t))return NaN;if((0,r.Z)(t)){var e="function"==typeof t.valueOf?t.valueOf():t;t=(0,r.Z)(e)?e+"":e}if("string"!=typeof t)return 0===t?t:+t;t=h(t);var n=E.test(t);return n||T.test(t)?A(t.slice(2),n?2:8):M.test(t)?NaN:+t},R=Math.max,N=Math.min;var P=function(t,e,n){var i,s,o,l,u,c,h=0,d=!1,p=!1,f=!0;if("function"!=typeof t)throw new TypeError("Expected a function");function m(e){var n=i,r=s;return i=s=void 0,h=e,l=t.apply(r,n)}function g(t){return h=t,u=setTimeout(y,e),d?m(t):l}function v(t){var n=t-c;return void 0===c||n>=e||n<0||p&&t-h>=o}function y(){var t=a();if(v(t))return _(t);u=setTimeout(y,function(t){var n=e-(t-c);return p?N(n,o-(t-h)):n}(t))}function _(t){return u=void 0,f&&i?m(t):(i=s=void 0,l)}function x(){var t=a(),n=v(t);if(i=arguments,s=this,c=t,n){if(void 0===u)return g(c);if(p)return clearTimeout(u),u=setTimeout(y,e),m(c)}return void 0===u&&(u=setTimeout(y,e)),l}return e=C(e)||0,(0,r.Z)(n)&&(d=!!n.leading,o=(p="maxWait"in n)?R(C(n.maxWait)||0,e):o,f="trailing"in n?!!n.trailing:f),x.cancel=function(){void 0!==u&&clearTimeout(u),h=0,i=c=s=u=void 0},x.flush=function(){return void 0===u?l:_(a())},x}},82433:function(t,e){"use strict";e.Z=function(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)}},92067:function(t,e,n){"use strict";function r(t){return{all:t=t||new Map,on:function(e,n){var r=t.get(e);r?r.push(n):t.set(e,[n])},off:function(e,n){var r=t.get(e);r&&(n?r.splice(r.indexOf(n)>>>0,1):t.set(e,[]))},emit:function(e,n){var r=t.get(e);r&&r.slice().map((function(t){t(n)})),(r=t.get("*"))&&r.slice().map((function(t){t(e,n)}))}}}n.d(e,{Z:function(){return r}})},20680:function(t,e,n){"use strict";function r(t){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},r(t)}n.d(e,{Z:function(){return o}});var i=/^\s+/,s=/\s+$/;function o(t,e){if(e=e||{},(t=t||"")instanceof o)return t;if(!(this instanceof o))return new o(t,e);var n=function(t){var e={r:0,g:0,b:0},n=1,o=null,a=null,l=null,u=!1,c=!1;"string"==typeof t&&(t=function(t){t=t.replace(i,"").replace(s,"").toLowerCase();var e,n=!1;if(S[t])t=S[t],n=!0;else if("transparent"==t)return{r:0,g:0,b:0,a:0,format:"name"};if(e=U.rgb.exec(t))return{r:e[1],g:e[2],b:e[3]};if(e=U.rgba.exec(t))return{r:e[1],g:e[2],b:e[3],a:e[4]};if(e=U.hsl.exec(t))return{h:e[1],s:e[2],l:e[3]};if(e=U.hsla.exec(t))return{h:e[1],s:e[2],l:e[3],a:e[4]};if(e=U.hsv.exec(t))return{h:e[1],s:e[2],v:e[3]};if(e=U.hsva.exec(t))return{h:e[1],s:e[2],v:e[3],a:e[4]};if(e=U.hex8.exec(t))return{r:C(e[1]),g:C(e[2]),b:C(e[3]),a:I(e[4]),format:n?"name":"hex8"};if(e=U.hex6.exec(t))return{r:C(e[1]),g:C(e[2]),b:C(e[3]),format:n?"name":"hex"};if(e=U.hex4.exec(t))return{r:C(e[1]+""+e[1]),g:C(e[2]+""+e[2]),b:C(e[3]+""+e[3]),a:I(e[4]+""+e[4]),format:n?"name":"hex8"};if(e=U.hex3.exec(t))return{r:C(e[1]+""+e[1]),g:C(e[2]+""+e[2]),b:C(e[3]+""+e[3]),format:n?"name":"hex"};return!1}(t));"object"==r(t)&&(k(t.r)&&k(t.g)&&k(t.b)?(h=t.r,d=t.g,p=t.b,e={r:255*T(h,255),g:255*T(d,255),b:255*T(p,255)},u=!0,c="%"===String(t.r).substr(-1)?"prgb":"rgb"):k(t.h)&&k(t.s)&&k(t.v)?(o=N(t.s),a=N(t.v),e=function(t,e,n){t=6*T(t,360),e=T(e,100),n=T(n,100);var r=Math.floor(t),i=t-r,s=n*(1-e),o=n*(1-i*e),a=n*(1-(1-i)*e),l=r%6,u=[n,o,s,s,a,n][l],c=[a,n,n,o,s,s][l],h=[s,s,a,n,n,o][l];return{r:255*u,g:255*c,b:255*h}}(t.h,o,a),u=!0,c="hsv"):k(t.h)&&k(t.s)&&k(t.l)&&(o=N(t.s),l=N(t.l),e=function(t,e,n){var r,i,s;function o(t,e,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?t+6*(e-t)*n:n<.5?e:n<2/3?t+(e-t)*(2/3-n)*6:t}if(t=T(t,360),e=T(e,100),n=T(n,100),0===e)r=i=s=n;else{var a=n<.5?n*(1+e):n+e-n*e,l=2*n-a;r=o(l,a,t+1/3),i=o(l,a,t),s=o(l,a,t-1/3)}return{r:255*r,g:255*i,b:255*s}}(t.h,o,l),u=!0,c="hsl"),t.hasOwnProperty("a")&&(n=t.a));var h,d,p;return n=E(n),{ok:u,format:t.format||c,r:Math.min(255,Math.max(e.r,0)),g:Math.min(255,Math.max(e.g,0)),b:Math.min(255,Math.max(e.b,0)),a:n}}(t);this._originalInput=t,this._r=n.r,this._g=n.g,this._b=n.b,this._a=n.a,this._roundA=Math.round(100*this._a)/100,this._format=e.format||n.format,this._gradientType=e.gradientType,this._r<1&&(this._r=Math.round(this._r)),this._g<1&&(this._g=Math.round(this._g)),this._b<1&&(this._b=Math.round(this._b)),this._ok=n.ok}function a(t,e,n){t=T(t,255),e=T(e,255),n=T(n,255);var r,i,s=Math.max(t,e,n),o=Math.min(t,e,n),a=(s+o)/2;if(s==o)r=i=0;else{var l=s-o;switch(i=a>.5?l/(2-s-o):l/(s+o),s){case t:r=(e-n)/l+(e<n?6:0);break;case e:r=(n-t)/l+2;break;case n:r=(t-e)/l+4}r/=6}return{h:r,s:i,l:a}}function l(t,e,n){t=T(t,255),e=T(e,255),n=T(n,255);var r,i,s=Math.max(t,e,n),o=Math.min(t,e,n),a=s,l=s-o;if(i=0===s?0:l/s,s==o)r=0;else{switch(s){case t:r=(e-n)/l+(e<n?6:0);break;case e:r=(n-t)/l+2;break;case n:r=(t-e)/l+4}r/=6}return{h:r,s:i,v:a}}function u(t,e,n,r){var i=[R(Math.round(t).toString(16)),R(Math.round(e).toString(16)),R(Math.round(n).toString(16))];return r&&i[0].charAt(0)==i[0].charAt(1)&&i[1].charAt(0)==i[1].charAt(1)&&i[2].charAt(0)==i[2].charAt(1)?i[0].charAt(0)+i[1].charAt(0)+i[2].charAt(0):i.join("")}function c(t,e,n,r){return[R(P(r)),R(Math.round(t).toString(16)),R(Math.round(e).toString(16)),R(Math.round(n).toString(16))].join("")}function h(t,e){e=0===e?0:e||10;var n=o(t).toHsl();return n.s-=e/100,n.s=A(n.s),o(n)}function d(t,e){e=0===e?0:e||10;var n=o(t).toHsl();return n.s+=e/100,n.s=A(n.s),o(n)}function p(t){return o(t).desaturate(100)}function f(t,e){e=0===e?0:e||10;var n=o(t).toHsl();return n.l+=e/100,n.l=A(n.l),o(n)}function m(t,e){e=0===e?0:e||10;var n=o(t).toRgb();return n.r=Math.max(0,Math.min(255,n.r-Math.round(-e/100*255))),n.g=Math.max(0,Math.min(255,n.g-Math.round(-e/100*255))),n.b=Math.max(0,Math.min(255,n.b-Math.round(-e/100*255))),o(n)}function g(t,e){e=0===e?0:e||10;var n=o(t).toHsl();return n.l-=e/100,n.l=A(n.l),o(n)}function v(t,e){var n=o(t).toHsl(),r=(n.h+e)%360;return n.h=r<0?360+r:r,o(n)}function y(t){var e=o(t).toHsl();return e.h=(e.h+180)%360,o(e)}function _(t,e){if(isNaN(e)||e<=0)throw new Error("Argument to polyad must be a positive number");for(var n=o(t).toHsl(),r=[o(t)],i=360/e,s=1;s<e;s++)r.push(o({h:(n.h+s*i)%360,s:n.s,l:n.l}));return r}function x(t){var e=o(t).toHsl(),n=e.h;return[o(t),o({h:(n+72)%360,s:e.s,l:e.l}),o({h:(n+216)%360,s:e.s,l:e.l})]}function b(t,e,n){e=e||6,n=n||30;var r=o(t).toHsl(),i=360/n,s=[o(t)];for(r.h=(r.h-(i*e>>1)+720)%360;--e;)r.h=(r.h+i)%360,s.push(o(r));return s}function w(t,e){e=e||6;for(var n=o(t).toHsv(),r=n.h,i=n.s,s=n.v,a=[],l=1/e;e--;)a.push(o({h:r,s:i,v:s})),s=(s+l)%1;return a}o.prototype={isDark:function(){return this.getBrightness()<128},isLight:function(){return!this.isDark()},isValid:function(){return this._ok},getOriginalInput:function(){return this._originalInput},getFormat:function(){return this._format},getAlpha:function(){return this._a},getBrightness:function(){var t=this.toRgb();return(299*t.r+587*t.g+114*t.b)/1e3},getLuminance:function(){var t,e,n,r=this.toRgb();return t=r.r/255,e=r.g/255,n=r.b/255,.2126*(t<=.03928?t/12.92:Math.pow((t+.055)/1.055,2.4))+.7152*(e<=.03928?e/12.92:Math.pow((e+.055)/1.055,2.4))+.0722*(n<=.03928?n/12.92:Math.pow((n+.055)/1.055,2.4))},setAlpha:function(t){return this._a=E(t),this._roundA=Math.round(100*this._a)/100,this},toHsv:function(){var t=l(this._r,this._g,this._b);return{h:360*t.h,s:t.s,v:t.v,a:this._a}},toHsvString:function(){var t=l(this._r,this._g,this._b),e=Math.round(360*t.h),n=Math.round(100*t.s),r=Math.round(100*t.v);return 1==this._a?"hsv("+e+", "+n+"%, "+r+"%)":"hsva("+e+", "+n+"%, "+r+"%, "+this._roundA+")"},toHsl:function(){var t=a(this._r,this._g,this._b);return{h:360*t.h,s:t.s,l:t.l,a:this._a}},toHslString:function(){var t=a(this._r,this._g,this._b),e=Math.round(360*t.h),n=Math.round(100*t.s),r=Math.round(100*t.l);return 1==this._a?"hsl("+e+", "+n+"%, "+r+"%)":"hsla("+e+", "+n+"%, "+r+"%, "+this._roundA+")"},toHex:function(t){return u(this._r,this._g,this._b,t)},toHexString:function(t){return"#"+this.toHex(t)},toHex8:function(t){return function(t,e,n,r,i){var s=[R(Math.round(t).toString(16)),R(Math.round(e).toString(16)),R(Math.round(n).toString(16)),R(P(r))];if(i&&s[0].charAt(0)==s[0].charAt(1)&&s[1].charAt(0)==s[1].charAt(1)&&s[2].charAt(0)==s[2].charAt(1)&&s[3].charAt(0)==s[3].charAt(1))return s[0].charAt(0)+s[1].charAt(0)+s[2].charAt(0)+s[3].charAt(0);return s.join("")}(this._r,this._g,this._b,this._a,t)},toHex8String:function(t){return"#"+this.toHex8(t)},toRgb:function(){return{r:Math.round(this._r),g:Math.round(this._g),b:Math.round(this._b),a:this._a}},toRgbString:function(){return 1==this._a?"rgb("+Math.round(this._r)+", "+Math.round(this._g)+", "+Math.round(this._b)+")":"rgba("+Math.round(this._r)+", "+Math.round(this._g)+", "+Math.round(this._b)+", "+this._roundA+")"},toPercentageRgb:function(){return{r:Math.round(100*T(this._r,255))+"%",g:Math.round(100*T(this._g,255))+"%",b:Math.round(100*T(this._b,255))+"%",a:this._a}},toPercentageRgbString:function(){return 1==this._a?"rgb("+Math.round(100*T(this._r,255))+"%, "+Math.round(100*T(this._g,255))+"%, "+Math.round(100*T(this._b,255))+"%)":"rgba("+Math.round(100*T(this._r,255))+"%, "+Math.round(100*T(this._g,255))+"%, "+Math.round(100*T(this._b,255))+"%, "+this._roundA+")"},toName:function(){return 0===this._a?"transparent":!(this._a<1)&&(M[u(this._r,this._g,this._b,!0)]||!1)},toFilter:function(t){var e="#"+c(this._r,this._g,this._b,this._a),n=e,r=this._gradientType?"GradientType = 1, ":"";if(t){var i=o(t);n="#"+c(i._r,i._g,i._b,i._a)}return"progid:DXImageTransform.Microsoft.gradient("+r+"startColorstr="+e+",endColorstr="+n+")"},toString:function(t){var e=!!t;t=t||this._format;var n=!1,r=this._a<1&&this._a>=0;return e||!r||"hex"!==t&&"hex6"!==t&&"hex3"!==t&&"hex4"!==t&&"hex8"!==t&&"name"!==t?("rgb"===t&&(n=this.toRgbString()),"prgb"===t&&(n=this.toPercentageRgbString()),"hex"!==t&&"hex6"!==t||(n=this.toHexString()),"hex3"===t&&(n=this.toHexString(!0)),"hex4"===t&&(n=this.toHex8String(!0)),"hex8"===t&&(n=this.toHex8String()),"name"===t&&(n=this.toName()),"hsl"===t&&(n=this.toHslString()),"hsv"===t&&(n=this.toHsvString()),n||this.toHexString()):"name"===t&&0===this._a?this.toName():this.toRgbString()},clone:function(){return o(this.toString())},_applyModification:function(t,e){var n=t.apply(null,[this].concat([].slice.call(e)));return this._r=n._r,this._g=n._g,this._b=n._b,this.setAlpha(n._a),this},lighten:function(){return this._applyModification(f,arguments)},brighten:function(){return this._applyModification(m,arguments)},darken:function(){return this._applyModification(g,arguments)},desaturate:function(){return this._applyModification(h,arguments)},saturate:function(){return this._applyModification(d,arguments)},greyscale:function(){return this._applyModification(p,arguments)},spin:function(){return this._applyModification(v,arguments)},_applyCombination:function(t,e){return t.apply(null,[this].concat([].slice.call(e)))},analogous:function(){return this._applyCombination(b,arguments)},complement:function(){return this._applyCombination(y,arguments)},monochromatic:function(){return this._applyCombination(w,arguments)},splitcomplement:function(){return this._applyCombination(x,arguments)},triad:function(){return this._applyCombination(_,[3])},tetrad:function(){return this._applyCombination(_,[4])}},o.fromRatio=function(t,e){if("object"==r(t)){var n={};for(var i in t)t.hasOwnProperty(i)&&(n[i]="a"===i?t[i]:N(t[i]));t=n}return o(t,e)},o.equals=function(t,e){return!(!t||!e)&&o(t).toRgbString()==o(e).toRgbString()},o.random=function(){return o.fromRatio({r:Math.random(),g:Math.random(),b:Math.random()})},o.mix=function(t,e,n){n=0===n?0:n||50;var r=o(t).toRgb(),i=o(e).toRgb(),s=n/100;return o({r:(i.r-r.r)*s+r.r,g:(i.g-r.g)*s+r.g,b:(i.b-r.b)*s+r.b,a:(i.a-r.a)*s+r.a})},o.readability=function(t,e){var n=o(t),r=o(e);return(Math.max(n.getLuminance(),r.getLuminance())+.05)/(Math.min(n.getLuminance(),r.getLuminance())+.05)},o.isReadable=function(t,e,n){var r,i,s=o.readability(t,e);switch(i=!1,(r=function(t){var e,n;e=((t=t||{level:"AA",size:"small"}).level||"AA").toUpperCase(),n=(t.size||"small").toLowerCase(),"AA"!==e&&"AAA"!==e&&(e="AA");"small"!==n&&"large"!==n&&(n="small");return{level:e,size:n}}(n)).level+r.size){case"AAsmall":case"AAAlarge":i=s>=4.5;break;case"AAlarge":i=s>=3;break;case"AAAsmall":i=s>=7}return i},o.mostReadable=function(t,e,n){var r,i,s,a,l=null,u=0;i=(n=n||{}).includeFallbackColors,s=n.level,a=n.size;for(var c=0;c<e.length;c++)(r=o.readability(t,e[c]))>u&&(u=r,l=o(e[c]));return o.isReadable(t,l,{level:s,size:a})||!i?l:(n.includeFallbackColors=!1,o.mostReadable(t,["#fff","#000"],n))};var S=o.names={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"0ff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000",blanchedalmond:"ffebcd",blue:"00f",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",burntsienna:"ea7e5d",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"0ff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkgrey:"a9a9a9",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkslategrey:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dimgrey:"696969",dodgerblue:"1e90ff",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"f0f",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",grey:"808080",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgray:"d3d3d3",lightgreen:"90ee90",lightgrey:"d3d3d3",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslategray:"789",lightslategrey:"789",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"0f0",limegreen:"32cd32",linen:"faf0e6",magenta:"f0f",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370db",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"db7093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",rebeccapurple:"663399",red:"f00",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",slategrey:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",wheat:"f5deb3",white:"fff",whitesmoke:"f5f5f5",yellow:"ff0",yellowgreen:"9acd32"},M=o.hexNames=function(t){var e={};for(var n in t)t.hasOwnProperty(n)&&(e[t[n]]=n);return e}(S);function E(t){return t=parseFloat(t),(isNaN(t)||t<0||t>1)&&(t=1),t}function T(t,e){(function(t){return"string"==typeof t&&-1!=t.indexOf(".")&&1===parseFloat(t)})(t)&&(t="100%");var n=function(t){return"string"==typeof t&&-1!=t.indexOf("%")}(t);return t=Math.min(e,Math.max(0,parseFloat(t))),n&&(t=parseInt(t*e,10)/100),Math.abs(t-e)<1e-6?1:t%e/parseFloat(e)}function A(t){return Math.min(1,Math.max(0,t))}function C(t){return parseInt(t,16)}function R(t){return 1==t.length?"0"+t:""+t}function N(t){return t<=1&&(t=100*t+"%"),t}function P(t){return Math.round(255*parseFloat(t)).toString(16)}function I(t){return C(t)/255}var O,D,L,U=(D="[\\s|\\(]+("+(O="(?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?)")+")[,|\\s]+("+O+")[,|\\s]+("+O+")\\s*\\)?",L="[\\s|\\(]+("+O+")[,|\\s]+("+O+")[,|\\s]+("+O+")[,|\\s]+("+O+")\\s*\\)?",{CSS_UNIT:new RegExp(O),rgb:new RegExp("rgb"+D),rgba:new RegExp("rgba"+L),hsl:new RegExp("hsl"+D),hsla:new RegExp("hsla"+L),hsv:new RegExp("hsv"+D),hsva:new RegExp("hsva"+L),hex3:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex6:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/,hex4:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex8:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/});function k(t){return!!U.CSS_UNIT.exec(t)}},53394:function(t,e,n){"use strict";function r(t,e){if(Object.is(t,e))return!0;if("object"!=typeof t||null===t||"object"!=typeof e||null===e)return!1;if(t instanceof Map&&e instanceof Map){if(t.size!==e.size)return!1;for(const[n,r]of t)if(!Object.is(r,e.get(n)))return!1;return!0}if(t instanceof Set&&e instanceof Set){if(t.size!==e.size)return!1;for(const n of t)if(!e.has(n))return!1;return!0}const n=Object.keys(t);if(n.length!==Object.keys(e).length)return!1;for(const r of n)if(!Object.prototype.hasOwnProperty.call(e,r)||!Object.is(t[r],e[r]))return!1;return!0}n.d(e,{X:function(){return r}})},74914:function(t,e,n){"use strict";n.d(e,{M:function(){return i}});const r=t=>{let e;const n=new Set,r=(t,r)=>{const i="function"==typeof t?t(e):t;if(!Object.is(i,e)){const t=e;e=(null!=r?r:"object"!=typeof i||null===i)?i:Object.assign({},e,i),n.forEach((n=>n(e,t)))}},i=()=>e,s={setState:r,getState:i,getInitialState:()=>o,subscribe:t=>(n.add(t),()=>n.delete(t)),destroy:()=>{console.warn("[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected."),n.clear()}},o=e=t(r,i,s);return s},i=t=>t?r(t):r},55227:function(t,e,n){"use strict";n.d(e,{U:function(){return a}});var r=n(50959);const i=t=>{let e;const n=new Set,r=(t,r)=>{const i="function"==typeof t?t(e):t;if(!Object.is(i,e)){const t=e;e=(null!=r?r:"object"!=typeof i||null===i)?i:Object.assign({},e,i),n.forEach((n=>n(e,t)))}},i=()=>e,s={setState:r,getState:i,getInitialState:()=>o,subscribe:t=>(n.add(t),()=>n.delete(t))},o=e=t(r,i,s);return s},s=t=>t;const o=t=>{const e=(t=>t?i(t):i)(t),n=t=>function(t,e=s){const n=r.useSyncExternalStore(t.subscribe,(()=>e(t.getState())),(()=>e(t.getInitialState())));return r.useDebugValue(n),n}(e,t);return Object.assign(n,e),n},a=t=>t?o(t):o}}]);